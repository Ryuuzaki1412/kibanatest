/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */!function(t){function e(e){for(var a,n,r=e[0],s=e[1],o=0,c=[];o<r.length;o++)n=r[o],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&c.push(i[n][0]),i[n]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(t[a]=s[a]);for(l&&l(e);c.length;)c.shift()()}var a={},i={0:0};function n(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.e=function(t){var e=[],a=i[t];if(0!==a)if(a)e.push(a[2]);else{var r=new Promise((function(e,n){a=i[t]=[e,n]}));e.push(a[2]=r);var s,o=document.createElement("script");o.charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.src=function(t){return n.p+"cloudExperiments.chunk."+t+".js"}(t);var l=new Error;s=function(e){o.onerror=o.onload=null,clearTimeout(c);var a=i[t];if(0!==a){if(a){var n=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",l.name="ChunkLoadError",l.type=n,l.request=r,a[1](l)}i[t]=void 0}};var c=setTimeout((function(){s({type:"timeout",target:o})}),12e4);o.onerror=o.onload=s,document.head.appendChild(o)}return Promise.all(e)},n.m=t,n.c=a,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n.oe=function(t){throw console.error(t),t};var r=window.cloudExperiments_bundle_jsonpfunction=window.cloudExperiments_bundle_jsonpfunction||[],s=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var l=s;n(n.s=4)}([function(t,e,a){t.exports=a(6)(2)},function(t,e){t.exports=__kbnSharedDeps__.Rxjs},function(t,e){t.exports=__kbnSharedDeps__.Lodash},function(t,e){t.exports=__kbnSharedDeps__.Moment},function(t,e,a){a(5),__kbnBundles__.define("plugin/cloudExperiments/public",a,7)},function(t,e,a){a.p=window.__kbnPublicPath__.cloudExperiments},function(t,e){t.exports=__kbnSharedDeps_npm__},function(t,e,a){"use strict";a.r(e),a.d(e,"plugin",(function(){return u}));var i=a(0),n=a.n(i),r=a(2),s=a(3),o=a(1);class launch_darkly_client_LaunchDarklyClient{constructor(t,e){n()(this,"launchDarklyClient",void 0),this.ldConfig=t,this.kibanaVersion=e}async updateUserMetadata(t){const{userId:e,...i}=t,n={...i,kind:"user",key:e};if(this.launchDarklyClient)await this.launchDarklyClient.identify(n);else{const{initialize:t,basicLogger:e}=await a.e(1).then(a.t.bind(null,8,7));this.launchDarklyClient=t(this.ldConfig.client_id,n,{application:{id:"kibana-browser",version:this.kibanaVersion},logger:e({level:this.ldConfig.client_log_level})})}}async getVariation(t,e){return this.launchDarklyClient?(await this.launchDarklyClient.waitForInitialization(),await this.launchDarklyClient.variation(t,e)):e}reportMetric(t,e,a){this.launchDarklyClient&&this.launchDarklyClient.track(t,e,a)}stop(){var t;null===(t=this.launchDarklyClient)||void 0===t||t.flush().catch((t=>console.warn(t)))}}class metadata_service_MetadataService{constructor(t){n()(this,"_userMetadata$",new o.BehaviorSubject(void 0)),n()(this,"stop$",new o.Subject),this.config=t}setup(t){this._userMetadata$.next(t);const e=t.trialEndDate;e&&this.scheduleUntil((()=>({inTrial:Date.now()<=new Date(e).getTime()})),(t=>!1===t.inTrial))}get userMetadata$(){return this._userMetadata$.pipe(Object(o.filter)(Boolean),Object(o.debounceTime)(100),Object(o.distinct)((t=>[t.inTrial,t.hasData].join("-"))),Object(o.shareReplay)(1))}start({hasDataFetcher:t}){this._userMetadata$.value&&this.scheduleUntil((async()=>t()),(t=>!0===t.hasData))}stop(){this.stop$.next(),this._userMetadata$.complete()}scheduleUntil(t,e){Object(o.timer)(0,this.config.metadata_refresh_interval.asMilliseconds()).pipe(Object(o.takeUntil)(this.stop$),Object(o.exhaustMap)((async()=>{this._userMetadata$.next({...this._userMetadata$.value,...await t()})})),Object(o.takeWhile)((()=>!e(this._userMetadata$.value)))).subscribe()}}let l,c;!function(t){t["security-solutions.add-integrations-url"]="security-solutions.add-integrations-url",t["security-solutions.guided-onboarding-content"]="security-solutions.guided-onboarding-content",t["cloud-chat.enabled"]="cloud-chat.enabled",t["cloud-chat.chat-variant"]="cloud-chat.chat-variant"}(l||(l={})),c||(c={});class plugin_CloudExperimentsPlugin{constructor(t){n()(this,"metadataService",void 0),n()(this,"launchDarklyClient",void 0),n()(this,"kibanaVersion",void 0),n()(this,"flagOverrides",void 0),n()(this,"isDev",void 0),n()(this,"getVariation",(async(t,e)=>{const a=l[t];return this.flagOverrides&&Object(r.has)(this.flagOverrides,a)?Object(r.get)(this.flagOverrides,a,e):this.launchDarklyClient?await this.launchDarklyClient.getVariation(a,e):e})),n()(this,"reportMetric",(({name:t,meta:e,value:a})=>{var i;const n=c[t];null===(i=this.launchDarklyClient)||void 0===i||i.reportMetric(n,e,a),this.isDev&&console.debug(`Reported experimentation metric ${n}`,{experimentationMetric:{name:t,meta:e,value:a}})})),this.isDev=t.env.mode.dev,this.kibanaVersion=t.env.packageInfo.version;const e=t.config.get();this.metadataService=new metadata_service_MetadataService({metadata_refresh_interval:Object(s.duration)(e.metadata_refresh_interval)}),e.flag_overrides&&(this.flagOverrides=e.flag_overrides);const a=e.launch_darkly;if(!(null!=a&&a.client_id||t.env.mode.dev))throw new Error("xpack.cloud_integrations.experiments.launch_darkly configuration should exist");null!=a&&a.client_id&&(this.launchDarklyClient=new launch_darkly_client_LaunchDarklyClient(a,this.kibanaVersion))}setup(t,e){var a;e.cloud.isCloudEnabled&&e.cloud.deploymentId&&this.launchDarklyClient&&this.metadataService.setup({userId:e.cloud.deploymentId,kibanaVersion:this.kibanaVersion,trialEndDate:null===(a=e.cloud.trialEndDate)||void 0===a?void 0:a.toISOString(),isElasticStaff:e.cloud.isElasticStaffOwned})}start(t,{cloud:e,dataViews:a}){return e.isCloudEnabled&&(this.metadataService.start({hasDataFetcher:async()=>({hasData:await a.hasData.hasUserDataView()})}),this.metadataService.userMetadata$.pipe(Object(o.concatMap)((async t=>await this.launchDarklyClient.updateUserMetadata(t)))).subscribe()),{getVariation:this.getVariation,reportMetric:this.reportMetric}}stop(){var t;null===(t=this.launchDarklyClient)||void 0===t||t.stop(),this.metadataService.stop()}}function u(t){return new plugin_CloudExperimentsPlugin(t)}}]);