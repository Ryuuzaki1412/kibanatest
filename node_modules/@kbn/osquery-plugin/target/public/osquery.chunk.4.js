/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.osquery_bundle_jsonpfunction=window.osquery_bundle_jsonpfunction||[]).push([[4],{101:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var s=a(5),u=a(1),l=a.n(u),i=a(8),n=a(14),r=a(124),o=a(107),c=a(112),j=a(88),d=a(16),M=a(2),g=a(99),y=a(0);const p={"&.euiFlyoutHeader":{paddingTop:"21px",paddingBottom:"20px"}},b=({enabled:e,onClose:t})=>{const{serializer:a,watch:l}=Object(d.useFormContext)(),i=l(),{query:r,ecs_mapping:o,id:c,timeout:j}=i,b=Object(u.useMemo)((()=>a(i)),[o]);return Object(y.jsx)(s.EuiFlyout,{type:"push",size:"m",onClose:t,"data-test-subj":"osquery-save-query-flyout"},Object(y.jsx)(s.EuiFlyoutHeader,{css:p,hasBorder:!0},Object(y.jsx)(s.EuiTitle,{size:"s"},Object(y.jsx)("h5",null,Object(y.jsx)(n.FormattedMessage,{id:"xpack.osquery.queryPlaygroundFlyout.title",defaultMessage:"Test query"})))),Object(y.jsx)(s.EuiFlyoutBody,null,Object(y.jsx)(g.a,{enabled:e&&""!==r,formType:"simple",query:r,ecs_mapping:b.ecs_mapping,savedQueryId:c,timeout:j||M.g.DEFAULT,queryField:!1,ecsMappingField:!1})))},O=l.a.memo(b);var x=a(113),L=a(66);const N=({viewMode:e,hasPlayground:t,isValid:a,idSet:d})=>{const[M,g]=Object(u.useState)(!1),p=Object(u.useMemo)((()=>({isDisabled:!!e})),[e]),b=Object(u.useCallback)((()=>g(!1)),[]),N=Object(u.useCallback)((()=>g((e=>!e))),[]),m=Object(u.useMemo)((()=>({append:"s",...p})),[p]),T=Object(u.useMemo)((()=>({noSuggestions:!1,singleSelection:{asPlainText:!0},placeholder:i.i18n.translate("xpack.osquery.pack.queriesTable.osqueryVersionAllLabel",{defaultMessage:"ALL"}),options:c.a,onCreateOption:void 0,...p})),[p]);return Object(y.jsx)(l.a.Fragment,null,Object(y.jsx)(r.c,{idSet:d,euiFieldProps:p}),Object(y.jsx)(s.EuiSpacer,null),Object(y.jsx)(r.b,{euiFieldProps:p}),Object(y.jsx)(s.EuiSpacer,null),Object(y.jsx)(x.a,{euiFieldProps:p}),Object(y.jsx)(s.EuiSpacer,{size:"m"}),Object(y.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(r.e,{euiFieldProps:p})),Object(y.jsx)(s.EuiFlexItem,null)),Object(y.jsx)(s.EuiSpacer,{size:"xl"}),Object(y.jsx)(s.EuiFlexGroup,null,Object(y.jsx)(s.EuiFlexItem,{css:L.a},Object(y.jsx)(j.a,{euiFieldProps:p}))),!e&&t&&Object(y.jsx)(s.EuiFlexGroup,null,Object(y.jsx)(s.EuiFlexItem,{grow:!1},Object(y.jsx)(s.EuiButtonEmpty,{iconType:"play",onClick:N},Object(y.jsx)(n.FormattedMessage,{id:"xpack.osquery.savedQueries.form.packConfigSection.testConfigButtonLabel",defaultMessage:"Test configuration"})))),Object(y.jsx)(s.EuiSpacer,{size:"xl"}),Object(y.jsx)(s.EuiFlexGroup,null,Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(s.EuiTitle,{size:"xs"},Object(y.jsx)("h5",null,Object(y.jsx)(n.FormattedMessage,{id:"xpack.osquery.savedQueries.form.packConfigSection.title",defaultMessage:"Pack configuration"}))),Object(y.jsx)(s.EuiText,{color:"subdued"},Object(y.jsx)(n.FormattedMessage,{id:"xpack.osquery.savedQueries.form.packConfigSection.description",defaultMessage:"The options listed below are optional and are only applied when the query is assigned to a pack."})))),Object(y.jsx)(s.EuiSpacer,null),Object(y.jsx)(s.EuiFlexGroup,null,Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(r.a,{euiFieldProps:m}),Object(y.jsx)(s.EuiSpacer,{size:"m"}),Object(y.jsx)(r.f,{euiFieldProps:T}),Object(y.jsx)(s.EuiSpacer,{size:"m"}),Object(y.jsx)(r.d,{euiFieldProps:p})),Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(o.a,{euiFieldProps:p}))),M&&Object(y.jsx)(O,{enabled:void 0===a||a,onClose:b}))};N.displayName="SavedQueryForm";const m=l.a.memo(N)},107:function(e,t,a){"use strict";a.d(t,"a",(function(){return M}));var s=a(7),u=a.n(s),l=a(15),i=a(1),n=a(5),r=a(14),o=a(16),c=a(8),j=a(108),d=a(0);const M=e=>{const{euiFieldProps:t={},idAria:a,helpText:s,...M}=e,{field:{onChange:g,value:y},fieldState:{error:p}}=Object(o.useController)({name:"platform",defaultValue:[]}),b=Object(i.useMemo)((()=>[{id:"linux",label:Object(d.jsx)(n.EuiFlexGroup,{gutterSize:"s"},Object(d.jsx)(n.EuiFlexItem,null,Object(d.jsx)(j.a,{platform:"linux"})),Object(d.jsx)(n.EuiFlexItem,null,Object(d.jsx)(r.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.platformMacOSLabel",defaultMessage:"Linux"})))},{id:"darwin",label:Object(d.jsx)(n.EuiFlexGroup,{gutterSize:"s"},Object(d.jsx)(n.EuiFlexItem,null,Object(d.jsx)(j.a,{platform:"darwin"})),Object(d.jsx)(n.EuiFlexItem,null,Object(d.jsx)(r.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.platformLinusLabel",defaultMessage:"macOS"})))},{id:"windows",label:Object(d.jsx)(n.EuiFlexGroup,{gutterSize:"s"},Object(d.jsx)(n.EuiFlexItem,null,Object(d.jsx)(j.a,{platform:"windows"})),Object(d.jsx)(n.EuiFlexItem,null,Object(d.jsx)(r.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.platformWindowsLabel",defaultMessage:"Windows"})))}]),[]),[O,x]=Object(i.useState)((()=>b.reduce(((e,t)=>{var a;return e[t.id]=!!Object(l.isEmpty)(y)||null!==(a=null==y?void 0:y.includes(t.id))&&void 0!==a&&a,e}),{}))),L=Object(i.useCallback)((e=>{const t={...O,[e]:!O[e]};x(t),g(Object.keys(Object(l.pickBy)(t,(e=>!0===e))).join(","))}),[O,g]),N=Object(i.useMemo)((()=>a?[a]:[]),[a]);Object(i.useEffect)((()=>{x((()=>b.reduce(((e,t)=>{var a;return e[t.id]=!!Object(l.isEmpty)(y)||null!==(a=null==y?void 0:y.includes(t.id))&&void 0!==a&&a,e}),{})))}),[y,b]);const m=Object(i.useMemo)((()=>!(null==p||!p.message)),[null==p?void 0:p.message]);return Object(d.jsx)(n.EuiFormRow,u()({label:c.i18n.translate("xpack.osquery.pack.queryFlyoutForm.platformFieldLabel",{defaultMessage:"Platform"}),helpText:"function"==typeof s?s():s,error:null==p?void 0:p.message,isInvalid:m,fullWidth:!0,describedByIds:N},M),Object(d.jsx)(n.EuiCheckboxGroup,u()({idToSelectedMap:O,options:b,onChange:L,"data-test-subj":"osquery-platform-checkbox-group"},t)))}},108:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(5),u=a(1),l=a.n(u),i=a(109),n=a(0);const r=({platform:e})=>{const t=Object(u.useMemo)((()=>Object(i.a)(e)),[e]);return Object(n.jsx)(s.EuiIcon,{type:t,title:e,size:"l"})},o=l.a.memo(r)},109:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return M}));var s=a(15),u=a(110),l=a(152),i=a.n(l),n=a(153),r=a.n(n),o=a(154),c=a.n(o),j=a(111);const d=e=>{switch(e){case"darwin":return c.a;case"linux":return i.a;case"windows":return r.a;default:return`${e}`}},M=e=>{let t;try{t=null==e?void 0:e.split(",").map((e=>e.trim()))}catch(e){return}if(t)return Object(s.uniq)(t.reduce(((e,t)=>(u.a.includes(t)?e.push(t):("posix"===t&&(e.push(j.a.darwin),e.push(j.a.linux)),"ubuntu"===t&&e.push(j.a.linux)),e)),[])).join(",")}},110:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var s=a(111);const u=[s.a.darwin,s.a.linux,s.a.windows]},111:function(e,t,a){"use strict";let s;a.d(t,"a",(function(){return s})),function(e){e.darwin="darwin",e.windows="windows",e.linux="linux"}(s||(s={}))},112:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s=[{label:"5.0.1"},{label:"4.9.0"},{label:"4.8.0"},{label:"4.7.0"},{label:"4.6.0"},{label:"4.5.1"},{label:"4.5.0"},{label:"4.4.0"},{label:"4.3.0"},{label:"4.2.0"},{label:"4.1.2"},{label:"4.1.1"},{label:"4.0.2"},{label:"3.3.2"},{label:"3.3.0"},{label:"3.2.6"},{label:"3.2.4"},{label:"2.9.0"},{label:"2.8.0"},{label:"2.7.0"},{label:"2.11.2"},{label:"2.11.0"},{label:"2.10.2"},{label:"2.10.0"}]},113:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var s=a(42),u=a(5),l=a(1),i=a.n(l),n=a(16),r=a(8),o=a(114),c=a(126),j=a(0);const d={minHeight:"100px"},M=({euiFieldProps:e,labelAppend:t,helpText:a})=>{const{field:{onChange:l,value:i},fieldState:{error:M}}=Object(n.useController)({name:"query",rules:{required:{message:r.i18n.translate("xpack.osquery.pack.queryFlyoutForm.emptyQueryError",{defaultMessage:"Query is a required field"}),value:!0}},defaultValue:""});return Object(j.jsx)(u.EuiFormRow,{label:r.i18n.translate("xpack.osquery.savedQuery.queryEditorLabel",{defaultMessage:"Query"}),labelAppend:Object(s.isEmpty)(t)?Object(j.jsx)(o.a,null):t,helpText:a,isInvalid:!(null==M||!M.message),error:null==M?void 0:M.message,fullWidth:!0},null!=e&&e.isDisabled?Object(j.jsx)(u.EuiCodeBlock,{css:d,language:"sql",fontSize:"m",paddingSize:"m",transparentBackground:!i.length},i):Object(j.jsx)(c.a,{defaultValue:i,onChange:l}))},g=i.a.memo(M)},116:function(e,t,a){"use strict";a.d(t,"a",(function(){return j}));var s=a(11),u=a(8),l=a(2),i=a(4),n=a(9),r=a(62),o=a(65),c=a(17);const j=({withRedirect:e})=>{const t=Object(s.useQueryClient)(),{application:{navigateToApp:a},http:j,notifications:{toasts:d}}=Object(i.e)().services,M=Object(c.a)();return Object(s.useMutation)((e=>j.post("/api/osquery/saved_queries",{version:l.a.public.v1,body:JSON.stringify(e)})),{onError:e=>{M(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:s=>{var l,i;t.invalidateQueries([o.c]),e&&a(n.PLUGIN_ID,{path:r.a.saved_queries()}),d.addSuccess(u.i18n.translate("xpack.osquery.newSavedQuery.successToastMessageText",{defaultMessage:'Successfully saved "{savedQueryId}" query',values:{savedQueryId:null!==(l=null===(i=s.data)||void 0===i?void 0:i.id)&&void 0!==l?l:""}}))}})}},124:function(e,t,a){"use strict";a.d(t,"f",(function(){return y})),a.d(t,"b",(function(){return b})),a.d(t,"a",(function(){return L})),a.d(t,"c",(function(){return T})),a.d(t,"d",(function(){return D})),a.d(t,"e",(function(){return E.a}));var s=a(7),u=a.n(s),l=a(1),i=a.n(l),n=a(8),r=a(5),o=a(16),c=a(14),j=a(61),d=a.n(j),M=a(0);const g=({euiFieldProps:e={}})=>{const{field:{onChange:t,value:a},fieldState:{error:s}}=Object(o.useController)({name:"version",defaultValue:[],rules:{}}),i=Object(l.useCallback)((e=>{const s=[...a,e];t(s)}),[t,a]),j=Object(l.useCallback)((e=>{t(e.map((e=>e.label)))}),[t]),d=Object(l.useMemo)((()=>!(null==s||!s.message)),[null==s?void 0:s.message]);return Object(M.jsx)(r.EuiFormRow,{label:Object(M.jsx)(r.EuiFlexGroup,{gutterSize:"s"},Object(M.jsx)(r.EuiFlexItem,{grow:!1},Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.versionFieldLabel",defaultMessage:"Minimum Osquery version"}))),labelAppend:Object(M.jsx)(r.EuiFlexItem,{grow:!1},Object(M.jsx)(r.EuiText,{size:"xs",color:"subdued"},Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.versionFieldOptionalLabel",defaultMessage:"(optional)"}))),error:null==s?void 0:s.message,isInvalid:d,fullWidth:!0},Object(M.jsx)(r.EuiComboBox,u()({isInvalid:d,noSuggestions:!0,placeholder:n.i18n.translate("xpack.osquery.comboBoxField.placeHolderText",{defaultMessage:'Type and then hit "ENTER"'}),selectedOptions:a.map((e=>({label:e}))),onCreateOption:i,onChange:j,fullWidth:!0,"data-test-subj":"input"},e)))},y=i.a.memo(g,d.a),p=({euiFieldProps:e})=>{const{field:{onChange:t,value:a,name:s},fieldState:{error:i}}=Object(o.useController)({name:"description",defaultValue:""}),c=Object(l.useMemo)((()=>!(null==i||!i.message)),[null==i?void 0:i.message]);return Object(M.jsx)(r.EuiFormRow,{label:n.i18n.translate("xpack.osquery.pack.form.descriptionFieldLabel",{defaultMessage:"Description (optional)"}),error:null==i?void 0:i.message,isInvalid:c,fullWidth:!0},Object(M.jsx)(r.EuiFieldText,u()({isInvalid:c,onChange:t,value:a,name:s,fullWidth:!0,"data-test-subj":"input"},e)))},b=i.a.memo(p),O={required:{message:n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.intervalFieldMinNumberError",{defaultMessage:"A positive interval value is required"}),value:!0},min:{message:n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.intervalFieldMinNumberError",{defaultMessage:"A positive interval value is required"}),value:1},max:{message:n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.intervalFieldMaxNumberError",{defaultMessage:"An interval value must be lower than {than}",values:{than:604800}}),value:604800}},x=({euiFieldProps:e})=>{const{field:{onChange:t,value:a},fieldState:{error:s}}=Object(o.useController)({name:"interval",defaultValue:3600,rules:{...O}}),i=Object(l.useCallback)((e=>{const a=e.target.valueAsNumber?e.target.valueAsNumber:0;t(a)}),[t]),c=Object(l.useMemo)((()=>!(null==s||!s.message)),[null==s?void 0:s.message]);return Object(M.jsx)(r.EuiFormRow,{label:n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.intervalFieldLabel",{defaultMessage:"Interval (s)"}),error:null==s?void 0:s.message,isInvalid:c,fullWidth:!0},Object(M.jsx)(r.EuiFieldNumber,u()({isInvalid:c,value:a,onChange:i,fullWidth:!0,type:"number","data-test-subj":"osquery-interval-field"},e)))},L=i.a.memo(x,d.a),N=/^(?![0-9]+$)[a-zA-Z0-9-_]+$/,m=({idSet:e,euiFieldProps:t})=>{const{field:{onChange:a,value:s,name:i},fieldState:{error:c}}=Object(o.useController)({name:"id",defaultValue:"",rules:e&&(d=e,{required:{message:n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.emptyIdError",{defaultMessage:"ID is required"}),value:!0},validate:e=>{const t=(e=>{if(!N.test(e))return n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.invalidIdError",{defaultMessage:"Characters must be alphanumeric, _, or -"})})(e),a=(e=>t=>{if(e.has(t))return n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.uniqueIdError",{defaultMessage:"ID must be unique"})})(d)(e);return t||a}})}),j=Object(l.useMemo)((()=>!(null==c||!c.message)),[null==c?void 0:c.message]);var d;return Object(M.jsx)(r.EuiFormRow,{label:n.i18n.translate("xpack.osquery.pack.queryFlyoutForm.idFieldLabel",{defaultMessage:"ID"}),error:null==c?void 0:c.message,isInvalid:j,fullWidth:!0},Object(M.jsx)(r.EuiFieldText,u()({isInvalid:j,onChange:a,value:s,name:i,fullWidth:!0,"data-test-subj":"input"},t)))},T=i.a.memo(m,d.a),v={value:"snapshot",inputDisplay:Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.resultsTypeField.snapshotValueLabel",defaultMessage:"Snapshot"})},I={value:"differential",inputDisplay:Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.resultsTypeField.differentialValueLabel",defaultMessage:"Differential"})},f={value:"added_only",inputDisplay:Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.resultsTypeField.differentialAddedOnlyValueLabel",defaultMessage:"Differential (Ignore removals)"})},A=[v,I,f],S=({euiFieldProps:e={}})=>{const[t,a]=Object(l.useState)(v.value),{defaultValues:s}=Object(o.useFormState)(),{field:{onChange:i,value:j}}=Object(o.useController)({name:"snapshot",defaultValue:null==s?void 0:s.snapshot}),{field:{onChange:d,value:g}}=Object(o.useController)({name:"removed",defaultValue:null==s?void 0:s.removed}),y=Object(l.useCallback)((e=>{e===v.value&&(i(!0),d(!1)),e===I.value&&(i(!1),d(!0)),e===f.value&&(i(!1),d(!1))}),[d,i]);return Object(l.useEffect)((()=>{a((()=>j?v.value:!j&&g?I.value:j||g?v.value:f.value))}),[g,j]),Object(M.jsx)(r.EuiFormRow,{label:Object(M.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"flexEnd"},Object(M.jsx)(r.EuiFlexItem,{grow:!1},Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.resultTypeFieldLabel",defaultMessage:"Result type"})),Object(M.jsx)(r.EuiFlexItem,{grow:!1},Object(M.jsx)(r.EuiBetaBadge,{label:n.i18n.translate("xpack.osquery.betaBadgeLabel",{defaultMessage:"Beta"}),size:"s"}))),labelAppend:Object(M.jsx)(r.EuiFlexItem,{grow:!1},Object(M.jsx)(r.EuiText,{size:"xs",color:"subdued"},Object(M.jsx)(c.FormattedMessage,{id:"xpack.osquery.queryFlyoutForm.fieldOptionalLabel",defaultMessage:"(optional)"}))),fullWidth:!0},Object(M.jsx)(r.EuiSuperSelect,u()({"data-test-subj":"resultsTypeField",options:A,fullWidth:!0,valueOfSelected:t,onChange:y},e)))},D=i.a.memo(S,d.a);var E=a(87)},125:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"c",(function(){return m})),a.d(t,"d",(function(){return v})),a.d(t,"b",(function(){return I}));var s=a(5),u=a(16),l=a(1),i=a.n(l),n=a(14),r=a(76),o=a(101),c=a(116),j=a(0);const d={style:"z-index: 6000"},M=({defaultValue:e,onClose:t,isExternal:a})=>{const i=Object(c.a)({withRedirect:!1}),M=Object(r.b)({defaultValue:e}),{serializer:g,idSet:y,handleSubmit:p,formState:{isSubmitting:b}}=M,O=Object(l.useCallback)((async e=>{const a=g(e);await i.mutateAsync(a).then((()=>t()))}),[i,t,g]);return Object(j.jsx)(s.EuiPortal,null,Object(j.jsx)(s.EuiFlyout,{"data-test-subj":"osquery-save-query-flyout",size:"m",ownFocus:!0,onClose:t,"aria-labelledby":"flyoutTitle",maskProps:a?d:void 0},Object(j.jsx)(s.EuiFlyoutHeader,{hasBorder:!0},Object(j.jsx)(s.EuiTitle,{size:"s"},Object(j.jsx)("h2",{id:"flyoutTitle"},Object(j.jsx)(n.FormattedMessage,{id:"xpack.osquery.savedQuery.saveQueryFlyoutForm.addFormTitle",defaultMessage:"Save query"})))),Object(j.jsx)(s.EuiFlyoutBody,null,Object(j.jsx)(u.FormProvider,M,Object(j.jsx)(o.a,{idSet:y}))),Object(j.jsx)(s.EuiFlyoutFooter,null,Object(j.jsx)(s.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(j.jsx)(s.EuiFlexItem,{grow:!1},Object(j.jsx)(s.EuiButtonEmpty,{iconType:"cross",onClick:t,flush:"left"},Object(j.jsx)(n.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.cancelButtonLabel",defaultMessage:"Cancel"}))),Object(j.jsx)(s.EuiFlexItem,{grow:!1},Object(j.jsx)(s.EuiButton,{"data-test-subj":"savedQueryFlyoutSaveButton",isLoading:b,onClick:p(O),fill:!0},Object(j.jsx)(n.FormattedMessage,{id:"xpack.osquery.pack.queryFlyoutForm.saveButtonLabel",defaultMessage:"Save"})))))))},g=i.a.memo(M);var y=a(11),p=a(2),b=a(9),O=a(4),x=a(62),L=a(17),N=a(65);const m=({savedQueryId:e})=>{const{application:{navigateToApp:t},http:a}=Object(O.e)().services,s=Object(L.a)();return Object(y.useQuery)([N.d,{savedQueryId:e}],(()=>a.get(`/api/osquery/saved_queries/${e}`,{version:p.a.public.v1})),{keepPreviousData:!0,refetchOnWindowFocus:!1,select:e=>e.data,onSuccess:e=>{e.error&&(s(e.error,{title:e.error.error,toastMessage:e.error.message}),t(b.PLUGIN_ID,{path:x.a.saved_queries()}))},onError:e=>{s(e,{title:e.body.error,toastMessage:e.body.message})}})};a(73);var T=a(8);const v=({savedQueryId:e})=>{const t=Object(y.useQueryClient)(),{application:{navigateToApp:a},notifications:{toasts:s},http:u}=Object(O.e)().services,l=Object(L.a)();return Object(y.useMutation)((t=>u.put(`/api/osquery/saved_queries/${e}`,{version:p.a.public.v1,body:JSON.stringify(t)})),{onError:e=>{l(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:u=>{var l;t.invalidateQueries([N.c]),t.invalidateQueries([N.d,{savedQueryId:e}]),a(b.PLUGIN_ID,{path:x.a.saved_queries()}),s.addSuccess(T.i18n.translate("xpack.osquery.editSavedQuery.successToastMessageText",{defaultMessage:'Successfully updated "{savedQueryName}" query',values:{savedQueryName:null!==(l=u.data.id)&&void 0!==l?l:""}}))}})},I=({savedQueryId:e})=>{const t=Object(y.useQueryClient)(),{application:{navigateToApp:a},http:s,notifications:{toasts:u}}=Object(O.e)().services,l=Object(L.a)();return Object(y.useMutation)((()=>s.delete(`/api/osquery/saved_queries/${e}`,{version:p.a.public.v1})),{onError:e=>{l(e,{title:e.body.error,toastMessage:e.body.message})},onSuccess:()=>{t.invalidateQueries([N.c]),a(b.PLUGIN_ID,{path:x.a.saved_queries()}),u.addSuccess(T.i18n.translate("xpack.osquery.editSavedQuery.deleteSuccessToastMessageText",{defaultMessage:"Successfully deleted saved query"}))}})}},152:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMDQuOTk4IDMwNC45OTgiPjxwYXRoIGQ9Ik0yNzQuNjU5IDI0NC44ODhjLTguOTQ0LTMuNjYzLTEyLjc3LTguNTI0LTEyLjQtMTUuNzc3LjM4MS04LjQ2Ni00LjQyMi0xNC42NjctNi43MDMtMTcuMTE3IDEuMzc4LTUuMjY0IDUuNDA1LTIzLjQ3NC4wMDQtMzkuMjkxLTUuODA0LTE2LjkzLTIzLjUyNC00Mi43ODctNDEuODA4LTY4LjIwNC03LjQ4NS0xMC40MzgtNy44MzktMjEuNzg0LTguMjQ4LTM0LjkyMi0uMzkyLTEyLjUzMS0uODM0LTI2LjczNS03LjgyMi00Mi41MjVDMTkwLjA4NCA5Ljg1OSAxNzQuODM4IDAgMTU1Ljg1MSAwYy0xMS4yOTUgMC0yMi44ODkgMy41My0zMS44MTEgOS42ODQtMTguMjcgMTIuNjA5LTE1Ljg1NSA0MC4xLTE0LjI1NyA1OC4yOTEuMjE5IDIuNDkxLjQyNSA0Ljg0NC41NDUgNi44NTMgMS4wNjQgMTcuODE2LjA5NiAyNy4yMDYtMS4xNyAzMC4wNi0uODE5IDEuODY1LTQuODUxIDcuMTczLTkuMTE4IDEyLjc5My00LjQxMyA1LjgxMi05LjQxNiAxMi40LTEzLjUxNyAxOC41MzktNC44OTMgNy4zODctOC44NDMgMTguNjc4LTEyLjY2MyAyOS41OTctMi43OTUgNy45OS01LjQzNSAxNS41MzctOC4wMDUgMjAuMDQ3YTI3LjI5NiAyNy4yOTYgMCAwMC0yLjY0NyAyMC41MDVjLTEuODQ0IDEuMjgxLTQuNTA4IDMuODAzLTYuNzU3IDguNTU3LTIuNzE4IDUuOC04LjIzMyA4LjkxNy0xOS43MDEgMTEuMTIyLTUuMjcgMS4wNzgtOC45MDQgMy4yOTQtMTAuODA0IDYuNTg2LTIuNzY1IDQuNzkxLTEuMjU5IDEwLjgxMS4xMTUgMTQuOTI1IDIuMDMgNi4wNDguNzY1IDkuODc2LTEuNTM1IDE2LjgyNi0uNTMgMS42MDQtMS4xMzEgMy40Mi0xLjc0IDUuNDIzLS45NTkgMy4xNjEtLjYxMyA2LjAzNSAxLjAyNiA4LjU0MiA0LjMzMSA2LjYyMSAxNi45NjkgOC45NTYgMjkuOTc5IDEwLjQ5MiA3Ljc2OC45MjIgMTYuMjcgNC4wMjkgMjQuNDkzIDcuMDM1IDguMDU3IDIuOTQ0IDE2LjM4OCA1Ljk4OSAyMy45NjEgNi45MTMgMS4xNTEuMTQ1IDIuMjkxLjIxOCAzLjM5LjIxOCAxMS40MzQgMCAxNi42LTcuNTg3IDE4LjIzOC0xMC43MDQgNC4xMDctLjgzOCAxOC4yNzItMy41MjIgMzIuODcxLTMuODgyIDE0LjU3Ni0uNDE2IDI4LjY3OSAyLjQ2MiAzMi42NzQgMy4zNTcgMS4yNTYgMi40MDQgNC41NjcgNy44OTUgOS44NDUgMTAuNzI0IDIuOTAxIDEuNTg2IDYuOTM4IDIuNDk1IDExLjA3MyAyLjQ5NWguMDAxYzQuNDE2IDAgMTIuODE3LTEuMDQ0IDE5LjQ2Ni04LjAzOSA2LjYzMi03LjAyOCAyMy4yMDItMTYgMzUuMzAyLTIyLjU1MWE3MTcuODcgNzE3Ljg3IDAgMDA3LjQ0MS00LjA2NWM2Ljc5Ny0zLjc2OCAxMC41MDYtOS4xNTIgMTAuMTc1LTE0Ljc3MS0uMjc2LTQuNjY3LTMuMzY1LTguNzYxLTguMDYyLTEwLjY4NHptLTE1MC40Ny0xLjM1M2MtLjg0Ni01Ljk2LTguNTEzLTExLjg3MS0xNy4zOTItMTguNzE1LTcuMjYtNS41OTctMTUuNDg5LTExLjk0LTE3Ljc1Ni0xNy4zMTItNC42ODUtMTEuMDgyLS45OTItMzAuNTY4IDUuNDQ3LTQwLjYwMiAzLjE4Mi01LjAyNCA1Ljc4MS0xMi42NDMgOC4yOTUtMjAuMDExIDIuNzE0LTcuOTU2IDUuNTIxLTE2LjE4MiA4LjY2LTE5Ljc4MyA0Ljk3MS01LjYyMiA5LjU2NS0xNi41NjEgMTAuMzc5LTI1LjE4MiA0LjY1NSA0LjQ0NCAxMS44NzYgMTAuMDgzIDE4LjU0NyAxMC4wODMgMS4wMjcgMCAyLjAyNC0uMTM0IDIuOTc3LS40MDMgNC41NjQtMS4zMTggMTEuMjc3LTUuMTk3IDE3Ljc2OS04Ljk0NyA1LjU5Ny0zLjIzNCAxMi40OTktNy4yMjIgMTUuMDk2LTcuNTg1IDQuNDUzIDYuMzk0IDMwLjMyOCA2My42NTUgMzIuOTcyIDgyLjA0NCAyLjA5MiAxNC41NS0uMTE4IDI2LjU3OC0xLjIyOSAzMS4yODlhMjMuMDE3IDIzLjAxNyAwIDAwLTMuMDgtLjIyMWMtNy4yMDcgMC05LjExNSAzLjkzNC05LjYxMiA2LjI4My0xLjI3OCA2LjEwMy0xLjQxMyAyNS42MTgtMS40MjcgMzAuMDAzLTIuNjA2IDMuMzExLTE1Ljc4NSAxOC45MDMtMzQuNzA2IDIxLjcwNi03LjcwNyAxLjEyLTE0LjkwNCAxLjY4OC0yMS4zOSAxLjY4OC01LjU0NCAwLTkuMDgyLS40MjgtMTAuNTUxLS42NTFsLTkuNTA4LTEwLjg3OWMzLjc0OS0xLjg1MSA3LjQ5Ny01Ljc1NyA2LjUwOS0xMi44MDV6bTEyLjA2NS0xNzkuMzg2Yy0uMjk3LjEyOC0uNTg5LjI2NS0uODc2LjQxMWExNy43MTMgMTcuNzEzIDAgMDAtLjE5OS0xLjk1MmMtMS4wMzgtNS45NzUtNS0xMC4zMTItOS40MTktMTAuMzEyLS4zMjcgMC0uNjU2LjAyNS0xLjAxNy4wOC0yLjYyOS40MzgtNC42OTEgMi40MTMtNS44MjEgNS4yMTMuOTkxLTYuMTQ0IDQuNDcyLTEwLjY5MyA4LjYwMi0xMC42OTMgNC44NSAwIDguOTQ3IDYuNTM2IDguOTQ3IDE0LjI3MiAwIC45NzUtLjA3MSAxLjk0NS0uMjE3IDIuOTgxem0zNy42ODYgNC42MDdjLjQ0NC0xLjQxNC42ODQtMi45NDQuNjg0LTQuNTMyIDAtNy4wMTQtNC40NS0xMi41MDktMTAuMTMxLTEyLjUwOS01LjU1MiAwLTEwLjA2OSA1LjYxMS0xMC4wNjkgMTIuNTA5IDAgLjQ3LjAyMy45NDEuMDY3IDEuNDExbC0uODYxLS4zMjlhMTkuMTI1IDE5LjEyNSAwIDAxLS45NjItNi4wMTVjMC04LjM4NyA1LjM2LTE1LjIxMSAxMS45NS0xNS4yMTEgNi41ODkgMCAxMS45NSA2LjgyNCAxMS45NSAxNS4yMTEgMCAzLjQ4OS0uOTYzIDYuODE5LTIuNjI4IDkuNDY1em0tNC44NTkgMTYuMzI0Yy0uMDk1LjQyNC0uMjk3LjYxMi0yLjUzMSAxLjc3NC0xLjEyOC41ODctMi41MzIgMS4zMTgtNC4yODkgMi4zODhsLTEuMTc0LjcxMWMtNC43MTggMi44Ni0xNS43NjUgOS41NTktMTguNzY0IDkuOTUyLTIuMDM3LjI3NC0zLjI5Ny0uNTE2LTYuMTMtMi40NDFhODguNDQxIDg4LjQ0MSAwIDAwLTIuMDQ0LTEuMzYyYy01LjEwNy0zLjM1MS04LjM5Mi03LjA0Mi04Ljc2My04LjQ4NSAxLjY2NS0xLjI4NyA1Ljc5Mi00LjUwOCA3LjkwNS02LjQxNSA0LjI4OS0zLjk4OCA4LjYwNS02LjY2OCAxMC43NDEtNi42NjguMTEzIDAgLjIxNS4wMDguMzIxLjAyOCAyLjUxLjQ0MyA4LjcwMSAyLjkxNCAxMy4yMjMgNC43MTggMi4wOS44MzQgMy44OTUgMS41NTQgNS4xNjUgMi4wMSA0LjAwMSAxLjM3NCA2LjA4NyAzLjEzMiA2LjM0IDMuNzl6bTM1Ljk0NyAxODYuMzdjMi4yNTctMTAuMTgxIDQuODU3LTI0LjAzMSA0LjQzNi0zMi4xOTYtLjA5Ny0xLjg1NS0uMjYxLTMuODc0LS40Mi01LjgyNi0uMjk3LTMuNjUtLjczOC05LjA3NS0uMjgzLTEwLjY4NC4wOS0uMDQyLjE5LS4wNzguMzAxLS4xMDkuMDE5IDQuNjY4IDEuMDMzIDEzLjk3OSA4LjQ3OSAxNy4yMjYgMi4yMTkuOTY4IDQuNzU1IDEuNDU4IDcuNTM3IDEuNDU4IDcuNDU5IDAgMTUuNzM1LTMuNjU5IDE5LjEyNS03LjA0OSAxLjk5Ni0xLjk5NiAzLjY3NS00LjQzOCA0Ljg1MS02LjM3Mi4yNTcuNzUzLjQxNSAxLjczNy4zMzIgMy4wMDUtLjQ0MyA2Ljg4NSAyLjkwMyAxNi4wMTkgOS4yNzEgMTkuMzg1bC45MjcuNDg3YzIuMjY4IDEuMTkgOC4yOTIgNC4zNTMgOC4zODkgNS44NTMtLjAwMS4wMDEtLjA1MS4xNzctLjM4Ny40ODktMS41MDkgMS4zNzktNi44MiA0LjA5MS0xMS45NTYgNi43MTQtOS4xMTEgNC42NTItMTkuNDM4IDkuOTI1LTI0LjA3NiAxNC44MDMtNi41MyA2Ljg3Mi0xMy45MTYgMTEuNDg4LTE4LjM3NiAxMS40ODhhNC44MyA0LjgzIDAgMDEtMS40NjEtLjIwNmMtNC44NDQtMS41MS04LjgzMS04LjQ5OS02LjY4OS0xOC40NjZ6TTM5LjkxNyAyNDUuNDc3Yy0uNDk0LTIuMzEyLS44ODQtNC4xMzctLjQ2NS01LjkwNS4zMDQtMS4zMSA2Ljc3MS0yLjcxNCA5LjUzMy0zLjMxMyAzLjg4My0uODQzIDcuODk5LTEuNzE0IDEwLjUyNS0zLjMwOCAzLjU1MS0yLjE1MSA1LjQ3NC02LjExOCA3LjE3LTkuNjE4IDEuMjI4LTIuNTMxIDIuNDk2LTUuMTQ4IDQuMDA1LTYuMDA3LjA4NS0uMDUuMjE1LS4xMDguNDYzLS4xMDggMi44MjcgMCA4Ljc1OSA1Ljk0MyAxMi4xNzcgMTEuMjYyLjg2NyAxLjM0MSAyLjQ3MyA0LjAyOCA0LjMzMSA3LjEzOSA1LjU1NyA5LjI5OCAxMy4xNjYgMjIuMDMzIDE3LjE0IDI2LjMwMSAzLjU4MSAzLjgzNyA5LjM3OCAxMS4yMTQgNy45NTIgMTcuNTQxLTEuMDQ0IDQuOTA5LTYuNjAyIDguOTAxLTcuOTEzIDkuNzg0LS40NzYuMTA4LTEuMDY1LjE2My0xLjc1OC4xNjMtNy42MDYgMC0yMi42NjItNi4zMjgtMzAuNzUxLTkuNzI4bC0xLjE5Ny0uNTAzYy00LjUxNy0xLjg5NC0xMS44OTEtMy4wODctMTkuMDIyLTQuMjQxLTUuNjc0LS45MTktMTMuNDQ0LTIuMTc2LTE0LjczMi0zLjMxMi0xLjA0NC0xLjE3MS4xNjctNC45NzggMS4yMzUtOC4zMzcuNzY5LTIuNDE0IDEuNTYzLTQuOTEgMS45OTgtNy41MjMuNjE3LTQuMTY4LS4xMDktNy41NjEtLjY5MS0xMC4yODd6Ii8+PC9zdmc+"},153:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIGltYWdlLXJlbmRlcmluZz0ib3B0aW1pemVRdWFsaXR5IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgdmlld0JveD0iMCAwIDY0MCA2NDAiPjxwYXRoIGQ9Ik0uMiAyOTguNjY5TDAgOTAuNjE1bDI1Ni4wMDctMzQuNzZ2MjQyLjgxNEguMjAxek0yOTguNjU4IDQ5LjY1NEw2MzkuOTA1LS4wMTJ2Mjk4LjY4MUgyOTguNjU3VjQ5LjY1NHpNNjQwIDM0MS4zMzFsLS4wNzEgMjk4LjY4MUwyOTguNjY5IDU5MlYzNDEuMzMyaDM0MS4zM3pNMjU1Ljk4MyA1ODYuNTQzTC4xODkgNTUxLjQ2M3YtMjEwLjE4aDI1NS43OTR2MjQ1LjI2eiIvPjwvc3ZnPg=="},154:function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgc2hhcGUtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIHRleHQtcmVuZGVyaW5nPSJnZW9tZXRyaWNQcmVjaXNpb24iIGltYWdlLXJlbmRlcmluZz0ib3B0aW1pemVRdWFsaXR5IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgdmlld0JveD0iMCAwIDY0MCA2NDAiPjxwYXRoIGQ9Ik00OTQuNzgyIDM0MC4wMmMtLjgwMy04MS4wMjUgNjYuMDg0LTExOS45MDcgNjkuMDcyLTEyMS44MzItMzcuNTk1LTU0Ljk5My05Ni4xNjctNjIuNTUyLTExNy4wMzctNjMuNDAyLTQ5Ljg0My01LjAzMi05Ny4yNDIgMjkuMzYyLTEyMi41NjUgMjkuMzYyLTI1LjI1MyAwLTY0LjI3Ny0yOC42MDctMTA1LjYwNC0yNy44NS01NC4zMi44MDMtMTA0LjQgMzEuNTk0LTEzMi40MDMgODAuMjQ1QzI5LjgxIDMzNC40NTcgNzEuODEgNDc5LjU4IDEyNi44MTYgNTU4Ljk3NmMyNi44NyAzOC44ODIgNTguOTE0IDgyLjU2IDEwMC45OTcgODEgNDAuNTEyLTEuNTk0IDU1Ljg0My0yNi4yNDQgMTA0Ljg0OC0yNi4yNDQgNDguOTkzIDAgNjIuNzUzIDI2LjI0NSAxMDUuNjQgMjUuNDA2IDQzLjYwNi0uODAzIDcxLjIzMi0zOS42MzggOTcuOTI1LTc4LjY1IDMwLjg4Ny00NS4xMiA0My41NDgtODguNzUgNDQuMzE2LTkwLjk5NC0uOTY5LS40MzctODUuMDI5LTMyLjYzNC04NS44NzktMTI5LjQzOWwuMTE4LS4wMzV6TTQxNC4yMyAxMDIuMTc4QzQzNi41NTMgNzUuMDk1IDQ1MS42MzYgMzcuNSA0NDcuNTE0LS4wMjRjLTMyLjE2MiAxLjMxMS03MS4xNjMgMjEuNDM3LTk0LjI1MyA0OC40ODUtMjAuNzI5IDI0LjAxMi0zOC44MzYgNjIuMjgtMzMuOTkzIDk5LjAzNiAzNS45MTggMi44IDcyLjU5MS0xOC4yNDggOTQuOTI2LTQ1LjI3MmwuMDM2LS4wNDd6Ii8+PC9zdmc+"},62:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={base:()=>"/",overview:()=>"/",live_queries:()=>"/live_queries",live_query_new:()=>"/live_queries/new",live_query_details:({liveQueryId:e})=>`/live_queries/${e}`,saved_queries:()=>"/saved_queries",saved_query_new:()=>"/saved_queries/new",saved_query_edit:({savedQueryId:e})=>`/saved_queries/${e}`,packs:()=>"/packs",pack_add:()=>"/packs/add",pack_details:({packId:e})=>`/packs/${e}`,pack_edit:({packId:e})=>`/packs/${e}/edit`}},63:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var s=a(7),u=a.n(s),l=a(1),i=a.n(l),n=a(5),r=a(29),o=a.n(r),c=a(0);const j=e=>Object(c.jsx)(n.EuiIcon,u()({size:"xl",type:o.a},e)),d=i.a.memo(j)},66:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));const s={overflow:"hidden"}},67:function(e,t,a){"use strict";a.d(t,"h",(function(){return u})),a.d(t,"d",(function(){return l})),a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"f",(function(){return o})),a.d(t,"g",(function(){return c})),a.d(t,"e",(function(){return j}));var s=a(8);const u=e=>0===e?"":1===e?s.i18n.translate("xpack.osquery.agents.oneSelectedAgentText",{defaultMessage:"{numAgents} agent selected.",values:{numAgents:e}}):s.i18n.translate("xpack.osquery.agents.mulitpleSelectedAgentsText",{defaultMessage:"{numAgents} agents selected.",values:{numAgents:e}}),l=s.i18n.translate("xpack.osquery.agents.allAgentsLabel",{defaultMessage:"All agents"}),i=s.i18n.translate("xpack.osquery.agents.platformLabel",{defaultMessage:"Platform"}),n=s.i18n.translate("xpack.osquery.agents.policyLabel",{defaultMessage:"Policy"}),r=(s.i18n.translate("xpack.osquery.agents.agent",{defaultMessage:"Agent"}),s.i18n.translate("xpack.osquery.agents.selectionLabel",{defaultMessage:"Agents"})),o=s.i18n.translate("xpack.osquery.agents.noAgentAvailableTitle",{defaultMessage:"No agents available"}),c=(s.i18n.translate("xpack.osquery.agents.query",{defaultMessage:"Query"}),s.i18n.translate("xpack.osquery.agents.selectAgentLabel",{defaultMessage:"Select agents or groups to query"})),j=(s.i18n.translate("xpack.osquery.agents.errorSearchDescription",{defaultMessage:"An error has occurred on all agents search"}),s.i18n.translate("xpack.osquery.agents.failSearchDescription",{defaultMessage:"Failed to fetch agents"}),s.i18n.translate("xpack.osquery.agent.attachedQuery",{defaultMessage:"attached query"}))},74:function(e,t,a){"use strict";var s=a(90);a.d(t,"a",(function(){return s.a}));var u=a(91);a.d(t,"b",(function(){return u.a}))},76:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return j}));var s=a(16),u=a(15),l=a(49),i=a.n(l),n=a(1),r=a(2),o=a(73);const c=e=>i()(e,(e=>(Object(u.isArray)(e.version)&&(e.version.length?e.version=e.version[0]:e.version=""),Object(u.isArray)(e.platform)&&!e.platform.length&&delete e.platform,e.interval&&(e.interval=e.interval+""),e))),j=({defaultValue:e})=>{const{data:t}=Object(o.a)({}),a=Object(n.useMemo)((()=>{var e;return null!==(e=Object(u.map)(null==t?void 0:t.data,"id"))&&void 0!==e?e:[]}),[t]),l=Object(n.useMemo)((()=>{const t=new Set(a);return e&&e.id&&t.delete(e.id),t}),[a,e]);return{serializer:c,idSet:l,...Object(s.useForm)({defaultValues:e?(i=e,{id:i.id,description:i.description,query:i.query,interval:i.interval?parseInt(i.interval,10):3600,timeout:null!==(j=i.timeout)&&void 0!==j?j:r.g.DEFAULT,snapshot:null===(d=i.snapshot)||void 0===d||d,removed:null!==(M=i.removed)&&void 0!==M&&M,platform:i.platform,version:i.version?[i.version]:[],ecs_mapping:Object(u.isEmpty)(i.ecs_mapping)?{}:i.ecs_mapping}):{id:"",query:"",interval:3600,timeout:r.g.DEFAULT,ecs_mapping:{},snapshot:!0}})};var i,j,d,M}},90:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(15),u=a(11),l=a(8),i=a(2),n=a(4),r=a(17);const o=()=>{const{http:e}=Object(n.e)().services,t=Object(r.a)();return Object(u.useQuery)(["agentPolicies"],(()=>e.get("/internal/osquery/fleet_wrapper/agent_policies",{version:i.a.internal.v1})),{initialData:[],keepPreviousData:!0,select:e=>({agentPoliciesById:Object(s.mapKeys)(e,"id"),agentPolicies:e}),onSuccess:()=>t(),onError:e=>t(e,{title:l.i18n.translate("xpack.osquery.agent_policies.fetchError",{defaultMessage:"Error while fetching agent policies"})})})}},91:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(11),u=a(8),l=a(2),i=a(4),n=a(17);const r=({policyId:e,skip:t,silent:a})=>{const{http:r}=Object(i.e)().services,o=Object(n.a)();return Object(s.useQuery)(["agentPolicy",{policyId:e}],(()=>r.get(`/internal/osquery/fleet_wrapper/agent_policies/${e}`,{version:l.a.internal.v1})),{enabled:!(!e||t),keepPreviousData:!0,select:e=>e.item,onSuccess:()=>o(),onError:e=>!a&&o(e,{title:u.i18n.translate("xpack.osquery.agent_policy_details.fetchError",{defaultMessage:"Error while fetching agent policy details"})})})}},99:function(e,t,a){"use strict";a.d(t,"a",(function(){return J}));var s=a(15),u=a(5),l=a(1),i=a.n(l),n=a(14);const r=/\{{([^}]+)\}}/g,o=(e,t)=>{if(!c(e))return{result:e,skipped:!1};const a=e.match(new RegExp(r));let u=e;a&&Object(s.each)(a,(e=>{const a=e.replace(/{{|}}/g,"").trim();if(u.includes(e)){const l=Object(s.get)(t,a);l&&(u=u.replace(e,l))}}));const l=new RegExp(r).test(u);return{result:u,skipped:l}},c=e=>new RegExp(r).test(e);var j=a(22),d=a(16),M=a(2),g=a(9),y=a(102),p=a(4),b=a(123),O=a(125),x=a(70),L=a(11),N=a(17),m=a(72),T=a(117),v=a(8),I=a(42),f=a(61),A=a.n(f),S=a(77),D=a.n(S);var E=a(13),k=a.n(E);let z;!function(e){e[e.All=0]="All",e[e.Platform=1]="Platform",e[e.Policy=2]="Policy",e[e.Agent=3]="Agent"}(z||(z={}));const C=e=>{const t={agents:[],allAgentsSelected:!1,platformsSelected:[],policiesSelected:[],offlineAgentsSelected:!1},a=[],s={policy:{},platform:{}};for(const r of e){var u,l,i,n;const e=null===(u=r.value)||void 0===u?void 0:u.groupType,o=null!==(l=null!==(i=r.key)&&void 0!==i?i:null===(n=r.value)||void 0===n?void 0:n.id)&&void 0!==l?l:r.label;let c;switch(e){case z.All:t.allAgentsSelected=!0;break;case z.Platform:c=r.value,t.allAgentsSelected||(s.platform[o]=c.size),t.platformsSelected.push(o);break;case z.Policy:c=r.value,t.allAgentsSelected||(s.policy[o]=c.size),t.policiesSelected.push(o);break;case z.Agent:c=r.value,t.allAgentsSelected||a.push(c),t.agents.push(o),r.disabled&&(t.offlineAgentsSelected=!0);break;default:console.error(`unknown group type ${e}`)}}return{newAgentSelection:t,selectedGroups:s,selectedAgents:a}};var F=a(67);const h=(()=>{const e=Object(u.euiPaletteColorBlindBehindText)(),t=new Map;return a=>(t.has(a)||t.set(a,e[t.size]),t.get(a))})(),Q=(e,t)=>({label:e,groupType:t,color:h(t),size:0,data:[]}),q=(e,t,a)=>({label:e,options:a.map((e=>{var a,s;return{disabled:"online"!==e.status,label:`${e.local_metadata.host.hostname} (${e.local_metadata.elastic.agent.id})`,key:e.local_metadata.elastic.agent.id,color:"online"!==e.status?"danger":h(t),value:{groupType:t,groups:{policy:null!==(a=e.policy_id)&&void 0!==a?a:"",platform:e.local_metadata.os.platform},id:e.local_metadata.elastic.agent.id,status:null!==(s=e.status)&&void 0!==s?s:"unknown"}}}))}),w=(e,t,a)=>({label:e,options:a.map((({name:e,id:a,size:s})=>({label:e!==a?`${e} (${a})`:e,key:a,color:h(t),value:{groupType:t,id:a,size:s}})))});class agent_grouper_AgentGrouper{constructor(){k()(this,"groupOrder",[z.All,z.Platform,z.Policy,z.Agent]),k()(this,"groups",{[z.All]:Q(F.d,z.All),[z.Platform]:Q(F.a,z.Platform),[z.Policy]:Q(F.b,z.Policy),[z.Agent]:Q(F.c,z.Agent)})}updateGroup(e,t,a=!1){if(null==t||!t.length||e===z.All)return;const s=this.groups[e];a?s.data.push(...t):s.data=t,s.size=t.length}setTotalAgents(e){e<0||(this.groups[z.All].size=e)}generateOptions(){const e=[];for(const t of this.groupOrder){const{label:a,size:s,groupType:u,data:l,color:i}=this.groups[t];if(0!==s)switch(t){case z.All:e.push({label:a,options:[{label:a,value:{groupType:u,size:s},color:i}]});break;case z.Platform:case z.Policy:e.push(w(a,t,l));break;case z.Agent:e.push(q(a,t,l))}}return e}}var Y=a(0);const U=({agentSelection:e,onChange:t,error:a})=>{var r;const{docLinks:o}=Object(p.e)().services,[c,j]=Object(l.useState)(""),[d,g]=Object(l.useState)(!1),[y,b]=Object(l.useState)("");D()((()=>{b(c),g(!1)}),300,[c]);const{isLoading:O,isRefetching:x,data:m,isFetched:T}=((e="",t={perPage:9e3})=>{const{perPage:a,agentIds:u}=t,{http:l}=Object(p.e)().services,i=Object(N.a)(),{data:n,isFetched:r}=(()=>{const{http:e}=Object(p.e)().services,t=Object(N.a)();return Object(L.useQuery)(["osqueryPolicies"],(()=>e.get("/internal/osquery/fleet_wrapper/package_policies",{version:M.a.internal.v1})),{select:e=>Object(s.uniq)(e.items.map((e=>e.policy_id))),onSuccess:()=>t(),onError:e=>t(e,{title:v.i18n.translate("xpack.osquery.osquery_policies.fetchError",{defaultMessage:"Error while fetching osquery policies"})})})})();return Object(L.useQuery)({queryKey:["agents",n,e,a,u],queryFn:()=>{let t="";return null!=n&&n.length&&(t=`(${n.map((e=>`policy_id:${e}`)).join(" or ")})`,t+=e?` and (local_metadata.host.hostname.keyword:*${e}* or local_metadata.elastic.agent.id:*${e}*)`:` and (status:online ${null!=u&&u.length?`or local_metadata.elastic.agent.id:(${u.join(" or ")})`:""})`),l.get("/internal/osquery/fleet_wrapper/agents",{version:M.a.internal.v1,query:{kuery:t,perPage:a}})},enabled:r&&!(null==n||!n.length),onSuccess:()=>i(),onError:e=>{var t;return i(null==e?void 0:e.body,{title:v.i18n.translate("xpack.osquery.agents.fetchError",{defaultMessage:"Error while fetching agents"}),toastMessage:null==e||null===(t=e.body)||void 0===t?void 0:t.error})}})})(y,{perPage:10,agentIds:null==e?void 0:e.agents}),[f,S]=Object(l.useState)([]),[E,k]=Object(l.useState)([]),h=Object(l.useRef)(!1),Q=Object(l.useMemo)((()=>{const{newAgentSelection:e,selectedAgents:t,selectedGroups:a}=C(E);var s;if(e.allAgentsSelected)return null!==(s=null==m?void 0:m.total)&&void 0!==s?s:0;{var u,l;const e=(e=>({groups:t})=>Object.keys(t).map((a=>e[a][t[a]])).every((e=>!e)))(a);return t.filter(e).length+(e=>{let t=0;return Object.keys(e).forEach((a=>{const s=e[a];t+=Object.keys(s).reduce(((e,t)=>e+s[t]),0)})),t})(a)-(({policy:e={},platform:t={}},a)=>{let s=0;return Object.keys(t).forEach((t=>{var u;const l=null!==(u=a[t])&&void 0!==u?u:{};Object.keys(e).forEach((e=>{var t;s+=null!==(t=l[e])&&void 0!==t?t:0}))})),s})(a,null!==(u=null==m||null===(l=m.groups)||void 0===l?void 0:l.overlap)&&void 0!==u?u:{})}}),[null==m||null===(r=m.groups)||void 0===r?void 0:r.overlap,null==m?void 0:m.total,E]),q=Object(l.useCallback)((e=>{const{newAgentSelection:a}=C(e);t(a),k(e)}),[t]);Object(l.useEffect)((()=>{const t=(e,t)=>{const a=Object(I.find)(["label",t],f);if(a){var s;const t=null===(s=a.options)||void 0===s?void 0:s.filter((t=>{if(t.key)return e.includes(t.key)}));null!=t&&t.length&&(q(t),h.current=!0)}};if(e&&!Object(I.isEmpty)(e)&&!h.current&&f.length&&!x){var a,s;if(e.allAgentsSelected){const e=Object(I.find)(["label",F.d],f);null!=e&&e.options&&(q(e.options),h.current=!0)}null!==(a=e.policiesSelected)&&void 0!==a&&a.length&&t(e.policiesSelected,F.b),null!==(s=e.agents)&&void 0!==s&&s.length&&t(e.agents,F.c)}}),[e,T,x,q,f,E]),Object(l.useEffect)((()=>{if(T&&null!=m&&m.groups){var e,t,a;const s=((null===(e=m.groups)||void 0===e?void 0:e.policies)||[]).slice(0,""===c?10:void 0),u=new agent_grouper_AgentGrouper;u.setTotalAgents(m.total),u.updateGroup(z.Platform,null!==(t=null==m||null===(a=m.groups)||void 0===a?void 0:a.platforms)&&void 0!==t?t:[]),u.updateGroup(z.Policy,s),u.updateGroup(z.Agent,null==m?void 0:m.agents);const l=u.generateOptions();S((e=>A()(e,l)?e:l))}}),[null==m?void 0:m.agents,null==m?void 0:m.groups,null==m?void 0:m.total,T,c]);const w=Object(l.useCallback)(((e,t,a)=>{var s;const{label:l,value:i}=e;return(null==i?void 0:i.groupType)===z.Agent?Object(Y.jsx)(u.EuiHealth,{color:"online"===(null==i?void 0:i.status)?"success":"danger"},Object(Y.jsx)("span",{className:a},Object(Y.jsx)(u.EuiHighlight,{search:t},l))):Object(Y.jsx)("span",{className:a},Object(Y.jsx)("span",null,"[",null!==(s=null==i?void 0:i.size)&&void 0!==s?s:0,"]"),"Â ",Object(Y.jsx)(u.EuiHighlight,{search:t},l))}),[]),U=Object(l.useCallback)((e=>{g(""!==e),j(e)}),[]);return Object(Y.jsx)("div",null,Object(Y.jsx)(u.EuiFormRow,{label:F.c,fullWidth:!0,isInvalid:!!a,error:a},Object(Y.jsx)(i.a.Fragment,null,T&&null!=m&&m.groups&&!f.length?Object(Y.jsx)(i.a.Fragment,null,Object(Y.jsx)(u.EuiCallOut,{color:"danger",size:"s",iconType:"warning",title:F.f},Object(Y.jsx)(n.FormattedMessage,{id:"xpack.osquery.agents.noAgentAvailableDescription",defaultMessage:"Before you can query agents, they must be enrolled in an agent policy with the Osquery integration installed. Refer to {docsLink} for more information.",values:{docsLink:Object(Y.jsx)(u.EuiLink,{href:`${o.links.fleet.agentPolicy}#apply-a-policy`,target:"_blank"},Object(Y.jsx)(n.FormattedMessage,{id:"xpack.osquery.agents.noAgentAvailableDescription.docsLink",defaultMessage:"Apply a policy"}))}})),Object(Y.jsx)(u.EuiSpacer,{size:"s"})):null,Object(Y.jsx)(u.EuiComboBox,{"data-test-subj":"agentSelection",placeholder:F.g,isLoading:O||d,options:f,isClearable:!0,fullWidth:!0,onSearchChange:U,selectedOptions:E,onChange:q,renderOption:w}))),Object(Y.jsx)(u.EuiSpacer,{size:"xs"}),Q>0?Object(Y.jsx)("span",null,Object(F.h)(Q)):"")};U.displayName="AgentsTable";const _=i.a.memo(U,A.a),P=e=>{var t,a,u;return Object(s.isEmpty)(e)?v.i18n.translate("xpack.osquery.pack.queryFlyoutForm.osqueryAgentsMissingErrorMessage",{defaultMessage:"Agents is a required field"}):e.offlineAgentsSelected?v.i18n.translate("xpack.osquery.pack.queryFlyoutForm.osqueryAgentsOfflineErrorMessage",{defaultMessage:"Some agents are offline"}):e.allAgentsSelected||null!==(t=e.agents)&&void 0!==t&&t.length||null!==(a=e.platformsSelected)&&void 0!==a&&a.length||null!==(u=e.policiesSelected)&&void 0!==u&&u.length?void 0:v.i18n.translate("xpack.osquery.pack.queryFlyoutForm.osqueryAgentsMissingErrorMessage",{defaultMessage:"Agents is a required field"})},V=()=>{const{field:{onChange:e,value:t},fieldState:{error:a}}=Object(d.useController)({name:"agentSelection",rules:{validate:P},defaultValue:{}});return Object(Y.jsx)(_,{agentSelection:t,onChange:e,error:null==a?void 0:a.message})},W=i.a.memo(V);var G=a(76),R=a(128);const B=({defaultValue:e,onSuccess:t,queryField:a=!0,formType:r="steps",enabled:v=!0,hideAgentsField:I=!1})=>{const f=Object(l.useContext)(j.a),{application:A,appName:S}=Object(p.e)().services,D=A.capabilities.osquery,E=Object(l.useMemo)((()=>!(!D.runSavedQueries&&!D.writeLiveQueries||!D.readPacks)),[D]),k=Object(d.useForm)(),{handleSubmit:z,watch:C,setValue:F,resetField:h,clearErrors:Q,getFieldState:q,register:w}=k,U=Object(l.useMemo)((()=>!!(D.writeLiveQueries||D.runSavedQueries&&D.readSavedQueries)),[D]),[_,P]=Object(l.useState)(!1),[V,B]=Object(l.useState)(!1),Z=q("query"),H=C(),$=Object(l.useCallback)((()=>P(!0)),[]),X=Object(l.useCallback)((()=>P(!1)),[]),{queryType:J}=H,{data:K,isLoading:ee,mutateAsync:te,isError:ae,isSuccess:se,reset:ue}=(({onSuccess:e})=>{const t=Object(N.a)(),{executionContext:a,http:s}=Object(p.e)().services,u=null==a?void 0:a.get();return Object(L.useMutation)((async({agentSelection:e,...t})=>{const a=await s.post("/api/osquery/live_queries",{version:M.a.public.v1,body:JSON.stringify({...t,agent_all:e.allAgentsSelected,agent_ids:e.agents,agent_platforms:e.platformsSelected,agent_policy_ids:e.policiesSelected,metadata:{execution_context:u}})});return null==a?void 0:a.data}),{onSuccess:()=>{t(),e&&e()},onError:e=>{t(e,{title:e.body.error,toastMessage:e.body.message})}})})({onSuccess:t}),{data:le}=Object(m.a)({actionId:null==K?void 0:K.action_id,isLive:V});Object(l.useEffect)((()=>{w("savedQueryId"),w("alertIds")}),[w]);const ie=Object(l.useMemo)((()=>ae||Z.error?"danger":ee?"loading":se?"complete":"incomplete"),[ae,ee,se,Z]),ne=Object(l.useMemo)((()=>"complete"===ie?"incomplete":"disabled"),[ie]),re=Object(l.useCallback)((async e=>{var t;const a=e.query&&c(e.query)&&f?o(e.query,f).result:e.query,u=Object(s.pickBy)({agentSelection:e.agentSelection,saved_query_id:e.savedQueryId,query:a,alert_ids:e.alertIds,pack_id:"pack"===J&&null!=e&&null!==(t=e.packId)&&void 0!==t&&t.length?null==e?void 0:e.packId[0]:void 0,ecs_mapping:e.ecs_mapping,..."query"===J?{timeout:e.timeout}:{}},(e=>!Object(s.isEmpty)(e)||Object(s.isNumber)(e)));await te(u)}),[f,te,J]),oe=Object(l.useMemo)((()=>Object(G.a)(H)),[H]),{data:ce,isFetched:je}=Object(x.a)({}),de=Object(l.useMemo)((()=>Object(Y.jsx)(u.EuiFlexItem,null,Object(Y.jsx)(u.EuiFlexGroup,{justifyContent:"flexEnd"},"steps"===r&&"pack"!==J&&Object(Y.jsx)(u.EuiFlexItem,{grow:!1},Object(Y.jsx)(u.EuiButtonEmpty,{disabled:!D.writeSavedQueries||"disabled"===ne,onClick:$},Object(Y.jsx)(n.FormattedMessage,{id:"xpack.osquery.liveQueryForm.form.saveForLaterButtonLabel",defaultMessage:"Save for later"}))),Object(Y.jsx)(u.EuiFlexItem,{grow:!1},Object(Y.jsx)(u.EuiButton,{id:"submit-button",disabled:!v,isLoading:ee,onClick:z(re)},Object(Y.jsx)(n.FormattedMessage,{id:"xpack.osquery.liveQueryForm.form.submitButtonLabel",defaultMessage:"Submit"})))))),[r,J,D.writeSavedQueries,ne,$,v,ee,z,re]),Me=Object(l.useMemo)((()=>{var e;return null==le||null===(e=le.queries)||void 0===e?void 0:e[0]}),[le]),ge=Object(l.useMemo)((()=>null==le?void 0:le.action_id),[le]),ye=Object(l.useMemo)((()=>null!=Me&&Me.action_id?Object(Y.jsx)(b.a,{actionId:null==Me?void 0:Me.action_id,startDate:null==le?void 0:le["@timestamp"],ecsMapping:oe.ecs_mapping,endDate:null==Me?void 0:Me.expiration,agentIds:null==Me?void 0:Me.agents,liveQueryActionId:ge}):null),[null==Me?void 0:Me.action_id,null==Me?void 0:Me.expiration,null==Me?void 0:Me.agents,le,oe.ecs_mapping,ge]);Object(l.useEffect)((()=>{if(e){var t,a,u;if(e.agentSelection&&F("agentSelection",e.agentSelection),null!==(t=e.alertIds)&&void 0!==t&&t.length&&F("alertIds",e.alertIds),e.packId&&E){if(F("queryType","pack"),!je)return;return void(Object(s.find)(null==ce?void 0:ce.data,["saved_object_id",e.packId])&&F("packId",[e.packId]))}if(e.query&&U)return F("query",e.query),F("savedQueryId",e.savedQueryId),F("ecs_mapping",null!==(a=e.ecs_mapping)&&void 0!==a?a:{}),void F("timeout",null!==(u=e.timeout)&&void 0!==u?u:M.g.DEFAULT);if(U)return F("queryType","query");if(E)return F("queryType","pack")}}),[E,U,e,je,null==ce?void 0:ce.data,F]),Object(l.useEffect)((()=>{B((()=>!("completed"===(null==le?void 0:le.status))))}),[null==le?void 0:le.status]),Object(l.useEffect)((()=>{ue(),e||(h("packId"),h("query"),h("ecs_mapping"),h("savedQueryId"),h("alertIds"),Q())}),[J,ue,h,F,Q,e]);const pe=Object(l.useMemo)((()=>({gap:16})),[]);return Object(Y.jsx)(i.a.Fragment,null,Object(Y.jsx)(d.FormProvider,k,Object(Y.jsx)(u.EuiFlexGroup,{direction:"column",css:pe},a&&Object(Y.jsx)(y.a,{canRunPacks:E,canRunSingleQuery:U}),!I&&Object(Y.jsx)(u.EuiFlexItem,null,Object(Y.jsx)(W,null)),"pack"===J?Object(Y.jsx)(R.a,{liveQueryDetails:le,submitButtonContent:de,showResultsHeader:!0}):Object(Y.jsx)(i.a.Fragment,null,Object(Y.jsx)(u.EuiFlexItem,null,Object(Y.jsx)(T.default,{handleSubmitForm:z(re)})),de,Object(Y.jsx)(u.EuiFlexItem,null,ye)))),_?Object(Y.jsx)(O.a,{isExternal:S!==g.PLUGIN_NAME,onClose:X,defaultValue:oe}):null)},Z=i.a.memo(B);var H=a(86),$=a(63);const X=({agentId:e,agentIds:t,alertIds:a,agentPolicyIds:i,onSuccess:r,query:c,savedQueryId:d,ecs_mapping:M,queryField:y,ecsMappingField:p,formType:b,enabled:O,hideAgentsField:x,packId:L,agentSelection:N,timeout:m})=>{const{data:T,isLoading:v}=Object(H.a)(),I=Object(l.useMemo)((()=>{return N||(e||null!=i&&i.length?{allAgentsSelected:!1,agents:Object(s.castArray)(null!==(a=null!=e?e:t)&&void 0!==a?a:[]),platformsSelected:[],policiesSelected:null!=i?i:[]}:null);var a}),[e,t,i,N]),f=Object(l.useContext)(j.a),A=Object(l.useMemo)((()=>{if(f&&c){const{result:e}=o(c,f);return e}return c}),[f,c]),S=Object(l.useMemo)((()=>{const e={...I?{agentSelection:I}:{},alertIds:a,query:A,savedQueryId:d,ecs_mapping:M,timeout:m,packId:L};return Object(s.isEmpty)(Object(s.pickBy)(e,(e=>!Object(s.isEmpty)(e))))?void 0:e}),[a,M,I,A,L,d,m]);return v?Object(Y.jsx)(u.EuiSkeletonText,{lines:10}):T?Object(Y.jsx)(Z,{queryField:y,ecsMappingField:p,defaultValue:S,onSuccess:r,formType:b,enabled:O,hideAgentsField:x}):Object(Y.jsx)(u.EuiEmptyPrompt,{icon:Object(Y.jsx)($.a,null),title:Object(Y.jsx)("h2",null,Object(Y.jsx)(n.FormattedMessage,{id:"xpack.osquery.liveQuery.permissionDeniedPromptTitle",defaultMessage:"Permission denied"})),titleSize:"xs",body:Object(Y.jsx)("p",null,Object(Y.jsx)(n.FormattedMessage,{id:"xpack.osquery.liveQuery.permissionDeniedPromptBody",defaultMessage:"To view query results, ask your administrator to update your user role to have index {read} privileges on the {logs} index.",values:{read:Object(Y.jsx)(u.EuiCode,null,"read"),logs:Object(Y.jsx)(u.EuiCode,null,"logs-",g.OSQUERY_INTEGRATION_NAME,".result*")}}))})},J=i.a.memo(X)}}]);