/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[10],{140:function(e,t,a){"use strict";a.r(t);var i=a(1),n=a.n(i),s=a(18),o=a(12),l=a(36),c=a(2),r=a(52),u=a(44),d=a(21),p=a(43),b=a(15),g=a(41),j=a(39),h=a(49),m=a(71),x=a(11),O=a(13),f=a(95),C=a(0),v=a(37),P=a(57),F=a(65),y=a(5),S=a(58),w=a(38),T=a(16),E=a(90),k=a(89),D=a(42);function M(e,t,a){return{meta:{disabled:!1,negate:a,alias:null,index:e,key:`${t.group.name}_${t.group.value}`,field:t.group.name,params:{query:t.group.value},type:"phrase"},query:{match_phrase:{[t.group.name]:t.group.value}},$state:{store:T.FilterStateStore.APP_STATE}}}const I=({isLoading:e,annotations:t,fieldConfig:a,onSelectionChange:n})=>{const{fieldFormats:s,data:{query:{filterManager:o}}}=Object(j.b)(),{dataView:l}=Object(g.c)(),r=Object(i.useMemo)((()=>s.deserialize({id:"date"})),[s]),u=void 0!==a.splitField,{bucketInterval:d}=Object(D.c)(),p=[{id:"timestamp",field:"timestamp","data-test-subj":"aiopsChangePointTimestamp",name:x.i18n.translate("xpack.aiops.changePointDetection.timeColumn",{defaultMessage:"Time"}),sortable:!0,truncateText:!1,width:"230px",render:e=>r.convert(e)},{id:"preview","data-test-subj":"aiopsChangePointPreview",name:x.i18n.translate("xpack.aiops.changePointDetection.previewColumn",{defaultMessage:"Preview"}),align:"center",width:"200px",height:"80px",truncateText:!1,valign:"middle",css:{"&.euiTableCellContent":{display:"block",padding:0}},render:e=>Object(C.jsx)(A,{annotation:e,fieldConfig:a,interval:d.expression})},{id:"type","data-test-subj":"aiopsChangePointType",field:"type",name:x.i18n.translate("xpack.aiops.changePointDetection.typeColumn",{defaultMessage:"Type"}),sortable:!0,truncateText:!1,render:e=>Object(C.jsx)(c.EuiBadge,{color:"hollow"},e)},{id:"pValue","data-test-subj":"aiopsChangePointPValue",field:"p_value",name:Object(C.jsx)(c.EuiToolTip,{content:x.i18n.translate("xpack.aiops.changePointDetection.pValueTooltip",{defaultMessage:"Indicates how extreme the change is. Lower values indicate greater change."})},Object(C.jsx)("span",null,x.i18n.translate("xpack.aiops.changePointDetection.pValueLabel",{defaultMessage:"p-value"}),Object(C.jsx)(c.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),sortable:!0,truncateText:!1,render:e=>e.toPrecision(3)},...a.splitField?[{id:"groupName","data-test-subj":"aiopsChangePointGroupName",field:"group.name",name:x.i18n.translate("xpack.aiops.changePointDetection.fieldNameColumn",{defaultMessage:"Field name"}),truncateText:!1},{id:"groupValue","data-test-subj":"aiopsChangePointGroupValue",field:"group.value",name:x.i18n.translate("xpack.aiops.changePointDetection.fieldValueColumn",{defaultMessage:"Field value"}),truncateText:!1,sortable:!0},{name:x.i18n.translate("xpack.aiops.changePointDetection.actionsColumn",{defaultMessage:"Actions"}),actions:[{name:x.i18n.translate("xpack.aiops.changePointDetection.actions.filterForValueAction",{defaultMessage:"Filter for value"}),description:x.i18n.translate("xpack.aiops.changePointDetection.actions.filterForValueAction",{defaultMessage:"Filter for value"}),icon:"plusInCircle",color:"primary",type:"icon",onClick:e=>{o.addFilters(M(l.id,e,!1))},isPrimary:!0,"data-test-subj":"aiopsChangePointFilterForValue"},{name:x.i18n.translate("xpack.aiops.changePointDetection.actions.filterOutValueAction",{defaultMessage:"Filter out value"}),description:x.i18n.translate("xpack.aiops.changePointDetection.actions.filterOutValueAction",{defaultMessage:"Filter out value"}),icon:"minusInCircle",color:"primary",type:"icon",onClick:e=>{o.addFilters(M(l.id,e,!0))},isPrimary:!0,"data-test-subj":"aiopsChangePointFilterOutValue"}]}]:[]],b=Object(i.useMemo)((()=>({selectable:e=>!0,onSelectionChange:e=>{n(e.map((e=>({...e,...a}))))}})),[a,n]);return Object(C.jsx)(c.EuiInMemoryTable,{itemId:"id",selection:b,loading:e,"data-test-subj":"aiopsChangePointResultsTable "+(e?"loading":"loaded"),items:t,columns:p,pagination:{pageSizeOptions:[5,10,15]},sorting:{sort:{field:"p_value",direction:"asc"}},hasActions:u,rowProps:e=>({"data-test-subj":`aiopsChangePointResultsTableRow row-${e.id}`}),message:e?Object(C.jsx)(c.EuiEmptyPrompt,{iconType:"search",title:Object(C.jsx)("h2",null,Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.fetchingChangePointsTitle",defaultMessage:"Fetching change points..."}))}):Object(C.jsx)(E.a,null)})},A=({fieldConfig:e,annotation:t})=>{const{lens:{EmbeddableComponent:a}}=Object(j.b)(),{bucketInterval:i}=Object(D.c)(),{filters:n,query:s,attributes:o,timeRange:l}=Object(k.a)({annotation:t,fieldConfig:e,previewMode:!0,bucketInterval:i.expression});return Object(C.jsx)("div",{"data-test-subj":"aiopChangePointPreviewChart"},Object(C.jsx)(a,{id:`mini_changePointChart_${t.group?t.group.value:t.label}`,style:{height:80},timeRange:l,query:s,filters:n,attributes:o,renderMode:"preview",executionContext:{type:"aiops_change_point_detection_chart",name:"Change point detection"}}))};var R=a(45),V=a(66),z=a(67),B=a(68),L=a(88),_=a(55),N=a.n(_),q=a(62);const G={width:"350px"},W=Object(v.withSuspense)(v.LazySavedObjectSaveModalDashboard),U=()=>{const{requestParams:{fieldConfigs:e},updateRequestParams:t,selectedChangePoints:a,setSelectedChangePoints:s}=Object(D.c)(),o=Object(i.useCallback)(((a,i)=>{e.splice(i,1,a),t({fieldConfigs:e})}),[t,e]),l=Object(i.useCallback)((()=>{const a=[...e];a.push(a[a.length-1]),t({fieldConfigs:a})}),[t,e]),r=Object(i.useCallback)((i=>{e.splice(i,1),t({fieldConfigs:e}),delete a[i],s({...a})}),[t,e,s,a]),u=Object(i.useCallback)(((e,t)=>{s({...a,[t]:e})}),[s,a]);return Object(C.jsx)(n.a.Fragment,null,e.map(((t,a)=>{const i=a;return Object(C.jsx)(n.a.Fragment,{key:i},Object(C.jsx)($,{panelIndex:a,"data-test-subj":`aiopsChangePointPanel_${a}`,fieldConfig:t,onChange:e=>o(e,a),onRemove:r.bind(null,a),removeDisabled:1===e.length,onSelectionChange:e=>{u(e,a)}}),Object(C.jsx)(c.EuiSpacer,{size:"s"}))})),Object(C.jsx)(c.EuiButton,{onClick:l,disabled:e.length>=R.f,"data-test-subj":"aiopsChangePointAddConfig"},Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.addButtonLabel",defaultMessage:"Add"})))},$=({panelIndex:e,fieldConfig:t,onChange:a,onRemove:n,removeDisabled:s,onSelectionChange:o,"data-test-subj":l})=>{var r,u,d,b;const{embeddable:h,application:{capabilities:m},cases:f}=Object(j.b)(),{dataView:v}=Object(g.c)(),{combinedQuery:T,requestParams:E,selectedChangePoints:k}=Object(D.c)(),M=function(e,t){const a=N()(e),{splitFieldsOptions:n}=Object(D.d)(),[s,o]=Object(i.useState)(null),{dataView:l}=Object(g.c)(),c=Object(i.useMemo)((()=>{const a=n.find((t=>t.name===e));let i={};return null!=a&&a.isRuntimeField&&(i={runtime_mappings:{[a.name]:a.runtimeField}}),{params:{index:l.getIndexPattern(),size:0,body:{query:t,aggregations:{fieldCount:{cardinality:{field:e}}},...i}}}}),[e,l,t,n]),{runRequest:r,cancelRequest:u}=Object(q.a)();return Object(i.useEffect)((function(){o(null),void 0!==e&&(u(),r(c).then((e=>{null!=e&&e.rawResponse.aggregations&&o(e.rawResponse.aggregations.fieldCount.value)})))}),[r,c,u,e]),a!==e?null:s}(t.splitField,T),[I,A]=Object(i.useState)(!0),[R,V]=Object(i.useState)(!1),[z,B]=Object(i.useState)(!0),_=null!==(r=null===(u=m.dashboard)||void 0===u?void 0:u.createNew)&&void 0!==r&&r,{create:G,update:U}=null!==(d=null==f||null===(b=f.helpers)||void 0===b?void 0:b.canUseCases())&&void 0!==d?d:{create:!1,update:!1},[$,H]=Object(i.useState)({applyTimeRange:!1,maxSeriesToPlot:6}),[J,X]=Object(i.useState)(!1),{results:Y,isLoading:Z,progress:ee}=Object(L.a)(t,E,T,M),te=(e=>{const{cases:t}=Object(j.b)(),a=null==t?void 0:t.hooks.useCasesAddToExistingCaseModal();return Object(i.useCallback)((t=>{const i={...t,id:Object(S.a)(JSON.stringify(t)).toString()};if(!a)throw new Error("Cases modal is not available");a.open({getAttachments:()=>[{type:w.AttachmentType.persistableState,persistableStateAttachmentTypeId:e,persistableStateAttachmentState:JSON.parse(JSON.stringify(i))}]})}),[e])})(y.c),ae=Object(i.useMemo)((()=>{var t;return(null!==(t=k[e])&&void 0!==t?t:[]).map((e=>{var t;return null===(t=e.group)||void 0===t?void 0:t.value}))}),[k,e]),ie=Object(P.a)(t.splitField)&&0===ae.length,ne=Object(p.f)(),se=Object(i.useMemo)((()=>[{id:"panelActions",size:"s",items:[..._||U||G?[{name:ae.length>0?x.i18n.translate("xpack.aiops.changePointDetection.attachSelectedChartsLabel",{defaultMessage:"Attach selected charts"}):x.i18n.translate("xpack.aiops.changePointDetection.attachChartsLabel",{defaultMessage:"Attach charts"}),icon:"plusInCircle",panel:"attachMainPanel","data-test-subj":"aiopsChangePointDetectionAttachButton"}]:[],{name:x.i18n.translate("xpack.aiops.changePointDetection.removeConfigLabel",{defaultMessage:"Remove configuration"}),icon:"trash",onClick:n,disabled:s}],"data=test-subj":"aiopsChangePointDetectionContextMenuPanel"},{id:"attachMainPanel",size:"s",initialFocusedItemIndex:0,title:ae.length>0?x.i18n.translate("xpack.aiops.changePointDetection.attachSelectedChartsLabel",{defaultMessage:"Attach selected charts"}):x.i18n.translate("xpack.aiops.changePointDetection.attachChartsLabel",{defaultMessage:"Attach charts"}),items:[..._?[{name:x.i18n.translate("xpack.aiops.changePointDetection.attachToDashboardLabel",{defaultMessage:"To dashboard"}),panel:"attachToDashboardPanel","data-test-subj":"aiopsChangePointDetectionAttachToDashboardButton"}]:[],...U||G?[{name:x.i18n.translate("xpack.aiops.changePointDetection.attachToCaseLabel",{defaultMessage:"To case"}),disabled:ie,...ie?{toolTipPosition:"left",toolTipContent:x.i18n.translate("xpack.aiops.changePointDetection.attachToCaseTooltipContent",{defaultMessage:"Select change points to attach"})}:{},"data-test-subj":"aiopsChangePointDetectionAttachToCaseButton",onClick:()=>{te({timeRange:ne,fn:t.fn,metricField:t.metricField,dataViewId:v.id,...t.splitField?{splitField:t.splitField,partitions:ae}:{}})}}]:[]],"data-test-subj":"aiopsChangePointDetectionAttachChartPanel"},{id:"attachToDashboardPanel",title:x.i18n.translate("xpack.aiops.changePointDetection.attachToDashboardTitle",{defaultMessage:"Attach to dashboard"}),size:"s",content:Object(C.jsx)(c.EuiPanel,{paddingSize:"s"},Object(C.jsx)(c.EuiSpacer,{size:"s"}),Object(C.jsx)(c.EuiForm,{"data-test-subj":"aiopsChangePointDetectionDashboardAttachmentForm"},Object(C.jsx)(c.EuiFormRow,{fullWidth:!0},Object(C.jsx)(c.EuiSwitch,{label:x.i18n.translate("xpack.aiops.changePointDetection.applyTimeRangeLabel",{defaultMessage:"Apply time range"}),checked:$.applyTimeRange,onChange:e=>H((t=>({...t,applyTimeRange:e.target.checked}))),compressed:!0,"data-test-subj":"aiopsChangePointDetectionAttachToDashboardApplyTimeRangeSwitch"})),Object(P.a)(t.splitField)&&0===ae.length?Object(C.jsx)(F.a,{value:$.maxSeriesToPlot,onChange:e=>{H((t=>({...t,maxSeriesToPlot:e})))},onValidationChange:e=>{B(null===e)}}):null,Object(C.jsx)(c.EuiSpacer,{size:"m"}),Object(C.jsx)(c.EuiButton,{"data-test-subj":"aiopsChangePointDetectionSubmitDashboardAttachButton",fill:!0,type:"submit",fullWidth:!0,onClick:X.bind(null,!0),disabled:!z},Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.submitDashboardAttachButtonLabel",defaultMessage:"Attach"}))))}]),[G,_,U,ie,$.applyTimeRange,$.maxSeriesToPlot,v.id,t.fn,t.metricField,t.splitField,z,n,te,s,ae,ne]),oe=Object(i.useCallback)((({dashboardId:a,newTitle:i,newDescription:n})=>{var s;const o=h.getStateTransfer(),l={input:{title:i,description:n,dataViewId:v.id,metricField:t.metricField,splitField:t.splitField,fn:t.fn,...$.applyTimeRange?{timeRange:ne}:{},maxSeriesToPlot:$.maxSeriesToPlot,...null!==(s=k[e])&&void 0!==s&&s.length?{partitions:ae}:{}},type:y.c},c="new"===a?"#/create":`#/view/${a}`;o.navigateToWithEmbeddablePackage("dashboards",{state:l,path:c})}),[h,v.id,t.metricField,t.splitField,t.fn,$.applyTimeRange,$.maxSeriesToPlot,ne,k,e,ae]);return Object(C.jsx)(c.EuiPanel,{paddingSize:"s",hasBorder:!0,hasShadow:!1,"data-test-subj":l},Object(C.jsx)(c.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiButtonIcon,{"data-test-subj":"aiopsChangePointDetectionExpandConfigButton",iconType:I?"arrowDown":"arrowRight",onClick:A.bind(null,(e=>!e)),"aria-label":x.i18n.translate("xpack.aiops.changePointDetection.expandConfigLabel",{defaultMessage:"Expand configuration"})})),Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(Q,{fieldConfig:t,onChange:a},Object(C.jsx)(c.EuiFlexItem,{css:Object(C.css)({visibility:null===ee?"hidden":"visible"},"",""),grow:!0},Object(C.jsx)(c.EuiProgress,{label:Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.progressBarLabel",defaultMessage:"Fetching change points"}),value:null!=ee?ee:0,max:100,valueText:!0,size:"m"}),Object(C.jsx)(c.EuiSpacer,{size:"s"})))))),Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s"},Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiPopover,{id:`panelContextMenu_${e}`,button:Object(C.jsx)(c.EuiButtonIcon,{"data-test-subj":"aiopsChangePointDetectionContextMenuButton","aria-label":x.i18n.translate("xpack.aiops.changePointDetection.configActionsLabel",{defaultMessage:"Context menu"}),iconType:"boxesHorizontal",color:"text",onClick:V.bind(null,!0)}),isOpen:R,closePopover:V.bind(null,!1),panelPaddingSize:"none",anchorPosition:"downLeft"},Object(C.jsx)(c.EuiContextMenu,{panels:se,initialPanelId:"panelActions"})))))),I?Object(C.jsx)(K,{fieldConfig:t,isLoading:Z,annotations:Y,splitFieldCardinality:M,onSelectionChange:o}):null,J?Object(C.jsx)(W,{canSaveByReference:!1,objectType:x.i18n.translate("xpack.aiops.changePointDetection.objectTypeLabel",{defaultMessage:"Change point chart"}),documentInfo:{title:x.i18n.translate("xpack.aiops.changePointDetection.attachmentTitle",{defaultMessage:"Change point: {function}({metric}){splitBy}",values:{function:t.fn,metric:t.metricField,splitBy:t.splitField?x.i18n.translate("xpack.aiops.changePointDetection.splitByTitle",{defaultMessage:' split by "{splitField}"',values:{splitField:t.splitField}}):""}})},onClose:()=>{X(!1)},onSave:oe}):null)};var H={name:"833hqy",styles:"width:200px"};const Q=({fieldConfig:e,onChange:t,children:a})=>{const{splitFieldsOptions:n,combinedQuery:s}=Object(D.c)(),{dataView:o}=Object(g.c)(),{data:l,uiSettings:r,fieldFormats:u,charts:d,fieldStats:b}=Object(j.b)(),h=Object(p.g)();Object(p.f)();const m=h.getActiveBounds(),x=Object(i.useMemo)((()=>({uiSettings:r,dataViews:l.dataViews,data:l,fieldFormats:u,charts:d})),[r,l,u,d]),O=b.FieldStatsFlyoutProvider,f=Object(i.useCallback)(((a,i)=>{const n={...e,[a]:i};t(n)}),[t,e]);return Object(C.jsx)(O,{fieldStatsServices:x,dataView:o,dslQuery:s,timeRangeMs:m?{from:m.min.valueOf(),to:m.max.valueOf()}:void 0},Object(C.jsx)(c.EuiFlexGroup,{alignItems:"center",responsive:!0,wrap:!0,gutterSize:"m"},Object(C.jsx)(c.EuiFlexItem,{grow:!1,css:H},Object(C.jsx)(V.a,{value:e.fn,onChange:e=>f("fn",e)})),Object(C.jsx)(c.EuiFlexItem,{grow:!1,css:G},Object(C.jsx)(z.a,{value:e.metricField,onChange:e=>f("metricField",e)})),n.length>0?Object(C.jsx)(c.EuiFlexItem,{grow:!1,css:G},Object(C.jsx)(B.a,{value:e.splitField,onChange:e=>f("splitField",e)})):null,a))},K=({fieldConfig:e,splitFieldCardinality:t,isLoading:a,annotations:i,onSelectionChange:s})=>{const o=t&&t>R.g;return Object(C.jsx)(n.a.Fragment,null,Object(C.jsx)(c.EuiSpacer,{size:"s"}),o?Object(C.jsx)(n.a.Fragment,null,Object(C.jsx)(c.EuiCallOut,{title:x.i18n.translate("xpack.aiops.changePointDetection.cardinalityWarningTitle",{defaultMessage:"Analysis has been limited"}),color:"warning",iconType:"warning"},Object(C.jsx)("p",null,x.i18n.translate("xpack.aiops.changePointDetection.cardinalityWarningMessage",{defaultMessage:'The "{splitField}" field cardinality is {cardinality} which exceeds the limit of {cardinalityLimit}. Only the first {cardinalityLimit} partitions, sorted by document count, are analyzed.',values:{cardinality:t,cardinalityLimit:R.g,splitField:e.splitField}}))),Object(C.jsx)(c.EuiSpacer,{size:"m"})):null,Object(C.jsx)(I,{annotations:i,fieldConfig:e,isLoading:a,onSelectionChange:s}))},J=[{value:R.b.DIP,description:x.i18n.translate("xpack.aiops.changePointDetection.dipDescription",{defaultMessage:"A significant dip occurs at this point."})},{value:R.b.SPIKE,description:x.i18n.translate("xpack.aiops.changePointDetection.spikeDescription",{defaultMessage:"A significant spike occurs at this point."})},{value:R.b.DISTRIBUTION_CHANGE,description:x.i18n.translate("xpack.aiops.changePointDetection.distributionChangeDescription",{defaultMessage:"The overall distribution of the values has changed significantly."})},{value:R.b.STEP_CHANGE,description:x.i18n.translate("xpack.aiops.changePointDetection.stepChangeDescription",{defaultMessage:"The change indicates a statistically significant step up or down in value distribution."})},{value:R.b.TREND_CHANGE,description:x.i18n.translate("xpack.aiops.changePointDetection.trendChangeDescription",{defaultMessage:"An overall trend change occurs at this point."})}],X=({value:e,onChange:t})=>{const a=Object(i.useMemo)((()=>[{value:void 0,description:""},...J].map((e=>{var t;return{value:e.value,label:null!==(t=e.value)&&void 0!==t?t:x.i18n.translate("xpack.aiops.changePointDetection.selectAllChangePoints",{defaultMessage:"Select all"}),description:e.description}}))),[]),s=e?a.filter((t=>e.includes(t.value))):[a[0]],o=Object(i.useCallback)((e=>{0!==e.length&&void 0!==e[e.length-1].value?t(e.map((e=>e.value)).filter(P.a)):t(void 0)}),[t]),l=Object(i.useCallback)((e=>{const{label:t,description:a}=e;return a?Object(C.jsx)(c.EuiToolTip,{position:"left",content:a},Object(C.jsx)(c.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiIcon,{type:"iInCircle",color:"primary"})),Object(C.jsx)(c.EuiFlexItem,null,t))):Object(C.jsx)(n.a.Fragment,null,t)}),[]);return Object(C.jsx)(c.EuiFormRow,{label:x.i18n.translate("xpack.aiops.changePointDetection.changePointTypeLabel",{defaultMessage:"Change point type"}),display:"columnCompressed",fullWidth:!0},Object(C.jsx)(c.EuiComboBox,{options:a,selectedOptions:s,onChange:o,isClearable:!0,"data-test-subj":"aiopsChangePointTypeFilter",renderOption:l,compressed:!0}))};var Y=a(47);const Z=({query:e,filters:t,onQueryChange:a,onFiltersChange:s})=>{const{dataView:o}=Object(g.c)(),{unifiedSearch:{ui:{SearchBar:l}}}=Object(j.b)(),[r,u]=Object(i.useState)(),d=Object(i.useCallback)(((e,t)=>{if(e.query.language===Y.a.KUERY)try{Object(T.fromKueryExpression)(e.query.query),u(void 0),a(e.query)}catch(e){u(e.message)}}),[a]),p=Object(i.useCallback)((e=>{s(e)}),[s]),b=null!=e?e:{query:"",language:"kuery"};return Object(C.jsx)(n.a.Fragment,null,Object(C.jsx)(l,{showSubmitButton:!1,appName:"aiops",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:b,filters:null!=t?t:[],onQuerySubmit:d,indexPatterns:[o],placeholder:x.i18n.translate("xpack.aiops.searchPanel.queryBarPlaceholderText",{defaultMessage:'Search… (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,onFiltersUpdated:p}),r?Object(C.jsx)(n.a.Fragment,null,Object(C.jsx)(c.EuiSpacer,{size:"s"}),Object(C.jsx)(c.EuiTextColor,{color:"danger"},r)):null)};var ee={name:"1mhs1aw",styles:"min-width:400px"};const te=()=>{const[e,t]=Object(i.useState)(!1),{requestParams:a,updateRequestParams:n,resultFilters:s,updateFilters:o,resultQuery:l,metricFieldOptions:r,selectedChangePoints:u}=Object(D.c)(),{dataView:d}=Object(g.c)(),p=Object(i.useCallback)((e=>{n({query:e})}),[n]),b=Object(i.useCallback)((e=>{n({changePointType:e})}),[n]);if(0===r.length)return Object(C.jsx)(c.EuiCallOut,{title:x.i18n.translate("xpack.aiops.index.dataViewWithoutMetricNotificationTitle",{defaultMessage:'The data view "{dataViewTitle}" does not contain any metric fields.',values:{dataViewTitle:d.getName()}}),color:"danger",iconType:"warning"},Object(C.jsx)("p",null,x.i18n.translate("xpack.aiops.index.dataViewWithoutMetricNotificationDescription",{defaultMessage:"Change point detection can only be run on data views with a metric field."})));const j=Object.values(u).some((e=>e.length>0));return Object(C.jsx)("div",{"data-test-subj":"aiopsChangePointDetectionPage"},Object(C.jsx)(Z,{query:l,onQueryChange:p,filters:s,onFiltersChange:o}),Object(C.jsx)(c.EuiSpacer,{size:"m"}),Object(C.jsx)(c.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiFlexGroup,{alignItems:"center"},Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiText,{size:"s"},Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.aggregationIntervalTitle",defaultMessage:"Aggregation interval: "}),a.interval)),Object(C.jsx)(c.EuiFlexItem,{grow:!1},Object(C.jsx)(c.EuiToolTip,{position:"top",content:j?"":Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.viewSelectedChartsToltip",defaultMessage:"Select change points to view them in detail."})},Object(C.jsx)(c.EuiButtonEmpty,{onClick:()=>t(!e),size:"s",disabled:!j,"data-test-subj":"aiopsChangePointDetectionViewSelected"},Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.viewSelectedButtonLabel",defaultMessage:"View selected"})))))),Object(C.jsx)(c.EuiFlexItem,{grow:!1,css:ee},Object(C.jsx)(X,{value:a.changePointType,onChange:b}))),Object(C.jsx)(c.EuiSpacer,{size:"s"}),Object(C.jsx)(U,null),e?Object(C.jsx)(c.EuiFlyout,{ownFocus:!0,onClose:t.bind(null,!1),"aria-labelledby":"change_point_charts",size:"l","data-test-subj":"aiopsChangePointDetectionSelectedCharts"},Object(C.jsx)(c.EuiFlyoutHeader,{hasBorder:!0},Object(C.jsx)(c.EuiTitle,{size:"m"},Object(C.jsx)("h2",{id:"change_point_charts"},Object(C.jsx)(O.FormattedMessage,{id:"xpack.aiops.changePointDetection.selectedChangePointsHeader",defaultMessage:"Selected change points"})))),Object(C.jsx)(c.EuiFlyoutBody,null,Object(C.jsx)(f.b,{changePoints:u}))):null)};var ae=a(75),ie=a(80);const ne=new d.Storage(window.localStorage);t.default=({dataView:e,savedSearch:t,appDependencies:a,showFrozenDataTierChoice:d=!0})=>{var x,O,f,v,P;const F={...Object(o.pick)(a,["data","http","notifications","theme","uiSettings","i18n"]),uiSettingsKeys:b.UI_SETTINGS,showFrozenDataTierChoice:d},S=Object(ae.a)(e,"change_point_detection"),w=Object(i.useMemo)((()=>p.e.pipe(Object(s.map)((e=>e.lastRefresh)))),[]);if(null!==S)return Object(C.jsx)(n.a.Fragment,null,S);a.embeddingOrigin=y.a.AIOPS_DEFAULT_SOURCE;const T=null!==(x=null===(O=a.presentationUtil)||void 0===O?void 0:O.ContextProvider)&&void 0!==x?x:n.a.Fragment,E=null!==(f=null===(v=a.cases)||void 0===v?void 0:v.ui.getCasesContext())&&void 0!==f?f:n.a.Fragment,k=null===(P=a.cases)||void 0===P?void 0:P.helpers.canUseCases();return Object(C.jsx)(T,null,Object(C.jsx)(l.EuiThemeProvider,null,Object(C.jsx)(E,{owner:[],permissions:k},Object(C.jsx)(j.a.Provider,{value:a},Object(C.jsx)(u.a,null,Object(C.jsx)(g.a.Provider,{value:{dataView:e,savedSearch:t}},Object(C.jsx)(r.a,{storage:ne,storageKeys:h.d},Object(C.jsx)(p.a,F,Object(C.jsx)(m.a,null),Object(C.jsx)(c.EuiSpacer,null),Object(C.jsx)(ie.a,{reload$:w},Object(C.jsx)(D.a,null,Object(C.jsx)(D.b,null,Object(C.jsx)(te,null))))))))))))}},54:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return n}));const i=50,n=6},55:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(1);t.default=function(e){var t=i.useRef();return i.useEffect((function(){t.current=e})),t.current}},65:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a(1);var i=a(13),n=a(2),s=a(11),o=a(50),l=a(54),c=a(0);const r=Object(o.c)({min:1,max:l.b,integerOnly:!0}),u=({value:e,onChange:t,onValidationChange:a,disabled:o,inline:u=!0})=>{const d=null!==r(e),p=s.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotLabel",{defaultMessage:"Max series"});return Object(c.jsx)(n.EuiFormRow,{fullWidth:!0,isInvalid:d,error:Object(c.jsx)(i.FormattedMessage,{id:"xpack.aiops.changePointDetection.maxSeriesToPlotError",defaultMessage:"Max series value must be between {minValue} and {maxValue}",values:{minValue:1,maxValue:l.b}}),label:u?void 0:p},Object(c.jsx)(n.EuiFieldNumber,{"data-test-subj":"aiopsMaxSeriesControlFieldNumber",disabled:o,prepend:u?p:void 0,append:Object(c.jsx)(n.EuiToolTip,{content:s.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotDescription",{defaultMessage:"The maximum number of change points to visualize."})},Object(c.jsx)(n.EuiIcon,{type:"questionInCircle"})),compressed:!0,fullWidth:!0,isInvalid:d,value:e,onChange:e=>{const i=Number(e.target.value);t(i),a&&a(r(i))},min:1,max:l.b}))}},66:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var i=a(2),n=a(11),s=a(1),o=a.n(s),l=a(45),c=a(0);const r=o.a.memo((({value:e,onChange:t})=>{const a=Object.keys(l.h).map((e=>({id:e,label:e})));return Object(c.jsx)(i.EuiButtonGroup,{legend:n.i18n.translate("xpack.aiops.changePointDetection.selectFunctionLabel",{defaultMessage:"Function"}),options:a,idSelected:e,onChange:e=>t(e),isFullWidth:!0,buttonSize:"compressed"})}))},67:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(1),n=a.n(i),s=a(11),o=a(2),l=a(42),c=a(39),r=a(0);const u=n.a.memo((({value:e,onChange:t,inline:a=!0})=>{var u;const{fieldStats:d}=Object(c.b)(),{metricFieldOptions:p}=Object(l.d)(),{renderOption:b,closeFlyout:g}=null!==(u=null==d?void 0:d.useFieldStatsTrigger())&&void 0!==u?u:{},j=Object(i.useMemo)((()=>p.map((e=>({value:e.name,label:e.displayName,field:{id:e.name,type:e.type}})))),[p]),h=j.filter((t=>t.value===e)),m=Object(i.useCallback)((e=>{const a=e[0];void 0!==a&&t(a.value),g&&g()}),[t,g]),x=s.i18n.translate("xpack.aiops.changePointDetection.selectMetricFieldLabel",{defaultMessage:"Metric field"});return Object(r.jsx)(n.a.Fragment,null,Object(r.jsx)(o.EuiFormRow,{fullWidth:!0,label:a?void 0:x},Object(r.jsx)(o.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:a?x:void 0,singleSelection:{asPlainText:!0},options:j,selectedOptions:h,onChange:m,isClearable:!1,"data-test-subj":"aiopsChangePointMetricField",renderOption:b})))}))},68:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(1),n=a.n(i),s=a(11),o=a(2),l=a(39),c=a(42),r=a(0);const u=n.a.memo((({value:e,onChange:t,inline:a=!0})=>{var n;const{fieldStats:u}=Object(l.b)(),{renderOption:d,closeFlyout:p}=null!==(n=null==u?void 0:u.useFieldStatsTrigger())&&void 0!==n?n:{},{splitFieldsOptions:b}=Object(c.d)(),g=Object(i.useMemo)((()=>[{value:void 0,label:s.i18n.translate("xpack.aiops.changePointDetection.notSelectedSplitFieldLabel",{defaultMessage:"--- Not selected ---"})},...b.map((e=>({value:e.name,label:e.displayName,...e.name?{field:{id:e.name,type:null==e?void 0:e.type}}:{}})))]),[b]),j=g.filter((t=>t.value===e)),h=Object(i.useCallback)((e=>{const a=e[0],i=null==a?void 0:a.value;t(i),p&&p()}),[t,p]),m=s.i18n.translate("xpack.aiops.changePointDetection.selectSpitFieldLabel",{defaultMessage:"Split field"});return Object(r.jsx)(o.EuiFormRow,{fullWidth:!0,label:a?void 0:m},Object(r.jsx)(o.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:a?m:void 0,singleSelection:{asPlainText:!0},options:g,selectedOptions:j,onChange:h,isClearable:!0,"data-test-subj":"aiopsChangePointSplitField",renderOption:d}))}))},71:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var i=a(0),n=a(1),s=a(2),o=a(44),l=a(52),c=a(43),r=a(14),u=a.n(r),d=a(41),p=a(49);const b={name:"1v0pok0",styles:"min-width:300px"},g=()=>{const[,e]=Object(o.c)("_g"),{dataView:t}=Object(d.c)(),[a,r]=Object(l.b)(p.a,c.c.EXCLUDE),g=Object(c.g)({timeRangeSelector:void 0!==t.timeFieldName,autoRefreshSelector:!0}),j=Object(n.useCallback)((t=>{e({time:{from:u()(t.start.epoch).toISOString(),to:u()(t.end.epoch).toISOString()}})}),[e]),h=Object(n.useMemo)((()=>void 0!==t.timeFieldName&&""!==t.timeFieldName),[t.timeFieldName]);return Object(i.jsx)(s.EuiPageHeader,{pageTitle:Object(i.jsx)("div",{css:b},t.getName()),rightSideItems:[Object(i.jsx)(s.EuiFlexGroup,{gutterSize:"s","data-test-subj":"aiopsTimeRangeSelectorSection"},h?Object(i.jsx)(s.EuiFlexItem,{grow:!1},Object(i.jsx)(c.d,{frozenDataPreference:a,setFrozenDataPreference:r,dataView:t,query:void 0,disabled:!1,timefilter:g,callback:j})):null,Object(i.jsx)(c.b,{isAutoRefreshOnly:!h,showRefresh:!h,width:"full",flexGroup:!1}))]})}}}]);