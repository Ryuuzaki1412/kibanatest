/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[3],{115:function(e,t,a){var s=a(116),i=a(117),l=a(118),o=a(119);e.exports=function(e,t,a){return e=o(e),a=null==a?0:s(l(a),0,e.length),t=i(t),e.slice(a,a+t.length)==t}},116:function(e,t){e.exports=function(e,t,a){return e==e&&(void 0!==a&&(e=e<=a?e:a),void 0!==t&&(e=e>=t?e:t)),e}},117:function(e,t,a){e.exports=a(17)(3372)},118:function(e,t,a){e.exports=a(17)(3362)},119:function(e,t,a){e.exports=a(17)(3371)},120:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(25),i=a(1),l=s.__importDefault(a(121));t.default=function(e,t){void 0===t&&(t=200);var a=i.useState(e),s=a[0],o=a[1],n=i.useRef(),r=i.useRef(null),u=i.useRef(0);return i.useEffect((function(){if(n.current)r.current=e,u.current=!0;else{o(e);var a=function(){u.current?(u.current=!1,o(r.current),n.current=setTimeout(a,t)):n.current=void 0};n.current=setTimeout(a,t)}}),[e]),l.default((function(){n.current&&clearTimeout(n.current)})),s}},121:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(25),i=a(1),l=s.__importDefault(a(122));t.default=function(e){var t=i.useRef(e);t.current=e,l.default((function(){return function(){return t.current()}}))}},122:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(1);t.default=function(e){s.useEffect(e,[])}},123:function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(124);case"v8light":return a(126)}},124:function(e,t,a){var s=a(73),i=a(125);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},125:function(e,t,a){(t=a(74)(!1)).push([e.i,".unifiedFieldList__fieldPopover__fieldPopoverPanel{max-width:400px!important;min-width:260px!important}",""]),e.exports=t},126:function(e,t,a){var s=a(73),i=a(127);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);s(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},127:function(e,t,a){(t=a(74)(!1)).push([e.i,".unifiedFieldList__fieldPopover__fieldPopoverPanel{max-width:400px!important;min-width:260px!important}",""]),e.exports=t},53:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return n}));var s=a(1),i=a(0);const l=Object(s.createContext)(void 0),o=({children:e})=>{const[t,a]=Object(s.useState)(null),[o,n]=Object(s.useState)(null),[r,u]=Object(s.useState)(null),[c,d]=Object(s.useState)(null),p=Object(s.useMemo)((()=>r||t||void 0),[t,r]),b=Object(s.useMemo)((()=>c||o||void 0),[c,o]),g=Object(s.useMemo)((()=>({pinnedSignificantItem:t,setPinnedSignificantItem:a,pinnedGroup:o,setPinnedGroup:n,selectedSignificantItem:r,setSelectedSignificantItem:u,selectedGroup:c,setSelectedGroup:d,currentSelectedSignificantItem:p,currentSelectedGroup:b,clearAllRowState:()=>{a(null),n(null),u(null),d(null)}})),[t,a,o,n,r,u,c,d,p,b]);return Object(i.jsx)(l.Provider,{value:g},e)},n=()=>{const e=Object(s.useContext)(l);if(void 0===e)throw new Error("useLogRateAnalysisResultsTableRowContext was used outside of its Provider");return e}},94:function(e,t,a){"use strict";a.d(t,"a",(function(){return Me}));var s=a(12),i=a(1),l=a.n(i),o=a(2),n=a(11),r=a(13),u=a(69),c=a(77),d=a(60),p=a.n(d),b=a(84),g=a(39),j=a(96),f=a(0);const m=({brushSelectionUpdateHandler:e,documentCountStats:t,documentCountStatsSplit:a,documentCountStatsSplitLabel:s="",isBrushCleared:i,totalCount:l,sampleProbability:n,initialAnalysisStart:r,barColorOverride:u,barHighlightColorOverride:c,windowParameters:d,incomingInitialAnalysisStart:m,...O})=>{var x,y;const{data:h,uiSettings:v,fieldFormats:T,charts:S}=Object(g.b)(),C=Object.keys(null!==(x=null==t?void 0:t.buckets)&&void 0!==x?x:{}).map((e=>+e)),R=Object.keys(null!==(y=null==a?void 0:a.buckets)&&void 0!==y?y:{}).map((e=>+e)),E=Math.min(...C,...R),I=Math.max(...C,...R);if(void 0===t||void 0===t.buckets||void 0===E||void 0===I)return void 0!==l?Object(f.jsx)(j.a,{totalCount:l,sampleProbability:n}):null;const A=Object.entries(t.buckets).map((([e,t])=>({time:+e,value:t})));let k;return void 0!==(null==a?void 0:a.buckets)&&(k=Object.entries(null==a?void 0:a.buckets).map((([e,t])=>({time:+e,value:t})))),Object(f.jsx)(o.EuiFlexGroup,{gutterSize:"m",direction:"column"},Object(f.jsx)(o.EuiFlexItem,null,Object(f.jsx)(j.a,{totalCount:l,sampleProbability:n})),void 0!==t.interval&&Object(f.jsx)(o.EuiFlexItem,null,Object(f.jsx)(b.a,p()({dependencies:{data:h,uiSettings:v,fieldFormats:T,charts:S},brushSelectionUpdateHandler:e,chartPoints:A,chartPointsSplit:k,timeRangeEarliest:E,timeRangeLatest:I,interval:t.interval,chartPointsSplitLabel:s,isBrushCleared:i,autoAnalysisStart:r,barColorOverride:u,barHighlightColorOverride:c},O))))};var O=a(120),x=a.n(O),y=a(40),h=a(115),v=a.n(h);function T(e,t){return void 0===t?"":`${e}${Array.isArray(t)?t.join(""):t}`}const S={ADD_SIGNIFICANT_ITEMS:"add_significant_items",ADD_SIGNIFICANT_ITEMS_HISTOGRAM:"add_significant_items_histogram",ADD_SIGNIFICANT_ITEMS_GROUP:"add_significant_items_group",ADD_SIGNIFICANT_ITEMS_GROUP_HISTOGRAM:"add_significant_items_group_histogram",ADD_SIGNIFICANT_TERMS:"add_significant_terms",ADD_SIGNIFICANT_TERMS_HISTOGRAM:"add_significant_terms_histogram",ADD_SIGNIFICANT_TERMS_GROUP:"add_significant_terms_group",ADD_SIGNIFICANT_TERMS_GROUP_HISTOGRAM:"add_significant_terms_group_histogram",ADD_ERROR:"add_error",PING:"ping",RESET_ALL:"reset_all",RESET_ERRORS:"reset_errors",RESET_GROUPS:"reset_groups",SET_ZERO_DOCS_FALLBACK:"set_zero_docs_fallback",UPDATE_LOADING_STATE:"update_loading_state"},C={ccsWarning:!1,significantItems:[],significantItemsGroups:[],errors:[],loaded:0,loadingState:"",zeroDocsFallback:!1};function R(e,t){if(Array.isArray(t))return t.reduce(R,e);switch(t.type){case S.ADD_SIGNIFICANT_ITEMS:return{...e,significantItems:[...e.significantItems,...t.payload]};case S.ADD_SIGNIFICANT_ITEMS_HISTOGRAM:const a=e.significantItems.map((e=>{const a=t.payload.find((t=>t.fieldName===e.fieldName&&t.fieldValue===e.fieldValue));return a&&(e.histogram=a.histogram),e}));return{...e,significantItems:a};case S.ADD_SIGNIFICANT_ITEMS_GROUP:return{...e,significantItemsGroups:t.payload};case S.ADD_SIGNIFICANT_ITEMS_GROUP_HISTOGRAM:const s=e.significantItemsGroups.map((e=>{const a=t.payload.find((t=>t.id===e.id));return a&&(e.histogram=a.histogram),e}));return{...e,significantItemsGroups:s};case S.ADD_ERROR:return{...e,errors:[...e.errors,t.payload]};case S.RESET_ERRORS:return{...e,errors:[]};case S.RESET_GROUPS:return{...e,significantItemsGroups:[]};case S.RESET_ALL:return C;case S.UPDATE_LOADING_STATE:return{...e,...t.payload};case S.SET_ZERO_DOCS_FALLBACK:return{...e,zeroDocsFallback:t.payload};default:return e}}var E=a(5),I=a(50),A=a(64),k=a(70),M=a(86);const F={HIGH:n.i18n.translate("xpack.aiops.correlations.highImpactText",{defaultMessage:"High"}),MEDIUM:n.i18n.translate("xpack.aiops.correlations.mediumImpactText",{defaultMessage:"Medium"}),LOW:n.i18n.translate("xpack.aiops.correlations.lowImpactText",{defaultMessage:"Low"}),VERY_LOW:n.i18n.translate("xpack.aiops.correlations.veryLowImpactText",{defaultMessage:"Very low"})};function w(e,t){return null===e?null:t?{impact:F.VERY_LOW,color:"default"}:e>=0&&e<1e-6?{impact:F.HIGH,color:"danger"}:e>=1e-6&&e<.001?{impact:F.MEDIUM,color:"warning"}:e>=.001&&e<.02?{impact:F.LOW,color:"default"}:null}var _=a(53),P=a(57);a(123);const L=({isOpen:e,closePopover:t,renderHeader:a,renderContent:s,...i})=>{let n=null,r=null;if(e){try{n=(null==a?void 0:a())||null}catch(e){console.error(e)}try{r=(null==s?void 0:s())||null}catch(e){console.error(e)}}return Object(f.jsx)(o.EuiPopover,p()({ownFocus:!0,isOpen:e,closePopover:t,display:"block",anchorPosition:"rightUp","data-test-subj":"fieldPopover",panelClassName:"unifiedFieldList__fieldPopover__fieldPopoverPanel"},i),e&&Object(f.jsx)(l.a.Fragment,null,r&&n?Object(f.jsx)(o.EuiPopoverTitle,null,n):n,r))},N=({field:e,closePopover:t,buttonAddFieldToWorkspaceProps:a,buttonAddFilterProps:s,buttonEditFieldProps:i,buttonDeleteFieldProps:l,onAddFieldToWorkspace:r,onAddFilter:u,onEditField:c,onDeleteField:d})=>{var b,g,j,m;if(!e)return null;const O=n.i18n.translate("unifiedFieldList.fieldPopover.addFieldToWorkspaceLabel",{defaultMessage:'Add "{field}" field',values:{field:e.displayName}}),x=n.i18n.translate("unifiedFieldList.fieldPopover.addExistsFilterLabel",{defaultMessage:"Filter for field present"}),y=n.i18n.translate("unifiedFieldList.fieldPopover.editFieldLabel",{defaultMessage:"Edit data view field"}),h=n.i18n.translate("unifiedFieldList.fieldPopover.deleteFieldLabel",{defaultMessage:"Delete data view field"});return Object(f.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(f.jsx)(o.EuiFlexItem,{grow:!0},Object(f.jsx)(o.EuiTitle,{size:"xxs"},Object(f.jsx)("h5",{className:"eui-textBreakWord"},e.displayName))),r&&Object(f.jsx)(o.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_addField"},Object(f.jsx)(o.EuiToolTip,{content:null!==(b=null==a?void 0:a["aria-label"])&&void 0!==b?b:O},Object(f.jsx)(o.EuiButtonIcon,p()({"data-test-subj":`fieldPopoverHeader_addField-${e.name}`,"aria-label":O},a||{},{iconType:"plusInCircle",onClick:()=>{t(),r(e)}})))),u&&e.filterable&&!e.scripted&&Object(f.jsx)(o.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_addExistsFilter"},Object(f.jsx)(o.EuiToolTip,{content:null!==(g=null==s?void 0:s["aria-label"])&&void 0!==g?g:x},Object(f.jsx)(o.EuiButtonIcon,p()({"data-test-subj":`fieldPopoverHeader_addExistsFilter-${e.name}`,"aria-label":x},s||{},{iconType:"filter",onClick:()=>{t(),u("_exists_",e.name,"+")}})))),c&&(e.isRuntimeField||!["unknown","unknown_selected"].includes(e.type))&&Object(f.jsx)(o.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_editField"},Object(f.jsx)(o.EuiToolTip,{content:null!==(j=null==i?void 0:i["aria-label"])&&void 0!==j?j:y},Object(f.jsx)(o.EuiButtonIcon,p()({"data-test-subj":`fieldPopoverHeader_editField-${e.name}`,"aria-label":y},i||{},{iconType:"pencil",onClick:()=>{t(),c(e.name)}})))),d&&e.isRuntimeField&&Object(f.jsx)(o.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_deleteField"},Object(f.jsx)(o.EuiToolTip,{content:null!==(m=null==l?void 0:l["aria-label"])&&void 0!==m?m:h},Object(f.jsx)(o.EuiButtonIcon,p()({"data-test-subj":`fieldPopoverHeader_deleteField-${e.name}`,"aria-label":h},l||{},{color:"danger",iconType:"trash",onClick:()=>{t(),d(e.name)}})))))},G=()=>Object(f.jsx)(i.Fragment,null),D=l.a.lazy((()=>a.e(6).then(a.bind(null,130)))),V=l.a.lazy((()=>Promise.all([a.e(6),a.e(12)]).then(a.bind(null,141)))),z=e=>Object(f.jsx)(l.a.Suspense,{fallback:Object(f.jsx)(G,null)},Object(f.jsx)(V,e)),B=e=>Object(f.jsx)(l.a.Suspense,{fallback:Object(f.jsx)(G,null)},Object(f.jsx)(D,e));var H=a(14),q=a.n(H);const U=Object(o.euiPaletteColorBlind)()[0],$={color:"accent",textProps:{color:"accent"}},Q=({dataView:e,field:t,fieldName:a,fieldValue:s,fieldStatsServices:n,timeRangeMs:u,dslQuery:c})=>{const[d,b]=Object(i.useState)(),g=Object(i.useMemo)((()=>{if(u)return{from:q()(u.from).toISOString(),to:q()(u.to).toISOString()};const e=q()();return{from:e.toISOString(),to:e.toISOString()}}),[u]),j=Object(i.useCallback)((e=>{b(e)}),[]),m=Object(i.useMemo)((()=>{const e={needToDisplayIndividualStat:!1,percentage:"< 1%"};if(void 0===d)return e;const{topValues:t,sampledValues:i}=d;if(-1===(null!=t&&t.buckets&&Array.isArray(t.buckets)?t.buckets.findIndex((e=>e.key===s)):null)&&void 0!==a&&void 0!==s){var l;e.needToDisplayIndividualStat=!0;const a=null!=t&&t.buckets&&Array.isArray(t.buckets)?t.buckets:[];let s;const o=a.some((e=>!Number.isInteger(e.count/(null!=i?i:5e3))));a.forEach((e=>{const t=function(e,t,a){const s=t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}`:"";return Number(s)}(e.count,null!=i?i:5e3,o);(void 0===s||t<s)&&(s=t)})),e.percentage=`< ${null!==(l=s)&&void 0!==l?l:1}%`}return e}),[d,a,s]),O=Object(i.useCallback)((e=>"other"===e.type?{color:"primary"}:s===e.fieldValue?$:{}),[s]);if(!(g&&Object(P.a)(e)&&t))return null;const x=e.getFormatterForField(t);return Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(z,{key:t.name,services:n,dslQuery:null!=c?c:{match_all:{}},fromDate:g.from,toDate:g.to,dataViewOrDataViewId:e,field:t,"data-test-subj":`mlAiOpsFieldStatsPopoverContent ${t.name}`,color:U,onStateChange:j,overrideFieldTopValueBar:O}),m.needToDisplayIndividualStat?Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(o.EuiHorizontalRule,{margin:"s"}),Object(f.jsx)(o.EuiText,{size:"xs",color:"subdued"},Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.fieldContextPopover.notTopTenValueMessage",defaultMessage:"Selected term is not in the top 10"})),Object(f.jsx)(o.EuiSpacer,{size:"s"}),Object(f.jsx)(B,p()({field:t,fieldValue:s,formattedPercentage:m.percentage,formattedFieldValue:x.convert(s),progressValue:100,count:0,overrideFieldTopValueBar:O,"data-test-subj":"aiopsNotInTopTenFieldTopValueBucket"},$))):null)};function K({dataView:e,dslQuery:t,fieldName:a,fieldValue:s,fieldStatsServices:l,timeRangeMs:r}){const[u,c]=Object(i.useState)(!1),d=Object(k.a)(),p=Object(i.useCallback)((()=>c(!1)),[]),b=Object(i.useMemo)((()=>Object(P.a)(a)?e.getFieldByName(a):void 0),[a,e]),g=Object(f.jsx)(o.EuiToolTip,{content:n.i18n.translate("xpack.aiops.fieldContextPopover.descriptionTooltipContent",{defaultMessage:"Show top field values"})},Object(f.jsx)(o.EuiButtonIcon,{iconType:"inspect",onClick:e=>{c(!u)},"aria-label":n.i18n.translate("xpack.aiops.fieldContextPopover.topFieldValuesAriaLabel",{defaultMessage:"Show top field values"}),"data-test-subj":"aiopsContextPopoverButton",css:Object(f.css)({marginLeft:d.euiSizeXS},"","")}));return b?Object(f.jsx)(L,{isOpen:u,closePopover:p,button:g,renderHeader:()=>Object(f.jsx)(N,{field:b,closePopover:p}),renderContent:()=>Object(f.jsx)(Q,{field:b,fieldName:a,fieldValue:s,dataView:e,fieldStatsServices:l,timeRangeMs:r,dslQuery:t})}):null}var W={name:"1oaeivz",styles:"margin-right:8px"},Y={name:"f3vz0n",styles:"font-weight:500"};const J=({iconType:e,dataTestSubjPostfix:t,isDisabled:a,label:s,tooltipText:i,onClick:n})=>{const r=Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(o.EuiIcon,{type:e,css:W}),s),u=a?Object(f.jsx)(o.EuiText,{"data-test-subj":`aiopsTableActionButton${t} disabled`,size:"s",color:"subdued","aria-label":i,css:Y},r):Object(f.jsx)(o.EuiLink,{"data-test-subj":`aiopsTableActionButton${t} enabled`,onClick:n,color:"text","aria-label":i},r);return i?Object(f.jsx)(o.EuiToolTip,{content:i},u):u};var X=a(16);const Z=e=>Object(I.b)(e)?`${Object(X.escapeKuery)(e.fieldName)}:${Object(X.escapeKuery)(String(e.fieldValue))}`:[...e.groupItemsSortedByUniqueness.map((({fieldName:e,fieldValue:t})=>`${Object(X.escapeKuery)(e)}:${Object(X.escapeKuery)(String(t))}`))].join(" AND "),ee=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.linksMenu.copyToClipboardButtonLabel",{defaultMessage:"Copy to clipboard"}),te=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.linksMenu.copyToClipboardSignificantItemMessage",{defaultMessage:"Copy field/value pair as KQL syntax to clipboard"}),ae=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.linksMenu.copyToClipboardGroupMessage",{defaultMessage:"Copy group items as KQL syntax to clipboard"}),se=()=>({render:e=>{const t=Object(I.b)(e)?te:ae;return Object(f.jsx)(o.EuiToolTip,{content:t},Object(f.jsx)(o.EuiCopy,{textToCopy:Z(e)},(e=>Object(f.jsx)(J,{dataTestSubjPostfix:"CopyToClipboard",iconType:"copyClipboard",isDisabled:!1,label:ee,onClick:e}))))}});var ie=a(47);const le=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.linksMenu.viewInDiscover",{defaultMessage:"View in Discover"}),oe=e=>{var t;const{application:a,share:s,data:l}=Object(g.b)(),o=Object(i.useMemo)((()=>s.url.locators.get("DISCOVER_APP_LOCATOR")),[s.url.locators]),r=Object(i.useMemo)((()=>{var t;return null!==(t=a.capabilities.discover)&&void 0!==t&&t.show?o?e?void 0:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.autoGeneratedDiscoverLinkErrorMessage",{defaultMessage:"Unable to link to Discover; no data view exists for this index"}):n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.discoverLocatorMissingErrorMessage",{defaultMessage:"No locator for Discover detected"}):n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.discoverNotEnabledErrorMessage",{defaultMessage:"Discover is not enabled"})}),[null===(t=a.capabilities.discover)||void 0===t?void 0:t.show,e,o]);return{render:t=>{const s=r||le;return Object(f.jsx)(J,{dataTestSubjPostfix:"Discover",iconType:"discoverApp",isDisabled:void 0!==r,label:le,tooltipText:s,onClick:async()=>{const s=await(async t=>{if(void 0!==o)return await o.getRedirectUrl({indexPatternId:e,timeRange:l.query.timefilter.timefilter.getTime(),filters:l.query.filterManager.getFilters(),query:{language:ie.a.KUERY,query:Z(t)}})})(t);"string"==typeof s&&await a.navigateToUrl(s)}})}}},ne=e=>Object(I.b)(e)&&e.type===I.a.LOG_PATTERN,re=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.linksMenu.viewInLogPatternAnalysis",{defaultMessage:"View in Log Pattern Analysis"}),ue=e=>{const{application:t,share:a,data:s}=Object(g.b)(),l=Object(i.useMemo)((()=>a.url.locators.get("ML_APP_LOCATOR")),[a.url.locators]),o=Object(i.useMemo)((()=>l?e?void 0:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.autoGeneratedLogPatternAnalysisLinkErrorMessage",{defaultMessage:"Unable to link to Log Pattern Analysis; no data view exists for this index"}):n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.mlLocatorMissingErrorMessage",{defaultMessage:"No locator for Log Pattern Analysis detected"})),[e,l]);return{render:a=>{const i=o||re,r=void 0!==o||ne(a);return Object(f.jsx)(J,{dataTestSubjPostfix:"LogPatternAnalysis",iconType:"logstashQueue",isDisabled:r,label:re,tooltipText:ne(a)?n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.logPatternLinkNotAvailableTooltipMessage",{defaultMessage:"This link is not available if the table item is a log pattern itself."}):i,onClick:async()=>{if(!ne(a)){const i=await(async t=>{if(void 0!==l){const a=Z(t),i=Object(X.fromKueryExpression)(a),o=Object(X.toElasticsearchQuery)(i),n={logCategorization:{filters:s.query.filterManager.getFilters(),searchQuery:o,searchQueryLanguage:ie.a.KUERY,searchString:Z(t)}};return await l.getUrl({page:"aiops/log_categorization",pageState:{index:e,timeRange:s.query.timefilter.timefilter.getTime(),appState:n}})}})(a);"string"==typeof i&&await t.navigateToUrl(i)}}})}}},ce="120px",de=[5,10,20,50];var pe={name:"fa61i",styles:"padding-inline:0px"};const be=({significantItems:e,dataView:t,loading:a,isExpandedRow:u,searchQuery:c,timeRangeMs:d,barColorOverride:p,barHighlightColorOverride:b,zeroDocsFallback:j=!1})=>{const m=Object(k.a)(),O=Object(o.useEuiBackgroundColor)("primary"),x=t.id,{pinnedGroup:y,pinnedSignificantItem:h,selectedGroup:v,selectedSignificantItem:T,setPinnedSignificantItem:S,setSelectedSignificantItem:C}=Object(_.b)(),[R,E]=Object(i.useState)(0),[F,P]=Object(i.useState)(10),[L,N]=Object(i.useState)(j?"doc_count":"pValue"),[G,D]=Object(i.useState)(j?"desc":"asc"),{data:V,uiSettings:z,fieldFormats:B,charts:H}=Object(g.b)(),q=Object(i.useMemo)((()=>({uiSettings:z,dataViews:V.dataViews,data:V,fieldFormats:B,charts:H})),[z,V,B,H]),U=se(),$=oe(x),Q=ue(x),W=[{"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnFieldName",field:"fieldName",name:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.fieldNameLabel",{defaultMessage:"Field name"}),render:(e,{fieldName:a,fieldValue:s,key:i,type:r,doc_count:u})=>{const p=r===I.a.KEYWORD?c:Object(A.b)(a,[{key:i,count:u,examples:[]}]);return Object(f.jsx)(l.a.Fragment,null,r===I.a.KEYWORD&&Object(f.jsx)(K,{dataView:t,fieldName:a,fieldValue:r===I.a.KEYWORD?s:i,fieldStatsServices:q,dslQuery:p,timeRangeMs:d}),r===I.a.LOG_PATTERN&&Object(f.jsx)(o.EuiToolTip,{content:n.i18n.translate("xpack.aiops.fieldContextPopover.descriptionTooltipLogPattern",{defaultMessage:"The field value for this field shows an example of the identified significant text field pattern."})},Object(f.jsx)(o.EuiIcon,{type:"aggregate","data-test-subj":"aiopsLogPatternIcon",css:Object(f.css)({marginLeft:m.euiSizeS,marginRight:m.euiSizeXS},"",""),size:"m"})),Object(f.jsx)("span",{title:a},a))},sortable:!0,truncateText:!0,valign:"middle"},{"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnFieldValue",field:"fieldValue",name:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.fieldValueLabel",{defaultMessage:"Field value"}),render:(e,{fieldValue:t,type:a})=>Object(f.jsx)("span",{title:String(t)},"keyword"===a?String(t):Object(f.jsx)(o.EuiText,{size:"xs"},Object(f.jsx)(o.EuiCode,{language:"log",transparentBackground:!0,css:pe},String(t)))),sortable:!0,textOnly:!0,truncateText:{lines:3},valign:"middle"},{"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnLogRate",width:ce,field:"pValue",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.logRateColumnTooltip",{defaultMessage:"A visual representation of the impact of the field on the message rate difference"})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTable.logRateLabel",defaultMessage:"Log rate"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,{histogram:t,fieldName:s,fieldValue:i})=>Object(f.jsx)(M.a,{chartData:t,isLoading:a&&void 0===t,label:`${s}:${i}`,barColorOverride:p,barHighlightColorOverride:b}),sortable:!1,valign:"middle"},{"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnDocCount",width:ce,field:"doc_count",name:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.docCountLabel",{defaultMessage:"Doc count"}),sortable:!0,valign:"middle"}];j||(W.push({"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnPValue",width:ce,field:"pValue",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.pValueColumnTooltip",{defaultMessage:"The significance of changes in the frequency of values; lower values indicate greater change; sorting this column will automatically do a secondary sort on the doc count column."})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTable.pValueLabel",defaultMessage:"p-value"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:e=>{var t;return null!==(t=null==e?void 0:e.toPrecision(3))&&void 0!==t?t:"--"},sortable:!0,valign:"middle"}),W.push({"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnImpact",width:ce,field:"pValue",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.impactLabelColumnTooltip",{defaultMessage:"The level of impact of the field on the message rate difference."})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTable.impactLabel",defaultMessage:"Impact"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,{pValue:t})=>{if("number"!=typeof t)return"--";const a=w(t);return a?Object(f.jsx)(o.EuiBadge,{color:a.color},a.impact):null},sortable:!0,valign:"middle"})),W.push({"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnAction",name:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.actionsColumnName",{defaultMessage:"Actions"}),actions:[...$?[$]:[],...Q?[Q]:[],U],width:"60px",valign:"middle"}),!0===u&&W.unshift({"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnUnique",width:"40px",field:"unique",name:"",render:(e,{unique:t})=>t?Object(f.jsx)(o.EuiIconTip,{content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.uniqueColumnTooltip",{defaultMessage:"This field/value pair only appears in this group"}),position:"top",type:"asterisk"}):"",sortable:!1,valign:"middle"});const Y=Object(i.useCallback)((e=>{if(e.page){const{index:t,size:a}=e.page;E(t),P(a)}if(e.sort){const{field:t,direction:a}=e.sort;N(t),D(a)}}),[]),{pagination:J,pageOfItems:X,sorting:Z}=Object(i.useMemo)((()=>{var t;const a=R*F,i=null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0;let l=null!=e?e:[];const o=[e=>e&&"string"==typeof e[L]?e[L].toLowerCase():e[L]],n=[G];return"pValue"===L&&(o.push((e=>e.doc_count)),n.push(G)),l=Object(s.orderBy)(e,o,n),{pageOfItems:l.slice(a,a+F),pagination:{pageIndex:R,pageSize:F,totalItemCount:i,pageSizeOptions:de},sorting:{sort:{field:L,direction:G}}}}),[R,F,L,G,e]);Object(i.useEffect)((()=>{(null===T||!X.some((e=>Object(s.isEqual)(e,T))))&&null===h&&X.length>0&&null===v&&null===y&&C(X[0]),null===h||X.some((e=>Object(s.isEqual)(e,h)))||null!==v||null!==y||S(null)}),[v,T,C,S,X,y,h]),Object(i.useEffect)((()=>()=>{C(null),S(null)}),[]);const ee=e=>h&&h.fieldName===e.fieldName&&h.fieldValue===e.fieldValue?{backgroundColor:O}:T&&T.fieldName===e.fieldName&&T.fieldValue===e.fieldValue?{backgroundColor:m.euiColorLightestShade}:{backgroundColor:m.euiColorEmptyShade};return Object(f.jsx)(o.EuiBasicTable,{"data-test-subj":"aiopsLogRateAnalysisResultsTable",compressed:!0,columns:W,items:X,onChange:Y,pagination:J.totalItemCount>J.pageSize?J:void 0,loading:!1,sorting:Z,rowProps:e=>({"data-test-subj":`aiopsLogRateAnalysisResultsTableRow row-${e.fieldName}-${e.fieldValue}`,onClick:()=>{e.fieldName===(null==h?void 0:h.fieldName)&&e.fieldValue===(null==h?void 0:h.fieldValue)?S(null):S(e)},onMouseEnter:()=>{null===h&&C(e)},onMouseLeave:()=>{C(null)},style:ee(e)})})},ge="120px",je=[5,10,20,50],fe=({significantItems:e,groupTableItems:t,loading:a,dataView:u,timeRangeMs:c,searchQuery:d,barColorOverride:p,barHighlightColorOverride:b,zeroDocsFallback:g=!1})=>{const[j,m]=Object(i.useState)(0),[O,x]=Object(i.useState)(10),[y,h]=Object(i.useState)(g?"docCount":"pValue"),[v,T]=Object(i.useState)(g?"desc":"asc"),[S,C]=Object(i.useState)({}),{euiTheme:R}=Object(o.useEuiTheme)(),E=Object(o.euiPaletteColorBlind)(),I=Object(o.useEuiBackgroundColor)("primary"),{pinnedGroup:A,selectedGroup:k,setPinnedGroup:F,setSelectedGroup:P}=Object(_.b)(),L=u.id,N=se(),G=oe(L),D=ue(L),V=[{align:o.RIGHT_ALIGNMENT,width:"40px",isExpander:!0,name:Object(f.jsx)(o.EuiScreenReaderOnly,null,Object(f.jsx)("span",null,n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.expandRowsLabel",{defaultMessage:"Expand rows"}))),render:t=>Object(f.jsx)(o.EuiButtonIcon,{"data-test-subj":"aiopsLogRateAnalysisResultsGroupsTableRowExpansionButton",onClick:()=>(t=>{const s={...S};s[t.id]?delete s[t.id]:s[t.id]=Object(f.jsx)(be,{significantItems:t.groupItemsSortedByUniqueness.reduce(((t,a)=>{const s=e.find((e=>e.fieldName===a.fieldName&&e.fieldValue===a.fieldValue));var i;return void 0!==s&&t.push({...s,unique:(null!==(i=a.duplicate)&&void 0!==i?i:0)<=1}),t}),[]),loading:a,isExpandedRow:!0,dataView:u,timeRangeMs:c,searchQuery:d,barColorOverride:p,barHighlightColorOverride:b}),C(s)})(t),"aria-label":S[t.id]?n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.collapseAriaLabel",{defaultMessage:"Collapse"}):n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.expandAriaLabel",{defaultMessage:"Expand"}),iconType:S[t.id]?"arrowDown":"arrowRight"}),valign:"top"},{"data-test-subj":"aiopsLogRateAnalysisResultsGroupsTableColumnGroup",field:"group",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTableGroups.groupColumnTooltip",{defaultMessage:"Displays up to {maxItemCount} group items sorted by uniqueness and document count. Expand row to see all field/value pairs.",values:{maxItemCount:5}})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTableGroups.groupLabel",defaultMessage:"Group"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,{uniqueItemsCount:t,groupItemsSortedByUniqueness:a})=>{const s=[];for(const e of a){const{fieldName:t,fieldValue:a,duplicate:i}=e;if(s.length>=5)break;s.push(Object(f.jsx)("span",{key:`${t}-id`},Object(f.jsx)(o.EuiBadge,{"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnGroupBadge",color:"hollow"},Object(f.jsx)("span",null,(null!=i?i:0)<=1?"* ":"",`${t}: `),Object(f.jsx)("span",{style:{color:E[2]}},`${a}`)),Object(f.jsx)(o.EuiSpacer,{size:"xs"})))}return a.length>5&&s.push(Object(f.jsx)(o.EuiText,{key:"group-info-id","data-test-subj":"aiopsLogRateAnalysisResultsGroupsTableColumnGroupInfo",color:"subdued",size:"xs"},Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTableGroups.groupItemsInfo",defaultMessage:"Showing {valuesBadges} out of {count} items.",values:{count:a.length,valuesBadges:s.length}}),t>5?Object(f.jsx)(l.a.Fragment,null," ",Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTableGroups.groupUniqueItemsInfo",defaultMessage:"{count, plural, one {# item} other {# items}} unique to this group.",values:{count:t}})):null)),s},sortable:!1,textOnly:!0,valign:"top"},{"data-test-subj":"aiopsLogRateAnalysisResultsGroupsTableColumnLogRate",width:ge,field:"pValue",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTableGroups.logRateColumnTooltip",{defaultMessage:"A visual representation of the impact of the group on the message rate difference."})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTableGroups.logRateLabel",defaultMessage:"Log rate"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,{histogram:t,id:s})=>Object(f.jsx)(M.a,{chartData:t,isLoading:a&&void 0===t,label:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTableGroups.groupLabel",{defaultMessage:"Group"}),barColorOverride:p,barHighlightColorOverride:b}),sortable:!1,valign:"top"},{"data-test-subj":"aiopsLogRateAnalysisResultsGroupsTableColumnDocCount",width:ge,field:"docCount",name:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.docCountLabel",{defaultMessage:"Doc count"}),sortable:!0,valign:"top"}];g||(V.push({"data-test-subj":"aiopsLogRateAnalysisResultsGroupsTableColumnPValue",width:ge,field:"pValue",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTableGroups.pValueColumnTooltip",{defaultMessage:"The significance of changes in the frequency of values; lower values indicate greater change; sorting this column will automatically do a secondary sort on the doc count column."})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTableGroups.pValueLabel",defaultMessage:"p-value"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:e=>{var t;return null!==(t=null==e?void 0:e.toPrecision(3))&&void 0!==t?t:"--"},sortable:!0,valign:"top"}),V.push({"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnImpact",width:ge,field:"pValue",name:Object(f.jsx)(o.EuiToolTip,{position:"top",content:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTableGroups.impactLabelColumnTooltip",{defaultMessage:"The level of impact of the group on the message rate difference"})},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.resultsTableGroups.impactLabel",defaultMessage:"Impact"}),Object(f.jsx)(o.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:(e,{pValue:t})=>{if(!t)return"--";const a=w(t);return a?Object(f.jsx)(o.EuiBadge,{color:a.color},a.impact):null},sortable:!0,valign:"top"})),V.push({"data-test-subj":"aiopsLogRateAnalysisResultsTableColumnAction",name:n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.actionsColumnName",{defaultMessage:"Actions"}),actions:[...G?[G]:[],...D?[D]:[],N],width:"60px",valign:"top"});const z=Object(i.useCallback)((e=>{if(e.page){const{index:t,size:a}=e.page;m(t),x(a)}if(e.sort){const{field:t,direction:a}=e.sort;h(t),T(a)}}),[]),{pagination:B,pageOfItems:H,sorting:q}=Object(i.useMemo)((()=>{var e;const a=j*O,i=null!==(e=null==t?void 0:t.length)&&void 0!==e?e:0;let l=null!=t?t:[];const o=[e=>e&&"string"==typeof e[y]?e[y].toLowerCase():e[y]],n=[v];return"pValue"===y&&(o.push((e=>e.docCount)),n.push(v)),l=Object(s.orderBy)(t,o,n),{pageOfItems:l.slice(a,a+O),pagination:{pageIndex:j,pageSize:O,totalItemCount:i,pageSizeOptions:je},sorting:{sort:{field:y,direction:v}}}}),[j,O,y,v,t]);Object(i.useEffect)((()=>{(null===k||!H.some((e=>Object(s.isEqual)(e,k))))&&null===A&&H.length>0&&P(H[0]),null===A||H.some((e=>Object(s.isEqual)(e,A)))||F(null)}),[k,P,F,H,A]),Object(i.useEffect)((()=>()=>{P(null),F(null)}),[]);const U=e=>A&&A.id===e.id?{backgroundColor:I}:k&&k.id===e.id?{backgroundColor:R.colors.lightestShade}:{backgroundColor:R.colors.emptyShade};return Object(f.jsx)(o.EuiBasicTable,{"data-test-subj":"aiopsLogRateAnalysisResultsGroupsTable",compressed:!0,columns:V,items:H,itemId:"id",itemIdToExpandedRowMap:S,onChange:z,pagination:B.totalItemCount>B.pageSize?B:void 0,loading:!1,sorting:q,rowProps:e=>({"data-test-subj":`aiopsLogRateAnalysisResultsGroupsTableRow row-${e.id}`,onClick:()=>{e.id===(null==A?void 0:A.id)?F(null):F(e)},onMouseEnter:()=>{null===A&&P(e)},onMouseLeave:()=>{P(null)},style:U(e)})})},me=({disabled:e,onClick:t,tooltipContent:a})=>{const s=Object(f.jsx)(o.EuiButton,{"data-test-subj":"aiopsFieldFilterApplyButton"+(e?" disabled":""),size:"s",onClick:t,disabled:e},Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldFilterApplyButtonLabel",defaultMessage:"Apply"}));return a?Object(f.jsx)(o.EuiToolTip,{position:"left",content:a},s):s};var Oe={name:"1r962iv",styles:"padding:4px"};const xe=({disabled:e,disabledApplyButton:t,uniqueFieldNames:a,onChange:s})=>{const u=Object(o.useEuiTheme)(),c=Object(i.useMemo)((()=>Object(f.css)(Object(o.euiYScrollWithShadows)(u,{})," max-height:400px;","")),[u]),[d,p]=Object(i.useState)(!1),[b,g]=Object(i.useState)(""),[j,m]=Object(i.useState)([]),O=(e,t)=>{let a=[...j];t?a=j.filter((t=>!e.includes(t))):a.push(...e),m(a),p(!0)},[x,y]=Object(i.useState)(!1),h=()=>y(!1),v=Object(i.useMemo)((()=>a.filter((e=>-1!==e.toLowerCase().indexOf(b.toLowerCase())))),[b,a]);Object(i.useEffect)((()=>{m((e=>e.filter((e=>a.includes(e)))))}),[a]);const T=a.length-j.length;return Object(f.jsx)(o.EuiPopover,{"data-test-subj":"aiopsFieldFilterPopover",anchorPosition:"downLeft",panelPaddingSize:"s",button:Object(f.jsx)(o.EuiButton,{"data-test-subj":"aiopsFieldFilterButton",onClick:()=>y((e=>!e)),disabled:e,size:"s",iconType:"arrowDown",iconSide:"right",iconSize:"s",color:"text"},Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldFilterButtonLabel",defaultMessage:"Filter fields"})),isOpen:x,closePopover:h},Object(f.jsx)(o.EuiPopoverTitle,null,Object(f.jsx)(o.EuiText,{size:"xs",color:"subdued",style:{maxWidth:"400px"}},Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldFilterHelpText",defaultMessage:"Deselect non-relevant fields to remove them from groups and click the Apply button to rerun the grouping.  Use the search bar to filter the list, then select/deselect multiple fields with the actions below."})),Object(f.jsx)(o.EuiSpacer,{size:"s"}),Object(f.jsx)(o.EuiFieldText,{compressed:!0,placeholder:n.i18n.translate("xpack.aiops.analysis.fieldSelectorPlaceholder",{defaultMessage:"Search"}),"aria-label":n.i18n.translate("xpack.aiops.analysis.fieldSelectorAriaLabel",{defaultMessage:"Filter fields"}),value:b,onChange:e=>g(e.currentTarget.value),"data-test-subj":"aiopsFieldSelectorSearch"})),Object(f.jsx)("div",{css:c,"data-test-subj":"aiopsFieldSelectorFieldNameList"},v.map((e=>Object(f.jsx)("div",{key:e,css:Oe},Object(f.jsx)(o.EuiSwitch,{"data-test-subj":"aiopsFieldSelectorFieldNameListItem"+(j.includes(e)?"":" checked"),className:"euiSwitch--mini",compressed:!0,label:e,onChange:t=>O([e],t.target.checked),checked:!j.includes(e)}))))),Object(f.jsx)(o.EuiPopoverFooter,null,Object(f.jsx)(o.EuiFlexGroup,{gutterSize:"s",responsive:!1,justifyContent:"spaceBetween",alignItems:"center"},Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(o.EuiButtonEmpty,{size:"xs",flush:"left",onClick:()=>O(v,!0),disabled:b.length>0&&0===v.length,"data-test-subj":"aiopsFieldSelectorSelectAllFieldsButton"},b.length>0?Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldSelector.selectAllSearchedFields",defaultMessage:"Select filtered fields"}):Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldSelector.selectAllFields",defaultMessage:"Select all fields"}))),Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(o.EuiButtonEmpty,{size:"xs",flush:"right",onClick:()=>O(v,!1),disabled:b.length>0&&0===v.length,"data-test-subj":"aiopsFieldSelectorDeselectAllFieldsButton"},b.length>0?Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldSelector.deselectAllSearchedFields",defaultMessage:"Deselect filtered fields"}):Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.fieldSelector.deselectAllFields",defaultMessage:"Deselect all fields"})))),Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(me,{onClick:()=>{s(j),g(""),y(!1),h()},disabled:t||T<2||!d,tooltipContent:T<2?n.i18n.translate("xpack.aiops.analysis.fieldSelectorNotEnoughFieldsSelected",{defaultMessage:"Grouping requires at least 2 fields to be selected."}):void 0})))))},ye=({analysisType:e,zeroDocsFallback:t})=>{let a,s;if(t||e!==u.a.SPIKE)if(t||e!==u.a.DIP)if(t&&e===u.a.SPIKE)a=n.i18n.translate("xpack.aiops.analysis.analysisTypeSpikeFallbackCallOutTitle",{defaultMessage:"Analysis type: Top items for deviation time range"}),s=n.i18n.translate("xpack.aiops.analysis.analysisTypeSpikeCallOutContentFallback",{defaultMessage:"The baseline time range does not contain any documents. Therefore the results show top log message categories and field values for the deviation time range."});else{if(!t||e!==u.a.DIP)return null;a=n.i18n.translate("xpack.aiops.analysis.analysisTypeDipFallbackCallOutTitle",{defaultMessage:"Analysis type: Top items for baseline time range"}),s=n.i18n.translate("xpack.aiops.analysis.analysisTypeDipCallOutContentFallback",{defaultMessage:"The deviation time range does not contain any documents. Therefore the results show top log message categories and field values for the baseline time range."})}else a=n.i18n.translate("xpack.aiops.analysis.analysisTypeDipCallOutTitle",{defaultMessage:"Analysis type: Log rate dip"}),s=n.i18n.translate("xpack.aiops.analysis.analysisTypeDipCallOutContent",{defaultMessage:'The median log rate in the selected deviation time range is lower than the baseline. Therefore, the analysis results table shows statistically significant items within the baseline time range that are less in number or missing within the deviation time range. The "doc count" column refers to the amount of documents in the baseline time range.'});else a=n.i18n.translate("xpack.aiops.analysis.analysisTypeSpikeCallOutTitle",{defaultMessage:"Analysis type: Log rate spike"}),s=n.i18n.translate("xpack.aiops.analysis.analysisTypeSpikeCallOutContent",{defaultMessage:'The median log rate in the selected deviation time range is higher than the baseline. Therefore, the analysis results table shows statistically significant items within the deviation time range that are contributors to the spike. The "doc count" column refers to the amount of documents in the deviation time range.'});return Object(f.jsx)(o.EuiCallOut,{title:Object(f.jsx)("span",{"data-test-subj":"aiopsAnalysisTypeCalloutTitle"},a),color:"primary",iconType:"pin",size:"s"},Object(f.jsx)(o.EuiText,{size:"s"},s))},he=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.groupedSwitchLabel.groupResults",{defaultMessage:"Smart grouping"}),ve=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.groupedSwitchLabel.groupResultsHelpMessage",{defaultMessage:"Items which are unique to a group are marked by an asterisk (*)."}),Te=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.groupedSwitchLabel.groupResultsOff",{defaultMessage:"Off"}),Se=n.i18n.translate("xpack.aiops.logRateAnalysis.resultsTable.groupedSwitchLabel.groupResultsOn",{defaultMessage:"On"}),Ce="aiopsLogRateAnalysisGroupingOff",Re="aiopsLogRateAnalysisGroupingOn",Ee=({dataView:e,analysisType:t=u.a.SPIKE,earliest:a,isBrushCleared:c,latest:d,stickyHistogram:p,onReset:j,windowParameters:m,searchQuery:O,sampleProbability:h,barColorOverride:S,barHighlightColorOverride:I,onAnalysisCompleted:A,embeddingOrigin:k})=>{var M,F;const{http:w}=Object(g.b)(),{clearAllRowState:P}=Object(_.b)(),[L,N]=Object(i.useState)(),[G,D]=Object(i.useState)(),[V,z]=Object(i.useState)(!1),[B,H]=Object(i.useState)([]),[q,U]=Object(i.useState)([]),[$,Q]=Object(i.useState)(void 0),[K,W]=Object(i.useState)(!1),[Y,J]=Object(i.useState)(Ce),{cancel:X,start:Z,data:ee,isRunning:te,errors:ae}=function(e,t,a,s,l,o){const[n,r]=Object(i.useState)([]),[u,c]=Object(i.useState)(!1),[d,p]=Object(i.useState)(!1),b=(g=l,Object(y.a)(g,["reducer","initialState"])?l:{reducer:T,initialState:""});var g;const[j,f]=Object(i.useReducer)(b.reducer,b.initialState),m=x()(j,100),O=Object(i.useRef)(new AbortController),h=e=>{r((t=>[...t,e]))};return Object(i.useEffect)((()=>()=>O.current.abort()),[]),{cancel:()=>{O.current.abort(),c(!0),p(!1)},data:d?m:j,dispatch:f,errors:n,isCancelled:u,isRunning:d,start:async()=>{if(d)h("Instant restart while running not supported yet.");else{r([]),p(!0),c(!1),O.current=new AbortController;for await(const[i,n]of async function*(e,t,a,s,i,l=!0,o){let n;try{n=(await e.post(t,{signal:s.current.signal,version:a,asResponse:!0,rawResponse:!0,headers:o,...i&&Object.keys(i).length>0?{body:JSON.stringify(i)}:{}})).response}catch(e){return void(yield[e.toString(),void 0])}if(n)if(n.ok){if(null!==n.body){const e=n.body.getReader();let t="";for(;;)try{const{value:a,done:s}=await e.read();if(s)break;const i=`${t}${(new TextDecoder).decode(a)}`,o=l?i.split("\n"):[i],n=l?o.pop():"";t=null!=n?n:"";const r=l?o.map((e=>""===e||v()(e,"event: ")||"data: [DONE]"===e?"[IGNORE]":v()(e,"data: ")?JSON.parse(e.split("data: ")[1]):JSON.parse(e))).filter((e=>"[IGNORE]"!==e)):o;yield[null,r]}catch(e){"AbortError"!==e.name&&(yield[e.toString(),void 0]);break}}}else yield[`Error ${n.status}: ${n.statusText}`,void 0];else yield["Error: Response was undefined",void 0]}(e,t,a,O,s,void 0!==l,o))null!==i?h(i):Array.isArray(n)&&n.length>0&&f(n);p(!1)}}}}(w,"/internal/aiops/log_rate_analysis","2",{start:a,end:d,searchQuery:JSON.stringify(O),timeFieldName:null!==(M=e.timeFieldName)&&void 0!==M?M:"",index:e.getIndexPattern(),grouping:!0,flushFix:!0,...t===u.a.SPIKE?m:{baselineMin:m.deviationMin,baselineMax:m.deviationMax,deviationMin:m.baselineMin,deviationMax:m.baselineMax},overrides:$,sampleProbability:h},{reducer:R,initialState:C},{[E.a.AIOPS_ANALYSIS_RUN_ORIGIN]:k}),{significantItems:se,zeroDocsFallback:ie}=ee;Object(i.useEffect)((()=>U(Object(s.uniq)(se.map((e=>e.fieldName))).sort())),[se]),Object(i.useEffect)((()=>{if(!te){const{loaded:e,remainingFieldCandidates:a,groupsMissing:s}=ee;e<1&&(Array.isArray(a)&&a.length>0||s)?Q({loaded:e,remainingFieldCandidates:a,significantItems:ee.significantItems}):(Q(void 0),A&&A({analysisType:t,significantItems:ee.significantItems,significantItemsGroups:ee.significantItemsGroups}))}}),[te]);const le=Object(i.useMemo)((()=>[...ae,...ee.errors]),[ae,ee.errors]);function oe(e=!1,a=!0){e||(Q(void 0),U([])),a&&(z(!1),J(Ce),P()),N(t),D(m),W(!0)}Object(i.useEffect)((()=>{K&&(Z(),W(!1))}),[K]),Object(i.useEffect)((()=>{N(t),D(m),Z()}),[]);const ne=Object(i.useMemo)((()=>ee.significantItemsGroups.map((({id:e,group:t,docCount:a,histogram:i,pValue:l})=>{const o=Object(s.sortBy)(t,[e=>e.fieldName]),n=[];o.forEach((e=>{const{key:t,type:a,fieldName:s,fieldValue:i,docCount:l,pValue:o,duplicate:r}=e;(null!=r?r:0)<=1&&n.push({key:t,type:a,fieldName:s,fieldValue:i,docCount:l,pValue:o})}));const r=Object(s.sortBy)(t,["duplicate","docCount"]);return{id:e,docCount:a,pValue:l,uniqueItemsCount:Object(s.sortBy)(n,(e=>{var t;return[-1*(null!==(t=e.pValue)&&void 0!==t?t:0),e.docCount]})).length,groupItemsSortedByUniqueness:r,histogram:i}}))),[ee.significantItemsGroups]),re=Object(i.useMemo)((()=>void 0!==G&&!Object(s.isEqual)(G,m)),[G,m]),ue=(null==ee?void 0:ee.significantItems.length)>0,ce=ne.reduce(((e,t)=>e+t.groupItemsSortedByUniqueness.length),0),de=ne.length>0&&ce>0,pe={from:a,to:d},ge=!de&&!V&&0===B.length,je=[{id:Ce,label:Te,"data-test-subj":"aiopsLogRateAnalysisGroupSwitchOff"},{id:Re,label:Se,"data-test-subj":"aiopsLogRateAnalysisGroupSwitchOn"}];return Object(f.jsx)("div",{"data-test-subj":"aiopsLogRateAnalysisResults"},Object(f.jsx)(b.d,{isBrushCleared:c,progress:ee.loaded,progressMessage:null!==(F=ee.loadingState)&&void 0!==F?F:"",isRunning:te,onRefresh:()=>oe(!1),onCancel:X,onReset:j,shouldRerunAnalysis:re},Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(o.EuiFormRow,{display:"columnCompressedSwitch"},Object(f.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(o.EuiText,{size:"xs"},he)),Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(o.EuiButtonGroup,{"data-test-subj":"aiopsLogRateAnalysisGroupSwitch"+(V?" checked":""),buttonSize:"s",isDisabled:ge,legend:"Smart grouping",options:je,idSelected:Y,onChange:e=>{J(e),z(e===Re),P()}}))))),Object(f.jsx)(o.EuiFlexItem,{grow:!1},Object(f.jsx)(xe,{disabled:!V||te,disabledApplyButton:te,uniqueFieldNames:q,onChange:e=>{H(e),Q({loaded:0,remainingFieldCandidates:[],significantItems:ee.significantItems.filter((t=>!e.includes(t.fieldName))),regroupOnly:!0}),oe(!0,!1)}}))),ue&&void 0!==L&&Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(o.EuiSpacer,{size:"s"}),Object(f.jsx)(ye,{analysisType:L,zeroDocsFallback:ie}),Object(f.jsx)(o.EuiSpacer,{size:"xs"})),le.length>0?Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(o.EuiSpacer,{size:"xs"}),Object(f.jsx)(o.EuiCallOut,{title:n.i18n.translate("xpack.aiops.analysis.errorCallOutTitle",{defaultMessage:"The following {errorCount, plural, one {error} other {errors}} occurred running the analysis.",values:{errorCount:le.length}}),color:"warning",iconType:"warning",size:"s"},Object(f.jsx)(o.EuiText,{size:"s"},1===le.length?Object(f.jsx)("p",null,le[0]):Object(f.jsx)("ul",null,le.map(((e,t)=>Object(f.jsx)("li",{key:t},e)))),void 0!==$?Object(f.jsx)("p",null,Object(f.jsx)(o.EuiButton,{"data-test-subj":"aiopsLogRateAnalysisResultsTryToContinueAnalysisButton",size:"s",onClick:()=>oe(!0)},Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.tryToContinueAnalysisButtonText",defaultMessage:"Try to continue analysis"}))):null)),Object(f.jsx)(o.EuiSpacer,{size:"xs"})):null,ue&&V&&de&&Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(o.EuiSpacer,{size:"xs"}),Object(f.jsx)(o.EuiText,{size:"xs"},V?ve:void 0)),Object(f.jsx)(o.EuiSpacer,{size:"xs"}),!te&&!ue&&Object(f.jsx)(o.EuiEmptyPrompt,{"data-test-subj":"aiopsNoResultsFoundEmptyPrompt",title:Object(f.jsx)("h2",null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.noResultsPromptTitle",defaultMessage:"The analysis did not return any results."})),titleSize:"xs",body:Object(f.jsx)("p",null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.noResultsPromptBody",defaultMessage:"Try to adjust the baseline and deviation time ranges and rerun the analysis. If you still get no results, there might be no statistically significant entities contributing to this deviation in log rate."}))}),Object(f.jsx)("div",{style:p?{height:"500px",overflowX:"hidden",overflowY:"auto",paddingTop:"20px"}:void 0},ue&&V?Object(f.jsx)(fe,{significantItems:ee.significantItems,groupTableItems:ne,loading:te,dataView:e,timeRangeMs:pe,searchQuery:O,barColorOverride:S,barHighlightColorOverride:I,zeroDocsFallback:ie}):null,ue&&!V?Object(f.jsx)(be,{significantItems:ee.significantItems,loading:te,dataView:e,timeRangeMs:pe,searchQuery:O,barColorOverride:S,barHighlightColorOverride:I,zeroDocsFallback:ie}):null))},Ie={match_all:{}},Ae={bool:{filter:[],must:[{match_all:{}}],must_not:[]}};var ke={name:"1bxycju",styles:"min-width:100%"};const Me=({dataView:e,setGlobalState:t,initialAnalysisStart:a,timeRange:l,esSearchQuery:d=Ie,stickyHistogram:p,barColorOverride:b,barHighlightColorOverride:g,onAnalysisCompleted:j,onWindowParametersChange:O,embeddingOrigin:x})=>{const[y,h]=Object(i.useState)(),[v,T]=Object(i.useState)(a),[S,C]=Object(i.useState)(!0),[R,E]=Object(i.useState)(u.a.SPIKE);Object(i.useEffect)((()=>{C(void 0===y)}),[y]);const I=Object(i.useRef)(!1);Object(i.useEffect)((()=>{(I.current||void 0!==y)&&(I.current=!0,O&&O(y))}),[O,y]);const A=Object(i.useMemo)((()=>Object(s.isEqual)(d,Ae)?Ie:d),[d]),{currentSelectedSignificantItem:k,currentSelectedGroup:M,setPinnedSignificantItem:F,setPinnedGroup:w,setSelectedSignificantItem:P,setSelectedGroup:L}=Object(_.b)(),{documentStats:N,earliest:G,latest:D}=Object(c.a)(e,"log_rate_analysis",A,t,k,M,void 0,l),{sampleProbability:V,totalCount:z,documentCountStats:B,documentCountStatsCompare:H}=N;return Object(f.jsx)(o.EuiPanel,{hasBorder:!1,hasShadow:!1},void 0!==B&&Object(f.jsx)(m,{brushSelectionUpdateHandler:function(e,t,a){S&&!t||h(e),t&&C(!1),E(a)},documentCountStats:B,documentCountStatsSplit:H,documentCountStatsSplitLabel:(q=k,U=M,q?`${null==q?void 0:q.fieldName}:${null==q?void 0:q.fieldValue}`:U?n.i18n.translate("xpack.aiops.logRateAnalysis.page.documentCountStatsSplitGroupLabel",{defaultMessage:"Selected group"}):void 0),isBrushCleared:S,totalCount:z,sampleProbability:V,initialAnalysisStart:v,barColorOverride:b,barHighlightColorOverride:g}),Object(f.jsx)(o.EuiHorizontalRule,null),void 0!==G&&void 0!==D&&void 0!==y&&Object(f.jsx)(Ee,{dataView:e,analysisType:R,earliest:G,isBrushCleared:S,latest:D,stickyHistogram:p,onReset:function(){h(void 0),F(null),w(null),P(null),L(null),C(!0),T(void 0)},sampleProbability:V,searchQuery:A,windowParameters:y,barColorOverride:b,barHighlightColorOverride:g,onAnalysisCompleted:j,embeddingOrigin:x}),void 0===y&&Object(f.jsx)(o.EuiEmptyPrompt,{color:"subdued",hasShadow:!1,hasBorder:!1,css:ke,title:Object(f.jsx)("h2",null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.emptyPromptTitle",defaultMessage:"Click a spike or dip in the histogram chart to start the analysis."})),titleSize:"xs",body:Object(f.jsx)("p",null,Object(f.jsx)(r.FormattedMessage,{id:"xpack.aiops.logRateAnalysis.page.emptyPromptBody",defaultMessage:"The log rate analysis feature identifies statistically significant field/value combinations that contribute to a log rate spike or dip."})),"data-test-subj":"aiopsNoWindowParametersEmptyPrompt"}));var q,U}}}]);