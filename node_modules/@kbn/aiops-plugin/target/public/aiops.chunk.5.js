/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[5],{131:function(e,t,a){"use strict";a.r(t),a.d(t,"createCategorizeFieldAction",(function(){return Le}));var i=a(1),o=a.n(i),s=a(12),n=a(52),l=a(44),r=a(21),u=a(43),c=a(15),d=a(5),g=a(41),b=a(49),p=a(39),m=a(2),j=a(11),O=a(13),x=a(77),f=a(72),y=a(82);const S=e=>({field:void 0,...Object(y.a)(e)});var h=a(85),v=a(71),C=a(19);function E(e,t,a){const i=Object(s.cloneDeep)(e);return void 0===i.bool&&(i.bool={}),void 0===i.bool.must&&(i.bool.must=[],void 0!==i.match_all&&(i.bool.must.push({match_all:i.match_all}),delete i.match_all)),void 0!==i.multi_match&&(i.bool.should={multi_match:i.multi_match},delete i.multi_match),void 0!==a&&i.bool.must.push({range:{[t]:{gte:a.from,lte:a.to,format:"epoch_millis"}}}),i}const F=1e3,k=1,I={char_filter:["first_line_with_letters"],tokenizer:"standard",filter:[{type:"stop",stopwords:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday","Mon","Tue","Wed","Thu","Fri","Sat","Sun","January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","GMT","UTC"]},{type:"limit",max_token_count:"100"}]};var M=a(59),_=a.n(M),T=a(57);function A(e,t=2){if(void 0===e)return"";if(e%1==0)return e;if(Math.abs(e)<Math.pow(10,-t))return Number.parseFloat(String(e)).toExponential(2);const a=Math.pow(10,t);return Math.round(e*a)/a}var P=a(48),w=a.n(P),L=a(4),z=a(56);const R=[1e-5,5e-5,1e-4,5e-4,.001,.005,.01,.05,.1,.2,.3,.4,.5].map((e=>100*e)),N=1e-5,U=.001,D={ON_AUTOMATIC:"on_automatic",ON_MANUAL:"on_manual",OFF:"off"},B=[{"data-test-subj":"aiopsRandomSamplerOptionOnAutomatic",value:D.ON_AUTOMATIC,text:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerPreference.onAutomaticLabel",{defaultMessage:"On - automatic"})},{"data-test-subj":"aiopsRandomSamplerOptionOnManual",value:D.ON_MANUAL,text:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerPreference.onManualLabel",{defaultMessage:"On - manual"})},{"data-test-subj":"aiopsRandomSamplerOptionOff",value:D.OFF,text:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerPreference.offLabel",{defaultMessage:"Off"})}];class random_sampler_RandomSampler{constructor(e,t,a,i){w()(this,"docCount$",new L.BehaviorSubject(0)),w()(this,"mode$",new L.BehaviorSubject(D.ON_AUTOMATIC)),w()(this,"probability$",new L.BehaviorSubject(U)),w()(this,"setRandomSamplerModeInStorage",void 0),w()(this,"setRandomSamplerProbabilityInStorage",void 0),this.mode$.next(e),this.setRandomSamplerModeInStorage=t,this.probability$.next(a),this.setRandomSamplerProbabilityInStorage=i}setDocCount(e){return this.docCount$.next(e)}getDocCount(){return this.docCount$.getValue()}setMode(e){return this.setRandomSamplerModeInStorage(e),this.mode$.next(e)}getMode$(){return this.mode$.asObservable()}getMode(){return this.mode$.getValue()}setProbability(e){return this.setRandomSamplerProbabilityInStorage(e),this.probability$.next(e)}getProbability$(){return this.probability$.asObservable()}getProbability(){return this.probability$.getValue()}createRandomSamplerWrapper(){const e=this.getMode(),t=this.getProbability();let a={};e===D.ON_MANUAL?a={probability:t}:e===D.OFF&&(a={probability:1});const i=Object(z.a)({...a,totalNumDocs:this.getDocCount()});return this.setProbability(i.probability),i}}var q=a(0);const V=({samplingProbability:e,setSamplingProbability:t})=>{const[a,o]=Object(i.useState)(e),s=!Object(T.a)(a)||isNaN(a)||a<N||a>.5,n=100*(null!=a?a:N);return Object(q.jsx)(m.EuiFlexItem,{grow:!0},Object(q.jsx)(m.EuiSpacer,{size:"m"}),Object(q.jsx)(m.EuiFormRow,{fullWidth:!0,label:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.randomSamplerPercentageRowLabel",{defaultMessage:"Sampling percentage"}),helpText:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.randomSamplerPercentageRowHelpText",{defaultMessage:"Choose a value between 0.001% and 50% to randomly sample data."})},Object(q.jsx)(m.EuiRange,{fullWidth:!0,showValue:!0,showRange:!0,showLabels:!0,showInput:"inputWithPopover",min:.001,max:50,value:A(n,n>=1?0:3),ticks:R.map((e=>({value:e,label:.001===e||e>=5?`${e}`:""}))),isInvalid:s,onChange:e=>{const t=parseFloat(e.target.value),i=a?100*a:t;if(t>0&&t<=1)o(t/100);else{const e=t>i?Math.ceil(t):Math.floor(t);o(e/100)}},step:.001,"data-test-subj":"dvRandomSamplerProbabilityRange",append:Object(q.jsx)(m.EuiButton,{"data-test-subj":"aiopsRandomSamplerRangeSliderApplyButton",disabled:s,onClick:()=>{t&&Object(T.a)(a)&&t(a)}},Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.randomSamplerSettingsPopUp.randomSamplerPercentageApply",defaultMessage:"Apply"}))})))},G=({randomSampler:e,reload:t})=>{const[a,o]=Object(i.useState)(!1),s=_()(e.getProbability$(),e.getProbability()),n=Object(i.useCallback)((a=>{e.setProbability(a),t()}),[t,e]),l=_()(e.getMode$(),e.getMode()),r=Object(i.useCallback)((a=>{e.setMode(a),t()}),[e,t]),{calloutInfoMessage:u,buttonText:c}=Object(i.useMemo)((()=>{switch(l){case D.OFF:return{calloutInfoMessage:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.offCallout.message",{defaultMessage:"Random sampling can be turned on to increase the speed of analysis, although some accuracy will be lost."}),buttonText:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.offCallout.button",{defaultMessage:"No sampling"})};case D.ON_AUTOMATIC:return{calloutInfoMessage:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.onAutomaticCallout.message",{defaultMessage:"The pattern analysis will use random sampler aggregations. The probability is automatically set to balance accuracy and speed."}),buttonText:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.onAutomaticCallout.button",{defaultMessage:"Auto sampling"})};case D.ON_MANUAL:default:return{calloutInfoMessage:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.onManualCallout.message",{defaultMessage:"The pattern analysis will use random sampler aggregations. A lower percentage probability increases performance, but some accuracy is lost."}),buttonText:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.onManualCallout.button",{defaultMessage:"Manual sampling"})}}}),[l]);return Object(q.jsx)(m.EuiPopover,{"data-test-subj":"aiopsRandomSamplerOptionsPopover",id:"aiopsSamplingOptions",button:Object(q.jsx)(m.EuiButtonEmpty,{"data-test-subj":"aiopsLogPatternAnalysisShowSamplingOptionsButton",onClick:()=>o(!a),iconSide:"right",iconType:"arrowDown"},c),isOpen:a,closePopover:()=>o(!1),panelPaddingSize:"none",anchorPosition:"downLeft"},Object(q.jsx)(m.EuiPanel,{style:{maxWidth:400}},Object(q.jsx)(m.EuiFlexItem,{grow:!0},Object(q.jsx)(m.EuiCallOut,{size:"s",color:"primary",title:u})),Object(q.jsx)(m.EuiSpacer,{size:"m"}),Object(q.jsx)(m.EuiFormRow,{"data-test-subj":"aiopsRandomSamplerOptionsFormRow",label:j.i18n.translate("xpack.aiops.logCategorization.randomSamplerSettingsPopUp.randomSamplerRowLabel",{defaultMessage:"Random sampling"})},Object(q.jsx)(m.EuiSelect,{"data-test-subj":"aiopsRandomSamplerOptionsSelect",options:B,value:l,onChange:e=>r(e.target.value)})),l===D.ON_MANUAL?Object(q.jsx)(V,{samplingProbability:s,setSamplingProbability:n}):null,l===D.ON_AUTOMATIC?Object(q.jsx)(Q,{samplingProbability:s}):null))},Q=({samplingProbability:e})=>null!==e?Object(q.jsx)("div",{"data-test-subj":"aiopsRandomSamplerProbabilityUsedMsg"},Object(q.jsx)(m.EuiSpacer,{size:"m"}),Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.randomSamplerSettingsPopUp.probabilityLabel",defaultMessage:"Probability used: {samplingProbability}%",values:{samplingProbability:100*e}})):null;function K(){const[e,t]=Object(n.b)(b.b,D.ON_AUTOMATIC),[a,o]=Object(n.b)(b.c,U),{data:l}=Object(p.b)(),r=Object(i.useRef)(new AbortController),u=Object(i.useMemo)((()=>new random_sampler_RandomSampler(e,t,a,o)),[]);return{runCategorizeRequest:Object(i.useCallback)(((e,t,a,i,o,n,c)=>{const{wrap:d,unwrap:g}=u.createRandomSamplerWrapper();return new Promise(((u,b)=>{l.search.search(function(e,t,a,i,o,s,n,l){return{params:{index:e,size:0,body:{query:E(o,a,i),aggs:s({categories:{categorize_text:{field:t,size:F,categorization_analyzer:I},aggs:{examples:{top_hits:{size:k,sort:[a],_source:t}},...n?{sparkline:{date_histogram:{field:a,fixed_interval:`${n}ms`}}}:{},...l?{sub_time_range:{date_range:{field:a,format:"epoch_millis",ranges:[{from:l.from,to:l.to}]},aggs:{examples:{top_hits:{size:k,sort:[a],_source:t}},...l.field?{sub_field:{filter:{term:{[l.field.name]:l.field.value}}}}:{}}}}:{}}}})}}}}(e,t,a,i,o,d,n,c),{abortSignal:r.current.signal}).subscribe({next:e=>{Object(C.isRunningResponse)(e)||u(function(e,t,a){const{aggregations:i}=e.rawResponse;if(void 0===i)throw new Error("processCategoryResults failed, did not return aggregations.");const{categories:{buckets:o}}=a(i);return{categories:o.map((e=>{var a,i,o,n,l,r,u;const c=void 0===e.sparkline?{}:e.sparkline.buckets.reduce(((e,t)=>(e[t.key]=t.doc_count,e)),{});return{key:e.key,count:e.doc_count,examples:e.examples.hits.hits.map((e=>Object(s.get)(e._source,t))),sparkline:c,subTimeRangeCount:null!==(a=null===(i=e.sub_time_range)||void 0===i?void 0:i.buckets[0].doc_count)&&void 0!==a?a:void 0,subFieldCount:null!==(o=null===(n=e.sub_time_range)||void 0===n||null===(l=n.buckets[0].sub_field)||void 0===l?void 0:l.doc_count)&&void 0!==o?o:void 0,subFieldExamples:null!==(r=null===(u=e.sub_time_range)||void 0===u?void 0:u.buckets[0].examples.hits.hits.map((e=>Object(s.get)(e._source,t))))&&void 0!==r?r:void 0}}))}}(e,t,g))},error:e=>{if("AbortError"===e.name)return u({categories:[]});b(e)}})}))}),[l.search,u]),cancelRequest:Object(i.useCallback)((()=>{r.current.abort(),r.current=new AbortController}),[]),randomSampler:u}}var $=a(14),J=a.n($),W=a(64),Y=a(70),H=a(86),X=a(26),Z=a.n(X);function ee(e,t,a,i,o,s){const n=void 0===o?a:[o],l=Object(W.b)(t,n,i);return void 0!==s&&(l.bool.must=[{term:{[s.name]:s.value}}]),{query:l,meta:{alias:j.i18n.translate("xpack.aiops.logCategorization.filterAliasLabel",{defaultMessage:"Categorization - {field}",values:{field:t}}),index:e,disabled:!1}}}const te=({categoriesCount:e,selectedCategoriesCount:t,labels:a,openInDiscover:i})=>{const s=Object(Y.a)();return Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiFlexGroup,{gutterSize:"none",alignItems:"center",css:Object(q.css)({minHeight:s.euiSizeXL},"","")},Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(m.EuiText,{size:"s","data-test-subj":"aiopsLogPatternsFoundCount"},Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.counts",defaultMessage:"{count} {count, plural, one {pattern} other {patterns}} found",values:{count:e}}),t>0?Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.selectedCounts",defaultMessage:" | {count} selected",values:{count:t}})):null)),t>0?Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiFlexItem,{grow:!1},Object(q.jsx)(m.EuiButtonEmpty,{"data-test-subj":"aiopsLogPatternAnalysisOpenInDiscoverIncludeButton",size:"s",onClick:()=>i(W.a.INCLUDE),iconType:"plusInCircle",iconSide:"left"},a.multiSelect.in)),Object(q.jsx)(m.EuiFlexItem,{grow:!1},Object(q.jsx)(m.EuiButtonEmpty,{"data-test-subj":"aiopsLogPatternAnalysisOpenInDiscoverExcludeButton",size:"s",onClick:()=>i(W.a.EXCLUDE),iconType:"minusInCircle",iconSide:"left"},a.multiSelect.out))):null))};var ae={name:"fa61i",styles:"padding-inline:0px"};const ie=({categories:e,eventRate:t,dataViewId:a,selectedField:s,timefilter:n,aiopsListState:l,pinnedCategory:r,setPinnedCategory:u,selectedCategory:c,setSelectedCategory:d,onAddFilter:g,onClose:b=(()=>{}),enableRowActions:O=!0,additionalFilter:x,navigateToDiscover:f=!0})=>{const y=Object(Y.a)(),S=Object(m.useEuiBackgroundColor)("primary"),{openInDiscoverWithFilter:h}=function(){const{http:{basePath:e}}=Object(p.b)();return{openInDiscoverWithFilter:(t,a,i,o,s,n,l,r)=>{var u,c;const d=Z.a.encode({time:{from:J()(null===(u=s.min)||void 0===u?void 0:u.valueOf()).toISOString(),to:J()(null===(c=s.max)||void 0===c?void 0:c.valueOf()).toISOString()}}),g=Z.a.encode({filters:[...o.filters,ee(t,a,i,n,l,r)],index:t,interval:"auto",query:{language:o.searchQueryLanguage,query:o.searchString}});let b=e.get();b+="/app/discover#/",b+="?_g="+d,b+="&_a="+encodeURIComponent(g),window.open(b,"_blank")}}}(),[v,C]=Object(i.useState)([]),{onTableChange:E,pagination:F,sorting:k}=function(e,t,a="asc"){const[o,s]=Object(i.useState)(0),[n,l]=Object(i.useState)(10),[r,u]=Object(i.useState)(t),[c,d]=Object(i.useState)(a);return{onTableChange:({page:e={index:0,size:10},sort:t={field:r,direction:c}})=>{const{index:a,size:i}=e;s(a),l(i);const{field:o,direction:n}=t;u(o),d(n)},pagination:{pageIndex:o,pageSize:n,totalItemCount:(null!=e?e:[]).length,pageSizeOptions:[10,20,50],showPerPageOptions:!0},sorting:{sort:{field:r,direction:c}},setPageIndex:s}}(null!=e?e:[],"key"),I=Object(i.useMemo)((()=>function(e){const t=e=>j.i18n.translate("xpack.aiops.logCategorization.flyout.filterIn",{defaultMessage:"Filter for {values, plural, one {pattern} other {patterns}}",values:{values:e?1:2}}),a=e=>j.i18n.translate("xpack.aiops.logCategorization.flyout.filterOut",{defaultMessage:"Filter out {values, plural, one {pattern} other {patterns}}",values:{values:e?1:2}}),i=e=>j.i18n.translate("xpack.aiops.logCategorization.filterIn",{defaultMessage:"Filter for {values, plural, one {pattern} other {patterns}} in Discover",values:{values:e?1:2}}),o=e=>j.i18n.translate("xpack.aiops.logCategorization.filterOut",{defaultMessage:"Filter out {values, plural, one {pattern} other {patterns}} in Discover",values:{values:e?1:2}});return e?{multiSelect:{in:t(!1),out:a(!1)},singleSelect:{in:t(!0),out:a(!0)}}:{multiSelect:{in:i(!1),out:o(!1)},singleSelect:{in:i(!0),out:o(!0)}}}(void 0!==g&&void 0!==b&&!1===f)),[f,g,b]),M=Object(i.useMemo)((()=>e.some((e=>void 0!==e.sparkline))),[e]),_=(e,t)=>{if(void 0!==g&&void 0!==s&&"string"!=typeof s&&!1===f)return g(ee("",s.name,v,e,t),`Patterns - ${s.name}`),void b();const i=void 0!==x?{min:J()(x.from),max:J()(x.to)}:n.getActiveBounds();void 0!==i&&void 0!==s&&h(a,"string"==typeof s?s:s.name,v,l,i,e,t,null==x?void 0:x.field)},T=[{field:"count",name:j.i18n.translate("xpack.aiops.logCategorization.column.count",{defaultMessage:"Count"}),sortable:!0,width:"80px"},{field:"examples",name:j.i18n.translate("xpack.aiops.logCategorization.column.examples",{defaultMessage:"Examples"}),sortable:!0,render:e=>Object(q.jsx)(o.a.Fragment,null,e.map((e=>Object(q.jsx)(m.EuiText,{size:"s",key:e},Object(q.jsx)(m.EuiCode,{language:"log",transparentBackground:!0,css:ae},e)))))},{name:j.i18n.translate("xpack.aiops.logCategorization.column.actions",{defaultMessage:"Actions"}),sortable:!1,width:"60px",actions:[{name:I.singleSelect.in,description:I.singleSelect.in,icon:"plusInCircle",type:"icon","data-test-subj":"aiopsLogPatternsActionFilterInButton",onClick:e=>_(W.a.INCLUDE,e)},{name:I.singleSelect.out,description:I.singleSelect.out,icon:"minusInCircle",type:"icon","data-test-subj":"aiopsLogPatternsActionFilterOutButton",onClick:e=>_(W.a.EXCLUDE,e)}]}];!0===M&&T.splice(1,0,{field:"sparkline",name:j.i18n.translate("xpack.aiops.logCategorization.column.logRate",{defaultMessage:"Log rate"}),sortable:!1,width:"100px",render:a=>{if(void 0===a)return null;const i=t.map((({key:e,docCount:t})=>{var i;const o=null!==(i=a[e])&&void 0!==i?i:0,s=o>t?t:o;return{doc_count_overall:t-s,doc_count_significant_item:s,key:e,key_as_string:`${e}`}}));return Object(q.jsx)(H.a,{chartData:i,isLoading:null===e&&void 0===i,label:""})}});const A={selectable:()=>!0,onSelectionChange:e=>C(e)},P=e=>r&&r.key===e.key&&r.key===e.key?{backgroundColor:S}:c&&c.key===e.key?{backgroundColor:y.euiColorLightestShade}:{backgroundColor:y.euiColorEmptyShade};return Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(te,{categoriesCount:e.length,selectedCategoriesCount:v.length,labels:I,openInDiscover:e=>_(e)}),Object(q.jsx)(m.EuiSpacer,{size:"xs"}),Object(q.jsx)(m.EuiHorizontalRule,{margin:"none"}),Object(q.jsx)(m.EuiInMemoryTable,{compressed:!0,items:e,columns:T,isSelectable:!0,selection:A,itemId:"key",onTableChange:E,pagination:F,sorting:k,"data-test-subj":"aiopsLogPatternsTable",rowProps:e=>O?{onClick:()=>{e.key===(null==r?void 0:r.key)?u(null):u(e)},onMouseEnter:()=>{d(e)},onMouseLeave:()=>{d(null)},style:P(e)}:void 0}))};var oe=a(84),se=a(96);const ne=({eventRate:e,totalCount:t,pinnedCategory:a,selectedCategory:s,documentCountStats:n})=>{const{data:l,uiSettings:r,fieldFormats:u,charts:c}=Object(p.b)(),d=j.i18n.translate("xpack.aiops.logCategorization.chartPointsSplitLabel",{defaultMessage:"Selected pattern"}),g=Object(i.useMemo)((()=>{var t;const i=null!==(t=null!=s?s:a)&&void 0!==t?t:null;return e.map((({key:e,docCount:t})=>{let a=t;if(i&&i.sparkline&&i.sparkline[e]){const o=i.sparkline[e];a=o>t?0:t-o}return{time:e,value:a}}))}),[e,a,s]),b=Object(i.useMemo)((()=>{var t;const i=null!==(t=null!=s?s:a)&&void 0!==t?t:null;return null!==i?e.map((({key:e,docCount:t})=>{const a=i.sparkline&&i.sparkline[e]?i.sparkline[e]:0;return{time:e,value:a>t?t:a}})):void 0}),[e,a,s]);return void 0===(null==n?void 0:n.interval)?null:Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(se.a,{totalCount:t}),Object(q.jsx)(oe.a,{dependencies:{data:l,uiSettings:r,fieldFormats:u,charts:c},chartPoints:g,chartPointsSplit:b,timeRangeEarliest:e[0].key,timeRangeLatest:e[e.length-1].key,interval:n.interval,chartPointsSplitLabel:d,isBrushCleared:!1}))},le=({eventRateLength:e,fieldSelected:t,categoriesLength:a,loading:i})=>!0===i?null:Object(q.jsx)(o.a.Fragment,null,0===e?Object(q.jsx)(m.EuiEmptyPrompt,{title:Object(q.jsx)("h2",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.noDocsTitle",defaultMessage:"No documents found"})),titleSize:"xs",body:Object(q.jsx)("p",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.noDocsBody",defaultMessage:"Ensure the selected time range contains documents."})),"data-test-subj":"aiopsNoWindowParametersEmptyPrompt"}):null,e>0&&null===a?Object(q.jsx)(m.EuiEmptyPrompt,{title:Object(q.jsx)("h2",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.emptyPromptTitle",defaultMessage:"Select a text field and click run pattern analysis to start analysis"})),titleSize:"xs",body:Object(q.jsx)("p",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.emptyPromptBody",defaultMessage:"Log pattern analysis groups messages into common patterns."})),"data-test-subj":"aiopsNoWindowParametersEmptyPrompt"}):null,e>0&&null!==a&&0===a?Object(q.jsx)(m.EuiEmptyPrompt,{title:Object(q.jsx)("h2",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.noCategoriesTitle",defaultMessage:"No patterns found"})),titleSize:"xs",body:Object(q.jsx)("p",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.noCategoriesBody",defaultMessage:"Ensure the selected field is populated in the selected time range."})),"data-test-subj":"aiopsNoWindowParametersEmptyPrompt"}):null),re={LOG_RATE_ANALYSIS:"/internal/aiops/log_rate_analysis",CATEGORIZATION_FIELD_VALIDATION:"/internal/aiops/categorization_field_validation"};function ue(){const{http:e}=Object(p.b)(),t=Object(i.useRef)(new AbortController);return{runValidateFieldRequest:Object(i.useCallback)((async(t,a,i,o,s,n)=>{const l=E(s,i,o);return await e.post(re.CATEGORIZATION_FIELD_VALIDATION,{body:JSON.stringify({indexPatternTitle:t,query:l,size:5,field:a,timeField:i,start:o.from,end:o.to,runtimeMappings:void 0,indicesOptions:void 0,includeExamples:!1}),headers:n,version:"1"})}),[e]),cancelRequest:Object(i.useCallback)((()=>{t.current.abort(),t.current=new AbortController}),[])}}let ce,de;!function(e){e.VALID="valid",e.PARTIALLY_VALID="partially_valid",e.INVALID="invalid"}(ce||(ce={})),function(e){e[e.NO_EXAMPLES=0]="NO_EXAMPLES",e[e.FAILED_TO_TOKENIZE=1]="FAILED_TO_TOKENIZE",e[e.TOO_MANY_TOKENS=2]="TOO_MANY_TOKENS",e[e.TOKEN_COUNT=3]="TOKEN_COUNT",e[e.MEDIAN_LINE_LENGTH=4]="MEDIAN_LINE_LENGTH",e[e.NULL_VALUES=5]="NULL_VALUES",e[e.INSUFFICIENT_PRIVILEGES=6]="INSUFFICIENT_PRIVILEGES"}(de||(de={})),de.NO_EXAMPLES,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validNoDataFound",{defaultMessage:"Examples were successfully loaded."}),de.FAILED_TO_TOKENIZE,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validFailureToGetTokens",{defaultMessage:"The loaded examples were tokenized successfully."}),de.TOKEN_COUNT,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validTokenLength",{defaultMessage:"More than {tokenCount} tokens per example were found in over {percentage}% of the loaded examples.",values:{percentage:Math.floor(75),tokenCount:3}}),de.MEDIAN_LINE_LENGTH,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validMedianLineLength",{defaultMessage:"The median line length of the loaded examples was less than {medianCharCount} characters.",values:{medianCharCount:400}}),de.NULL_VALUES,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validNullValues",{defaultMessage:"Less than {percentage}% of the loaded examples were null.",values:{percentage:Math.floor(25)}}),de.TOO_MANY_TOKENS,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validTooManyTokens",{defaultMessage:"Less than 10000 tokens were found in total in the loaded examples."}),de.INSUFFICIENT_PRIVILEGES,j.i18n.translate("xpack.ml.models.jobService.categorization.messages.validUserPrivileges",{defaultMessage:"The user has sufficient privileges to perform the checks."});const ge=({validationResults:e})=>null===e||e.overallValidStatus===ce.VALID?null:Object(q.jsx)(m.EuiCallOut,{color:"warning",title:j.i18n.translate("xpack.aiops.logCategorization.fieldValidationTitle",{defaultMessage:"The selected field is possibly not suitable for pattern analysis"})},e.validationChecks.filter((e=>e.valid!==ce.VALID)).map((e=>Object(q.jsx)("div",{key:e.id},e.message)))),be="message";var pe={name:"1qw7xfh",styles:"min-width:410px"},me={name:"xdvdnl",styles:"margin-top:auto"},je={name:"xdvdnl",styles:"margin-top:auto"};const Oe=({embeddingOrigin:e})=>{var t,a;const{notifications:{toasts:s}}=Object(p.b)(),{dataView:n,savedSearch:r}=Object(g.c)(),{runCategorizeRequest:u,cancelRequest:c,randomSampler:b}=K(),{runValidateFieldRequest:y,cancelRequest:C}=ue(),[E,F]=Object(l.b)("logCategorization",S()),[k,I]=Object(l.c)("_g"),[M,_]=Object(i.useState)(),[T,A]=Object(i.useState)(null),[P,w]=Object(i.useState)(r),[L,z]=Object(i.useState)(!1),[R,N]=Object(i.useState)(0),[U,D]=Object(i.useState)([]),[B,V]=Object(i.useState)(null),[Q,$]=Object(i.useState)(null),[J,W]=Object(i.useState)(null),Y=Object(i.useCallback)((()=>{C(),c()}),[c,C]);Object(i.useEffect)((()=>{r&&w(r)}),[r]),Object(i.useEffect)((function(){return()=>{Y()}}),[Y]);const H=Object(i.useCallback)((e=>{null!==P&&w(null),F({...E,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[P,E,F]),{searchQueryLanguage:X,searchString:Z,searchQuery:ee}=Object(f.a)({dataView:n,savedSearch:P},E),{documentStats:te,timefilter:ae,earliest:oe,latest:se,intervalMs:re}=Object(x.a)(n,"log_categorization",ee,I,void 0,void 0,20);Object(i.useEffect)((()=>{void 0!==(null==k?void 0:k.time)&&ae.setTime({from:k.time.from,to:k.time.to})}),[JSON.stringify(null==k?void 0:k.time),ae]);const ce=Object(i.useMemo)((()=>n.fields.filter((({displayName:e,esTypes:t,count:a})=>t&&t.includes("text")&&!["_id","_index"].includes(e))).map((({displayName:e})=>({label:e})))),[n]);Object(i.useEffect)((()=>{var e;null!==(e=te.documentCountStats)&&void 0!==e&&e.buckets&&(b.setDocCount(te.totalCount),D(Object.entries(te.documentCountStats.buckets).map((([e,t])=>({key:+e,docCount:t})))),$(null),W(null),N(te.totalCount))}),[te,oe,se,X,Z,ee,b]);const de=Object(i.useCallback)((async()=>{z(!0),$(null),W(null);const{getIndexPattern:t,timeFieldName:a}=n,i=t();if(void 0===M||void 0===a||void 0===oe||void 0===se)return void z(!1);Y();const o={from:oe,to:se};try{const[t,s]=await Promise.all([y(i,M,a,o,ee,{[d.a.AIOPS_ANALYSIS_RUN_ORIGIN]:e}),u(i,M,a,o,ee,re)]);W(t),$({categories:s.categories})}catch(e){s.addError(e,{title:j.i18n.translate("xpack.aiops.logCategorization.errorLoadingCategories",{defaultMessage:"Error loading categories"})})}z(!1)}),[n,M,Y,y,oe,se,ee,u,re,s,e]);return Object(i.useEffect)((function(){if(void 0!==M)return;const e=E.field;void 0!==e&&ce.find((t=>t.label===e))?_(e):1===ce.length?_(ce[0].label):ce.find((e=>e.label===be))&&_(be)}),[ce,de,M,E.field]),Object(q.jsx)(m.EuiPageBody,{"data-test-subj":"aiopsLogPatternAnalysisPage",paddingSize:"none",panelled:!1},Object(q.jsx)(v.a,null),Object(q.jsx)(m.EuiSpacer,null),Object(q.jsx)(m.EuiFlexGroup,{gutterSize:"none"},Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(h.a,{dataView:n,searchString:null!=Z?Z:"",searchQuery:ee,searchQueryLanguage:X,setSearchParams:H}))),Object(q.jsx)(m.EuiSpacer,{size:"m"}),Object(q.jsx)(m.EuiFlexGroup,{gutterSize:"none"},Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:pe},Object(q.jsx)(m.EuiFormRow,{label:j.i18n.translate("xpack.aiops.logCategorization.categoryFieldSelect",{defaultMessage:"Category field"})},Object(q.jsx)(m.EuiComboBox,{isDisabled:!0===L,options:ce,onChange:e=>{$(null),W(null);const t=e&&e.length?e[0].label:void 0;_(t),F({field:t})},selectedOptions:void 0===M?void 0:[{label:M}],singleSelection:{asPlainText:!0},"data-test-subj":"aiopsLogPatternAnalysisCategoryField"}))),Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:me},!1===L?Object(q.jsx)(m.EuiButton,{disabled:void 0===M,onClick:()=>{de()},"data-test-subj":"aiopsLogPatternAnalysisRunButton"},Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.runButton",defaultMessage:"Run pattern analysis"})):Object(q.jsx)(m.EuiButton,{"data-test-subj":"aiopsLogCategorizationPageCancelButton",onClick:()=>Y()},"Cancel")),Object(q.jsx)(m.EuiFlexItem,null),Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:je},Object(q.jsx)(G,{randomSampler:b,reload:()=>de()}))),U.length?Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiSpacer,null),Object(q.jsx)(ne,{eventRate:U,pinnedCategory:B,selectedCategory:T,totalCount:R,documentCountStats:te.documentCountStats}),Object(q.jsx)(m.EuiSpacer,null)):null,Object(q.jsx)(ge,{validationResults:J}),!0===L?Object(q.jsx)(m.EuiSkeletonText,{lines:10}):null,Object(q.jsx)(le,{loading:L,categoriesLength:null!==(t=null==Q||null===(a=Q.categories)||void 0===a?void 0:a.length)&&void 0!==t?t:null,eventRateLength:U.length,fieldSelected:null!==M}),void 0!==M&&null!==Q&&Q.categories.length>0?Object(q.jsx)(ie,{categories:Q.categories,aiopsListState:E,dataViewId:n.id,eventRate:U,selectedField:M,pinnedCategory:B,setPinnedCategory:V,selectedCategory:T,setSelectedCategory:A,timefilter:ae}):null)};var xe=a(75);const fe=new r.Storage(window.localStorage);var ye=a(35),Se=a(63),he=a(18),ve=a(24),Ce=a(76),Ee=a(16),Fe=a(46);const ke=()=>Object(q.jsx)(m.EuiBetaBadge,{label:j.i18n.translate("xpack.aiops.techPreviewBadge.label",{defaultMessage:"Technical preview"}),size:"m",color:"hollow",tooltipContent:j.i18n.translate("xpack.aiops.techPreviewBadge.tooltip",{defaultMessage:"This functionality is in technical preview and may be changed or removed completely in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features."}),tooltipPosition:"right"});var Ie={name:"1azakc",styles:"text-align:center"},Me={name:"1azakc",styles:"text-align:center"};const _e=({onClose:e})=>Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiSpacer,{size:"l"}),Object(q.jsx)(m.EuiFlexGroup,{justifyContent:"spaceAround"},Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:Ie},Object(q.jsx)(m.EuiFlexGrid,{columns:1},Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(m.EuiLoadingElastic,{size:"xxl"})),Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(m.EuiText,null,Object(q.jsx)("h2",null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.categorizeFlyout.loading.title",defaultMessage:"Loading pattern analysis"})))),Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(m.EuiFlexGroup,{justifyContent:"spaceAround"},Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:Me},Object(q.jsx)(m.EuiButton,{"data-test-subj":"aiopsLoadingCategorizationCancelButton",onClick:()=>e()},"Cancel")))))))),Te=({dataView:e,field:t,query:a,earliest:i,latest:s})=>{const{uiActions:n,application:{capabilities:l}}=Object(p.b)();return void 0===n||!1===l.ml.canCreateJob?null:Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiButtonEmpty,{"data-test-subj":"aiopsLogCategorizationFlyoutAdJobButton",onClick:()=>{if(void 0===n)return;const o={dataView:e,field:t,query:a,timeRange:{from:J()(i).toISOString(),to:J()(s).toISOString()}};n.getTrigger("CREATE_PATTERN_ANALYSIS_TO_ML_AD_JOB_TRIGGER").exec(o)},flush:"left",iconSide:"left",iconType:"machineLearningApp"},Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.categorizeFlyout.findAnomalies",defaultMessage:"Find anomalies in patterns"})))};var Ae;!function(e){e[e.BUCKET=0]="BUCKET",e[e.FULL_TIME_RANGE=1]="FULL_TIME_RANGE"}(Ae||(Ae={}));const Pe=({dataView:e,savedSearch:t,selectedField:a,onClose:s,embeddingOrigin:n,additionalFilter:r})=>{var u,c;const{notifications:{toasts:g},data:{query:{getState:b,filterManager:y}},uiSettings:h}=Object(p.b)(),{runValidateFieldRequest:v,cancelRequest:C}=ue(),{euiTheme:E}=Object(m.useEuiTheme)(),{filters:F,query:k}=Object(i.useMemo)((()=>b()),[b]),I=Object(i.useRef)(!1),{runCategorizeRequest:M,cancelRequest:_,randomSampler:T}=K(),[A]=Object(l.b)("logCategorization",S({searchQuery:Object(Fe.a)(k,F,e,h)})),[P,w]=Object(i.useState)(null),[L]=Object(i.useState)(t),[z,R]=Object(i.useState)(!0),[N,U]=Object(i.useState)([]),[D,B]=Object(i.useState)(null),[V,Q]=Object(i.useState)(null),[$,J]=Object(i.useState)(null),[W,Y]=Object(i.useState)(!1),[H,X]=Object(i.useState)(Ae.FULL_TIME_RANGE),Z=Object(i.useCallback)((()=>{C(),_()}),[_,C]);Object(i.useEffect)((function(){return I.current=!0,()=>{I.current=!1,Z()}}),[Z,I]);const{searchQueryLanguage:ee,searchString:te,searchQuery:ae}=Object(f.a)({dataView:e,savedSearch:L},A,!0),{documentStats:oe,timefilter:se,earliest:ne,latest:re,intervalMs:ce,forceRefresh:de}=Object(x.a)(e,"log_categorization",ae,void 0,void 0,void 0,20),be=Object(i.useCallback)((async()=>{const{getIndexPattern:t,timeFieldName:i}=e,o=t();if(void 0===a||void 0===i||void 0===ne||void 0===re)return;Z(),R(!0),Q(null),J(null);const s={from:ne,to:re};try{const[e,t]=await Promise.all([v(o,a.name,i,s,ae,{[d.a.AIOPS_ANALYSIS_RUN_ORIGIN]:n}),M(o,a.name,i,s,ae,ce,r)]);if(!0===I.current){J(e);const{categories:a}=t,i=a.some((e=>void 0!==e.subTimeRangeCount));let o=null;void 0!==r&&(o=t.categories.map((e=>{var t;return{...e,count:null!==(t=e.subFieldCount)&&void 0!==t?t:e.subTimeRangeCount,examples:e.subFieldExamples,sparkline:void 0}})).filter((e=>e.count>0)).sort(((e,t)=>t.count-e.count))),Q({categories:a,categoriesInBucket:o}),Y(i),X(Ae.BUCKET)}}catch(e){g.addError(e,{title:j.i18n.translate("xpack.aiops.logCategorization.errorLoadingCategories",{defaultMessage:"Error loading categories"})})}!0===I.current&&R(!1)}),[e,a,ne,re,Z,v,ae,n,M,ce,r,g]),pe=Object(i.useCallback)(((t,a)=>{const i=Object(Ee.buildEmptyFilter)(!1,e.id);a&&(i.meta.alias=a),i.query=t.query,y.addFilters([i])}),[e,y]);Object(i.useEffect)((()=>{var e;null!==(e=oe.documentCountStats)&&void 0!==e&&e.buckets&&(T.setDocCount(oe.totalCount),U(Object.entries(oe.documentCountStats.buckets).map((([e,t])=>({key:+e,docCount:t})))),Q(null),be())}),[oe,ne,re,ee,te,ae,be,T]);const me={marginTop:E.size.m,marginLeft:E.size.xxs};return Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiFlyoutHeader,{hasBorder:!0},Object(q.jsx)(m.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(q.jsx)(m.EuiFlexItem,{grow:!1},Object(q.jsx)(m.EuiTitle,{size:"m"},Object(q.jsx)("h2",{id:"flyoutTitle","data-test-subj":"mlJobSelectorFlyoutTitle"},Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.categorizeFlyout.title",defaultMessage:"Pattern analysis of {name}",values:{name:a.name}})))),Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:Object(q.css)({marginTop:E.size.xs},"","")},Object(q.jsx)(ke,null)),Object(q.jsx)(m.EuiFlexItem,null),Object(q.jsx)(m.EuiFlexItem,{grow:!1},Object(q.jsx)(G,{randomSampler:T,reload:()=>de()})))),Object(q.jsx)(m.EuiFlyoutBody,{"data-test-subj":"mlJobSelectorFlyoutBody"},!1===W&&!1===z?Object(q.jsx)(Te,{dataView:e,field:a,query:ae,earliest:ne,latest:re}):null,Object(q.jsx)(ge,{validationResults:$}),!0===z?Object(q.jsx)(_e,{onClose:s}):null,Object(q.jsx)(le,{loading:z,categoriesLength:null!==(u=null==V||null===(c=V.categories)||void 0===c?void 0:c.length)&&void 0!==u?u:null,eventRateLength:N.length,fieldSelected:null!==a}),!1===z&&null!==V&&V.categories.length>0?Object(q.jsx)(o.a.Fragment,null,W?Object(q.jsx)(o.a.Fragment,null,Object(q.jsx)(m.EuiTabs,null,Object(q.jsx)(m.EuiTab,{isSelected:H===Ae.BUCKET,onClick:()=>X(Ae.BUCKET)},Object(q.jsx)(m.EuiToolTip,{content:j.i18n.translate("xpack.aiops.logCategorization.tabs.bucket.tooltip",{defaultMessage:"Patterns that occur in the anomalous bucket."})},Object(q.jsx)(m.EuiFlexGroup,{gutterSize:"none"},Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.tabs.bucket",defaultMessage:"Bucket"})),Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:me},Object(q.jsx)(m.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))))),Object(q.jsx)(m.EuiTab,{isSelected:H===Ae.FULL_TIME_RANGE,onClick:()=>X(Ae.FULL_TIME_RANGE)},Object(q.jsx)(m.EuiToolTip,{content:j.i18n.translate("xpack.aiops.logCategorization.tabs.fullTimeRange.tooltip",{defaultMessage:"Patterns that occur in the time range selected for the page."})},Object(q.jsx)(m.EuiFlexGroup,{gutterSize:"none"},Object(q.jsx)(m.EuiFlexItem,null,Object(q.jsx)(O.FormattedMessage,{id:"xpack.aiops.logCategorization.tabs.fullTimeRange",defaultMessage:"Full time range"})),Object(q.jsx)(m.EuiFlexItem,{grow:!1,css:me},Object(q.jsx)(m.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"})))))),Object(q.jsx)(m.EuiSpacer,{size:"s"})):null,Object(q.jsx)(ie,{categories:H===Ae.BUCKET&&null!==V.categoriesInBucket?V.categoriesInBucket:V.categories,aiopsListState:A,dataViewId:e.id,eventRate:N,selectedField:a,pinnedCategory:D,setPinnedCategory:B,selectedCategory:P,setSelectedCategory:w,timefilter:se,onAddFilter:pe,onClose:s,enableRowActions:!1,additionalFilter:H===Ae.BUCKET&&void 0!==r?r:void 0,navigateToDiscover:void 0!==r})):null))},we=new r.Storage(window.localStorage),Le=(e,t)=>Object(ye.createAction)({type:Se.a,id:Se.a,getDisplayName:()=>j.i18n.translate("xpack.aiops.categorizeFieldAction.displayName",{defaultMessage:"Pattern analysis"}),isCompatible:async({field:e})=>{var t;return!0===(null===(t=e.esTypes)||void 0===t?void 0:t.includes("text"))},execute:async a=>{const{field:i,dataView:o,originatingApp:l,additionalFilter:r}=a;!async function(e,t,a,i,o,l){const{http:r,theme:c,overlays:d,application:g,notifications:m,uiSettings:j,i18n:O}=a;new Promise((async(x,f)=>{try{const f=()=>{h.close(),x()},y={notifications:m,uiSettings:j,http:r,theme:c,application:g,i18n:O,...i},S={...Object(s.pick)(y,["data","http","notifications","theme","uiSettings"]),i18n:O,uiSettingsKeys:C.UI_SETTINGS},h=d.openFlyout(Object(Ce.a)(Object(q.jsx)(ve.KibanaContextProvider,{services:{...a}},Object(q.jsx)(p.a.Provider,{value:y},Object(q.jsx)(u.a,S,Object(q.jsx)(n.a,{storage:we,storageKeys:b.d},Object(q.jsx)(Pe,{dataView:t,savedSearch:null,selectedField:e,onClose:f,embeddingOrigin:o,additionalFilter:l}))))),{theme:c,i18n:O}),{"data-test-subj":"aiopsCategorizeFlyout",ownFocus:!0,closeButtonProps:{"aria-label":"aiopsCategorizeFlyout"},onClose:f,size:"l"});g.currentAppId$.pipe(Object(he.skip)(1),Object(he.takeUntil)(Object(L.from)(h.onClose)),Object(he.distinctUntilChanged)()).subscribe((()=>{h.close()}))}catch(e){f(e)}}))}(i,o,e,t,l,r)}});t.default=({dataView:e,savedSearch:t,appDependencies:a,showFrozenDataTierChoice:i=!0})=>{if(!e)return null;const r=Object(xe.a)(e,"log_categorization");if(null!==r)return Object(q.jsx)(o.a.Fragment,null,r);const m={...Object(s.pick)(a,["data","http","notifications","theme","uiSettings","i18n"]),uiSettingsKeys:c.UI_SETTINGS,showFrozenDataTierChoice:i};return Object(q.jsx)(p.a.Provider,{value:a},Object(q.jsx)(l.a,null,Object(q.jsx)(g.a.Provider,{value:{dataView:e,savedSearch:t}},Object(q.jsx)(n.a,{storage:fe,storageKeys:b.d},Object(q.jsx)(u.a,m,Object(q.jsx)(Oe,{embeddingOrigin:d.a.AIOPS_DEFAULT_SOURCE}))))))}},46:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return u}));var i=a(12),o=a(15),s=a(19),n=a(16),l=(a(40),a(47));function r(e,t,a,i){let r=Object(l.d)();if(Object(s.isQuery)(e)&&e.language===l.a.KUERY){const i=Object(n.fromKueryExpression)(e.query);if(""!==e.query&&(r=Object(n.toElasticsearchQuery)(i,a)),void 0!==r.bool){const e=Object(n.buildQueryFromFilters)(t,a);Array.isArray(r.bool.filter)||(r.bool.filter=void 0===r.bool.filter?[]:[r.bool.filter]),Array.isArray(r.bool.must_not)||(r.bool.must_not=void 0===r.bool.must_not?[]:[r.bool.must_not]),r.bool.filter=[...r.bool.filter,...e.filter],r.bool.must_not=[...r.bool.must_not,...e.must_not]}}else r=Object(n.buildEsQuery)(a,e?[e]:[],t||[],i?Object(o.getEsQueryConfig)(i):void 0);return r}function u({dataView:e,uiSettings:t,savedSearch:a,query:n,filters:u,filterManager:c}){if(!e||!a)return;const d=n,g=u,b=function(e){return e&&"searchSource"in e&&(null==e?void 0:e.searchSource)instanceof o.SearchSource?e.searchSource:void 0}(a);if(b&&void 0!==b.getParent()&&d){var p,m,j;const e=null!==(p=Object(i.cloneDeep)(null===(m=a.searchSource.getSearchRequestBody())||void 0===m?void 0:m.query))&&void 0!==p?p:Object(l.d)(),t=null===(j=a.searchSource.getField("index"))||void 0===j?void 0:j.timeFieldName;return Array.isArray(e.bool.filter)&&void 0!==t&&(e.bool.filter=e.bool.filter.filter((e=>{var a;return!(e.hasOwnProperty("range")&&null!==(a=e.range)&&void 0!==a&&a.hasOwnProperty(t))}))),{searchQuery:e,searchString:d.query,queryLanguage:d.language}}if(!a&&d)return c&&g&&c.addFilters(g),{searchQuery:r(d,Array.isArray(g)?g:[],e,t),searchString:d.query,queryLanguage:d.language};if(b){const a=null==c?void 0:c.getGlobalFilters(),i=null!=d?d:b.getField("query"),o=null!=g?g:Object(s.mapAndFlattenFilters)(b.getField("filter"));return c&&c.setFilters(o),a&&(null==c||c.addFilters(a)),{searchQuery:r(i,c?null==c?void 0:c.getFilters():o,e,t),searchString:i.query,queryLanguage:i.language}}}},63:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return n}));var i=a(11);const o="ACTION_CATEGORIZE_FIELD",s="CATEGORIZE_FIELD_TRIGGER",n={id:s,title:i.i18n.translate("xpack.ml.actions.runPatternAnalysis.title",{defaultMessage:"Run pattern analysis"}),description:i.i18n.translate("xpack.ml.actions.runPatternAnalysis.description",{defaultMessage:"Triggered when user wants to run pattern analysis on a field."})}},71:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var i=a(0),o=a(1),s=a(2),n=a(44),l=a(52),r=a(43),u=a(14),c=a.n(u),d=a(41),g=a(49);const b={name:"1v0pok0",styles:"min-width:300px"},p=()=>{const[,e]=Object(n.c)("_g"),{dataView:t}=Object(d.c)(),[a,u]=Object(l.b)(g.a,r.c.EXCLUDE),p=Object(r.g)({timeRangeSelector:void 0!==t.timeFieldName,autoRefreshSelector:!0}),m=Object(o.useCallback)((t=>{e({time:{from:c()(t.start.epoch).toISOString(),to:c()(t.end.epoch).toISOString()}})}),[e]),j=Object(o.useMemo)((()=>void 0!==t.timeFieldName&&""!==t.timeFieldName),[t.timeFieldName]);return Object(i.jsx)(s.EuiPageHeader,{pageTitle:Object(i.jsx)("div",{css:b},t.getName()),rightSideItems:[Object(i.jsx)(s.EuiFlexGroup,{gutterSize:"s","data-test-subj":"aiopsTimeRangeSelectorSection"},j?Object(i.jsx)(s.EuiFlexItem,{grow:!1},Object(i.jsx)(r.d,{frozenDataPreference:a,setFrozenDataPreference:u,dataView:t,query:void 0,disabled:!1,timefilter:p,callback:m})):null,Object(i.jsx)(r.b,{isAutoRefreshOnly:!j,showRefresh:!j,width:"full",flexGroup:!1}))]})}},72:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a(1),o=a(46),s=a(39);const n=({dataView:e,savedSearch:t},a,n=!1)=>{const{uiSettings:l,data:{query:{filterManager:r}}}=Object(s.b)(),u=Object(i.useMemo)((()=>Object(o.b)({dataView:e,uiSettings:l,savedSearch:t,filterManager:r})),[e,l,t,r]);if(void 0===u||a&&""!==a.searchString){if(null!=a&&a.filters&&!1===n){const e=null==r?void 0:r.getGlobalFilters();r&&r.setFilters(a.filters),e&&(null==r||r.addFilters(e))}return{searchQuery:null==a?void 0:a.searchQuery,searchString:null==a?void 0:a.searchString,searchQueryLanguage:null==a?void 0:a.searchQueryLanguage}}return{searchQuery:u.searchQuery,searchString:u.searchString,searchQueryLanguage:u.queryLanguage}}},82:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a(47);const o={match_all:{}},s=e=>({searchString:"",searchQuery:o,searchQueryLanguage:i.a.KUERY,filters:[],...e})},85:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var i=a(1),o=a(2),s=a(11),n=a(39),l=a(46),r=a(0);const u=({dataView:e,searchString:t,searchQueryLanguage:a,setSearchParams:u})=>{const{uiSettings:c,unifiedSearch:{ui:{SearchBar:d}},notifications:{toasts:g},data:{query:b}}=Object(n.b)(),[p,m]=Object(i.useState)({query:t||"",language:a});Object(i.useEffect)((()=>{m({query:t||"",language:a})}),[a,t,b.filterManager]);const j=({query:t,filters:a})=>{const i=null!=t?t:p,o=null!=a?a:b.filterManager.getFilters();try{var n;o&&b.filterManager.setFilters(o);const t=Object(l.a)(i,null!==(n=b.filterManager.getFilters())&&void 0!==n?n:[],e,c);u({searchQuery:t,searchString:i.query,queryLanguage:i.language,filters:o})}catch(e){console.log("Invalid syntax",JSON.stringify(e,null,2)),g.addError(e,{title:s.i18n.translate("xpack.aiops.searchPanel.invalidSyntax",{defaultMessage:"Invalid syntax"})})}};return Object(r.jsx)(o.EuiFlexGroup,{gutterSize:"s","data-test-subj":"aiopsSearchPanel",responsive:!1},Object(r.jsx)(o.EuiFlexItem,{grow:9},Object(r.jsx)(d,{dataTestSubj:"aiopsQueryInput",appName:"aiops",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:p,onQuerySubmit:e=>j({query:e.query}),indexPatterns:[e],placeholder:s.i18n.translate("xpack.aiops.searchPanel.queryBarPlaceholderText",{defaultMessage:'Search… (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,showSubmitButton:!1,onFiltersUpdated:e=>j({filters:e})})))}}}]);