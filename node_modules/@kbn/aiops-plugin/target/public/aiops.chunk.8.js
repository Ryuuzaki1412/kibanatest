/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[8],{132:function(e,t,n){"use strict";n.r(t),n.d(t,"resolveEmbeddableChangePointUserInput",(function(){return E}));var a=n(76),i=n(1),l=n.n(i),o=n(39),s=n(2),c=n(13),u=n(11),r=n(55),d=n.n(r),b=n(12),p=n(40),m=n(51),j=n(62),g=n(41),f=n(0);const O=({value:e,onChange:t,splitField:n,enableSearch:a=!0})=>{const{dataView:l}=Object(g.c)(),{notifications:{toasts:c}}=Object(o.b)(),r=d()(n),[p,m]=Object(i.useState)([]),[O,v]=Object(i.useState)(a),{runRequest:h,cancelRequest:x}=Object(j.a)(),C=Object(i.useCallback)((async t=>{if(a){x(),v(!0);try{const a=function(e,t,n="",a){return{params:{index:e,size:0,...null!=a&&a.length?{query:{bool:{must_not:[{terms:{[t]:a}}]}}}:{},aggs:{aggResults:{filter:{bool:{must:{wildcard:{[t]:{value:`*${n}*`}}}}},aggs:{partitionValues:{terms:{field:t}}}}}}}}(l.getIndexPattern(),n,t,e),i=await h(a);if(null===i)return void m([]);m(i.rawResponse.aggregations.aggResults.partitionValues.buckets.map((e=>({value:e.key,label:e.key}))))}catch(e){c.addError(e,{title:u.i18n.translate("xpack.aiops.changePointDetection.fetchPartitionsErrorTitle",{defaultMessage:"Failed to fetch partitions"})})}v(!1)}}),[a,x,l,n,e,h,c]);Object(i.useEffect)((function(){C(""),void 0!==r&&n!==r&&t([])}),[n,r,C,t]);const F=Object(i.useMemo)((()=>e.map((e=>({value:e,label:e})))),[e]),M=Object(i.useCallback)((e=>{t(e.map((e=>e.value)))}),[t]),P=Object(i.useMemo)((()=>Object(b.debounce)(C,500)),[C]),y=Object(i.useCallback)((n=>{t([...e,n])}),[t,e]);return Object(f.jsx)(s.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.aiops.changePointDetection.partitionsLabel",{defaultMessage:"Partitions"})},Object(f.jsx)(s.EuiComboBox,{isLoading:O,fullWidth:!0,compressed:!0,options:p,selectedOptions:F,onChange:M,onSearchChange:a?P:void 0,onCreateOption:a?void 0:y,isClearable:!0,"data-test-subj":"aiopsChangePointPartitions"}))};var v=n(54),h=n(65),x=n(68),C=n(67),F=n(42),M=n(66),P=n(45);const y=({initialInput:e,onCreate:t,onCancel:n})=>{var a;const{unifiedSearch:{ui:{IndexPatternSelect:l}}}=Object(o.b)(),[r,d]=Object(i.useState)(null!==(a=null==e?void 0:e.dataViewId)&&void 0!==a?a:""),[m,j]=Object(i.useState)(Object(b.pick)(null!=e?e:{},["fn","metricField","splitField","maxSeriesToPlot","partitions"])),[O,v]=Object(i.useState)(!0),h=Object(i.useMemo)((()=>({...m,title:Object(p.a)(m)?u.i18n.translate("xpack.aiops.changePointDetection.attachmentTitle",{defaultMessage:"Change point: {function}({metric}){splitBy}",values:{function:m.fn,metric:null==m?void 0:m.metricField,splitBy:null!=m&&m.splitField?u.i18n.translate("xpack.aiops.changePointDetection.splitByTitle",{defaultMessage:' split by "{splitField}"',values:{splitField:m.splitField}}):""}}):"",dataViewId:r})),[m,r]);return Object(f.jsx)(s.EuiModal,{onClose:n,"data-test-subj":"aiopsChangePointChartEmbeddableInitializer"},Object(f.jsx)(s.EuiModalHeader,null,Object(f.jsx)(s.EuiModalHeaderTitle,null,Object(f.jsx)(c.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.modalTitle",defaultMessage:"Change point charts configuration"}))),Object(f.jsx)(s.EuiModalBody,null,Object(f.jsx)(s.EuiForm,null,Object(f.jsx)(s.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.aiops.embeddableChangePointChart.dataViewLabel",{defaultMessage:"Data view"})},Object(f.jsx)(l,{autoFocus:!r,fullWidth:!0,compressed:!0,indexPatternId:r,placeholder:u.i18n.translate("xpack.aiops.embeddableChangePointChart.dataViewSelectorPlaceholder",{defaultMessage:"Select data view"}),onChange:e=>{d(null!=e?e:"")}})),Object(f.jsx)(g.b,{dataViewId:r},Object(f.jsx)(s.EuiHorizontalRule,{margin:"s"}),Object(f.jsx)(F.b,null,Object(f.jsx)(S,{formInput:m,onChange:j,onValidationChange:v}))))),Object(f.jsx)(s.EuiModalFooter,null,Object(f.jsx)(s.EuiButtonEmpty,{onClick:n,"data-test-subj":"aiopsChangePointChartsInitializerCancelButton"},Object(f.jsx)(c.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.setupModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(f.jsx)(s.EuiButton,{"data-test-subj":"aiopsChangePointChartsInitializerConfirmButton",isDisabled:!O||!r,onClick:t.bind(null,h),fill:!0},Object(f.jsx)(c.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.setupModal.confirmButtonLabel",defaultMessage:"Confirm configurations"}))))},S=({formInput:e,onChange:t,onValidationChange:n})=>{var a,o;const{metricFieldOptions:u,splitFieldsOptions:r}=Object(F.d)(),b=d()(u),j=Object(i.useMemo)((()=>{const t=r.find((t=>t.name===(null==e?void 0:e.splitField)));var n;return!(!t||!t.esTypes)&&(null===(n=t.esTypes)||void 0===n?void 0:n.some((e=>e===m.a.KEYWORD)))}),[r,null==e?void 0:e.splitField]);Object(i.useEffect)((function(){var n,a;Object(p.a)(e)?b&&u!==b&&t({fn:e.fn,metricField:null===(n=u[0])||void 0===n?void 0:n.name,splitField:void 0,partitions:void 0,maxSeriesToPlot:e.maxSeriesToPlot}):t({fn:P.d,metricField:null===(a=u[0])||void 0===a?void 0:a.name,splitField:void 0,partitions:void 0,maxSeriesToPlot:v.a})}),[u,b,e,t]);const g=Object(i.useCallback)((n=>{t({...e,...n})}),[e,t]);return Object(p.a)(e)?Object(f.jsx)(l.a.Fragment,null,Object(f.jsx)(s.EuiFormRow,{fullWidth:!0,label:Object(f.jsx)(c.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.functionLabel",defaultMessage:"Function"})},Object(f.jsx)(M.a,{value:e.fn,onChange:e=>g({fn:e})})),Object(f.jsx)(C.a,{inline:!1,value:e.metricField,onChange:e=>g({metricField:e})}),Object(f.jsx)(x.a,{inline:!1,value:e.splitField,onChange:e=>g({splitField:e})}),e.splitField?Object(f.jsx)(O,{value:null!==(a=e.partitions)&&void 0!==a?a:[],onChange:e=>g({partitions:e}),splitField:e.splitField,enableSearch:j}):null,Object(f.jsx)(h.a,{inline:!1,disabled:!(null==e||null===(o=e.partitions)||void 0===o||!o.length),value:e.maxSeriesToPlot,onChange:e=>g({maxSeriesToPlot:e}),onValidationChange:e=>n(null===e)})):null};async function E(e,t,n){const{overlays:i}=e;return new Promise((async(l,s)=>{try{const c=i.openModal(Object(a.a)(Object(f.jsx)(o.a.Provider,{value:{...e,...t}},Object(f.jsx)(y,{initialInput:n,onCreate:e=>{c.close(),l(e)},onCancel:()=>{c.close(),s()}})),{theme:e.theme,i18n:e.i18n}))}catch(e){s(e)}}))}},50:function(e,t,n){"use strict";n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s}));var a=n(12),i=(n(51),n(40));function l(e){if(void 0!==(null==e?void 0:e.min)&&void 0!==e.max&&e.min>e.max)throw new Error("Invalid validator conditions");return Object(a.memoize)((t=>{const n={};return void 0!==(null==e?void 0:e.min)&&t<e.min&&(n.min=!0),void 0!==(null==e?void 0:e.max)&&t>e.max&&(n.max=!0),null!=e&&e.integerOnly&&!Number.isInteger(t)&&(n.integerOnly=!0),Object(i.a)(n)?n:null}))}function o(e){return Object(i.a)(e,["key","type","fieldName","fieldValue","doc_count","bg_count","total_doc_count","total_bg_count","score","pValue","normalizedScore"])}n(58),n(56),n(81);const s={KEYWORD:"keyword",LOG_PATTERN:"log_pattern"};let c;!function(e){e.HISTOGRAM="histogram",e.COUNTER="counter",e.GAUGE="gauge",e.SUMMARY="summary"}(c||(c={}))},54:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));const a=50,i=6},55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(1);t.default=function(e){var t=a.useRef();return a.useEffect((function(){t.current=e})),t.current}},56:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));const a=5e4;var i=n(12),l=n(40);function o(e){return"number"==typeof e&&e>0&&e<=.5}const s=e=>{var t;const n=(s=e,Object(l.a)(s,["probability"])?e.probability:function(e){let t=1;return e>a&&(t=Math.min(.5,a/e)),+(n=t).toFixed(Math.max(1-Math.log10(n),1));var n}(e.totalNumDocs));var s;const c=null!==(t=e.aggName)&&void 0!==t?t:"sample";return{wrap:t=>o(n)?{[c]:{random_sampler:{probability:n,...e.seed?{seed:e.seed}:{}},aggs:t}}:t,unwrap:e=>o(n)?Object(i.get)(e,[c]):e,probability:n}};n(48),n(4),[1e-5,5e-5,1e-4,5e-4,.001,.005,.01,.05,.1,.2,.3,.4,.5].map((e=>100*e))},58:function(e,t,n){"use strict";function a(e){let t=0,n=0;if(0===e.length)return t;for(let a=0;a<e.length;a++)n=e.charCodeAt(a),t=(t<<5)-t+n,t|=0;return t<0?-2*t:t}n.d(t,"a",(function(){return a}))},65:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n(1);var a=n(13),i=n(2),l=n(11),o=n(50),s=n(54),c=n(0);const u=Object(o.c)({min:1,max:s.b,integerOnly:!0}),r=({value:e,onChange:t,onValidationChange:n,disabled:o,inline:r=!0})=>{const d=null!==u(e),b=l.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotLabel",{defaultMessage:"Max series"});return Object(c.jsx)(i.EuiFormRow,{fullWidth:!0,isInvalid:d,error:Object(c.jsx)(a.FormattedMessage,{id:"xpack.aiops.changePointDetection.maxSeriesToPlotError",defaultMessage:"Max series value must be between {minValue} and {maxValue}",values:{minValue:1,maxValue:s.b}}),label:r?void 0:b},Object(c.jsx)(i.EuiFieldNumber,{"data-test-subj":"aiopsMaxSeriesControlFieldNumber",disabled:o,prepend:r?b:void 0,append:Object(c.jsx)(i.EuiToolTip,{content:l.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotDescription",{defaultMessage:"The maximum number of change points to visualize."})},Object(c.jsx)(i.EuiIcon,{type:"questionInCircle"})),compressed:!0,fullWidth:!0,isInvalid:d,value:e,onChange:e=>{const a=Number(e.target.value);t(a),n&&n(u(a))},min:1,max:s.b}))}},66:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(2),i=n(11),l=n(1),o=n.n(l),s=n(45),c=n(0);const u=o.a.memo((({value:e,onChange:t})=>{const n=Object.keys(s.h).map((e=>({id:e,label:e})));return Object(c.jsx)(a.EuiButtonGroup,{legend:i.i18n.translate("xpack.aiops.changePointDetection.selectFunctionLabel",{defaultMessage:"Function"}),options:n,idSelected:e,onChange:e=>t(e),isFullWidth:!0,buttonSize:"compressed"})}))},67:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1),i=n.n(a),l=n(11),o=n(2),s=n(42),c=n(39),u=n(0);const r=i.a.memo((({value:e,onChange:t,inline:n=!0})=>{var r;const{fieldStats:d}=Object(c.b)(),{metricFieldOptions:b}=Object(s.d)(),{renderOption:p,closeFlyout:m}=null!==(r=null==d?void 0:d.useFieldStatsTrigger())&&void 0!==r?r:{},j=Object(a.useMemo)((()=>b.map((e=>({value:e.name,label:e.displayName,field:{id:e.name,type:e.type}})))),[b]),g=j.filter((t=>t.value===e)),f=Object(a.useCallback)((e=>{const n=e[0];void 0!==n&&t(n.value),m&&m()}),[t,m]),O=l.i18n.translate("xpack.aiops.changePointDetection.selectMetricFieldLabel",{defaultMessage:"Metric field"});return Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(o.EuiFormRow,{fullWidth:!0,label:n?void 0:O},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:n?O:void 0,singleSelection:{asPlainText:!0},options:j,selectedOptions:g,onChange:f,isClearable:!1,"data-test-subj":"aiopsChangePointMetricField",renderOption:p})))}))},68:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1),i=n.n(a),l=n(11),o=n(2),s=n(39),c=n(42),u=n(0);const r=i.a.memo((({value:e,onChange:t,inline:n=!0})=>{var i;const{fieldStats:r}=Object(s.b)(),{renderOption:d,closeFlyout:b}=null!==(i=null==r?void 0:r.useFieldStatsTrigger())&&void 0!==i?i:{},{splitFieldsOptions:p}=Object(c.d)(),m=Object(a.useMemo)((()=>[{value:void 0,label:l.i18n.translate("xpack.aiops.changePointDetection.notSelectedSplitFieldLabel",{defaultMessage:"--- Not selected ---"})},...p.map((e=>({value:e.name,label:e.displayName,...e.name?{field:{id:e.name,type:null==e?void 0:e.type}}:{}})))]),[p]),j=m.filter((t=>t.value===e)),g=Object(a.useCallback)((e=>{const n=e[0],a=null==n?void 0:n.value;t(a),b&&b()}),[t,b]),f=l.i18n.translate("xpack.aiops.changePointDetection.selectSpitFieldLabel",{defaultMessage:"Split field"});return Object(u.jsx)(o.EuiFormRow,{fullWidth:!0,label:n?void 0:f},Object(u.jsx)(o.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:n?f:void 0,singleSelection:{asPlainText:!0},options:m,selectedOptions:j,onChange:g,isClearable:!0,"data-test-subj":"aiopsChangePointSplitField",renderOption:d}))}))},81:function(e,t,n){e.exports=n(17)(1918)}}]);