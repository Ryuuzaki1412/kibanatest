/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[11],{143:function(e,t,r){"use strict";r.r(t);var a=r(1),i=r.n(a),n=r(12),s=r(52),u=r(44),l=r(21),c=r(43),o=r(15),d=r(39),g=r(41),b=r(49),f=r(53),j=r(2),y=r(16),h=r(77),S=r(72),O=r(82);const v=e=>e&&{bMin:e.baselineMin,bMax:e.baselineMax,dMin:e.deviationMin,dMax:e.deviationMax};var m=r(5),x=r(85),p=r(71),F=r(94),w=r(0);const q=({stickyHistogram:e})=>{const{data:t}=Object(d.b)(),{dataView:r,savedSearch:i}=Object(g.c)(),{currentSelectedSignificantItem:s,currentSelectedGroup:l}=Object(f.b)(),[c,o]=Object(u.b)("logRateAnalysis",{wp:void 0,...Object(O.a)(undefined)});const[b,q]=Object(u.c)("_g"),[E,Q]=Object(a.useState)(i);Object(a.useEffect)((()=>{i&&Q(i)}),[i]);const M=Object(a.useCallback)((e=>{null!==E&&Q(null),o({...c,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[E,c,o]),{searchQueryLanguage:P,searchString:_,searchQuery:A}=Object(S.a)({dataView:r,savedSearch:i},c),{timefilter:I}=Object(h.a)(r,"log_rate_analysis",A,q,s,l);return Object(a.useEffect)((function(){return()=>{t.query.filterManager.getFilters().filter((e=>{var t;return(null===(t=e.$state)||void 0===t?void 0:t.store)===y.FilterStateStore.APP_STATE})).forEach((e=>t.query.filterManager.removeFilter(e)))}}),[t.query.filterManager]),Object(a.useEffect)((()=>{void 0!==(null==b?void 0:b.time)&&I.setTime({from:b.time.from,to:b.time.to})}),[JSON.stringify(null==b?void 0:b.time),I]),Object(a.useEffect)((()=>{void 0!==(null==b?void 0:b.refreshInterval)&&I.setRefreshInterval(b.refreshInterval)}),[JSON.stringify(null==b?void 0:b.refreshInterval),I]),Object(a.useEffect)((()=>{null==t||t.query.queryString.setQuery({query:null!=_?_:"",language:P})}),[t,P,_]),Object(w.jsx)(j.EuiPageBody,{"data-test-subj":"aiopsLogRateAnalysisPage",paddingSize:"none",panelled:!1},Object(w.jsx)(p.a,null),Object(w.jsx)(j.EuiSpacer,{size:"m"}),Object(w.jsx)(j.EuiPageSection,{paddingSize:"none"},Object(w.jsx)(j.EuiFlexGroup,{gutterSize:"m",direction:"column"},Object(w.jsx)(j.EuiFlexItem,null,Object(w.jsx)(x.a,{dataView:r,searchString:null!=_?_:"",searchQuery:A,searchQueryLanguage:P,setSearchParams:M})),Object(w.jsx)(F.a,{initialAnalysisStart:(L=c.wp,L&&{baselineMin:L.bMin,baselineMax:L.bMax,deviationMin:L.dMin,deviationMax:L.dMax}),dataView:r,embeddingOrigin:m.a.AIOPS_DEFAULT_SOURCE,esSearchQuery:A,onWindowParametersChange:e=>{Object(n.isEqual)(e,c.wp)||o({wp:v(e)})},setGlobalState:q,stickyHistogram:e}))));var L};var E=r(75);const Q=new l.Storage(window.localStorage);t.default=({dataView:e,savedSearch:t,appDependencies:r,stickyHistogram:a,showFrozenDataTierChoice:l=!0})=>{if(!e)return null;const j=Object(E.a)(e,"log_rate_analysis");if(null!==j)return Object(w.jsx)(i.a.Fragment,null,j);const y={...Object(n.pick)(r,["data","http","notifications","theme","uiSettings","i18n"]),uiSettingsKeys:o.UI_SETTINGS,showFrozenDataTierChoice:l};return Object(w.jsx)(d.a.Provider,{value:r},Object(w.jsx)(u.a,null,Object(w.jsx)(g.a.Provider,{value:{dataView:e,savedSearch:t}},Object(w.jsx)(f.a,null,Object(w.jsx)(s.a,{storage:Q,storageKeys:b.d},Object(w.jsx)(c.a,y,Object(w.jsx)(q,{stickyHistogram:a})))))))}},46:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return c}));var a=r(12),i=r(15),n=r(19),s=r(16),u=(r(40),r(47));function l(e,t,r,a){let l=Object(u.d)();if(Object(n.isQuery)(e)&&e.language===u.a.KUERY){const a=Object(s.fromKueryExpression)(e.query);if(""!==e.query&&(l=Object(s.toElasticsearchQuery)(a,r)),void 0!==l.bool){const e=Object(s.buildQueryFromFilters)(t,r);Array.isArray(l.bool.filter)||(l.bool.filter=void 0===l.bool.filter?[]:[l.bool.filter]),Array.isArray(l.bool.must_not)||(l.bool.must_not=void 0===l.bool.must_not?[]:[l.bool.must_not]),l.bool.filter=[...l.bool.filter,...e.filter],l.bool.must_not=[...l.bool.must_not,...e.must_not]}}else l=Object(s.buildEsQuery)(r,e?[e]:[],t||[],a?Object(i.getEsQueryConfig)(a):void 0);return l}function c({dataView:e,uiSettings:t,savedSearch:r,query:s,filters:c,filterManager:o}){if(!e||!r)return;const d=s,g=c,b=function(e){return e&&"searchSource"in e&&(null==e?void 0:e.searchSource)instanceof i.SearchSource?e.searchSource:void 0}(r);if(b&&void 0!==b.getParent()&&d){var f,j,y;const e=null!==(f=Object(a.cloneDeep)(null===(j=r.searchSource.getSearchRequestBody())||void 0===j?void 0:j.query))&&void 0!==f?f:Object(u.d)(),t=null===(y=r.searchSource.getField("index"))||void 0===y?void 0:y.timeFieldName;return Array.isArray(e.bool.filter)&&void 0!==t&&(e.bool.filter=e.bool.filter.filter((e=>{var r;return!(e.hasOwnProperty("range")&&null!==(r=e.range)&&void 0!==r&&r.hasOwnProperty(t))}))),{searchQuery:e,searchString:d.query,queryLanguage:d.language}}if(!r&&d)return o&&g&&o.addFilters(g),{searchQuery:l(d,Array.isArray(g)?g:[],e,t),searchString:d.query,queryLanguage:d.language};if(b){const r=null==o?void 0:o.getGlobalFilters(),a=null!=d?d:b.getField("query"),i=null!=g?g:Object(n.mapAndFlattenFilters)(b.getField("filter"));return o&&o.setFilters(i),r&&(null==o||o.addFilters(r)),{searchQuery:l(a,o?null==o?void 0:o.getFilters():i,e,t),searchString:a.query,queryLanguage:a.language}}}},71:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var a=r(0),i=r(1),n=r(2),s=r(44),u=r(52),l=r(43),c=r(14),o=r.n(c),d=r(41),g=r(49);const b={name:"1v0pok0",styles:"min-width:300px"},f=()=>{const[,e]=Object(s.c)("_g"),{dataView:t}=Object(d.c)(),[r,c]=Object(u.b)(g.a,l.c.EXCLUDE),f=Object(l.g)({timeRangeSelector:void 0!==t.timeFieldName,autoRefreshSelector:!0}),j=Object(i.useCallback)((t=>{e({time:{from:o()(t.start.epoch).toISOString(),to:o()(t.end.epoch).toISOString()}})}),[e]),y=Object(i.useMemo)((()=>void 0!==t.timeFieldName&&""!==t.timeFieldName),[t.timeFieldName]);return Object(a.jsx)(n.EuiPageHeader,{pageTitle:Object(a.jsx)("div",{css:b},t.getName()),rightSideItems:[Object(a.jsx)(n.EuiFlexGroup,{gutterSize:"s","data-test-subj":"aiopsTimeRangeSelectorSection"},y?Object(a.jsx)(n.EuiFlexItem,{grow:!1},Object(a.jsx)(l.d,{frozenDataPreference:r,setFrozenDataPreference:c,dataView:t,query:void 0,disabled:!1,timefilter:f,callback:j})):null,Object(a.jsx)(l.b,{isAutoRefreshOnly:!y,showRefresh:!y,width:"full",flexGroup:!1}))]})}},72:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(1),i=r(46),n=r(39);const s=({dataView:e,savedSearch:t},r,s=!1)=>{const{uiSettings:u,data:{query:{filterManager:l}}}=Object(n.b)(),c=Object(a.useMemo)((()=>Object(i.b)({dataView:e,uiSettings:u,savedSearch:t,filterManager:l})),[e,u,t,l]);if(void 0===c||r&&""!==r.searchString){if(null!=r&&r.filters&&!1===s){const e=null==l?void 0:l.getGlobalFilters();l&&l.setFilters(r.filters),e&&(null==l||l.addFilters(e))}return{searchQuery:null==r?void 0:r.searchQuery,searchString:null==r?void 0:r.searchString,searchQueryLanguage:null==r?void 0:r.searchQueryLanguage}}return{searchQuery:c.searchQuery,searchString:c.searchString,searchQueryLanguage:c.queryLanguage}}},82:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(47);const i={match_all:{}},n=e=>({searchString:"",searchQuery:i,searchQueryLanguage:a.a.KUERY,filters:[],...e})},85:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(1),i=r(2),n=r(11),s=r(39),u=r(46),l=r(0);const c=({dataView:e,searchString:t,searchQueryLanguage:r,setSearchParams:c})=>{const{uiSettings:o,unifiedSearch:{ui:{SearchBar:d}},notifications:{toasts:g},data:{query:b}}=Object(s.b)(),[f,j]=Object(a.useState)({query:t||"",language:r});Object(a.useEffect)((()=>{j({query:t||"",language:r})}),[r,t,b.filterManager]);const y=({query:t,filters:r})=>{const a=null!=t?t:f,i=null!=r?r:b.filterManager.getFilters();try{var s;i&&b.filterManager.setFilters(i);const t=Object(u.a)(a,null!==(s=b.filterManager.getFilters())&&void 0!==s?s:[],e,o);c({searchQuery:t,searchString:a.query,queryLanguage:a.language,filters:i})}catch(e){console.log("Invalid syntax",JSON.stringify(e,null,2)),g.addError(e,{title:n.i18n.translate("xpack.aiops.searchPanel.invalidSyntax",{defaultMessage:"Invalid syntax"})})}};return Object(l.jsx)(i.EuiFlexGroup,{gutterSize:"s","data-test-subj":"aiopsSearchPanel",responsive:!1},Object(l.jsx)(i.EuiFlexItem,{grow:9},Object(l.jsx)(d,{dataTestSubj:"aiopsQueryInput",appName:"aiops",showFilterBar:!0,showDatePicker:!1,showQueryInput:!0,query:f,onQuerySubmit:e=>y({query:e.query}),indexPatterns:[e],placeholder:n.i18n.translate("xpack.aiops.searchPanel.queryBarPlaceholderText",{defaultMessage:'Searchâ€¦ (e.g. status:200 AND extension:"PHP")'}),displayStyle:"inPage",isClearable:!0,showSubmitButton:!1,onFiltersUpdated:e=>y({filters:e})})))}}}]);