/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[17],{142:function(e,t,n){"use strict";n.r(t),n.d(t,"registerEmbeddable",(function(){return M}));var i=n(48),a=n.n(i),s=n(3),o=n(11),r=n(5),d=n(1),l=n(23),c=n.n(l),u=n(24),p=n(19),h=n(43),b=n(12),m=n(4),g=n(18),j=n(0),O=n(59),C=n.n(O),v=n(80),y=n(42),f=n(61),x=n(41),R=n(39),w=n(78),E=n(46),S=n(88),_=n(95),I=n(90);const F="p_value",P=({input$:e,initialInput:t,reload$:n,onOutputChange:i,onRenderComplete:a,onLoading:s,onError:o})=>{var r;const l=C()(e,t),[c]=Object(d.useState)(new m.BehaviorSubject(null!==(r=t.lastReloadRequestTime)&&void 0!==r?r:Date.now()));Object(d.useEffect)((function(){l.lastReloadRequestTime!==t.lastReloadRequestTime&&l.lastReloadRequestTime&&c.next(l.lastReloadRequestTime)}),[l.lastReloadRequestTime,t.lastReloadRequestTime,c]);const u=Object(d.useMemo)((()=>Object(m.combineLatest)([n,c]).pipe(Object(g.map)((([e,t])=>Math.max(e,t))),Object(g.distinctUntilChanged)())),[c,n]);return Object(j.jsx)(v.a,{reload$:u},Object(j.jsx)(x.b,{dataViewId:l.dataViewId},Object(j.jsx)(y.b,null,Object(j.jsx)(f.a,{timeRange:l.timeRange},Object(j.jsx)(L,{timeRange:l.timeRange,fn:l.fn,metricField:l.metricField,splitField:l.splitField,maxSeriesToPlot:l.maxSeriesToPlot,dataViewId:l.dataViewId,partitions:l.partitions,onLoading:s,onRenderComplete:a,onError:o,onChange:l.onChange,emptyState:l.emptyState})))))};var T={name:"1yghct1",styles:"overflow:auto;width:100%"};const L=({fn:e,metricField:t,maxSeriesToPlot:n,splitField:i,partitions:a,onError:s,onLoading:o,onRenderComplete:r,onChange:l,emptyState:c})=>{const{filters:u,query:p,timeRange:b}=Object(f.b)(),m=Object(d.useMemo)((()=>({fn:e,metricField:t,splitField:i})),[e,t,i]),{dataView:g}=Object(x.c)(),{uiSettings:O}=Object(R.b)(),C=Object(w.a)(),v=Object(h.g)(),y=Object(d.useMemo)((()=>(C.setInterval("auto"),C.setBounds(v.calculateBounds(b)),C.getInterval().expression)),[b,C,v]),P=Object(d.useMemo)((()=>{var e;const t=Object(E.a)(p,u,g,O);var n;return Array.isArray(null===(e=t.bool)||void 0===e?void 0:e.filter)||(t.bool||(t.bool={}),t.bool.filter=[]),t.bool.filter.push({range:{[g.timeFieldName]:{from:b.from,to:b.to}}}),Array.isArray(a)&&a.length>0&&m.splitField&&(null===(n=t.bool)||void 0===n||n.filter.push({terms:{[m.splitField]:a}})),t}),[g,m.splitField,u,a,p,b.from,b.to,O]),L=Object(d.useMemo)((()=>({interval:y})),[y]),{results:M,isLoading:$}=Object(S.a)(m,L,P,1e4);Object(d.useEffect)((()=>{$&&o()}),[o,$]);const A=Object(d.useMemo)((()=>{let e=M.sort(((e,t)=>e[F]-t[F]));return n&&(e=e.slice(0,n)),l&&l(e),e}),[M,n,l]);return Object(j.jsx)("div",{css:T},A.length>0?Object(j.jsx)(_.a,{changePoints:A.map((e=>({...e,...m}))),interval:L.interval,onRenderComplete:r}):c||Object(j.jsx)(I.a,{onRenderComplete:r}))};class embeddable_change_point_chart_EmbeddableChangePointChart extends s.Embeddable{reload(){this.reload$.next(Date.now())}constructor(e,t,n){super(t,{},n),a()(this,"type",r.c),a()(this,"reload$",new m.Subject),a()(this,"node",void 0),a()(this,"deferEmbeddableLoad",!0),this.deps=e,this.initOutput().finally((()=>this.setInitializationFinished()))}async initOutput(){const{data:{dataViews:e}}=this.deps,{dataViewId:t}=this.getInput(),n=await e.get(t);this.updateOutput({indexPatterns:[n]})}reportsEmbeddableLoad(){return!0}onLoading(){this.renderComplete.dispatchInProgress(),this.updateOutput({loading:!0,error:void 0})}onError(e){this.renderComplete.dispatchError(),this.updateOutput({loading:!1,error:{name:e.name,message:e.message}})}onRenderComplete(){this.renderComplete.dispatchComplete(),this.updateOutput({loading:!1,error:void 0})}render(e){var t,n;super.render(e),this.node=e,this.node.setAttribute("data-shared-item",""),this.node.setAttribute("data-test-subj","aiopsEmbeddableChangePointChart");const i=this.deps.i18n.Context,a={...Object(b.pick)(this.deps,["data","http","notifications","theme","uiSettings","i18n"]),uiSettingsKeys:p.UI_SETTINGS},s=this.getInput(),o=this.getInput$(),l={...this.deps,embeddingOrigin:null!==(t=null===(n=this.parent)||void 0===n?void 0:n.type)&&void 0!==t?t:r.d};c.a.render(Object(j.jsx)(i,null,Object(j.jsx)(u.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(j.jsx)(R.a.Provider,{value:l},Object(j.jsx)(h.a,a,Object(j.jsx)(d.Suspense,{fallback:null},Object(j.jsx)(P,{input$:o,initialInput:s,reload$:this.reload$,onOutputChange:this.updateOutput.bind(this),onRenderComplete:this.onRenderComplete.bind(this),onLoading:this.onLoading.bind(this),onError:this.onError.bind(this)})))))),e)}destroy(){super.destroy(),this.node&&c.a.unmountComponentAtNode(this.node)}}class embeddable_change_point_chart_factory_EmbeddableChangePointChartFactory{constructor(e){a()(this,"type",r.c),a()(this,"grouping",[{id:"ml",getDisplayName:()=>o.i18n.translate("xpack.aiops.navMenu.mlAppNameText",{defaultMessage:"Machine Learning"}),getIconType:()=>"machineLearningApp"}]),a()(this,"isEditable",(async()=>!0)),this.getStartServices=e}getDisplayName(){return o.i18n.translate("xpack.aiops.embeddableChangePointChartDisplayName",{defaultMessage:"Change point detection"})}canCreateNew(){return!0}async getExplicitInput(){const[e,t]=await this.getStartServices();try{const{resolveEmbeddableChangePointUserInput:i}=await n.e(8).then(n.bind(null,132));return await i(e,t)}catch(e){return Promise.reject()}}async create(e,t){try{const[{i18n:n,theme:i,http:a,uiSettings:s,notifications:o},{lens:r,data:d,usageCollection:l}]=await this.getStartServices();return new embeddable_change_point_chart_EmbeddableChangePointChart({theme:i,http:a,i18n:n,uiSettings:s,data:d,notifications:o,lens:r,usageCollection:l},e,t)}catch(n){return new s.ErrorEmbeddable(n,e,t)}}}const M=(e,t)=>{const n=new embeddable_change_point_chart_factory_EmbeddableChangePointChartFactory(e.getStartServices);t.registerEmbeddableFactory(n.type,n)}}}]);