/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.aiops_bundle_jsonpfunction=window.aiops_bundle_jsonpfunction||[]).push([[9],{132:function(e,t,n){"use strict";n.r(t),n.d(t,"resolveEmbeddableChangePointUserInput",(function(){return M}));var i=n(76),a=n(1),s=n.n(a),l=n(39),o=n(2),r=n(13),u=n(11),c=n(55),d=n.n(c),b=n(12),p=n(40),j=n(51),g=n(62),f=n(41),m=n(0);const O=({value:e,onChange:t,splitField:n,enableSearch:i=!0})=>{const{dataView:s}=Object(f.c)(),{notifications:{toasts:r}}=Object(l.b)(),c=d()(n),[p,j]=Object(a.useState)([]),[O,v]=Object(a.useState)(i),{runRequest:h,cancelRequest:x}=Object(g.a)(),C=Object(a.useCallback)((async t=>{if(i){x(),v(!0);try{const i=function(e,t,n="",i){return{params:{index:e,size:0,...null!=i&&i.length?{query:{bool:{must_not:[{terms:{[t]:i}}]}}}:{},aggs:{aggResults:{filter:{bool:{must:{wildcard:{[t]:{value:`*${n}*`}}}}},aggs:{partitionValues:{terms:{field:t}}}}}}}}(s.getIndexPattern(),n,t,e),a=await h(i);if(null===a)return void j([]);j(a.rawResponse.aggregations.aggResults.partitionValues.buckets.map((e=>({value:e.key,label:e.key}))))}catch(e){r.addError(e,{title:u.i18n.translate("xpack.aiops.changePointDetection.fetchPartitionsErrorTitle",{defaultMessage:"Failed to fetch partitions"})})}v(!1)}}),[i,x,s,n,e,h,r]);Object(a.useEffect)((function(){C(""),void 0!==c&&n!==c&&t([])}),[n,c,C,t]);const F=Object(a.useMemo)((()=>e.map((e=>({value:e,label:e})))),[e]),P=Object(a.useCallback)((e=>{t(e.map((e=>e.value)))}),[t]),S=Object(a.useMemo)((()=>Object(b.debounce)(C,500)),[C]),y=Object(a.useCallback)((n=>{t([...e,n])}),[t,e]);return Object(m.jsx)(o.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.aiops.changePointDetection.partitionsLabel",{defaultMessage:"Partitions"})},Object(m.jsx)(o.EuiComboBox,{isLoading:O,fullWidth:!0,compressed:!0,options:p,selectedOptions:F,onChange:P,onSearchChange:i?S:void 0,onCreateOption:i?void 0:y,isClearable:!0,"data-test-subj":"aiopsChangePointPartitions"}))};var v=n(54),h=n(65),x=n(68),C=n(67),F=n(42),P=n(66),S=n(45);const y=({initialInput:e,onCreate:t,onCancel:n})=>{var i;const{unifiedSearch:{ui:{IndexPatternSelect:s}}}=Object(l.b)(),[c,d]=Object(a.useState)(null!==(i=null==e?void 0:e.dataViewId)&&void 0!==i?i:""),[j,g]=Object(a.useState)(Object(b.pick)(null!=e?e:{},["fn","metricField","splitField","maxSeriesToPlot","partitions"])),[O,v]=Object(a.useState)(!0),h=Object(a.useMemo)((()=>({...j,title:Object(p.a)(j)?u.i18n.translate("xpack.aiops.changePointDetection.attachmentTitle",{defaultMessage:"Change point: {function}({metric}){splitBy}",values:{function:j.fn,metric:null==j?void 0:j.metricField,splitBy:null!=j&&j.splitField?u.i18n.translate("xpack.aiops.changePointDetection.splitByTitle",{defaultMessage:' split by "{splitField}"',values:{splitField:j.splitField}}):""}}):"",dataViewId:c})),[j,c]);return Object(m.jsx)(o.EuiModal,{onClose:n,"data-test-subj":"aiopsChangePointChartEmbeddableInitializer"},Object(m.jsx)(o.EuiModalHeader,null,Object(m.jsx)(o.EuiModalHeaderTitle,null,Object(m.jsx)(r.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.modalTitle",defaultMessage:"Change point charts configuration"}))),Object(m.jsx)(o.EuiModalBody,null,Object(m.jsx)(o.EuiForm,null,Object(m.jsx)(o.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.aiops.embeddableChangePointChart.dataViewLabel",{defaultMessage:"Data view"})},Object(m.jsx)(s,{autoFocus:!c,fullWidth:!0,compressed:!0,indexPatternId:c,placeholder:u.i18n.translate("xpack.aiops.embeddableChangePointChart.dataViewSelectorPlaceholder",{defaultMessage:"Select data view"}),onChange:e=>{d(null!=e?e:"")}})),Object(m.jsx)(f.b,{dataViewId:c},Object(m.jsx)(o.EuiHorizontalRule,{margin:"s"}),Object(m.jsx)(F.b,null,Object(m.jsx)(E,{formInput:j,onChange:g,onValidationChange:v}))))),Object(m.jsx)(o.EuiModalFooter,null,Object(m.jsx)(o.EuiButtonEmpty,{onClick:n,"data-test-subj":"aiopsChangePointChartsInitializerCancelButton"},Object(m.jsx)(r.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.setupModal.cancelButtonLabel",defaultMessage:"Cancel"})),Object(m.jsx)(o.EuiButton,{"data-test-subj":"aiopsChangePointChartsInitializerConfirmButton",isDisabled:!O||!c,onClick:t.bind(null,h),fill:!0},Object(m.jsx)(r.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.setupModal.confirmButtonLabel",defaultMessage:"Confirm configurations"}))))},E=({formInput:e,onChange:t,onValidationChange:n})=>{var i,l;const{metricFieldOptions:u,splitFieldsOptions:c}=Object(F.d)(),b=d()(u),g=Object(a.useMemo)((()=>{const t=c.find((t=>t.name===(null==e?void 0:e.splitField)));var n;return!(!t||!t.esTypes)&&(null===(n=t.esTypes)||void 0===n?void 0:n.some((e=>e===j.a.KEYWORD)))}),[c,null==e?void 0:e.splitField]);Object(a.useEffect)((function(){var n,i;Object(p.a)(e)?b&&u!==b&&t({fn:e.fn,metricField:null===(n=u[0])||void 0===n?void 0:n.name,splitField:void 0,partitions:void 0,maxSeriesToPlot:e.maxSeriesToPlot}):t({fn:S.d,metricField:null===(i=u[0])||void 0===i?void 0:i.name,splitField:void 0,partitions:void 0,maxSeriesToPlot:v.a})}),[u,b,e,t]);const f=Object(a.useCallback)((n=>{t({...e,...n})}),[e,t]);return Object(p.a)(e)?Object(m.jsx)(s.a.Fragment,null,Object(m.jsx)(o.EuiFormRow,{fullWidth:!0,label:Object(m.jsx)(r.FormattedMessage,{id:"xpack.aiops.embeddableChangePointChart.functionLabel",defaultMessage:"Function"})},Object(m.jsx)(P.a,{value:e.fn,onChange:e=>f({fn:e})})),Object(m.jsx)(C.a,{inline:!1,value:e.metricField,onChange:e=>f({metricField:e})}),Object(m.jsx)(x.a,{inline:!1,value:e.splitField,onChange:e=>f({splitField:e})}),e.splitField?Object(m.jsx)(O,{value:null!==(i=e.partitions)&&void 0!==i?i:[],onChange:e=>f({partitions:e}),splitField:e.splitField,enableSearch:g}):null,Object(m.jsx)(h.a,{inline:!1,disabled:!(null==e||null===(l=e.partitions)||void 0===l||!l.length),value:e.maxSeriesToPlot,onChange:e=>f({maxSeriesToPlot:e}),onValidationChange:e=>n(null===e)})):null};async function M(e,t,n){const{overlays:a}=e;return new Promise((async(s,o)=>{try{const r=a.openModal(Object(i.a)(Object(m.jsx)(l.a.Provider,{value:{...e,...t}},Object(m.jsx)(y,{initialInput:n,onCreate:e=>{r.close(),s(e)},onCancel:()=>{r.close(),o()}})),{theme:e.theme,i18n:e.i18n}))}catch(e){o(e)}}))}},42:function(e,t,n){"use strict";n.d(t,"d",(function(){return m})),n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return v})),n.d(t,"c",(function(){return h}));var i=n(1),a=n(4),s=n(44),l=n(43),o=n(51),r=n(61),u=n(45),c=n(46),d=n(39),b=n(41),p=n(78),j=n(0);const g=Object(i.createContext)({splitFieldsOptions:[],metricFieldOptions:[],requestParams:{},timeBuckets:{},bucketInterval:{},updateRequestParams:()=>{},resultFilters:[],updateFilters:()=>{},resultQuery:{query:"",language:"kuery"},combinedQuery:{},selectedChangePoints:{},setSelectedChangePoints:()=>{}}),f=Object(i.createContext)({splitFieldsOptions:[],metricFieldOptions:[]}),m=()=>Object(i.useContext)(f),O=({children:e})=>{const{dataView:t}=Object(b.c)(),n={metricFieldOptions:Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,type:t})=>e&&"number"===t))),[t]),splitFieldsOptions:Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,esTypes:t,displayName:n})=>e&&t&&t.some((e=>[o.a.KEYWORD,o.a.IP].includes(e)))&&!["_id","_index"].includes(n)))),[t])};return Object(j.jsx)(f.Provider,{value:n},e)},v=({children:e})=>{const{dataView:t,savedSearch:n}=Object(b.c)(),{uiSettings:f,data:{query:{filterManager:m}}}=Object(d.b)(),O=Object(i.useMemo)((()=>Object(c.b)({dataView:t,uiSettings:f,savedSearch:n,filterManager:m})),[t,n,f,m]),v=Object(l.g)(),h=Object(p.a)(),[x,C]=Object(i.useState)([]),[F,P]=Object(i.useState)({}),[S,y]=Object(i.useState)(),E=Object(l.f)(!0);Object(i.useEffect)((function(){const e=v.getTimeUpdate$().pipe(Object(a.startWith)(v.getTime())).subscribe((()=>{const e=v.getActiveBounds();if(!e)throw new Error("Time bound not available");h.setInterval("auto"),h.setBounds(e),y(h.getInterval())}));return()=>{e.unsubscribe()}}),[]);const M=Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,type:t})=>e&&"number"===t))),[t]),T=Object(i.useMemo)((()=>t.fields.filter((({aggregatable:e,esTypes:t,displayName:n})=>e&&t&&t.some((e=>[o.a.KEYWORD,o.a.IP].includes(e)))&&!["_id","_index"].includes(n)))),[t]),[k,w]=Object(s.b)("changePoint"),R=Object(i.useMemo)((()=>{var e,t,n;return null!==(e=k.query)&&void 0!==e?e:{query:null!==(t=null==O?void 0:O.searchString)&&void 0!==t?t:"",language:null!==(n=null==O?void 0:O.queryLanguage)&&void 0!==n?n:"kuery"}}),[O,k.query]),I=Object(i.useMemo)((()=>{const e={...k};var t;return e.fieldConfigs||(e.fieldConfigs=[{fn:u.d,metricField:null===(t=M[0])||void 0===t?void 0:t.name}]),e.interval=null==S?void 0:S.expression,e}),[k,M,S]),_=Object(i.useCallback)((e=>{m.setFilters(e)}),[m]);Object(i.useEffect)((()=>{C(m.getFilters());const e=m.getUpdates$().subscribe((()=>{C(m.getFilters())}));return()=>{e.unsubscribe()}}),[]),Object(i.useEffect)((function(){const e=null==m?void 0:m.getGlobalFilters();k.filters&&m.setFilters(k.filters),e&&(null==m||m.addFilters(e))}),[k.filters,m]);const N=Object(i.useMemo)((()=>{var e;const n=Object(c.a)(R,x,t,f);return Array.isArray(null===(e=n.bool)||void 0===e?void 0:e.filter)||(n.bool||(n.bool={}),n.bool.filter=[]),n.bool.filter.push({range:{[t.timeFieldName]:{from:E.from,to:E.to}}}),n}),[x,R,f,t,E]);if(!S)return null;const D={timeBuckets:h,requestParams:I,updateRequestParams:w,metricFieldOptions:M,splitFieldsOptions:T,bucketInterval:S,resultFilters:x,updateFilters:_,resultQuery:R,combinedQuery:N,selectedChangePoints:F,setSelectedChangePoints:P};return Object(j.jsx)(g.Provider,{value:D},Object(j.jsx)(r.a,null,e))};function h(){return Object(i.useContext)(g)}},45:function(e,t,n){"use strict";n.d(t,"h",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"g",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return r})),n.d(t,"f",(function(){return u})),n.d(t,"a",(function(){return c}));const i={avg:"average",max:"max",min:"min",sum:"sum"},a="avg",s=1e4,l=500,o={DIP:"dip",SPIKE:"spike",DISTRIBUTION_CHANGE:"distribution_change",STEP_CHANGE:"step_change",TREND_CHANGE:"trend_change",STATIONARY:"stationary",NON_STATIONARY:"non_stationary",INDETERMINABLE:"indeterminable"},r=new Set([o.STATIONARY,o.NON_STATIONARY,o.INDETERMINABLE]),u=6,c={RUN:"ran_aiops_change_point_detection",SUCCESS:"aiops_change_point_detection_success",ERROR:"aiops_change_point_detection_error"}},54:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));const i=50,a=6},55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.default=function(e){var t=i.useRef();return i.useEffect((function(){t.current=e})),t.current}},61:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return u}));var i=n(1),a=n(43),s=n(39),l=n(0);const o=Object(i.createContext)({get filters(){throw new Error("FilterQueryContext is not initialized")},get query(){throw new Error("FilterQueryContext is not initialized")},get timeRange(){throw new Error("FilterQueryContext is not initialized")}}),r=({children:e,timeRange:t})=>{const{data:{query:{filterManager:n,queryString:r}}}=Object(s.b)(),[u,c]=Object(i.useState)(n.getFilters()),[d,b]=Object(i.useState)(r.getQuery()),p=Object(a.f)(!1);return Object(i.useEffect)((()=>{const e=n.getUpdates$().subscribe((()=>{c(n.getFilters())}));return()=>{e.unsubscribe()}}),[n]),Object(i.useEffect)((()=>{const e=r.getUpdates$().subscribe((()=>{b(r.getQuery())}));return()=>{e.unsubscribe()}}),[r]),Object(l.jsx)(o.Provider,{value:{filters:u,query:d,timeRange:null!=t?t:p}},e)},u=()=>Object(i.useContext)(o)},62:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(1),a=n(15),s=n(18),l=n(39);function o(){const{data:e}=Object(l.b)(),t=Object(i.useRef)(new AbortController),[n,o]=Object(i.useState)(!1);return{runRequest:Object(i.useCallback)((n=>new Promise(((i,l)=>{e.search.search(n,{abortSignal:t.current.signal}).pipe(Object(s.tap)((()=>{o(!0)}))).subscribe({next:e=>{Object(a.isRunningResponse)(e)||(o(!1),i(e))},error:e=>{if("AbortError"===e.name)return i(null);o(!1),l(e)}})}))),[e.search]),cancelRequest:Object(i.useCallback)((()=>{t.current.abort(),t.current=new AbortController}),[]),isLoading:n}}},65:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n(1);var i=n(13),a=n(2),s=n(11),l=n(50),o=n(54),r=n(0);const u=Object(l.c)({min:1,max:o.b,integerOnly:!0}),c=({value:e,onChange:t,onValidationChange:n,disabled:l,inline:c=!0})=>{const d=null!==u(e),b=s.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotLabel",{defaultMessage:"Max series"});return Object(r.jsx)(a.EuiFormRow,{fullWidth:!0,isInvalid:d,error:Object(r.jsx)(i.FormattedMessage,{id:"xpack.aiops.changePointDetection.maxSeriesToPlotError",defaultMessage:"Max series value must be between {minValue} and {maxValue}",values:{minValue:1,maxValue:o.b}}),label:c?void 0:b},Object(r.jsx)(a.EuiFieldNumber,{"data-test-subj":"aiopsMaxSeriesControlFieldNumber",disabled:l,prepend:c?b:void 0,append:Object(r.jsx)(a.EuiToolTip,{content:s.i18n.translate("xpack.aiops.changePointDetection.maxSeriesToPlotDescription",{defaultMessage:"The maximum number of change points to visualize."})},Object(r.jsx)(a.EuiIcon,{type:"questionInCircle"})),compressed:!0,fullWidth:!0,isInvalid:d,value:e,onChange:e=>{const i=Number(e.target.value);t(i),n&&n(u(i))},min:1,max:o.b}))}},66:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(2),a=n(11),s=n(1),l=n.n(s),o=n(45),r=n(0);const u=l.a.memo((({value:e,onChange:t})=>{const n=Object.keys(o.h).map((e=>({id:e,label:e})));return Object(r.jsx)(i.EuiButtonGroup,{legend:a.i18n.translate("xpack.aiops.changePointDetection.selectFunctionLabel",{defaultMessage:"Function"}),options:n,idSelected:e,onChange:e=>t(e),isFullWidth:!0,buttonSize:"compressed"})}))},67:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(1),a=n.n(i),s=n(11),l=n(2),o=n(42),r=n(39),u=n(0);const c=a.a.memo((({value:e,onChange:t,inline:n=!0})=>{var c;const{fieldStats:d}=Object(r.b)(),{metricFieldOptions:b}=Object(o.d)(),{renderOption:p,closeFlyout:j}=null!==(c=null==d?void 0:d.useFieldStatsTrigger())&&void 0!==c?c:{},g=Object(i.useMemo)((()=>b.map((e=>({value:e.name,label:e.displayName,field:{id:e.name,type:e.type}})))),[b]),f=g.filter((t=>t.value===e)),m=Object(i.useCallback)((e=>{const n=e[0];void 0!==n&&t(n.value),j&&j()}),[t,j]),O=s.i18n.translate("xpack.aiops.changePointDetection.selectMetricFieldLabel",{defaultMessage:"Metric field"});return Object(u.jsx)(a.a.Fragment,null,Object(u.jsx)(l.EuiFormRow,{fullWidth:!0,label:n?void 0:O},Object(u.jsx)(l.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:n?O:void 0,singleSelection:{asPlainText:!0},options:g,selectedOptions:f,onChange:m,isClearable:!1,"data-test-subj":"aiopsChangePointMetricField",renderOption:p})))}))},68:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(1),a=n.n(i),s=n(11),l=n(2),o=n(39),r=n(42),u=n(0);const c=a.a.memo((({value:e,onChange:t,inline:n=!0})=>{var a;const{fieldStats:c}=Object(o.b)(),{renderOption:d,closeFlyout:b}=null!==(a=null==c?void 0:c.useFieldStatsTrigger())&&void 0!==a?a:{},{splitFieldsOptions:p}=Object(r.d)(),j=Object(i.useMemo)((()=>[{value:void 0,label:s.i18n.translate("xpack.aiops.changePointDetection.notSelectedSplitFieldLabel",{defaultMessage:"--- Not selected ---"})},...p.map((e=>({value:e.name,label:e.displayName,...e.name?{field:{id:e.name,type:null==e?void 0:e.type}}:{}})))]),[p]),g=j.filter((t=>t.value===e)),f=Object(i.useCallback)((e=>{const n=e[0],i=null==n?void 0:n.value;t(i),b&&b()}),[t,b]),m=s.i18n.translate("xpack.aiops.changePointDetection.selectSpitFieldLabel",{defaultMessage:"Split field"});return Object(u.jsx)(l.EuiFormRow,{fullWidth:!0,label:n?void 0:m},Object(u.jsx)(l.EuiComboBox,{fullWidth:!0,compressed:!0,prepend:n?m:void 0,singleSelection:{asPlainText:!0},options:j,selectedOptions:g,onChange:f,isClearable:!0,"data-test-subj":"aiopsChangePointSplitField",renderOption:d}))}))}}]);