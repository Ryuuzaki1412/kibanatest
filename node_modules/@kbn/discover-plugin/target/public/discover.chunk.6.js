(window.discover_bundle_jsonpfunction=window.discover_bundle_jsonpfunction||[]).push([[6],{162:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(51),o=s(128),r=a.__importDefault(s(129));t.default=function(e,t){r.default(e,t,o.isDeepEqual)}},164:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(165);case"v8light":return s(167)}},165:function(e,t,s){var a=s(73),o=s(166);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},166:function(e,t,s){(t=s(74)(!1)).push([e.i,".dscDocsPage{height:calc(100vh - var(--kbnAppHeadersOffset, var(--euiFixedHeadersOffset, 0)) - 54px)}.dscDocsContent{display:flex;flex-direction:column;height:100%}.dscDocsGrid{flex:1 1 100%;overflow:auto}.dscDocsGrid__cell--highlight{background-color:#103148}",""]),e.exports=t},167:function(e,t,s){var a=s(73),o=s(168);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},168:function(e,t,s){(t=s(74)(!1)).push([e.i,".dscDocsPage{height:calc(100vh - var(--kbnAppHeadersOffset, var(--euiFixedHeadersOffset, 0)) - 54px)}.dscDocsContent{display:flex;flex-direction:column;height:100%}.dscDocsGrid{flex:1 1 100%;overflow:auto}.dscDocsGrid__cell--highlight{background-color:#e6f1fa}",""]),e.exports=t},189:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(190);case"v8light":return s(192)}},190:function(e,t,s){var a=s(73),o=s(191);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},191:function(e,t,s){(t=s(74)(!1)).push([e.i,".cxtSizePicker{text-align:center;width:80px}.cxtSizePicker::-webkit-inner-spin-button,.cxtSizePicker::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}",""]),e.exports=t},192:function(e,t,s){var a=s(73),o=s(193);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);a(o,{insert:"head",singleton:!1}),e.exports=o.locals||{}},193:function(e,t,s){(t=s(74)(!1)).push([e.i,".cxtSizePicker{text-align:center;width:80px}.cxtSizePicker::-webkit-inner-spin-button,.cxtSizePicker::-webkit-outer-spin-button{-webkit-appearance:none;appearance:none;margin:0}",""]),e.exports=t},310:function(e,t,s){"use strict";s.r(t),s.d(t,"renderApp",(function(){return He}));var a=s(6),o=s.n(a),r=s(3),n=s(93),c=s(11),i=s.n(c),l=s(23);const d={services:{}},u=Object(a.createContext)(d);var j=s(162),b=s.n(j),g=s(2);const p=({children:e,component:t,render:s,...r})=>{const n=Object(a.useMemo)((()=>{if(t)return e=>Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(m,null),Object(g.jsx)(t,e))}),[t]);if(n)return Object(g.jsx)(l.Route,i()({},r,{component:n}));if(s||"function"==typeof e){const t="function"==typeof e?e:s;return Object(g.jsx)(l.Route,i()({},r,{render:e=>Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(m,null),t(e))}))}return Object(g.jsx)(l.Route,r,Object(g.jsx)(m,null),e)},m=()=>{const{executionContext:e}=Object(a.useContext)(u).services,t=Object(l.useRouteMatch)();return function(e,t){b()((()=>(null==e||e.set(t),()=>{null==e||e.clear()})),[t])}(e,{type:"application",page:t.path,id:Object.keys(t.params).length>0?JSON.stringify(t.params):void 0}),null};var O=s(62);const f=({children:e,...t})=>Object(g.jsx)(l.Router,t,Object(g.jsx)(O.CompatRouter,null,e));var x=s(12);const h=({legacySwitch:e=!0,children:t})=>{const s=Object(l.useRouteMatch)();return e?Object(g.jsx)(l.Switch,null,t):Object(g.jsx)(O.Routes,null,a.Children.map(t,(e=>{if(o.a.isValidElement(e)&&e.type===p){var a;const r=Object(x.replace)(null==e?void 0:e.props.path,s.url+"/",""),n="function"==typeof(null==e?void 0:e.props.children)?null==e?void 0:e.props.children:null==e?void 0:e.props.render;return Object(g.jsx)(O.Route,{path:r,element:Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(m,null),(null==e||null===(a=e.props)||void 0===a?void 0:a.component)&&Object(g.jsx)(e.props.component,null)||n&&n()||t)})}return e})))};var S=s(20),v=s(47),w=s(44),C=(s(164),s(45)),E=s.n(C),y=s(46),D=s(94),F=s(32),M=s(137),I=s(114);let N,A;!function(e){e.FAILED="failed",e.LOADED="loaded",e.LOADING="loading",e.UNINITIALIZED="uninitialized"}(N||(N={})),function(e){e.UNKNOWN="unknown",e.INVALID_TIEBREAKER="invalid_tiebreaker"}(A||(A={}));const R=()=>({anchor:{},predecessors:[],successors:[],anchorStatus:{value:N.UNINITIALIZED},predecessorsStatus:{value:N.UNINITIALIZED},successorsStatus:{value:N.UNINITIALIZED},anchorInterceptedWarnings:void 0,predecessorsInterceptedWarnings:void 0,successorsInterceptedWarnings:void 0});function T({status:e}){return e.value!==N.FAILED?null:Object(g.jsx)(S.EuiCallOut,{title:Object(g.jsx)(w.FormattedMessage,{id:"discover.context.failedToLoadAnchorDocumentDescription",defaultMessage:"Failed to load the anchor document"}),color:"danger",iconType:"warning","data-test-subj":"contextErrorMessageTitle"},Object(g.jsx)(S.EuiText,{"data-test-subj":"contextErrorMessageBody"},e.reason===A.UNKNOWN&&Object(g.jsx)(w.FormattedMessage,{id:"discover.context.reloadPageDescription.reloadOrVisitTextMessage",defaultMessage:"Please reload or go back to the document list to select a valid anchor document."})))}var L=s(22),k=s(1),P=s(130),V=s(95);const _="_g",W="_a";function U(e,t){return!e&&!t||!(!e||!t)&&Object(L.compareFilters)(e,t,L.COMPARE_ALL_OPTIONS)}function z(e){return e&&Array.isArray(e.filters)?e.filters:[]}var B=s(4),q=s(56),$=s(316);let G;!function(e){e.asc="asc",e.desc="desc"}(G||(G={}));var Q=s(64),H=s.n(Q);function K(e,t){if(!e)return null;const s=H()(e).toISOString();return s?""!==t?`${s.substring(0,s.length-4)}${t}Z`:s:null}async function Z(e,t,s,a,o,r,n,c,i,l,d){var u;const j={format:"strict_date_optional_time"},[b,g]=o;b&&(j[a===y.SortDirection.asc?"gte":"lte"]=K(b,c)),g&&(j[a===y.SortDirection.asc?"lte":"gte"]=K(g,c));const p=new q.RequestAdapter,m=e.setField("size",n).setField("query",{query:{bool:{must:{constant_score:{filter:{range:{[t]:j}}}},must_not:{ids:{values:[i]}}}},language:"lucene"}).setField("searchAfter",r).setField("sort",s).setField("version",!0).fetch$({disableWarningToasts:!0,inspector:{adapter:p,title:l}}),{rawResponse:O}=await Object(B.lastValueFrom)(m),f=e.getField("index"),x=null===(u=O.hits)||void 0===u?void 0:u.hits.map((e=>Object($.a)(e,f))),h=[];return d.data.search.showWarnings(p,(e=>(h.push(e),!0))),{rows:null!=x?x:[],interceptedWarnings:h}}function J(e,t,s){var a,o;if(t.length){var r,n;const s=t[e===Y.SUCCESSORS&&t.length?t.length-1:0].raw;return[null===(r=s.sort)||void 0===r?void 0:r[0],null===(n=s.sort)||void 0===n?void 0:n[1]]}return[null===(a=s.raw.sort)||void 0===a?void 0:a[0],null===(o=s.raw.sort)||void 0===o?void 0:o[1]]}var X=s(107);let Y;!function(e){e.SUCCESSORS="successors",e.PREDECESSORS="predecessors"}(Y||(Y={}));const ee=[0,1,7,30,365,1e4].map((e=>864e5*e));var te=s(75);const se=(e,t,s)=>({[e]:{value:N.FAILED,error:s,reason:t}});var ae=s(101),oe=s(103),re=s(124),ne=s(127),ce=s(87);function ie({docCount:e,type:t}){return t===Y.PREDECESSORS?Object(g.jsx)(S.EuiCallOut,{color:"primary","data-test-subj":"predecessorsWarningMsg",iconType:"iInCircle",title:0===e?Object(g.jsx)(w.FormattedMessage,{id:"discover.context.newerDocumentsWarningZero",defaultMessage:"No documents newer than the anchor could be found."}):Object(g.jsx)(w.FormattedMessage,{id:"discover.context.newerDocumentsWarning",defaultMessage:"Only {docCount} documents newer than the anchor could be found.",values:{docCount:e}}),size:"s"}):Object(g.jsx)(S.EuiCallOut,{color:"primary","data-test-subj":"successorsWarningMsg",iconType:"iInCircle",title:0===e?Object(g.jsx)(w.FormattedMessage,{id:"discover.context.olderDocumentsWarningZero",defaultMessage:"No documents older than the anchor could be found."}):Object(g.jsx)(w.FormattedMessage,{id:"discover.context.olderDocumentsWarning",defaultMessage:"Only {docCount} documents older than the anchor could be found.",values:{docCount:e}}),size:"s"})}s(189);const le=1e4,de=0;function ue({defaultStepSize:e,docCount:t,docCountAvailable:s,isDisabled:o,isLoading:n,onChangeCount:c,type:i}){const l=!o&&!n&&s<t,d=i===Y.SUCCESSORS,[u,j]=Object(a.useState)(t),b=e>0||u!==t,p=e=>e>=de&&e<=le;return Object(a.useEffect)((()=>{u!==t&&0===u&&j(t)}),[t,u]),Object(g.jsx)("form",{onSubmit:e=>{e.preventDefault(),u!==t&&p(u)&&c(i,u)}},d&&Object(g.jsx)(S.EuiSpacer,{size:"s"}),d&&l&&Object(g.jsx)(ie,{docCount:s,type:i}),d&&l&&Object(g.jsx)(S.EuiSpacer,{size:"s"}),Object(g.jsx)(S.EuiFlexGroup,{direction:"row",gutterSize:"s",responsive:!1},Object(g.jsx)(S.EuiFlexItem,{grow:!1},Object(g.jsx)(S.EuiButtonEmpty,{"data-test-subj":`${i}LoadMoreButton`,isDisabled:o||!b,isLoading:n,onClick:()=>{const t=u+e;p(t)&&(j(t),c(i,t))},flush:"right"},Object(g.jsx)(w.FormattedMessage,{id:"discover.context.loadButtonLabel",defaultMessage:"Load"}))),Object(g.jsx)(S.EuiFlexItem,{grow:!1},Object(g.jsx)(S.EuiFormRow,{display:"center"},Object(g.jsx)(S.EuiFieldNumber,{"aria-label":d?r.i18n.translate("discover.context.olderDocumentsAriaLabel",{defaultMessage:"Number of older documents"}):r.i18n.translate("discover.context.newerDocumentsAriaLabel",{defaultMessage:"Number of newer documents"}),compressed:!0,className:"cxtSizePicker","data-test-subj":`${i}CountPicker`,disabled:o,min:de,max:le,onChange:e=>{j(e.target.valueAsNumber)},onBlur:()=>{u!==t&&p(u)&&c(i,u)},type:"number",value:u>=0?u:""}))),Object(g.jsx)(S.EuiFlexItem,null,Object(g.jsx)(S.EuiFormRow,{display:"center"},d?Object(g.jsx)(w.FormattedMessage,{id:"discover.context.olderDocumentsDescription",defaultMessage:"older documents"}):Object(g.jsx)(w.FormattedMessage,{id:"discover.context.newerDocumentsDescription",defaultMessage:"newer documents"})))),!d&&l&&Object(g.jsx)(S.EuiSpacer,{size:"s"}),!d&&l&&Object(g.jsx)(ie,{docCount:s,type:i}),Object(g.jsx)(S.EuiSpacer,{size:"s"}))}s(111);var je=s(157),be=s(125);const ge=o.a.memo(be.a),pe=e=>Object(g.jsx)(a.Fragment,null,Object(g.jsx)(je.a,{onClick:e.onSkipBottomButtonClick}),Object(g.jsx)("table",{className:"kbn-table table","data-test-subj":"docTable"},Object(g.jsx)("thead",null,e.renderHeader()),Object(g.jsx)("tbody",null,e.renderRows(e.rows))),Object(g.jsx)("span",{tabIndex:-1,id:"discoverBottomMarker"},"​")),me=e=>Object(g.jsx)(ge,i()({},e,{render:pe}));var Oe=s(112);const fe=["openDetails"],xe=o.a.memo(ne.a),he=o.a.memo(me),Se=o.a.memo(ue);function ve({columns:e,onAddColumn:t,onRemoveColumn:s,onSetColumns:r,dataView:n,predecessorCount:c,successorCount:i,rows:l,predecessors:d,successors:u,anchorStatus:j,predecessorsStatus:b,successorsStatus:p,interceptedWarnings:m,useNewFieldsApi:O,isLegacy:f,setAppState:x,addFilter:h}){const{uiSettings:v,uiActions:C}=Object(te.a)(),E=Object(te.a)(),[D,M]=Object(a.useState)(),I=j===N.LOADING||j===N.UNINITIALIZED,A=b===N.LOADING||b===N.UNINITIALIZED,R=p===N.LOADING||p===N.UNINITIALIZED,T=Object(a.useMemo)((()=>!v.get(F.e,!1)&&!!n.timeFieldName),[v,n]),L=Object(a.useMemo)((()=>parseInt(v.get(F.b),10)),[v]),k=Object(a.useCallback)(((e,t)=>{const s=e===Y.SUCCESSORS?"successorCount":"predecessorCount";var a;x({[s]:(a=t,Math.max(Math.min(le,a),de))})}),[x]),P=Object(a.useMemo)((()=>[[n.timeFieldName,y.SortDirection.desc]]),[n]),V=Object(a.useCallback)(((e,a,o)=>Object(g.jsx)(Oe.a,{dataView:n,hit:e,hits:a,columns:o,onFilter:h,onRemoveColumn:s,onAddColumn:t,onClose:()=>M(void 0),setExpandedDoc:M})),[h,n,t,s]);return Object(g.jsx)(a.Fragment,null,Object(g.jsx)(we,null,Boolean(m.length)&&Object(g.jsx)(o.a.Fragment,null,Object(g.jsx)(oe.b,{warnings:m}),Object(g.jsx)(S.EuiSpacer,{size:"s"})),Object(g.jsx)(Se,{type:Y.PREDECESSORS,defaultStepSize:L,docCount:c,docCountAvailable:d.length,onChangeCount:k,isLoading:A,isDisabled:I}),f&&I?Object(g.jsx)(S.EuiText,{textAlign:"center","data-test-subj":"contextApp_loadingIndicator"},Object(g.jsx)(w.FormattedMessage,{id:"discover.context.loadingDescription",defaultMessage:"Loading..."})):null),f&&l&&0!==l.length&&Object(g.jsx)(he,{columns:e,dataView:n,rows:l,isLoading:I,onFilter:h,onAddColumn:t,onRemoveColumn:s,sort:P,useNewFieldsApi:O,dataTestSubj:"contextDocTable"}),!f&&Object(g.jsx)("div",{className:"dscDocsGrid"},Object(g.jsx)(ae.a,{getTriggerCompatibleActions:C.getTriggerCompatibleActions},Object(g.jsx)(xe,{ariaLabelledBy:"surDocumentsAriaLabel",columns:e,rows:l,dataView:n,expandedDoc:D,loadingState:I?re.a.loading:re.a.loaded,sampleSizeState:0,sort:P,isSortEnabled:!1,showTimeCol:T,useNewFieldsApi:O,isPaginationEnabled:!1,rowsPerPageState:Object(ce.b)(E.uiSettings),controlColumnIds:fe,setExpandedDoc:M,onFilter:h,onSetColumns:r,configRowHeight:E.uiSettings.get(F.l),showMultiFields:E.uiSettings.get(F.s),maxDocFieldsDisplayed:E.uiSettings.get(F.j),renderDocumentView:V,services:E}))),Object(g.jsx)(we,null,Object(g.jsx)(Se,{type:Y.SUCCESSORS,defaultStepSize:L,docCount:i,docCountAvailable:u.length,onChangeCount:k,isLoading:R,isDisabled:I})))}const we=({children:e})=>{const t=Object(S.useEuiPaddingSize)("s");return Object(g.jsx)("div",{css:Object(g.css)("padding:0 ",t,";","")},e)};var Ce=s(97);const Ee=Object(a.memo)(ve),ye=({dataView:e,anchorId:t,referrer:s})=>{const o=Object(te.a)(),{analytics:c,locator:i,uiSettings:l,capabilities:d,dataViews:u,navigation:j,filterManager:b,core:p}=o,m=Object(a.useMemo)((()=>l.get(F.f)),[l]),O=Object(a.useMemo)((()=>!l.get(F.p)),[l]),{appState:f,globalState:h,stateContainer:C}=function({services:e,dataView:t}){const{uiSettings:s,history:o,core:r}=e,n=Object(a.useMemo)((()=>function({defaultSize:e,storeInSessionStorage:t=!1,history:s,toasts:a,uiSettings:o,data:r,dataView:n}){const c=Object(k.createKbnUrlStateStorage)({useHash:t,history:s,...a&&Object(k.withNotifyOnErrors)(a)}),i=function(e){const t={filters:[]};return"object"!=typeof e?t:{...t,...e}}(c.get(_)),l=Object(k.createStateContainer)(i),d=function(e,t,s){const a={columns:["_source"],filters:[],predecessorCount:e,successorCount:e};return"object"!=typeof t?a:Object(V.a)({...a,...t},s)}(e,c.get(W),o),u=Object(k.createStateContainer)(d),j=()=>[...z(l.getState()),...z(u.getState())],{start:b,stop:g}=Object(k.syncStates)([{storageKey:_,stateContainer:{...l,set:e=>{e&&l.set(e)}},stateStorage:c},{storageKey:W,stateContainer:{...u,set:e=>{e&&u.set(e)}},stateStorage:c}]);let p=()=>{};return{globalState:l,appState:u,startSync:()=>{r.query.filterManager.setFilters(Object(P.a)(n,j()));const e=Object(y.connectToQueryState)(r.query,u,{filters:L.FilterStateStore.APP_STATE}),t=Object(y.connectToQueryState)(r.query,l,{filters:L.FilterStateStore.GLOBAL_STATE});p=()=>{e(),t()},b()},stopSync:()=>{p(),p=()=>{},g()},setAppState:e=>{const t=u.getState(),s={...t,...e};(function(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const{filters:s=[],...a}=e,{filters:o=[],...r}=t;return Object(x.isEqual)(a,r)&&Object(L.compareFilters)(s,o,L.COMPARE_ALL_OPTIONS)})(t,s)||c.set(W,s,{replace:!0})},getFilters:j,setFilters:e=>{const t=e.getGlobalFilters();!U(t,z(l.getState()))&&l.set({filters:t});const s=e.getAppFilters();!U(s,z(u.getState()))&&u.set({...u.getState(),filters:s})},flushToUrl:e=>c.kbnUrlControls.flush(e)}}({defaultSize:parseInt(s.get(F.a),10),storeInSessionStorage:s.get("state:storeInSessionStorage"),history:o(),toasts:r.notifications.toasts,uiSettings:s,data:e.data,dataView:t})),[s,o,r.notifications.toasts,e.data,t]),[c,i]=Object(a.useState)(n.appState.getState()),[l,d]=Object(a.useState)(n.globalState.getState());return Object(a.useEffect)((()=>(n.startSync(),()=>n.stopSync())),[n]),Object(a.useEffect)((()=>{const e=n.appState.subscribe((e=>{var t;const s={...e,filters:null!==(t=e.filters)&&void 0!==t?t:[]};i((e=>({...e,...s})))})),t=n.globalState.subscribe((e=>{var t;const s={...e,filters:null!==(t=e.filters)&&void 0!==t?t:[]};d((e=>({...e,...s})))}));return()=>{e(),t()}}),[n,i]),{appState:c,globalState:l,stateContainer:n}}({services:o,dataView:e}),Q=Object(a.useRef)(),H=Object(a.useRef)({filters:[]}),{columns:K,onAddColumn:ae,onRemoveColumn:oe,onSetColumns:re}=Object(M.a)({capabilities:d,defaultOrder:l.get(F.t),dataView:e,dataViews:u,useNewFieldsApi:O,setAppState:C.setAppState,columns:f.columns,sort:f.sort});Object(a.useEffect)((()=>{Object(Ce.a)({services:o,rootBreadcrumbPath:s,titleBreadcrumbText:r.i18n.translate("discover.context.breadcrumb",{defaultMessage:"Surrounding documents"})})}),[i,s,o]),Object(v.useExecutionContext)(p.executionContext,{type:"application",page:"context",id:e.id||""});const{fetchedState:ne,fetchContextRows:ce,fetchAllRows:ie,fetchSurroundingRows:le,resetFetchedState:de}=function({anchorId:e,dataView:t,appState:s,useNewFieldsApi:o}){const c=Object(te.a)(),{uiSettings:i,data:l,toastNotifications:d,filterManager:u}=c,j=Object(a.useMemo)((()=>l.search.searchSource.createEmpty()),[l.search.searchSource]),b=Object(a.useMemo)((()=>Object(X.e)(t,i)),[i,t]),[p,m]=Object(a.useState)(R()),O=Object(a.useCallback)((e=>{m((t=>({...t,...e})))}),[]),f=Object(a.useCallback)((async()=>{const s=r.i18n.translate("discover.context.unableToLoadAnchorDocumentDescription",{defaultMessage:"Unable to load the anchor document"});if(!b)return O(se("anchorStatus",A.INVALID_TIEBREAKER)),void d.addDanger({title:s,text:r.i18n.translate("discover.context.invalidTieBreakerFiledSetting",{defaultMessage:"Invalid tie breaker field setting"})});try{O({anchorStatus:{value:N.LOADING}});const s=Object(X.d)({sortDir:y.SortDirection.desc,timeFieldName:t.timeFieldName,tieBreakerFieldName:b,isTimeNanosBased:t.isTimeNanosBased()}),a=await async function(e,t,s,a,o=!1,n){var c,i;!function(e,t,s,a,o){e.setParent(void 0).setField("index",o).setField("version",!0).setField("size",1).setField("query",{query:{constant_score:{filter:{ids:{values:[t]}}}},language:"lucene"}).setField("sort",s).setField("trackTotalHits",!1),a&&(e.removeField("fieldsFromSource"),e.setField("fields",[{field:"*",include_unmapped:"true"}]))}(s,e,a,o,t);const l=new q.RequestAdapter,{rawResponse:d}=await Object(B.lastValueFrom)(s.fetch$({disableWarningToasts:!0,inspector:{adapter:l,title:"anchor"}})),u=null===(c=d.hits)||void 0===c||null===(i=c.hits)||void 0===i?void 0:i[0];if(!u)throw new Error(r.i18n.translate("discover.context.failedToLoadAnchorDocumentErrorDescription",{defaultMessage:"Failed to load anchor document."}));const j=[];return n.data.search.showWarnings(l,(e=>(j.push(e),!0))),{anchorRow:Object($.a)(u,t,!0),interceptedWarnings:j}}(e,t,j,s,o,c);return O({anchor:a.anchorRow,anchorInterceptedWarnings:a.interceptedWarnings,anchorStatus:{value:N.LOADED}}),a.anchorRow}catch(e){O(se("anchorStatus",A.UNKNOWN,e)),d.addDanger({title:s,text:Object(n.a)(Object(g.jsx)(v.MarkdownSimple,null,e.message),{theme:c.core.theme,i18n:c.core.i18n})})}}),[c,b,O,d,t,e,j,o]),x=Object(a.useCallback)((async(e,a)=>{const i=u.getFilters(),j=e===Y.PREDECESSORS?s.predecessorCount:s.successorCount,m=a||p.anchor,f=`${e}Status`,x=`${e}InterceptedWarnings`,h=r.i18n.translate("discover.context.unableToLoadDocumentDescription",{defaultMessage:"Unable to load documents"});try{O({[f]:{value:N.LOADING}});const s=m.id?await async function(e,t,s,a,o,r,n,c,i,l){var d,u,j;if("object"!=typeof s||null===s||!r)return{rows:[],interceptedWarnings:void 0};const b=t.timeFieldName,g=c.search.searchSource.createEmpty();!function(e,t,s,a){a&&(e.removeField("fieldsFromSource"),e.setField("fields",[{field:"*",include_unmapped:"true"}])),e.setParent(void 0).setField("index",t).setField("filter",s).setField("trackTotalHits",!1)}(g,t,n,Boolean(i));const p=e===Y.SUCCESSORS?o:o===G.asc?G.desc:G.asc,m=s.raw,O=t.isTimeNanosBased()?function(e=""){const t=e.split("."),s=2===t.length?t[1].replace("Z",""):"";return 9!==s.length?s.padEnd(9,"0"):s}(null===(d=m.fields)||void 0===d?void 0:d[b][0]):"",f=""!==O?(x=null===(u=m.fields)||void 0===u?void 0:u[b][0],new Date(x).getTime()):null===(j=m.sort)||void 0===j?void 0:j[0];var x;const h=function(e,t,s,a){const o=a===y.SortDirection.asc&&s===Y.SUCCESSORS||a===y.SortDirection.desc&&s===Y.PREDECESSORS?1:-1;return function*(e){let t=[];for(const s of e)t=[...t,s].slice(-2),2===t.length&&(yield t)}([...e.map((e=>t+e*o)),null])}(ee,f,e,o);let S=[],v=[];for(const o of h){const n=r-S.length;if(n<=0)break;const c=J(e,S,s),i=Object(X.d)({timeFieldName:b,tieBreakerFieldName:a,sortDir:p,isTimeNanosBased:t.isTimeNanosBased()}),d=await Z(g,b,i,p,o,c,n,O,s.raw._id,e,l);S=e===Y.SUCCESSORS?[...S,...d.rows]:[...d.rows.slice().reverse(),...S],d.interceptedWarnings&&(v=e===Y.SUCCESSORS?[...v,...d.interceptedWarnings]:[...d.interceptedWarnings.slice().reverse(),...v])}return{rows:S,interceptedWarnings:v}}(e,t,m,b,y.SortDirection.desc,j,i,l,o,c):{rows:[],interceptedWarnings:void 0};O({[e]:s.rows,[x]:s.interceptedWarnings,[f]:{value:N.LOADED}})}catch(e){O(se(f,A.UNKNOWN,e)),d.addDanger({title:h,text:Object(n.a)(Object(g.jsx)(v.MarkdownSimple,null,e.message),{theme:c.core.theme,i18n:c.core.i18n})})}}),[c,u,s,p.anchor,b,O,t,d,o,l]),h=Object(a.useCallback)((e=>Promise.allSettled([x(Y.PREDECESSORS,e),x(Y.SUCCESSORS,e)])),[x]),S=Object(a.useCallback)((()=>{f().then((e=>e&&h(e)))}),[f,h]),w=Object(a.useCallback)((()=>{m(R())}),[]);return{fetchedState:p,fetchAllRows:S,fetchContextRows:h,fetchSurroundingRows:x,resetFetchedState:w}}({anchorId:t,dataView:e,appState:f,useNewFieldsApi:O});Object(a.useEffect)((()=>{Q.current&&(Q.current=void 0,de())}),[t,de]),Object(a.useEffect)((()=>{(async()=>{const e=window.performance.now();let t="";if(Q.current?Q.current.predecessorCount!==f.predecessorCount?(t="predecessors",await le(Y.PREDECESSORS)):Q.current.successorCount!==f.successorCount?(t="successors",await le(Y.SUCCESSORS)):U(Q.current.filters,f.filters)&&U(H.current.filters,h.filters)||(t="context",await ce()):(t="all",await ie()),c){const s=window.performance.now()-e;Object(D.a)(c,{eventName:"discoverSurroundingDocsFetch",duration:s,meta:{fetchType:t}})}})(),Q.current=Object(x.cloneDeep)(f),H.current=Object(x.cloneDeep)(h)}),[c,f,h,t,ce,ie,le,ne.anchor.id]);const ue=Object(a.useMemo)((()=>[...ne.predecessors||[],...ne.anchor.id?[ne.anchor]:[],...ne.successors||[]]),[ne.predecessors,ne.anchor,ne.successors]),je=Object(a.useMemo)((()=>[...ne.predecessorsInterceptedWarnings||[],...ne.anchorInterceptedWarnings||[],...ne.successorsInterceptedWarnings||[]]),[ne.predecessorsInterceptedWarnings,ne.anchorInterceptedWarnings,ne.successorsInterceptedWarnings]),be=Object(a.useCallback)((async(t,s,a)=>{const o=Object(y.generateFilters)(b,t,s,a,e);if(b.addFilters(o),u){const s="string"==typeof t?t:t.name;await Object(I.a)(e,s,u,d)}}),[b,u,e,d]),ge=j.ui.AggregateQueryTopNavMenu,pe=Object(S.useEuiPaddingSize)("m");return Object(g.jsx)(a.Fragment,null,ne.anchorStatus.value===N.FAILED?Object(g.jsx)(T,{status:ne.anchorStatus}):Object(g.jsx)(a.Fragment,null,Object(g.jsx)("h1",{id:"contextAppTitle",className:"euiScreenReaderOnly","data-test-subj":"discoverContextAppTitle"},r.i18n.translate("discover.context.pageTitle",{defaultMessage:"Documents surrounding #{anchorId}",values:{anchorId:t}})),Object(g.jsx)(ge,{appName:"context",showSearchBar:!0,showQueryInput:!1,showFilterBar:!0,saveQueryMenuVisibility:"hidden",showDatePicker:!1,indexPatterns:[e],useDefaultBehaviors:!0}),Object(g.jsx)(S.EuiPage,{className:E()({dscDocsPage:!m})},Object(g.jsx)(S.EuiPageBody,{panelled:!0,paddingSize:"none",className:"dscDocsContent",panelProps:{role:"main"}},Object(g.jsx)(S.EuiText,{"data-test-subj":"contextDocumentSurroundingHeader",css:Object(g.css)("padding:",pe," ",pe," 0;","")},Object(g.jsx)("strong",null,Object(g.jsx)(w.FormattedMessage,{id:"discover.context.contextOfTitle",defaultMessage:"Documents surrounding #{anchorId}",values:{anchorId:t}}))),Object(g.jsx)(S.EuiSpacer,{size:"s"}),Object(g.jsx)(Ee,{dataView:e,useNewFieldsApi:O,isLegacy:m,columns:K,onAddColumn:ae,onRemoveColumn:oe,onSetColumns:re,predecessorCount:f.predecessorCount,successorCount:f.successorCount,setAppState:C.setAppState,addFilter:be,rows:ue,predecessors:ne.predecessors,successors:ne.successors,anchorStatus:ne.anchorStatus.value,predecessorsStatus:ne.predecessorsStatus.value,successorsStatus:ne.successorsStatus.value,interceptedWarnings:je})))))};var De=s(98),Fe=s(5);const Me=({index:e})=>{const{dataViews:t}=Object(te.a)(),[s,o]=Object(a.useState)(),[r,n]=Object(a.useState)();return Object(a.useEffect)((()=>{("object"==typeof e?t.create(e):t.get(e)).then(o).catch(n)}),[t,e]),{dataView:s,error:r}};function Ie(){const e=Object(a.useMemo)((()=>Object(Fe.c)().location.state),[]);Object(a.useEffect)((()=>{const t=Object(Fe.c)(),s=t.listen((s=>{const a=s.state;if((null==a||!a.referrer)&&e){const o={...s,state:{...a,...e}};t.replace(o)}}));return()=>s()}),[e]);const{dataViewId:t,id:s}=Object(l.useParams)(),o=decodeURIComponent(t),r=decodeURIComponent(s),{dataView:n,error:c}=Me({index:(null==e?void 0:e.dataViewSpec)||o});return c?Object(g.jsx)(S.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger",title:Object(g.jsx)(w.FormattedMessage,{id:"discover.contextViewRoute.errorTitle",defaultMessage:"An error occurred"}),body:Object(g.jsx)(w.FormattedMessage,{id:"discover.contextViewRoute.errorMessage",defaultMessage:"No matching data view for id {dataViewId}",values:{dataViewId:o}})}):n?Object(g.jsx)(ye,{anchorId:r,dataView:n,referrer:null==e?void 0:e.referrer}):Object(g.jsx)(De.a,null)}let Ne;s(0),function(e){e[e.Loading=0]="Loading",e[e.NotFound=1]="NotFound",e[e.Found=2]="Found",e[e.Error=3]="Error",e[e.NotFoundDataView=4]="NotFoundDataView"}(Ne||(Ne={}));var Ae=s(59);function Re(e){const{dataView:t}=e,[s,o]=Object(Ae.useEsDocSearch)(e),n=Object(te.a)(),{locator:c,chrome:i,docLinks:l}=n,d=l.links.apis.indexExists;return Object(a.useEffect)((()=>{Object(Ce.a)({services:n,titleBreadcrumbText:`${e.index}#${e.id}`,rootBreadcrumbPath:e.referrer})}),[i,e.referrer,e.index,e.id,t,c,n]),Object(g.jsx)(S.EuiPage,null,Object(g.jsx)("h1",{id:"singleDocTitle",className:"euiScreenReaderOnly","data-test-subj":"discoverSingleDocTitle"},r.i18n.translate("discover.doc.pageTitle",{defaultMessage:"Single document - #{id}",values:{id:e.id}})),Object(g.jsx)(S.EuiPageBody,{panelled:!0,paddingSize:"m",panelProps:{role:"main"}},s===Ne.NotFoundDataView&&Object(g.jsx)(S.EuiCallOut,{color:"danger","data-test-subj":"doc-msg-notFoundDataView",iconType:"warning",title:Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.failedToLocateDataView",defaultMessage:"No data view matches ID {dataViewId}.",values:{dataViewId:t.id}})}),s===Ne.NotFound&&Object(g.jsx)(S.EuiCallOut,{color:"danger","data-test-subj":"doc-msg-notFound",iconType:"warning",title:Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.failedToLocateDocumentDescription",defaultMessage:"Cannot find document"})},Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.couldNotFindDocumentsDescription",defaultMessage:"No documents match that ID."})),s===Ne.Error&&Object(g.jsx)(S.EuiCallOut,{color:"danger","data-test-subj":"doc-msg-error",iconType:"warning",title:Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.failedToExecuteQueryDescription",defaultMessage:"Cannot run search"})},Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.somethingWentWrongDescription",defaultMessage:"{indexName} is missing.",values:{indexName:e.index}})," ",Object(g.jsx)(S.EuiLink,{href:d,target:"_blank"},Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.somethingWentWrongDescriptionAddon",defaultMessage:"Please ensure the index exists."}))),s===Ne.Loading&&Object(g.jsx)(S.EuiCallOut,{"data-test-subj":"doc-msg-loading"},Object(g.jsx)(S.EuiLoadingSpinner,{size:"m"})," ",Object(g.jsx)(w.FormattedMessage,{id:"discover.doc.loadingDescription",defaultMessage:"Loading…"})),s===Ne.Found&&null!==o&&t&&Object(g.jsx)("div",{"data-test-subj":"doc-hit"},Object(g.jsx)(Ae.UnifiedDocViewer,{hit:o,dataView:t,hideActionsColumn:!0}))))}var Te=s(138);const Le=()=>{const{timefilter:e,core:t}=Object(te.a)(),{search:s}=Object(l.useLocation)(),{dataViewId:o,index:n}=Object(l.useParams)(),c=Object(a.useMemo)((()=>new URLSearchParams(s)),[s]).get("id"),i=Object(a.useMemo)((()=>Object(Fe.c)().location.state),[]);Object(v.useExecutionContext)(t.executionContext,{type:"application",page:"single-doc",id:o}),Object(a.useEffect)((()=>{e.disableAutoRefreshSelector(),e.disableTimeRangeSelector()}),[e]);const{dataView:d,error:u}=Me({index:(null==i?void 0:i.dataViewSpec)||decodeURIComponent(o)});return u?Object(g.jsx)(S.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger",title:Object(g.jsx)(w.FormattedMessage,{id:"discover.singleDocRoute.errorTitle",defaultMessage:"An error occurred"}),body:Object(g.jsx)(w.FormattedMessage,{id:"discover.singleDocRoute.errorMessage",defaultMessage:"No matching data view for id {dataViewId}",values:{dataViewId:o}})}):d?c?Object(g.jsx)(Re,{id:c,index:n,dataView:d,referrer:null==i?void 0:i.referrer}):Object(g.jsx)(Te.a,{error:new Error(r.i18n.translate("discover.discoverError.missingIdParamError",{defaultMessage:"No document ID provided. Return to Discover to select another document."}))}):Object(g.jsx)(De.a,null)};var ke=s(154);let Pe;function Ve(){const e=Object(te.a)(),{urlForwarding:t,core:s,history:o}=e,c=o().location.pathname;return Object(a.useEffect)((()=>{const e=window.location.hash.substr(1);Object(Fe.e)().restorePreviousUrl(),t.navigateToLegacyKibanaUrl(e);const a=r.i18n.translate("discover.noMatchRoute.bannerTitleText",{defaultMessage:"Page not found"});Pe=s.overlays.banners.replace(Pe,Object(n.a)(Object(g.jsx)(S.EuiCallOut,{color:"warning",iconType:"iInCircle",title:a},Object(g.jsx)("p",{"data-test-subj":"invalidRouteMessage"},Object(g.jsx)(w.FormattedMessage,{id:"discover.noMatchRoute.bannerText",defaultMessage:"Discover application doesn't recognize this route: {route}",values:{route:o().location.state.referrer}}))),{theme:s.theme,i18n:s.i18n})),setTimeout((()=>{Pe&&s.overlays.banners.remove(Pe)}),15e3)}),[s,o,t]),Object(g.jsx)(l.Redirect,{to:{pathname:"/",state:{referrer:c}}})}var _e=s(149),We=s(57);const Ue=(e,t,s,a,o,c)=>({fetchAlert:async e=>{try{return await a.http.get(`/api/alerts/alert/${e}`)}catch(e){const t=r.i18n.translate("discover.viewAlert.alertRuleFetchErrorTitle",{defaultMessage:"Error fetching alert rule"});throw s.addDanger({title:t,text:Object(n.a)(Object(g.jsx)(v.MarkdownSimple,null,e.message),{theme:a.theme,i18n:a.i18n})}),new Error(t)}},fetchSearchSource:async e=>{try{return{alert:e,searchSource:await o.search.searchSource.create(e.params.searchConfiguration)}}catch(e){const t=r.i18n.translate("discover.viewAlert.searchSourceErrorTitle",{defaultMessage:"Error fetching search source"});throw s.addDanger({title:t,text:Object(n.a)(Object(g.jsx)(v.MarkdownSimple,null,e.message),{theme:a.theme,i18n:a.i18n})}),new Error(t)}},buildLocatorParams:async({alert:a,searchSource:n})=>{var i;let l=n.getField("index"),d=n.getField("query")||o.query.queryString.getDefaultQuery();if(a.params&&"esqlQuery"in a.params&&a.params.esqlQuery&&"esql"in a.params.esqlQuery){d=a.params.esqlQuery;const e=Object(L.getIndexPatternFromESQLQuery)(a.params.esqlQuery.esql);l=await c.create({title:e,timeFieldName:a.params.timeField})}const u=null===(i=l)||void 0===i?void 0:i.timeFieldName;if(!l||!u)throw(e=>{const t=r.i18n.translate("discover.viewAlert.dataViewErrorTitle",{defaultMessage:"Error fetching data view"}),a=r.i18n.translate("discover.viewAlert.dataViewErrorText",{defaultMessage:"Data view failure of the alert rule with id {alertId}.",values:{alertId:e}});s.addDanger({title:t,text:a})})(a.id),new Error("Data view fetch error");const j=e?{from:t.from,to:t.to}:((e,t,s)=>{const a=Object(We.getTime)(e,{from:`now-${t.params.timeWindowSize}${t.params.timeWindowUnit}`,to:"now"});return{from:null==a?void 0:a.query.range[s].gte,to:null==a?void 0:a.query.range[s].lte}})(l,a,u);return{query:d,dataViewSpec:l.toSpec(!1),timeRange:j,filters:n.getField("filter")}}}),ze=e=>Boolean(e.from&&e.to);function Be(){const{core:e,data:t,locator:s,toastNotifications:o,dataViews:r}=Object(te.a)(),{id:n}=Object(l.useParams)(),c=Object(l.useHistory)(),{search:i}=Object(l.useLocation)(),d=Object(a.useMemo)((()=>new URLSearchParams(i)),[i]),u=Object(a.useMemo)((()=>({from:d.get("from"),to:d.get("to")})),[d]),j=Object(a.useMemo)((()=>ze(u)),[u]);return Object(a.useEffect)((()=>{const{fetchAlert:a,fetchSearchSource:c,buildLocatorParams:i}=Ue(j,u,o,e,t,r);a(n).then(c).then(i).then((e=>{j&&Object(_e.a)(o),s.navigate(e)})).catch((()=>s.navigate({})))}),[e,t,r,c,n,s,j,u,o]),null}var qe=s(8);const $e=({prefix:e,...t})=>{const s=Object(a.useCallback)((t=>e?`${e}/${t}`:`/${t}`),[e]);return Object(g.jsx)(h,null,Object(g.jsx)(p,{path:s("context/:dataViewId/:id")},Object(g.jsx)(Ie,null)),Object(g.jsx)(p,{path:s("doc/:dataView/:index/:type"),render:e=>Object(g.jsx)(l.Redirect,{to:s(`doc/${e.match.params.dataView}/${e.match.params.index}`)})}),Object(g.jsx)(p,{path:s("doc/:dataViewId/:index")},Object(g.jsx)(Le,null)),Object(g.jsx)(p,{path:s("viewAlert/:id")},Object(g.jsx)(Be,null)),Object(g.jsx)(p,{path:s("view/:id")},Object(g.jsx)(ke.a,t)),Object(g.jsx)(p,{path:s(""),exact:!0},Object(g.jsx)(ke.a,t)),Object(g.jsx)(Ve,null))},Ge=({profileRegistry:e,...t})=>{const{profile:s}=Object(l.useParams)(),o=Object(a.useMemo)((()=>{var t;return null===(t=e.get(s))||void 0===t?void 0:t.customizationCallbacks}),[s,e]);return o?Object(g.jsx)($e,i()({prefix:Object(qe.a)("",s),customizationCallbacks:o},t)):Object(g.jsx)(Ve,null)},Qe=({services:e,history:t,profileRegistry:s,...o})=>{const r=Object(a.useMemo)((()=>{var e,t;return null!==(e=null===(t=s.get("default"))||void 0===t?void 0:t.customizationCallbacks)&&void 0!==e?e:[]}),[s]);return Object(g.jsx)(v.KibanaContextProvider,{services:e},Object(g.jsx)(S.EuiErrorBoundary,null,Object(g.jsx)(f,{history:t,"data-test-subj":"discover-react-router"},Object(g.jsx)(h,null,Object(g.jsx)(p,{path:Object(qe.a)("",":profile")},Object(g.jsx)(Ge,i()({profileRegistry:s},o))),Object(g.jsx)(p,{path:"/"},Object(g.jsx)($e,i()({customizationCallbacks:r},o)))))))},He=({element:e,services:t,profileRegistry:s,isDev:a})=>{const{history:o,capabilities:c,chrome:i,data:l,core:d}=t,u=o();c.discover.save||i.setBadge({text:r.i18n.translate("discover.badge.readOnly.text",{defaultMessage:"Read only"}),tooltip:r.i18n.translate("discover.badge.readOnly.tooltip",{defaultMessage:"Unable to save searches"}),iconType:"glasses"});const j=Object(n.a)(Object(g.jsx)(Qe,{services:t,profileRegistry:s,history:u,isDev:a}),{theme:d.theme,i18n:d.i18n})(e);return()=>{j(),l.search.session.clear()}}}}]);