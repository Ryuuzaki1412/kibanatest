/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.fleet_bundle_jsonpfunction=window.fleet_bundle_jsonpfunction||[]).push([[3],{249:function(e,t,a){"use strict";t.decode=t.parse=a(477),t.encode=t.stringify=a(478)},474:function(e,t,a){"use strict";var l=a(475),n=a(476);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){return n.isString(e)&&(e=y(e)),e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var s=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(c),d=["%","/","?",";","#"].concat(u),g=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,E={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},h=a(249);function y(e,t,a){if(e&&n.isObject(e)&&e instanceof i)return e;var l=new i;return l.parse(e,t,a),l}i.prototype.parse=function(e,t,a){if(!n.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(r);c[0]=c[0].replace(/\\/g,"/");var y=e=c.join(r);if(y=y.trim(),!a&&1===e.split("#").length){var k=o.exec(y);if(k)return this.path=y,this.href=y,this.pathname=k[1],k[2]?(this.search=k[2],this.query=t?h.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var v=s.exec(y);if(v){var x=(v=v[0]).toLowerCase();this.protocol=x,y=y.substr(v.length)}if(a||v||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var F="//"===y.substr(0,2);!F||v&&f[v]||(y=y.substr(2),this.slashes=!0)}if(!f[v]&&(F||v&&!b[v])){for(var M,S,I=-1,T=0;T<g.length;T++)-1!==(O=y.indexOf(g[T]))&&(-1===I||O<I)&&(I=O);for(-1!==(S=-1===I?y.lastIndexOf("@"):y.lastIndexOf("@",I))&&(M=y.slice(0,S),y=y.slice(S+1),this.auth=decodeURIComponent(M)),I=-1,T=0;T<d.length;T++){var O;-1!==(O=y.indexOf(d[T]))&&(-1===I||O<I)&&(I=O)}-1===I&&(I=y.length),this.host=y.slice(0,I),y=y.slice(I),this.parseHost(),this.hostname=this.hostname||"";var w="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!w)for(var j=this.hostname.split(/\./),C=(T=0,j.length);T<C;T++){var P=j[T];if(P&&!P.match(m)){for(var A="",L=0,_=P.length;L<_;L++)P.charCodeAt(L)>127?A+="x":A+=P[L];if(!A.match(m)){var D=j.slice(0,T),B=j.slice(T+1),R=P.match(p);R&&(D.push(R[1]),B.unshift(R[2])),B.length&&(y="/"+B.join(".")+y),this.hostname=D.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),w||(this.hostname=l.toASCII(this.hostname));var z=this.port?":"+this.port:"",N=this.hostname||"";this.host=N+z,this.href+=this.host,w&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!E[x])for(T=0,C=u.length;T<C;T++){var U=u[T];if(-1!==y.indexOf(U)){var H=encodeURIComponent(U);H===U&&(H=escape(U)),y=y.split(U).join(H)}}var q=y.indexOf("#");-1!==q&&(this.hash=y.substr(q),y=y.slice(0,q));var G=y.indexOf("?");if(-1!==G?(this.search=y.substr(G),this.query=y.substr(G+1),t&&(this.query=h.parse(this.query)),y=y.slice(0,G)):t&&(this.search="",this.query={}),y&&(this.pathname=y),b[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){z=this.pathname||"";var W=this.search||"";this.path=z+W}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",a=this.pathname||"",l=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(s=h.stringify(this.query));var r=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&!1!==i?(i="//"+(i||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):i||(i=""),l&&"#"!==l.charAt(0)&&(l="#"+l),r&&"?"!==r.charAt(0)&&(r="?"+r),t+i+(a=a.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(r=r.replace("#","%23"))+l},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(n.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var a=new i,l=Object.keys(this),s=0;s<l.length;s++){var r=l[s];a[r]=this[r]}if(a.hash=e.hash,""===e.href)return a.href=a.format(),a;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),c=0;c<o.length;c++){var u=o[c];"protocol"!==u&&(a[u]=e[u])}return b[a.protocol]&&a.hostname&&!a.pathname&&(a.path=a.pathname="/"),a.href=a.format(),a}if(e.protocol&&e.protocol!==a.protocol){if(!b[e.protocol]){for(var d=Object.keys(e),g=0;g<d.length;g++){var m=d[g];a[m]=e[m]}return a.href=a.format(),a}if(a.protocol=e.protocol,e.host||f[e.protocol])a.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),a.pathname=p.join("/")}if(a.search=e.search,a.query=e.query,a.host=e.host||"",a.auth=e.auth,a.hostname=e.hostname||e.host,a.port=e.port,a.pathname||a.search){var E=a.pathname||"",h=a.search||"";a.path=E+h}return a.slashes=a.slashes||e.slashes,a.href=a.format(),a}var y=a.pathname&&"/"===a.pathname.charAt(0),k=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=k||y||a.host&&e.pathname,x=v,F=a.pathname&&a.pathname.split("/")||[],M=(p=e.pathname&&e.pathname.split("/")||[],a.protocol&&!b[a.protocol]);if(M&&(a.hostname="",a.port=null,a.host&&(""===F[0]?F[0]=a.host:F.unshift(a.host)),a.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),v=v&&(""===p[0]||""===F[0])),k)a.host=e.host||""===e.host?e.host:a.host,a.hostname=e.hostname||""===e.hostname?e.hostname:a.hostname,a.search=e.search,a.query=e.query,F=p;else if(p.length)F||(F=[]),F.pop(),F=F.concat(p),a.search=e.search,a.query=e.query;else if(!n.isNullOrUndefined(e.search))return M&&(a.hostname=a.host=F.shift(),(w=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=w.shift(),a.host=a.hostname=w.shift())),a.search=e.search,a.query=e.query,n.isNull(a.pathname)&&n.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.href=a.format(),a;if(!F.length)return a.pathname=null,a.search?a.path="/"+a.search:a.path=null,a.href=a.format(),a;for(var S=F.slice(-1)[0],I=(a.host||e.host||F.length>1)&&("."===S||".."===S)||""===S,T=0,O=F.length;O>=0;O--)"."===(S=F[O])?F.splice(O,1):".."===S?(F.splice(O,1),T++):T&&(F.splice(O,1),T--);if(!v&&!x)for(;T--;T)F.unshift("..");!v||""===F[0]||F[0]&&"/"===F[0].charAt(0)||F.unshift(""),I&&"/"!==F.join("/").substr(-1)&&F.push("");var w,j=""===F[0]||F[0]&&"/"===F[0].charAt(0);return M&&(a.hostname=a.host=j?"":F.length?F.shift():"",(w=!!(a.host&&a.host.indexOf("@")>0)&&a.host.split("@"))&&(a.auth=w.shift(),a.host=a.hostname=w.shift())),(v=v||a.host&&F.length)&&!j&&F.unshift(""),F.length?a.pathname=F.join("/"):(a.pathname=null,a.path=null),n.isNull(a.pathname)&&n.isNull(a.search)||(a.path=(a.pathname?a.pathname:"")+(a.search?a.search:"")),a.auth=e.auth||a.auth,a.slashes=a.slashes||e.slashes,a.href=a.format(),a},i.prototype.parseHost=function(){var e=this.host,t=r.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},475:function(e,t,a){e.exports=a(36)(2971)},476:function(e,t,a){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},477:function(e,t,a){"use strict";function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,a,i){t=t||"&",a=a||"=";var s={};if("string"!=typeof e||0===e.length)return s;var r=/\+/g;e=e.split(t);var o=1e3;i&&"number"==typeof i.maxKeys&&(o=i.maxKeys);var c=e.length;o>0&&c>o&&(c=o);for(var u=0;u<c;++u){var d,g,m,p,E=e[u].replace(r,"%20"),f=E.indexOf(a);f>=0?(d=E.substr(0,f),g=E.substr(f+1)):(d=E,g=""),m=decodeURIComponent(d),p=decodeURIComponent(g),l(s,m)?n(s[m])?s[m].push(p):s[m]=[s[m],p]:s[m]=p}return s};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},478:function(e,t,a){"use strict";var l=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,a,r){return t=t||"&",a=a||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),(function(s){var r=encodeURIComponent(l(s))+a;return n(e[s])?i(e[s],(function(e){return r+encodeURIComponent(l(e))})).join(t):r+encodeURIComponent(l(e[s]))})).join(t):r?encodeURIComponent(l(r))+a+encodeURIComponent(l(e)):""};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var a=[],l=0;l<e.length;l++)a.push(t(e[l],l));return a}var s=Object.keys||function(e){var t=[];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.push(a);return t}},479:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a(49),n=a(1),i=l.__importDefault(a(79)),s=a(193),r={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};t.default=s.isClient&&window.ResizeObserver?function(){var e=n.useState(null),t=e[0],a=e[1],l=n.useState(r),s=l[0],o=l[1],c=n.useMemo((function(){return new window.ResizeObserver((function(e){if(e[0]){var t=e[0].contentRect,a=t.x,l=t.y,n=t.width,i=t.height,s=t.top,r=t.left,c=t.bottom,u=t.right;o({x:a,y:l,width:n,height:i,top:s,left:r,bottom:c,right:u})}}))}),[]);return i.default((function(){if(t)return c.observe(t),function(){c.disconnect()}}),[t]),[a,s]}:function(){return[function(){},r]}},480:function(e,t,a){e.exports=a(36)(1919)},483:function(e,t,a){"use strict";a.r(t),a.d(t,"ProtectedRoute",(function(){return ar})),a.d(t,"renderApp",(function(){return nr})),a.d(t,"teardownFleet",(function(){return ir}));var l=a(1),n=a.n(l),i=a(91),s=a.n(i),r=a(20),o=a(118),c=a(15),u=a(6),d=a(10),g=a(4),m=a(54),p=a.n(m),E=a(40),f=a.n(E),b=a(7),h=a(92),y=a(37),k=a(57),v=a(93),x=a(106),F=a(105),M=a(13),S=a(119),I=a(123),T=a(129),O=a(18),w=a.n(O),j=a(158),C=a(55),P=a(30);const A=p()(u.EuiFlyout).withConfig({displayName:"FlyoutWithHigherZIndex",componentId:"sc-1pwanx7-0"})(["z-index:",";"],(e=>e.theme.eui.euiZLevel5)),L=({onClose:e,as:t,...a})=>{const{notifications:i}=Object(c.lc)(),s=Object(c.vb)().fleet.all,[r,o]=Object(l.useState)(Object(P.b)()),[m,p]=Object(l.useState)(!1),[E,f]=Object(l.useState)(!0),b=Object(T.h)(r),h=n.a.createElement(u.EuiFlyoutHeader,{hasBorder:!0,"aria-labelledby":"CreateAgentPolicyFlyoutTitle"},n.a.createElement(u.EuiTitle,{size:"m"},n.a.createElement("h2",{id:"CreateAgentPolicyFlyoutTitle","data-test-subj":"createAgentPolicyFlyoutTitle"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitle",defaultMessage:"Create agent policy"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiText,{size:"s"},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.flyoutTitleDescription",defaultMessage:"Agent policies are used to manage settings across a group of agents. You can add integrations to your agent policy to specify what data your agents collect. When you edit an agent policy, you can use Fleet to deploy updates to a specified group of agents."})))),y=n.a.createElement(u.EuiFlyoutBody,null,n.a.createElement(T.d,{agentPolicy:r,updateAgentPolicy:e=>{o({...r,...e})},withSysMonitoring:E,updateSysMonitoring:e=>f(e),validation:b})),{showDevtoolsRequest:k}=C.b.get(),v=Object(l.useMemo)((()=>Object(j.a)(r,E)),[r,E]),x=n.a.createElement(u.EuiFlyoutFooter,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexGroup,{gutterSize:"none"},k?n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(F.i,{isDisabled:m||Object.keys(b).length>0,description:g.i18n.translate("xpack.fleet.createAgentPolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request creates a new agent policy."}),request:v})):null,n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{fill:!0,isLoading:m,isDisabled:!s||m||Object.keys(b).length>0,onClick:async()=>{p(!0);try{const{data:t,error:a}=await(async()=>await Object(c.j)(r,{withSysMonitoring:E}))();p(!1),t?(i.toasts.addSuccess(g.i18n.translate("xpack.fleet.createAgentPolicy.successNotificationTitle",{defaultMessage:"Agent policy '{name}' created",values:{name:r.name}})),e(t.item)):i.toasts.addDanger(a?a.message:g.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}catch(e){p(!1),i.toasts.addDanger(g.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"}))}},"data-test-subj":"createAgentPolicyFlyoutBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createAgentPolicy.submitButtonLabel",defaultMessage:"Create agent policy"})))))));return n.a.createElement(A,w()({onClose:()=>e(),size:"l",maxWidth:400},a),h,y,x)},_=()=>{var e,t;Object(c.wb)("policies_list");const{getPath:a}=Object(c.cc)(),i=Object(c.vb)().fleet.all,{agents:{enabled:s}}=Object(c.zb)(),{urlParams:o,toUrlParams:m}=Object(c.pc)(),[p,E]=Object(l.useState)(Array.isArray(o.kuery)?o.kuery[o.kuery.length-1]:null!==(e=o.kuery)&&void 0!==e?e:""),{pagination:f,pageSizeOptions:b,setPagination:h}=Object(c.ec)(),{sorting:y,setSorting:k}=Object(c.kc)({field:"updated_at",direction:"desc"}),v=Object(r.useHistory)(),x="create"in o,S=Object(l.useCallback)((e=>{if(e!==x)if(e)v.push(`${a("policies_list")}?${m({...o,create:null})}`);else{const{create:e,...t}=o;v.push(`${a("policies_list")}?${m(t)}`)}}),[a,v,x,m,o]),{isLoading:O,data:w,resendRequest:j}=Object(c.Ib)({page:f.currentPage,perPage:f.pageSize,sortField:null==y?void 0:y.field,sortOrder:null==y?void 0:y.direction,kuery:p,full:!0}),C=Object(l.useMemo)((()=>{const e=[{field:"name",sortable:!0,name:g.i18n.translate("xpack.fleet.agentPolicyList.nameColumnTitle",{defaultMessage:"Name"}),width:"25%",render:(e,t)=>n.a.createElement(I.e,{policy:t})},{field:"description",name:g.i18n.translate("xpack.fleet.agentPolicyList.descriptionColumnTitle",{defaultMessage:"Description"}),width:"35%",render:e=>n.a.createElement(u.EuiTextColor,{color:"subdued",className:"eui-textTruncate",title:e},e)},{field:"updated_at",sortable:!0,name:g.i18n.translate("xpack.fleet.agentPolicyList.updatedOnColumnTitle",{defaultMessage:"Last updated on"}),render:e=>n.a.createElement(d.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})},{field:"agents",name:g.i18n.translate("xpack.fleet.agentPolicyList.agentsColumnTitle",{defaultMessage:"Agents"}),dataType:"number",render:(e,t)=>n.a.createElement(T.g,{count:e,agentPolicyId:t.id})},{field:"package_policies",name:g.i18n.translate("xpack.fleet.agentPolicyList.packagePoliciesCountColumnTitle",{defaultMessage:"Integrations"}),dataType:"number",render:e=>e?e.length:0},{field:"actions",name:g.i18n.translate("xpack.fleet.agentPolicyList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>n.a.createElement(T.a,{agentPolicy:e,onCopySuccess:()=>j()})}]}];return s?e:e.filter((e=>!("field"in e)||"agents"!==e.field))}),[s,j]),P=Object(l.useMemo)((()=>n.a.createElement(u.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>S(!0),"data-test-subj":"createAgentPolicyButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,S]),A=Object(l.useMemo)((()=>n.a.createElement(u.EuiButton,{fill:!0,iconType:"plusInCircle",isDisabled:!i,onClick:()=>S(!0),"data-test-subj":"emptyPromptCreateAgentPolicyButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.addButton",defaultMessage:"Create agent policy"}))),[i,S]),_=Object(l.useMemo)((()=>n.a.createElement(u.EuiEmptyPrompt,{title:n.a.createElement("h2",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noAgentPoliciesPrompt",defaultMessage:"No agent policies"})),actions:A})),[A]);return n.a.createElement(n.a.Fragment,null,x?n.a.createElement(L,{onClose:()=>{S(!1),j()}}):null,n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"m"},n.a.createElement(u.EuiFlexItem,{grow:4},n.a.createElement(F.w,{value:p,onChange:e=>{h({...f,currentPage:1}),E(e)},indexPattern:`.${M.c}`,fieldPrefix:M.c,dataTestSubj:"agentPolicyList.queryInput"})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"primary",iconType:"refresh",onClick:()=>j()},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.reloadAgentPoliciesButtonText",defaultMessage:"Reload"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},P)),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiBasicTable,{loading:O,hasActions:!0,noItemsMessage:O?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.loadingAgentPoliciesMessage",defaultMessage:"Loading agent policies…"}):p.trim()||0!==(null!==(t=null==w?void 0:w.total)&&void 0!==t?t:0)?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.noFilteredAgentPoliciesPrompt",defaultMessage:"No agent policies found. {clearFiltersLink}",values:{clearFiltersLink:n.a.createElement(u.EuiLink,{onClick:()=>E("")},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicyList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):_,items:w?w.items:[],itemId:"id",columns:C,isSelectable:!1,pagination:{pageIndex:f.currentPage-1,pageSize:f.pageSize,totalItemCount:w?w.total:0,pageSizeOptions:b},sorting:{sort:y},onChange:e=>{const t={...f,currentPage:e.page.index+1,pageSize:e.page.size};h(t),k(e.sort)}}))};var D=a(0);const B=n.a.createContext({refresh:()=>{}});var R=a(17),z=a(9);const N=(e,t)=>e.localeCompare(t),U=e=>({name:e,value:e}),H=({packagePolicies:e,agentPolicy:t,...a})=>{var i,s;const{application:r}=Object(c.lc)(),o=Object(c.vb)().integrations.writeIntegrationPolicies,m=Object(c.vb)().integrations.readIntegrationPolicies,{isPackagePolicyUpgradable:p}=Object(c.Yb)(),{getHref:E}=Object(c.cc)(),f=Object(c.fc)(),b=!(null!==(i=f.data)&&void 0!==i&&i.success)&&"MISSING_SECURITY"===(null===(s=f.data)||void 0===s?void 0:s.error),[h,y]=Object(l.useMemo)((()=>{const t=new Set;return[e.map((e=>{var a,l,n,i,s,r;e.namespace&&t.add(e.namespace);const o=p(e);return{...e,packageName:null!==(a=null===(l=e.package)||void 0===l?void 0:l.name)&&void 0!==a?a:"",packageTitle:null!==(n=null===(i=e.package)||void 0===i?void 0:i.title)&&void 0!==n?n:"",packageVersion:null!==(s=null===(r=e.package)||void 0===r?void 0:r.version)&&void 0!==s?s:"",hasUpgrade:o}})),[...t].sort(N).map(U)]}),[e,p]),k=Object(l.useMemo)((()=>[{field:"name",sortable:!0,truncateText:!0,name:g.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.nameColumnTitle",{defaultMessage:"Name"}),render:(e,a)=>n.a.createElement(u.EuiLink,w()({title:e},m?{href:E("edit_integration",{policyId:t.id,packagePolicyId:a.id})}:{disabled:!0}),n.a.createElement("span",{className:"eui-textTruncate",title:e},e),a.description?n.a.createElement("span",null," ",n.a.createElement(u.EuiToolTip,{content:a.description},n.a.createElement(u.EuiIcon,{type:"help"}))):null)},{field:"packageTitle",sortable:!0,name:g.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.packageNameColumnTitle",{defaultMessage:"Integration"}),render:(e,a)=>n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{"data-test-subj":"PackagePoliciesTableLink",grow:!1},n.a.createElement(u.EuiLink,{href:a.package&&E("integration_details_overview",{pkgkey:Object(C.s)(a.package)})},n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},a.package&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(F.t,{packageName:a.package.name,version:a.package.version,size:"m",tryApi:!0})),n.a.createElement(u.EuiFlexItem,{grow:!1},e),a.package&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.packageVersion",defaultMessage:"v{version}",values:{version:a.package.version}})))))),a.hasUpgrade&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiToolTip,{content:g.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.upgradeAvailable",{defaultMessage:"Upgrade Available"})},n.a.createElement(u.EuiIcon,{type:"warning",color:"warning"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{"data-test-subj":"PackagePoliciesTableUpgradeButton",size:"s",minWidth:"0",isDisabled:!o,href:`${E("upgrade_package_policy",{policyId:t.id,packagePolicyId:a.id})}?from=fleet-policy-list`},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.packagePoliciesTable.upgradeButton",defaultMessage:"Upgrade"})))))},{field:"namespace",name:g.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?n.a.createElement(u.EuiBadge,{color:"hollow"},e):""},{name:g.i18n.translate("xpack.fleet.policyDetails.packagePoliciesTable.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>o?n.a.createElement(F.u,{agentPolicy:t,from:"fleet-policy-list",packagePolicy:e,upgradePackagePolicyHref:`${E("upgrade_package_policy",{policyId:t.id,packagePolicyId:e.id})}?from=fleet-policy-list`}):n.a.createElement(n.a.Fragment,null)}]}]),[t,E,o,m]);return n.a.createElement(u.EuiInMemoryTable,w()({itemId:"id",items:h,columns:k,sorting:{sort:{field:"name",direction:"asc"}}},a,{search:{toolsRight:t.is_managed?[]:[n.a.createElement(F.k,{key:"addPackagePolicyButton",fill:!0,isDisabled:!o,iconType:"plusInCircle",onClick:()=>{r.navigateToApp(R.INTEGRATIONS_PLUGIN_ID,{path:z.v.integrations_all({})[1],state:{forAgentPolicyId:t.id}})},"data-test-subj":"addPackagePolicyButton",tooltip:o?void 0:{content:b?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonSecurityRequiredTooltip",defaultMessage:"To add Elastic Agent Integrations, you must have security enabled and have the All privilege for Fleet. Contact your administrator."}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.epm.addPackagePolicyButtonPrivilegesRequiredTooltip",defaultMessage:"Elastic Agent Integrations require the All privilege for Fleet and All privilege for Integrations. Contact your administrator."})}},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.addPackagePolicyButtonText",defaultMessage:"Add integration"}))],box:{incremental:!0,schema:!0},filters:[{type:"field_value_selection",field:"namespace",name:"Namespace",options:y,multiSelect:"or",operator:"exact"}]},isSelectable:!1}))},q=Object(l.memo)((({policyId:e})=>{const{application:t}=Object(c.lc)(),a=Object(c.vb)().integrations.writeIntegrationPolicies;return n.a.createElement(u.EuiEmptyPrompt,{iconType:"plusInCircle",title:n.a.createElement("h3",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstTitle",defaultMessage:"Add your first integration"})),body:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstMessage",defaultMessage:"This policy does not have any integrations yet."}),actions:n.a.createElement(u.EuiButton,{iconType:"plusInCircle",isDisabled:!a,fill:!0,onClick:()=>t.navigateToApp(M.l,{path:M.q.integrations_all({})[1],state:{forAgentPolicyId:e}}),"data-test-subj":"addPackagePolicyButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetailsPackagePolicies.createFirstButtonText",defaultMessage:"Add integration"}))})})),G=Object(l.memo)((({agentPolicy:e})=>(Object(c.wb)("policy_details",{policyName:e.name}),e.package_policies&&0!==e.package_policies.length?n.a.createElement(H,{agentPolicy:e,packagePolicies:e.package_policies}):n.a.createElement(q,{policyId:e.id}))));var W=a(14);const K=e=>Object(W.pick)(e,["name","description","namespace","monitoring_enabled","unenroll_timeout","inactivity_timeout","data_output_id","monitoring_output_id","download_source_id","fleet_server_host_id","agent_features","is_protected"]),$=p.a.div.withConfig({displayName:"FormWrapper",componentId:"sc-1lbh22t-0"})(["max-width:800px;margin-right:auto;margin-left:auto;"]),V=Object(l.memo)((({agentPolicy:e})=>{Object(c.wb)("policy_details",{policyName:e.name});const{notifications:t}=Object(c.lc)(),{agents:{enabled:a}}=Object(c.zb)(),i=Object(c.vb)().fleet.all,s=Object(c.tb)(),[r,o]=Object(l.useState)({...e}),[m,p]=Object(l.useState)(!1),[E,f]=Object(l.useState)(!1),[b,h]=Object(l.useState)(0),[y,k]=Object(l.useState)(!0),v=Object(T.h)(r),x=async()=>{p(!0);try{const{data:e,error:a}=await Object(c.qb)(r.id,K(r));e?(t.toasts.addSuccess(g.i18n.translate("xpack.fleet.editAgentPolicy.successNotificationTitle",{defaultMessage:"Successfully updated '{name}' settings",values:{name:r.name}})),s(),f(!1)):t.toasts.addDanger(a?a.message:g.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}catch(e){t.toasts.addDanger(g.i18n.translate("xpack.fleet.editAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to update agent policy"}))}p(!1)},{showDevtoolsRequest:M}=C.b.get(),S=Object(l.useMemo)((()=>Object(j.c)(r.id,K(r))),[r]);return n.a.createElement($,null,b?n.a.createElement(T.f,{agentCount:b,agentPolicy:r,onConfirm:()=>{h(0),x()},onCancel:()=>{h(0),p(!1)}}):null,n.a.createElement(T.d,{agentPolicy:r,updateAgentPolicy:e=>{o({...r,...e}),f(!0)},withSysMonitoring:y,updateSysMonitoring:e=>k(e),validation:v,isEditing:!0}),E?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"xl"}),n.a.createElement(u.EuiSpacer,{size:"xl"}),n.a.createElement(u.EuiBottomBar,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.unsavedChangesText",defaultMessage:"You have unsaved changes"})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{color:"text",onClick:()=>{o({...e}),f(!1)}},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.cancelButtonText",defaultMessage:"Cancel"}))),M?n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(F.i,{isDisabled:m||Object.keys(v).length>0,btnProps:{color:"text"},description:g.i18n.translate("xpack.fleet.editAgentPolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request updates an agent policy."}),request:S})):null,n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{onClick:async()=>{if(a){p(!0);const{data:e}=await Object(c.w)({policyId:r.id});null!=e&&e.results.total?h(e.results.total):await x()}else await x()},isLoading:m,isDisabled:!i||m||Object.keys(v).length>0,iconType:"save",color:"primary",fill:!0},m?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.savingButtonText",defaultMessage:"Saving…"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.editAgentPolicy.saveButtonText",defaultMessage:"Save changes"})))))))):null)})),Q=({isLoading:e,policyId:t,agentPolicy:a})=>{const{getHref:l}=Object(c.cc)();return n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiButtonEmpty,{iconType:"arrowLeft",href:l("policies_list"),flush:"left",size:"xs"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.viewAgentListTitle",defaultMessage:"View all agent policies"}))),n.a.createElement(u.EuiFlexItem,null,e?n.a.createElement(F.r,null):n.a.createElement(u.EuiFlexGroup,{alignItems:"center",wrap:!0,responsive:!1,gutterSize:"s"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiTitle,null,n.a.createElement("h1",null,a&&a.name||n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.policyDetailsTitle",defaultMessage:"Policy '{id}'",values:{id:t}})))),(null==a?void 0:a.is_managed)&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIconTip,{title:"Hosted agent policy",content:g.i18n.translate("xpack.fleet.policyDetails.policyDetailsHostedPolicyTooltip",{defaultMessage:"This policy is managed outside of Fleet. Most actions related to this policy are unavailable."}),type:"lock",size:"l",color:"subdued"})))),a&&a.description?n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiText,{color:"subdued",size:"s",className:"eui-textBreakWord"},a.description)):null)},Y=p.a.div.withConfig({displayName:"Divider",componentId:"sc-zpeocb-0"})(["width:0;height:100%;border-left:",";"],(e=>e.theme.eui.euiBorderThin)),J=({isLoading:e,policyId:t,agentPolicy:a,agentStatus:i,addAgent:s,onCancelEnrollment:o,isAddAgentHelpPopoverOpen:m,setIsAddAgentHelpPopoverOpen:p})=>{var E;const{getPath:f}=Object(c.cc)(),b=Object(r.useHistory)(),h=Object(l.useMemo)((()=>{var e;return null==a||null===(e=a.package_policies)||void 0===e?void 0:e.some((e=>{var t;return(null===(t=e.package)||void 0===t?void 0:t.name)===D.V}))}),[a]);if(!a)return null;const y=n.a.createElement(u.EuiLink,{onClick:s,"data-test-subj":"addAgentLink"},h?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.addFleetServerButton",defaultMessage:"Add Fleet Server"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.addAgentButton",defaultMessage:"Add agent"}));return n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexEnd",direction:"row"},[{label:g.i18n.translate("xpack.fleet.policyDetails.summary.revision",{defaultMessage:"Revision"}),content:null!==(E=null==a?void 0:a.revision)&&void 0!==E?E:0},{isDivider:!0},{label:g.i18n.translate("xpack.fleet.policyDetails.summary.integrations",{defaultMessage:"Integrations"}),content:n.a.createElement(u.EuiI18nNumber,{value:a&&a.package_policies&&a.package_policies.length||0})},{isDivider:!0},{label:g.i18n.translate("xpack.fleet.policyDetails.summary.usedBy",{defaultMessage:"Agents"}),content:i&&i.total?n.a.createElement(T.g,{count:i.total,agentPolicyId:a&&a.id||"",showAgentText:!0}):null!=a&&a.is_managed?n.a.createElement(T.g,{count:0,agentPolicyId:a&&a.id||"",showAgentText:!0}):n.a.createElement(F.a,{button:y,isOpen:m,offset:15,closePopover:()=>{p(!1)}})},{isDivider:!0},{label:g.i18n.translate("xpack.fleet.policyDetails.summary.lastUpdated",{defaultMessage:"Last updated on"}),content:a&&n.a.createElement(d.FormattedDate,{value:null==a?void 0:a.updated_at,year:"numeric",month:"short",day:"2-digit"})||""},{isDivider:!0},{content:a&&n.a.createElement(T.a,{agentPolicy:a,fullButton:!0,onCopySuccess:e=>{b.push(f("policy_details",{policyId:e.id}))},onCancelEnrollment:o})}].map(((e,t)=>{var a;return n.a.createElement(u.EuiFlexItem,{grow:!1,key:t},null!==(a=e.isDivider)&&void 0!==a&&a?n.a.createElement(Y,null):e.label?n.a.createElement(u.EuiDescriptionList,{compressed:!0,textStyle:"reverse",style:{textAlign:"right"}},n.a.createElement(u.EuiDescriptionListTitle,{className:"eui-textNoWrap"},e.label),n.a.createElement(u.EuiDescriptionListDescription,{className:"eui-textNoWrap"},e.content)):e.content)})))},Z=()=>{var e;const{params:{policyId:t,tabId:a=""}}=Object(r.useRouteMatch)(),{getHref:i}=Object(c.cc)(),s=Object(c.Pb)(t),o=s.data?s.data.item:null,{isLoading:m,error:p,sendRequest:E}=s,f=new URLSearchParams(Object(r.useLocation)().search),b="true"===f.get("openEnrollmentFlyout"),h="true"===f.get("showAddAgentHelp"),[y]=Object(l.useState)(!1),[k,v]=Object(l.useState)(b),[x,M]=Object(l.useState)(h),I=function(e,t){const a=Object(c.hc)({path:C.d.getStatusPath(),query:{policyId:e},method:"get",version:D.m.public.v1});return{isLoading:a.isLoading,data:a.data,error:a.error,refreshAgentStatus:()=>a.resendRequest}}(t),{refreshAgentStatus:T}=I,{application:{navigateToApp:O}}=Object(c.lc)(),w=Object(c.Xb)(),j=null===(e=I.data)||void 0===e?void 0:e.results,{isReady:P}=Object(c.Gb)(),A=Object(l.useMemo)((()=>{if(w&&w.onDoneNavigateTo&&P){const[e,t]=w.onDoneNavigateTo;return()=>O(e,t)}}),[P,O,w]),L=Object(l.useCallback)((()=>{M(!1),v(!0)}),[]),_=Object(l.useMemo)((()=>[{id:"integrations",name:g.i18n.translate("xpack.fleet.policyDetails.subTabs.packagePoliciesTabText",{defaultMessage:"Integrations"}),href:i("policy_details",{policyId:t,tabId:"integrations"}),isSelected:""===a||"integrations"===a},{id:"settings",name:g.i18n.translate("xpack.fleet.policyDetails.subTabs.settingsTabText",{defaultMessage:"Settings"}),href:i("policy_details",{policyId:t,tabId:"settings"}),isSelected:"settings"===a}]),[i,t,a]),R=Object(l.useMemo)((()=>y?n.a.createElement(r.Redirect,{to:"/"}):m?n.a.createElement(F.r,null):p?n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:p}):o?n.a.createElement(n.a.Fragment,null,k&&n.a.createElement(u.EuiPortal,null,n.a.createElement(F.c,{agentPolicy:o,onClose:A||(()=>v(!1))})),n.a.createElement(X,{agentPolicy:o})):n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyDetails.unexceptedErrorTitle",defaultMessage:"An error happened while loading the agent policy"}),error:g.i18n.translate("xpack.fleet.policyDetails.policyNotFoundErrorTitle",{defaultMessage:"Policy '{id}' not found",values:{id:t}})})),[y,m,p,o,k,A,t]),z=n.a.createElement(Q,{agentPolicy:o,policyId:t,isLoading:m}),N=n.a.createElement(J,{agentPolicy:o,agentStatus:j,policyId:t,onCancelEnrollment:A,isLoading:m,isAddAgentHelpPopoverOpen:x,setIsAddAgentHelpPopoverOpen:M,addAgent:L});return n.a.createElement(c.a.Provider,{value:{refresh:E}},n.a.createElement(B.Provider,{value:{refresh:T}},n.a.createElement(S.c,{leftColumn:z,rightColumn:N,tabs:_},R)))},X=({agentPolicy:e})=>(Object(c.wb)("policy_details",{policyName:e.name}),n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.policy_details_settings,render:()=>n.a.createElement(V,{agentPolicy:e})}),n.a.createElement(o.a,{path:M.h.policy_details,render:()=>n.a.createElement(G,{agentPolicy:e})})));var ee=a(188);const te=Object(l.memo)((()=>{const{params:{packagePolicyId:e}}=Object(r.useRouteMatch)(),{search:t}=Object(r.useLocation)(),a=new URLSearchParams(t).get("from");let l;return a&&"fleet-policy-list"===a?l="upgrade-from-fleet-policy-list":a&&"integrations-policy-list"===a&&(l="upgrade-from-integrations-policy-list"),n.a.createElement(ee.a,{packagePolicyId:e,from:l,forceUpgrade:!0})})),ae=()=>(Object(c.wb)("policies"),n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.edit_integration},n.a.createElement(ee.b,null)),n.a.createElement(o.a,{path:M.h.upgrade_package_policy},n.a.createElement(te,null)),n.a.createElement(o.a,{path:M.h.policy_details},n.a.createElement(Z,null)),n.a.createElement(o.a,{path:M.h.policies_list},n.a.createElement(S.a,{section:"agent_policies"},n.a.createElement(_,null)))));var le=a(69);const ne=Object(l.memo)((({datastream:e})=>{const{dashboards:t}=e,a=Object(c.Cb)(),l=n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardActionText",defaultMessage:"View dashboard"}),i=n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.dataStreamList.viewDashboardsActionText",defaultMessage:"View dashboards"}),s=g.i18n.translate("xpack.fleet.dataStreamList.viewDashboardsPanelTitle",{defaultMessage:"View dashboards"}),r=g.i18n.translate("xpack.fleet.dataStreamList.viewInApmActionText",{defaultMessage:"View in APM"}),{isSuccessful:o,href:u}=Object(le.a)(e);if(o&&u){const e=[{id:0,items:[{icon:"apmApp",href:u,name:r}]}];return n.a.createElement(F.h,{panels:e})}if(!t||0===t.length){const e=[{id:0,items:[{icon:"dashboardApp",disabled:!0,name:l}]}];return n.a.createElement(F.h,{panels:e})}if(1===t.length){var m;const e=[{id:0,items:[{icon:"dashboardApp",href:null==a?void 0:a.getRedirectUrl({dashboardId:null===(m=t[0])||void 0===m?void 0:m.id}||""),name:l}]}];return n.a.createElement(F.h,{panels:e})}const p=[{id:0,items:[{icon:"dashboardApp",panel:1,name:i}]},{id:1,title:s,items:t.map((e=>({icon:"dashboardApp",href:null==a?void 0:a.getRedirectUrl({dashboardId:null==e?void 0:e.id}||""),name:e.title})))}];return n.a.createElement(F.h,{panels:p})})),ie=()=>{Object(c.wb)("data_streams");const{pagination:e,pageSizeOptions:t}=Object(c.ec)(),{isLoading:a,data:i,resendRequest:s}=Object(c.Jb)(),r=Object(l.useMemo)((()=>[{field:"dataset",sortable:!0,width:"25%",name:g.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"})},{field:"type",sortable:!0,name:g.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"})},{field:"namespace",sortable:!0,name:g.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),render:e=>e?n.a.createElement(u.EuiBadge,{color:"hollow"},e):""},{field:"package",sortable:!0,name:g.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),render:(e,t)=>n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},t.package_version&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(F.t,{packageName:e,version:t.package_version,size:"m",tryApi:!0})),n.a.createElement(u.EuiFlexItem,{grow:!1},e))},{field:"last_activity_ms",sortable:!0,width:"25%",dataType:"date",name:g.i18n.translate("xpack.fleet.dataStreamList.lastActivityColumnTitle",{defaultMessage:"Last activity"}),render:e=>n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedDate,{value:e,year:"numeric",month:"short",day:"numeric"}),n.a.createElement(n.a.Fragment,null," @ "),n.a.createElement(d.FormattedTime,{value:e,hour:"numeric",minute:"numeric",second:"numeric"}))},{field:"size_in_bytes",sortable:!0,name:g.i18n.translate("xpack.fleet.dataStreamList.sizeColumnTitle",{defaultMessage:"Size"}),render:(e,t)=>n.a.createElement(n.a.Fragment,null,t.size_in_bytes_formatted)},{name:g.i18n.translate("xpack.fleet.dataStreamList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:e=>n.a.createElement(ne,{datastream:e})}]}]),[]),o=Object(l.useMemo)((()=>n.a.createElement(u.EuiEmptyPrompt,{title:n.a.createElement("h2",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.dataStreamList.noDataStreamsPrompt",defaultMessage:"No data streams"}))})),[]),m={dataset:[],type:[],namespace:[],package:[]};if(i&&i.data_streams.length){const e={dataset:[],type:[],namespace:[],package:[]};i.data_streams.forEach((t=>{const{dataset:a,type:l,namespace:n,package:i}=t;e.dataset.includes(a)||e.dataset.push(a),e.type.includes(l)||e.type.push(l),e.namespace.includes(n)||e.namespace.push(n),e.package.includes(i)||e.package.push(i)}));for(const t in e)m[t]&&(m[t]=e[t].sort().map((e=>({value:e,name:e}))))}return n.a.createElement(u.EuiInMemoryTable,{loading:a,hasActions:!0,tableLayout:"auto",message:a?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.dataStreamList.loadingDataStreamsMessage",defaultMessage:"Loading data streams…"}):i&&!i.data_streams.length?o:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.dataStreamList.noFilteredDataStreamsMessage",defaultMessage:"No matching data streams found"}),items:i?i.data_streams:[],itemId:"index",columns:r,pagination:{initialPageSize:e.pageSize,pageSizeOptions:t},sorting:!0,search:{toolsRight:[n.a.createElement(u.EuiButton,{key:"reloadButton",color:"primary",iconType:"refresh",onClick:()=>s()},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.dataStreamList.reloadDataStreamsButtonText",defaultMessage:"Reload"}))],box:{placeholder:g.i18n.translate("xpack.fleet.dataStreamList.searchPlaceholderTitle",{defaultMessage:"Filter data streams"}),incremental:!0},filters:[{type:"field_value_selection",field:"dataset",name:g.i18n.translate("xpack.fleet.dataStreamList.datasetColumnTitle",{defaultMessage:"Dataset"}),multiSelect:"or",operator:"exact",options:m.dataset},{type:"field_value_selection",field:"type",name:g.i18n.translate("xpack.fleet.dataStreamList.typeColumnTitle",{defaultMessage:"Type"}),multiSelect:"or",operator:"exact",options:m.type},{type:"field_value_selection",field:"namespace",name:g.i18n.translate("xpack.fleet.dataStreamList.namespaceColumnTitle",{defaultMessage:"Namespace"}),multiSelect:"or",operator:"exact",options:m.namespace},{type:"field_value_selection",field:"package",name:g.i18n.translate("xpack.fleet.dataStreamList.integrationColumnTitle",{defaultMessage:"Integration"}),multiSelect:"or",operator:"exact",options:m.package}]}})},se=()=>n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.data_streams},n.a.createElement(S.a,{section:"data_streams"},n.a.createElement(ie,null))));var re=a(5),oe=a(130),ce=a(194);const ue=({onClose:e,agents:t,agentCount:a})=>{const{notifications:i}=Object(c.lc)(),[s,o]=Object(l.useState)(!1),m=Array.isArray(t)&&1===t.length,{getPath:p}=Object(c.cc)(),E=Object(r.useHistory)();return n.a.createElement(u.EuiConfirmModal,{"data-test-subj":"requestDiagnosticsModal",title:m?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.singleTitle",defaultMessage:"Request diagnostics"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.multipleTitle",defaultMessage:"Request diagnostics for {count} agents",values:{count:a}}),onCancel:e,onConfirm:async function(){try{o(!0);const{error:a}=m?await Object(c.db)(t[0].id):await Object(c.V)({agents:"string"==typeof t?t:t.map((e=>e.id))});if(a)throw a;o(!1);const l=g.i18n.translate("xpack.fleet.requestDiagnostics.successSingleNotificationTitle",{defaultMessage:"Request diagnostics submitted"});if(i.toasts.addSuccess(l),m){const e=p("agent_details_diagnostics",{agentId:t[0].id});E.push(e)}e()}catch(e){o(!1),i.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.requestDiagnostics.fatalErrorNotificationTitle",{defaultMessage:"Error requesting diagnostics {count, plural, one {agent} other {agents}}",values:{count:a}})})}},cancelButtonText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonDisabled:s,confirmButtonText:m?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.confirmSingleButtonLabel",defaultMessage:"Request diagnostics"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.confirmMultipleButtonLabel",defaultMessage:"Request diagnostics for {count} agents",values:{count:a}}),buttonColor:"primary"},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.description",defaultMessage:"Diagnostics files are stored in Elasticsearch, and as such can incur storage costs."})))};var de=a(95);const ge=Object(u.euiPaletteColorBlindBehindText)(),me={default:de.euiLightVars.euiColorLightShade,primary:ge[1],success:ge[0],accent:ge[2],warning:ge[5],danger:ge[9],inactive:de.euiLightVars.euiColorDarkShade,lightest:de.euiLightVars.euiColorDisabled},pe=["healthy","unhealthy","updating","offline","inactive","unenrolled"];function Ee(e){switch(e){case"healthy":return me.success;case"offline":return me.default;case"inactive":return me.inactive;case"unhealthy":return me.warning;case"updating":return me.primary;case"unenrolled":return me.lightest;default:throw new Error(`Unsupported Agent status ${e}`)}}const fe=p()(u.EuiColorPaletteDisplay).withConfig({displayName:"StyledEuiColorPaletteDisplay",componentId:"sc-1wvk6tr-0"})(["&.ingest-agent-status-bar{border:none;border-radius:0;&:after{border:none;}}"]),be=({agentStatus:e})=>{const t=Object(l.useMemo)((()=>pe.reduce(((t,a)=>{const l=t.length>0?t[t.length-1].stop:0;return t.push({stop:l+(e[a]||0),color:Ee(a)}),t}),[])),[e]);return 0===t[t.length-1].stop?n.a.createElement(u.EuiSpacer,{size:"s"}):n.a.createElement(fe,{"data-test-subj":"agentStatusBar",className:"ingest-agent-status-bar",size:"s",palette:t})},he=p.a.div.withConfig({displayName:"Divider",componentId:"sc-1e6bwq9-0"})(["width:0;height:",";border-left:",";"],(e=>e.theme.eui.euiSizeL),(e=>e.theme.eui.euiBorderThin)),ye=p()(u.EuiFlexItem).withConfig({displayName:"FlexItem",componentId:"sc-1e6bwq9-1"})(["height:",";"],(e=>e.theme.eui.euiSizeL)),ke=p()(u.EuiButtonEmpty).withConfig({displayName:"Button",componentId:"sc-1e6bwq9-2"})([".euiButtonEmpty__text{font-size:",";}"],(e=>e.theme.eui.euiFontSizeXS)),ve=({totalAgents:e,selectableAgents:t,managedAgentsOnCurrentPage:a,selectionMode:l,setSelectionMode:i,selectedAgents:s,setSelectedAgents:r})=>{const o="manual"===l&&s.length>0||"query"===l&&e>0,c="manual"===l&&s.length===t&&t<e-a;return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiText,{size:"xs",color:"subdued"},e>M.p?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgentsWithLimit",defaultMessage:"Showing {count} of {total} agents",values:{count:n.a.createElement(d.FormattedNumber,{value:M.p}),total:n.a.createElement(d.FormattedNumber,{value:e})}}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.totalAgents",defaultMessage:"Showing {count, plural, one {# agent} other {# agents}}",values:{count:e}}))),o?n.a.createElement(n.a.Fragment,null,n.a.createElement(ye,{grow:!1},n.a.createElement(he,null)),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiText,{size:"xs",color:"subdued","data-test-subj":"selectedAgentCountLabel"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.agentsSelected",defaultMessage:"{count, plural, one {# agent} other {# agents} =all {All agents}} selected",values:{count:"manual"===l?s.length:"all"}}))),c?n.a.createElement(n.a.Fragment,null,n.a.createElement(ye,{grow:!1},n.a.createElement(he,null)),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(ke,{size:"xs",flush:"left","data-test-subj":"selectedEverythingOnAllPagesButton",onClick:()=>i("query")},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.selectAll",defaultMessage:"Select everything on all pages"})))):null,n.a.createElement(ye,{grow:!1},n.a.createElement(he,null)),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(ke,{size:"xs",flush:"left","data-test-subj":"clearAgentSelectionButton",onClick:()=>{i("manual"),r([])}},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.clearSelection",defaultMessage:"Clear selection"})))):n.a.createElement(ye,{grow:!1})))},xe=Object(l.memo)((({agentStatus:e,showInactive:t})=>{const a=Object(l.useMemo)((()=>pe.filter((e=>!!t||"inactive"!==e&&"unenrolled"!==e))),[t]);return n.a.createElement(u.EuiFlexGroup,{gutterSize:"m"},a.map((t=>n.a.createElement(u.EuiFlexItem,{key:t,grow:!1},n.a.createElement(Fe,{status:t,count:e[t]||0})))))})),Fe=Object(l.memo)((({status:e,count:t})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiHealth,{color:Ee(e)},n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},n.a.createElement(u.EuiFlexItem,{grow:!1},function(e){switch(e){case"healthy":return g.i18n.translate("xpack.fleet.agentStatus.healthyLabel",{defaultMessage:"Healthy"});case"offline":return g.i18n.translate("xpack.fleet.agentStatus.offlineLabel",{defaultMessage:"Offline"});case"inactive":return g.i18n.translate("xpack.fleet.agentStatus.inactiveLabel",{defaultMessage:"Inactive"});case"unenrolled":return g.i18n.translate("xpack.fleet.agentStatus.unenrolledLabel",{defaultMessage:"Unenrolled"});case"unhealthy":return g.i18n.translate("xpack.fleet.agentStatus.unhealthyLabel",{defaultMessage:"Unhealthy"});case"updating":return g.i18n.translate("xpack.fleet.agentStatus.updatingLabel",{defaultMessage:"Updating"});default:throw new Error(`Unsupported Agent status ${e}`)}}(e)),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiNotificationBadge,{size:"s",color:"subdued"},t))))))),Me=({agentStatus:e,totalAgents:t,selectableAgents:a,managedAgentsOnCurrentPage:l,selectionMode:i,setSelectionMode:s,selectedAgents:r,setSelectedAgents:o,showInactive:c,clearFilters:g,isUsingFilter:m})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexStart",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(ve,{totalAgents:t,selectableAgents:a,managedAgentsOnCurrentPage:l,selectionMode:i,setSelectionMode:s,selectedAgents:r,setSelectedAgents:o})),m?n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiLink,{onClick:()=>g()},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.header.clearFiltersLinkText",defaultMessage:"Clear filters"}))):null),n.a.createElement(u.EuiFlexItem,{grow:!1},e&&n.a.createElement(xe,{showInactive:c,agentStatus:e}))),n.a.createElement(u.EuiSpacer,{size:"s"}),e&&n.a.createElement(be,{agentStatus:e}));var Se=a(253);const Ie=20;function Te(e){return e.length>Ie?`${e.substring(0,Ie)}...`:e}function Oe(e){return e.replace(/[^a-zA-Z0-9 \-_]/g,"").slice(0,20)}const we=()=>{const{notifications:e}=Object(c.lc)(),t=Object(l.useCallback)((async(t,a,l,n)=>{try{const n=await t();if(n.error)throw n.error;const i=!n.data.actionId,s=null!=l?l:g.i18n.translate("xpack.fleet.updateAgentTags.successNotificationTitle",{defaultMessage:"Tag(s) updated"});e.toasts.addSuccess(s),a(i)}catch(t){const a=null!=n?n:g.i18n.translate("xpack.fleet.updateAgentTags.errorNotificationTitle",{defaultMessage:"Tag(s) update failed"});e.toasts.addError(t,{title:a})}}),[e.toasts]);return{updateTags:Object(l.useCallback)((async(e,a,l,n,i)=>{await t((async()=>await Object(c.fb)(e,{tags:a})),l,n,i)}),[t]),bulkUpdateTags:Object(l.useCallback)((async(e,a,l,n,i,s)=>{await t((async()=>await Object(c.S)({agents:e,tagsToAdd:a,tagsToRemove:l})),n,i,s)}),[t])}},je="fleet.lastSeenInactiveAgentsCount",Ce="fleet.inactiveAgentsCalloutHasBeenDismissed";async function Pe(){var e,t;const a=await Object(c.z)({kuery:"status:online",perPage:0,showInactive:!1});if(a.error)throw new Error(a.error.message);return null!==(e=null===(t=a.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0}const Ae="fleet.missingEncryptionKeyCalloutHasBeenDismissed",Le=({tagName:e,isTagHovered:t,onTagsUpdated:a})=>{const[i,s]=Object(l.useState)(!1),[r,o]=Object(l.useState)(),[c,m]=Object(l.useState)(t),[p,E]=Object(l.useState)(e);Object(l.useEffect)((()=>{m(t||i)}),[t,i]),Object(l.useEffect)((()=>{E(e)}),[e]);const f=(e=!1)=>{s(!1),e?v():k(p)},b=we(),h=b.bulkUpdateTags,y='tags:"{name}"',k=t=>{if(t===e||!t)return;const l=y.replace("{name}",e);h(l,[t],[e],(l=>a([t],[e],l)),g.i18n.translate("xpack.fleet.renameAgentTags.successNotificationTitle",{defaultMessage:"Tag renamed"}),g.i18n.translate("xpack.fleet.renameAgentTags.errorNotificationTitle",{defaultMessage:"Tag rename failed"}))},v=()=>{const t=y.replace("{name}",e);b.bulkUpdateTags(t,[],[e],(t=>a([],[e],t)),g.i18n.translate("xpack.fleet.deleteAgentTags.successNotificationTitle",{defaultMessage:"Tag deleted"}),g.i18n.translate("xpack.fleet.deleteAgentTags.errorNotificationTitle",{defaultMessage:"Tag delete failed"}))};return n.a.createElement(n.a.Fragment,null,c&&n.a.createElement(u.EuiButtonIcon,{iconType:"boxesHorizontal","aria-label":g.i18n.translate("xpack.fleet.tagOptions.tagOptionsToggleButtonLabel",{defaultMessage:"Tag Options"}),color:"text",onClick:e=>{o(e.currentTarget),s(!i)}}),i&&n.a.createElement(u.EuiWrappingPopover,{isOpen:!0,button:r,closePopover:f,anchorPosition:"downCenter"},n.a.createElement(u.EuiFlexGroup,{direction:"column",alignItems:"flexStart",gutterSize:"xs"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFieldText,{placeholder:g.i18n.translate("xpack.fleet.tagOptions.nameTextFieldPlaceholder",{defaultMessage:"Enter new name for tag"}),value:p,required:!0,onKeyDown:e=>{"Enter"===e.key&&f()},onChange:e=>{const t=e.currentTarget.value;E(Oe(t))}})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiButtonEmpty,{size:"s",color:"danger",onClick:()=>{f(!0)}},n.a.createElement(u.EuiIcon,{type:"trash"})," ",n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.tagOptions.deleteText",defaultMessage:"Delete tag"}))))))},_e=p()(u.EuiHighlight).withConfig({displayName:"TruncatedEuiHighlight",componentId:"sc-492jbf-0"})(["width:120px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"]),De=({agentId:e,agents:t,allTags:a,selectedTags:i,button:s,onTagsUpdated:r,onClosePopover:o})=>{const c=Object(l.useCallback)(((e,t)=>e.map((e=>({label:e,checked:t.includes(e)?"on":void 0,onFocusBadge:!1})))),[]),[m,p]=Object(l.useState)(c(a,i)),[E,f]=Object(l.useState)(void 0),[b,h]=Object(l.useState)(!0),[y,k]=Object(l.useState)({}),v=we();Object(l.useEffect)((()=>{p(c(a,i))}),[a,c,i]);const x=Object(l.useMemo)((()=>m.some((e=>e.label===E))),[m,E]),F=(e,t,l=!0,n=!1)=>{if(l)return r();const i=m.filter((e=>"on"===e.checked)).map((e=>e.label)),s=Object(W.difference)(i,t).concat(e),o=Object(W.uniq)(a.concat(s)),u=n?Object(W.difference)(o,t):o;p(c(u,s))},M=async(a,l,n,s)=>{if(e){const t=Object(W.difference)(i,l).concat(a);v.updateTags(e,t,(()=>r()),n,s)}else v.bulkUpdateTags(t,a,l,(e=>F(a,l,e)),n,s)},S=n.a.createElement(u.EuiButtonEmpty,{color:"text","data-test-subj":"createTagBtn",onClick:()=>{E&&M([E],[],g.i18n.translate("xpack.fleet.createAgentTags.successNotificationTitle",{defaultMessage:"Tag created"}),g.i18n.translate("xpack.fleet.createAgentTags.errorNotificationTitle",{defaultMessage:"Tag creation failed"}))}},n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIcon,{type:"plus"})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.tagsAddRemove.createText",defaultMessage:'Create a new tag "{name}"',values:{name:E}}))));return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiWrappingPopover,{isOpen:b,button:s,closePopover:()=>{h(!1),o()},anchorPosition:"leftUp"},n.a.createElement(u.EuiSelectable,{onFocus:()=>{},"aria-label":g.i18n.translate("xpack.fleet.tagsAddRemove.selectableTagsLabel",{defaultMessage:"Add / remove tags"}),searchable:!0,searchProps:{"data-test-subj":"addRemoveTags",placeholder:g.i18n.translate("xpack.fleet.tagsAddRemove.findOrCreatePlaceholder",{defaultMessage:"Find or create tag..."}),onChange:e=>{f(Oe(e))},value:null!=E?E:""},options:m,renderOption:(e,t)=>n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",onMouseEnter:()=>k({...y,[e.label]:!0}),onMouseLeave:()=>k({...y,[e.label]:!1})},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(_e,{search:t,onClick:()=>{const t="on"===e.checked?[]:[e.label],a="on"===e.checked?[e.label]:[];M(t,a)}},e.label)),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Le,{tagName:e.label,isTagHovered:y[e.label],onTagsUpdated:(e,t,a)=>F(e,t,a,!0)})))},((e,t)=>n.a.createElement(l.Fragment,null,t,e))),x&&0!==m.length||""===E?null:S))},Be=({shownAgents:e,inactiveShownAgents:t,totalManagedAgentIds:a,inactiveManagedAgentIds:i,selectionMode:s,currentQuery:r,selectedAgents:o,visibleAgents:g,refreshAgents:m,allTags:p,agentPolicies:E})=>{const f=Object(c.bc)().hasAtLeast(D.gb),[b,h]=Object(l.useState)(!1),y=()=>h(!1),[k,v]=Object(l.useState)(!1),[x,F]=Object(l.useState)(!1),[M,S]=Object(l.useState)({isOpen:!1,isScheduled:!1,isUpdating:!1}),[I,T]=Object(l.useState)(!1),[O,w]=Object(l.useState)(!1),j=Object(l.useMemo)((()=>{if(a.length){const e=`${D.b}.agent.id : (${a.map((e=>`"${e}"`)).join(" or ")})`;return`${r} AND NOT (${e})`}return r}),[r,a]),P=e-t,A="manual"===s?o.length:P-((null==a?void 0:a.length)-(null==i?void 0:i.length)),L="manual"===s?!!o.find((e=>e.active)):e>t,_="manual"===s?o:j,[B,R]=Object(l.useState)(),{diagnosticFileUploadEnabled:z}=C.b.get(),N=[{name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.addRemoveTags","data-test-subj":"agentBulkActionsAddRemoveTags",defaultMessage:"Add / remove tags"}),icon:n.a.createElement(u.EuiIcon,{type:"tag",size:"m"}),disabled:!L,onClick:e=>{R(e.target.closest("button")),T(!I)}},{name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.reassignPolicy","data-test-subj":"agentBulkActionsReassign",defaultMessage:"Assign to new policy"}),icon:n.a.createElement(u.EuiIcon,{type:"pencil",size:"m"}),disabled:!L,onClick:()=>{y(),v(!0)}},{name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.unenrollAgents","data-test-subj":"agentBulkActionsUnenroll",defaultMessage:"Unenroll {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:n.a.createElement(u.EuiIcon,{type:"trash",size:"m"}),disabled:!L,onClick:()=>{y(),F(!0)}},{name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.upgradeAgents","data-test-subj":"agentBulkActionsUpgrade",defaultMessage:"Upgrade {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:n.a.createElement(u.EuiIcon,{type:"refresh",size:"m"}),disabled:!L,onClick:()=>{y(),S({isOpen:!0,isScheduled:!1,isUpdating:!1})}},{name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.scheduleUpgradeAgents","data-test-subj":"agentBulkActionsScheduleUpgrade",defaultMessage:"Schedule upgrade for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:n.a.createElement(u.EuiIcon,{type:"timeRefresh",size:"m"}),disabled:!L||!f,onClick:()=>{y(),S({isOpen:!0,isScheduled:!0,isUpdating:!1})}}];N.push({name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.restartUpgradeAgents","data-test-subj":"agentBulkActionsRestartUpgrade",defaultMessage:"Restart upgrade {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:n.a.createElement(u.EuiIcon,{type:"refresh",size:"m"}),disabled:!L,onClick:()=>{y(),S({isOpen:!0,isScheduled:!1,isUpdating:!0})}}),z&&N.push({name:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.requestDiagnostics","data-test-subj":"agentBulkActionsRequestDiagnostics",defaultMessage:"Request diagnostics for {agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:A}}),icon:n.a.createElement(u.EuiIcon,{type:"download",size:"m"}),disabled:!L,onClick:()=>{y(),w(!0)}});const U=[{id:0,items:N}],H=Object(l.useMemo)((()=>((e,t,a)=>{const l=e=>e.reduce(((e,t)=>{var l,n;return(e=>{const t=a.find((t=>t.id===e.policy_id));return!!t&&t.is_managed})(t)?e:e.length<1?null!==(n=t.tags)&&void 0!==n?n:[]:Object(W.intersection)(null!==(l=t.tags)&&void 0!==l?l:[],e)}),[]);return Array.isArray(e)?l(t.length>0?t.filter((t=>e.find((e=>e.id===t.id)))):e):l(t)})(_,null!=g?g:[],E)),[_,g,E]);return n.a.createElement(n.a.Fragment,null,k&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.c,{agents:_,onClose:()=>{v(!1),m()}})),x&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.d,{agents:_,agentCount:A,onClose:()=>{F(!1),m({refreshTags:!0})}})),M.isOpen&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.e,{agents:_,agentCount:A,isScheduled:M.isScheduled,isUpdating:M.isUpdating,onClose:()=>{S({isOpen:!1,isScheduled:!1,isUpdating:!1}),m()}})),I&&n.a.createElement(De,{agents:Array.isArray(_)?_.map((e=>e.id)):_,allTags:null!=p?p:[],selectedTags:H,button:B,onTagsUpdated:()=>{m({refreshTags:!0})},onClosePopover:()=>{T(!1),y()}}),O&&n.a.createElement(u.EuiPortal,null,n.a.createElement(ue,{agents:_,agentCount:A,onClose:()=>{w(!1)}})),n.a.createElement(u.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiPopover,{id:"agentBulkActionsMenu",button:n.a.createElement(u.EuiButton,{fill:!0,iconType:"arrowDown",iconSide:"right",onClick:()=>h(!b),"data-test-subj":"agentBulkActionsButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentBulkActions.actions",defaultMessage:"Actions"})),isOpen:b,closePopover:y,panelPaddingSize:"none",anchorPosition:"downLeft"},n.a.createElement(u.EuiContextMenu,{initialPanelId:0,panels:U})))))},Re=({onClickAgentActivity:e,showAgentActivityTour:t})=>{const{uiSettings:a}=Object(c.lc)(),[i,s]=Object(l.useState)(t),r=a.get("hideAgentActivityTour",!1);Object(l.useEffect)((()=>{s(t)}),[t,s]);const o=()=>{s({isOpen:!1}),a.set("hideAgentActivityTour",!0)};return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiTourStep,{content:n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityButton.tourContent",defaultMessage:"Review in progress, completed, and scheduled agent action activity history here anytime."})),isStepOpen:!r&&i.isOpen,onFinish:o,minWidth:360,maxWidth:360,step:1,stepsTotal:1,title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityButton.tourTitle",defaultMessage:"Agent activity history"}),anchorPosition:"upCenter",footerAction:n.a.createElement(u.EuiButtonEmpty,{onClick:o},"OK"),anchor:"#agentActivityButton"}),n.a.createElement(u.EuiButtonEmpty,{onClick:()=>{e(),s({isOpen:!1})},"data-test-subj":"agentActivityButton",iconType:"clock",id:"agentActivityButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.agentActivityButton",defaultMessage:"Agent activity"})))},ze=[{status:"healthy",label:g.i18n.translate("xpack.fleet.agentList.statusHealthyFilterText",{defaultMessage:"Healthy"})},{status:"unhealthy",label:g.i18n.translate("xpack.fleet.agentList.statusUnhealthyFilterText",{defaultMessage:"Unhealthy"})},{status:"updating",label:g.i18n.translate("xpack.fleet.agentList.statusUpdatingFilterText",{defaultMessage:"Updating"})},{status:"offline",label:g.i18n.translate("xpack.fleet.agentList.statusOfflineFilterText",{defaultMessage:"Offline"})},{status:"inactive",label:g.i18n.translate("xpack.fleet.agentList.statusInactiveFilterText",{defaultMessage:"Inactive"})},{status:"unenrolled",label:g.i18n.translate("xpack.fleet.agentList.statusUnenrolledFilterText",{defaultMessage:"Unenrolled"})}],Ne=p()(u.EuiNotificationBadge).withConfig({displayName:"LeftpaddedNotificationBadge",componentId:"sc-94zpuo-0"})(["margin-left:10px;"]),Ue=p()(u.EuiTourStep).withConfig({displayName:"TourStepNoHeaderFooter",componentId:"sc-94zpuo-1"})([".euiTourFooter{display:none;}.euiTourHeader{display:none;}"]),He=({children:e,isOpen:t})=>n.a.createElement(Ue,{content:n.a.createElement(u.EuiText,{size:"s"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.inactiveAgentsTourStepContent",defaultMessage:"Some agents have become inactive and have been hidden. Use status filters to show inactive or unenrolled agents."})),isStepOpen:t,minWidth:300,step:1,stepsTotal:0,title:"",onFinish:()=>{},anchorPosition:"upCenter",maxWidth:280},e),qe=e=>{const{selectedStatus:t,onSelectedStatusChange:a,disabled:i,totalInactiveAgents:s,isOpenByDefault:r=!1}=e,[o,c]=(()=>{const[e,t]=Object(l.useState)(0);return Object(l.useEffect)((()=>{const e=localStorage.getItem(je);e&&t(parseInt(e,10))}),[]),[e,e=>{localStorage.setItem(je,e.toString()),t(e)}]})(),[g,m]=(()=>{const[e,t]=Object(l.useState)(!1);return Object(l.useEffect)((()=>{const e=localStorage.getItem(Ce);e&&t(Boolean(e))}),[]),[e,e=>{localStorage.setItem(Ce,e.toString()),t(e)}]})(),p=Object(l.useMemo)((()=>{const e=s-o;return e<0?0:e}),[o,s]);Object(l.useMemo)((()=>{t.length&&t.includes("inactive")&&p&&c(s)}),[t,p,c,s]),Object(l.useMemo)((()=>{s>0&&o>s&&c(s)}),[o,s,c]);const[E,f]=Object(l.useState)(r),b=e=>{e&&p>0&&!g&&m(!0),f(e)},{euiTheme:h}=Object(u.useEuiTheme)();return n.a.createElement(He,{isOpen:p>0&&!g},n.a.createElement(u.EuiPopover,{ownFocus:!0,button:n.a.createElement(u.EuiFilterButton,{iconType:"arrowDown",onClick:()=>b(!E),isSelected:E,hasActiveFilters:t.length>0,numActiveFilters:t.length,numFilters:ze.length,disabled:i,"data-test-subj":"agentList.statusFilter"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.statusFilterText",defaultMessage:"Status"})),isOpen:E,closePopover:()=>b(!1),panelPaddingSize:"none"},n.a.createElement(Ge,{className:"eui-yScroll",$_css:30*h.base},ze.map((({label:e,status:l},i)=>n.a.createElement(u.EuiFilterSelectItem,{key:i,checked:t.includes(l)?"on":void 0,onClick:()=>{t.includes(l)?a([...t.filter((e=>e!==l))]):a([...t,l])}},n.a.createElement("span",null,e,"inactive"===l&&p>0&&n.a.createElement(Ne,null,p))))))))};var Ge=p()("div").withConfig({displayName:"_StyledDiv",componentId:"sc-94zpuo-2"})((e=>({maxHeight:e.$_css})));const We=()=>{const e=Object(c.Cb)(),t=t=>(null==e?void 0:e.getRedirectUrl({dashboardId:t}))||"",{dashboardExists:a,loading:i}=(e=>{const[t,a]=n.a.useState(!1),[i,s]=n.a.useState(!0),{dashboard:r}=Object(c.lc)();return Object(l.useEffect)((()=>{(async()=>{try{const t=await r.findDashboardsService(),[l]=await t.findByIds([e]);s(!1),a("success"===(null==l?void 0:l.status))}catch(e){s(!1),a(!1)}})()}),[e,r]),{dashboardExists:t,loading:i}})(D.q.ELASTIC_AGENT_OVERVIEW);return i||!a?null:n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexStart"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{iconType:"dashboardApp",href:t(D.q.ELASTIC_AGENT_OVERVIEW),"data-test-subj":"ingestOverviewLinkButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.ingestOverviewlinkButton",defaultMessage:"Ingest Overview Metrics"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{iconType:"dashboardApp",href:t(D.q.ELASTIC_AGENT_AGENT_INFO),"data-test-subj":"agentInfoLinkButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.agentInfoLinkButton",defaultMessage:"Agent Info Metrics"})))))},Ke=p()(u.EuiFilterSelectItem).withConfig({displayName:"ClearAllTagsFilterItem",componentId:"sc-isvns5-0"})(["padding:",";"],(e=>e.theme.eui.euiSizeS)),$e=({agentPolicies:e,draftKuery:t,onDraftKueryChange:a,onSubmitSearch:i,selectedAgentPolicies:s,onSelectedAgentPoliciesChange:r,selectedStatus:o,onSelectedStatusChange:g,showUpgradeable:m,onShowUpgradeableChange:p,tags:E,selectedTags:f,onSelectedTagsChange:b,shownAgents:h,inactiveShownAgents:y,totalInactiveAgents:k,totalManagedAgentIds:v,inactiveManagedAgentIds:x,selectionMode:S,currentQuery:I,selectedAgents:T,refreshAgents:O,onClickAddAgent:w,onClickAddFleetServer:j,visibleAgents:C,onClickAgentActivity:P,showAgentActivityTour:A})=>{const{euiTheme:L}=Object(u.useEuiTheme)(),{isFleetServerStandalone:_}=Object(c.Fb)(),{isFirstTimeAgentUser:D,isLoading:B}=Object(Se.a)(),R=!_,[z,N]=Object(l.useState)(!1),[U,H]=Object(l.useState)(!1);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{direction:"column"},n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(u.EuiFlexItem,null,!B&&!D&&n.a.createElement(We,null)),n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Re,{onClickAgentActivity:P,showAgentActivityTour:A})),R&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton.tooltip",defaultMessage:"Fleet Server is a component of the Elastic Stack used to centrally manage Elastic Agents"})},n.a.createElement(u.EuiButton,{onClick:j,"data-test-subj":"addFleetServerButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.addFleetServerButton",defaultMessage:"Add Fleet Server"})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.addAgentButton.tooltip",defaultMessage:"Add Elastic Agents to your hosts to collect data and send it to the Elastic Stack"})},n.a.createElement(u.EuiButton,{fill:!0,onClick:w,"data-test-subj":"addAgentButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})))))),n.a.createElement(u.EuiFlexItem,{grow:4},n.a.createElement(u.EuiFlexGroup,{gutterSize:"s"},n.a.createElement(u.EuiFlexItem,{grow:6},n.a.createElement(F.w,{value:t,onChange:(e,t)=>{a(e),t&&i(e)},fieldPrefix:M.b,indexPattern:M.a,dataTestSubj:"agentList.queryInput"})),n.a.createElement(u.EuiFlexItem,{grow:2},n.a.createElement(u.EuiFilterGroup,null,n.a.createElement(qe,{selectedStatus:o,onSelectedStatusChange:g,totalInactiveAgents:k,disabled:0===e.length}),n.a.createElement(u.EuiPopover,{ownFocus:!0,button:n.a.createElement(u.EuiFilterButton,{iconType:"arrowDown",onClick:()=>H(!U),isSelected:U,hasActiveFilters:f.length>0,numActiveFilters:f.length,numFilters:E.length,disabled:0===E.length,"data-test-subj":"agentList.tagsFilter"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.tagsFilterText",defaultMessage:"Tags"})),isOpen:U,closePopover:()=>H(!1),panelPaddingSize:"none"},n.a.createElement(Ve,{className:"eui-yScroll",$_css:30*L.base},n.a.createElement(n.a.Fragment,null,E.map(((e,t)=>n.a.createElement(u.EuiFilterSelectItem,{checked:f.includes(e)?"on":void 0,key:t,onClick:()=>{f.includes(e)?(e=>{b(f.filter((t=>t!==e)))})(e):(e=>{b([...f,e])})(e)}},e.length>Ie?n.a.createElement(u.EuiToolTip,{content:e},n.a.createElement("span",null,Te(e))):e))),n.a.createElement(u.EuiHorizontalRule,{margin:"none"}),n.a.createElement(Ke,{showIcons:!1,onClick:()=>{b([])}},n.a.createElement(u.EuiFlexGroup,{alignItems:"center",justifyContent:"center",gutterSize:"s"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIcon,{type:"error",color:"danger",size:"s"})),n.a.createElement(u.EuiFlexItem,{grow:!1},"Clear all")))))),n.a.createElement(u.EuiPopover,{ownFocus:!0,button:n.a.createElement(u.EuiFilterButton,{iconType:"arrowDown",onClick:()=>N(!z),isSelected:z,hasActiveFilters:s.length>0,numActiveFilters:s.length,numFilters:e.length,disabled:0===e.length,"data-test-subj":"agentList.policyFilter"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.policyFilterText",defaultMessage:"Agent policy"})),isOpen:z,closePopover:()=>N(!1),panelPaddingSize:"none"},n.a.createElement(Qe,{className:"eui-yScroll",$_css2:30*L.base},e.map(((e,t)=>n.a.createElement(u.EuiFilterSelectItem,{checked:s.includes(e.id)?"on":void 0,key:t,onClick:()=>{var t;s.includes(e.id)?(t=e.id,r(s.filter((e=>e!==t)))):(e=>{r([...s,e])})(e.id)}},e.name))))),n.a.createElement(u.EuiFilterButton,{hasActiveFilters:m,onClick:()=>{p(!m)},"data-test-subj":"agentList.showUpgradeable"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.showUpgradeableFilterLabel",defaultMessage:"Upgrade available"})))),"manual"===S&&T.length||"query"===S&&h>0?n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Be,{shownAgents:h,inactiveShownAgents:y,totalManagedAgentIds:v,inactiveManagedAgentIds:x,selectionMode:S,currentQuery:I,selectedAgents:T,visibleAgents:C,refreshAgents:O,allTags:E,agentPolicies:e})):null))))};var Ve=p()("div").withConfig({displayName:"_StyledDiv",componentId:"sc-isvns5-1"})((e=>({maxHeight:e.$_css}))),Qe=p()("div").withConfig({displayName:"_StyledDiv2",componentId:"sc-isvns5-2"})((e=>({maxHeight:e.$_css2})));const Ye=({search:e,selectedAgentPolicies:t,selectedTags:a,selectedStatus:l,selectedAgentIds:n})=>{let i="";if(e&&(i=e.trim()),null!=t&&t.length&&(i&&(i=`(${i}) and`),i=`${i} ${M.b}.policy_id : (${t.map((e=>`"${e}"`)).join(" or ")})`),null!=a&&a.length&&(i&&(i=`(${i}) and`),i=`${i} ${M.b}.tags : (${a.map((e=>`"${e}"`)).join(" or ")})`),null!=n&&n.length&&(i&&(i=`(${i}) and`),i=`${i} ${M.b}.agent.id : (${n.map((e=>`"${e}"`)).join(" or ")})`),null!=l&&l.length){const e=l.map((e=>{switch(e){case"healthy":return C.a.buildKueryForOnlineAgents();case"unhealthy":return C.a.buildKueryForErrorAgents();case"offline":return C.a.buildKueryForOfflineAgents();case"updating":return C.a.buildKueryForUpdatingAgents();case"inactive":return C.a.buildKueryForInactiveAgents();case"unenrolled":return C.a.buildKueryForUnenrolledAgents()}})).filter((e=>void 0!==e)).join(" or ");i=i?`(${i}) and (${e})`:e}return i.trim()},Je=()=>(new Date).toISOString().substring(0,10);var Ze=a(96),Xe=a.n(Ze);const et="logs-elastic_agent-*,logs-elastic_agent.*-*",tt="elastic_agent",at="elastic_agent.id",lt={name:D.r,type:"string",aggregatable:!0,searchable:!0},nt="log.level",it="now-1d",st="now",rt={start:it,end:st,logLevels:[],datasets:[tt],query:""},ot="datasets",ct={ERROR:"error",WARNING:"warning",INFO:"info",DEBUG:"debug"},ut=ct.INFO,dt=({agentId:e,datasets:t,logLevels:a,userQuery:l})=>{const n=`${at}:${e}`,i=t.length?t.map((e=>`${lt.name}:${e}`)).join(" or "):`${lt.name}:${tt} or ${lt.name}:elastic_agent.*`,s=a.map((e=>`${nt}:${e}`)).join(" or "),r=`${n} and (${i})`,o=s?`${r} and (${s})`:r;return l?`(${o}) and (${l})`:o};var gt=a(474),mt=a.n(gt),pt=a(249),Et=a(102);const ft=({viewInLogs:e,logStreamQuery:t,startTime:a,endTime:i})=>{const{http:s}=Object(c.lc)(),r=Object(l.useMemo)((()=>s.basePath.prepend(mt.a.format({pathname:"/app/logs/stream",search:Object(pt.stringify)({logPosition:Object(Et.encode)({start:a,end:i,streamLive:!1}),logFilter:Object(Et.encode)({expression:t,kind:"kuery"})})}))),[s.basePath,a,i,t]),o=Object(l.useMemo)((()=>{const e=Object(Et.encode)({query:t,language:"kuery"});return s.basePath.prepend(`/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:60000),time:(from:'${a}',to:'${i}'))&_a=(columns:!(event.dataset,message),index:'logs-*',query:${e})`)}),[t,s.basePath,a,i]);return e?n.a.createElement(u.EuiButton,{href:r,iconType:"popout","data-test-subj":"viewInLogsBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.openInLogsUiLinkText",defaultMessage:"Open in Logs"})):n.a.createElement(u.EuiButton,{href:o,iconType:"popout","data-test-subj":"viewInDiscoverBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.openInDiscoverUiLinkText",defaultMessage:"Open in Discover"}))},bt=p()(u.EuiText).withConfig({displayName:"TruncatedEuiText",componentId:"sc-1ioa7tn-0"})(["overflow:hidden;max-height:3rem;text-overflow:ellipsis;"]),ht=({action:e})=>{var t,a;const l=Object(c.lc)(),i=!(null!==(t=l.cloud)&&void 0!==t&&t.isServerlessEnabled),s=[{field:"hostname",name:g.i18n.translate("xpack.fleet.agentList.viewErrors.hostnameColumnTitle",{defaultMessage:"Host Name"}),render:e=>n.a.createElement(u.EuiText,{size:"s","data-test-subj":"hostText"},e)},{field:"error",name:g.i18n.translate("xpack.fleet.agentList.viewErrors.errorColumnTitle",{defaultMessage:"Error Message"}),render:e=>n.a.createElement(u.EuiToolTip,{content:e},n.a.createElement(bt,{size:"s",color:"red","data-test-subj":"errorText"},e))},{field:"agentId",name:g.i18n.translate("xpack.fleet.agentList.viewErrors.actionColumnTitle",{defaultMessage:"Action"}),render:t=>{var a;const s=(null!==(a=e.latestErrors)&&void 0!==a?a:[]).find((e=>e.agentId===t));return n.a.createElement(k.a,{coreStart:l},((e,t,a)=>{const l=Xe()(t).subtract(5,"m").toISOString(),i=Xe()(t).add(5,"m").toISOString(),s=dt({agentId:e,datasets:["elastic_agent"],logLevels:["error"],userQuery:""});return n.a.createElement(ft,{viewInLogs:a,logStreamQuery:s,startTime:l,endTime:i})})(t,s.timestamp,!!i))}}];return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiAccordion,{id:e.actionId+"_errors",buttonContent:"Show errors"},n.a.createElement(u.EuiBasicTable,{items:null!==(a=e.latestErrors)&&void 0!==a?a:[],columns:s,tableLayout:"auto"})))},yt=p()(u.EuiFlyoutBody).withConfig({displayName:"FullHeightFlyoutBody",componentId:"sc-1uu095g-0"})([".euiFlyoutBody__overflowContent{height:100%;}"]),kt=p()(u.EuiFlyoutFooter).withConfig({displayName:"FlyoutFooterWPadding",componentId:"sc-1uu095g-1"})(["padding:16px 24px !important;"]),vt=1e3,xt=({onClose:e,onAbortSuccess:t,refreshAgentActivity:a,setSearch:i,setSelectedStatus:s})=>{const{notifications:r}=Object(c.lc)(),{data:o}=Object(c.Ib)({perPage:M.p}),{currentActions:m,abortUpgrade:p,isFirstLoading:E}=function(e,t){const[a,n]=Object(l.useState)([]),[i,s]=Object(l.useState)(!0),{notifications:r,overlays:o}=Object(c.lc)(),u=Object(l.useCallback)((async()=>{try{const e=await Object(c.u)();if(s(!1),e.error)throw e.error;if(!e.data)throw new Error("No data");n(e.data.items)}catch(e){r.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.actionStatus.fetchRequestError",{defaultMessage:"An error happened while fetching action status"})})}}),[r.toasts]);i&&u(),Object(l.useEffect)((()=>(t&&u(),()=>{n([]),s(!0)})),[u,t]);const d=Object(l.useCallback)((async t=>{try{if(!await o.openConfirm(g.i18n.translate("xpack.fleet.currentUpgrade.confirmDescription",{defaultMessage:"This action will cancel upgrade of {nbAgents, plural, one {# agent} other {# agents}}",values:{nbAgents:t.nbAgentsActioned-t.nbAgentsAck}}),{title:g.i18n.translate("xpack.fleet.currentUpgrade.confirmTitle",{defaultMessage:"Cancel upgrade?"})}))return;await Object(c.W)(t.actionId),await Promise.all([u(),e()])}catch(e){r.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.currentUpgrade.abortRequestError",{defaultMessage:"An error happened while cancelling upgrade"})})}}),[u,r.toasts,o,e]);return{currentActions:a,refreshActions:u,abortUpgrade:d,isFirstLoading:i}}(t,a),f=e=>{var t;const a=null==o?void 0:o.items.find((t=>t.id===e));return null!==(t=null==a?void 0:a.name)&&void 0!==t?t:e},b=m.map((e=>{var t,a;return{...e,newPolicyId:f(null!==(t=e.newPolicyId)&&void 0!==t?t:""),policyId:f(null!==(a=e.policyId)&&void 0!==a?a:"")}})),h=b.filter((e=>"IN_PROGRESS"===e.status)),y=b.filter((e=>"IN_PROGRESS"!==e.status)),k=y.filter((e=>e.creationTime.startsWith(Je()))),v=function(e){const t={};return e.filter((e=>!e.creationTime.startsWith(Je()))).forEach((e=>{const a=e.creationTime.substring(0,10);t[a]||(t[a]=[]),t[a].push(e)})),t}(y),x=async t=>{try{var a;const{data:l}=await Object(c.eb)({actionIds:[t.actionId]});if(null!=l&&null!==(a=l.items)&&void 0!==a&&a.length){const e=Ye({selectedAgentIds:l.items});i(e)}s(pe),e()}catch(e){r.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.agentActivityFlyout.error",{defaultMessage:"Error viewing selected agents"})})}};return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlyout,{"data-test-subj":"agentActivityFlyout",onClose:e,size:"m",paddingSize:"none"},n.a.createElement(u.EuiFlyoutHeader,{"aria-labelledby":"FleetAgentActivityFlyoutTitle"},n.a.createElement(u.EuiPanel,{borderRadius:"none",hasShadow:!1,hasBorder:!0},n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"m"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiTitle,{size:"l"},n.a.createElement("h1",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.title",defaultMessage:"Agent activity"})))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.activityLogText",defaultMessage:"Activity log of Elastic Agent operations will appear here."}))))))),n.a.createElement(yt,null,E?n.a.createElement(u.EuiFlexGroup,{direction:"row",justifyContent:"center",alignItems:"center",className:"eui-fullHeight"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(oe.j,null))):0===b.length?n.a.createElement(u.EuiFlexGroup,{direction:"column",justifyContent:"center",alignItems:"center",className:"eui-fullHeight"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiEmptyPrompt,{iconType:"clock",iconColor:"default",title:n.a.createElement("h2",null," ",n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.noActivityText",defaultMessage:"No activity to display"})),titleSize:"m",body:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.noActivityDescription",defaultMessage:"Activity feed will appear here as agents are reassigned, upgraded, or unenrolled."})}))):null,h.length>0?n.a.createElement(Ft,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.inProgressTitle",defaultMessage:"In progress"}),actions:h,abortUpgrade:p,onClickViewAgents:x}):null,k.length>0?n.a.createElement(Ft,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.todayTitle",defaultMessage:"Today"}),actions:k,abortUpgrade:p,onClickViewAgents:x}):null,Object.keys(v).map((e=>n.a.createElement(Ft,{key:e,title:n.a.createElement(d.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"}),actions:v[e],abortUpgrade:p,onClickViewAgents:x})))),n.a.createElement(kt,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexStart"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:e},n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.closeBtn",defaultMessage:"Close"}))))))))},Ft=({title:e,actions:t,abortUpgrade:a,onClickViewAgents:l})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiPanel,{color:"subdued",hasBorder:!0,borderRadius:"none"},n.a.createElement(u.EuiText,null,n.a.createElement("b",null,e))),t.map((e=>"UPGRADE"===e.type&&"IN_PROGRESS"===e.status?n.a.createElement(Ct,{action:e,abortUpgrade:a,key:e.actionId,onClickViewAgents:l}):n.a.createElement(jt,{action:e,key:e.actionId,onClickViewAgents:l})))),Mt={POLICY_REASSIGN:{inProgressText:"Reassigning",completedText:"assigned to a new policy",cancelledText:"assignment"},UPGRADE:{inProgressText:"Upgrading",completedText:"upgraded",cancelledText:"upgrade"},UNENROLL:{inProgressText:"Unenrolling",completedText:"unenrolled",cancelledText:"unenrollment"},FORCE_UNENROLL:{inProgressText:"Force unenrolling",completedText:"force unenrolled",cancelledText:"force unenrollment"},UPDATE_TAGS:{inProgressText:"Updating tags of",completedText:"updated tags",cancelledText:"update tags"},CANCEL:{inProgressText:"Cancelling",completedText:"cancelled",cancelledText:""},REQUEST_DIAGNOSTICS:{inProgressText:"Requesting diagnostics for",completedText:"requested diagnostics",cancelledText:"request diagnostics"},SETTINGS:{inProgressText:"Updating settings of",completedText:"updated settings",cancelledText:"update settings"},POLICY_CHANGE:{inProgressText:"Applying policy change on",completedText:"applied policy change",cancelledText:"policy change"},INPUT_ACTION:{inProgressText:"Input action in progress of",completedText:"input action completed",cancelledText:"input action"},ACTION:{inProgressText:"Actioning",completedText:"actioned",cancelledText:"action"}},St=e=>{var t;return null!==(t=Mt[null!=e?e:"ACTION"])&&void 0!==t?t:Mt.ACTION},It="#0077CC",Tt=e=>e?n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedDate,{value:e,year:"numeric",month:"short",day:"2-digit"})," ",n.a.createElement(d.FormattedTime,{value:e})):null,Ot=e=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivity.inProgressTitle",defaultMessage:"{inProgressText} {nbAgents} {agents} {reassignText}{upgradeText}{failuresText}",values:{nbAgents:e.nbAgentsAck>=e.nbAgentsActioned?e.nbAgentsAck:0===e.nbAgentsAck?e.nbAgentsActioned:e.nbAgentsActioned-e.nbAgentsAck+" of "+e.nbAgentsActioned,agents:1===e.nbAgentsActioned?"agent":"agents",inProgressText:St(e.type).inProgressText,reassignText:"POLICY_REASSIGN"===e.type&&e.newPolicyId?`to ${e.newPolicyId}`:"",upgradeText:"UPGRADE"===e.type?`to version ${e.version}`:"",failuresText:e.nbAgentsFailed>0?`, has ${e.nbAgentsFailed} failure(s)`:""}}),wt=e=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.startedDescription",defaultMessage:"Started on {date}.",values:{date:Tt(e)}}),jt=({action:e,onClickViewAgents:t})=>{const a="POLICY_CHANGE"===e.type&&0===e.nbAgentsActioned?n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivity.policyChangeCompletedTitle",defaultMessage:"Policy changed"})):n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivity.completedTitle",defaultMessage:"{nbAgents} {agents} {completedText}{offlineText}",values:{nbAgents:e.nbAgentsAck===e.nbAgentsActioned?e.nbAgentsAck:e.nbAgentsAck+" of "+e.nbAgentsActioned,agents:1===e.nbAgentsActioned?"agent":"agents",completedText:St(e.type).completedText,offlineText:"ROLLOUT_PASSED"===e.status&&e.nbAgentsActioned-e.nbAgentsAck>0?`, ${e.nbAgentsActioned-e.nbAgentsAck} agent(s) offline during the rollout period`:""}})),l=n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.completedDescription",defaultMessage:"Completed {date}",values:{date:Tt(e.completionTime)}}),i=n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.failureDescription",defaultMessage:"A problem occurred during this operation."})," ",wt(e.creationTime))),s={IN_PROGRESS:{icon:n.a.createElement(u.EuiLoadingSpinner,{size:"m"}),title:n.a.createElement(u.EuiText,null,Ot(e)),titleColor:It,description:n.a.createElement(u.EuiText,{color:"subdued"},wt(e.creationTime))},ROLLOUT_PASSED:{icon:e.nbAgentsFailed>0?n.a.createElement(u.EuiIcon,{size:"m",type:"warning",color:"red"}):n.a.createElement(u.EuiIcon,{size:"m",type:"checkInCircleFilled",color:"green"}),title:a,titleColor:e.nbAgentsFailed>0?"red":"green",description:e.nbAgentsFailed>0?i:n.a.createElement(u.EuiText,{color:"subdued"},l)},COMPLETE:{icon:n.a.createElement(u.EuiIcon,{size:"m",type:"checkInCircleFilled",color:"green"}),title:a,titleColor:"green",description:"POLICY_REASSIGN"===e.type&&e.newPolicyId?n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.reassignCompletedDescription",defaultMessage:"Assigned to {policy}.",values:{policy:e.newPolicyId}})," ",l)):"POLICY_CHANGE"===e.type?n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement("p",null,n.a.createElement("b",null,e.policyId)," ",n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.policyChangedDescription",defaultMessage:"changed to revision {rev} at {date}.",values:{rev:e.revision,date:Tt(e.creationTime)}}))):n.a.createElement(u.EuiText,{color:"subdued"},l)},FAILED:{icon:n.a.createElement(u.EuiIcon,{size:"m",type:"warning",color:"red"}),title:a,titleColor:"red",description:i},CANCELLED:{icon:n.a.createElement(u.EuiIcon,{size:"m",type:"warning",color:"grey"}),titleColor:"grey",title:n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.cancelledTitle",defaultMessage:"Agent {cancelledText} cancelled",values:{cancelledText:St(e.type).cancelledText}})),description:n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.cancelledDescription",defaultMessage:"Cancelled on {date}",values:{date:Tt(e.cancellationTime)}}))},EXPIRED:{icon:n.a.createElement(u.EuiIcon,{size:"m",type:"warning",color:"grey"}),titleColor:"grey",title:n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.expiredTitle",defaultMessage:"Agent {expiredText} expired",values:{expiredText:St(e.type).cancelledText}})),description:n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.expiredDescription",defaultMessage:"Expired on {date}",values:{date:Tt(e.expiration)}}))}};return n.a.createElement(u.EuiPanel,{hasBorder:!0,borderRadius:"none"},n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"m"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},s[e.status].icon),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{color:s[e.status].titleColor,"data-test-subj":"statusTitle"},s[e.status].title)))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"statusDescription"},s[e.status].description)),n.a.createElement(u.EuiFlexItem,{grow:!1},"FAILED"===e.status&&e.latestErrors&&e.latestErrors.length>0?n.a.createElement(ht,{action:e}):null)),n.a.createElement(u.EuiSpacer,{size:"xs"}),n.a.createElement(Pt,{action:e,onClickViewAgents:t}))},Ct=({action:e,abortUpgrade:t,onClickViewAgents:a})=>{const{docLinks:i}=Object(c.lc)(),[s,r]=Object(l.useState)(!1),o=Object(l.useCallback)((async()=>{try{r(!0),await t(e)}finally{r(!1)}}),[e,t]),g=Object(l.useMemo)((()=>{if(!e.startTime)return!1;const t=Date.now();return new Date(e.startTime).getTime()>t}),[e]),m=Object(l.useMemo)((()=>g||e.hasRolloutPeriod),[e,g]);return n.a.createElement(u.EuiPanel,{hasBorder:!0,borderRadius:"none"},n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"m"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFlexGroup,{direction:"row",gutterSize:"m",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},g?n.a.createElement(u.EuiIcon,{type:"clock"}):n.a.createElement(u.EuiLoadingSpinner,{size:"m"})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{color:It,"data-test-subj":"upgradeInProgressTitle"},g&&e.startTime?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.scheduleTitle",defaultMessage:"{nbAgents} agents scheduled to upgrade to version {version}",values:{nbAgents:e.nbAgentsActioned-e.nbAgentsAck,version:e.version}}):Ot(e))))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFlexGroup,{direction:"column",alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"upgradeInProgressDescription"},n.a.createElement("p",null,g&&e.startTime?n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.scheduledDescription",defaultMessage:"Scheduled for "}),n.a.createElement("strong",null,Tt(e.startTime)),". "):n.a.createElement(n.a.Fragment,null,wt(e.creationTime)," "),n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.upgradeDescription",defaultMessage:"{guideLink} about agent upgrades.",values:{guideLink:n.a.createElement(u.EuiLink,{href:i.links.fleet.upgradeElasticAgent,target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.guideLink",defaultMessage:"Learn more"}))}})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Pt,{action:e,onClickViewAgents:a})),n.a.createElement(u.EuiFlexItem,{grow:!1},m?n.a.createElement(u.EuiButton,{size:"s",onClick:o,isLoading:s,"data-test-subj":"abortBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.abortUpgradeButtom",defaultMessage:"Cancel"})):null)))))},Pt=({action:e,onClickViewAgents:t})=>{if("UPDATE_TAGS"===e.type)return null;const a=n.a.createElement(u.EuiButtonEmpty,{size:"m",onClick:()=>t(e),flush:"left","data-test-subj":"agentActivityFlyout.viewAgentsButton",disabled:e.nbAgentsActionCreated>vt},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.viewAgentsButton",defaultMessage:"View Agents"}));return e.nbAgentsActionCreated<=vt?a:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentActivityFlyout.viewAgentsButtonDisabledMaxTooltip",defaultMessage:"The view agents feature is only available for action impacting less then {agentCount} agents",values:{agentCount:vt}})},a)},At=()=>{var e,t;const a=Object(c.zb)();return n.a.createElement(u.EuiCallOut,{iconType:"warning",color:"warning",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentSoftLimitCallout.calloutTitle",defaultMessage:"Max number of online agents reached"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentSoftLimitCallout.calloutDescription",defaultMessage:"Fleet supports a maximum of {nbAgents} active agents. You need to unenroll some agents to ensure that all active agents are able to connect and new agents can be enrolled.",values:{nbAgents:n.a.createElement(d.FormattedNumber,{value:null!==(e=null===(t=a.internal)||void 0===t?void 0:t.activeAgentsSoftLimit)&&void 0!==e?e:25e3})}}))};var Lt=a(56);const _t=({agent:e,agentPolicy:t,onReassignClick:a,onUnenrollClick:i,onGetUninstallCommandClick:s,onUpgradeClick:r,onAddRemoveTagsClick:o,onRequestDiagnosticsClick:g})=>{const{getHref:m}=Object(c.cc)(),p=Object(c.vb)().fleet.all,E="unenrolling"===e.status,f=Object(c.ub)(),[b,h]=Object(l.useState)(!1),{diagnosticFileUploadEnabled:y,agentTamperProtectionEnabled:k}=C.b.get(),v=[n.a.createElement(u.EuiContextMenuItem,{icon:"inspect",href:m("agent_details",{agentId:e.id}),key:"viewAgent"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.viewActionText",defaultMessage:"View agent"}))];return!1===(null==t?void 0:t.is_managed)&&(v.push(n.a.createElement(u.EuiContextMenuItem,{icon:"tag",onClick:e=>{o(e.target.closest("button"))},disabled:!e.active,key:"addRemoveTags"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.addRemoveTagsActionText",defaultMessage:"Add / remove tags"})),n.a.createElement(u.EuiContextMenuItem,{icon:"pencil",onClick:()=>{a()},disabled:!e.active,key:"reassignPolicy"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),n.a.createElement(u.EuiContextMenuItem,{key:"agentUnenrollBtn",disabled:!p||!e.active,icon:"trash",onClick:()=>{i()}},E?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),n.a.createElement(u.EuiContextMenuItem,{key:"agentUpgradeBtn",icon:"refresh",disabled:!!f&&!Object(C.m)(e,f),onClick:()=>{r()},"data-test-subj":"upgradeBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),Object(Lt.isStuckInUpdating)(e)&&v.push(n.a.createElement(u.EuiContextMenuItem,{key:"agentRestartUpgradeBtn",icon:"refresh",onClick:()=>{r()},"data-test-subj":"restartUpgradeBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.restartUpgradeOneButton",defaultMessage:"Restart upgrade"}))),k&&e.policy_id&&v.push(n.a.createElement(u.EuiContextMenuItem,{icon:"minusInCircle",onClick:()=>{s(),h(!1)},disabled:!e.active,key:"getUninstallCommand","data-test-subj":"uninstallAgentMenuItem"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.getUninstallCommand",defaultMessage:"Uninstall agent"})))),y&&v.push(n.a.createElement(u.EuiContextMenuItem,{key:"requestAgentDiagnosticsBtn",icon:"download","data-test-subj":"requestAgentDiagnosticsBtn",disabled:!p||!Object(re.I)(e),onClick:()=>{g()}},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}))),n.a.createElement(F.h,{isOpen:b,onChange:e=>h(e),items:v})},Dt=p.a.div.withConfig({displayName:"Wrapped",componentId:"sc-rnfjm9-0"})(["display:flex;.wrappedText{white-space:pre-wrap;}"]),Bt=({tags:e,color:t,size:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(Dt,null,n.a.createElement(u.EuiToolTip,{anchorClassName:"wrappedText",content:n.a.createElement("span",{"data-test-subj":"agentTagsTooltip"},e.join(", "))},n.a.createElement(u.EuiText,{size:a,color:t},n.a.createElement("span",{"data-test-subj":"agentTags"},Object(W.take)(e,3).map(Te).join(", "),e.length>3?` + ${e.length-3} more`:"")))));function Rt(e,t){return void 0!==(null==e?void 0:e.cpu_avg)?n.a.createElement(u.EuiToolTip,{content:`${(100*e.cpu_avg).toFixed(4)} %`},n.a.createElement(n.a.Fragment,null,(100*e.cpu_avg).toFixed(2)," %")):n.a.createElement(oe.k,{agentPolicy:t})}function zt(e,t){return null!=e&&e.memory_size_byte_avg?function(e,t=0){if(0===e)return"0 Bytes";const a=t<0?0:t,l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(a))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][l]}(e.memory_size_byte_avg):n.a.createElement(oe.k,{agentPolicy:t})}function Nt(e){const t=Date.parse(e||"")-Date.now();return t<0?"":t<9e5?" The upgrade will start in less than 15 minutes.":t<18e5?" The upgrade will start in less than 30 minutes.":t<36e5?" The upgrade will start in less than 1 hour.":` The upgrade will start in less than ${Math.ceil(t/36e5)} hours.`}function Ut(e){if(!e||void 0===e.download_percent&&void 0===e.download_rate)return"";let t="";return void 0!==e.download_percent&&(t=`${e.download_percent}%`),void 0!==e.download_rate&&(t+=` at ${Ht(e.download_rate)}`),` (${t.trim()})`}const Ht=e=>{let t=0;const a=[" Bps"," kBps"," MBps"," GBps"];for(;t<a.length-1&&!(e<1024);t++)e/=1024;return e.toFixed(1)+a[t]},qt=({isAgentUpgradable:e,agentUpgradeStartedAt:t,agentUpgradedAt:a,agentUpgradeDetails:i})=>{const s=Object(l.useMemo)((()=>t&&!a),[t,a]),r=Object(l.useMemo)((()=>function(e){var t,a;switch(null==e?void 0:e.state){case"UPG_REQUESTED":return{Badge:n.a.createElement(u.EuiBadge,{color:"accent",iconType:"calendar"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeRequested",defaultMessage:"Upgrade requested"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeRequested",defaultMessage:"The agent has requested an upgrade."})};case"UPG_SCHEDULED":return{Badge:n.a.createElement(u.EuiBadge,{color:"accent",iconType:"clock"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeScheduled",defaultMessage:"Upgrade scheduled"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeScheduled",defaultMessage:"The agent has been instructed to upgrade.{upgradeStartDelay}",values:{upgradeStartDelay:Nt(null===(t=e.metadata)||void 0===t?void 0:t.scheduled_at)}})};case"UPG_DOWNLOADING":return{Badge:n.a.createElement(u.EuiBadge,{color:"accent",iconType:"download"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeDownloading",defaultMessage:"Upgrade downloading"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeDownloading",defaultMessage:"Downloading the new agent artifact version{downloadEstimate}.",values:{downloadEstimate:Ut(null==e?void 0:e.metadata)}})};case"UPG_EXTRACTING":return{Badge:n.a.createElement(u.EuiBadge,{color:"accent",iconType:"package"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeExtracting",defaultMessage:"Upgrade extracting"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeExtracting",defaultMessage:"The new agent artifact is extracting."})};case"UPG_REPLACING":return{Badge:n.a.createElement(u.EuiBadge,{color:"warning",iconType:"copy"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeReplacing",defaultMessage:"Upgrade replacing"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeReplacing",defaultMessage:"Replacing the agent artifact version."})};case"UPG_RESTARTING":return{Badge:n.a.createElement(u.EuiBadge,{color:"warning",iconType:"refresh"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeRestarting",defaultMessage:"Upgrade restarting"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeRestarting",defaultMessage:"The agent is restarting to apply the update."})};case"UPG_WATCHING":return{Badge:n.a.createElement(u.EuiBadge,{color:"warning",iconType:"inspect"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeMonitoring",defaultMessage:"Upgrade monitoring"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeMonitoring",defaultMessage:"Monitoring the new agent version for errors."})};case"UPG_ROLLBACK":return{Badge:n.a.createElement(u.EuiBadge,{color:"danger",iconType:"returnKey"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeRolledBack",defaultMessage:"Upgrade rolled back"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeRolledBack",defaultMessage:"Upgrade unsuccessful. Rolling back to previous version."})};case"UPG_FAILED":return{Badge:n.a.createElement(u.EuiBadge,{color:"danger",iconType:"error"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeFailed",defaultMessage:"Upgrade failed"})),TooltipText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeFailed",defaultMessage:"Upgrade failed: {errorMsg}.",values:{errorMsg:null==e||null===(a=e.metadata)||void 0===a?void 0:a.error_msg}})};default:return null}}(i)),[i]);return e?n.a.createElement(u.EuiBadge,{color:"hollow",iconType:"sortUp"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusBadge.upgradeAvailable",defaultMessage:"Upgrade available"})):i&&r?n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},n.a.createElement(u.EuiFlexItem,{grow:!1},r.Badge),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIconTip,{type:"iInCircle",content:r.TooltipText,color:"subdued"}))):s?n.a.createElement(u.EuiIconTip,{type:"iInCircle",content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentUpgradeStatusTooltip.upgradeDetailsNotAvailable",defaultMessage:"Detailed upgrade status is available for Elastic Agents on version {minVersion} and higher.",values:{minVersion:"8.12"}}),color:"subdued"}):null},Gt=({hasFleetAllPrivileges:e,setEnrollmentFlyoutState:t})=>n.a.createElement(u.EuiEmptyPrompt,{title:n.a.createElement("h2",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.noAgentsPrompt",defaultMessage:"No agents enrolled"})),actions:e?n.a.createElement(u.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>t({isOpen:!0})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.addButton",defaultMessage:"Add agent"})):null});function Wt(e){return"string"!=typeof e?"-":e}const Kt=e=>{const{agents:t,isLoading:a,agentPoliciesIndexedById:l,renderActions:i,sortField:s,sortOrder:r,tableRef:o,onTableChange:m,onSelectionChange:p,totalAgents:E=0,showUpgradeable:f,pagination:b,pageSizeOptions:h,isUsingFilter:y,setEnrollmentFlyoutState:k,clearFilters:v,isCurrentRequestIncremented:x}=e,M=Object(c.vb)().fleet.all,{displayAgentMetrics:S}=C.b.get(),{getHref:I}=Object(c.cc)(),T=Object(c.ub)(),O=e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=l[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))},w=a&&x?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.loadingAgentsMessage",defaultMessage:"Loading agents…"}):y?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.noFilteredAgentsPrompt",defaultMessage:"No agents found. {clearFiltersLink}",values:{clearFiltersLink:n.a.createElement(u.EuiLink,{onClick:()=>v()},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.clearFiltersLinkText",defaultMessage:"Clear filters"}))}}):n.a.createElement(Gt,{hasFleetAllPrivileges:M,setEnrollmentFlyoutState:k}),j={sort:{field:s,direction:r}},P=[{field:"active",sortable:!1,width:"85px",name:g.i18n.translate("xpack.fleet.agentList.statusColumnTitle",{defaultMessage:"Status"}),render:(e,t)=>n.a.createElement(oe.a,{agent:t})},{field:"local_metadata.host.hostname",sortable:!0,name:g.i18n.translate("xpack.fleet.agentList.hostColumnTitle",{defaultMessage:"Host"}),width:"185px",render:(e,t)=>{var a;return n.a.createElement(u.EuiFlexGroup,{gutterSize:"none",direction:"column"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiLink,{href:I("agent_details",{agentId:t.id})},Wt(e))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Bt,{tags:null!==(a=t.tags)&&void 0!==a?a:[],color:"subdued",size:"xs"})))}},{field:"policy_id",sortable:!0,truncateText:!0,name:g.i18n.translate("xpack.fleet.agentList.policyColumnTitle",{defaultMessage:"Agent policy"}),width:"185px",render:(e,t)=>{const a=l[e],i=t.policy_revision&&(null==a?void 0:a.revision)>t.policy_revision;return n.a.createElement(u.EuiFlexGroup,{gutterSize:"m",style:{minWidth:0},alignItems:"center"},a&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(F.f,{direction:"column",policy:a,agent:t})),i&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiText,{color:"subdued",size:"xs",className:"eui-textNoWrap"},n.a.createElement(u.EuiIcon,{size:"m",type:"warning",color:"warning"})," ",n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.outOfDateLabel",defaultMessage:"Outdated policy"}))))}},...S?[{field:"metrics",sortable:!1,name:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.cpuTooltip",defaultMessage:"Average CPU usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.cpuTitle",defaultMessage:"CPU"})," ",n.a.createElement(u.EuiIcon,{type:"iInCircle"}))),width:"75px",render:(e,t)=>Rt(t.metrics,t.policy_id?l[t.policy_id]:void 0)},{field:"metrics",sortable:!1,name:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.memoryTooltip",defaultMessage:"Average memory usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.memoryTitle",defaultMessage:"Memory"})," ",n.a.createElement(u.EuiIcon,{type:"iInCircle"}))),width:"90px",render:(e,t)=>zt(t.metrics,t.policy_id?l[t.policy_id]:void 0)}]:[],{field:"last_checkin",sortable:!0,name:g.i18n.translate("xpack.fleet.agentList.lastCheckinTitle",{defaultMessage:"Last activity"}),width:"180px",render:(e,t)=>e?n.a.createElement(d.FormattedRelative,{value:e}):null},{field:"local_metadata.elastic.agent.version",sortable:!0,width:"180px",name:g.i18n.translate("xpack.fleet.agentList.versionTitle",{defaultMessage:"Version"}),render:(e,t)=>n.a.createElement(u.EuiFlexGroup,{gutterSize:"none",style:{minWidth:0},direction:"column"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiText,{size:"s",className:"eui-textNoWrap"},Wt(e))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(qt,{isAgentUpgradable:!!(O(t)&&T&&Object(C.m)(t,T)),agentUpgradeStartedAt:t.upgrade_started_at,agentUpgradedAt:t.upgraded_at,agentUpgradeDetails:t.upgrade_details})))))},{name:g.i18n.translate("xpack.fleet.agentList.actionsColumnTitle",{defaultMessage:"Actions"}),actions:[{render:i}],width:"100px"}];return n.a.createElement(u.EuiBasicTable,{ref:o,className:"fleet__agentList__table","data-test-subj":"fleetAgentListTable",loading:a,hasActions:!0,noItemsMessage:w,items:E?f?t.filter((e=>O(e)&&T&&Object(C.m)(e,T))):t:[],itemId:"id",columns:P,pagination:{pageIndex:b.currentPage-1,pageSize:b.pageSize,totalItemCount:E,pageSizeOptions:h},isSelectable:!0,selection:{onSelectionChange:p,selectable:O,selectableMessage:(e,t)=>e?"":t.active?t.policy_id&&l[t.policy_id].is_managed?"This action is not available for agents enrolled in an externally managed agent policy":"":"This agent is not active"},onChange:m,sorting:j})},$t=()=>{var e;const{displayAgentMetrics:t}=C.b.get(),{notifications:a,cloud:i}=Object(c.lc)();Object(c.wb)("agent_list");const s=Object(c.pc)().urlParams.kuery||"",[r,o]=Object(l.useState)(!1),[d,m]=Object(l.useState)(s),[p,E]=Object(l.useState)(s),[f,h]=Object(l.useState)("manual"),[y,k]=Object(l.useState)([]),v=Object(l.useRef)(null),{pagination:x,pageSizeOptions:S,setPagination:I}=Object(c.ec)(),[T,O]=Object(l.useState)("enrolled_at"),[w,j]=Object(l.useState)("desc"),P="local_metadata.elastic.agent.version",A="local_metadata.host.hostname",L=Object(l.useCallback)((e=>{E(e),I({...x,currentPage:1})}),[E,x,I]),[_,D]=Object(l.useState)([]),[B,R]=Object(l.useState)(["healthy","unhealthy","updating","offline"]),[z,N]=Object(l.useState)([]),U=!!(p.trim()||_.length||B.length||z.length||r),H=Object(l.useCallback)((()=>{m(""),E(""),D([]),R([]),N([]),o(!1)}),[E,m,D,R,o]),[q,G]=Object(l.useState)({isOpen:!1}),[K,$]=Object(l.useState)(!1),V=Object(c.Hb)(),[Q,Y]=Object(l.useState)(void 0),[J,Z]=Object(l.useState)(void 0),[X,ee]=Object(l.useState)(void 0),[te,ae]=Object(l.useState)(void 0),[le,ne]=Object(l.useState)(void 0),[ie,se]=Object(l.useState)(),[de,ge]=Object(l.useState)(!1),[me,pe]=Object(l.useState)(void 0),Ee=Object(l.useMemo)((()=>B.some((e=>"inactive"===e||"unenrolled"===e))),[B]),fe=Object(l.useMemo)((()=>Ye({search:p,selectedAgentPolicies:_,selectedTags:z,selectedStatus:B})),[p,_,B,z]),[be,he]=Object(l.useState)([]),[ye,ke]=Object(l.useState)(),[ve,xe]=Object(l.useState)(),[Fe,Se]=Object(l.useState)(!1),[Ie,Te]=Object(l.useState)(0),[Oe,we]=Object(l.useState)(0),[je,Ce]=Object(l.useState)(0),[Le,_e]=Object(l.useState)([]),[Be,Re]=Object(l.useState)([]),[ze,Ne]=Object(l.useState)(0),[Ue,He]=Object(l.useState)({isOpen:!1}),qe=Object(l.useRef)(!1),Ge=Object(l.useRef)(0),We=Object(l.useCallback)((({refreshTags:e=!1}={})=>{!async function(){if(qe.current)return;Ge.current++;const l=Ge.current;qe.current=!0;try{var n,i;Se(!0);const[a,d,g,m]=await Promise.all([Object(c.z)({page:x.currentPage,perPage:x.pageSize,kuery:fe&&""!==fe?fe:void 0,sortField:(u=T,[P,A].includes(u)?`${u}.keyword`:u),sortOrder:w,showInactive:Ee,showUpgradeable:r,getStatusSummary:!0,withMetrics:t}),Object(c.w)({kuery:C.a.buildKueryForInactiveAgents()}),Object(c.v)({kuery:`${M.c}.is_managed:true`,perPage:M.p,full:!1}),Object(c.x)({kuery:fe&&""!==fe?fe:void 0,showInactive:Ee})]);if(qe.current=!1,Ge.current!==l)return;if(a.error)throw a.error;if(!a.data)throw new Error("Invalid GET /agents response");if(!d.data)throw new Error("Invalid GET /agents_status response");if(g.error)throw new Error(g.error.message);if(m.error)throw m.error;if(!m.data)throw new Error("Invalid GET /agent/tags response");const p=a.data.statusSummary;if(!p)throw new Error("Invalid GET /agents response - no status summary");ke(Object(re.h)(p));const E=m.data.items;ve&&!e&&Object(W.isEqual)(E,ve)||xe(E),he(a.data.items),Te(a.data.total),Ce(d.data.results.inactive||0),we(Ee&&d.data.results.inactive||0);const f=null!==(n=null===(i=g.data)||void 0===i?void 0:i.items)&&void 0!==n?n:[];if(0===f.length)_e([]),Ne(0);else{var s,o;const e=f.map((e=>`policy_id:"${e.id}"`)).join(" or "),t=await Object(c.z)({kuery:`NOT (status:unenrolled) and ${e}`,perPage:M.p,showInactive:!0});if(t.error)throw new Error(t.error.message);const l=null!==(s=null===(o=t.data)||void 0===o?void 0:o.items)&&void 0!==s?s:[],n=null==l?void 0:l.map((e=>e.id)),i=null==l?void 0:l.filter((e=>"inactive"===e.status)).map((e=>e.id));_e(n),Re(i),Ne(a.data.items.map((e=>e.id)).filter((e=>n.includes(e))).length)}}catch(e){a.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.agentList.errorFetchingDataTitle",{defaultMessage:"Error fetching agents"})})}var u;Se(!1)}()}),[x.currentPage,x.pageSize,fe,T,w,Ee,r,t,ve,a.toasts]);Object(l.useEffect)((()=>{We();const e=setInterval((()=>{We()}),3e4);return()=>clearInterval(e)}),[We]);const Ke=Object(c.Ib)({page:1,perPage:M.p,full:!0}),Ve=Object(l.useMemo)((()=>Ke.data?Ke.data.items:[]),[Ke]),Qe=Object(l.useMemo)((()=>Ve.reduce(((e,t)=>(e[t.id]=t,e)),{})),[Ve]),Je=Object(l.useCallback)((e=>{if(!e.active)return!1;if(!e.policy_id)return!0;const t=Qe[e.policy_id];return!(!0===(null==t?void 0:t.is_managed))}),[Qe]),Ze=Object(l.useMemo)((()=>{if(!J||!J.policy_id)return!1;const e=Qe[J.policy_id];return!!e&&Object(C.t)(e)}),[J,Qe]),[Xe,et]=(()=>{const{missingOptionalFeatures:e}=Object(c.Gb)(),{storage:t}=Object(c.lc)(),[a,n]=Object(l.useState)(!1);return Object(l.useEffect)((()=>{const e=t.get(Ae);e&&n(Boolean(e))}),[t]),[Object(l.useMemo)((()=>!(a||!e)&&e.includes("encrypted_saved_object_encryption_key_required")),[e,a]),Object(l.useCallback)((()=>{t.set(Ae,"true"),n(!0)}),[t])]})(),{isUnhealthy:tt}=Object(ce.a)(),{isFleetServerStandalone:at}=Object(c.Fb)(),lt=tt&&!at,{shouldDisplayAgentSoftLimit:nt}=function(){var e;const t=null===(e=Object(c.zb)().internal)||void 0===e?void 0:e.activeAgentsSoftLimit,{data:a}=Object(b.useQuery)(["fetch-total-online-agents"],Pe,{enabled:void 0!==t});return{shouldDisplayAgentSoftLimit:!(!t||!a)&&a>t}}(),it=Object(l.useCallback)((()=>{V.openFleetServerFlyout()}),[V]),st=Object(l.useCallback)((()=>{$(!0)}),[$]),rt=({refreshTags:e=!1}={})=>{We({refreshTags:e}),He({isOpen:!0})},ot=1===(null==Ge?void 0:Ge.current);return n.a.createElement(n.a.Fragment,null,K?n.a.createElement(u.EuiPortal,null,n.a.createElement(xt,{onAbortSuccess:We,onClose:()=>$(!1),refreshAgentActivity:Fe,setSearch:E,setSelectedStatus:R})):null,q.isOpen?n.a.createElement(u.EuiPortal,null,n.a.createElement(F.c,{agentPolicy:Ve.find((e=>e.id===q.selectedPolicyId)),onClose:()=>{G({isOpen:!1}),We(),Ke.resendRequest()}})):null,Q&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.c,{agents:[Q],onClose:()=>{Y(void 0),rt()}})),J&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.d,{agents:[J],agentCount:1,onClose:()=>{Z(void 0),rt({refreshTags:!0})},useForceUnenroll:"unenrolling"===J.status,hasFleetServer:Ze})),(null==X?void 0:X.policy_id)&&n.a.createElement(u.EuiPortal,null,n.a.createElement(F.y,{target:"agent",policyId:X.policy_id,onClose:()=>{ee(void 0),rt({refreshTags:!0})}})),te&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.e,{agents:[te],agentCount:1,onClose:()=>{ae(void 0),rt()},isUpdating:Boolean(te.upgrade_started_at&&!te.upgraded_at)})),me&&n.a.createElement(u.EuiPortal,null,n.a.createElement(ue,{agents:[me],agentCount:1,onClose:()=>{pe(void 0)}})),de&&n.a.createElement(De,{agentId:null==le?void 0:le.id,allTags:null!=ve?ve:[],selectedTags:null!==(e=null==le?void 0:le.tags)&&void 0!==e?e:[],button:ie,onTagsUpdated:()=>{rt()},onClosePopover:()=>{ge(!1)}}),lt&&n.a.createElement(n.a.Fragment,null,null!=i&&i.deploymentUrl?n.a.createElement(oe.g,{deploymentUrl:i.deploymentUrl}):n.a.createElement(oe.i,{onClickAddFleetServer:it}),n.a.createElement(u.EuiSpacer,{size:"l"})),Xe&&n.a.createElement(n.a.Fragment,null,n.a.createElement(oe.h,{onClickHandler:et}),n.a.createElement(u.EuiSpacer,{size:"l"})),nt&&n.a.createElement(n.a.Fragment,null,n.a.createElement(At,null),n.a.createElement(u.EuiSpacer,{size:"l"})),n.a.createElement($e,{agentPolicies:Ve,draftKuery:d,onDraftKueryChange:m,onSubmitSearch:L,selectedAgentPolicies:_,onSelectedAgentPoliciesChange:D,selectedStatus:B,onSelectedStatusChange:R,showUpgradeable:r,onShowUpgradeableChange:o,tags:null!=ve?ve:[],selectedTags:z,onSelectedTagsChange:N,shownAgents:Ie,inactiveShownAgents:Oe,totalInactiveAgents:je,totalManagedAgentIds:Le,inactiveManagedAgentIds:Be,selectionMode:f,currentQuery:fe,selectedAgents:y,refreshAgents:rt,onClickAddAgent:()=>G({isOpen:!0}),onClickAddFleetServer:it,visibleAgents:be,onClickAgentActivity:st,showAgentActivityTour:Ue}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Me,{showInactive:Ee,totalAgents:Ie,agentStatus:ye,selectableAgents:(null==be?void 0:be.filter(Je).length)||0,managedAgentsOnCurrentPage:ze,selectionMode:f,setSelectionMode:h,selectedAgents:y,setSelectedAgents:e=>{null!=v&&v.current&&(v.current.setSelection(e),h("manual"))},clearFilters:H,isUsingFilter:U}),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(Kt,{agents:be,sortField:T,pageSizeOptions:S,sortOrder:w,isLoading:Fe,agentPoliciesIndexedById:Qe,renderActions:e=>{const t="string"==typeof e.policy_id?Qe[e.policy_id]:void 0;return(null==le?void 0:le.id)!==e.id||Object(W.isEqual)(e.tags,le.tags)||ne(e),n.a.createElement(_t,{agent:e,agentPolicy:t,onReassignClick:()=>Y(e),onUnenrollClick:()=>Z(e),onUpgradeClick:()=>ae(e),onAddRemoveTagsClick:t=>{se(t),ne(e),ge(!de)},onGetUninstallCommandClick:()=>ee(e),onRequestDiagnosticsClick:()=>pe(e)})},onSelectionChange:e=>{k(e),"query"===f&&e.length<y.length&&(y.length>0&&0===Object(W.differenceBy)(y,be,"id").length?h("manual"):null!=v&&v.current&&v.current.setSelection(be))},tableRef:v,showUpgradeable:r,onTableChange:({page:e,sort:t})=>{const a={...x,currentPage:e.index+1,pageSize:e.size};I(a),O(t.field),j(t.direction)},pagination:x,totalAgents:Math.min(Ie,M.p),isUsingFilter:U,setEnrollmentFlyoutState:G,clearFilters:H,isCurrentRequestIncremented:ot}))};var Vt=a(189),Qt=a(192),Yt=a(64),Jt=a(479),Zt=a.n(Jt),Xt=a(97),ea=a(65),ta=a.n(ea),aa=a(27),la=a.n(aa),na=a(103);const ia=Object(l.memo)((({selectedDatasets:e,onToggleDataset:t})=>{const{unifiedSearch:a,data:i}=Object(c.lc)(),[s,r]=Object(l.useState)(!1),[o,d]=Object(l.useState)(!1),[m,p]=Object(l.useState)([tt]),E=Object(l.useCallback)((()=>r((e=>!e))),[r]),f=Object(l.useCallback)((()=>r(!1)),[r]);return Object(l.useEffect)((()=>{(async()=>{d(!0);try{const e=(await i.dataViews.getFieldsForWildcard({pattern:et})).reduce(((e,t)=>(e[t.name]=t,e)),{}),t=await i.dataViews.create({title:et,fields:e}),l=await a.autocomplete.getValueSuggestions({indexPattern:t,field:lt,query:""});l.length>0&&p(l.sort())}catch(e){p([tt])}d(!1)})()}),[i.dataViews,a.autocomplete]),n.a.createElement(u.EuiPopover,{button:n.a.createElement(u.EuiFilterButton,{"data-test-subj":"agentList.datasetFilterBtn",iconType:"arrowDown",onClick:E,isSelected:s,isLoading:o,numFilters:m.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},g.i18n.translate("xpack.fleet.agentLogs.datasetSelectText",{defaultMessage:"Dataset"})),isOpen:s,closePopover:f,panelPaddingSize:"none"},m.map((a=>n.a.createElement(u.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a))))})),sa=Object.values(ct),ra=Object(l.memo)((({selectedLevels:e,onToggleLevel:t})=>{const[a,i]=Object(l.useState)(!1),s=Object(l.useCallback)((()=>i((e=>!e))),[]),r=Object(l.useCallback)((()=>i(!1)),[]),o=sa.map((a=>n.a.createElement(u.EuiFilterSelectItem,{checked:e.includes(a)?"on":void 0,key:a,onClick:()=>t(a)},a)));return n.a.createElement(u.EuiPopover,{button:n.a.createElement(u.EuiFilterButton,{"data-test-subj":"agentList.logLevelFilterBtn",iconType:"arrowDown",onClick:s,isSelected:a,numFilters:sa.length,hasActiveFilters:e.length>0,numActiveFilters:e.length},g.i18n.translate("xpack.fleet.agentLogs.logLevelSelectText",{defaultMessage:"Log level"})),isOpen:a,closePopover:r,panelPaddingSize:"none"},o)}));var oa=a(98);const ca=[at,lt.name,nt],ua=Object(l.memo)((({query:e,isQueryValid:t,onUpdateQuery:a})=>{const{data:i,notifications:s,http:r,docLinks:o,uiSettings:u,unifiedSearch:d,storage:m,dataViews:p}=Object(c.lc)(),[E,f]=Object(l.useState)();return Object(l.useEffect)((()=>{(async()=>{try{const e=(await i.dataViews.getFieldsForWildcard({pattern:et})||[]).filter((e=>!ca.includes(e.name)));f(e)}catch(e){f(void 0)}})()}),[i.dataViews]),n.a.createElement(oa.QueryStringInput,{iconType:"search",autoSubmit:!0,disableLanguageSwitcher:!0,indexPatterns:E?[{title:et,fields:E}]:[],query:{query:e,language:"kuery"},isInvalid:!t,disableAutoFocus:!0,placeholder:g.i18n.translate("xpack.fleet.agentLogs.searchPlaceholderText",{defaultMessage:"Search logs…"}),onChange:e=>{a(e.query)},onSubmit:e=>{a(e.query,!0)},appName:g.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),deps:{unifiedSearch:d,notifications:s,http:r,docLinks:o,uiSettings:u,data:i,dataViews:p,storage:m}})})),da=Object.values(ct),ga=Object(l.memo)((({agent:e})=>{var t,a,i,s;const{notifications:r}=Object(c.lc)(),[o,m]=Object(l.useState)(!1),[p,E]=Object(l.useState)(null!==(t=null===(a=e.local_metadata)||void 0===a||null===(i=a.elastic)||void 0===i||null===(s=i.agent)||void 0===s?void 0:s.log_level)&&void 0!==t?t:ut),[f,b]=Object(l.useState)(p),h=Object(l.useCallback)((()=>{m(!0),async function(){try{const t=await Object(c.N)(e.id,{action:{type:"SETTINGS",data:{log_level:f}}});if(t.error)throw t.error;E(f),r.toasts.addSuccess(g.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.successText",{defaultMessage:"Changed agent logging level to '{logLevel}'.",values:{logLevel:f}}))}catch(e){r.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.agentLogs.selectLogLevel.errorTitleText",{defaultMessage:"Error updating agent logging level"})})}m(!1)}()}),[r,f,e.id]);return n.a.createElement(u.EuiFlexGroup,{gutterSize:"m",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFormLabel,{htmlFor:"selectAgentLogLevel"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.selectLogLevelLabelText",defaultMessage:"Agent logging level"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiSelect,{disabled:o,compressed:!0,id:"selectAgentLogLevel",value:f,onChange:e=>{b(e.target.value)},options:da.map((e=>({text:e,value:e})))})),p!==f&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{flush:"left",size:"xs",isLoading:o,disabled:p===f,iconType:"refresh",onClick:h},o?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonLoadingText",defaultMessage:"Applying changes..."}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.updateButtonText",defaultMessage:"Apply changes"}))))})),ma=p()(u.EuiFlexGroup).withConfig({displayName:"WrapperFlexGroup",componentId:"sc-fcgfrk-0"})(["height:100%;"]),pa=p()(u.EuiFlexItem).withConfig({displayName:"DatePickerFlexItem",componentId:"sc-fcgfrk-1"})(["max-width:312px;"]),Ea={type:"log-view-reference",logViewId:"default"},fa=Object(Yt.createStateContainerReactHelpers)(),ba=({agentPolicy:e})=>{const{getHref:t}=Object(c.cc)();return n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiCallOut,{size:"m",color:"primary",iconType:"iInCircle",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutTitle",defaultMessage:"Log collection is disabled"})},e.is_managed?null:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.logDisabledCallOutDescription",defaultMessage:"Update the agent's policy {settingsLink} to enable logs collection.",values:{settingsLink:n.a.createElement(u.EuiLink,{href:t("policy_details",{policyId:e.id,tabId:"settings"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.settingsLink",defaultMessage:"settings"}))}})))},ha=Object(l.memo)((({agent:e,agentPolicy:t,state:a})=>{var i,s,r,o;const{data:g,application:m,cloud:p}=Object(c.lc)(),{update:E}=fa.useTransitions(),f=!(null!=p&&p.isServerlessEnabled),b=Object(l.useCallback)((e=>{const{min:t,max:a}=g.query.timefilter.timefilter.calculateBounds(e);return t&&a?{start:t.valueOf(),end:a.valueOf()}:void 0}),[g.query.timefilter.timefilter]),h=Object(l.useCallback)((e=>{b(e)&&E({start:e.from,end:e.to})}),[b,E]),[y,v]=Object(l.useState)(b({from:a.start,to:a.end})||b({from:it,to:st}));Object(l.useEffect)((()=>{const e=b({from:a.start,to:a.end});e?v(e):h({from:it,to:st})}),[a.start,a.end,b,h]);const x=Object(l.useCallback)((e=>{try{return Object(Xt.fromKueryExpression)(e),!0}catch(e){return!1}}),[]),[F,M]=Object(l.useState)(a.query),[S,I]=Object(l.useState)(x(a.query)),T=Object(l.useCallback)(((e,t)=>{M(e),x(e)?(I(!0),t&&E({query:e})):I(!1)}),[x,E]),O=Object(l.useMemo)((()=>dt({agentId:e.id,datasets:a.datasets,logLevels:a.logLevels,userQuery:a.query})),[e.id,a.datasets,a.logLevels,a.query]),w=null===(i=e.local_metadata)||void 0===i||null===(s=i.elastic)||void 0===s||null===(r=s.agent)||void 0===r?void 0:r.version,j=Object(l.useMemo)((()=>{var e;if(!w)return!1;const t=null===(e=la()(w))||void 0===e?void 0:e.version;return!!t&&ta()(t,"7.11.0")}),[w]),[C,{height:P}]=Zt()(),A=Object(l.useMemo)((()=>Math.max(P,600)),[P]);return j?n.a.createElement(ma,{direction:"column",gutterSize:"m"},t&&!(null!==(o=t.monitoring_enabled)&&void 0!==o&&o.includes("logs"))&&n.a.createElement(ba,{agentPolicy:t}),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexGroup,{gutterSize:"m"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(ua,{query:F,onUpdateQuery:T,isQueryValid:S})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFilterGroup,null,n.a.createElement(ia,{selectedDatasets:a.datasets,onToggleDataset:e=>{const t=[...a.datasets],l=t.indexOf(e);l>=0?(t.splice(l,1),E({datasets:t})):E({datasets:[...a.datasets,e]})}}),n.a.createElement(ra,{selectedLevels:a.logLevels,onToggleLevel:e=>{const t=[...a.logLevels],l=t.indexOf(e);l>=0?(t.splice(l,1),E({logLevels:t})):E({logLevels:[...a.logLevels,e]})}}))),n.a.createElement(pa,{grow:!1},n.a.createElement(u.EuiSuperDatePicker,{showUpdateButton:!1,start:a.start,end:a.end,onTimeChange:({start:e,end:t})=>{h({from:e,to:t})}})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(k.a,{coreStart:{application:m}},n.a.createElement(ft,{viewInLogs:f,logStreamQuery:O,startTime:a.start,endTime:a.end}))))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiPanel,{paddingSize:"none",panelRef:C,grow:!1},n.a.createElement(na.LogStream,{logView:Ea,height:A,startTimestamp:y.start,endTimestamp:y.end,query:O}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(ga,{agent:e}))):n.a.createElement(u.EuiCallOut,{size:"m",color:"warning",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.oldAgentWarningTitle",defaultMessage:"The Logs view requires Elastic Agent 7.11 or higher. To upgrade an agent, go to the Actions menu, or {downloadLink} a newer version.",values:{downloadLink:n.a.createElement(u.EuiLink,{href:"https://ela.st/download-elastic-agent",external:!0,target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentLogs.downloadLink",defaultMessage:"download"}))}})})})),ya=Object(l.memo)((({agent:e,agentPolicy:t})=>{const a=Object(l.useMemo)((()=>Object(Yt.createStateContainer)({...rt,...Object(Yt.getStateFromKbnUrl)("_q",window.location.href,{getFromHashQuery:!1})},{update:e=>t=>({...e,...t})})),[]),i=Object(l.useMemo)((()=>fa.connect((e=>({state:e||rt})))(ha)),[]),[s,r]=Object(l.useState)(!1);return Object(l.useEffect)((()=>{const e=Object(Yt.createKbnUrlStateStorage)({useHashQuery:!1,useHash:!1}),{start:t,stop:l}=Object(Yt.syncState)({storageKey:"_q",stateContainer:a,stateStorage:e});return t(),r(!0),()=>{l(),a.set(rt)}}),[a]),n.a.createElement(fa.Provider,{value:a},s?n.a.createElement(i,{agent:e,agentPolicy:t}):null)})),ka=Object(l.memo)((({agent:e,onClose:t})=>{var a,l;const i=JSON.stringify(e,null,2),s="string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(l=a.host)||void 0===l?void 0:l.hostname)?e.local_metadata.host.hostname:e.id,{docLinks:r}=Object(c.lc)();return n.a.createElement(u.EuiFlyout,{onClose:t,size:"l",maxWidth:640},n.a.createElement(u.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(u.EuiTitle,{size:"m"},n.a.createElement("h2",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.jsonFlyoutTitle",defaultMessage:"'{name}' agent details",values:{name:s}})))),n.a.createElement(u.EuiFlyoutBody,null,n.a.createElement(u.EuiText,null,n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.jsonFlyoutDescription",defaultMessage:"The JSON below is the raw agent data tracked by Fleet. This data can be useful for debugging or troubleshooting Elastic Agent. For more information, see the {doc}.",values:{doc:n.a.createElement(u.EuiLink,{href:r.links.fleet.troubleshooting},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.jsonFlyoutDocLink",defaultMessage:"troubleshooting documentation"}))}}))),n.a.createElement(u.EuiSpacer,null),n.a.createElement(u.EuiCodeBlock,{language:"json",isCopyable:!0},i)),n.a.createElement(u.EuiFlyoutFooter,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:t,flush:"left"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsJsonFlyoutCloseButtonLabel",defaultMessage:"Close"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{iconType:"download",onClick:()=>{const e=document.createElement("a");e.href=`data:text/json;charset=utf-8,${encodeURIComponent(i)}`,e.download=`${s}-agent-details.json`,e.click()}},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsJsonDownloadButtonLabel",defaultMessage:"Download JSON"}))))))})),va=Object(l.memo)((({agent:e,assignFlyoutOpenByDefault:t=!1,onCancelReassign:a,agentPolicy:i})=>{const s=Object(c.vb)().fleet.all,r=Object(c.ub)(),o=Object(Qt.b)(),[g,m]=Object(l.useState)(t),[p,E]=Object(l.useState)(!1),[f,b]=Object(l.useState)(!1),[h,y]=Object(l.useState)(!1),[k,v]=Object(l.useState)(!1),x="unenrolling"===e.status,M=Object(Lt.isStuckInUpdating)(e),[S,I]=Object(l.useState)(!1),T=Object(l.useCallback)((e=>{I(e)}),[I]),O=i&&Object(C.t)(i),{diagnosticFileUploadEnabled:w}=C.b.get(),j=Object(l.useMemo)((()=>a||(()=>m(!1))),[a,m]),P=[];return null!=i&&i.is_managed||P.push(n.a.createElement(u.EuiContextMenuItem,{icon:"pencil",onClick:()=>{m(!0)},disabled:!e.active&&!i,key:"reassignPolicy"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.reassignActionText",defaultMessage:"Assign to new policy"})),n.a.createElement(u.EuiContextMenuItem,{icon:"trash",disabled:!s||!e.active,onClick:()=>{E(!0)},key:"unenrollAgent"},x?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.forceUnenrollOneButton",defaultMessage:"Force unenroll"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.unenrollOneButton",defaultMessage:"Unenroll agent"})),n.a.createElement(u.EuiContextMenuItem,{icon:"refresh",disabled:!!r&&!Object(C.m)(e,r),onClick:()=>{b(!0)},key:"upgradeAgent","data-test-subj":"upgradeBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.upgradeOneButton",defaultMessage:"Upgrade agent"}))),M&&P.push(n.a.createElement(u.EuiContextMenuItem,{icon:"refresh",onClick:()=>{b(!0)},key:"restartUpgradeAgent","data-test-subj":"restartUpgradeBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.restartUpgradeOneButton",defaultMessage:"Restart upgrade"}))),P.push(n.a.createElement(u.EuiContextMenuItem,{icon:"inspect",onClick:()=>{I(!1),v(!k)},key:"agentDetailsJson","data-test-subj":"viewAgentDetailsJsonBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.viewAgentDetailsJsonText",defaultMessage:"View agent JSON"}))),w&&P.push(n.a.createElement(u.EuiContextMenuItem,{icon:"download",disabled:!s||!Object(re.I)(e),onClick:()=>{y(!0)},"data-test-subj":"requestAgentDiagnosticsBtn",key:"requestDiagnostics"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}))),n.a.createElement(n.a.Fragment,null,g&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.c,{agents:[e],onClose:j})),p&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.d,{agents:[e],agentCount:1,onClose:()=>{E(!1),o()},useForceUnenroll:x,hasFleetServer:O})),f&&n.a.createElement(u.EuiPortal,null,n.a.createElement(oe.e,{agents:[e],agentCount:1,onClose:()=>{b(!1),o()},isUpdating:M})),h&&n.a.createElement(u.EuiPortal,null,n.a.createElement(ue,{agents:[e],agentCount:1,onClose:()=>{y(!1)}})),k&&n.a.createElement(u.EuiPortal,null,n.a.createElement(ka,{agent:e,onClose:()=>v(!1)})),n.a.createElement(F.h,{isOpen:S,onChange:T,button:{props:{iconType:"arrowDown",iconSide:"right",color:"primary"},children:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.actionsButton",defaultMessage:"Actions"})},items:P}))})),xa=p()(u.EuiButton).withConfig({displayName:"EuiButtonCompressed",componentId:"sc-1y6vsns-0"})(["height:32px;"]),Fa=({agent:e,agentPolicy:t})=>{var a,l;const{isInstalled:i,link:s,isLoading:r}=function(e){const{isLoading:t,data:a}=Object(c.Sb)(D.N),l="installed"===(null==a?void 0:a.item.status),n=Object(c.Cb)();return{isLoading:t,isInstalled:l,link:null==n?void 0:n.getRedirectUrl({dashboardId:D.q.ELASTIC_AGENT_AGENT_METRICS,query:{language:"kuery",query:`elastic_agent.id:${e.id}`}})}}(e),{getHref:o}=Object(c.cc)(),g=null!==(a=null==t||null===(l=t.monitoring_enabled)||void 0===l?void 0:l.length)&&void 0!==a&&a,m=i&&!r&&g?{href:s}:{disabled:!0},p=n.a.createElement(xa,w()({},m,{isLoading:r,color:"primary",iconType:"dashboardApp"}),n.a.createElement(d.FormattedMessage,{"data-test-subj":"agentDetails.viewMoreMetricsButton",id:"xpack.fleet.agentDetails.viewDashboardButtonLabel",defaultMessage:"View more agent metrics"}));return r||g||!t?i?p:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoIntegrationTooltip",defaultMessage:"Agent dashboard not found, you need to install the elastic_agent integration."})},p):n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.viewDashboardButton.disabledNoLogsAndMetricsTooltip",defaultMessage:"Logs and metrics for agent are not enabled in the agent policy."})},n.a.createElement(xa,{"data-test-subj":"agentDetails.enableLogsAndMetricsButton",isLoading:r,color:"primary",href:o("policy_details",{policyId:t.id,tabId:"settings"}),disabled:null==t?void 0:t.is_managed},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.enableLogsAndMetricsLabel",defaultMessage:"Enable logs and metrics"})))},Ma=p()(u.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1y4d0ny-0"})(["min-width:0px;"]),Sa=Object(l.memo)((({agent:e,agentPolicy:t})=>{var a,l,i,s,r,o,m,p,E,f,b,h,y,k,v,x,M;const S=Object(c.ub)(),{displayAgentMetrics:I}=C.b.get();return n.a.createElement(u.EuiPanel,null,n.a.createElement(u.EuiDescriptionList,{compressed:!0},n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"m"},I&&n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(Ma,{grow:5},n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"m"},[{title:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.cpuTooltip",defaultMessage:"Average CPU usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.cpuTitle",defaultMessage:"CPU"})," ",n.a.createElement(u.EuiIcon,{type:"iInCircle"}))),description:Rt(e.metrics,t)},{title:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.memoryTooltip",defaultMessage:"Average memory usage in the last 5 minutes"})},n.a.createElement("span",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.memoryTitle",defaultMessage:"Memory"})," ",n.a.createElement(u.EuiIcon,{type:"iInCircle"}))),description:zt(e.metrics,t)}].map((({title:e,description:t})=>{const a="string"==typeof t&&t.length>20?t:"";return n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(Ma,{grow:8},n.a.createElement(u.EuiDescriptionListTitle,null,e)),n.a.createElement(Ma,{grow:4},n.a.createElement(u.EuiToolTip,{position:"top",content:a},n.a.createElement(u.EuiDescriptionListDescription,{className:"eui-textTruncate"},t))))})))),n.a.createElement(Ma,{grow:5},n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Fa,{agent:e,agentPolicy:t}))))),[{title:g.i18n.translate("xpack.fleet.agentDetails.statusLabel",{defaultMessage:"Status"}),description:n.a.createElement(oe.a,{agent:e,fromDetails:!0})},{title:g.i18n.translate("xpack.fleet.agentDetails.lastActivityLabel",{defaultMessage:"Last activity"}),description:e.last_checkin?n.a.createElement(d.FormattedRelative,{value:new Date(e.last_checkin)}):"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.lastCheckinMessageLabel",{defaultMessage:"Last checkin message"}),description:e.last_checkin_message?e.last_checkin_message:"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.hostIdLabel",{defaultMessage:"Agent ID"}),description:e.id},{title:g.i18n.translate("xpack.fleet.agentDetails.agentPolicyLabel",{defaultMessage:"Agent policy"}),description:t?n.a.createElement(F.f,{policy:t,agent:e}):n.a.createElement(u.EuiSkeletonText,{lines:1})},{title:g.i18n.translate("xpack.fleet.agentDetails.versionLabel",{defaultMessage:"Agent version"}),description:"string"==typeof(null===(a=e.local_metadata)||void 0===a||null===(l=a.elastic)||void 0===l||null===(i=l.agent)||void 0===i?void 0:i.version)?n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center",style:{minWidth:0}},n.a.createElement(u.EuiFlexItem,{grow:!1,className:"eui-textNoWrap"},e.local_metadata.elastic.agent.version),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(qt,{isAgentUpgradable:!(!0===(null==t?void 0:t.is_managed)||!S||!Object(C.m)(e,S)),agentUpgradeStartedAt:e.upgrade_started_at,agentUpgradedAt:e.upgraded_at,agentUpgradeDetails:e.upgrade_details}))):"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.hostNameLabel",{defaultMessage:"Host name"}),description:"string"==typeof(null===(s=e.local_metadata)||void 0===s||null===(r=s.host)||void 0===r?void 0:r.hostname)?e.local_metadata.host.hostname:"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.logLevel",{defaultMessage:"Logging level"}),description:"string"==typeof(null===(o=e.local_metadata)||void 0===o||null===(m=o.elastic)||void 0===m||null===(p=m.agent)||void 0===p?void 0:p.log_level)?e.local_metadata.elastic.agent.log_level:"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.releaseLabel",{defaultMessage:"Agent release"}),description:"boolean"==typeof(null===(E=e.local_metadata)||void 0===E||null===(f=E.elastic)||void 0===f||null===(b=f.agent)||void 0===b?void 0:b.snapshot)?!0===e.local_metadata.elastic.agent.snapshot?"snapshot":"stable":"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.platformLabel",{defaultMessage:"Platform"}),description:"string"==typeof(null===(h=e.local_metadata)||void 0===h||null===(y=h.os)||void 0===y?void 0:y.platform)?e.local_metadata.os.platform:"-"},{title:g.i18n.translate("xpack.fleet.agentDetails.monitorLogsLabel",{defaultMessage:"Monitor logs"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(k=t.monitoring_enabled)&&void 0!==k&&k.includes("logs")?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsEnabledText",defaultMessage:"Enabled"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.monitorLogsDisabledText",defaultMessage:"Disabled"}):n.a.createElement(u.EuiSkeletonText,{lines:1})},{title:g.i18n.translate("xpack.fleet.agentDetails.monitorMetricsLabel",{defaultMessage:"Monitor metrics"}),description:Array.isArray(null==t?void 0:t.monitoring_enabled)?null!=t&&null!==(v=t.monitoring_enabled)&&void 0!==v&&v.includes("metrics")?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsEnabledText",defaultMessage:"Enabled"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.monitorMetricsDisabledText",defaultMessage:"Disabled"}):n.a.createElement(u.EuiSkeletonText,{lines:1})},{title:g.i18n.translate("xpack.fleet.agentDetails.tagsLabel",{defaultMessage:"Tags"}),description:(null!==(x=e.tags)&&void 0!==x?x:[]).length>0?n.a.createElement(Bt,{tags:null!==(M=e.tags)&&void 0!==M?M:[]}):"-"}].map((({title:e,description:t})=>{const a="string"==typeof t&&t.length>20?t:"";return n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(Ma,{grow:3},n.a.createElement(u.EuiDescriptionListTitle,null,e)),n.a.createElement(Ma,{grow:7},n.a.createElement(u.EuiToolTip,{position:"top",content:a},n.a.createElement(u.EuiDescriptionListDescription,{className:"eui-textTruncate"},t))))})))))})),Ia=p()(u.EuiText).withConfig({displayName:"StyledEuiText",componentId:"sc-sfo0eu-0"})(["text-align:left;white-space:normal;"]),Ta=Object(l.memo)((({inputStatusFormatter:e})=>e.hasError?n.a.createElement(u.EuiCallOut,{title:e.getErrorTitleFromStatus(),color:"danger",iconType:"error","data-test-subj":"integrationInputErrorCallOut"},n.a.createElement(Ia,{size:"s","data-test-subj":"integrationInputErrorDescription"},e.description)):n.a.createElement(u.EuiText,{size:"s"},e.description)));function Oa(e){return"logfile"===e?g.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeLogText",{defaultMessage:"Logs"}):"endpoint"===e?g.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeEndpointText",{defaultMessage:"Endpoint"}):e.match(/\/metrics$/)?g.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputTypeMetricsText",{defaultMessage:"Metrics"}):e}var wa=a(16),ja=a.n(wa);class input_status_utils_InputStatusFormatter{constructor(e,t){ja()(this,"status",void 0),ja()(this,"description",void 0),ja()(this,"hasError",void 0),this.status=e,this.description=t||g.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputStatusDefaultDescription",{defaultMessage:"Not available"}),this.hasError="FAILED"===e||"DEGRADED"===e}getErrorTitleFromStatus(){switch(this.status){case"FAILED":return g.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputErrorTitle.failed",{defaultMessage:"Failed"});case"DEGRADED":return g.i18n.translate("xpack.fleet.agentDetailsIntegrations.inputErrorTitle.degraded",{defaultMessage:"Degraded"});default:return}}}const Ca=(e,t)=>{const a=new RegExp(t.id);return e.map((e=>(null==e?void 0:e.units)||[])).flat().filter((e=>!!e&&e.id.match(a)))},Pa=p()(u.EuiLink).withConfig({displayName:"StyledEuiLink",componentId:"sc-6q2goy-0"})(["font-size:",";"],(e=>e.theme.eui.euiFontSizeS)),Aa=p()(u.EuiTreeView).withConfig({displayName:"StyledEuiTreeView",componentId:"sc-6q2goy-1"})([".input-action-item-expanded{height:auto;padding-top:",";padding-bottom:",";.euiTreeView__nodeLabel{width:100%;}}.inputStatusHealth{padding-top:5px;}.euiTreeView__node--expanded{max-height:none !important;.policy-response-action-expanded + div{.euiTreeView__node{max-height:none !important;}}}.euiTreeView__node{max-height:none !important;.euiNotificationBadge{margin-right:5px;}.euiTreeView__nodeLabel{.euiText{font-size:",";}}}"],(({theme:e})=>e.eui.euiSizeS),(({theme:e})=>e.eui.euiSizeS),(({theme:e})=>e.eui.euiFontSize)),La=Object(l.memo)((({agent:e,packagePolicy:t,"data-test-subj":a})=>{const{getHref:i}=Object(c.cc)(),s=Object(l.useMemo)((()=>t.inputs.reduce(((a,l)=>{if(!e.components)return new Map;if(l.enabled){var n;const i=null===(n=Ca(e.components,t))||void 0===n?void 0:n.find((e=>e.id.match(new RegExp(l.type))));a.set(l.type,i?new input_status_utils_InputStatusFormatter(i.status,i.message):new input_status_utils_InputStatusFormatter)}return a}),new Map)),[e.components,t]),r=e=>{const t=s.get(e);return void 0===(null==t?void 0:t.status)?n.a.createElement(u.EuiHealth,{color:"default","data-test-subj":"agentDetailsIntegrationsInputStatusHealthDefault",className:"inputStatusHealth"}):"HEALTHY"===t.status?n.a.createElement(u.EuiHealth,{color:"success","data-test-subj":"agentDetailsIntegrationsInputStatusHealthSuccess",className:"inputStatusHealth"}):n.a.createElement(u.EuiNotificationBadge,{"data-test-subj":"agentDetailsIntegrationsInputStatusAttentionHealth"},1)};return n.a.createElement(Aa,{items:(()=>{const a=Array.from(s.values()).reduce(((e,t)=>(t.hasError&&(e+=1),e)),0);return[{label:n.a.createElement(u.EuiText,{color:a?"danger":"default",size:"s","data-test-subj":"agentIntegrationsInputsTitle"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetailsIntegrations.inputsTypeLabel",defaultMessage:"Inputs"})),id:"agentIntegrationsInputs",icon:a?n.a.createElement(u.EuiNotificationBadge,{"data-test-subj":"agentIntegrationsInputsStatusHealth"},a):void 0,children:t.inputs.reduce(((t,a)=>{if(a.enabled){const o=s.get(a.type);return[...t,{label:n.a.createElement(u.EuiToolTip,{content:g.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},n.a.createElement(Pa,{href:i("agent_details",{agentId:e.id,tabId:"logs",logQuery:(l=a.type,"logfile"===l?`(${ot}:!(elastic_agent.filebeat))`:l.match(/\/metrics$/)?`(${ot}:!(elastic_agent.metricbeat))`:"osquery"===l?`(${ot}:!(elastic_agent.osquerybeat))`:l.match(/^synthetics\//)?`(${ot}:!(elastic_agent.heartbeat))`:"apm"===l?`(${ot}:!(elastic_agent.apm_server))`:"endpoint"===l?`(${ot}:!(elastic_agent.endpoint_security))`:"")}),"aria-label":g.i18n.translate("xpack.fleet.agentDetailsIntegrations.viewLogsButton",{defaultMessage:"View logs"})},Oa(a.type))),id:a.type,icon:r(a.type),children:o?[{label:n.a.createElement(Ta,{inputStatusFormatter:o}),id:`input-status-${a.type}`,isExpanded:!0,className:"input-action-item-expanded"}]:[]}]}var l;return t}),[])}]})(),showExpansionArrows:!0,"aria-label":"inputsTreeView","aria-labelledby":"inputsTreeView"})})),_a=p()(u.EuiAccordion).withConfig({displayName:"StyledEuiAccordion",componentId:"sc-f6nvxk-0"})([".euiAccordion__button{width:90%;}.euiAccordion__triggerWrapper{padding-left:",";}&.euiAccordion-isOpen{.euiAccordion__childWrapper{padding:",";padding-top:0px;}}.ingest-integration-title-button{padding:",";}.euiTableRow:last-child .euiTableRowCell{border-bottom:none;}.euiIEFlexWrapFix{min-width:0;}.euiAccordion__buttonContent{width:100%;}"],(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiSizeS)),Da=({id:e,title:t,children:a,"data-test-subj":i})=>{const s=Object(l.useMemo)((()=>{if(i)return{"data-test-subj":`${i}-openCloseToggle`}}),[i]);return n.a.createElement(u.EuiPanel,{paddingSize:"none"},n.a.createElement(_a,{id:e,arrowDisplay:"left",buttonClassName:"ingest-integration-title-button",buttonContent:t,arrowProps:s,"data-test-subj":i},a))},Ba=Object(l.memo)((({agent:e,agentPolicy:t,packagePolicy:a,"data-test-subj":i})=>{var s,r,o,g;const{getHref:m}=Object(c.cc)(),p=Object(u.useEuiTheme)(),[E,f]=Object(l.useState)(!1),b=Object(c.oc)(null!==(s=null===(r=a.package)||void 0===r?void 0:r.name)&&void 0!==s?s:"","package-policy-response"),h=Object(l.useMemo)((()=>b&&n.a.createElement(F.l,null,n.a.createElement(b.Component,{agent:e,onShowNeedsAttentionBadge:f}))),[e,b]),y=Object(l.useMemo)((()=>e.components?Ca(e.components,a).filter((e=>"DEGRADED"===e.status||"FAILED"===e.status)):[]),[e.components,a]),k=E||!!y.length,v=Object(c.oc)(null!==(o=null===(g=a.package)||void 0===g?void 0:g.name)&&void 0!==o?o:"","package-generic-errors-list"),x=Object(l.useMemo)((()=>v&&n.a.createElement(F.l,null,n.a.createElement(v.Component,{packageErrors:y}))),[y,v]);return n.a.createElement(Da,{id:a.id,"data-test-subj":i,title:n.a.createElement(u.EuiTitle,{size:"xs"},n.a.createElement("h3",null,n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},a.package?n.a.createElement(F.t,{packageName:a.package.name,version:a.package.version,size:"l",tryApi:!0}):n.a.createElement(F.t,{size:"l",packageName:"default",version:"0"})),n.a.createElement(u.EuiFlexItem,{className:"eui-textTruncate"},n.a.createElement(u.EuiLink,{className:"eui-textTruncate","data-test-subj":"agentPolicyDetailsLink",href:m("edit_integration",{policyId:t.id,packagePolicyId:a.id})},a.name)),k&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiBadge,{color:p.euiTheme.colors.danger,iconType:"warning",iconSide:"left","data-test-subj":i?`${i}-needsAttention`:void 0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetailsIntegrations.needsAttention.label",defaultMessage:"Needs attention"}))))))},n.a.createElement(La,{agent:e,packagePolicy:a}),h,x,n.a.createElement(u.EuiSpacer,null))})),Ra=Object(l.memo)((({agent:e,agentPolicy:t})=>t&&t.package_policies?n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"m"},t.package_policies.map(((a,l)=>{var i,s;const r=(null!==(i=null===(s=a.package)||void 0===s?void 0:s.name)&&void 0!==i?i:"packagePolicy")+"-"+l;return n.a.createElement(u.EuiFlexItem,{grow:!1,key:a.id,"data-test-subj":r},n.a.createElement(Ba,{agent:e,agentPolicy:t,packagePolicy:a,"data-test-subj":`${r}-accordion`}))}))):null)),za=p()(u.EuiFlexItem).withConfig({displayName:"FlexItemWithMinWidth",componentId:"sc-1n7kbng-0"})(["min-width:0px;"]),Na=Object(l.memo)((({agent:e,agentPolicy:t})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(za,null,n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.overviewSectionTitle",defaultMessage:"Overview"}))),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(Sa,{agent:e,agentPolicy:t})),n.a.createElement(za,null,n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.integrationsSectionTitle",defaultMessage:"Integrations"}))),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(Ra,{agent:e,agentPolicy:t})))))),Ua=p()(u.EuiFlexItem).withConfig({displayName:"FlexStartEuiFlexItem",componentId:"sc-z35w3m-0"})(["align-self:flex-start;"]),Ha=p()(u.EuiIcon).withConfig({displayName:"MarginedIcon",componentId:"sc-z35w3m-1"})(["margin-right:7px;"]),qa=({agent:e})=>{const{notifications:t}=Object(c.lc)(),{getAbsolutePath:a}=Object(c.cc)(),[i,s]=Object(l.useState)(!1),[r,o]=Object(l.useState)(!0),[m,p]=Object(l.useState)([]),[E,f]=Object(l.useState)([]),[b,h]=Object(l.useState)(1e4),y=Object(l.useCallback)((async()=>{try{const t=await Object(c.y)(e.id),a=t.error;if(a)throw a;if(!t.data)throw new Error("No data");const l=t.data.items;p(l),o(!1),l.some((e=>"IN_PROGRESS"===e.status||"AWAITING_UPLOAD"===e.status))?h(3e3):h(1e4)}catch(e){t.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.requestDiagnostics.errorLoadingUploadsNotificationTitle",{defaultMessage:"Error loading diagnostics uploads"})})}}),[e.id,t.toasts,h]);Object(l.useEffect)((()=>{y();const e=setInterval((async()=>{y()}),b);return()=>{e&&clearInterval(e)}}),[y,b]),Object(l.useEffect)((()=>{f(m),E.length>0&&m.filter((e=>{const t=E.find((t=>t.id===e.id));return"READY"===e.status&&(!t||"READY"!==(null==t?void 0:t.status))})).forEach((e=>{t.toasts.addSuccess({title:g.i18n.translate("xpack.fleet.requestDiagnostics.readyNotificationTitle",{defaultMessage:"Agent diagnostics {name} ready",values:{name:e.name}})},{toastLifeTimeMs:5e3})}))}),[E,m,t.toasts]);const k=n.a.createElement(Ha,{type:"warning",color:"red"}),v=[{field:"id",name:"File",render:e=>{const t=m.find((t=>t.id===e));return"READY"===(null==t?void 0:t.status)?n.a.createElement(u.EuiLink,{href:a(null==t?void 0:t.filePath),download:!0,target:"_blank"},n.a.createElement(u.EuiIcon,{type:"download"}),"   ",null==t?void 0:t.name):"IN_PROGRESS"===(null==t?void 0:t.status)||"AWAITING_UPLOAD"===(null==t?void 0:t.status)?n.a.createElement(u.EuiLink,{color:"subdued",disabled:!0},n.a.createElement(u.EuiLoadingSpinner,null),"  ",n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.generatingText",defaultMessage:"Generating diagnostics file..."})):n.a.createElement(u.EuiLink,{color:"subdued",disabled:!0},null!=t&&t.status?n.a.createElement(u.EuiToolTip,{content:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"Diagnostics status: ",null==t?void 0:t.status),n.a.createElement("p",null,(l=null==t?void 0:t.error,l?`Error: ${l}`:"")))},k):k," ",null==t?void 0:t.name);var l}},{field:"id",name:"Date",dataType:"date",render:e=>{const t=m.find((t=>t.id===e));return n.a.createElement(u.EuiText,{color:"READY"===(null==t?void 0:t.status)?"default":"subdued"},Object(u.formatDate)(null==t?void 0:t.createTime,"lll"))}}],x=n.a.createElement(u.EuiButton,{fill:!0,size:"m",onClick:async function(){try{s(!0);const{error:a}=await Object(c.db)(e.id);if(a)throw a;s(!1);const l=g.i18n.translate("xpack.fleet.requestDiagnostics.successSingleNotificationTitle",{defaultMessage:"Request diagnostics submitted"});t.toasts.addSuccess(l),y()}catch(e){s(!1),t.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.requestDiagnostics.fatalErrorNotificationTitle",{defaultMessage:"Error requesting diagnostics {count, plural, one {agent} other {agents}}",values:{count:1}})})}},disabled:i||!Object(re.I)(e)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentList.diagnosticsOneButton",defaultMessage:"Request diagnostics .zip"}));return n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"l"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiCallOut,{iconType:"warning",color:"warning",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.fleetServerSetup.calloutTitle",defaultMessage:"Agent diagnostics"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.calloutText",defaultMessage:"Diagnostics files are stored in Elasticsearch, and as such can incur storage costs."}))),n.a.createElement(Ua,null,Object(re.I)(e)?x:n.a.createElement(u.EuiToolTip,{content:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.requestDiagnostics.notSupportedTooltip",defaultMessage:"Requesting agent diagnostics is not supported for agents before version {version}.",values:{version:re.e}})},x)),n.a.createElement(u.EuiFlexItem,null,r?n.a.createElement(u.EuiSkeletonText,{lines:3}):n.a.createElement(u.EuiBasicTable,{items:m,columns:v})))},Ga=()=>{var e,t,a;const{params:{agentId:i,tabId:s=""}}=Object(r.useRouteMatch)(),{getHref:o}=Object(c.cc)(),{displayAgentMetrics:m}=C.b.get(),{isLoading:p,isInitialRequest:E,error:f,data:b,resendRequest:h}=Object(c.Ob)(i,{pollIntervalMs:5e3,query:{withMetrics:m}}),{isLoading:y,data:k,sendRequest:v}=Object(c.Pb)(null==b||null===(e=b.item)||void 0===e?void 0:e.policy_id),{application:{navigateToApp:x}}=Object(c.lc)(),M=Object(c.Xb)(),I="true"===new URLSearchParams(Object(r.useLocation)().search).get("openReassignFlyout"),T=Object(l.useCallback)((()=>{M&&M.onDoneNavigateTo&&x(M.onDoneNavigateTo[0],M.onDoneNavigateTo[1])}),[M,x]),{diagnosticFileUploadEnabled:O}=C.b.get(),w=null==b||null===(t=b.item)||void 0===t||null===(a=t.local_metadata)||void 0===a?void 0:a.host,j=Object(l.useMemo)((()=>n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:"s",alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiButtonEmpty,{iconType:"arrowLeft",href:o("agent_list"),flush:"left",size:"xs"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.viewAgentListTitle",defaultMessage:"View all agents"}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{className:"eui-textBreakWord"},n.a.createElement("h1",null,p&&E?n.a.createElement(F.r,null):"object"==typeof w&&"string"==typeof(null==w?void 0:w.hostname)?w.hostname:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.agentDetailsTitle",defaultMessage:"Agent '{id}'",values:{id:i}})))))),[w,i,o,E,p]),P=Object(l.useMemo)((()=>b&&b.item?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center",gutterSize:"s",direction:"row"},!y&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(va,{agent:b.item,agentPolicy:null==k?void 0:k.item,assignFlyoutOpenByDefault:I,onCancelReassign:M&&M.onDoneNavigateTo?T:void 0})))):void 0),[k,b,o,y]),A=Object(l.useMemo)((()=>{const e=[{id:"details",name:g.i18n.translate("xpack.fleet.agentDetails.subTabs.detailsTab",{defaultMessage:"Agent details"}),href:o("agent_details",{agentId:i,tabId:"details"}),isSelected:!s||"details"===s},{id:"logs",name:g.i18n.translate("xpack.fleet.agentDetails.subTabs.logsTab",{defaultMessage:"Logs"}),href:o("agent_details_logs",{agentId:i,tabId:"logs"}),isSelected:"logs"===s}];return O&&e.push({id:"diagnostics",name:g.i18n.translate("xpack.fleet.agentDetails.subTabs.diagnosticsTab",{defaultMessage:"Diagnostics"}),href:o("agent_details_diagnostics",{agentId:i,tabId:"diagnostics"}),isSelected:"diagnostics"===s}),e}),[o,i,s,O]);return n.a.createElement(Qt.a.Provider,{value:{refresh:()=>{h(),v()}}},n.a.createElement(S.c,{leftColumn:j,rightColumn:P,tabs:A},p&&E?n.a.createElement(F.r,null):f?n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.unexceptedErrorTitle",defaultMessage:"Error loading agent"}),error:f}):b&&b.item?n.a.createElement(Wa,{agent:b.item,agentPolicy:null==k?void 0:k.item}):n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentDetails.agentNotFoundErrorTitle",defaultMessage:"Agent not found"}),error:g.i18n.translate("xpack.fleet.agentDetails.agentNotFoundErrorDescription",{defaultMessage:"Cannot find agent ID {agentId}",values:{agentId:i}})})))},Wa=({agent:e,agentPolicy:t})=>(Object(c.wb)("agent_details",{agentHost:"object"==typeof e.local_metadata.host&&"string"==typeof e.local_metadata.host.hostname?e.local_metadata.host.hostname:"-"}),n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.agent_details_logs,render:()=>n.a.createElement(ya,{agent:e,agentPolicy:t})}),n.a.createElement(o.a,{path:M.h.agent_details_diagnostics,render:()=>n.a.createElement(qa,{agent:e})}),n.a.createElement(o.a,{path:M.h.agent_details,render:()=>n.a.createElement(Na,{agent:e,agentPolicy:t})}))),Ka=Object(r.withRouter)((({actionSection:e,title:t,children:a})=>n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceAround"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiPageSection,{color:"transparent"},n.a.createElement(u.EuiEmptyPrompt,{color:"plain",iconType:"logoBeats",title:n.a.createElement("h2",null,t),body:a,actions:e})))))),$a=Object(d.injectI18n)((({intl:e})=>n.a.createElement(Ka,{title:e.formatMessage({id:"xpack.fleet.noAccess.accessDeniedTitle",defaultMessage:"Access denied"}),actionSection:[]},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.noAccess.accessDeniedDescription",defaultMessage:"You are not authorized to access Elastic Fleet. To use Elastic Fleet, you need a user role that contains All permissions for this application."}))))),Va=()=>{var e;Object(c.wb)("agent_list");const{agents:t}=Object(c.zb)(),a=Object(c.vb)().fleet.all,l=Object(c.Gb)(),i=Object(c.Hb)();if(!t.enabled)return null;if(!l.missingRequirements&&l.isLoading)return n.a.createElement(F.r,null);if(l.error)return n.a.createElement(S.d,null,n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentsInitializationErrorMessageTitle",defaultMessage:"Unable to initialize central management for Elastic Agents"}),error:l.error}));const s=1===(null==l||null===(e=l.missingRequirements)||void 0===e?void 0:e.length)&&"fleet_server"===l.missingRequirements[0],r=l.forceDisplayInstructions||s;if(!s&&l.missingRequirements&&l.missingRequirements.length>0)return n.a.createElement(Vt.b,{missingRequirements:l.missingRequirements});if(!a)return n.a.createElement($a,null);const g=r?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{fill:!0,iconType:"plusInCircle",onClick:()=>i.openEnrollmentFlyout(),"data-test-subj":"addAgentBtnTop"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addAgentButton",defaultMessage:"Add Agent"}))))):void 0;return n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.agent_details},n.a.createElement(Ga,null)),n.a.createElement(o.a,{path:M.h.agents},n.a.createElement(S.a,{section:"agents",rightColumn:g},r?n.a.createElement(Vt.a,{showEnrollmentRecommendation:!1}):n.a.createElement($t,null))))};var Qa=a(246),Ya=a(26);const Ja=e=>{const{packagePolicy:t,queryParamsPolicyId:a}=e,n=Object(c.Xb)(),i=Object(l.useRef)(!0),{getPath:s}=Object(c.cc)(),{application:{navigateToApp:r}}=Object(c.lc)();return Object(l.useEffect)((()=>()=>{i.current=!1}),[]),Object(l.useCallback)(((e,l=[])=>{if(!i.current)return;const o=s("policy_details",{policyId:t.policy_id}),[c,u]=null!=n&&n.onSaveNavigateTo?[n.onSaveNavigateTo,null==n?void 0:n.onSaveQueryParams]:[[M.o,{path:o}],{showAddAgentHelp:!0,openEnrollmentFlyout:!0}],[d,g]=c;if(null!=g&&g.path){const t=function({path:e,policy:t,paramsToApply:a,mappingOptions:l={}}){const[n,i]=e.split("?"),s=Object(Ya.parse)(i);a.forEach((e=>{const a=l[e];if(a){const[l,o]=(n=e,i=a,r=t.policy_id,i?"boolean"==typeof i&&i?[n,"true"]:[i.renameKey?i.renameKey:n,i.policyIdAsValue?r:"true"]:[]);l&&o&&(s[l]=o)}var n,i,r}));const r=Object(Ya.stringify)(s);return n+(r?`?${r}`:"")}({path:a?o:g.path,policy:e,mappingOptions:u,paramsToApply:l});r(d,{...g,path:t})}else r(...c)}),[t.policy_id,s,r,n,a])};var Za=a(134),Xa=a(252),el=a(120);const tl=e=>{var t,a,l,n,i,s,r,o,c,u;return{templateUrl:null==e||null===(t=e.inputs)||void 0===t||null===(a=t.find((e=>e.enabled)))||void 0===a||null===(l=a.config)||void 0===l||null===(n=l.arm_template_url)||void 0===n?void 0:n.value,azureAccountType:null==e||null===(i=e.inputs)||void 0===i||null===(s=i.find((e=>e.enabled)))||void 0===s||null===(r=s.streams)||void 0===r||null===(o=r[0])||void 0===o||null===(c=o.vars)||void 0===c||null===(u=c["azure.account_type"])||void 0===u?void 0:u.value}};var al=a(136),ll=a(187);const nl={name:"",description:"",namespace:"default",policy_id:"",enabled:!0,inputs:[]};var il=a(166);const sl=({onConfirm:e,onCancel:t,agentPolicy:a,packagePolicy:l})=>{var i,s;const{data:r,isLoading:o}=Object(b.useQuery)(["cloudFormationApiKeys"],(()=>Object(c.B)({page:1,perPage:1,kuery:`policy_id:${a.id}`}))),{agentPolicyWithPackagePolicies:g}=Object(il.a)(a.id),{fleetServerHosts:m}=Object(c.Eb)(g),p=m[0],E=Object(C.j)(l),{cloudFormationUrl:f,error:h,isError:y}=Object(c.Ab)({enrollmentAPIKey:null==r||null===(i=r.data)||void 0===i||null===(s=i.items[0])||void 0===s?void 0:s.api_key,cloudFormationProps:E,fleetServerHost:p});return n.a.createElement(u.EuiModal,{"data-test-subj":"postInstallCloudFormationModal",onClose:t},n.a.createElement(u.EuiModalHeader,null,n.a.createElement(u.EuiModalHeaderTitle,{"data-test-subj":"confirmCloudFormationModalTitleText"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallCloudFormationModalTitle",defaultMessage:"CloudFormation deployment"}))),n.a.createElement(u.EuiModalBody,null,n.a.createElement(F.g,{awsAccountType:E.awsAccountType}),h&&y&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:h,color:"danger",iconType:"error"}))),n.a.createElement(u.EuiModalFooter,null,n.a.createElement(u.EuiButtonEmpty,{"data-test-subj":"confirmCloudFormationModalCancelButton",onClick:t},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallCloudFormationModal.cancelButton",defaultMessage:"Launch CloudFormation later"})),n.a.createElement(u.EuiButton,{"data-test-subj":"confirmCloudFormationModalConfirmButton",onClick:()=>{window.open(f),e()},fill:!0,color:"primary",isLoading:o,isDisabled:y},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallCloudFormationModalConfirmButtonLabel",defaultMessage:"Launch CloudFormation"}))))};var rl=a(159),ol=a(3);const cl=({onConfirm:e,onCancel:t,agentPolicy:a,packagePolicy:l})=>{var i,s,r,o;const{data:g}=Object(b.useQuery)(["googleCloudShellApiKeys"],(()=>Object(c.B)({page:1,perPage:1,kuery:`policy_id:${a.id}`}))),{fleetServerHosts:m,fleetProxy:p}=Object(c.Eb)(a),E=Object(c.ub)(),{gcpProjectId:f,gcpOrganizationId:h,gcpAccountType:y}=Object(ol.s)(l),{cloudShellUrl:k,error:v,isError:x,isLoading:M}=Object(c.Bb)({enrollmentAPIKey:null==g||null===(i=g.data)||void 0===i||null===(s=i.items[0])||void 0===s?void 0:s.api_key,packagePolicy:l});if(!E)return n.a.createElement(u.EuiLoadingSpinner,null);const S=Object(rl.a)({apiKey:(null==g||null===(r=g.data)||void 0===r||null===(o=r.items[0])||void 0===o?void 0:o.api_key)||"no_key",fleetServerHosts:m,fleetProxy:p,agentVersion:E,gcpProjectId:f,gcpOrganizationId:h,gcpAccountType:y});return n.a.createElement(u.EuiModal,{"data-test-subj":"postInstallGoogleCloudShellModal",onClose:t},n.a.createElement(u.EuiModalHeader,null,n.a.createElement(u.EuiModalHeaderTitle,{"data-test-subj":"confirmGoogleCloudShellTitleText"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallGoogleCloudShellModalTitle",defaultMessage:"Google Cloud Shell deployment"}))),n.a.createElement(u.EuiModalBody,null,n.a.createElement(F.o,{commandText:S.googleCloudShell,hasProjectId:!!f}),v&&x&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:v,color:"danger",iconType:"error"}))),n.a.createElement(u.EuiModalFooter,null,n.a.createElement(u.EuiButtonEmpty,{"data-test-subj":"confirmGoogleCloudShellModalCancelButton",onClick:t},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallGoogleCloudShellModal.cancelButton",defaultMessage:"Launch Google Cloud Shell later"})),n.a.createElement(u.EuiButton,{"data-test-subj":"confirmGoogleCloudShellModalConfirmButton",onClick:()=>{window.open(k),e()},fill:!0,color:"primary",isLoading:M,isDisabled:x},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallGoogleCloudShellModalConfirmButtonLabel",defaultMessage:"Launch Google Cloud Shell"}))))};var ul=a(203),dl=a(202);const gl=({onConfirm:e,onCancel:t,agentPolicy:a,packagePolicy:l})=>{var i,s;const{data:r}=Object(b.useQuery)(["azureArmTemplateApiKeys",{agentPolicyId:a.id}],(()=>Object(c.B)({page:1,perPage:1,kuery:`policy_id:${a.id}`}))),o=tl(l),g=null==r||null===(i=r.data)||void 0===i||null===(s=i.items[0])||void 0===s?void 0:s.api_key,{azureArmTemplateUrl:m,error:p,isError:E,isLoading:f}=Object(ul.a)({enrollmentAPIKey:g,azureArmTemplateProps:o});return n.a.createElement(u.EuiModal,{"data-test-subj":"postInstallAzureArmTemplateModal",onClose:t},n.a.createElement(u.EuiModalHeader,null,n.a.createElement(u.EuiModalHeaderTitle,{"data-test-subj":"confirmAzureArmTemplateModalTitleText"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallAzureArmTemplateModalModalTitle",defaultMessage:"ARM Template deployment"}))),n.a.createElement(u.EuiModalBody,null,n.a.createElement(dl.a,{azureAccountType:o.azureAccountType,agentPolicy:a,enrollmentToken:g}),p&&E&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:p,color:"danger",iconType:"error"}))),n.a.createElement(u.EuiModalFooter,null,n.a.createElement(u.EuiButtonEmpty,{"data-test-subj":"confirmAzureArmTemplateModalCancelButton",onClick:t},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallAzureArmTemplateModal.cancelButton",defaultMessage:"Add ARM Template later"})),n.a.createElement(u.EuiButton,{"data-test-subj":"confirmAzureArmTemplateModalConfirmButton",onClick:()=>{window.open(m),e()},fill:!0,color:"primary",isLoading:f,isDisabled:E},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentPolicy.postInstallAzureArmTemplateModalConfirmButtonLabel",defaultMessage:"Launch ARM Template"}))))},ml=p()(u.EuiSteps).withConfig({displayName:"StepsWithLessPadding",componentId:"sc-12f9cyq-0"})([".euiStep__content{padding-bottom:",";}@media (max-width:","){margin-bottom:100px;}"],(e=>e.theme.eui.euiSizeM),(e=>e.theme.eui.euiBreakpoints.m)),pl=p()(u.EuiBottomBar).withConfig({displayName:"CustomEuiBottomBar",componentId:"sc-12f9cyq-1"})(["z-index:50;"]),El=({from:e,queryParamsPolicyId:t,prerelease:a})=>{var i,s,o,m;const{agents:{enabled:p}}=Object(c.zb)(),{params:E}=Object(r.useRouteMatch)(),[f,b]=Object(l.useState)(Object(P.b)({name:"Agent policy 1"})),[h,y]=Object(l.useState)(!0),k=Object(T.h)(f),[v,M]=Object(l.useState)(t?Za.b.EXISTING:Za.b.NEW),{pkgName:S,pkgVersion:I}=Object(re.ab)(E.pkgkey),{data:O,error:A,isLoading:L}=Object(c.Sb)(S,I,{full:!0,prerelease:a}),_=Object(l.useMemo)((()=>{if(O&&O.item)return O.item}),[O]),[B,z]=Object(l.useState)(0),N=Object(l.useMemo)((()=>{var e;return E.integration?null==_||null===(e=_.policy_templates)||void 0===e?void 0:e.find((e=>e.name===E.integration)):void 0}),[null==_?void 0:_.policy_templates,E]),{onSubmit:U,updatePackagePolicy:H,packagePolicy:q,agentPolicy:G,updateAgentPolicy:W,savedPackagePolicy:K,formState:$,setFormState:V,navigateAddAgent:Q,navigateAddAgentHelp:Y,setHasAgentPolicyError:J,validationResults:Z,hasAgentPolicyError:X,isInitialized:ee}=function({agentCount:e,selectedPolicyTab:t,newAgentPolicy:a,withSysMonitoring:n,queryParamsPolicyId:i,packageInfo:s,integrationToEnable:r}){const{notifications:o}=Object(c.lc)(),u=Object(x.p)(),[d,m]=Object(l.useState)(),[p,E]=Object(l.useState)("VALID"),[f,b]=Object(l.useState)(!1),h=Object(l.useRef)(!1),[y,k]=Object(l.useState)(),[v,F]=Object(l.useState)({...nl}),[M,S]=Object(l.useState)(),[I,T]=Object(l.useState)(!1),O=!!M&&Object(al.f)(M),w=Object(l.useCallback)((e=>{e?(k(e),s&&T(!1)):(T(!0),k(void 0)),console.debug("Agent policy updated",e)}),[s,k]),j=Object(l.useCallback)((e=>{if(s){const t=Object(al.d)(e||v,s,el.safeLoad);return S(t),console.debug("Package policy validation results",t),t}}),[v,s]),P=Object(l.useCallback)((e=>{const a={...v,...e};F(a),console.debug("Package policy updated",a);const l=j(a),n=a.package,i=!!l&&Object(al.f)(l),s=a.policy_id&&""!==a.policy_id;!n||!s&&t!==Za.b.NEW||i?E("INVALID"):E("VALID")}),[v,E,j,t]);Object(l.useEffect)((()=>{!async function(){if(h.current||!s)return;const{data:e}=await Object(c.I)({perPage:R.SO_SEARCH_LIMIT,page:1,kuery:`${R.PACKAGE_POLICY_SAVED_OBJECT_TYPE}.package.name:${s.name}`}),t=Object(re.A)(s.name,null==e?void 0:e.items);h.current=!0,P(Object(C.r)(s,(null==y?void 0:y.id)||"",(null==y?void 0:y.namespace)||nl.namespace,nl.name||t,nl.description,r)),b(!0)}()}),[s,y,P,r,f]),Object(l.useEffect)((()=>{y&&v.policy_id!==y.id&&P({policy_id:y.id,namespace:y.namespace})}),[v,y,P]);const A=Ja({packagePolicy:v,queryParamsPolicyId:i}),L=Object(l.useCallback)((async({force:l,overrideCreatedAgentPolicy:i}={})=>{var r,d;if("VALID"===p&&O)return void E("INVALID");if(0!==e&&"CONFIRM"!==p)return void E("CONFIRM");let f=i;if(t===Za.b.NEW&&!i)try{var b,h;if(E("LOADING"),null!==(b=n||(null===(h=a.monitoring_enabled)||void 0===h?void 0:h.length))&&void 0!==b&&b){var x,F;const e=[];s&&e.push({name:s.name,version:s.version}),n&&e.push(R.FLEET_SYSTEM_PACKAGE),null!==(x=null===(F=a.monitoring_enabled)||void 0===F?void 0:F.length)&&void 0!==x&&x&&e.push(R.FLEET_ELASTIC_AGENT_PACKAGE),e.length>0&&await Object(c.h)([...new Set(e)])}f=await async function({packagePolicy:e,newAgentPolicy:t,withSysMonitoring:a}){var l;const n=(null==e||null===(l=e.package)||void 0===l?void 0:l.name)===R.FLEET_SYSTEM_PACKAGE,i=await Object(c.j)(t,{withSysMonitoring:a&&!n});if(i.error)throw i.error;if(!i.data)throw new Error("Invalid agent policy creation no data");return i.data.item}({newAgentPolicy:a,packagePolicy:v,withSysMonitoring:n}),k(f),P({policy_id:f.id})}catch(e){return E("VALID"),void o.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.createAgentPolicy.errorNotificationTitle",{defaultMessage:"Unable to create agent policy"})})}E("LOADING");const{error:M,data:S}=await async function(e){const{policy:t,forceCreateNeeded:a}=await Object(ll.a)(e);return await Object(c.l)({...t,...a&&{force:!0}})}({...v,policy_id:null!==(r=null===(d=f)||void 0===d?void 0:d.id)&&void 0!==r?r:v.policy_id,force:l}),I=!(null==S||!S.item)&&tl(S.item).templateUrl,T=!(null==S||!S.item)&&Object(C.j)(S.item).templateUrl,w=!(null==S||!S.item)&&Object(C.k)(S.item);if(E(I?e?"SUBMITTED":"SUBMITTED_AZURE_ARM_TEMPLATE":e?"SUBMITTED":"SUBMITTED_NO_AGENTS"),E(T?e?"SUBMITTED":"SUBMITTED_CLOUD_FORMATION":e?"SUBMITTED":"SUBMITTED_NO_AGENTS"),E(w?e?"SUBMITTED":"SUBMITTED_GOOGLE_CLOUD_SHELL":e?"SUBMITTED":"SUBMITTED_NO_AGENTS"),M){if(Object(C.p)(M))return E("VALID"),void(await u(v.package)&&L({overrideCreatedAgentPolicy:f,force:!0}));o.toasts.addError(M,{title:"Error"}),E("VALID")}else{m(S.item);const t=e&&y;if(!t&&I)return void E("SUBMITTED_AZURE_ARM_TEMPLATE");if(!t&&T)return void E("SUBMITTED_CLOUD_FORMATION");if(!t&&w)return void E("SUBMITTED_GOOGLE_CLOUD_SHELL");if(!t)return void E("SUBMITTED_NO_AGENTS");A(S.item),o.toasts.addSuccess({title:g.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationTitle",{defaultMessage:"'{packagePolicyName}' integration added.",values:{packagePolicyName:v.name}}),text:t?g.i18n.translate("xpack.fleet.createPackagePolicy.addedNotificationMessage",{defaultMessage:"Fleet will deploy updates to all agents that use the '{agentPolicyName}' policy.",values:{agentPolicyName:y.name}}):void 0,"data-test-subj":"packagePolicyCreateSuccessToast"})}}),[p,O,e,t,v,o.toasts,y,A,u,a,P,n,s]);return{agentPolicy:y,updateAgentPolicy:w,packagePolicy:v,updatePackagePolicy:P,savedPackagePolicy:d,onSubmit:L,formState:p,setFormState:E,hasErrors:O,validationResults:M,setValidationResults:S,hasAgentPolicyError:I,setHasAgentPolicyError:T,isInitialized:f,navigateAddAgent:e=>A(e,["openEnrollmentFlyout"]),navigateAddAgentHelp:e=>A(e,["showAddAgentHelp"])}}({agentCount:B,packageInfo:_,newAgentPolicy:f,selectedPolicyTab:v,withSysMonitoring:h,queryParamsPolicyId:t,integrationToEnable:null==N?void 0:N.name}),te=Object(l.useCallback)(((e,t)=>{e===Za.b.NEW&&(t.name&&""!==t.name.trim()&&t.namespace&&""!==t.namespace.trim()?J(!1):J(!0))}),[J]),ae=Object(l.useCallback)((e=>{const t={...f,...e};b(t),te(v,t)}),[b,te,f,v]),le=Object(l.useCallback)((e=>{M(e),te(e,f)}),[M,te,f]),ne=null==G?void 0:G.id,{cancelClickHandler:ie,cancelUrl:se}=(e=>{const{from:t,pkgkey:a,agentPolicyId:n}=e,{application:{navigateToApp:i}}=Object(c.lc)(),s=Object(c.Xb)(),{getHref:r}=Object(c.cc)();return{cancelClickHandler:Object(l.useCallback)((e=>{null!=s&&s.onCancelNavigateTo&&(e.preventDefault(),i(...s.onCancelNavigateTo))}),[s,i]),cancelUrl:Object(l.useMemo)((()=>s&&s.onCancelUrl?s.onCancelUrl:"policy"===t&&n?r("policy_details",{policyId:n}):r("integration_details_overview",{pkgkey:a})),[s,t,n,r,a])}})({from:e,pkgkey:E.pkgkey,agentPolicyId:ne});Object(l.useEffect)((()=>{p&&ne&&(async()=>{const{data:e}=await Object(c.w)({policyId:ne});void 0!==(null==e?void 0:e.results.total)&&z(e.results.total)})()}),[ne,p]);const oe=Object(l.useCallback)((({isValid:e,updatedPolicy:t})=>{H(t),V((t=>"VALID"!==t||e?t:"INVALID"))}),[H,V]),{devtoolRequest:ce,devtoolRequestDescription:ue,showDevtoolsRequest:de}=function({newAgentPolicy:e,packagePolicy:t,packageInfo:a,selectedPolicyTab:n,withSysMonitoring:i}){var s;const{showDevtoolsRequest:r}=C.b.get(),o=!D.ab.includes(null!==(s=null==a?void 0:a.name)&&void 0!==s?s:"")&&r,[c,u]=Object(l.useMemo)((()=>{if(n===Za.b.NEW){var a;const l=(null==t||null===(a=t.package)||void 0===a?void 0:a.name)===D.Y;return[`${Object(j.a)(e,i&&!l)}\n\n${Object(j.b)({...{...t,policy_id:""}})}`,g.i18n.translate("xpack.fleet.createPackagePolicy.devtoolsRequestWithAgentPolicyDescription",{defaultMessage:"These Kibana requests create a new agent policy and a new package policy."})]}return[Object(j.b)({...t}),g.i18n.translate("xpack.fleet.createPackagePolicy.devtoolsRequestDescription",{defaultMessage:"This Kibana request creates a new package policy."})]}),[t,e,i,n]);return{showDevtoolsRequest:o,devtoolRequest:c,devtoolRequestDescription:u}}({newAgentPolicy:f,packagePolicy:q,selectedPolicyTab:v,withSysMonitoring:h,packageInfo:_}),ge=Object(l.useMemo)((()=>({from:e,cancelUrl:se,onCancel:ie,agentPolicy:G,packageInfo:_,integrationInfo:N})),[G,ie,se,e,N,_]),me=Object(l.useMemo)((()=>n.a.createElement(Za.e,{agentPolicy:G,updateAgentPolicy:W,newAgentPolicy:f,updateNewAgentPolicy:ae,withSysMonitoring:h,updateSysMonitoring:e=>y(e),validation:k,packageInfo:_,setHasAgentPolicyError:J,updateSelectedTab:le,selectedAgentPolicyId:t})),[_,G,W,f,ae,k,h,le,t,J]),pe=Object(l.useMemo)((()=>Object(Qa.b)(null==_?void 0:_.assets)),[null==_?void 0:_.assets]),Ee=Object(c.oc)(null!==(i=null===(s=q.package)||void 0===s?void 0:s.name)&&void 0!==i?i:"","package-policy-create"),fe=Object(c.oc)(null!==(o=null===(m=q.package)||void 0===m?void 0:m.name)&&void 0!==o?o:"","package-policy-replace-define-step");if(fe&&Ee)throw new Error("'package-policy-create' and 'package-policy-replace-define-step' cannot both be registered as UI extensions");const be=fe&&null!=_&&_.name?ee?n.a.createElement(F.l,null,n.a.createElement(fe.Component,{agentPolicy:G,packageInfo:_,newPolicy:q,onChange:oe,validationResults:Z,isEditPage:!1})):n.a.createElement(F.r,null):void 0,he=Object(l.useMemo)((()=>{var e;return L||!ee?n.a.createElement(F.r,null):_?n.a.createElement(n.a.Fragment,null,n.a.createElement(Za.d,{agentPolicy:G,packageInfo:_,packagePolicy:q,updatePackagePolicy:H,validationResults:Z,submitAttempted:"INVALID"===$}),!Ee&&n.a.createElement(Za.c,{packageInfo:_,showOnlyIntegration:null==N?void 0:N.name,packagePolicy:q,updatePackagePolicy:H,validationResults:Z,submitAttempted:"INVALID"===$}),Ee&&(null===(e=q.package)||void 0===e?void 0:e.name)&&n.a.createElement(F.l,null,n.a.createElement(Ee.Component,{newPolicy:q,onChange:oe}))):n.a.createElement("div",null)}),[ee,L,G,_,q,H,Z,$,null==N?void 0:N.name,Ee,oe]),ye=[{title:g.i18n.translate("xpack.fleet.createPackagePolicy.stepConfigurePackagePolicyTitle",{defaultMessage:"Configure integration"}),"data-test-subj":"dataCollectionSetupStep",children:be||he},{title:g.i18n.translate("xpack.fleet.createPackagePolicy.stepSelectAgentPolicyTitle",{defaultMessage:"Where to add this integration?"}),children:me}];return A?n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.StepSelectPolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:A}):n.a.createElement(Xa.a,w()({},ge,{"data-test-subj":"createPackagePolicy"}),n.a.createElement(u.EuiErrorBoundary,null,"CONFIRM"===$&&G&&n.a.createElement(T.f,{agentCount:B,agentPolicy:G,onConfirm:U,onCancel:()=>V("VALID")}),"SUBMITTED_NO_AGENTS"===$&&G&&_&&K&&n.a.createElement(Xa.b,{packageInfo:_,onConfirm:()=>Q(K),onCancel:()=>Y(K)}),"SUBMITTED_AZURE_ARM_TEMPLATE"===$&&G&&K&&n.a.createElement(gl,{agentPolicy:G,packagePolicy:K,onConfirm:()=>Q(K),onCancel:()=>Y(K)}),"SUBMITTED_CLOUD_FORMATION"===$&&G&&K&&n.a.createElement(sl,{agentPolicy:G,packagePolicy:K,onConfirm:()=>Q(K),onCancel:()=>Y(K)}),"SUBMITTED_GOOGLE_CLOUD_SHELL"===$&&G&&K&&n.a.createElement(cl,{agentPolicy:G,packagePolicy:K,onConfirm:()=>Q(K),onCancel:()=>Y(K)}),_&&n.a.createElement(Za.a,{pkgTitle:(null==N?void 0:N.title)||_.title,pkgkey:Object(C.s)(_),integration:null==N?void 0:N.name}),_&&Object(re.P)(_)?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiCallOut,{size:"s",color:"warning",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.requireRootCalloutTitle",defaultMessage:"Requires root privileges"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.requireRootCalloutDescription",defaultMessage:"Elastic Agent needs to be run with root/administrator privileges for this integration."})),n.a.createElement(u.EuiSpacer,{size:"m"})):null,pe>0?n.a.createElement(n.a.Fragment,null,n.a.createElement(Qa.a,{count:pe}),n.a.createElement(u.EuiSpacer,{size:"xl"})):null,n.a.createElement(ml,{steps:ye}),n.a.createElement(u.EuiSpacer,{size:"xl"}),n.a.createElement(u.EuiSpacer,{size:"xl"}),n.a.createElement(pl,{"data-test-subj":"integrationsBottomBar"},n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},_&&("INVALID"===$||X)?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorOnSaveText",defaultMessage:"Your integration policy has errors. Please fix them before saving."}):null),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{color:"text",href:se,onClick:ie,"data-test-subj":"createPackagePolicyCancelButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.cancelButton",defaultMessage:"Cancel"}))),de?n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(F.i,{request:ce,description:ue,btnProps:{color:"text"}})):null,n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{onClick:()=>U(),isLoading:"LOADING"===$,disabled:"VALID"!==$||X||!Z,iconType:"save",color:"primary",fill:!0,"data-test-subj":"createPackagePolicySaveButton"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.saveButton",defaultMessage:"Save and continue"})))))))))};var fl=a(11);const bl="fleet-first-agent-policy",hl=Object.freeze(Object(P.b)({id:bl,name:g.i18n.translate("xpack.fleet.createPackagePolicy.firstAgentPolicyNameText",{defaultMessage:"My first agent policy"})})),yl=fl.m.bind(null,hl),kl=e=>{const{discover:t}=Object(fl.Rc)(),[a,n]=Object(l.useState)(null);return Object(l.useEffect)((()=>{(async()=>{if(t&&t.locator){const a=await t.locator.getUrl({indexPatternId:"logs-*",timeRange:{from:"now-1h",to:"now",mode:"relative"},filters:[{meta:{alias:"Recently enrolled agents",index:"logs-*"},query:{terms:{"agent.id":e}}}]});n(a)}})()}),[t,e]),a},vl=p()("h1").withConfig({displayName:"CentralTitle",componentId:"sc-ve6hfp-0"})(["text-align:center;"]),xl=({children:e})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiTitle,{size:"l"},n.a.createElement(vl,null,e)),n.a.createElement(u.EuiSpacer,{size:"xl"})),Fl=p()(u.EuiText).withConfig({displayName:"SubtitleText",componentId:"sc-ve6hfp-1"})(["max-width:250px;margin:0 auto;text-align:center;"]),Ml=p()(u.EuiStepNumber).withConfig({displayName:"CenteredEuiStepNumber",componentId:"sc-ve6hfp-2"})(["margin:0 auto;"]),Sl=e=>n.a.createElement("div",{style:{margin:"0 auto"}},n.a.createElement(u.EuiImage,e)),Il=({children:e})=>{const t=Object(u.useIsWithinMaxBreakpoint)("s");return n.a.createElement(u.EuiFlexGroup,{direction:"column",gutterSize:t?"xs":"l",alignItems:"center",justifyContent:"center",wrap:!0},e)},Tl=()=>{const{http:e}=Object(c.lc)(),t=e.basePath.prepend("/plugins/fleet/assets/");return n.a.createElement(u.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceEvenly",gutterSize:"none"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Il,null,n.a.createElement(u.EuiFlexItem,null,n.a.createElement(Ml,{status:"incomplete",number:1})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement("div",{style:{margin:"0 auto"}},n.a.createElement(Sl,{alt:"Illustration of installing the Elastic Agent",src:t+"1_install_agent.svg"}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{textAlign:"center"},n.a.createElement("h4",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStepTitle",defaultMessage:"Install Elastic Agent"}))),n.a.createElement(Fl,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentStep",defaultMessage:"Install agents on the hosts that you want to connect to Elastic."}))))),n.a.createElement(u.EuiShowFor,{sizes:["s","xs"]},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiSpacer,{size:"xl"}))),n.a.createElement(u.EuiHideFor,{sizes:["s","xs"]},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Sl,{alt:"Illustration of an arrow pointing from left to right",src:t+"arrow_right_curve_over.svg"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Il,null,n.a.createElement(u.EuiFlexItem,null,n.a.createElement(Ml,{status:"incomplete",number:2})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(Sl,{alt:"Illustration of adding an integration",src:t+"2_add_integration.svg"})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{textAlign:"center"},n.a.createElement("h4",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStepTitle",defaultMessage:"Add the integration"}))),n.a.createElement(Fl,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationStep",defaultMessage:"Make a few selections to finalize how Elastic receives your data."}))))),n.a.createElement(u.EuiShowFor,{sizes:["s","xs"]},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiSpacer,{size:"xl"}))),n.a.createElement(u.EuiHideFor,{sizes:["s","xs"]},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Sl,{alt:"Illustration of an arrow pointing from left to right",src:t+"arrow_right_curve_under.svg"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(Il,null,n.a.createElement(u.EuiFlexItem,null,n.a.createElement(Ml,{status:"incomplete",number:3})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(Sl,{alt:"Illustration of a dashboard with data",src:t+"3_confirm_data.svg"})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{textAlign:"center"},n.a.createElement("h4",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStepTitle",defaultMessage:"Confirm incoming data"}))),n.a.createElement(Fl,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.confirmDataStep",defaultMessage:"Explore and analyze the incoming data."}))))))},Ol=p()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-ve6hfp-3"})(["padding-bottom:100px;"]),wl=()=>{const{docLinks:e}=Object(c.lc)();return n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceAround"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiLink,{href:e.links.fleet.elasticAgent,target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.learnMoreLink",defaultMessage:"Learn more about installing Elastic Agent"}))))},jl=({integrationInfo:e,packageInfo:t,isLoading:a,error:l,cancelUrl:i,cancelClickHandler:s,onNext:r})=>{if(l)return n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:l});const o=n.a.createElement(xl,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.pageTitle",defaultMessage:"Ready to add your first integration?"}));return n.a.createElement(S.c,{topContent:o},n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"xxl"}),n.a.createElement(u.EuiSpacer,{size:"xxl"}),n.a.createElement(Tl,null),n.a.createElement(u.EuiSpacer,{size:"xxl"}),n.a.createElement(u.EuiSpacer,{size:"xxl"}),n.a.createElement(Ol,null,n.a.createElement(wl,null)),n.a.createElement(Ll,{cancelUrl:i,cancelMessage:n.a.createElement("span",{"data-test-subj":"skipAgentInstallation"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.skipAddAgentButton",defaultMessage:"Add integration only (skip agent installation)"})),cancelClickHandler:s,isLoading:a,onNext:r,noAnimation:!0,actionMessage:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.installAgentButton",defaultMessage:"Install Elastic Agent"})}),t&&n.a.createElement(Za.a,{pkgTitle:(null==e?void 0:e.title)||t.title,pkgkey:Object(C.s)(t),integration:null==e?void 0:e.name})))},Cl=p()(u.EuiBottomBar).withConfig({displayName:"CenteredRoundedBottomBar",componentId:"sc-113t0u1-0"})(["max-width:820px;margin:0 auto;border-radius:8px 8px 0px 0px;"]),Pl=p()(Cl).withConfig({displayName:"NoAnimationCenteredRoundedBottomBar",componentId:"sc-113t0u1-1"})(["animation-delay:-99s;#stop bottom bar flying in on step change"]),Al=p()("div").withConfig({displayName:"NotObscuredByBottomBar",componentId:"sc-113t0u1-2"})(["padding-bottom:100px;"]),Ll=({isLoading:e,loadingMessage:t,onNext:a,cancelClickHandler:l,cancelUrl:i,actionMessage:s,cancelMessage:r,isDisabled:o=!1,noAnimation:c=!1})=>{const g=c?Pl:Cl;return n.a.createElement(g,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{color:"text",size:"s",href:i,onClick:l},r||n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.backButton",defaultMessage:"Go back"})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"primary",fill:!0,size:"m",isDisabled:o,isLoading:!o&&e,onClick:a},e?t||n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.loading",defaultMessage:"Loading..."}):s))))},_l=({onNext:e,cancelClickHandler:t,cancelUrl:a,noAnimation:l=!1})=>{const i=l?Pl:Cl;return n.a.createElement(i,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{color:"text",size:"s",href:a,onClick:t},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.backButton",defaultMessage:"Go back"})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"primary",fill:!0,size:"m",onClick:e},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentStandaloneBottomBar.viewIncomingDataBtn",defaultMessage:"View incoming data"})))))},Dl=({pkgkey:e})=>{const t=e.includes(R.FLEET_KUBERNETES_PACKAGE),{getHref:a}=Object(fl.Ec)(),{getAbsolutePath:l}=Object(fl.Ec)();return n.a.createElement(Cl,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{color:"text",size:"s",href:a("integrations_all")},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicyBottomBar.addAnotherIntegration",defaultMessage:"Add another integration"})))),!t&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"success",fill:!0,size:"m",href:a("integration_details_assets",{pkgkey:e})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.viewDataAssetsButtonText'",defaultMessage:"View assets"}))),t&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"success",fill:!0,size:"m",href:l("/app/dashboards#/view/kubernetes-f4dc26db-1b53-4ea2-a78b-1bfab8ea267c")},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData. '",defaultMessage:"View Kubernetes metrics dashboards"})))))},Bl=({troubleshootLink:e,agentIds:t,integration:a})=>{const l=kl(t);return n.a.createElement(Cl,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{color:"text",size:"s",href:e,iconType:"popout",target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLinkBottomBar",defaultMessage:"Troubleshooting guide"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"success",fill:!0,href:null!=l?l:""},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLogsLink",defaultMessage:"View incoming {integration} logs",values:{integration:null!=a?a:""}})))))},Rl=e=>{const{packageInfo:t,integrationInfo:a,steps:l,currentStep:i,error:s}=e;if(s)return n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:s});const r=l[i].component,o=n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiTitle,{size:"l",className:"eui-textCenter"},n.a.createElement("h1",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.multiPageTitle",defaultMessage:"Set up {title} integration",values:{title:t.title}}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ul,{currentStep:i,steps:l.map((e=>e.title))}),n.a.createElement(u.EuiSpacer,{size:"xl"}));return n.a.createElement(S.c,{topContent:o,restrictHeaderWidth:866,restrictWidth:866},n.a.createElement(r,e),t&&n.a.createElement(Za.a,{pkgTitle:(null==a?void 0:a.title)||t.title,pkgkey:Object(C.s)(t),integration:null==a?void 0:a.name}))},zl=p()(u.EuiStepsHorizontal).withConfig({displayName:"NumberlessHorizontalSteps",componentId:"sc-opcgc5-0"})([".euiStepNumber{color:transparent;width:16px;height:16px;outline-color:#07c;}.euiStepHorizontal::before{width:calc(50% - 8px);top:32px;}.euiStepHorizontal::after{width:calc(50% - 8px);top:32px;}.euiStepHorizontal{padding:25px 16px 16px;}.euiStepHorizontal[data-step-status='incomplete'] .euiStepHorizontal__title{color:#69707d;}"]),Nl=(e,t,a)=>e===t?a?"complete":"current":e>t?"complete":"incomplete",Ul=({steps:e,currentStep:t=0,currentStepComplete:a=!1})=>{const l=e.map(((e,l)=>({title:e,status:Nl(t,l,a),onClick:()=>{}})));return n.a.createElement(zl,{steps:l})};var Hl=a(163),ql=a(149);var Gl=p()(u.EuiCodeBlock).withConfig({displayName:"_StyledEuiCodeBlock",componentId:"sc-oz6m9j-1"})(["max-width:1100px;"]);const Wl=e=>{const{cancelUrl:t,onNext:a,cancelClickHandler:i,setIsManaged:s,agentPolicy:r,enrollmentAPIKey:o,fleetServerHosts:c,fleetProxy:m,enrolledAgentIds:E}=e,f=Object(fl.Rc)(),{docLinks:b}=f,h=b.links.fleet.troubleshooting,y=Object(fl.Eb)(),[k,v]=Object(l.useState)(!1),[x,M]=Object(l.useState)(!1);if(!o)return n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Enrollment API key not found"});const S="kubernetes"===e.packageInfo.name?"IS_KUBERNETES_MULTIPAGE":"IS_NOT_KUBERNETES",I=Object(rl.a)({apiKey:o.api_key,fleetProxy:m,fleetServerHosts:c,agentVersion:y||""}),T=[Object(ql.i)({installCommand:I,apiKeyData:{item:o},enrollToken:o.api_key,isK8s:S,selectedApiKeyId:o.id,isComplete:k||!!E.length,fullCopyButton:!0,fleetServerHost:null==c?void 0:c[0],onCopy:()=>v(!0)})];return"IS_KUBERNETES_MULTIPAGE"===S&&T.push((({isComplete:e,fullCopyButton:t,onCopy:a})=>{const[i,s]=Object(l.useState)(!1),r=p.a.pre.withConfig({displayName:"CommandCode",componentId:"sc-oz6m9j-0"})({overflow:"auto"});return{status:e?"complete":void 0,title:g.i18n.translate("xpack.fleet.agentEnrollment.stepKubernetesApplyManifest",{defaultMessage:"Run the apply command"}),children:n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.agentEnrollment.kubernetesCommandInstructions",defaultMessage:"From the directory where the manifest is downloaded, run the apply command."}),n.a.createElement(u.EuiSpacer,{size:"m"})),n.a.createElement(Gl,{onClick:()=>{a&&a()},fontSize:"m",isCopyable:!t,paddingSize:"m"},n.a.createElement(r,null,"kubectl apply -f elastic-agent-managed-kubernetes.yml")),n.a.createElement(u.EuiSpacer,{size:"s"}),t&&n.a.createElement(u.EuiCopy,{textToCopy:"kubectl apply -f elastic-agent-managed-kubernetes.yml"},(e=>n.a.createElement(u.EuiButton,{color:"primary",iconType:"copyClipboard",size:"m",onClick:()=>(e=>{e(),s(!0),a&&a()})(e)},i?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.copyButtonClicked",defaultMessage:"Copied"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.copyButton",defaultMessage:"Copy to clipboard"})))))}})({isComplete:x||!!E.length,fullCopyButton:!0,onCopy:()=>M(!0)})),T.push(Object(ql.a)({selectedPolicyId:null==r?void 0:r.id,troubleshootLink:h,agentCount:E.length,showLoading:!0,poll:k})),y?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addIntegration.installAgentStepTitle",defaultMessage:"These steps configure and enroll the Elastic Agent in Fleet to automatically deploy updates and centrally manage the agent. As an alternative to Fleet, advanced users can run agents in {standaloneLink}.",values:{standaloneLink:n.a.createElement(u.EuiLink,{onClick:()=>s(!1)},"standalone mode")}})),n.a.createElement(u.EuiSpacer,{size:"xl"}),n.a.createElement(u.EuiSteps,{steps:T}),!!E.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Al,null),n.a.createElement(Ll,{cancelUrl:t,cancelClickHandler:i,onNext:a,actionMessage:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addFirstIntegrationSplash.addIntegrationButton",defaultMessage:"Add the integration"})}))):n.a.createElement(u.EuiLoadingSpinner,null)},Kl=e=>{const{setIsManaged:t,agentPolicy:a,cancelUrl:i,onNext:s,cancelClickHandler:r}=e,o=Object(fl.Rc)(),c=Object(fl.Cc)(),[g,m]=Object(l.useState)(""),[p,E]=Object(l.useState)(!1),[f,b]=Object(l.useState)(!1),[h,y]=Object(l.useState)();if(Object(l.useEffect)((()=>{!async function(){try{if(null==a||!a.id)return;const e={standalone:!0,kubernetes:!1},t=await Object(fl.K)(null==a?void 0:a.id,e);if(t.error)throw t.error;if(!t.data)throw new Error("No data while fetching full agent policy");y(t.data.item)}catch(e){o.notifications.toasts.addError(e,{title:"Error"})}}()}),[o.http.basePath,null==a?void 0:a.id,o.notifications.toasts]),Object(l.useEffect)((()=>{h&&m(Object(ol.n)(h,el.safeDump))}),[h]),!a)return n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.errorLoadingPackageTitle",defaultMessage:"Error loading package information"}),error:"Agent policy not provided"});const k=Object(rl.b)(c),v=o.http.basePath.prepend(`${ol.c.getInfoFullDownloadPath(null==a?void 0:a.id)}?standalone=true&apiVersion=${D.m.public.v1}`),x=[Object(ql.d)({selectedPolicyId:null==a?void 0:a.id,yaml:g,downloadLink:v,isComplete:f,onCopy:()=>b(!0)}),Object(ql.j)({installCommand:k,isComplete:g&&p,fullCopyButton:!0,onCopy:()=>E(!0)})];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ql,{setIsManaged:t}),n.a.createElement(u.EuiSpacer,{size:"xl"}),n.a.createElement(u.EuiSteps,{steps:x}),p&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Al,null),n.a.createElement(_l,{cancelUrl:i,onNext:s,cancelClickHandler:r})))},$l=({children:e})=>{const[t,a]=Object(l.useState)(!1);return n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"column"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween",direction:"row"},n.a.createElement(u.EuiFlexItem,null),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{size:"s",iconType:t?"arrowUp":"arrowDown",iconSide:"right",onClick:()=>a(!t),flush:"left"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createPackagePolicy.stepConfigure.advancedOptionsToggleLinkText",defaultMessage:"Advanced options"}))))),t&&n.a.createElement(u.EuiFlexItem,null,e)))},Vl=({error:e,title:t})=>n.a.createElement(F.j,{title:t||n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addIntegration.errorTitle",defaultMessage:"Error adding integration"}),error:e}),Ql=({setIsManaged:e})=>n.a.createElement(u.EuiCallOut,{title:"Setting up to run Elastic Agent in standalone mode",color:"primary",iconType:"iInCircle"},n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addIntegration.standaloneWarning",defaultMessage:"Setting up integrations by running Elastic Agent in standalone mode is advanced. When possible, we recommend using {link} instead. ",values:{link:n.a.createElement(u.EuiLink,{href:"#"},"Fleet-managed agents")}})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiButton,{onClick:()=>e(!0),color:"primary"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.addIntegration.switchToManagedButton",defaultMessage:"Enroll in Fleet instead (recommended)"})));var Yl=a(21),Jl=a(480),Zl=a.n(Jl),Xl=a(201);const en=({agentIds:e,troubleshootLink:t,packageInfo:a})=>{var l;const i=kl(e);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiTitle,null,n.a.createElement("h3",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.title",defaultMessage:"Confirming data is taking longer than expected"}))),n.a.createElement(u.EuiText,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.body",defaultMessage:"If the system is not generating data, it may help to generate some to ensure data is being collected correctly. If you're having trouble, see our {troubleshootLink}, or you may check later by viewing {discoverLink}.",values:{troubleshootLink:n.a.createElement(u.EuiLink,{external:!0,href:t,target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.troubleshootLink",defaultMessage:"troubleshooting guide"})),discoverLink:n.a.createElement(u.EuiLink,{external:!0,href:null!=i?i:"",target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingData.timeout.discoverLink",defaultMessage:"{integration} logs in Discover",values:{integration:null!==(l=null==a?void 0:a.title)&&void 0!==l?l:""}}))}})),n.a.createElement(Al,null),n.a.createElement(Bl,{agentIds:e,troubleshootLink:t,integration:null==a?void 0:a.title}))},tn=["agent.ephemeral_id","agent.id","elastic_agent.id","data_stream.namespace","@timestamp"],an=p()(u.EuiDescriptionList).withConfig({displayName:"CleanOverflowDescriptionList",componentId:"sc-6co0kl-0"})(["overflow:hidden;max-height:125px;word-break:break-all;white-space:pre-wrap;"]),ln=p()("pre").withConfig({displayName:"CompressedPre",componentId:"sc-6co0kl-1"})(["&&&{background:none;padding:0 0;}"]),nn=({hit:e})=>{const t=Zl()(Object(Yl.getFlattenedObject)(e._source),tn),a=Object.entries(t).map((([e,t])=>({title:`${e}:`,description:JSON.stringify(t)})));return n.a.createElement("pre",null,n.a.createElement("code",null,n.a.createElement(an,{listItems:a,type:"inline",align:"left",compressed:!0})))},sn=({hit:e})=>{const t=(null==e?void 0:e._source)||{},a=(null==t?void 0:t["@timestamp"])||"-";return n.a.createElement(u.EuiText,{size:"xs"},n.a.createElement(ln,null,a?Object(u.formatDate)(a,"MMM D, YYYY @ HH:mm:ss.SSS"):"-"))},rn=({dataPreview:e})=>{const t=e.slice(0,5);return n.a.createElement(n.a.Fragment,null,t.map((e=>n.a.createElement("div",{id:e._id},n.a.createElement(u.EuiFlexGroup,{gutterSize:"xs"},n.a.createElement(u.EuiFlexItem,{style:{minWidth:"220px"}},n.a.createElement(sn,{hit:e})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(nn,{hit:e}))),n.a.createElement(u.EuiHorizontalRule,{margin:"s"})))))},on=({agentIds:e,packageInfo:t,agentDataConfirmed:a,setAgentDataConfirmed:l,troubleshootLink:i})=>{const{incomingData:s,dataPreview:r,isLoading:o,hasReachedTimeout:c}=Object(Xl.b)(e,!0,5),{enrolledAgents:m,numAgentsWithData:p}=Object(Xl.a)(s,t),E=Object(fl.zc)(null==t?void 0:t.name),{guidedOnboarding:f}=Object(fl.Rc)();var b;return!o&&m>0&&p>0&&(l(!0),E&&(null==f||null===(b=f.guidedOnboardingApi)||void 0===b||b.completeGuidedOnboardingForIntegration(null==t?void 0:t.name))),a?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiCallOut,{"data-test-subj":"IncomingDataConfirmedCallOut",title:g.i18n.translate("xpack.fleet.confirmIncomingDataWithPreview.title",{defaultMessage:"Incoming data received from {numAgentsWithData} enrolled { numAgentsWithData, plural, one {agent} other {agents}}.",values:{numAgentsWithData:p}}),color:"success",iconType:"check"}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiText,null,n.a.createElement("h3",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.previewTitle",defaultMessage:"Preview of incoming data:"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(rn,{dataPreview:r})):n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,null,n.a.createElement(u.EuiCallOut,{size:"m",color:"primary",iconType:u.EuiLoadingSpinner,title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.listening",defaultMessage:"Listening for incoming data from enrolled agents..."})}),n.a.createElement(u.EuiSpacer,{size:"m"}),c?n.a.createElement(en,{agentIds:e,troubleshootLink:i,packageInfo:t}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataWithPreview.loading",defaultMessage:"It might take a few minutes for the data to get to Elasticsearch. If you're not seeing any, try generating some to verify. If you're having trouble connecting, check out the {link}.",values:{link:n.a.createElement(u.EuiLink,{target:"_blank",external:!0,href:i},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollmentInstructions.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiSkeletonText,{lines:10}))},cn=({troubleshootLink:e})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,null,n.a.createElement(u.EuiCallOut,{size:"m",color:"primary",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.title",defaultMessage:"Data preview is not available for standalone agents. "})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.description",defaultMessage:"You can check for agent data in the integration asset tab. If you're having trouble seeing data, check out the {link}.",values:{link:n.a.createElement(u.EuiLink,{target:"_blank",external:!0,href:e},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.confirmIncomingDataStandalone.troubleshootingLink",defaultMessage:"troubleshooting guide"}))}})))),un={title:g.i18n.translate("xpack.fleet.createFirstPackagePolicy.installAgentStepTitle",{defaultMessage:"Install Elastic Agent"}),component:e=>{var t;const[a,i]=Object(l.useState)(e.isManaged),[s,r]=Object(l.useState)(!1),o=Object(Hl.b)((null===(t=e.agentPolicy)||void 0===t?void 0:t.id)||"",{noLowerTimeLimit:!0,pollImmediately:!0}),c=()=>{e.setEnrolledAgentIds(o),e.onNext()},u={...e,onNext:c,enrolledAgentIds:o,setIsManaged:s?i:e.setIsManaged};if(a)return n.a.createElement(Wl,u);const d={...e,onNext:c,enrolledAgentIds:o,setIsManaged:e=>{e&&r(!0),i(e)}};return n.a.createElement(Kl,d)}},dn={title:g.i18n.translate("xpack.fleet.createFirstPackagePolicy.addIntegrationStepTitle",{defaultMessage:"Add the integration"}),component:e=>{var t;const{onNext:a,onBack:i,isManaged:s,setIsManaged:r,packageInfo:o,integrationInfo:m,agentPolicy:p}=e,[E,f]=Object(l.useState)(),{notifications:b}=Object(c.lc)(),[h,y]=Object(l.useState)("VALID"),[k,v]=Object(l.useState)(),M=Object(x.p)(),[S,I]=Object(l.useState)({name:"",description:"",namespace:"default",policy_id:"",enabled:!0,inputs:[]}),T=Object(l.useCallback)((e=>{const t=Object(al.d)({...S,...e},o,el.safeLoad);return v(t),console.debug("Package policy validation results",t),t}),[o,S]),O=Object(l.useCallback)((e=>{const t={...S,...e};I(t),console.debug("Package policy updated",t);const a=T(t),l=t.package,n=!!a&&Object(al.f)(a);y(l&&!n?"VALID":"INVALID")}),[S,T]),w=Object(l.useCallback)((async({force:e=!1}={})=>{const t=!!k&&Object(al.f)(k);if("VALID"===h&&t)return void y("INVALID");y("LOADING");const{error:l}=await(async({newPackagePolicy:e,force:t})=>{y("LOADING");const{policy:a,forceCreateNeeded:l}=await Object(ll.a)(e),n=await Object(c.l)({...a,force:l||t});return y("SUBMITTED"),n})({newPackagePolicy:S,force:e});if(l){if(Object(ol.B)(l))return void(await M(o)?w({force:!0}):y("VALID"));b.toasts.addError(l,{title:"Error"}),y("VALID")}else a()}),[k,h,S,b.toasts,M,o,a]);Object(l.useEffect)((()=>{(async()=>{if(!p)return;const{packagePolicy:e,error:t}=await(async(e,t,a)=>{const{data:l,error:n}=await Object(c.I)({perPage:D.xb,page:1,kuery:`${z.s}.package.name:${t.name}`}),i={name:Object(re.A)(t.name,null==l?void 0:l.items),description:"",namespace:"default",policy_id:e,enabled:!0,inputs:[]};return{packagePolicy:Object(C.r)(t,e,i.namespace,i.name,i.description,a),error:n}})(p.id,o,null==m?void 0:m.name);t&&f(t),O(e)})()}),[]);const j=Object(c.oc)(null!==(t=o.name)&&void 0!==t?t:"","package-policy-create-multi-step"),P=Object(l.useMemo)((()=>j&&n.a.createElement(F.l,null,n.a.createElement(j.Component,null))),[j]),A=Object(l.useMemo)((()=>{if("endpoint"!==o.name)return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"l"}),n.a.createElement(Za.c,{packageInfo:o,showOnlyIntegration:null==m?void 0:m.name,packagePolicy:S,updatePackagePolicy:O,validationResults:k,submitAttempted:"INVALID"===h,noTopRule:!0}),k&&n.a.createElement($l,null,n.a.createElement(Za.d,{packageInfo:o,packagePolicy:S,updatePackagePolicy:O,validationResults:k,submitAttempted:"INVALID"===h,noAdvancedToggle:!0})))}),[h,null==m?void 0:m.name,o,S,O,k]);return p?E?n.a.createElement(Vl,{error:E}):n.a.createElement(n.a.Fragment,null,s?null:n.a.createElement(Ql,{setIsManaged:r}),A,P,n.a.createElement(Al,null),n.a.createElement(Ll,{cancelClickHandler:s?i:()=>r(!0),onNext:w,isLoading:"LOADING"===h,isDisabled:"INVALID"===h,loadingMessage:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.savingPackagePolicy",defaultMessage:"Saving policy..."}),actionMessage:s?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.confirmIncomingDataButton",defaultMessage:"Confirm incoming data"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.createFirstPackagePolicy.installAgentButton",defaultMessage:"Save and continue"})})):n.a.createElement(Vl,{error:g.i18n.translate("xpack.fleet.addIntegration.noAgentPolicy",{defaultMessage:"Error creating agent policy."})})}},gn={title:g.i18n.translate("xpack.fleet.createFirstPackagePolicy.confirmDataStepTitle",{defaultMessage:"Confirm incoming data"}),component:e=>{const{enrolledAgentIds:t,packageInfo:a,isManaged:i}=e,s=Object(c.lc)(),[r,o]=Object(l.useState)(!1),{docLinks:u}=s,d=u.links.fleet.troubleshooting,g=n.a.createElement(n.a.Fragment,null,n.a.createElement(Al,null),n.a.createElement(Dl,{pkgkey:`${a.name}-${a.version}`}));return i?n.a.createElement(n.a.Fragment,null,n.a.createElement(on,{agentIds:t,packageInfo:a,agentDataConfirmed:r,setAgentDataConfirmed:o,troubleshootLink:d}),!!r&&g):n.a.createElement(n.a.Fragment,null,n.a.createElement(cn,{troubleshootLink:d}),g)}},mn=[un,dn,gn],pn=[dn,un,gn],En=({queryParamsPolicyId:e,prerelease:t})=>{const{params:a}=Object(r.useRouteMatch)(),{pkgkey:i,policyId:s,integration:o}=a,{pkgName:u,pkgVersion:d}=Object(re.ab)(i),[g,m]=Object(l.useState)(!0),[p,E]=Object(l.useState)(0),[f,b]=Object(l.useState)(!0),{getHref:h}=Object(c.cc)(),[y,k]=Object(l.useState)([]),v=s||e,{data:x,error:F,isLoading:M}=Object(c.Sb)(u,d,{prerelease:t,full:!0}),{agentPolicy:S,enrollmentAPIKey:I,error:T,isLoading:O}=function(e){const[t,a]=Object(l.useState)({isLoading:!0});return Object(l.useEffect)((()=>{(async()=>{var t;const l=e||bl,{data:n,error:i}=await(async e=>{var t;let a,l;try{a=await Object(fl.J)(e),a.error&&(l=a.error)}catch(e){l=e}return l&&404!==l.statusCode?{error:l}:{data:null===(t=a)||void 0===t?void 0:t.data}})(l),s=null==n?void 0:n.item;if(e&&!s)return void a({isLoading:!1,error:new Error(`Agent policy ${l} not found`)});let r;if(i)return void a({isLoading:!1,error:i});if(!s){const{data:e,error:t}=await yl();if(t)return void a({isLoading:!1,error:t});r=e.item}const o=s||r,{data:c,error:u}=await Object(fl.H)({page:1,perPage:1,kuery:`policy_id:${l}`});if(u)return void a({isLoading:!1,error:u});if(!c||null===(t=c.items)||void 0===t||!t.length)return void a({isLoading:!1,error:new Error(`No enrollment API key found for policy ${l}`)});const d=c.items[0];a({isLoading:!1,created:!!r,agentPolicy:o,enrollmentAPIKey:d})})()}),[e]),t}(v),w=Object(l.useMemo)((()=>null==x?void 0:x.item),[x]),j=Object(l.useMemo)((()=>{var e;if(o)return null==w||null===(e=w.policy_templates)||void 0===e?void 0:e.find((e=>e.name===o))}),[null==w?void 0:w.policy_templates,o]),{fleetServerHosts:C,fleetProxy:P,isLoadingInitialRequest:A}=Object(c.Eb)(S),L=h("add_integration_to_policy",{pkgkey:i,useMultiPageLayout:!1,...o?{integration:o}:{},...v?{agentPolicyId:v}:{}});if(g||!w)return n.a.createElement(jl,{isLoading:M||A||O,error:F||T,integrationInfo:j,packageInfo:w,cancelUrl:L,onNext:()=>{m(!1)}});const _=f?mn:pn;return n.a.createElement(Rl,{fleetServerHosts:C,fleetProxy:P,agentPolicy:S,enrollmentAPIKey:I,currentStep:p,steps:_,packageInfo:w,integrationInfo:j,cancelUrl:L,onNext:()=>{p!==_.length-1&&E(p+1)},onBack:()=>{0!==p&&E(p-1)},isManaged:f,setIsManaged:e=>{b(e),E(0)},setEnrolledAgentIds:k,enrolledAgentIds:y})},fn=()=>{const{search:e}=Object(r.useLocation)(),{params:t}=Object(r.useRouteMatch)(),a=Object(l.useMemo)((()=>new URLSearchParams(e)),[e]),i=Object(l.useMemo)((()=>a.has("useMultiPageLayout")),[a]),s=Object(l.useMemo)((()=>{var e;return null!==(e=a.get("policyId"))&&void 0!==e?e:void 0}),[a]),[o,u]=n.a.useState(!1),{data:d}=Object(c.Vb)();Object(l.useEffect)((()=>{const e=Boolean(null==d?void 0:d.item.prerelease_integrations_enabled);null!=d&&d.item&&u(e)}),[null==d?void 0:d.item]);const g={from:"policyId"in t||s?"policy":"package",queryParamsPolicyId:s,prerelease:o};return i?n.a.createElement(En,g):n.a.createElement(El,g)};a(8);const bn=({apiKeyId:e,length:t,sendGetAPIKey:a,tokenGetter:i})=>{const{euiTheme:s}=Object(u.useEuiTheme)(),{notifications:r}=Object(fl.Rc)(),[o,c]=Object(l.useState)("HIDDEN"),[d,m]=Object(l.useState)(),p=Object(l.useMemo)((()=>"•".repeat(t)),[t]);return n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(hn,{color:"subdued",size:"xs","data-test-subj":"apiKeyField",$_css:s.font.familyCode},"VISIBLE"===o?d:p)),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiToolTip,{content:"VISIBLE"===o?g.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):g.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"})},n.a.createElement(u.EuiButtonIcon,{"aria-label":"VISIBLE"===o?g.i18n.translate("xpack.fleet.enrollmentTokensList.hideTokenButtonLabel",{defaultMessage:"Hide token"}):g.i18n.translate("xpack.fleet.enrollmentTokensList.showTokenButtonLabel",{defaultMessage:"Show token"}),color:"text",onClick:async()=>{if("VISIBLE"===o)c("HIDDEN");else if("HIDDEN"===o)try{c("LOADING");const t=await a(e);if(t.error)throw t.error;m(i(t)),c("VISIBLE")}catch(e){r.toasts.addError(e,{title:"Error"}),c("HIDDEN")}},iconType:"VISIBLE"===o?"eyeClosed":"eye","data-test-subj":"showHideTokenButton"}))))};var hn=p()(u.EuiText).withConfig({displayName:"_StyledEuiText",componentId:"sc-hm2aoi-0"})(["font-family:",";"],(e=>e.$_css)),yn=a(169);const kn=e=>{const{onCancel:t,onConfirm:a,enrollmentKey:l}=e;return n.a.createElement(u.EuiConfirmModal,{title:g.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.title",{defaultMessage:"Revoke enrollment token"}),onCancel:t,onConfirm:a,cancelButtonText:g.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.deleteButton",{defaultMessage:"Revoke enrollment token"}),defaultFocusedButton:"confirm",buttonColor:"danger"},n.a.createElement(u.EuiCallOut,{title:g.i18n.translate("xpack.fleet.enrollmentTokenDeleteModal.description",{defaultMessage:"Are you sure you want to revoke {keyName}? New agents will no longer be able to be enrolled using this token.",values:{keyName:l.name}}),color:"danger"}))},vn=({apiKey:e,refresh:t})=>{const{notifications:a}=Object(c.lc)(),[i,s]=Object(l.useState)("CONFIRM_HIDDEN");return n.a.createElement(n.a.Fragment,null,"CONFIRM_VISIBLE"===i&&n.a.createElement(kn,{enrollmentKey:e,onCancel:()=>s("CONFIRM_HIDDEN"),onConfirm:async()=>{try{const t=await Object(c.q)(e.id);if(t.error)throw t.error}catch(e){a.toasts.addError(e,{title:"Error"})}s("CONFIRM_HIDDEN"),t()}}),n.a.createElement(u.EuiToolTip,{content:g.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"})},n.a.createElement(u.EuiButtonIcon,{"data-test-subj":"enrollmentTokenTable.revokeBtn","aria-label":g.i18n.translate("xpack.fleet.enrollmentTokensList.revokeTokenButtonLabel",{defaultMessage:"Revoke token"}),onClick:()=>s("CONFIRM_VISIBLE"),iconType:"trash",color:"danger"})))},xn=()=>{var e,t,a;Object(c.wb)("enrollment_tokens");const[i,s]=Object(l.useState)(!1),[r,o]=Object(l.useState)(""),{pagination:m,setPagination:p,pageSizeOptions:E}=Object(c.ec)(),f=Object(c.Lb)({page:m.currentPage,perPage:m.pageSize,kuery:""!==r.trim()?r:void 0}),b=Object(c.Ib)({page:1,perPage:M.p}),h=b.data?b.data.items:[],y=h.reduce(((e,t)=>(e[t.id]=t,e)),{}),k=null!==(e=null==f||null===(t=f.data)||void 0===t?void 0:t.total)&&void 0!==e?e:0,v=(null==f||null===(a=f.data)||void 0===a?void 0:a.items.filter((e=>{if(!h.length||!e.policy_id)return!1;const t=y[e.policy_id];return!(null!=t&&t.is_managed)})))||[],x=[{field:"name",name:g.i18n.translate("xpack.fleet.enrollmentTokensList.nameTitle",{defaultMessage:"Name"}),render:e=>n.a.createElement("span",{className:"eui-textTruncate",title:e},e)},{field:"id",name:g.i18n.translate("xpack.fleet.enrollmentTokensList.secretTitle",{defaultMessage:"Secret"}),width:"215px",render:e=>n.a.createElement(bn,{apiKeyId:e,sendGetAPIKey:c.D,tokenGetter:e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.item.api_key},length:60})},{field:"policy_id",name:g.i18n.translate("xpack.fleet.enrollmentTokensList.policyTitle",{defaultMessage:"Agent policy"}),render:e=>{const t=y[e],a=t?t.name:e;return n.a.createElement("span",{className:"eui-textTruncate",title:a},a)}},{field:"created_at",name:g.i18n.translate("xpack.fleet.enrollmentTokensList.createdAtTitle",{defaultMessage:"Created on"}),width:"150px",render:e=>e?n.a.createElement(d.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"active",name:g.i18n.translate("xpack.fleet.enrollmentTokensList.activeTitle",{defaultMessage:"Active"}),width:"70px",align:"center",render:e=>n.a.createElement(u.EuiIcon,{size:"m",color:e?"success":"danger",type:"dot"})},{field:"actions",name:g.i18n.translate("xpack.fleet.enrollmentTokensList.actionsTitle",{defaultMessage:"Actions"}),width:"70px",render:(e,t)=>{const a=h.find((e=>e.id===t.policy_id));return t.active&&!(null!=a&&a.is_managed)&&n.a.createElement(vn,{apiKey:t,refresh:()=>f.resendRequest()})}}],I=f.isLoading&&f.isInitialRequest||b.isLoading&&b.isInitialRequest;return n.a.createElement(S.a,{section:"enrollment_tokens"},i&&n.a.createElement(F.s,{agentPolicies:h,onClose:e=>{s(!1),f.resendRequest()}}),n.a.createElement(u.EuiText,{color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.pageDescription",defaultMessage:"Create and revoke enrollment tokens. An enrollment token enables one or more agents to enroll in Fleet and send data."})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{alignItems:"center"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(yn.a,{value:r,onChange:e=>{p({...m,currentPage:1}),o(e)},indexPattern:M.e,fieldPrefix:M.g,dataTestSubj:"enrollmentKeysList.queryInput"})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{"data-test-subj":"createEnrollmentTokenButton",fill:!0,iconType:"plusInCircle",onClick:()=>s(!0)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollmentTokensList.newKeyButton",defaultMessage:"Create enrollment token"})))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiBasicTable,{"data-test-subj":"enrollmentTokenListTable",loading:I,hasActions:!0,noItemsMessage:I?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.loadingTokensMessage",defaultMessage:"Loading enrollment tokens..."}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.enrollemntAPIKeyList.emptyMessage",defaultMessage:"No enrollment tokens found."}),items:k?v:[],itemId:"id",columns:x,pagination:{pageIndex:m.currentPage-1,pageSize:m.pageSize,totalItemCount:k,pageSizeOptions:E},onChange:({page:e})=>{const t={...m,currentPage:e.index+1,pageSize:e.size};p(t)}}))};var Fn=a(204);const Mn=g.i18n.translate("xpack.fleet.uninstallTokenList.policyIdTitle",{defaultMessage:"Policy ID"}),Sn=g.i18n.translate("xpack.fleet.uninstallTokenList.createdAtTitle",{defaultMessage:"Created at"}),In=g.i18n.translate("xpack.fleet.uninstallTokenList.tokenTitle",{defaultMessage:"Token"}),Tn=g.i18n.translate("xpack.fleet.uninstallTokenList.actionsTitle",{defaultMessage:"Actions"}),On=g.i18n.translate("xpack.fleet.uninstallTokenList.viewUninstallCommandLabel",{defaultMessage:"View uninstall command"}),wn=g.i18n.translate("xpack.fleet.uninstallTokenList.searchByPolicyPlaceholder",{defaultMessage:"Search by policy ID"}),jn=({policyId:e})=>n.a.createElement(u.EuiText,{size:"s",className:"eui-textTruncate",title:e,"data-test-subj":"uninstallTokensPolicyIdField"},e),Cn=({onClick:e})=>n.a.createElement(u.EuiToolTip,{content:On},n.a.createElement(u.EuiButtonIcon,{"data-test-subj":"uninstallTokensViewCommandButton","aria-label":On,onClick:e,iconType:"inspect",color:"text"})),Pn=({isLoading:e})=>e?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.uninstallTokenList.loadingTokensMessage",defaultMessage:"Loading uninstall tokens..."}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.uninstallTokenList.emptyMessage",defaultMessage:"No uninstall tokens found."}),An=()=>{var e,t;Object(c.wb)("uninstall_tokens");const[a,i]=Object(l.useState)(""),[s,r]=Object(l.useState)(null),{pagination:o,setPagination:g,pageSizeOptions:m}=Object(c.ec)(),{isLoading:p,data:E}=Object(Fn.c)({perPage:o.pageSize,page:o.currentPage,policyId:a}),f=null!==(e=null==E?void 0:E.items)&&void 0!==e?e:[],b=null!==(t=null==E?void 0:E.total)&&void 0!==t?t:0,h=Object(l.useMemo)((()=>[{field:"policy_id",name:Mn,render:e=>n.a.createElement(jn,{policyId:e})},{field:"created_at",name:Sn,width:"130px",render:e=>e?n.a.createElement(d.FormattedDate,{year:"numeric",month:"short",day:"2-digit",value:e}):null},{field:"id",name:In,width:"300px",render:e=>n.a.createElement(bn,{apiKeyId:e,sendGetAPIKey:Fn.a,tokenGetter:e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.item.token},length:32})},{field:"actions",name:Tn,align:"center",width:"70px",render:(e,{id:t})=>n.a.createElement(Cn,{onClick:()=>r(t)})}]),[]),y=Object(l.useCallback)((({page:e})=>{g((t=>({...t,currentPage:e.index+1,pageSize:e.size})))}),[g]),k=Object(l.useCallback)((e=>{i(e),g((e=>({...e,currentPage:1})))}),[g]);return n.a.createElement(S.a,{section:"uninstall_tokens"},s&&n.a.createElement(F.y,{onClose:()=>r(null),target:"agent",uninstallTokenId:s}),n.a.createElement(u.EuiText,{color:"subdued",size:"s"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.uninstallTokenList.pageDescription",defaultMessage:"Uninstall token allows you to get the uninstall command if you need to uninstall the Agent/Endpoint on the Host."})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFieldSearch,{onSearch:k,incremental:!0,fullWidth:!0,placeholder:wn,"data-test-subj":"uninstallTokensPolicyIdSearchInput"}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiBasicTable,{"data-test-subj":"uninstallTokenListTable",items:f,columns:h,itemId:"id",loading:p,pagination:{pageIndex:o.currentPage-1,pageSize:o.pageSize,totalItemCount:b,pageSizeOptions:m},onChange:y,noItemsMessage:n.a.createElement(Pn,{isLoading:p}),hasActions:!0}),n.a.createElement(u.EuiSpacer,{size:"xl"}))},Ln=p()(u.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-1t6qzy1-0"})(["max-width:250px;"]),_n=p()(u.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-1t6qzy1-1"})(["min-width:0px;"]),Dn=({fleetServerHosts:e,deleteFleetServerHost:t})=>{const{getHref:a}=Object(c.cc)(),i=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(Ln,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIconTip,{content:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.managedTooltip",{defaultMessage:"This Fleet server host is managed outside of Fleet. Please refer to your kibana config file for more info."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,field:"host_urls",render:e=>n.a.createElement(_n,{direction:"column",gutterSize:"xs"},e.map((e=>n.a.createElement(u.EuiFlexItem,{key:e},n.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.hostUrlsColumnTitle",{defaultMessage:"Host URLs"})},{render:e=>e.is_default?n.a.createElement(u.EuiIcon,{type:"check","data-test-subj":"fleetServerHostTable.defaultIcon"}):null,width:"200px",name:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const l=!e.is_default&&!e.is_preconfigured;return n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},l&&n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"fleetServerHostsTable.delete.btn"})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_fleet_server_hosts",{itemId:e.id}),title:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"fleetServerHostsTable.edit.btn"})))},name:g.i18n.translate("xpack.fleet.settings.fleetServerHostsTable.actionsColumnTitle",{defaultMessage:"Actions"})}]),[a,t]);return n.a.createElement(u.EuiBasicTable,{columns:i,items:e})},Bn=({fleetServerHosts:e,deleteFleetServerHost:t})=>{var a;const{docLinks:l}=Object(c.lc)(),{getHref:i}=Object(c.cc)(),s=!0!==(null===(a=Object(c.zb)().internal)||void 0===a?void 0:a.fleetServerStandalone);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h4",{"data-test-subj":"fleetServerHostHeader"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionTitle",defaultMessage:"Fleet server hosts"}))),n.a.createElement(u.EuiSpacer,{size:"xs"}),n.a.createElement(u.EuiText,{color:"subdued",size:"m"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostSectionSubtitle",defaultMessage:"Specify the URLs that your agents will use to connect to a Fleet Server. If multiple URLs exist, Fleet will show the first provided URL for enrollment purposes. For more information, see the {guideLink} .",values:{guideLink:n.a.createElement(u.EuiLink,{href:l.links.fleet.guide,target:"_blank",external:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetUserGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Dn,{fleetServerHosts:e,deleteFleetServerHost:t}),s&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiButtonEmpty,{iconType:"plusInCircle",href:i("settings_create_fleet_server_hosts"),"data-test-subj":"settings.fleetServerHosts.addFleetServerHostBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostCreateButtonLabel",defaultMessage:"Add Fleet Server"}))),n.a.createElement(u.EuiSpacer,{size:"m"}))},Rn=({output:e,showBadge:t})=>{var a,i;const{notifications:s}=Object(c.lc)(),[r,o]=Object(l.useState)(),{data:m}=Object(b.useQuery)(["outputHealth",e.id],(()=>Object(c.G)(e.id)),{refetchInterval:1e4});Object(l.useEffect)((()=>{null!=m&&m.error&&s.toasts.addError(null==m?void 0:m.error,{title:g.i18n.translate("xpack.fleet.output.errorFetchingOutputHealth",{defaultMessage:"Error fetching output state"})}),o(null==m?void 0:m.data)}),[m,s.toasts]);const p={DEGRADED:n.a.createElement(u.EuiCallOut,{title:"Error",color:"danger",iconType:"error","data-test-subj":"outputHealthDegradedCallout"},n.a.createElement("p",{className:"eui-textBreakWord"},g.i18n.translate("xpack.fleet.output.calloutText",{defaultMessage:'Unable to connect to "{name}" at {host}.',values:{name:e.name,host:null!==(a=null===(i=e.hosts)||void 0===i?void 0:i.join(","))&&void 0!==a?a:""}})),n.a.createElement("p",null,g.i18n.translate("xpack.fleet.output.calloutPromptText",{defaultMessage:"Please check the details are correct."}))),HEALTHY:n.a.createElement(u.EuiCallOut,{title:"Healthy",color:"success",iconType:"check","data-test-subj":"outputHealthHealthyCallout"},n.a.createElement("p",null,g.i18n.translate("xpack.fleet.output.successCalloutText",{defaultMessage:"Connection with remote output established."})))},E={DEGRADED:n.a.createElement(u.EuiBadge,{color:"danger","data-test-subj":"outputHealthDegradedBadge"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.outputHealth.degradedStatusText",defaultMessage:"Unhealthy"})),HEALTHY:n.a.createElement(u.EuiBadge,{color:"success","data-test-subj":"outputHealthHealthyBadge"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.outputHealth.healthyStatusText",defaultMessage:"Healthy"}))},f=new Date((null==r?void 0:r.timestamp)||0).getTime(),h=f?n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.outputHealth.timestampTooltipText",defaultMessage:"Last reported {timestamp}",values:{timestamp:n.a.createElement(d.FormattedRelative,{value:f})}})):null,y=(null==r?void 0:r.state)&&E[null==r?void 0:r.state]||null;return t?h&&null!=r&&r.state?n.a.createElement(u.EuiToolTip,{position:"top",content:h,"data-test-subj":"outputHealthBadgeTooltip"},n.a.createElement(n.a.Fragment,null,y," ")):y:(null==r?void 0:r.state)&&p[r.state]||null},zn=n.a.memo((({output:e})=>{const t=Object(l.useMemo)((()=>{const t=[];return e.is_default&&t.push(n.a.createElement(Nn,{key:"default-output"})),e.is_default_monitoring&&t.push(n.a.createElement(Un,{key:"default-monitoring-output"})),t}),[e]);return n.a.createElement(u.EuiBadgeGroup,{gutterSize:"xs"},t.map(((e,t)=>e)))})),Nn=()=>n.a.createElement(u.EuiBadge,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultOutputBadgeTitle",defaultMessage:"Agent integrations"})),Un=()=>n.a.createElement(u.EuiBadge,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.outputs.defaultMonitoringOutputBadgeTitle",defaultMessage:"Agent monitoring"})),Hn=p()(u.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-uvxtm0-0"})(["max-width:250px;"]),qn=p()(u.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-uvxtm0-1"})(["min-width:0px;"]),Gn=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(c.cc)(),i=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(Hn,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate"},e.name)),e.is_preconfigured&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIconTip,{content:g.i18n.translate("xpack.fleet.settings.outputsTable.managedTooltip",{defaultMessage:"This output is managed outside of Fleet."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:g.i18n.translate("xpack.fleet.settings.outputsTable.nameColumnTitle",{defaultMessage:"Name"})},{width:"172px",render:e=>function(e){switch(e){case"elasticsearch":return g.i18n.translate("xpack.fleet.settings.outputsTable.elasticsearchTypeLabel",{defaultMessage:"Elasticsearch"});case"remote_elasticsearch":return g.i18n.translate("xpack.fleet.settings.outputsTable.remoteElasticsearchTypeLabel",{defaultMessage:"Remote Elasticsearch"});default:return e}}(e.type),name:g.i18n.translate("xpack.fleet.settings.outputsTable.typeColumnTitle",{defaultMessage:"Type"})},{truncateText:!0,render:e=>n.a.createElement(qn,{direction:"column",gutterSize:"xs"},(e.hosts||[]).map((e=>n.a.createElement(u.EuiFlexItem,{key:e},n.a.createElement("p",{title:e,className:"eui-textTruncate"},e))))),name:g.i18n.translate("xpack.fleet.settings.outputsTable.hostColumnTitle",{defaultMessage:"Hosts"})},{render:e=>null!=e&&e.id&&"remote_elasticsearch"===e.type?n.a.createElement(Rn,{output:e,showBadge:!0}):null,name:g.i18n.translate("xpack.fleet.settings.outputsTable.statusColumnTitle",{defaultMessage:"Status"})},{render:e=>n.a.createElement(zn,{output:e}),width:"200px",name:g.i18n.translate("xpack.fleet.settings.outputSection.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const l=!e.is_default&&!e.is_default_monitoring&&!e.is_preconfigured;return n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},l&&n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:g.i18n.translate("xpack.fleet.settings.outputSection.deleteButtonTitle",{defaultMessage:"Delete"})})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_outputs",{outputId:e.id}),title:g.i18n.translate("xpack.fleet.settings.outputSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editOutputBtn"})))},name:g.i18n.translate("xpack.fleet.settings.outputSection.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,a]);return n.a.createElement(u.EuiBasicTable,{columns:i,items:e})},Wn=({outputs:e,deleteOutput:t})=>{const{getHref:a}=Object(c.cc)(),{docLinks:l}=Object(c.lc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h4",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.outputSectionTitle",defaultMessage:"Outputs"}))),n.a.createElement(u.EuiSpacer,{size:"xs"}),n.a.createElement(u.EuiText,{color:"subdued",size:"m"},n.a.createElement(u.EuiLink,{href:l.links.fleet.settings,external:!0,target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.outputSectionSubtitle",defaultMessage:"Specify where agents will send data."}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Gn,{outputs:e,deleteOutput:t}),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_outputs"),"data-test-subj":"addOutputBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.outputCreateButtonLabel",defaultMessage:"Add output"})))},Kn=p()(u.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-xsf6c1-0"})(["max-width:250px;"]),$n=p()(u.EuiFlexGroup).withConfig({displayName:"FlexGroupWithMinWidth",componentId:"sc-xsf6c1-1"})(["min-width:0px;"]),Vn=({downloadSources:e,deleteDownloadSource:t})=>{const{getHref:a}=Object(c.cc)(),i=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(Kn,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate","data-test-subj":"editDownloadSourceTable.name"},e.name))),width:"288px",name:g.i18n.translate("xpack.fleet.settings.downloadSourcesTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,render:e=>n.a.createElement($n,{direction:"column",gutterSize:"xs"},n.a.createElement(u.EuiFlexItem,{key:e.host},n.a.createElement("p",{title:e.host,className:"eui-textTruncate","data-test-subj":"editDownloadSourceTable.host"},e.host))),name:g.i18n.translate("xpack.fleet.settings.downloadSourcesTable.hostColumnTitle",{defaultMessage:"Host"})},{render:e=>e.is_default?n.a.createElement(u.EuiIcon,{type:"check","data-test-subj":"editDownloadSourceTable.defaultIcon"}):null,width:"200px",name:g.i18n.translate("xpack.fleet.settings.downloadSourcesTable.defaultColumnTitle",{defaultMessage:"Default"})},{width:"68px",render:e=>{const l=!e.is_default;return n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},l&&n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:g.i18n.translate("xpack.fleet.settings.downloadSourceSection.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"editDownloadSourceTable.delete.btn"})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_download_sources",{downloadSourceId:e.id}),title:g.i18n.translate("xpack.fleet.settings.downloadSourceSection.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"editDownloadSourceTable.edit.btn"})))},name:g.i18n.translate("xpack.fleet.settings.downloadSourceSection.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,a]);return n.a.createElement(u.EuiBasicTable,{columns:i,items:e,"data-test-subj":"AgentDownloadSourcesTable"})},Qn=({downloadSources:e,deleteDownloadSource:t})=>{const{getHref:a}=Object(c.cc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h4",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.Title",defaultMessage:"Agent Binary Download"}))),n.a.createElement(u.EuiSpacer,{size:"xs"}),n.a.createElement(u.EuiText,{color:"subdued",size:"m"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.Subtitle",defaultMessage:"Specify where the agents will download their binary from. Checked default will apply to all policies unless overwritten."})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Vn,{downloadSources:e,deleteDownloadSource:t}),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_download_sources"),"data-test-subj":"addDownloadSourcesBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.downloadSourcesSection.CreateButtonLabel",defaultMessage:"Add agent binary source"})))},Yn=p()(u.EuiFlexItem).withConfig({displayName:"NameFlexItemWithMaxWidth",componentId:"sc-czjc9c-0"})(["max-width:250px;"]),Jn=({proxies:e,deleteFleetProxy:t})=>{const{getHref:a}=Object(c.cc)(),i=Object(l.useMemo)((()=>[{render:e=>n.a.createElement(u.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},n.a.createElement(Yn,{grow:!1},n.a.createElement("p",{title:e.name,className:"eui-textTruncate","data-test-subj":"fleetProxiesTable.name"},e.name)),e.is_preconfigured&&n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiIconTip,{content:g.i18n.translate("xpack.fleet.settings.fleetProxiesTable.managedTooltip",{defaultMessage:"This proxy is managed outside of Fleet. Please refer to your kibana config file for more info."}),type:"lock",size:"m",color:"subdued"}))),width:"288px",name:g.i18n.translate("xpack.fleet.settings.fleetProxiesTable.nameColumnTitle",{defaultMessage:"Name"})},{truncateText:!0,field:"url",name:g.i18n.translate("xpack.fleet.settings.fleetProxiesTable.urlColumnTitle",{defaultMessage:"Url"})},{width:"68px",render:e=>{const l=!e.is_preconfigured;return n.a.createElement(u.EuiFlexGroup,{gutterSize:"s",justifyContent:"flexEnd"},n.a.createElement(u.EuiFlexItem,{grow:!1},l&&n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"trash",onClick:()=>t(e),title:g.i18n.translate("xpack.fleet.settings.fleetProxiesTable.deleteButtonTitle",{defaultMessage:"Delete"}),"data-test-subj":"fleetProxiesTable.delete.btn"})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonIcon,{color:"text",iconType:"pencil",href:a("settings_edit_fleet_proxy",{itemId:e.id}),title:g.i18n.translate("xpack.fleet.settings.fleetProxiesTable.editButtonTitle",{defaultMessage:"Edit"}),"data-test-subj":"fleetProxiesTable.edit.btn"})))},name:g.i18n.translate("xpack.fleet.settings.fleetProxiesTable.actionsColumnTitle",{defaultMessage:"Actions"})}]),[t,a]);return n.a.createElement(u.EuiBasicTable,{columns:i,items:e,"data-test-subj":"fleetProxiesTable"})},Zn=({proxies:e,deleteFleetProxy:t})=>{const{getHref:a}=Object(c.cc)();return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFlexGroup,{gutterSize:"xs"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h4",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.title",defaultMessage:"Proxies"})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiBetaBadge,{label:"beta"}))),n.a.createElement(u.EuiText,{color:"subdued",size:"m"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.subtitle",defaultMessage:"Specify any proxy URLs to be used in Fleet servers, Outputs or Agent binary download sources."})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Jn,{proxies:e,deleteFleetProxy:t}),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiButtonEmpty,{iconType:"plusInCircle",href:a("settings_create_fleet_proxy"),"data-test-subj":"addProxyBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxiesSection.CreateButtonLabel",defaultMessage:"Add proxy"})))},Xn=({outputs:e,proxies:t,fleetServerHosts:a,deleteOutput:l,deleteFleetServerHost:i,downloadSources:s,deleteDownloadSource:r,deleteFleetProxy:o})=>{var d;const g=!0!==(null===(d=Object(c.zb)().internal)||void 0===d?void 0:d.disableProxies);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Bn,{fleetServerHosts:a,deleteFleetServerHost:i}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Wn,{outputs:e,deleteOutput:l}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Qn,{downloadSources:s,deleteDownloadSource:r}),g&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Zn,{proxies:t,deleteFleetProxy:o})))};var ei=a(125),ti=a(131);const ai=670,li=({label:e,inputProps:t,placeholder:a,dataTestSubj:l})=>n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:e},t.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":l,fullWidth:!0},t.props,{placeholder:a}))),ni=({label:e,inputProps:t,placeholder:a,dataTestSubj:l})=>n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:e},t.formRowProps),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5,"data-test-subj":l},t.props,{placeholder:a})));var ii=a(196);const si=({onClose:e,fleetServerHost:t,proxies:a})=>{const{docLinks:i}=Object(c.lc)(),s=Object(ii.a)(t,e),{inputs:r}=s,o=Object(l.useMemo)((()=>a.map((e=>({value:e.id,label:e.name})))),[a]);return n.a.createElement(u.EuiFlyout,{maxWidth:ai,onClose:e},n.a.createElement(u.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(u.EuiTitle,{size:"m"},n.a.createElement("h2",null,t?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.editTitle",defaultMessage:"Edit Fleet Server"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.addTitle",defaultMessage:"Add Fleet Server"})))),n.a.createElement(u.EuiFlyoutBody,null,n.a.createElement(u.EuiCallOut,{size:"m",color:"warning",iconType:"warning",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.warningCalloutTitle",defaultMessage:"Changing these settings can break your agent connections"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.warningCalloutDescription",defaultMessage:"Invalid settings can break the connection between Elastic Agent and Fleet Server. If this happens, you will need to re-enroll your agents."})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiForm,{onSubmit:s.submit},n.a.createElement(li,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.nameInputLabel",defaultMessage:"Name"}),inputProps:r.nameInput,dataTestSubj:"fleetServerHostsFlyout.nameInput",placeholder:g.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.hostUrlLabel",defaultMessage:"URL"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{color:"subdued",size:"relative"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.description",defaultMessage:"Specify multiple URLs to scale out your deployment and provide automatic failover. If multiple URLs exist, Fleet shows the first provided URL for enrollment purposes. Enrolled Elastic Agents will connect to the URLs in round robin order until they connect successfully. For more information, see the {link} .",values:{link:n.a.createElement(u.EuiLink,{href:i.links.fleet.settingsFleetServerHostSettings,target:"_blank",external:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.userGuideLink",defaultMessage:"Fleet and Elastic Agent Guide"}))}})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(ti.a,w()({},s.inputs.hostUrlsInput.props,{id:"fleet-server-inputs",placeholder:g.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.fleetServerHostsInputPlaceholder",{defaultMessage:"Specify host URL"}),isUrl:!0})))),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.proxyIdLabel",defaultMessage:"Proxy"})},n.a.createElement(u.EuiComboBox,w()({fullWidth:!0,"data-test-subj":"fleetServerHostsFlyout.proxyIdInput"},r.proxyIdInput.props,{onChange:e=>{var t,a;return r.proxyIdInput.setValue(null!==(t=null==e||null===(a=e[0])||void 0===a?void 0:a.value)&&void 0!==t?t:"")},selectedOptions:""!==r.proxyIdInput.value?o.filter((e=>e.value===r.proxyIdInput.value)):[],options:o,singleSelection:{asPlainText:!0},isClearable:!0,placeholder:g.i18n.translate("xpack.fleet.settings.fleetServerHostsFlyout.proxyIdPlaceholder",{defaultMessage:"Select proxy"})}))),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},r.isDefaultInput.formRowProps),n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"fleetServerHostsFlyout.isDefaultSwitch"},r.isDefaultInput.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this Fleet server the default one."})}))))),n.a.createElement(u.EuiFlyoutFooter,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{fill:!0,isLoading:s.isLoading,isDisabled:s.isDisabled,onClick:s.submit,"data-test-subj":"saveApplySettingsBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},ri=()=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetProxy.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),oi=({})=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetProxy.confirmModalText",defaultMessage:"This action will change agent policies currently using that proxy. Are you sure you wish to continue?"});async function ci(e){var t,a,l;let n=`${M.c}.data_output_id:"${e.id}" or ${M.c}.monitoring_output_id:"${e.id}"`;e.is_default&&(n+=` or (not ${M.c}.data_output_id:*)`);const i=await Object(c.v)({kuery:n,page:1,perPage:M.p});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(l=a.items)||void 0===l?void 0:l.length)&&void 0!==t?t:0;let r=0;if(s>0){var o,u,d;const e=await Object(c.z)({page:1,perPage:0,showInactive:!1,kuery:null===(o=i.data)||void 0===o?void 0:o.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const ui=()=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),di=({output:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.confirmModalText",defaultMessage:"This action will delete {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),gi=()=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetServerHosts.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),mi=({})=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteFleetServerHosts.confirmModalText",defaultMessage:"This action will change agent policies currently enrolled in this Fleet Server, to instead enroll in your default Fleet server. Are you sure you wish to continue?"});async function pi(e){var t,a,l;let n=`${M.c}.download_source_id:"${e.id}"`;e.is_default&&(n+=` or (not ${M.c}.download_source_id:*)`);const i=await Object(c.v)({kuery:n,page:1,perPage:M.p});if(i.error)throw i.error;const s=null!==(t=null===(a=i.data)||void 0===a||null===(l=a.items)||void 0===l?void 0:l.length)&&void 0!==t?t:0;let r=0;if(s>0){var o,u,d;const e=await Object(c.z)({page:1,perPage:0,showInactive:!1,kuery:null===(o=i.data)||void 0===o?void 0:o.items.map((e=>`policy_id:"${e.id}"`)).join(" or ")});if(e.error)throw e.error;r=null!==(u=null===(d=e.data)||void 0===d?void 0:d.total)&&void 0!==u?u:0}return{agentPolicyCount:s,agentCount:r}}const Ei=({downloadSource:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.confirmModalText","data-test-subj":"editDownloadSourcesConfirmModal.confirmModalText",defaultMessage:"This action will update {downloadSourceName} agent binary source. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{downloadSourceName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}});function fi(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function bi(e){try{if(!e)return[g.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.HostIsRequiredErrorMessage",{defaultMessage:"Host is required"})];const t=new URL(e);if(!["http:","https:"].includes(t.protocol))throw new Error("Invalid protocol")}catch(e){return[g.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.hostError",{defaultMessage:"Invalid URL"})]}}const hi=({onClose:e,downloadSource:t,proxies:a})=>{Object(c.wb)("settings");const i=function(e,t){var a,i,s,r;const[o,u]=Object(l.useState)(!1),{notifications:m}=Object(c.lc)(),{confirm:p}=Object(ei.a)(),E=Object(c.Wb)(null!==(a=null==t?void 0:t.name)&&void 0!==a?a:"",fi),f=Object(c.mc)(null!==(i=null==t?void 0:t.is_default)&&void 0!==i&&i,null==t?void 0:t.is_default),b=Object(c.Wb)(null!==(s=null==t?void 0:t.host)&&void 0!==s?s:"",bi),h=Object(c.Wb)(null!==(r=null==t?void 0:t.proxy_id)&&void 0!==r?r:"",(()=>{})),y={nameInput:E,hostInput:b,defaultDownloadSourceInput:f,proxyIdInput:h},k=Object.values(y).some((e=>e.hasChanged)),v=Object(l.useCallback)((()=>{const e=E.validate(),t=b.validate();return e&&t}),[E,b]),x=Object(l.useCallback)((async()=>{try{if(!v())return;u(!0);const a={name:E.value.trim(),host:b.value.trim(),is_default:f.value,proxy_id:h.value||null};if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:l}=await pi(e);return t(n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateDownloadSourceModal.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),n.a.createElement(Ei,{agentCount:a,agentPolicyCount:l,downloadSource:e}))}(t,p))return void u(!1);const e=await Object(c.gb)(t.id,a);if(e.error)throw e.error}else{const e=await Object(c.X)(a);if(e.error)throw e.error}e(),u(!1)}catch(e){u(!1),m.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.dowloadSourceFlyoutForm.errorToastTitle",{defaultMessage:"Error while saving binary source"})})}}),[p,f.value,t,b.value,E.value,m.toasts,e,h.value,v]);return{inputs:y,submit:x,isLoading:o,isDisabled:o||t&&!k}}(e,t),s=i.inputs,{docLinks:r}=Object(c.lc)(),o=Object(l.useMemo)((()=>a.map((e=>({value:e.id,label:e.name})))),[a]);return n.a.createElement(u.EuiFlyout,{maxWidth:ai,onClose:e},n.a.createElement(u.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(u.EuiTitle,{size:"m"},n.a.createElement("h2",{id:"FleetEditDownloadSourcesFlyoutTitle"},t?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.editTitle",defaultMessage:"Edit agent binary source","data-test-subj":"editDownloadSourcesFlyout.edit.title"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.createTitle",defaultMessage:"Add new agent binary source","data-test-subj":"editDownloadSourcesFlyout.add.title"})))),n.a.createElement(u.EuiFlyoutBody,null,n.a.createElement(u.EuiForm,null,n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.nameInputLabel",defaultMessage:"Name"})},s.nameInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"editDownloadSourcesFlyout.nameInput",fullWidth:!0},s.nameInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,helpText:n.a.createElement(d.FormattedMessage,{"data-test-subj":"editDownloadSourcesFlyout.hostHelpText",id:"xpack.fleet.settings.editDownloadSourcesFlyout.hostsInputDescription",defaultMessage:"Address that your agents will use to download their binary from. Specify the path to the directory containing the binary. {guideLink}",values:{guideLink:n.a.createElement(u.EuiLink,{href:r.links.fleet.settings,target:"_blank",external:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.hostInputLabel",defaultMessage:"Host"})},s.hostInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"editDownloadSourcesFlyout.hostInput",fullWidth:!0},s.hostInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.hostsInputPlaceholder",{defaultMessage:"Specify host"})}))),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.proxyIdLabel",defaultMessage:"Proxy {badge}",values:{badge:n.a.createElement(u.EuiBetaBadge,{size:"s",className:"eui-alignTop",label:g.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.proxyIdBetaBadge",{defaultMessage:"Beta"})})}}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.proxyInputDescription",defaultMessage:"Proxy used for accessing the download source. Currently only the proxy URL is used, headers and certificates are not supported."})},n.a.createElement(u.EuiComboBox,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.proxyIdInput"},s.proxyIdInput.props,{onChange:e=>{var t,a;return s.proxyIdInput.setValue(null!==(t=null==e||null===(a=e[0])||void 0===a?void 0:a.value)&&void 0!==t?t:"")},selectedOptions:""!==s.proxyIdInput.value?o.filter((e=>e.value===s.proxyIdInput.value)):[],options:o,singleSelection:{asPlainText:!0},isDisabled:s.proxyIdInput.props.disabled,isClearable:!0,placeholder:g.i18n.translate("xpack.fleet.settings.editDownloadSourcesFlyout.proxyIdPlaceholder",{defaultMessage:"Select proxy"})}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},s.defaultDownloadSourceInput.formRowProps),n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"editDownloadSourcesFlyout.isDefaultSwitch"},s.defaultDownloadSourceInput.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.defaultSwitchLabel",defaultMessage:"Make this host the default for all agent policies."})}))))),n.a.createElement(u.EuiFlyoutFooter,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:e,flush:"left","data-test-subj":"editDownloadSourcesFlyout.cancelBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{fill:!0,isLoading:i.isLoading,isDisabled:i.isDisabled,onClick:i.submit,"data-test-subj":"editDownloadSourcesFlyout.submitBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editDownloadSourcesFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))},yi=()=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.confirmModalTitle",defaultMessage:"Delete and deploy changes?"}),ki=({downloadSource:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.confirmModalText",defaultMessage:"This action will delete {downloadSourceName} agent binary source. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{downloadSourceName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.deleteDowloadSource.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),vi=/^(http)(s)?:\/\/[^\s$.?#].[^\s]*$/gm,xi=()=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),Fi=({})=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.confirmModalText",defaultMessage:"This action will update agent policies using that proxies. This action can not be undone. Are you sure you wish to continue?"});function Mi(e){return e&&""!==e?e.match(vi)?void 0:[g.i18n.translate("xpack.fleet.settings.fleetProxyFlyoutUrlError",{defaultMessage:"Invalid URL"})]:[g.i18n.translate("xpack.fleet.settings.fleetProxyFlyoutUrlRequired",{defaultMessage:"URL is required"})]}function Si(e){if(e&&""!==e){const t=Object(el.safeLoad)(e);if("object"!=typeof t||Object.values(t).some((e=>{const t=typeof e;return"string"!==t&&"number"!==t&&"boolean"!==t})))return[g.i18n.translate("xpack.fleet.settings.fleetProxy.proxyHeadersErrorMessage",{defaultMessage:"Proxy headers is not a valid key: value object."})]}}function Ii(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.fleetProxy.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}const Ti=({onClose:e,fleetProxy:t})=>{const a=function(e,t){var a,i,s,r,o,u;const[d,m]=Object(l.useState)(!1),{notifications:p}=Object(c.lc)(),{confirm:E}=Object(ei.a)(),f=null!==(a=null==e?void 0:e.is_preconfigured)&&void 0!==a&&a,b=Object(c.Wb)(null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"",Ii,f),h=Object(c.Wb)(null!==(s=null==e?void 0:e.url)&&void 0!==s?s:"",Mi,f),y=Object(c.Wb)(null!=e&&e.proxy_headers?Object(el.safeDump)(e.proxy_headers):"",Si,f),k=Object(c.Wb)(null!==(r=null==e?void 0:e.certificate_authorities)&&void 0!==r?r:"",(()=>{}),f),v=Object(c.Wb)(null!==(o=null==e?void 0:e.certificate)&&void 0!==o?o:"",(()=>{}),f),x=Object(c.Wb)(null!==(u=null==e?void 0:e.certificate_key)&&void 0!==u?u:"",(()=>{}),f),F=Object(l.useMemo)((()=>({nameInput:b,urlInput:h,proxyHeadersInput:y,certificateAuthoritiesInput:k,certificateInput:v,certificateKeyInput:x})),[b,h,y,k,v,x]),M=Object(l.useCallback)((()=>Object(c.qc)(F)),[F]),S=Object(l.useCallback)((async()=>{try{if(!M())return;if(e&&!await E(n.a.createElement(xi,null),n.a.createElement(Fi,null)))return;m(!0);const a={name:b.value,url:h.value,proxy_headers:""===y.value?void 0:Object(el.safeLoad)(y.value),certificate_authorities:k.value,certificate:v.value,certificate_key:x.value};if(e){const t=await Object(c.hb)(e.id,a);if(t.error)throw t.error}else{const e=await Object(c.Y)(a);if(e.error)throw e.error}p.toasts.addSuccess(g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.successToastTitle",{defaultMessage:"Fleet proxy saved"})),m(!1),await t()}catch(e){m(!1),p.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.errorToastTitle",{defaultMessage:"An error happened while saving Fleet Server host"})})}}),[e,b.value,h.value,y.value,k.value,v.value,x.value,M,p,E,t]),I=Object.values(F).some((e=>e.hasChanged));return{isLoading:d,isDisabled:d||!I||b.props.isInvalid||h.props.isInvalid,submit:S,inputs:F}}(t,e),{inputs:i}=a;return n.a.createElement(u.EuiFlyout,{maxWidth:ai,onClose:e},n.a.createElement(u.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(u.EuiTitle,{size:"m"},n.a.createElement("h2",null,t?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.editTitle",defaultMessage:"Edit Proxy"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.addTitle",defaultMessage:"Add Proxy"})))),n.a.createElement(u.EuiFlyoutBody,null,n.a.createElement(u.EuiForm,{onSubmit:a.submit},n.a.createElement(li,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.nameInputLabel",defaultMessage:"Name"}),inputProps:i.nameInput,"data-test-subj":"fleetProxyFlyout.nameInput",placeholder:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}),n.a.createElement(li,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.urlInputLabel",defaultMessage:"Proxy Url"}),dataTestSubj:"fleetProxyFlyout.urlInput",inputProps:i.urlInput,placeholder:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.urlInputPlaceholder",{defaultMessage:"Specify proxy url"})}),n.a.createElement(ni,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.proxyHeadersLabel",defaultMessage:"Proxy headers"}),dataTestSubj:"fleetProxyFlyout.proxyHeadersInput",inputProps:i.proxyHeadersInput,placeholder:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.proxyHeadersPlaceholder",{defaultMessage:"Specify proxy headers"})}),n.a.createElement(li,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.certificateAuthoritiesLabel",defaultMessage:"Certificate authorities"}),dataTestSubj:"fleetProxyFlyout.certificateAuthoritiesInput",inputProps:i.certificateAuthoritiesInput,placeholder:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.certificateAuthoritiesPlaceholder",{defaultMessage:"Specify certificate authorities"})}),n.a.createElement(li,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.certificateLabel",defaultMessage:"Certificate"}),dataTestSubj:"fleetProxyFlyout.certificateInput",inputProps:i.certificateInput,placeholder:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.certificatePlaceholder",{defaultMessage:"Specify certificate"})}),n.a.createElement(li,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.certificateKeyLabel",defaultMessage:"Certificate key"}),dataTestSubj:"fleetProxyFlyout.certificateKeyInput",inputProps:i.certificateKeyInput,placeholder:g.i18n.translate("xpack.fleet.settings.fleetProxyFlyout.certificateKeyPlaceholder",{defaultMessage:"Specify certificate key"})}))),n.a.createElement(u.EuiFlyoutFooter,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:()=>e(),flush:"left"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{fill:!0,isLoading:a.isLoading,isDisabled:a.isDisabled,onClick:a.submit,"data-test-subj":"saveApplySettingsBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetProxyFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))};var Oi=a(61);const wi=e=>{const{inputs:t}=e,{props:{onChange:a,id:i},value:s,formRowProps:{error:r}}=t.kafkaTopicsInput,o=Object(m.useTheme)(),[c,E]=Object(l.useState)(!1),{docLinks:f}=Object(fl.Rc)(),b=Object(l.useMemo)((()=>r?r.reduce(((e,t)=>(void 0===t.index||(e[t.index]||(e[t.index]=[]),t.condition||e[t.index].push(t.message)),e)),[]):[]),[r]),h=Object(l.useMemo)((()=>r?r.reduce(((e,t)=>(void 0===t.index||(e[t.index]||(e[t.index]=[]),t.condition&&e[t.index].push(t.message)),e)),[]):[]),[r]),y=Object(l.useCallback)(((e,t,l)=>{const n=s.map(((a,n)=>n===e?"topic"===t?{...a,topic:l}:{...a,when:{...a.when||{},..."condition"===t?{condition:l}:{},..."type"===t?{type:l}:{}}}:a));a(n)}),[s,a]),k=Object(l.useCallback)((()=>{E(!0);const e=[...s,{topic:"",when:{type:D.Lb.Contains}}];a(e)}),[s,a]),v=Object(l.useCallback)((e=>{const t=s.filter(((t,a)=>a!==e));b.splice(e,1),h.splice(e,1),a(t)}),[s,b,h,a]),x=e=>null!=e&&e.length?e.map(((e,t)=>n.a.createElement(u.EuiFormErrorText,{key:t},e))):null,F=Object(l.useMemo)((()=>r&&r.filter((e=>void 0===e.index)).map((({message:e})=>e))),[r]),M=Object(l.useMemo)((()=>Object.keys(D.Lb).map((e=>({text:D.Lb[e],label:e})))),[]),S=p.a.div.withConfig({displayName:"DraggableDiv",componentId:"sc-v0mmey-0"})(["margin:",";"],(e=>e.theme.eui.euiSizeS)),I=Object(l.useCallback)((({source:e,destination:t})=>{if(e&&t){const l=Object(u.euiDragDropReorder)(s,e.index,t.index),n=b[e.index];b.splice(e.index,1),b.splice(t.index,0,n);const i=h[e.index];h.splice(e.index,1),h.splice(t.index,0,i),a(l)}}),[s,b,h,a]);return n.a.createElement(u.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaTopicsPanel"},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaHeaders"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaTopcisTitle",defaultMessage:"Topics"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaTopicsDefaultTopicLabel",defaultMessage:"Default topic"})},t.kafkaDefaultTopicInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaDefaultTopicInput",fullWidth:!0},t.kafkaDefaultTopicInput.props))),s.length>0&&n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaTopicsProcessorsLabel",defaultMessage:"Processors"}),n.a.createElement(u.EuiText,{color:"subdued",size:"xs"},n.a.createElement("i",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaTopicsProcessorsHelpText",defaultMessage:"For more information read the {link}.",values:{link:n.a.createElement(u.EuiLink,{href:f.links.fleet.kafkaSettings,target:"_blank"},"documentation")}}))))},s.length>1?n.a.createElement(u.EuiDragDropContext,{onDragEnd:I},n.a.createElement(u.EuiDroppable,{droppableId:`${i}Droppable`,spacing:"none"},s.map(((e,t)=>{const a=b[t],l=h[t];return n.a.createElement(n.a.Fragment,{key:t},n.a.createElement(u.EuiDraggable,{spacing:"m",index:t,draggableId:`${i}${t}Draggable`,customDragHandle:!0,style:{paddingLeft:0,paddingRight:0}},((i,s)=>{var r,d,m,p,E,f;return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiFlexGroup,{gutterSize:"none",wrap:!0,style:s.isDragging?{background:o.eui.euiPanelBackgroundColorModifiers.plain}:{}},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(S,w()({"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorDragHandle${t}`},i.dragHandleProps,{"aria-label":g.i18n.translate("xpack.fleet.settings.sortHandle",{defaultMessage:"Sort host handle"})}),n.a.createElement(u.EuiIcon,{color:"text",type:"grab"}))),n.a.createElement(u.EuiFlexItem,{style:{flex:"30%",paddingRight:10}},n.a.createElement(u.EuiFormRow,{fullWidth:!0},n.a.createElement(u.EuiSelect,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorWhenInput${t}`,fullWidth:!0,options:M,value:null===(r=e.when)||void 0===r?void 0:r.type,onChange:e=>y(t,"type",e.target.value)}))),n.a.createElement(u.EuiFlexItem,{style:{flex:"40%"}},n.a.createElement(u.EuiFormRow,{fullWidth:!0,error:x(l),isInvalid:(null!==(d=null==l?void 0:l.length)&&void 0!==d?d:0)>0},n.a.createElement(u.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorConditionInput${t}`,value:null===(m=e.when)||void 0===m?void 0:m.condition,isInvalid:(null!==(p=null==l?void 0:l.length)&&void 0!==p?p:0)>0,onChange:e=>y(t,"condition",e.target.value)}))),n.a.createElement(u.EuiFlexItem,{grow:!1,style:{marginTop:10}},n.a.createElement(u.EuiButtonIcon,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorDeleteButton${t}`,color:"text",onClick:()=>v(t),iconType:"cross","aria-label":g.i18n.translate("xpack.fleet.multiRowInput.deleteButton",{defaultMessage:"Delete row"})})),n.a.createElement(u.EuiFlexItem,{style:{flex:"0 50%",marginLeft:"auto",marginRight:23,paddingTop:10}},n.a.createElement(u.EuiFormRow,{fullWidth:!0,error:x(a),isInvalid:(null!==(E=null==a?void 0:a.length)&&void 0!==E?E:0)>0},n.a.createElement(u.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorTopicInput${t}`,autoFocus:c,prepend:"Topic",value:e.topic,isInvalid:(null!==(f=null==a?void 0:a.length)&&void 0!==f?f:0)>0,onChange:e=>y(t,"topic",e.target.value)})))))})))})))):n.a.createElement(n.a.Fragment,null,s.map(((e,t)=>{var a,l,i,s,r,o;const d=b[t],m=h[t];return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiFlexGroup,{gutterSize:"none",wrap:!0},n.a.createElement(u.EuiFlexItem,{style:{flex:"30%",paddingRight:10}},n.a.createElement(u.EuiFormRow,{fullWidth:!0},n.a.createElement(u.EuiSelect,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorWhenInput${t}`,fullWidth:!0,options:M,value:null===(a=e.when)||void 0===a?void 0:a.type,onChange:e=>y(t,"type",e.target.value)}))),n.a.createElement(u.EuiFlexItem,{style:{flex:"40%"}},n.a.createElement(u.EuiFormRow,{fullWidth:!0,error:x(m),isInvalid:(null!==(l=null==m?void 0:m.length)&&void 0!==l?l:0)>0},n.a.createElement(u.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorConditionInput${t}`,value:null===(i=e.when)||void 0===i?void 0:i.condition,isInvalid:(null!==(s=null==m?void 0:m.length)&&void 0!==s?s:0)>0,onChange:e=>y(t,"condition",e.target.value)}))),n.a.createElement(u.EuiFlexItem,{grow:!1,style:{marginTop:10}},n.a.createElement(u.EuiButtonIcon,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorDeleteButton${t}`,color:"text",onClick:()=>v(t),iconType:"cross","aria-label":g.i18n.translate("xpack.fleet.multiRowInput.deleteButton",{defaultMessage:"Delete row"})})),n.a.createElement(u.EuiFlexItem,{style:{flex:"0 53%",marginLeft:"auto",marginRight:23,paddingTop:10}},n.a.createElement(u.EuiFormRow,{fullWidth:!0,error:x(d),isInvalid:(null!==(r=null==d?void 0:d.length)&&void 0!==r?r:0)>0},n.a.createElement(u.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaTopicsProcessorTopicInput${t}`,isInvalid:(null!==(o=null==d?void 0:d.length)&&void 0!==o?o:0)>0,autoFocus:c,prepend:"Topic",value:e.topic,onChange:e=>y(t,"topic",e.target.value)})))))})))),x(F),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiButtonEmpty,{"data-test-subj":"fleetServerHosts.kafkaTopicsInput.addRowButton",size:"xs",flush:"left",iconType:"plusInCircle",onClick:k},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.kafkaTopics.addTopicProcessor",defaultMessage:"Add topic processor"})),n.a.createElement(u.EuiSpacer,{size:"m"}))},ji=e=>{const{inputs:t}=e,{props:{onChange:a},value:i,formRowProps:{error:s}}=t.kafkaHeadersInput,[r,o]=Object(l.useState)(!1),c=Object(l.useCallback)(((e,t,l)=>{const n=i.map(((a,n)=>n===e?{...a,[t]:l}:a));a(n)}),[i,a]),m=Object(l.useCallback)((()=>{o(!0);const e=[...i,{key:"",value:""}];a(e)}),[i,a]),p=Object(l.useCallback)((e=>{const t=i.filter(((t,a)=>a!==e));a(t)}),[i,a]),E=1===i.length,f=1===i.length&&(""===i[0].key||""===i[0].value),b=e=>null!=e&&e.length?e.map(((e,t)=>n.a.createElement(u.EuiFormErrorText,{key:t},e))):null,h=Object(l.useMemo)((()=>(e,t)=>null==s?void 0:s.filter((a=>a.index===e&&("key"===t?a.hasKeyError:a.hasValueError))).map((e=>e.message))),[s]),y=Object(l.useMemo)((()=>s&&s.filter((e=>void 0===e.index)).map((({message:e})=>e))),[s]);return n.a.createElement(u.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaHeadersPanel"},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaHeaders"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHeadersTitle",defaultMessage:"Headers"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),i.map(((e,t)=>{var a,l;const i=h(t,"key"),s=h(t,"value");return n.a.createElement("div",{key:t},t>0&&n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart",gutterSize:"none",style:{gap:30}},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHeaderKeyInputLabel",defaultMessage:"Key"}),error:b(i),isInvalid:(null!==(a=null==i?void 0:i.length)&&void 0!==a?a:0)>0},n.a.createElement(u.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaHeadersKeyInput${t}`,fullWidth:!0,value:e.key,onChange:e=>c(t,"key",e.target.value),autoFocus:r}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHeaderValueInputLabel",defaultMessage:"Value"}),error:b(s),isInvalid:(null!==(l=null==s?void 0:s.length)&&void 0!==l?l:0)>0},n.a.createElement(u.EuiFieldText,{"data-test-subj":`settingsOutputsFlyout.kafkaHeadersValueInput${t}`,fullWidth:!0,value:e.value,onChange:e=>c(t,"value",e.target.value)}))),n.a.createElement(u.EuiFlexItem,{grow:!1,style:{marginTop:28}},n.a.createElement(u.EuiButtonIcon,{"data-test-subj":`settingsOutputsFlyout.kafkaHeadersDeleteButton${t}`,color:"text",onClick:()=>p(t),iconType:"cross",disabled:E,"aria-label":g.i18n.translate("xpack.fleet.kafkaHeadersInput.deleteButton",{defaultMessage:"Delete row"})}))))})),b(y),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiButtonEmpty,{"data-test-subj":"kafkaHeaders.multiRowInput.addRowButton",disabled:f,size:"xs",flush:"left",iconType:"plusInCircle",onClick:m},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.kafkaHeadersInput.addRow",defaultMessage:"Add header"})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaClientIdLabel",defaultMessage:"Client ID"})},t.kafkaClientIdInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaClientIdInput",fullWidth:!0},t.kafkaClientIdInput.props))))},Ci=e=>{const{inputs:t}=e,a=Object(l.useMemo)((()=>Array.from({length:6},((e,t)=>10*(t+1))).map((e=>({text:e,label:`${e} seconds`})))),[]),i=e=>{switch(e){case D.Eb.DoNotWait:return"No response";case D.Eb.Replica:return"Wait for all replicas to commit";default:case D.Eb.Commit:return"Wait for local commit"}},s=Object(l.useMemo)((()=>Object.keys(D.Eb).map((e=>({text:D.Eb[e],label:i(D.Eb[e])})))),[]);return n.a.createElement(u.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaBrokerSettingsPanel"},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaBrokerSettings"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerSettingsTitle",defaultMessage:"Broker settings"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerTimeoutInputLabel",defaultMessage:"Broker timeout"}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerTimeoutInputHelpText",defaultMessage:"Define how long a Kafka server waits for data in the same cluster."})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaBrokerTimeoutInput"},t.kafkaBrokerTimeoutInput.props,{options:a}))),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerReachabilityTimeoutInputLabel",defaultMessage:"Broker reachability timeout"}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerReachabilityTimeoutInputHelpText",defaultMessage:"Define how long an Agent would wait for a response from Kafka broker."})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaBrokerReachabilityTimeoutInput"},t.kafkaBrokerReachabilityTimeoutInput.props,{options:a}))),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerAckReliabilityInputLabel",defaultMessage:"ACK Reliability"}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaBrokerAckReliabilityInputHelpText",defaultMessage:"Reliability level required from the broker."})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaBrokerAckReliabilityInputLabel"},t.kafkaBrokerAckReliabilityInput.props,{options:s}))))},Pi=e=>{const{inputs:t}=e,a=Object(l.useMemo)((()=>Object.keys(D.Gb).filter((e=>"None"!==e)).map((e=>({text:D.Gb[e],label:D.Gb[e]})))),[]),i=Object(l.useMemo)((()=>Array.from({length:9},((e,t)=>t+1)).map((e=>({text:e,label:e.toString()})))),[]);return n.a.createElement(u.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaCompressionPanel"},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaCompression"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionTitle",defaultMessage:"Compression"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"settingsOutputsFlyout.kafkaCompressionSwitch"},t.kafkaCompressionInput.props,{onChange:e=>{e.target.checked||t.kafkaCompressionCodecInput.setValue(D.Gb.None),t.kafkaCompressionInput.setValue(e.target.checked)},label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionSwitchLabel",defaultMessage:"Enable compression"})})),t.kafkaCompressionInput.value?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionCodecInputLabel",defaultMessage:"Codec"})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaCompressionCodecInput"},t.kafkaCompressionCodecInput.props,{options:a}))),t.kafkaCompressionCodecInput.value===D.Gb.Gzip&&n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaCompressionLevelInputLabel",defaultMessage:"Level"})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0},t.kafkaCompressionLevelInput.props,{"data-test-subj":"settingsOutputsFlyout.kafkaCompressionLevelInput",options:i})))):null)},Ai=[{id:D.Ib.Random,label:"Random","data-test-subj":"kafkaPartitionRandomRadioButton"},{id:D.Ib.RoundRobin,label:"Round robin","data-test-subj":"kafkaPartitionRoundRobinRadioButton"},{id:D.Ib.Hash,label:"Hash","data-test-subj":"kafkaPartitionHashRadioButton"}],Li=e=>{const{inputs:t}=e;return n.a.createElement(u.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaPartitionPanel"},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaPartitionTitle"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTitle",defaultMessage:"Partitioning"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitioningInputLabel",defaultMessage:"Partitioning strategy"})},n.a.createElement(u.EuiRadioGroup,w()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaPartitioningRadioInput",options:Ai,compressed:!0},t.kafkaPartitionTypeInput.props))),(()=>{switch(t.kafkaPartitionTypeInput.value){case D.Ib.Random:return n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeRandomInputLabel",defaultMessage:"Number of events"})},t.kafkaPartitionTypeRandomInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaPartitionTypeRandomInput",fullWidth:!0},t.kafkaPartitionTypeRandomInput.props)));case D.Ib.RoundRobin:return n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeRoundRobinInputLabel",defaultMessage:"Number of events"})},t.kafkaPartitionTypeRoundRobinInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaPartitionTypeRoundRobinInput",fullWidth:!0},t.kafkaPartitionTypeRoundRobinInput.props)));case D.Ib.Hash:default:return n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeHashInputLabel",defaultMessage:"List of fields"}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPartitionTypeHashHelpTextLabel",defaultMessage:"Comma separated."})},n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaPartitionTypeHashInput",fullWidth:!0},t.kafkaPartitionTypeHashInput.props))))}})())},_i=({fullWidth:e,error:t,isInvalid:a,children:i,clear:s,title:r,initialValue:o,onToggleSecretStorage:c,cancelEdit:m,useSecretsStorage:p,label:E})=>{const f=!!o,[b,h]=Object(l.useState)(!o),y=n.a.createElement(u.EuiPanel,{color:"subdued",borderRadius:"none",hasShadow:!1},n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.outputForm.secretValueHiddenMessage",defaultMessage:"The saved {varName} is hidden. You can only replace the {varName}.",values:{varName:r}})),n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiButtonEmpty,{onClick:()=>h(!0),color:"primary",iconType:"refresh",iconSide:"left",size:"xs"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.outputForm.editSecretValue",defaultMessage:"Replace {varName}",values:{varName:r}}))),k=n.a.createElement(u.EuiButtonEmpty,{onClick:()=>{h(!1),m&&m()},color:"primary",iconType:"refresh",iconSide:"left",size:"xs"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.editPackagePolicy.stepConfigure.fieldSecretValueSetCancelButton",defaultMessage:"Cancel {varName} change",values:{varName:r}})),v=n.a.createElement(n.a.Fragment,null,i,f&&n.a.createElement(u.EuiFlexGroup,{justifyContent:"flexEnd","data-test-subj":"secretCancelChangeBtn"},n.a.createElement(u.EuiFlexItem,{grow:!1},k))),x=n.a.createElement("span",null,n.a.createElement(u.EuiIcon,{type:"lock","data-test-subj":"lockIcon"})," ",r," ",n.a.createElement(u.EuiToolTip,{content:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeySecretInputTooltip",{defaultMessage:"This value will be stored as a secret, meaning once saved the value cannot be viewed again"})},n.a.createElement(u.EuiIcon,{type:"questionInCircle"}))),F=o?void 0:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeySecretInputCalloutTitle",defaultMessage:"This field uses secret storage and requires Fleet Server v8.12.0 and above. {revertLink}",values:{revertLink:n.a.createElement(u.EuiButtonEmpty,{onClick:()=>c(!1),color:"primary",size:"xs"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.revertToPlaintextLink",defaultMessage:"Click to use plain text storage instead"}))}}),M=n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.secretInputCalloutTitle",defaultMessage:"This field should be stored as a secret, currently it is set to be stored as plain text. {enableSecretLink}",values:{enableSecretLink:n.a.createElement(u.EuiButtonEmpty,{onClick:()=>c(!0),color:"primary",size:"xs"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.revertToSecretStorageLink",defaultMessage:"Click to use secret storage instead"}))}}),S=b?v:y;return p?n.a.createElement(u.EuiFormRow,{fullWidth:e,label:x,error:t,isInvalid:a,helpText:F},S):n.a.createElement(u.EuiFormRow,{fullWidth:e,error:t,isInvalid:a,label:E,helpText:M},S)},Di=[{id:D.Jb.Plain,label:"Plain","data-test-subj":"kafkaSaslPlainRadioButton"},{id:D.Jb.ScramSha256,label:"SCRAM-SHA-256","data-test-subj":"kafkaSaslScramSha256RadioButton"},{id:D.Jb.ScramSha512,label:"SCRAM-SHA-512","data-test-subj":"kafkaSaslScramSha512RadioButton"}],Bi=[{id:D.Fb.None,label:"None","data-test-subj":"kafkaAuthenticationNoneRadioButton"},{id:D.Fb.Userpass,label:"Username / Password","data-test-subj":"kafkaAuthenticationUsernamePasswordRadioButton"},{id:D.Fb.Ssl,label:"SSL","data-test-subj":"kafkaAuthenticationSSLRadioButton"}],Ri=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}=e,[s,r]=n.a.useState(!0);Object(l.useEffect)((()=>{s&&(r(!1),a&&(t.kafkaAuthPasswordInput.value&&!t.kafkaAuthPasswordSecretInput.value&&(t.kafkaAuthPasswordSecretInput.setValue(t.kafkaAuthPasswordInput.value),t.kafkaAuthPasswordInput.clear()),t.kafkaSslKeyInput.value&&!t.kafkaSslKeySecretInput.value&&(t.kafkaSslKeySecretInput.setValue(t.kafkaSslKeyInput.value),t.kafkaSslKeyInput.clear())))}),[a,t.kafkaAuthPasswordInput,t.kafkaAuthPasswordSecretInput,t.kafkaSslKeyInput,t.kafkaSslKeySecretInput,s,r]);const o=e=>{e?(t.kafkaAuthPasswordInput.clear(),t.kafkaSslKeyInput.clear()):(t.kafkaAuthPasswordSecretInput.setValue(""),t.kafkaSslKeySecretInput.setValue("")),i(e)},c=Object(l.useMemo)((()=>Object.keys(D.Mb).map((e=>({text:D.Mb[e],label:e})))),[]),m=Object(l.useMemo)((()=>Object.keys(D.Hb).map((e=>({id:D.Hb[e],label:e,"data-test-subj":`kafkaConnectionType${e}RadioButton`})))),[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiPanel,{borderRadius:"m",hasShadow:!1,paddingSize:"m",color:"subdued","data-test-subj":"settingsOutputsFlyout.kafkaAuthenticationPanel"},n.a.createElement(u.EuiTitle,{size:"s"},n.a.createElement("h3",{id:"FleetEditOutputFlyoutKafkaAuthenticationTitle"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaAuthenticationTitle",defaultMessage:"Authentication"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,{fullWidth:!0},n.a.createElement(u.EuiRadioGroup,w()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaAuthenticationRadioInput",options:Bi,compressed:!0},t.kafkaAuthMethodInput.props))),(()=>{switch(t.kafkaAuthMethodInput.value){case D.Fb.None:return n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaConnectionTypeLabel",defaultMessage:"Connection"})},n.a.createElement(u.EuiRadioGroup,w()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaConnectionTypeRadioInput",options:m,compressed:!0},t.kafkaConnectionTypeInput.props)));case D.Fb.Ssl:return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslCertificateInputLabel",defaultMessage:"Client SSL certificate"})},t.kafkaSslCertificateInput.formRowProps),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5},t.kafkaSslCertificateInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateInputPlaceholder",{defaultMessage:"Specify ssl certificate"})}))),a?n.a.createElement(_i,w()({fullWidth:!0,title:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaPasswordSecretInputTitle",{defaultMessage:"Client SSL certificate key"})},t.kafkaSslKeySecretInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:o,cancelEdit:t.kafkaSslKeySecretInput.cancelEdit}),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5,"data-test-subj":"kafkaSslKeySecretInput"},t.kafkaSslKeySecretInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))):n.a.createElement(_i,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeyInputLabel",defaultMessage:"Client SSL certificate key"})},t.kafkaSslKeyInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:o}),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5},t.kafkaSslKeyInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))));default:case D.Fb.Userpass:return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaUsernameInputLabel",defaultMessage:"Username"})},t.kafkaAuthUsernameInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaUsernameInput",fullWidth:!0},t.kafkaAuthUsernameInput.props))),a?n.a.createElement(_i,w()({fullWidth:!0,title:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaPasswordInputtitle",{defaultMessage:"Password"})},t.kafkaAuthPasswordSecretInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:o,cancelEdit:t.kafkaAuthPasswordSecretInput.cancelEdit}),n.a.createElement(u.EuiFieldPassword,w()({type:"dual","data-test-subj":"settingsOutputsFlyout.kafkaPasswordSecretInput",fullWidth:!0},t.kafkaAuthPasswordSecretInput.props))):n.a.createElement(_i,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaPasswordInputLabel",defaultMessage:"Password"})},t.kafkaAuthPasswordInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:o}),n.a.createElement(u.EuiFieldPassword,w()({type:"dual","data-test-subj":"settingsOutputsFlyout.kafkaPasswordInput",fullWidth:!0},t.kafkaAuthPasswordInput.props))),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaSaslInputLabel",defaultMessage:"SASL Mechanism"})},n.a.createElement(u.EuiRadioGroup,w()({style:{display:"flex",gap:30},"data-test-subj":"settingsOutputsFlyout.kafkaSaslInput",options:Di,compressed:!0},t.kafkaSaslMechanismInput.props))))}})()),t.kafkaConnectionTypeInput.value!==D.Hb.Plaintext||t.kafkaAuthMethodInput.value!==D.Fb.None?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(ti.a,w()({placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputPlaceholder",{defaultMessage:"Specify certificate authority"}),label:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputLabel",{defaultMessage:"Server SSL certificate authorities (optional)"}),multiline:!0,sortable:!1},t.kafkaSslCertificateAuthoritiesInput.props)),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaVerificationModeInputLabel",defaultMessage:"Verification mode"})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaVerificationModeInput"},t.kafkaVerificationModeInput.props,{options:c,placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaVerificationModeInputPlaceholder",{defaultMessage:"Specify verification mode"})})))):null)},zi=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}=e,{docLinks:s}=Object(fl.Rc)(),r=Object(l.useMemo)((()=>D.Kb.map((e=>({text:e,label:e})))),[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaVersionInputLabel",defaultMessage:"Kafka version"})},n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.kafkaVersionInput"},t.kafkaVersionInput.props,{options:r,placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaVersionInputPlaceholder",{defaultMessage:"Specify version"})}))),n.a.createElement(ti.a,w()({placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaHostsInputPlaceholder",{defaultMessage:"Specify host"}),sortable:!0,helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaHostsInputDescription",defaultMessage:"Specify the URLs that your agents will use to connect to Kafka. {guideLink}.",values:{guideLink:n.a.createElement(u.EuiLink,{href:s.links.fleet.kafkaSettings,target:"_blank",external:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.kafkaUserGuideLink",defaultMessage:"Learn more"}))}}),label:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaHostsInputLabel",{defaultMessage:"Hosts"})},t.kafkaHostsInput.props)),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ri,{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Li,{inputs:t}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(wi,{inputs:t}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(ji,{inputs:t}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Pi,{inputs:t}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ci,{inputs:t}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaKeyInputLabel",defaultMessage:"Key (optional)"}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.kafkaKeyInputHelpText",defaultMessage:"If configured, the event key can be extracted from the event using a format string."})},n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.kafkaKeyInput",fullWidth:!0},t.kafkaKeyInput.props))))},Ni=p.a.div.withConfig({displayName:"CodeEditorContainer",componentId:"sc-1u19e39-0"})(["min-height:0;position:relative;height:116px;"]),Ui=p()(u.EuiTextColor).attrs((e=>({color:"subdued",size:"xs"}))).withConfig({displayName:"CodeEditorPlaceholder",componentId:"sc-1u19e39-1"})(["position:absolute;top:0;left:0;font-family:Menlo,Monaco,'Courier New',monospace;font-size:12px;line-height:21px;pointer-events:none;"]),Hi={minimap:{enabled:!1},ariaLabel:g.i18n.translate("xpack.fleet.settings.yamlCodeEditor",{defaultMessage:"YAML Code Editor"}),scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",automaticLayout:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,folding:!1,lineDecorationsWidth:0},qi=e=>{const{placeholder:t,disabled:a,...l}=e;return a?n.a.createElement(u.EuiCodeBlock,{style:{height:"116px"},language:"yaml",isCopyable:!1,paddingSize:"s"},n.a.createElement("pre",null,l.value)):n.a.createElement(Ni,null,n.a.createElement(y.CodeEditor,w()({languageId:"yaml",width:"100%",height:"116px",options:Hi},l)),(!l.value||""===l.value)&&n.a.createElement(Ui,null,t))},Gi=e=>t=>{if("object"!=typeof t)return e(null!=t?t:"")};function Wi(e){const t=[],a={};if(e.forEach(((e,l)=>{if(!e)return void t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostFieldRequiredError",{defaultMessage:"Host is required"})});const n=e.split(":");if(2!==n.length||!n[0]||!n[1])return void t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostPortError",{defaultMessage:'Invalid format. Expected "host:port" without protocol.'}),index:l});const i=parseInt(n[1],10);(isNaN(i)||i<1||i>65535)&&t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaPortError",{defaultMessage:"Invalid port number. Expected a number between 1 and 65535"}),index:l});const s=a[e]||[];a[e]=[...s,l]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),0===e.length&&t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHostRequiredError",{defaultMessage:"Host is required"})}),t.length)return t}function Ki(e){const t=[],a={},l=g.i18n.translate("xpack.fleet.settings.outputForm.elasticUrlRequiredError",{defaultMessage:"URL is required"});if(e.forEach(((e,n)=>{try{if(e){const a=new URL(e);["http:","https:"].includes(a.protocol)||t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.invalidProtocolError",{defaultMessage:"Invalid protocol"}),index:n})}else t.push({message:l,index:n})}catch(e){t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.elasticHostError",{defaultMessage:"Invalid URL"}),index:n})}const i=a[e]||[];a[e]=[...i,n]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.elasticHostDuplicateError",{defaultMessage:"Duplicate URL"}),index:e})))})),0===e.length&&t.push({message:l}),t.length)return t}function $i(e){const t=[],a={};if(e.forEach(((e,l)=>{try{if(e.match(/^http([s]){0,1}:\/\//))return void t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.logstashHostProtocolError",{defaultMessage:"Host address must begin with a domain name or IP address"}),index:l});if(new URL(`http://${e}`).host!==e.toLowerCase())throw new Error("Invalid host")}catch(a){0===e.length?t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"}),index:l}):t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.logstashHostError",{defaultMessage:"Invalid Host"}),index:l})}const n=a[e]||[];a[e]=[...n,l]})),Object.values(a).filter((({length:e})=>e>1)).forEach((e=>{e.forEach((e=>t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.logstashHostDuplicateError",{defaultMessage:"Duplicate Host"}),index:e})))})),0===e.length&&t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.logstashHostRequiredError",{defaultMessage:"Host is required"})}),t.length)return t}function Vi(e){try{return void Object(el.safeLoad)(e)}catch(e){return[g.i18n.translate("xpack.fleet.settings.outputForm.invalidYamlFormatErrorMessage",{defaultMessage:"Invalid YAML: {reason}",values:{reason:e.message}})]}}function Qi(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.nameIsRequiredErrorMessage",{defaultMessage:"Name is required"})]}function Yi(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.kafkaUsernameIsRequired",{defaultMessage:"Username is required"})]}function Ji(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.kafkaPasswordIsRequired",{defaultMessage:"Password is required"})]}const Zi=Gi(Ji);function Xi(e){if(""!==e&&!e.match(/^[a-zA-Z0-9]+$/))return[g.i18n.translate("xpack.fleet.settings.outputForm.caTrusterdFingerprintInvalidErrorMessage",{defaultMessage:"CA trusted fingerprint should be valid HEX encoded SHA-256 of a CA certificate"})]}function es(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.serviceTokenRequiredErrorMessage",{defaultMessage:"Service Token is required"})]}const ts=Gi(es);function as(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.sslCertificateRequiredErrorMessage",{defaultMessage:"SSL certificate is required"})]}function ls(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.sslKeyRequiredErrorMessage",{defaultMessage:"SSL key is required"})]}const ns=Gi(ls);function is(e){if(!e||""===e)return[g.i18n.translate("xpack.fleet.settings.outputForm.kafkaDefaultTopicRequiredMessage",{defaultMessage:"Default topic is required"})]}function ss(e){return/^[A-Za-z0-9._-]+$/.test(e)?void 0:[g.i18n.translate("xpack.fleet.settings.outputForm.kafkaClientIdFormattingMessage",{defaultMessage:"Client ID is invalid. Only letters, numbers, dots, underscores, and dashes are allowed."})]}function rs(e){return/^[0-9]+$/.test(e)?void 0:[g.i18n.translate("xpack.fleet.settings.outputForm.kafkaPartitioningGroupEventsFormattingMessage",{defaultMessage:"Number of events must be a number"})]}function os(e){const t=[];if(e.forEach(((e,a)=>{var l;e.topic&&""!==e.topic||t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaTopicRequiredMessage",{defaultMessage:"Topic is required"}),index:a}),null!==(l=e.when)&&void 0!==l&&l.condition&&""!==e.when.condition&&e.when.condition.split(":").length-1==1||t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaTopicConditionRequired",{defaultMessage:'Must be a key, value pair i.e. "http.response.code: 200"'}),index:a,condition:!0})})),t.length)return t}function cs(e){const t=[],a=new Set;if(e.forEach(((e,l)=>{const{key:n,value:i}=e,s=!!n,r=!!i;s&&!r?t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHeadersMissingKeyError",{defaultMessage:'Missing value for key "{key}"',values:{key:n}}),index:l,hasKeyError:!1,hasValueError:!0}):!s&&r?t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHeadersMissingValueError",{defaultMessage:'Missing key for value "{value}"',values:{value:i}}),index:l,hasKeyError:!0,hasValueError:!1}):s&&r&&(a.has(n)?t.push({message:g.i18n.translate("xpack.fleet.settings.outputForm.kafkaHeadersDuplicateKeyError",{defaultMessage:'Duplicate key "{key}"',values:{key:n}}),index:l,hasKeyError:!0,hasValueError:!1}):a.add(n))})),t.length)return t}const us=()=>n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.confirmModalTitle",defaultMessage:"Save and deploy changes?"}),ds=({output:e,agentCount:t,agentPolicyCount:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{"data-test-subj":"settings.outputModal",id:"xpack.fleet.settings.updateOutput.confirmModalText",defaultMessage:"This action will update {outputName} output. It will update {policies} and {agents}. This action can not be undone. Are you sure you wish to continue?",values:{outputName:n.a.createElement("strong",null,e.name),agents:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentsCount",defaultMessage:"{agentCount, plural, one {# agent} other {# agents}}",values:{agentCount:t}})),policies:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.agentPolicyCount",defaultMessage:"{agentPolicyCount, plural, one {# agent policy} other {# agent policies}}",values:{agentPolicyCount:a}}))}}),"logstash"===e.type?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiCallOut,{iconType:"warning",color:"warning",size:"m",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.warningTitle",defaultMessage:"Logstash output for agent integration is not supported for fleet server and synthetics."})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.updateOutput.warningMessage",defaultMessage:"Fleet server and synthetics policies will keep using the existing ES output."}))," "):null),gs=4096;const ms=({enabled:e,inputs:t})=>{const{diskQueueEnabledInput:a,diskQueuePathInput:l,diskQueueMaxSizeInput:i,loadBalanceEnabledInput:s,diskQueueEncryptionEnabled:r,diskQueueCompressionEnabled:o,compressionLevelInput:c,memQueueEvents:m,queueFlushTimeout:p,maxBatchBytes:E}=t,{showExperimentalShipperOptions:f}=C.b.get();return e?n.a.createElement(u.EuiAccordion,{id:"advancedOutputOptions",arrowDisplay:"left",buttonContent:n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.advancedOptionsToggleLabel",defaultMessage:"Advanced options"})),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiBetaBadge,{label:"Experimental",color:"subdued"})))},n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},E.formRowProps,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.maxBatchSizeDescriptionLabel",defaultMessage:"Maximum Batch Size"})}),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFieldNumber,w()({},E.props,{placeholder:"Batching Bytes",min:0}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.maxBatchSizeDescription",defaultMessage:"Data will be sent to the output when the agent has more events in the queue than this number."}))))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},p.formRowProps,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.queueFlushTimeoutLabel",defaultMessage:"Flush Timeout"})}),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFieldNumber,w()({},p.props,{placeholder:"Seconds",min:0}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.queueFlushTimeoutDescription",defaultMessage:"Upon expiry the output queue is flushed and data is written to the output."}))))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},m.formRowProps,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.memQueueEventsLabel",defaultMessage:"Memory Queue Size"})}),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFieldNumber,w()({},m.props,{placeholder:"Events",min:0}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.memQueueEventsSizeDescription",defaultMessage:"Maximum number of events that can be stored in the queue. Default is set to 4096. When this queue is full, new events are dropped."}))))),f&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiHorizontalRule,null),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},a.formRowProps),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"editOutputFlyout.diskQueueSwitch"},a.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueSwitchLabel",defaultMessage:"Disk Queue"})}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueSwitchDescription",defaultMessage:"Once enabled, events will be queued on disk if, for some reason, agent is not able to send them."}))))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},r.formRowProps),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"editOutputFlyout.diskQueueEncryption"},r.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueEncryptionLabel",defaultMessage:"Disk Queue Encryption"})}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueEncryptionDescription",defaultMessage:"Enable encryption of data written to the disk queue."}))))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueuePathLabel",defaultMessage:"Disk Queue Path"})},l.formRowProps),n.a.createElement(u.EuiFieldText,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.diskQueuePath"},l.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.diskQueuePathPlaceholder",{defaultMessage:"path_data/diskqueue"})}))),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},i.formRowProps,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueMaxSize",defaultMessage:"Maximum Disk Queue Size"})}),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFieldNumber,w()({},i.props,{placeholder:"Bytes",min:0}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.diskQueueMaxSizeDescription",defaultMessage:"Limits the disk queue size for spooling of data. When data in the queue exceeds this limit, new events will be dropped."}))))),n.a.createElement(u.EuiHorizontalRule,null),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},s.formRowProps),n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"editOutputFlyout.loadBalancingSwitch"},s.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.loadBalancingSwitchLabel",defaultMessage:"Load Balancing"})}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.loadBalancingDescription",defaultMessage:"Once enabled, the agents will balance the load across all the hosts defined for this output. This will increase the number of connections opened by the agent."}))))),n.a.createElement(u.EuiHorizontalRule,null),n.a.createElement(u.EuiFormRow,{fullWidth:!0},n.a.createElement(u.EuiFlexGroup,{alignItems:"flexStart"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiSwitch,w()({"data-test-subj":"editOutputFlyout.compressionSwitch"},o.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.compressionSwitchLabel",defaultMessage:"Compression"})}))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiSelect,w()({"data-test-subj":"editOutputFlyout.compressionLevelSelect",id:"selectCompressionLevel","aria-label":"Use aria labels when no actual label is in use"},c.props))),n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiText,{size:"s",color:"subdued"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.compressionSwitchDescription",defaultMessage:"Level 1 compression is the fastest, Level 9 however would provide the most compression."})))))))):null},ps=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i}=e,[s,r]=n.a.useState(!0);Object(l.useEffect)((()=>{s&&(r(!1),a&&t.serviceTokenInput.value&&!t.serviceTokenSecretInput.value&&(t.serviceTokenSecretInput.setValue(t.serviceTokenInput.value),t.serviceTokenInput.clear()))}),[a,t.serviceTokenInput,t.serviceTokenSecretInput,s,r]);const o=e=>{e?t.serviceTokenInput.clear():t.serviceTokenSecretInput.setValue(""),i(e)};return n.a.createElement(n.a.Fragment,null,n.a.createElement(ti.a,w()({"data-test-subj":"settingsOutputsFlyout.hostUrlInput",label:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteEsHostsInputLabel",{defaultMessage:"Hosts"}),placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteEsHostsInputPlaceholder",{defaultMessage:"Specify host URL"})},t.elasticsearchUrlInput.props,{isUrl:!0})),n.a.createElement(u.EuiSpacer,{size:"m"}),a?n.a.createElement(_i,w()({fullWidth:!0,title:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.serviceTokenLabel",{defaultMessage:"Service Token"})},t.serviceTokenSecretInput.formRowProps,{cancelEdit:t.serviceTokenSecretInput.cancelEdit,useSecretsStorage:a,onToggleSecretStorage:o}),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"serviceTokenSecretInput",fullWidth:!0},t.serviceTokenSecretInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteESHostPlaceholder",{defaultMessage:"Specify service token"})}))):n.a.createElement(_i,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.serviceTokenLabel",defaultMessage:"Service Token"})},t.serviceTokenInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:o}),n.a.createElement(u.EuiFieldText,w()({fullWidth:!0,"data-test-subj":"serviceTokenSecretInput"},t.serviceTokenInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.remoteESHostPlaceholder",{defaultMessage:"Specify service token"})}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.serviceTokenCalloutText",defaultMessage:"Generate a service token by running this API request in the Remote Kibana Console and copy the response value"}),"data-test-subj":"serviceTokenCallout"},n.a.createElement(u.EuiCodeBlock,{isCopyable:!0},'POST kbn:/api/fleet/service_tokens\n{\n  "remote": true\n}')),n.a.createElement(u.EuiSpacer,{size:"m"}))},Es=()=>{const{docLinks:e}=Object(c.lc)();return n.a.createElement(fs,{iconType:"iInCircle",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.calloutTitle",defaultMessage:"Additional Logstash configuration required"})},n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.description",defaultMessage:"Add an Elastic Agent pipeline configuration to Logstash to receive events from the Elastic Agent framework. {documentationLink}.",values:{documentationLink:n.a.createElement(u.EuiLink,{external:!0,href:e.links.logstash.inputElasticAgent},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.documentationLink",defaultMessage:"Learn more"}))}}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(bs,null)))},fs=({children:e,...t})=>{const[a,i]=Object(l.useState)(!1);return n.a.createElement(u.EuiCallOut,t,n.a.createElement(u.EuiSpacer,{size:"s"}),a?n.a.createElement(u.EuiButton,{onClick:()=>i(!1)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.collapseInstructionsButtonLabel",defaultMessage:"Collapse steps"})):n.a.createElement(u.EuiButton,{onClick:()=>i(!0),fill:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.viewInstructionButtonLabel",defaultMessage:"View steps"})),a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),e))},bs=()=>{const{docLinks:e}=Object(c.lc)(),t=function(){const[e,t]=Object(l.useState)(!1),[a,n]=Object(l.useState)(),{notifications:i}=Object(c.lc)(),s=Object(l.useCallback)((async()=>{try{var e;t(!0);const a=await Object(c.bb)();if(a.error)throw a.error;n(null===(e=a.data)||void 0===e?void 0:e.api_key)}catch(e){i.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.logstashInstructions.generateApiKeyError",{defaultMessage:"Impossible to generate an api key"})})}finally{t(!1)}}),[i.toasts]);return Object(l.useMemo)((()=>({isLoading:e,generateApiKey:s,apiKey:a})),[e,s,a])}(),a=Object(l.useMemo)((()=>{return[{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.apiKeyStepDescription",defaultMessage:"We recommend authorizing Logstash to output to Elasticsearch with minimal privileges for Elastic Agent."}),n.a.createElement(u.EuiSpacer,{size:"m"}),t.apiKey?n.a.createElement(u.EuiCodeBlock,{paddingSize:"m"},n.a.createElement("h5",null,"API Key"),t.apiKey,n.a.createElement("div",{className:"euiCodeBlock__controls"},n.a.createElement("div",{className:"euiCodeBlock__copyButton"},n.a.createElement(u.EuiCopy,{textToCopy:t.apiKey},(e=>n.a.createElement(u.EuiButtonIcon,{onClick:e,iconType:"copyClipboard",color:"text","aria-label":g.i18n.translate("xpack.fleet.settings.logstashInstructions.copyApiKeyButtonLabel",{defaultMessage:"Copy message"})})))))):n.a.createElement(u.EuiButton,{isLoading:t.isLoading,onClick:t.generateApiKey},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.generateApiKeyButtonLabel",defaultMessage:"Generate API key"})),n.a.createElement(u.EuiSpacer,{size:"m"}))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.editPipelineStepDescription",defaultMessage:"Next, open the {pipelineConfFile} file and insert the following content:",values:{pipelineConfFile:n.a.createElement(u.EuiCode,null,"elastic-agent-pipeline.conf")}}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},(a=t.apiKey,'input {\n  elastic_agent {\n    port => 5044\n    ssl => true\n    ssl_certificate_authorities => ["<ca_path>"]\n    ssl_certificate => "<server_cert_path>"\n    ssl_key => "<server_cert_key_in_pkcs8>"\n    ssl_verify_mode => "force_peer"\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => "<es_host>"\n    api_key => "<api_key>"\n    data_stream => true\n    ssl => true\n    # cacert => "<elasticsearch_ca_path>"\n  }\n}'.replace("<api_key>",a||"<api_key>"))))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.addPipelineStepDescription",defaultMessage:"In your Logstash configuration directory, open the {pipelineFile} file and add the following configuration. Replace the path to your file.",values:{pipelineFile:n.a.createElement(u.EuiCode,null,"pipelines.yml")}}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCodeBlock,{paddingSize:"m",language:"yaml",isCopyable:!0},'- pipeline.id: elastic-agent-pipeline\n  path.config: "/etc/path/to/elastic-agent-pipeline.conf"\n'))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.replaceStepDescription",defaultMessage:"Replace the parts between the brackets with your generated SSL certificate file paths. View {documentationLink} to generate the certificates.",values:{documentationLink:n.a.createElement(u.EuiLink,{external:!0,href:e.links.fleet.secureLogstash},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.ourDocumentationLink",defaultMessage:"our documentation"}))}}),n.a.createElement(u.EuiSpacer,{size:"m"}))},{children:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.logstashInstructions.saveAndRestartStepDescription",defaultMessage:"Save the pipeline and restart Logstash so the changes take effect."}),n.a.createElement(u.EuiSpacer,{size:"m"}))}];var a}),[t,e]);return n.a.createElement("ol",null,a.map(((e,t)=>n.a.createElement("li",{key:t},e.children))))},hs=()=>{const{docLinks:e}=Object(c.lc)();return n.a.createElement(u.EuiCallOut,{iconType:"warning",color:"warning",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutTitle",defaultMessage:"Additional setup required"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.calloutDescription",defaultMessage:"You must configure an encryption key before configuring this output. {link}",values:{link:n.a.createElement(u.EuiLink,{href:e.links.kibana.secureSavedObject,target:"_blank",external:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.encryptionKeyRequired.link",defaultMessage:"Learn more"}))}}))},ys=e=>{const{inputs:t,useSecretsStorage:a,onToggleSecretStorage:i,hasEncryptedSavedObjectConfigured:s}=e,{docLinks:r}=Object(c.lc)(),[o,m]=n.a.useState(!0);Object(l.useEffect)((()=>{o&&(m(!1),a&&t.sslKeyInput.value&&!t.sslKeySecretInput.value&&(t.sslKeySecretInput.setValue(t.sslKeyInput.value),t.sslKeyInput.clear()))}),[a,t.sslKeyInput,t.sslKeySecretInput,o,m]);const p=e=>{e?t.sslKeyInput.clear():t.sslKeySecretInput.setValue(""),i(e)};return n.a.createElement(n.a.Fragment,null,!s&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(hs,null)),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Es,null),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(ti.a,w()({placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputPlaceholder",{defaultMessage:"Specify host"}),sortable:!1,helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.logstashHostsInputDescription",defaultMessage:"Specify the addresses that your agents will use to connect to Logstash. {guideLink}.",values:{guideLink:n.a.createElement(u.EuiLink,{href:r.links.fleet.logstashSettings,target:"_blank",external:!0},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetSettingsLink",defaultMessage:"Learn more"}))}}),label:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.logstashHostsInputLabel",{defaultMessage:"Logstash hosts"})},t.logstashHostsInput.props)),n.a.createElement(ti.a,w()({placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputPlaceholder",{defaultMessage:"Specify certificate authority"}),label:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateAuthoritiesInputLabel",{defaultMessage:"Server SSL certificate authorities (optional)"}),multiline:!0,sortable:!1},t.sslCertificateAuthoritiesInput.props)),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslCertificateInputLabel",defaultMessage:"Client SSL certificate"})},t.sslCertificateInput.formRowProps),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5},t.sslCertificateInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslCertificateInputPlaceholder",{defaultMessage:"Specify ssl certificate"})}))),a?n.a.createElement(_i,w()({fullWidth:!0,title:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeySecretInputTitle",{defaultMessage:"Client SSL certificate key"})},t.sslKeySecretInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:p,cancelEdit:t.sslKeySecretInput.cancelEdit}),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5},t.sslKeySecretInput.props,{"data-test-subj":"sslKeySecretInput",placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeySecretInputPlaceholder",{defaultMessage:"Specify certificate key"})}))):n.a.createElement(_i,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.sslKeyInputLabel",defaultMessage:"Client SSL certificate key"})},t.sslKeyInput.formRowProps,{useSecretsStorage:a,onToggleSecretStorage:p}),n.a.createElement(u.EuiTextArea,w()({fullWidth:!0,rows:5},t.sslKeyInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.sslKeyInputPlaceholder",{defaultMessage:"Specify certificate key"})}))))},ks=e=>{const{inputs:t}=e;return n.a.createElement(n.a.Fragment,null,n.a.createElement(ti.a,w()({"data-test-subj":"settingsOutputsFlyout.hostUrlInput",label:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputLabel",{defaultMessage:"Hosts"}),placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.esHostsInputPlaceholder",{defaultMessage:"Specify host URL"})},t.elasticsearchUrlInput.props,{isUrl:!0})),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputLabel",defaultMessage:"Elasticsearch CA trusted fingerprint (optional)"})},t.caTrustedFingerprintInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({fullWidth:!0},t.caTrustedFingerprintInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.caTrustedFingerprintInputPlaceholder",{defaultMessage:"Specify Elasticsearch CA trusted fingerprint"})}))))},vs=({onClose:e,output:t,proxies:a})=>{Object(c.wb)("settings");const i=function(e,t){var a,i,s,r,o,u,d,m,p,E,f,b,h,y,k,v,x,F,M,S,I,T,O,w,j,P,A,L,_,B,R,z,N,U,H,q,G,W,K,$,V,Q,Y,J,Z,X,ee,te,ae,le,ne,ie,se,re,oe,ce,ue,de,ge,me,pe,Ee,fe,be,he,ye,ke,ve,xe,Fe,Me,Se;const Ie=Object(c.Gb)(),{showExperimentalShipperOptions:Te}=C.b.get(),Oe=!(null!==(a=Ie.missingOptionalFeatures)&&void 0!==a&&a.includes("encrypted_saved_object_encryption_key_required")),[we,je]=Object(l.useState)(!1),{notifications:Ce}=Object(c.lc)(),{confirm:Pe}=Object(ei.a)(),Ae=null!==(i=null==t?void 0:t.is_preconfigured)&&void 0!==i&&i,Le=null!==(s=null==t?void 0:t.allow_edit)&&void 0!==s?s:[];function _e(e){return!!Ae&&!Le.includes(e)}const De=Object(c.Wb)(null!==(r=null==t?void 0:t.name)&&void 0!==r?r:"",Qi,_e("name")),Be=Object(c.Wb)(null!==(o=null==t?void 0:t.type)&&void 0!==o?o:"elasticsearch",void 0,_e("type")),Re=Object(c.Wb)(null!==(u=null==t?void 0:t.config_yaml)&&void 0!==u?u:"",Vi,_e("config_yaml")),ze=Object(c.mc)(null!==(d=null==t?void 0:t.is_default)&&void 0!==d&&d,_e("is_default")||(null==t?void 0:t.is_default)),Ne=Object(c.mc)(null!==(m=null==t?void 0:t.is_default_monitoring)&&void 0!==m&&m,_e("is_default_monitoring")||(null==t?void 0:t.is_default_monitoring)),Ue=Object(c.Wb)(null!==(p=null==t?void 0:t.ca_trusted_fingerprint)&&void 0!==p?p:"",Xi,_e("ca_trusted_fingerprint")),He=Object(c.yb)("esHostsComboxBox",null!==(E=null==t?void 0:t.hosts)&&void 0!==E?E:[],Ki,_e("hosts")),qe=Object(c.Wb)(null!==(f=null==t?void 0:t.preset)&&void 0!==f?f:Object(Oi.b)(null!==(b=null==t?void 0:t.config_yaml)&&void 0!==b?b:"",el.safeLoad),(()=>{}),_e("preset")),Ge=Object(c.Wb)(null!==(h=null==t?void 0:t.service_token)&&void 0!==h?h:"",es,_e("service_token")),We=Object(c.ic)(null!==(y=null==t||null===(k=t.secrets)||void 0===k?void 0:k.service_token)&&void 0!==y?y:"",ts,_e("service_token")),Ke=null!=t&&t.config_yaml?Object(el.safeLoad)(null==t?void 0:t.config_yaml):{},$e=!(null!=Ke&&Ke.shipper)||!1===(null==Ke||null===(v=Ke.shipper)||void 0===v?void 0:v.enabled),Ve=Object(c.mc)(null!==(x=null==t||null===(F=t.shipper)||void 0===F?void 0:F.disk_queue_enabled)&&void 0!==x&&x),Qe=Object(c.Wb)(null!==(M=null==t||null===(S=t.shipper)||void 0===S?void 0:S.disk_queue_path)&&void 0!==M?M:"",void 0,null!==(I=!Ve.value)&&void 0!==I&&I),Ye=Object(c.dc)(null!==(T=null==t||null===(O=t.shipper)||void 0===O?void 0:O.disk_queue_max_size)&&void 0!==T?T:gs,void 0,null!==(w=!Ve.value)&&void 0!==w&&w),Je=Object(c.mc)(null!==(j=null==t||null===(P=t.shipper)||void 0===P?void 0:P.disk_queue_encryption_enabled)&&void 0!==j&&j,null!==(A=!Ve.value)&&void 0!==A&&A),Ze=Object(c.mc)(null!==(L=null==t||null===(_=t.shipper)||void 0===_?void 0:_.disk_queue_enabled)&&void 0!==L&&L),Xe=Object(c.mc)(null!==(B=null==t||null===(R=t.shipper)||void 0===R?void 0:R.disk_queue_compression_enabled)&&void 0!==B&&B),et=Array.from(Array(10).keys()).slice(1).map((e=>({value:`${e}`,text:`Level ${e}`}))),tt=Object(c.jc)(et,null!==(z=`${null==t||null===(N=t.shipper)||void 0===N?void 0:N.compression_level}`)&&void 0!==z?z:et[0].value,null!==(U=!Xe.value)&&void 0!==U&&U),at=Object(c.dc)((null==t||null===(H=t.shipper)||void 0===H?void 0:H.mem_queue_events)||void 0),lt=Object(c.dc)((null==t||null===(q=t.shipper)||void 0===q?void 0:q.queue_flush_timeout)||void 0),nt=Object(c.dc)((null==t||null===(G=t.shipper)||void 0===G?void 0:G.max_batch_bytes)||void 0),it=_e("ssl"),st=Object(c.yb)("logstashHostsComboxBox",null!==(W=null==t?void 0:t.hosts)&&void 0!==W?W:[],$i,_e("hosts")),rt=Object(c.yb)("sslCertificateAuthoritiesComboxBox",null!==(K=null==t||null===($=t.ssl)||void 0===$?void 0:$.certificate_authorities)&&void 0!==K?K:[],void 0,it),ot=Object(c.Wb)(null!==(V=null==t||null===(Q=t.ssl)||void 0===Q?void 0:Q.certificate)&&void 0!==V?V:"",as,it),ct=Object(c.Wb)(null!==(Y=null==t||null===(J=t.ssl)||void 0===J?void 0:J.key)&&void 0!==Y?Y:"",ls,it),ut=Object(c.ic)(null==t||null===(Z=t.secrets)||void 0===Z||null===(X=Z.ssl)||void 0===X?void 0:X.key,ns,it),dt=Object(c.Wb)(null!==(ee=null==t?void 0:t.proxy_id)&&void 0!==ee?ee:"",(()=>{}),_e("proxy_id")),gt=t,mt=Object(c.Wb)(null!==(te=null==gt?void 0:gt.version)&&void 0!==te?te:"1.0.0",void 0,_e("version")),pt=Object(c.yb)("kafkaHostsComboBox",null!==(ae=null==t?void 0:t.hosts)&&void 0!==ae?ae:[],Wi,_e("hosts")),Et=Object(c.gc)(null!==(le=null==gt?void 0:gt.auth_type)&&void 0!==le?le:D.Fb.None,_e("auth_type")),ft=Object(c.gc)(null!==(ne=null==gt?void 0:gt.connection_type)&&void 0!==ne?ne:D.Hb.Plaintext,_e("connection_type")),bt=Object(c.Wb)(null==gt?void 0:gt.username,Et.value===D.Fb.Userpass?Yi:void 0,_e("username")),ht=Object(c.Wb)(null==gt?void 0:gt.password,Et.value===D.Fb.Userpass?Ji:void 0,_e("password")),yt=Object(c.ic)(null==gt||null===(ie=gt.secrets)||void 0===ie?void 0:ie.password,Et.value===D.Fb.Userpass?Zi:void 0,_e("password")),kt=Object(c.yb)("kafkaSslCertificateAuthoritiesComboBox",null!==(se=null==gt||null===(re=gt.ssl)||void 0===re?void 0:re.certificate_authorities)&&void 0!==se?se:[],void 0,it),vt=Object(c.Wb)(null==gt||null===(oe=gt.ssl)||void 0===oe?void 0:oe.certificate,Et.value===D.Fb.Ssl?as:void 0,it),xt=Object(c.Wb)(null==gt||null===(ce=gt.ssl)||void 0===ce?void 0:ce.key,Et.value===D.Fb.Ssl?ls:void 0,it),Ft=Object(c.ic)(null==gt||null===(ue=gt.secrets)||void 0===ue||null===(de=ue.ssl)||void 0===de?void 0:de.key,Et.value===D.Fb.Ssl?ns:void 0,it),Mt=Object(c.Wb)(null!==(ge=null==gt||null===(me=gt.ssl)||void 0===me?void 0:me.verification_mode)&&void 0!==ge?ge:D.Mb.Full,void 0,it),St=Object(c.gc)(null!==(pe=null==gt||null===(Ee=gt.sasl)||void 0===Ee?void 0:Ee.mechanism)&&void 0!==pe?pe:D.Jb.Plain,_e("sasl")),It=Object(c.gc)(null!==(fe=null==gt?void 0:gt.partition)&&void 0!==fe?fe:D.Ib.Random,_e("partition")),Tt=Object(c.Wb)(null!=gt&&null!==(be=gt.random)&&void 0!==be&&be.group_events?`${gt.random.group_events}`:"1",It.value===D.Ib.Random?rs:void 0,_e("partition")),Ot=Object(c.Wb)(null==gt||null===(he=gt.hash)||void 0===he?void 0:he.hash,void 0,_e("partition")),wt=Object(c.Wb)(null!=gt&&null!==(ye=gt.round_robin)&&void 0!==ye&&ye.group_events?`${gt.round_robin.group_events}`:"1",It.value===D.Ib.RoundRobin?rs:void 0,_e("partition")),jt=Object(c.Wb)((e=>e&&0!==e.length&&e[e.length-1].topic||"")(null==gt?void 0:gt.topics),is,_e("topics")),Ct=Object(c.nc)("kafkaTopicsComboBox",!(Pt=null==gt?void 0:gt.topics)||Pt.length<=1?[]:Pt.slice(0,-1),os,_e("topics"));var Pt;const At=Object(c.Zb)("kafkaHeadersComboBox",null!==(ke=null==gt?void 0:gt.headers)&&void 0!==ke?ke:[{key:"",value:""}],cs,_e("headers")),Lt=Object(c.Wb)(null!==(ve=null==gt?void 0:gt.client_id)&&void 0!==ve?ve:"Elastic",ss,_e("client_id")),_t=Object(c.mc)(!(null==gt||!gt.compression||gt.compression===D.Gb.None),_e("compression")),Dt=Object(c.Wb)(`${null!==(xe=null==gt?void 0:gt.compression_level)&&void 0!==xe?xe:4}`,void 0,_e("compression_level")),Bt=Object(c.Wb)(null!=gt&&gt.compression&&gt.compression!==D.Gb.None?gt.compression:D.Gb.Gzip,void 0,_e("compression")),Rt=Object(c.Wb)(`${null!==(Fe=null==gt?void 0:gt.timeout)&&void 0!==Fe?Fe:30}`,void 0,_e("broker_timeout")),zt=Object(c.Wb)(`${null!==(Me=null==gt?void 0:gt.broker_timeout)&&void 0!==Me?Me:30}`,void 0,_e("timeout")),Nt=Object(c.Wb)(`${null!==(Se=null==gt?void 0:gt.required_acks)&&void 0!==Se?Se:D.Eb.Commit}`,void 0,_e("required_acks")),Ut=Object(c.Wb)(null==gt?void 0:gt.key,void 0,_e("key")),Ht=Be.value===D.Nb.Logstash,qt=Be.value===D.Nb.Kafka,Gt=Be.value===D.Nb.RemoteElasticsearch,Wt={nameInput:De,typeInput:Be,elasticsearchUrlInput:He,diskQueueEnabledInput:Ve,diskQueuePathInput:Qe,diskQueueEncryptionEnabled:Je,diskQueueMaxSizeInput:Ye,diskQueueCompressionEnabled:Xe,compressionLevelInput:tt,logstashHostsInput:st,presetInput:qe,additionalYamlConfigInput:Re,defaultOutputInput:ze,defaultMonitoringOutputInput:Ne,caTrustedFingerprintInput:Ue,serviceTokenInput:Ge,serviceTokenSecretInput:We,sslCertificateInput:ot,sslKeyInput:ct,sslKeySecretInput:ut,sslCertificateAuthoritiesInput:rt,proxyIdInput:dt,loadBalanceEnabledInput:Ze,memQueueEvents:at,queueFlushTimeout:lt,maxBatchBytes:nt,kafkaVersionInput:mt,kafkaHostsInput:pt,kafkaVerificationModeInput:Mt,kafkaAuthMethodInput:Et,kafkaConnectionTypeInput:ft,kafkaAuthUsernameInput:bt,kafkaAuthPasswordInput:ht,kafkaAuthPasswordSecretInput:yt,kafkaSaslMechanismInput:St,kafkaPartitionTypeInput:It,kafkaPartitionTypeRandomInput:Tt,kafkaPartitionTypeHashInput:Ot,kafkaPartitionTypeRoundRobinInput:wt,kafkaHeadersInput:At,kafkaClientIdInput:Lt,kafkaCompressionInput:_t,kafkaCompressionLevelInput:Dt,kafkaCompressionCodecInput:Bt,kafkaBrokerTimeoutInput:Rt,kafkaBrokerReachabilityTimeoutInput:zt,kafkaBrokerAckReliabilityInput:Nt,kafkaKeyInput:Ut,kafkaSslCertificateAuthoritiesInput:kt,kafkaSslCertificateInput:vt,kafkaSslKeyInput:xt,kafkaSslKeySecretInput:Ft,kafkaDefaultTopicInput:jt,kafkaTopicsInput:Ct},Kt=Object.values(Wt).some((e=>e.hasChanged)),$t=Object(l.useCallback)((()=>{const e=De.validate(),t=He.validate(),a=pt.validate(),l=bt.validate(),n=ht.validate(),i=yt.validate(),s=Lt.validate(),r=vt.validate(),o=xt.validate(),c=Ft.validate(),u=jt.validate(),d=Ct.validate(),g=At.validate(),m=st.validate(),p=Re.validate(),E=Ue.validate(),f=Ge.validate(),b=We.validate(),h=ot.validate(),y=ct.validate(),k=ut.validate(),v=Qe.validate(),x=Tt.validate(),F=wt.validate(),M=xt.value?o:c,S=ht.value?n:i;return Ht?m&&p&&e&&h&&(ct.value&&y||ut.value&&k):qt?e&&a&&r&&M&&l&&S&&g&&u&&d&&p&&s&&x&&F:Gt?t&&p&&e&&(Ge.value&&f||We.value&&b):t&&p&&e&&E&&v}),[De,He,pt,bt,ht,yt,Lt,vt,xt,Ft,jt,Ct,At,st,Re,Ue,Ge,We,ot,ct,ut,Qe,Tt,wt,Ht,qt,Gt]),Vt=Object(l.useCallback)((async()=>{try{if(!$t())return;je(!0);let a={};$e||(a={shipper:{mem_queue_events:at.value?Number(at.value):null,queue_flush_timeout:lt.value?Number(lt.value):null,max_batch_bytes:nt.value?Number(nt.value):null}}),!$e&&Te&&(a={...a,shipper:{disk_queue_enabled:Ve.value,disk_queue_path:Ve.value&&Qe.value?Qe.value:"",disk_queue_max_size:Ve.value&&Ye.value?Ye.value:null,disk_queue_encryption_enabled:Ve.value&&Je.value,disk_queue_compression_enabled:Xe.value,compression_level:Xe.value?Number(tt.value):null,loadbalance:Ze.value}});const l=""!==dt.value?dt.value:null,i=(()=>{const e=e=>{if(void 0!==e){const t=parseInt(e,10);if(!isNaN(t))return t}};switch(Be.value){case D.Nb.Kafka:const t=kt.value.filter((e=>""!==e)).length,n=function(e){const t={};return!e.kafkaSslKeyInput.value&&e.kafkaSslKeySecretInput.value&&(t.ssl={key:e.kafkaSslKeySecretInput.value}),!e.kafkaAuthPasswordInput.value&&e.kafkaAuthPasswordSecretInput.value&&(t.password=e.kafkaAuthPasswordSecretInput.value),Object.keys(t).length?t:null}({kafkaSslKeyInput:xt,kafkaSslKeySecretInput:Ft,kafkaAuthPasswordInput:ht,kafkaAuthPasswordSecretInput:yt});return{name:De.value,type:D.Nb.Kafka,hosts:pt.value,is_default:ze.value,is_default_monitoring:Ne.value,config_yaml:Re.value,...ft.value!==D.Hb.Plaintext||Et.value!==D.Fb.None?{ssl:{...t?{certificate_authorities:kt.value.filter((e=>""!==e))}:{},...Et.value===D.Fb.Ssl?{certificate:vt.value,key:xt.value}:{},verification_mode:Mt.value}}:{},proxy_id:l,client_id:Lt.value||void 0,version:mt.value,...Ut.value?{key:Ut.value}:{},compression:_t.value?Bt.value:D.Gb.None,..._t.value&&Bt.value===D.Gb.Gzip?{compression_level:e(Dt.value)}:{},auth_type:Et.value,...Et.value===D.Fb.None?{connection_type:ft.value}:{},...Et.value===D.Fb.Userpass&&bt.value?{username:bt.value}:{},...Et.value===D.Fb.Userpass&&ht.value?{password:ht.value}:{},...Et.value===D.Fb.Userpass&&St.value?{sasl:{mechanism:St.value}}:{},partition:It.value,...It.value===D.Ib.Random&&Tt.value?{random:{group_events:e(Tt.value)}}:{},...It.value===D.Ib.RoundRobin&&wt.value?{round_robin:{group_events:e(wt.value)}}:{},...It.value===D.Ib.Hash&&Ot.value?{hash:{hash:Ot.value}}:{},topics:[...Ct.value,{topic:jt.value}],headers:At.value,timeout:e(Rt.value),broker_timeout:e(zt.value),required_acks:e(Nt.value),...a,...n?{secrets:n}:{}};case D.Nb.Logstash:return{name:De.value,type:D.Nb.Logstash,hosts:st.value,is_default:ze.value,is_default_monitoring:Ne.value,config_yaml:Re.value,ssl:{certificate:ot.value,key:ct.value||void 0,certificate_authorities:rt.value.filter((e=>""!==e))},...!ct.value&&ut.value&&{secrets:{ssl:{key:ut.value}}},proxy_id:l,...a};case D.Nb.RemoteElasticsearch:return{name:De.value,type:D.Nb.RemoteElasticsearch,hosts:He.value,is_default:ze.value,is_default_monitoring:Ne.value,preset:qe.value,config_yaml:Re.value,service_token:Ge.value||void 0,...!Ge.value&&We.value&&{secrets:{service_token:We.value}},proxy_id:l,...a};case D.Nb.Elasticsearch:default:return{name:De.value,type:D.Nb.Elasticsearch,hosts:He.value,is_default:ze.value,is_default_monitoring:Ne.value,preset:qe.value,config_yaml:Re.value,ca_trusted_fingerprint:Ue.value,proxy_id:l,...a}}})();if(t){if(!await async function(e,t){const{agentCount:a,agentPolicyCount:l}=await ci(e);return t(n.a.createElement(us,null),n.a.createElement(ds,{agentCount:a,agentPolicyCount:l,output:e}))}(t,Pe))return void je(!1);const e=await Object(c.jb)(t.id,i);if(e.error)throw e.error}else{const e=await Object(c.cb)(i);if(e.error)throw e.error}e(),je(!1)}catch(e){je(!1),Ce.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.outputForm.errorToastTitle",{defaultMessage:"Error while saving output"})})}}),[$t,$e,Te,dt.value,t,e,at.value,lt.value,nt.value,Ve.value,Qe.value,Ye.value,Je.value,Xe.value,tt.value,Ze.value,Be.value,kt.value,xt,Ft,ht,yt,De.value,pt.value,ze.value,Ne.value,Re.value,ft.value,Et.value,vt.value,Mt.value,Lt.value,mt.value,Ut.value,_t.value,Bt.value,Dt.value,bt.value,St.value,It.value,Tt.value,wt.value,Ot.value,Ct.value,jt.value,At.value,Rt.value,zt.value,Nt.value,st.value,ot.value,ct.value,rt.value,ut.value,He.value,Ge.value,We.value,qe.value,Ue.value,Pe,Ce.toasts]);return{inputs:Wt,submit:Vt,isLoading:we,hasEncryptedSavedObjectConfigured:Oe,isShipperEnabled:!$e,isDisabled:we||t&&!Kt||Ht&&!Oe}}(e,t),s=i.inputs,{docLinks:r,cloud:o}=Object(c.lc)(),{euiTheme:m}=Object(u.useEuiTheme)(),{outputSecretsStorage:p}=ol.b.get(),[E,f]=n.a.useState(p),b=e=>{f(e)},h=Object(l.useMemo)((()=>a.map((e=>({value:e.id,label:e.name})))),[a]),{kafkaOutput:y,remoteESOutput:k}=ol.b.get(),v=s.typeInput.value===D.Nb.RemoteElasticsearch,x=s.typeInput.value===D.Nb.Elasticsearch,F=!!s.typeInput.value&&Object(Oi.c)(s.typeInput.value),M=!(null!=o&&o.isServerlessEnabled),S=[{value:D.Nb.Elasticsearch,text:"Elasticsearch"},...k&&M?[{value:D.Nb.RemoteElasticsearch,text:"Remote Elasticsearch"}]:[],{value:D.Nb.Logstash,text:"Logstash"},...y?[{value:D.Nb.Kafka,text:"Kafka"}]:[]];return n.a.createElement(u.EuiFlyout,{maxWidth:ai,onClose:e},n.a.createElement(u.EuiFlyoutHeader,{hasBorder:!0},n.a.createElement(u.EuiTitle,{size:"m"},n.a.createElement("h2",{id:"FleetEditOutputFlyoutTitle"},t?n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.editTitle",defaultMessage:"Edit output"}):n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.createTitle",defaultMessage:"Add new output"})))),n.a.createElement(u.EuiFlyoutBody,null,(null==t?void 0:t.is_preconfigured)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiCallOut,{iconType:"lock",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutTitle",defaultMessage:"This output is managed outside of Fleet"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.preconfiguredOutputCalloutDescription",defaultMessage:"Most actions related to this output are unavailable. Refer to your kibana config for more detail."})),n.a.createElement(u.EuiSpacer,{size:"m"})),n.a.createElement(u.EuiForm,null,n.a.createElement(u.EuiFormRow,w()({fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.nameInputLabel",defaultMessage:"Name"})},s.nameInput.formRowProps),n.a.createElement(u.EuiFieldText,w()({"data-test-subj":"settingsOutputsFlyout.nameInput",fullWidth:!0},s.nameInput.props,{placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.nameInputPlaceholder",{defaultMessage:"Specify name"})}))),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(n.a.Fragment,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.typeInputLabel",defaultMessage:"Type"}),s.typeInput.value===D.Nb.Kafka&&n.a.createElement(xs,{label:g.i18n.translate("xpack.fleet.settings.betaBadgeLabel",{defaultMessage:"Beta"}),size:"s",$_css:m.size.s,$_css2:m.colors.text,$_css3:m.size.xxs}))},n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSelect,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.typeInput"},s.typeInput.props,{options:S,placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.typeInputPlaceholder",{defaultMessage:"Specify type"})})),s.typeInput.value===D.Nb.Kafka||x||v?v?n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiText,{size:"s"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.remoteESTypeText",defaultMessage:"Enter your output hosts, service token for your remote cluster, and any advanced YAML configuration. Learn more about how to use these parameters in {doc}.",values:{doc:n.a.createElement(u.EuiLink,{href:r.links.fleet.remoteESOoutput,target:"_blank"},g.i18n.translate("xpack.fleet.settings.editOutputFlyout.docLabel",{defaultMessage:"our documentation"}))}}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"xs"}),n.a.createElement(u.EuiCallOut,{"data-test-subj":`settingsOutputsFlyout.${s.typeInput.value}OutputTypeCallout`,title:(()=>{switch(s.typeInput.value){case D.Nb.Kafka:return g.i18n.translate("xpack.fleet.settings.editOutputFlyout.kafkaOutputTypeCallout",{defaultMessage:"Kafka output is currently not supported on Agents using the Elastic Defend integration."});default:case D.Nb.Elasticsearch:return g.i18n.translate("xpack.fleet.settings.editOutputFlyout.esOutputTypeCallout",{defaultMessage:"This output type does not support connectivity to a remote Elasticsearch cluster, please use the Remote Elasticsearch type for that."})}})(),iconType:"alert",color:"warning",size:"s",heading:"p"})):null)),(e=>{switch(e){case D.Nb.Logstash:return n.a.createElement(ys,{inputs:s,useSecretsStorage:E,onToggleSecretStorage:b,hasEncryptedSavedObjectConfigured:i.hasEncryptedSavedObjectConfigured});case D.Nb.Kafka:return y?n.a.createElement(zi,{inputs:s,useSecretsStorage:E,onToggleSecretStorage:b}):null;case D.Nb.RemoteElasticsearch:return k?n.a.createElement(ps,{inputs:s,useSecretsStorage:E,onToggleSecretStorage:b}):null;case D.Nb.Elasticsearch:default:return n.a.createElement(ks,{inputs:s})}})(s.typeInput.value),v?null:n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.proxyIdLabel",defaultMessage:"Proxy"})},n.a.createElement(u.EuiComboBox,w()({fullWidth:!0,"data-test-subj":"settingsOutputsFlyout.proxyIdInput"},s.proxyIdInput.props,{onChange:e=>{var t,a;return s.proxyIdInput.setValue(null!==(t=null==e||null===(a=e[0])||void 0===a?void 0:a.value)&&void 0!==t?t:"")},selectedOptions:""!==s.proxyIdInput.value?h.filter((e=>e.value===s.proxyIdInput.value)):[],options:h,singleSelection:{asPlainText:!0},isDisabled:s.proxyIdInput.props.disabled,isClearable:!0,placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.proxyIdPlaceholder",{defaultMessage:"Select proxy"})}))),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},s.defaultOutputInput.formRowProps),n.a.createElement(u.EuiSwitch,w()({},s.defaultOutputInput.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentIntegrations}.",values:{boldAgentIntegrations:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentIntegrationsBold",defaultMessage:"agent integrations"}))}})}))),n.a.createElement(u.EuiFormRow,w()({fullWidth:!0},s.defaultMonitoringOutputInput.formRowProps),n.a.createElement(u.EuiSwitch,w()({},s.defaultMonitoringOutputInput.props,{label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.defaultMontoringOutputSwitchLabel",defaultMessage:"Make this output the default for {boldAgentMonitoring}.",values:{boldAgentMonitoring:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.agentMonitoringBold",defaultMessage:"agent monitoring"}))}})}))),F&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"l"}),n.a.createElement(u.EuiFormRow,{fullWidth:!0,label:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningLabel",defaultMessage:"Performance tuning"}),helpText:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningHelpText",defaultMessage:"Performance tuning presets are curated output settings for common use cases. You can also select {custom} to specify your own settings in the Advanced YAML Configuration box below. For a detailed list of settings configured by each preset, see {link}.",values:{custom:n.a.createElement("strong",null,"Custom"),link:n.a.createElement(u.EuiLink,{href:r.links.fleet.performancePresets,external:!0,target:"_blank"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningHelpTextLink",defaultMessage:"our documentation"}))}})},n.a.createElement(u.EuiSelect,w()({"data-test-subj":"settingsOutputsFlyout.presetInput"},s.presetInput.props,{onChange:e=>s.presetInput.setValue(e.target.value),disabled:s.presetInput.props.disabled||Object(Oi.d)(s.additionalYamlConfigInput.value,el.safeLoad),options:[{value:"balanced",text:"Balanced"},{value:"custom",text:"Custom"},{value:"throughput",text:"Throughput"},{value:"scale",text:"Scale"},{value:"latency",text:"Latency"}]})))),F&&Object(Oi.d)(s.additionalYamlConfigInput.value,el.safeLoad)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiCallOut,{color:"warning",iconType:"alert",size:"s",title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningMustBeCustomWarning",defaultMessage:'Performance tuning preset must be "Custom" due to presence of reserved key in advanced YAML configuration'})},n.a.createElement(u.EuiAccordion,{id:"performanceTuningMustBeCustomWarningDetails",buttonContent:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.editOutputFlyout.performanceTuningMustBeCustomWarningDetails",defaultMessage:"Show reserved keys"})},n.a.createElement("ul",null,D.ub.map((e=>n.a.createElement("li",{key:e},n.a.createElement(u.EuiCode,null,e)))))))),n.a.createElement(u.EuiSpacer,{size:"l"}),n.a.createElement(u.EuiFormRow,w()({label:n.a.createElement(u.EuiLink,{href:r.links.fleet.esSettings,external:!0,target:"_blank"},g.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputLabel",{defaultMessage:"Advanced YAML configuration"}))},s.additionalYamlConfigInput.formRowProps,{fullWidth:!0}),n.a.createElement(qi,{value:s.additionalYamlConfigInput.value,onChange:e=>{Object(Oi.d)(e,el.safeLoad)&&s.presetInput.setValue("custom"),s.additionalYamlConfigInput.setValue(e)},disabled:s.additionalYamlConfigInput.props.disabled,placeholder:g.i18n.translate("xpack.fleet.settings.editOutputFlyout.yamlConfigInputPlaceholder",{defaultMessage:"# YAML settings here will be added to the output section of each agent policy."})})),n.a.createElement(ms,{enabled:i.isShipperEnabled,inputs:s})),null!=t&&t.id&&"remote_elasticsearch"===t.type?n.a.createElement(Rn,{output:t}):null),n.a.createElement(u.EuiFlyoutFooter,null,n.a.createElement(u.EuiFlexGroup,{justifyContent:"spaceBetween"},n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButtonEmpty,{onClick:e,flush:"left"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{fill:!0,isLoading:i.isLoading,isDisabled:i.isDisabled,onClick:i.submit,"data-test-subj":"saveApplySettingsBtn"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.settings.fleetServerHostsFlyout.saveButton",defaultMessage:"Save and apply settings"}))))))};var xs=p()(u.EuiBetaBadge).withConfig({displayName:"_StyledEuiBetaBadge",componentId:"sc-1v16k6o-0"})(["margin-left:",";color:",";vertical-align:middle;margin-bottom:",";"],(e=>e.$_css),(e=>e.$_css2),(e=>e.$_css3));const Fs=Object(ei.b)((()=>{var e,t,a,i,s;Object(c.wb)("settings");const d=Object(r.useHistory)(),m=Object(c.Hb)(),{outputs:p,fleetServerHosts:E,downloadSources:f,proxies:b}={outputs:Object(c.Rb)(),fleetServerHosts:Object(c.Nb)(),downloadSources:Object(c.Kb)(),proxies:Object(c.Mb)()},{deleteOutput:h}=function(e){const{confirm:t}=Object(ei.a)(),{notifications:a}=Object(c.lc)();return{deleteOutput:Object(l.useCallback)((async l=>{try{const{agentCount:a,agentPolicyCount:i}=await ci(l);if(!await t(n.a.createElement(ui,null),n.a.createElement(di,{output:l,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:g.i18n.translate("xpack.fleet.settings.deleteOutputs.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(c.r)(l.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.deleteOutputs.errorToastTitle",{defaultMessage:"Error deleting output"})})}}),[t,a.toasts,e])}}(p.resendRequest),{deleteDownloadSource:y}=function(e){const{confirm:t}=Object(ei.a)(),{notifications:a}=Object(c.lc)();return{deleteDownloadSource:Object(l.useCallback)((async l=>{try{const{agentCount:a,agentPolicyCount:i}=await pi(l);if(!await t(n.a.createElement(yi,null),n.a.createElement(ki,{"data-test-subj":"editDownloadSourcesDeleteModal.confirmModalText",downloadSource:l,agentCount:a,agentPolicyCount:i}),{buttonColor:"danger",confirmButtonText:g.i18n.translate("xpack.fleet.settings.deleteDownloadSource.confirmButtonLabel",{defaultMessage:"Delete and deploy"})}))return;const s=await Object(c.n)(l.id);if(s.error)throw s.error;e()}catch(e){a.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.deleteDownloadSource.errorToastTitle",{defaultMessage:"Error deleting agent binary source."})})}}),[t,a.toasts,e])}}(f.resendRequest),{deleteFleetServerHost:k}=function(e){const{confirm:t}=Object(ei.a)(),{notifications:a}=Object(c.lc)();return{deleteFleetServerHost:Object(l.useCallback)((async l=>{try{if(!await t(n.a.createElement(gi,null),n.a.createElement(mi,null),{buttonColor:"danger",confirmButtonText:g.i18n.translate("xpack.fleet.settings.deleteFleetServerHosts.confirmButtonLabel",{defaultMessage:"Delete and deploy changes"})}))return;const a=await Object(c.p)(l.id);if(a.error)throw a.error;e()}catch(e){a.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.deleteFleetServerHosts.errorToastTitle",{defaultMessage:"Error deleting Fleet Server hosts"})})}}),[t,a.toasts,e])}}(E.resendRequest),{deleteFleetProxy:v}=function(e){const{confirm:t}=Object(ei.a)(),{notifications:a}=Object(c.lc)();return{deleteFleetProxy:Object(l.useCallback)((async l=>{try{if(!await t(n.a.createElement(ri,null),n.a.createElement(oi,null),{buttonColor:"danger",confirmButtonText:g.i18n.translate("xpack.fleet.settings.deleteFleetProxy.confirmButtonLabel",{defaultMessage:"Delete and deploy changes"})}))return;const a=await Object(c.o)(l.id);if(a.error)throw a.error;e()}catch(e){a.toasts.addError(e,{title:g.i18n.translate("xpack.fleet.settings.deleteFleetProxy.errorToastTitle",{defaultMessage:"Error deleting proxy"})})}}),[t,a.toasts,e])}}(b.resendRequest),x=p.resendRequest,I=f.resendRequest,T=E.resendRequest,O=b.resendRequest,w=Object(l.useCallback)((()=>{m.closeFleetServerFlyout(),x(),I(),T(),O(),d.replace(M.q.settings()[1])}),[m,x,I,T,O,d]);return p.isLoading&&p.isInitialRequest||null===(e=p.data)||void 0===e||!e.items||E.isLoading&&E.isInitialRequest||null===(t=E.data)||void 0===t||!t.items||f.isLoading&&f.isInitialRequest||null===(a=f.data)||void 0===a||!a.items||b.isLoading&&b.isInitialRequest||null===(i=b.data)||void 0===i||!i.items?n.a.createElement(S.a,{section:"settings"},n.a.createElement(F.r,null)):n.a.createElement(S.a,{section:"settings"},n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.settings_edit_fleet_server_hosts},(e=>{var t,a,l;const i=null===(t=E.data)||void 0===t?void 0:t.items.find((t=>e.match.params.itemId===t.id));return i?n.a.createElement(u.EuiPortal,null,n.a.createElement(si,{proxies:null!==(a=null===(l=b.data)||void 0===l?void 0:l.items)&&void 0!==a?a:[],onClose:w,fleetServerHost:i})):n.a.createElement(r.Redirect,{to:M.h.settings})})),n.a.createElement(o.a,{path:M.h.settings_create_fleet_server_hosts},n.a.createElement(u.EuiPortal,null,n.a.createElement(F.m,{onClose:w}))),n.a.createElement(o.a,{path:M.h.settings_create_outputs},n.a.createElement(u.EuiPortal,null,n.a.createElement(vs,{proxies:b.data.items,onClose:w}))),n.a.createElement(o.a,{path:M.h.settings_create_fleet_proxy},n.a.createElement(u.EuiPortal,null,n.a.createElement(Ti,{onClose:w}))),n.a.createElement(o.a,{path:M.h.settings_edit_fleet_proxy},(e=>{var t;const a=null===(t=b.data)||void 0===t?void 0:t.items.find((t=>e.match.params.itemId===t.id));return a?n.a.createElement(u.EuiPortal,null,n.a.createElement(Ti,{onClose:w,fleetProxy:a})):n.a.createElement(r.Redirect,{to:M.h.settings})})),n.a.createElement(o.a,{path:M.h.settings_edit_outputs},(e=>{var t,a,l;const i=null===(t=p.data)||void 0===t?void 0:t.items.find((t=>e.match.params.outputId===t.id));return i?n.a.createElement(u.EuiPortal,null,n.a.createElement(vs,{proxies:null!==(a=null===(l=b.data)||void 0===l?void 0:l.items)&&void 0!==a?a:[],onClose:w,output:i})):n.a.createElement(r.Redirect,{to:M.h.settings})})),n.a.createElement(o.a,{path:M.h.settings_create_download_sources},n.a.createElement(u.EuiPortal,null,n.a.createElement(hi,{onClose:w,proxies:(null==b||null===(s=b.data)||void 0===s?void 0:s.items)||[]}))),n.a.createElement(o.a,{path:M.h.settings_edit_download_sources},(e=>{var t,a;const l=null===(t=f.data)||void 0===t?void 0:t.items.find((t=>e.match.params.downloadSourceId===t.id));return l?n.a.createElement(u.EuiPortal,null,n.a.createElement(hi,{onClose:w,downloadSource:l,proxies:(null==b||null===(a=b.data)||void 0===a?void 0:a.items)||[]})):n.a.createElement(r.Redirect,{to:M.h.settings})}))),n.a.createElement(Xn,{deleteFleetProxy:v,proxies:b.data.items,outputs:p.data.items,fleetServerHosts:E.data.items,deleteOutput:h,deleteFleetServerHost:k,downloadSources:f.data.items,deleteDownloadSource:y}))})),Ms=({value:e})=>n.a.createElement(y.CodeEditor,{isCopyable:!0,languageId:"",height:"600px",width:"100%",options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,readOnly:!0,tabSize:2,lineNumbers:"off",lineNumbersMinChars:0,glyphMargin:!1,lineDecorationsWidth:0,overviewRulerBorder:!1},value:e}),Ss=async()=>{const e=await Object(c.v)({full:!0,perPage:M.p,sortOrder:"asc"});if(e.error)throw new Error(e.error.message);return e},Is=()=>{var e,t;const{getHref:a}=Object(c.cc)(),[i,s]=Object(l.useState)(),{data:r,status:o}=Object(b.useQuery)(["debug-agent-policies"],Ss),m=null!==(e=null==r||null===(t=r.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[],p=m.map((e=>({label:`${e.name} - ${e.id}`,value:e.id}))),E=i?[p.find((e=>e.value===i))]:[],f=m.find((e=>e.id===i)),h=()=>{s(void 0),Ws.invalidateQueries(["debug-agent-policies"])};return"error"===o?n.a.createElement(u.EuiCallOut,{title:"Error",color:"danger"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.fetchError",defaultMessage:"Error fetching Agent Policies"})):n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.description",defaultMessage:"Search for an Agent Policy using its name or {codeId} value. Use the code block below to diagnose any potential issues with the policy's configuration.",values:{codeId:n.a.createElement(u.EuiCode,null,"id")}}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},n.a.createElement(Ts,{grow:!1},n.a.createElement(u.EuiComboBox,{"aria-label":g.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.selectLabel",{defaultMessage:"Select an Agent Policy"}),placeholder:g.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.selectLabel",{defaultMessage:"Select an Agent Policy"}),fullWidth:!0,options:p,singleSelection:{asPlainText:!0},selectedOptions:E,isLoading:"loading"===o,onChange:e=>{e.length?s(e[0].value):s(void 0)}})),i&&n.a.createElement(T.c,{hasFleetServer:Object(C.t)(f)},(e=>n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(u.EuiButton,{color:"danger",onClick:()=>e(i,h)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.policyForm.deletePolicyActionText",defaultMessage:"Delete policy"}))))))),i&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiLink,{target:"_blank",href:a("policy_details",{policyId:i})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.agentPolicyDebugger.viewAgentPolicyLink",defaultMessage:"View Agent Policy in Fleet UI"})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ms,{value:JSON.stringify(f,null,2)})))};var Ts=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1uw5h1v-0"})(["min-width:600px;"]),Os=a(52);const ws=async()=>{var e;const t=await Object(c.J)({prerelease:!0});if(t.error)throw new Error(t.error.message);return null===(e=t.data)||void 0===e?void 0:e.items.filter((({status:e})=>"installed"===e))},js=()=>{var e,t,a,i,s;const{http:r,notifications:o}=Object(c.lc)(),{getHref:m}=Object(c.cc)(),[p,E]=Object(l.useState)(),[f,h]=Object(l.useState)(!1),[y,k]=Object(l.useState)(!1),v=Object(b.useQuery)(["debug-integrations"],ws),x=Object(b.useMutation)((async e=>{const t=await Object(c.kb)(e.name,e.version,!0);if(t.error)throw o.toasts.addError(t.error,{title:g.i18n.translate("xpack.fleet.debug.integrationDebugger.uninstall.error",{defaultMessage:"Error uninstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:t.error.message}),k(!1),new Error(t.error.message);return o.toasts.addSuccess(g.i18n.translate("xpack.fleet.debug.integrationDebugger.uninstall.success",{defaultMessage:"Successfully uninstalled {integrationTitle}",values:{integrationTitle:e.title}})),E(void 0),k(!1),Ws.invalidateQueries(["debug-integrations"]),t.data})),F=Object(b.useMutation)((async e=>{const t=await Object(c.kb)(e.name,e.version,!0);if(t.error)throw o.toasts.addError(t.error,{title:g.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.error",{defaultMessage:"Error reinstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:t.error.message}),h(!1),new Error(t.error.message);const a=await Object(c.M)(e.name,e.version);if(a.error)throw o.toasts.addError(new Error(a.error.message),{title:g.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.error",{defaultMessage:"Error reinstalling {integrationTitle}",values:{integrationTitle:e.title}}),toastMessage:a.error.message}),h(!1),new Error(a.error.message);return o.toasts.addSuccess(g.i18n.translate("xpack.fleet.debug.integrationDebugger.reinstall.success",{defaultMessage:"Successfully reinstalled {integrationTitle}",values:{integrationTitle:e.title}})),E(void 0),h(!1),Ws.invalidateQueries(["debug-integrations"]),a.data}));if("error"===v.status)return n.a.createElement(u.EuiCallOut,{title:"Error",color:"danger"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.fetchError",defaultMessage:"Error fetching installed Integrations"}));const M=null!==(e=null===(t=v.data)||void 0===t?void 0:t.map((e=>({label:e.name,value:e.id,icon:Object(Os.a)(e,r.basePath)}))))&&void 0!==e?e:[],S=p?[M.find((e=>e.value===p))]:[],I=null===(a=v.data)||void 0===a?void 0:a.find((e=>e.id===p));return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.description",defaultMessage:"Use this tool to uninstall or reinstall installed integrations."})),n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.reinstallationDescription",defaultMessage:"Reinstalling an integration will uninstall and then immediately install it again. This can be useful in restoring broken or malformed integration installations when a user hasn't done much customization."}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},n.a.createElement(Cs,{grow:!1},n.a.createElement(u.EuiComboBox,{"aria-label":g.i18n.translate("xpack.fleet.debug.integrationDebugger.selectLabel",{defaultMessage:"Select an Integration"}),placeholder:g.i18n.translate("xpack.fleet.debug.integrationDebugger.selectLabel",{defaultMessage:"Select an Integration"}),fullWidth:!0,options:M,singleSelection:{asPlainText:!0},selectedOptions:S,isDisabled:"loading"===v.status,prepend:S.length>0?n.a.createElement(u.EuiButtonEmpty,null,n.a.createElement(u.EuiIcon,{type:null!==(i=null===(s=S[0])||void 0===s?void 0:s.icon)&&void 0!==i?i:"fleetApp"})):void 0,renderOption:(e,t,a)=>n.a.createElement("span",{className:a},n.a.createElement(u.EuiIcon,{type:e.icon})," ",n.a.createElement(u.EuiHighlight,{search:t},e.label)),onChange:e=>{e.length?E(e[0].value):E(void 0)}})),I&&n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"primary",onClick:()=>h(!0)},"Reinstall")),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement(u.EuiButton,{color:"danger",onClick:()=>k(!0)},"Uninstall")),f&&n.a.createElement(u.EuiConfirmModal,{title:`Reinstall ${I.title}`,onCancel:()=>h(!1),onConfirm:()=>F.mutate(I),isLoading:F.isLoading,cancelButtonText:g.i18n.translate("xpack.fleet.debug.integrationDebugger.cancelReinstall",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.debug.integrationDebugger.confirmReinstall",{defaultMessage:"Reinstall"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.reinstallModal",defaultMessage:"Are you sure you want to reinstall {integrationTitle}?",values:{integrationTitle:I.title}})),y&&n.a.createElement(u.EuiConfirmModal,{title:`Uninstall ${I.title}`,onCancel:()=>k(!1),onConfirm:()=>x.mutate(I),isLoading:x.isLoading,cancelButtonText:g.i18n.translate("xpack.fleet.debug.integrationDebugger.cancelUninstall",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.debug.integrationDebugger.confirmUninstall",{defaultMessage:"Uninstall"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.uninstallModal",defaultMessage:"Are you sure you want to uninstall {integrationTitle}?",values:{integrationTitle:I.title}})))),I&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiLink,{target:"_blank",href:m("integration_details_overview",{pkgkey:Object(C.s)({name:I.name,version:I.version})})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.integrationDebugger.viewIntegrationLink",defaultMessage:"View integration settings in Integrations UI"}))))};var Cs=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-xg6n36-0"})(["min-width:600px;"]);const Ps=Object(l.forwardRef)((({name:e,setName:t,type:a,setNamesStatus:i},s)=>{const{data:r,refetch:o,status:d}=Object(b.useQuery)(["debug-saved-object-names",a],(()=>(async e=>{var t;const a={size:0,query:{bool:{filter:{term:{type:e}}}},aggs:{names:{terms:{field:`${e}.name`,size:500}}}},l=await Object(c.lb)({method:"post",path:"/api/console/proxy",query:{path:"/.kibana/_search",method:"GET"},body:a});if(l.error)throw new Error(l.error.message);return null===(t=l.data)||void 0===t?void 0:t.aggregations.names.buckets})(a)),{refetchOnWindowFocus:!1});null==i||i(d),Object(l.useImperativeHandle)(s,(()=>({refetchNames:o})));const m=(null!=r?r:[]).map((e=>({label:e.key,value:e.key}))),p=m.find((t=>t.value===e)),E=p?[p]:[];return n.a.createElement(u.EuiComboBox,{prepend:"Name","aria-label":g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectedSavedObjectLabel",{defaultMessage:"Select a Saved Object"}),placeholder:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectedSavedObjectLabel",{defaultMessage:"Select a Saved Object"}),fullWidth:!0,options:m,singleSelection:{asPlainText:!0},selectedOptions:E,isLoading:"loading"===d,onChange:e=>{e.length?t(e[0].value):t(void 0)}})})),As=()=>{const e=[{value:`${D.k}`,text:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.agentPolicyLabel",{defaultMessage:"Agent policy"})},{value:`${D.qb}`,text:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.packagePolicyLabel",{defaultMessage:"Integration policy"})},{value:`${D.kb}`,text:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.outputLabel",{defaultMessage:"Output"})},{value:`${D.mb}`,text:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.packageLabel",{defaultMessage:"Packages"})},{value:`${D.v}`,text:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.downloadSourceLabel",{defaultMessage:"Download Sources"})},{value:`${D.U}`,text:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.fleetServerHostLabel",{defaultMessage:"Fleet Server Hosts"})}],[t,a]=Object(l.useState)(e[0].value),[i,s]=Object(l.useState)(),[r,o]=Object(l.useState)(),m=Object(l.useRef)(),{data:p,status:E}=Object(b.useQuery)(["debug-saved-objects",t,i],(()=>(async(e,t)=>{var a;if(!e||!t)return;const l={query:{bool:{must:{match:{[`${e}.name`]:t}},filter:{term:{type:e}}}}},n=await Object(c.lb)({method:"post",path:"/api/console/proxy",query:{path:"/.kibana/_search",method:"GET"},body:l});if(n.error)throw new Error(n.error.message);return null===(a=n.data)||void 0===a?void 0:a.hits})(t,i)));return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.savedObjectDebugger.description",defaultMessage:"Search for Fleet-related saved objects by selecting a type and name. Use the code block below to diagnose any potential issues."}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{alignItems:"center",justifyContent:"flexStart"},n.a.createElement(Ls,{grow:!1},n.a.createElement(u.EuiFormRow,null,n.a.createElement(u.EuiSelect,{prepend:"Type",id:"soType",options:e,value:t,onChange:e=>(e=>{a(e.target.value),s(void 0),m.current.refetchNames()})(e),"aria-label":g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.selectTypeLabel",{defaultMessage:"Select saved object type"})}))),n.a.createElement(_s,{grow:!1},n.a.createElement(u.EuiFormRow,null,n.a.createElement(Ps,{name:i,setName:s,type:t,setNamesStatus:o,ref:m})))),p&&("error"===E||"error"===r)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:"Error",color:"danger"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.savedObjectDebugger.fetchError",defaultMessage:"Error fetching Saved Objects"}))),(p||"loading"===E)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ms,{value:JSON.stringify(p,null,2)})))};var Ls=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1ovx3fm-0"})(["min-width:300px;"]),_s=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem2",componentId:"sc-1ovx3fm-1"})(["min-width:400px;"]);const Ds=async()=>{var e,t;const a=`${M.c}.is_preconfigured:true`,l=await Object(c.v)({kuery:a,perPage:M.p,full:!0});if(l.error)throw new Error(l.error.message);return null!==(e=null===(t=l.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[]},Bs=()=>{var e,t,a,i;const{getHref:s}=Object(c.cc)(),{notifications:r}=Object(c.lc)(),[o,m]=Object(l.useState)(),[p,E]=Object(l.useState)(!1),[f,h]=Object(l.useState)(!1),y=Object(b.useQuery)(["debug-preconfigured-policies"],Ds),k=null!==(e=null===(t=y.data)||void 0===t?void 0:t.map((e=>({label:e.name,value:e.id}))))&&void 0!==e?e:[],v=o?[k.find((({value:e})=>e===o))]:[],x=null===(a=y.data)||void 0===a?void 0:a.find((e=>e.id===o)),F=Object(b.useMutation)((async e=>{const t=await Object(c.ob)(e);if(t.error)throw r.toasts.addError(t.error,{title:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetError",{defaultMessage:"Error resetting policy"}),toastMessage:t.error.message}),new Error(t.error.message);return r.toasts.addSuccess(g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetSuccess",{defaultMessage:"Successfully reset policy"})),Ws.invalidateQueries(["debug-preconfigured-policies"]),m(void 0),E(!1),t.data})),M=Object(b.useMutation)((async()=>{const e=await Object(c.nb)();if(e.error)throw r.toasts.addError(e.error,{title:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllError",{defaultMessage:"Error resetting policies"}),toastMessage:e.error.message}),new Error(e.error.message);return r.toasts.addSuccess(g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllSuccess",{defaultMessage:"Successfully reset policies"})),Ws.invalidateQueries(["debug-preconfigured-policies"]),m(void 0),h(!1),e.data}));return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.description",defaultMessage:"This tool can be used to reset preconfigured policies that are managed via {codeKibanaYml}. This includes Fleet's default policies that may exist in cloud environments.",values:{codeKibanaYml:n.a.createElement(u.EuiCode,null,"kibana.yml")}})),n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetInstructions",defaultMessage:'You may reset a single preconfigured policy or use the "Reset all" button to reset all preconfigured policies at once.'}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(Rs,{grow:!1},n.a.createElement(u.EuiComboBox,{"aria-label":g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.selectLabel",{defaultMessage:"Select a preconfigured policy"}),placeholder:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.selectLabel",{defaultMessage:"Select a preconfigured policy"}),fullWidth:!0,options:k,singleSelection:{asPlainText:!0},selectedOptions:v,onChange:e=>{e.length?m(e[0].value):m(void 0)}})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(u.EuiButton,{color:"warning",isDisabled:!o,onClick:()=>E(!0)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetButton",defaultMessage:"Reset"})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(u.EuiButton,{color:"danger",isDisabled:!(null!==(i=y.data)&&void 0!==i&&i.length),onClick:()=>h(!0)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetAllButton",defaultMessage:"Reset all"}))))),p&&x&&o&&n.a.createElement(u.EuiConfirmModal,{title:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalTitle",{defaultMessage:"Reset {policyName}",values:{policyName:x.name}}),onCancel:()=>E(!1),onConfirm:()=>F.mutate(o),isLoading:F.isLoading,cancelButtonText:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalCancel",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetModalConfirm",{defaultMessage:"Reset"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetModalBody",defaultMessage:"Are you sure you want to reset {policyName}?",values:{policyName:x.name}})),f&&n.a.createElement(u.EuiConfirmModal,{title:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalTitle",{defaultMessage:"Reset all preconfigured policies"}),onCancel:()=>h(!1),onConfirm:()=>M.mutate(),isLoading:M.isLoading,cancelButtonText:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalCancel",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.resetAllModalConfirm",{defaultMessage:"Reset all"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.resetAllModalBody",defaultMessage:"Are you sure you want to reset all preconfigured policies?"})),o&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiLink,{target:"_blank",href:s("policy_details",{policyId:o})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.preconfigurationDebugger.viewAgentPolicyLink",defaultMessage:"View Agent Policy in Fleet UI"})),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ms,{value:JSON.stringify(x,null,2)})))};var Rs=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-y0mpv-0"})(["min-width:400px;"]);const zs=()=>{var e,t,a,i;const s=[{label:".fleet-agents",value:".fleet-agents"},{label:".fleet-actions",value:".fleet-actions"},{label:".fleet-servers",value:".fleet-servers"},{label:".fleet-enrollment-api-keys",value:".fleet-enrollment-api-keys"}],[r,o]=Object(l.useState)(),{data:m,status:p}=Object(b.useQuery)(["debug-indices",r],(()=>(async e=>{if(!e)return;const t=`/${e}/_search`;return await Object(c.lb)({method:"post",path:"/api/console/proxy",query:{path:t,method:"GET"}})})(r)),{retry:!1}),E=r?[s.find((e=>e.value===r))]:[];return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.fleetIndexDebugger.description",defaultMessage:"Search for the contents of Fleet indices. Use the code block below to diagnose any potential issues. "}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(u.EuiFlexItem,null,n.a.createElement(u.EuiFormRow,null,n.a.createElement(u.EuiComboBox,{prepend:"Index","aria-label":g.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.selectLabel",{defaultMessage:"Select an index"}),placeholder:g.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.selectLabel",{defaultMessage:"Select an index"}),fullWidth:!0,options:s,singleSelection:{asPlainText:!0},selectedOptions:E,isLoading:"loading"===p,onChange:e=>{e.length?o(e[0].value):o(void 0)}})))),(null==m?void 0:m.error)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:"Error",color:"danger"},null!==(e=null==m||null===(t=m.error)||void 0===t||null===(a=t.error)||void 0===a?void 0:a.reason)&&void 0!==e?e:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.fleetIndexDebugger.fetchError",defaultMessage:"Error fetching index data"}))),m&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ms,{value:JSON.stringify(null===(i=m.data)||void 0===i?void 0:i.hits,null,2)})))},Ns=async()=>{var e,t;const a=await Object(c.F)();if(a.error)throw new Error(a.error.message);return null!==(e=null===(t=a.data)||void 0===t?void 0:t.items)&&void 0!==e?e:[]},Us=()=>{var e;const{notifications:t}=Object(c.lc)(),[a,i]=Object(l.useState)(),[s,r]=Object(l.useState)(!1),[o,m]=Object(l.useState)(!1),{data:p}=Object(b.useQuery)(["debug-orphaned-policies"],Ns),E=null!==(e=null==p?void 0:p.map((e=>({label:e.name,value:e.id}))))&&void 0!==e?e:[],f=a?[E.find((({value:e})=>e===a))]:[],h=null==p?void 0:p.find((e=>e.id===a)),y=Object(b.useMutation)((async e=>{const a=await Object(c.s)({packagePolicyIds:[e],force:!0});if(a.error)throw t.toasts.addError(a.error,{title:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteError",{defaultMessage:"Error deleting policy"}),toastMessage:a.error.message}),new Error(a.error.message);return t.toasts.addSuccess(g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteSuccess",{defaultMessage:"Successfully deleted orphaned policy"})),Ws.invalidateQueries(["debug-orphaned-policies"]),i(void 0),r(!1),a.data})),k=Object(b.useMutation)((async()=>{const e=await Object(c.s)({packagePolicyIds:null==p?void 0:p.map((e=>e.id)),force:!0});if(e.error)throw t.toasts.addError(e.error,{title:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllError",{defaultMessage:"Error deleting orphaned policies"}),toastMessage:e.error.message}),new Error(e.error.message);return t.toasts.addSuccess(g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllSuccess",{defaultMessage:"Successfully deleted all orphaned policies"})),Ws.invalidateQueries(["debug-orphaned-policies"]),i(void 0),m(!1),e.data}));return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.description",defaultMessage:'This tool can be used to delete "orphaned" integration policies that have been unlinked from their parent agent policy objects'})),n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteOptions",defaultMessage:'You may delete a single orphaned integration policy or use the "Delete all" button to delete all orphaned integration policies at once.'}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,null,n.a.createElement(Hs,{grow:!1},n.a.createElement(u.EuiComboBox,{"aria-label":g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.selectLabel",{defaultMessage:"Select an orphaned integration policy"}),placeholder:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.selectLabel",{defaultMessage:"Select an orphaned integration policy"}),fullWidth:!0,options:E,singleSelection:{asPlainText:!0},selectedOptions:f,onChange:e=>{e.length?i(e[0].value):i(void 0)}})),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(u.EuiButton,{color:"warning",isDisabled:!a,onClick:()=>r(!0)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteButton",defaultMessage:"Delete"})))),n.a.createElement(u.EuiFlexItem,{grow:!1},n.a.createElement("div",null,n.a.createElement(u.EuiButton,{color:"danger",isDisabled:!(null!=p&&p.length),onClick:()=>m(!0)},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllButton",defaultMessage:"Delete all"}))))),s&&h&&a&&n.a.createElement(u.EuiConfirmModal,{title:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteModalTitle",{defaultMessage:"Delete {policyName}",values:{policyName:h.name}}),onCancel:()=>r(!1),onConfirm:()=>y.mutate(a),isLoading:y.isLoading,cancelButtonText:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.cancelDelete",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.confirmDelete",{defaultMessage:"Delete"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteModalBody",defaultMessage:"Are you sure you want to delete {policyName}?",values:{policyName:h.name}})),o&&n.a.createElement(u.EuiConfirmModal,{title:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllModalTitle",{defaultMessage:"Delete all orphaned integration policies"}),onCancel:()=>m(!1),onConfirm:()=>k.mutate(),isLoading:k.isLoading,cancelButtonText:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.cancelDeleteAll",{defaultMessage:"Cancel"}),confirmButtonText:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.confirmDeleteAll",{defaultMessage:"Delete all"})},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.orphanedIntegrationPolicyDebugger.deleteAllModalBody",defaultMessage:"Are you sure you want to delete all orphaned integration policies?"})),a&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(Ms,{value:JSON.stringify(h,null,2)})))};var Hs=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-tbjlhb-0"})(["min-width:400px;"]);const qs=()=>{var e,t,a,i,s,r;const[o,g]=Object(l.useState)(),{data:m}=Object(c.Nb)(),p=Object(l.useMemo)((()=>{var e;return null!==(e=null==m?void 0:m.items)&&void 0!==e?e:[]}),[null==m?void 0:m.items]);Object(l.useEffect)((()=>{const e=p.find((e=>!0===e.is_default));e&&g(e)}),[p]);const E=Object(l.useMemo)((()=>(null==o?void 0:o.host_urls[0])||""),[null==o?void 0:o.host_urls]),[f,h]=Object(l.useState)(),{data:y}=Object(b.useQuery)(["fleetServerHealth",E],(()=>Object(c.ab)({host:E})),{refetchInterval:1e4});Object(l.useEffect)((()=>{h(y)}),[y]);const k=Object(l.useMemo)((()=>[...p.map((e=>({inputDisplay:`${e.name} (${e.host_urls[0]})`,value:e.id})))]),[p]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiText,{grow:!1},n.a.createElement("p",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.description",defaultMessage:"Select the host used to enroll Fleet Server. The connection is refreshed every {interval}s.",values:{interval:10}}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiFlexGroup,{alignItems:"center"},n.a.createElement(Gs,{grow:!1},n.a.createElement(u.EuiSuperSelect,{fullWidth:!0,"data-test-subj":"fleetDebug.fleetServerHostsSelect",prepend:n.a.createElement(u.EuiText,{size:"relative",color:""},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.fleetServerHostsLabel",defaultMessage:"Fleet Server Hosts"})),onChange:e=>{h(void 0),g(p.find((t=>t.id===e)))},valueOfSelected:null==o?void 0:o.id,options:k})),n.a.createElement(u.EuiFlexItem,{grow:!1},null!=f&&null!==(e=f.data)&&void 0!==e&&e.status&&E===(null==f||null===(t=f.data)||void 0===t?void 0:t.host)?n.a.createElement(u.EuiFlexGroup,{alignItems:"center"},n.a.createElement(u.EuiFlexItem,null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.status",defaultMessage:"Status:"})),n.a.createElement(u.EuiFlexItem,null,(e=>{if(!e)return null;let t;switch(e){case"HEALTHY":t="success";break;case"UNHEALTHY":t="warning";break;default:t="subdued"}return n.a.createElement(u.EuiHealth,{color:t},e)})(null==f||null===(a=f.data)||void 0===a?void 0:a.status))):null)),(null==f?void 0:f.error)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{title:"Error",color:"danger"},null!==(i=null==f||null===(s=f.error)||void 0===s?void 0:s.message)&&void 0!==i?i:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.healthCheckPanel.fetchError",defaultMessage:"Message: {errorMessage}",values:{errorMessage:null==f||null===(r=f.error)||void 0===r?void 0:r.message}}))))};var Gs=p()(u.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1ss3z0x-0"})(["min-width:600px;"]);const Ws=new b.QueryClient,Ks=[{title:g.i18n.translate("xpack.fleet.debug.HealthCheckStatus.title",{defaultMessage:"Health Check Status"}),id:"healthCheckStatus",component:n.a.createElement(qs,null)},{title:g.i18n.translate("xpack.fleet.debug.agentPolicyDebugger.title",{defaultMessage:"Agent Policy Debugger"}),id:"agentPolicyDebugger",component:n.a.createElement(Is,null)},{title:g.i18n.translate("xpack.fleet.debug.integrationDebugger.title",{defaultMessage:"Integration Debugger"}),id:"integrationDebugger",component:n.a.createElement(js,null)},{title:g.i18n.translate("xpack.fleet.debug.savedObjectDebugger.title",{defaultMessage:"Saved Object Debugger"}),id:"savedObjectDebugger",component:n.a.createElement(As,null)},{title:g.i18n.translate("xpack.fleet.debug.fleetIndexDebugger.title",{defaultMessage:"Fleet Index Debugger"}),id:"fleetIndexDebugger",component:n.a.createElement(zs,null)},{title:g.i18n.translate("xpack.fleet.debug.preconfigurationDebugger.title",{defaultMessage:"Preconfiguration Debugger"}),id:"preconfigurationDebugger",component:n.a.createElement(Bs,null)},{title:g.i18n.translate("xpack.fleet.debug.orphanedIntegrationPolicyDebugger.title",{defaultMessage:"Orphaned Integration Policy Debugger"}),id:"orphanedIntegrationPolicyDebugger",component:n.a.createElement(Us,null)}],$s=({isInitialized:e,setupError:t})=>{const{chrome:a}=Object(c.lc)(),{getHref:l}=Object(c.cc)();return a.docTitle.change(["Debug","Fleet"]),n.a.createElement(b.QueryClientProvider,{client:Ws},n.a.createElement(u.EuiPage,{paddingSize:"xl"},n.a.createElement(u.EuiPageBody,{panelled:!0},n.a.createElement(u.EuiPageSection,null,n.a.createElement(u.EuiPageHeader,{pageTitle:g.i18n.translate("xpack.fleet.debug.pageTitle",{defaultMessage:"Fleet Debugging Dashboard"}),iconType:"wrench"}),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiCallOut,{color:"danger",iconType:"warning",title:"Danger zone"},n.a.createElement(u.EuiText,{grow:!1},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.description",defaultMessage:"This page provides an interface for directly managing Fleet's underlying data and diagnosing issues. Be aware that these debugging tools can be {strongDestructive} in nature and can result in {strongLossOfData}. Please proceed with caution.",values:{strongDestructive:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.destructive",defaultMessage:"destructive"})),strongLossOfData:n.a.createElement("strong",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.dangerZone.lossOfData",defaultMessage:"loss of data"}))}}))),!e&&(null==t?void 0:t.message)&&n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiSpacer,{size:"s"}),n.a.createElement(u.EuiCallOut,{color:"danger",iconType:"warning",title:"Setup error"},n.a.createElement(u.EuiText,{grow:!1},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.initializationError.description",defaultMessage:"{message}. You can use this page to debug the error.",values:{message:null==t?void 0:t.message}}))))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiPageSection,null,Ks.map((({title:e,id:t,component:a})=>n.a.createElement(n.a.Fragment,null,n.a.createElement(u.EuiAccordion,{id:t,initialIsOpen:!0,buttonContent:n.a.createElement(u.EuiTitle,{size:"l"},n.a.createElement("h2",null,e))},n.a.createElement(u.EuiSpacer,{size:"m"}),a),n.a.createElement(u.EuiHorizontalRule,null)))),n.a.createElement(u.EuiTitle,{size:"l"},n.a.createElement("h2",null,n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.debug.usefulLinks.title",defaultMessage:"Useful links"}))),n.a.createElement(u.EuiSpacer,{size:"m"}),n.a.createElement(u.EuiListGroup,{listItems:[{label:g.i18n.translate("xpack.fleet.debug.usefulLinks.viewAgents",{defaultMessage:"View Agents in Fleet UI"}),href:l("agent_list"),iconType:"agentApp",target:"_blank"},{label:g.i18n.translate("xpack.fleet.debug.usefulLinks.troubleshootingGuide",{defaultMessage:"Troubleshooting Guide"}),href:"https://www.elastic.co/guide/en/fleet/current/fleet-troubleshooting.html",iconType:"popout",target:"_blank"}]})))),n.a.createElement(h.ReactQueryDevtools,{initialIsOpen:!1}))},Vs=new b.QueryClient,Qs=({isAddIntegrationsPath:e,children:t})=>n.a.createElement(u.EuiErrorBoundary,null,e?n.a.createElement(S.c,{leftColumn:n.a.createElement(S.b,null)},t):n.a.createElement(S.a,null,n.a.createElement(S.d,null,t))),Ys=p()(u.EuiPanel).withConfig({displayName:"Panel",componentId:"sc-1lganp-0"})(["max-width:500px;margin-right:auto;margin-left:auto;"]),Js=Object(l.memo)((({error:e})=>"MISSING_SECURITY"===e?n.a.createElement(Vt.b,{missingRequirements:["security_required","api_keys"]}):"MISSING_PRIVILEGES"===e?n.a.createElement(Ys,{"data-test-subj":"missingPrivilegesPrompt"},n.a.createElement(u.EuiEmptyPrompt,{iconType:"securityApp",title:n.a.createElement("h2",{"data-test-subj":"missingPrivilegesPromptTitle"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorTitle",defaultMessage:"Permission denied"})),body:n.a.createElement("p",{"data-test-subj":"missingPrivilegesPromptMessage"},n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.permissionDeniedErrorMessage",defaultMessage:"You are not authorized to access Fleet. It requires the {roleName1} Kibana privilege for Fleet, and the {roleName2} or {roleName1} privilege for Integrations.",values:{roleName1:n.a.createElement(u.EuiCode,null,'"All"'),roleName2:n.a.createElement(u.EuiCode,null,'"Read"')}}))})):n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.permissionsRequestErrorMessageTitle",defaultMessage:"Unable to check permissions"}),error:g.i18n.translate("xpack.fleet.permissionsRequestErrorMessageDescription",{defaultMessage:"There was a problem checking Fleet permissions"})}))),Zs=Object(l.memo)((({children:e})=>{Object(c.wb)("base");const t=Object(c.lc)(),{notifications:a}=t,i=Object(c.vb)().fleet.all,[s,o]=Object(l.useState)(!1),[u,m]=Object(l.useState)(),[p,E]=Object(l.useState)(!1),[f,b]=Object(l.useState)(null),h=!!Object(r.useRouteMatch)(M.h.add_integration_to_policy),y=!!Object(r.useRouteMatch)(M.h.debug);return Object(l.useEffect)((()=>{(async()=>{o(!1),m(void 0),E(!1),b(null);try{var e;o(!0);const s=await Object(c.K)();if(o(!1),null!==(e=s.data)&&void 0!==e&&e.success){try{var t,l;const e=await Object(c.pb)();e.error&&b(e.error),null!==(t=e.data)&&void 0!==t&&null!==(l=t.nonFatalErrors)&&void 0!==l&&l.length&&a.toasts.addError(e.data.nonFatalErrors[0],{title:g.i18n.translate("xpack.fleet.setup.uiPreconfigurationErrorTitle",{defaultMessage:"Configuration error"})}),i||m("MISSING_PRIVILEGES")}catch(e){b(e)}E(!0)}else{var n;m((null===(n=s.data)||void 0===n?void 0:n.error)||"REQUEST_ERROR")}}catch(e){m("REQUEST_ERROR")}})()}),[a.toasts,i]),s||u?n.a.createElement(Qs,{isAddIntegrationsPath:h},s?n.a.createElement(F.r,null):n.a.createElement(Js,{error:u})):y?n.a.createElement($s,{setupError:f,isInitialized:p}):!p||f?n.a.createElement(Qs,{isAddIntegrationsPath:h},f?n.a.createElement(F.j,{title:n.a.createElement(d.FormattedMessage,{id:"xpack.fleet.initializationErrorMessageTitle",defaultMessage:"Unable to initialize Fleet"}),error:f}):n.a.createElement(F.n,null)):n.a.createElement(n.a.Fragment,null,e)})),Xs=Object(l.memo)((({children:e,startServices:t,config:a,history:l,kibanaVersion:i,extensions:s,routerHistory:r,theme$:d,fleetStatus:g})=>{const m=f()(d),p=m&&m.darkMode;return n.a.createElement(k.a,{coreStart:{application:t.application}},n.a.createElement(t.i18n.Context,null,n.a.createElement(y.KibanaContextProvider,{services:{...t,theme:{theme$:d}}},n.a.createElement(u.EuiErrorBoundary,null,n.a.createElement(c.b.Provider,{value:a},n.a.createElement(c.e.Provider,{value:i},n.a.createElement(y.KibanaThemeProvider,{theme$:d},n.a.createElement(v.EuiThemeProvider,{darkMode:p},n.a.createElement(b.QueryClientProvider,{client:Vs},n.a.createElement(h.ReactQueryDevtools,{initialIsOpen:!1}),n.a.createElement(c.f.Provider,{value:s},n.a.createElement(c.c,{defaultFleetStatus:g},n.a.createElement(o.b,{history:l},n.a.createElement(x.e,{notifications:t.notifications,theme$:d},n.a.createElement(c.d,null,e))))))))))))))})),er=Object(l.memo)((({setHeaderActionMenu:e})=>{const t=Object(c.lc)(),{TopNavMenu:a}=t.navigation.ui,l=[{label:g.i18n.translate("xpack.fleet.appNavigation.sendFeedbackButton",{defaultMessage:"Send feedback"}),iconType:"popout",run:()=>window.open("https://ela.st/fleet-feedback")}];return n.a.createElement(a,{appName:g.i18n.translate("xpack.fleet.appTitle",{defaultMessage:"Fleet"}),config:l,setMenuMountPoint:e})})),tr=Object(l.memo)((({setHeaderActionMenu:e})=>{var t;const a=Object(c.Hb)(),l=Object(c.Gb)(),{agentTamperProtectionEnabled:i}=C.b.get();return n.a.createElement(n.a.Fragment,null,n.a.createElement(er,{setHeaderActionMenu:e}),n.a.createElement(o.c,null,n.a.createElement(o.a,{path:M.h.agents},n.a.createElement(Va,null)),n.a.createElement(o.a,{path:M.h.policies},n.a.createElement(ae,null)),n.a.createElement(o.a,{path:M.h.enrollment_tokens},n.a.createElement(xn,null)),i&&n.a.createElement(o.a,{path:M.h.uninstall_tokens},n.a.createElement(An,null)),n.a.createElement(o.a,{path:M.h.data_streams},n.a.createElement(se,null)),n.a.createElement(o.a,{path:M.h.settings},n.a.createElement(Fs,null)),n.a.createElement(o.a,{path:M.h.add_integration_to_policy},n.a.createElement(fn,null)),n.a.createElement(o.a,{render:({location:e})=>{if(!(""===e.pathname&&e.hash.length>0))return n.a.createElement(r.Redirect,{to:M.h.agents});const t=e.hash.replace(/^#(\/fleet)?/,"");return n.a.createElement(r.Redirect,{to:{...e,pathname:t,hash:void 0}})}})),a.isEnrollmentFlyoutOpen&&n.a.createElement(u.EuiPortal,null,n.a.createElement(F.c,{defaultMode:!l.isReady||null!==(t=l.missingRequirements)&&void 0!==t&&t.includes("fleet_server")?"standalone":"managed",isIntegrationFlow:!0,onClose:()=>a.closeEnrollmentFlyout()})),a.isFleetServerFlyoutOpen&&n.a.createElement(u.EuiPortal,null,n.a.createElement(F.m,{onClose:()=>a.closeFleetServerFlyout()})))})),ar=({isAllowed:e=!1,restrictedPath:t="/",...a})=>e?n.a.createElement(o.a,a):n.a.createElement(r.Redirect,{to:{pathname:t}}),lr=({startServices:e,config:t,history:a,kibanaVersion:l,extensions:i,setHeaderActionMenu:s,theme$:r})=>n.a.createElement(Xs,{startServices:e,config:t,history:a,kibanaVersion:l,extensions:i,theme$:r},n.a.createElement(Zs,null,n.a.createElement(tr,{setHeaderActionMenu:s})));function nr(e,{element:t,history:a,setHeaderActionMenu:l,theme$:i},r,o,c){return s.a.render(n.a.createElement(lr,{startServices:e,config:r,history:a,kibanaVersion:o,extensions:c,setHeaderActionMenu:l,theme$:i}),t),()=>{s.a.unmountComponentAtNode(t)}}const ir=e=>{e.chrome.docTitle.reset(),e.chrome.setBreadcrumbs([]),c.g.stop()}}}]);