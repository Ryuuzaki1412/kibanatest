/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[22],{364:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"d",(function(){return c})),a.d(t,"c",(function(){return m})),a.d(t,"b",(function(){return g}));var s=a(47),n=a.n(s),i=a(376);const r=5e3,l=10,o=100;function u({dataViewPattern:e,timeFieldName:t,fromDate:a,toDate:s,dslQuery:n,runtimeMappings:i,aggs:r,fields:l,size:o}){const u=t?[{range:{[t]:{gte:a,lte:s,format:"strict_date_optional_time"}}},n]:[n];return 1===(null==l?void 0:l.length)&&u.push({exists:l[0]}),{index:e,body:{query:{bool:{filter:u}},aggs:r,fields:l,runtime_mappings:i,_source:(null==l||!l.length)&&void 0},track_total_hits:!0,size:null!=o?o:0}}async function c({searchHandler:e,dataView:t,field:a,fromDate:s,toDate:o,size:u}){return a.aggregatable?"geo_point"===a.type||"geo_shape"===a.type?await async function(e,t,a){try{const s=a.getFormatterForField(t);return await p(e,t,a,s)}catch(e){return console.error(e),{}}}(e,a,t):d(a)?"histogram"===a.type?await b(e,a,!1):g(a)?await async function(e,t){const a={sample:{sampler:{shard_size:r},aggs:{min_max_summary:{filter:{exists:{field:t.name}},aggs:{min:{min:{field:t.name}},max:{max:{field:t.name}}}}}}},s=await e({aggs:a}),n=s.aggregations.sample.min_max_summary.min.value,i=s.aggregations.sample.min_max_summary.max.value,l=s.aggregations.sample.doc_count;return{totalDocuments:j(s),sampledDocuments:l,sampledValues:l,numberSummary:{minValue:n,maxValue:i}}}(e,a):"number"===a.type?await b(e,a):"date"===a.type?await async function(e,t,a){const s=n.a.parse(a.fromDate),i=n.a.parse(a.toDate);if(!s)throw Error("Invalid fromDate value");if(!i)throw Error("Invalid toDate value");const r=Math.round((i.valueOf()-s.valueOf())/10);if(r<1)return{totalDocuments:0,histogram:{buckets:[]}};const l=`${r}ms`,o={histo:{date_histogram:{...f(t),fixed_interval:l}}},u=await e({aggs:o});return{totalDocuments:j(u),histogram:{buckets:u.aggregations.histo.buckets.map((e=>({count:e.doc_count,key:e.key})))}}}(e,a,{fromDate:s,toDate:o}):await async function(e,t,a=l){const s=f(t),n={sample:{sampler:{shard_size:r},aggs:{sample_count:{value_count:{...s}},top_values:{terms:{...s,size:a,shard_size:a<=10?25:void 0}}}}},i=await e({aggs:n}),o={buckets:i.aggregations.sample.top_values.buckets.map((e=>({count:e.doc_count,key:e.key})))};return{totalDocuments:j(i),sampledDocuments:i.aggregations.sample.doc_count,sampledValues:y(o,i.aggregations.sample.top_values.sum_other_doc_count)||i.aggregations.sample.sample_count.value,topValues:o}}(e,a,u):{}:Object(i.a)(a)?await p(e,a,t):{}}function d(e){return!("document"===e.type||e.type.includes("range")||"geo_point"===e.type||"geo_shape"===e.type||"murmur3"===e.type||"attachment"===e.type)}function m(e){return e.aggregatable&&d(e)||Object(i.c)(e)}function g(e){return"counter"===e.timeSeriesMetric}async function b(e,t,a=!0){const s=f(t),n={min_value:{min:{field:t.name}},max_value:{max:{field:t.name}},sample_count:{value_count:{...s}}},i={sample:{sampler:{shard_size:r},aggs:{...n}}},o={sample:{sampler:{shard_size:r},aggs:{...n,top_values:{terms:{...s,size:l}}}}},u=await e({aggs:a?o:i}),c=u.aggregations.sample.min_value.value,d=u.aggregations.sample.max_value.value,m="top_values"in u.aggregations.sample?u.aggregations.sample.top_values:{buckets:[],sum_other_doc_count:0},g={buckets:m.buckets.map((e=>({count:e.doc_count,key:e.key})))};let b=(d-c)/10;if(Number.isInteger(c)&&Number.isInteger(d)&&(b=Math.ceil(b)),0===b)return{totalDocuments:j(u),sampledValues:y(g,m.sum_other_doc_count)||u.aggregations.sample.sample_count.value,sampledDocuments:u.aggregations.sample.doc_count,topValues:g,histogram:a?{buckets:[]}:{buckets:[{count:u.aggregations.sample.doc_count,key:c}]}};const p={sample:{sampler:{shard_size:r},aggs:{histo:{histogram:{field:t.name,interval:b}}}}},h=await e({aggs:p});return{totalDocuments:j(u),sampledDocuments:u.aggregations.sample.doc_count,sampledValues:y(g,m.sum_other_doc_count)||u.aggregations.sample.sample_count.value,histogram:{buckets:h.aggregations.sample.histo.buckets.map((e=>({count:e.doc_count,key:e.key})))},topValues:g}}async function p(e,t,a,s){try{const n=f(t),r={size:o,fields:[n]},u=await e(r),c=Object(i.b)({hits:u.hits.hits,field:t,dataView:a,count:l},s);return{totalDocuments:j(u),sampledDocuments:c.sampledDocuments,sampledValues:c.sampledValues,topValues:{buckets:c.buckets}}}catch(e){return console.error(e),{}}}function f(e){return e.scripted?{script:{lang:e.lang,source:e.script}}:{field:e.name}}const j=e=>{var t,a;return null!==(t=null!==(a=e.hits.total.value)&&void 0!==a?a:e.hits.total)&&void 0!==t?t:0};function y(e,t){var a;return((null==e||null===(a=e.buckets)||void 0===a?void 0:a.reduce(((e,t)=>t.count+e),0))||0)+(t||0)}},376:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return l}));var s=a(7);const n=["_type","_source"];const i=e=>"_score"!==e.name&&["string","text","keyword","version","ip","number","geo_point","geo_shape"].includes(e.type),r=e=>!e.aggregatable&&i(e)||"geo_point"===e.type||"geo_shape"===e.type;function l(e,t){if(e=Object(s.defaults)(e,{count:5}),!i(e.field))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const a=(r=e.hits,l=e.field,o=e.dataView,Object(s.map)(r,(function(e){return function(e,t,a){var i;const r={};function l(e,n=""){for(const[i,o]of Object.entries(e)){const e=n+i,u=null==t?void 0:t.fields.getByName(e);if(!1===(null==a?void 0:a.shallow)){const t="nested"===(null==u?void 0:u.type);if(Array.isArray(o)&&!t){o.forEach((t=>Object(s.isPlainObject)(t)&&l(t,e+".")));continue}}else if(void 0!==r[e])continue;const c=u&&"conflict"!==u.type,d=!Object(s.isPlainObject)(o);c||d?r[e]?Array.isArray(r[e])?r[e].push(o):r[e]=[r[e],o]:r[e]=o:l(o,e+".")}}return l(e.fields||{}),!1!==(null==a?void 0:a.source)&&e._source?l(e._source):null!=a&&a.includeIgnoredValues&&e.ignored_field_values&&Object.entries(e.ignored_field_values).forEach((([e,t])=>{r[e]?Array.isArray(r[e])?r[e]=[...r[e],...t]:r[e]=[r[e],...t]:r[e]=t})),null==t||null===(i=t.metaFields)||void 0===i||i.forEach((t=>{n.includes(t)||"_"!==t.charAt(0)||(r[t]=e[t])})),new Proxy(r,{ownKeys:e=>Reflect.ownKeys(e).sort(((e,a)=>{var s,n;const i=null==t||null===(s=t.metaFields)||void 0===s?void 0:s.includes(String(e)),r=null==t||null===(n=t.metaFields)||void 0===n?void 0:n.includes(String(a));return i&&r?String(e).localeCompare(String(a)):i?1:r?-1:String(e).localeCompare(String(a))}))})}(e,o,{includeIgnoredValues:!0})[l.name]})));var r,l,o;const{groups:u,sampledValues:c}=function(e,t){const a={};let n=0;return e.forEach((function(e){if(Object(s.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let i,r=0;const l={};i=Array.isArray(e)?e:null==e?[]:[e],i.forEach((e=>{const s=t?t.convert(e):e;l[s]||(a.hasOwnProperty(s)?a[s].count++:a[s]={key:s,count:1,order:r++},l[s]=!0,n++)}))})),{groups:a,sampledValues:n}}(a,t);return{buckets:Object(s.sortBy)(u,["count","order"]).reverse().slice(0,e.count).map((e=>Object(s.pick)(e,["key","count"]))),sampledValues:c,sampledDocuments:e.hits.length}}},693:function(e,t,a){"use strict";a.r(t);var s=a(2),n=a.n(s),i=a(118);const r="query:queryString:options",l="query:allowLeadingWildcards",o="courier:ignoreFilterIfFieldNotInIndex";var u=a(47),c=a.n(u),d=a(29),m=a(15),g=a(67),b=a(3),p=a(68),f=a(376),j=a(364);var y=a(674),h=a(6);const v=({areExamples:e,buckets:t,dataView:a,field:i,sampledValuesCount:r,color:l=x(),"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c})=>{if(null==t||!t.length)return null;const m=a.getFormatterForField(i),g=S(_(t),r),b=t.some((e=>!Number.isInteger(e.count/r)));return Object(h.jsx)("div",{"data-test-subj":e?"unifiedFieldStats-exampleValueBuckets":"unifiedFieldStats-topValueBuckets"},Object(h.jsx)("div",{"data-test-subj":`${o}-topValues`},t.map(((e,t)=>{const a=e.key,n=m.convert(a);return Object(h.jsx)(s.Fragment,{key:a},t>0&&Object(h.jsx)(d.EuiSpacer,{size:"s"}),Object(h.jsx)(y.default,{field:i,fieldValue:a,formattedFieldValue:n,formattedPercentage:O(e.count,r,b),progressValue:F(e.count,r),count:e.count,color:l,"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c}))})),g>0&&Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(d.EuiSpacer,{size:"s"}),Object(h.jsx)(y.default,{type:"other",field:i,fieldValue:void 0,formattedPercentage:O(g,r,b),progressValue:F(g,r),count:g,color:l,"data-test-subj":o,onAddFilter:u,overrideFieldTopValueBar:c}))))},x=()=>Object(d.euiPaletteColorBlind)()[1],O=(e,t,a)=>t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}%`:"",F=(e,t)=>t>0?e/t:0,_=e=>(null==e?void 0:e.reduce(((e,t)=>t.count+e),0))||0,S=(e,t)=>t&&e?t-e:0,D=({message:e})=>Object(h.jsx)(d.EuiText,{size:"s"},e),k=({dataView:e,field:t,numberSummary:a,"data-test-subj":s})=>{if(!a||!V(a))return null;const n=e.getFormatterForField(t),i=[{key:"min",label:b.i18n.translate("unifiedFieldList.fieldStats.numberSummary.minLabel",{defaultMessage:"min"}),value:n.convert(a.minValue,"text")},{key:"max",label:b.i18n.translate("unifiedFieldList.fieldStats.numberSummary.maxLabel",{defaultMessage:"max"}),value:n.convert(a.maxValue,"text")}],r=[{field:"label",name:"",align:d.LEFT_ALIGNMENT},{field:"value",name:"",render:e=>Object(h.jsx)("strong",null,e),align:d.RIGHT_ALIGNMENT}],l=b.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"});return Object(h.jsx)(d.EuiBasicTable,{compressed:!0,items:i,columns:r,tableCaption:l,"data-test-subj":`${s}-numberSummary`,responsive:!1,css:Object(h.css)("& .euiTableHeaderCell{",Object(d.euiScreenReaderOnly)(),";}& .euiTableRowCell{border-top:none;}","")})};function V(e){return"number"==typeof(null==e?void 0:e.minValue)&&"number"==typeof(null==e?void 0:e.maxValue)}class error_boundary_ErrorBoundary extends n.a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?null:this.props.children}}const T=({services:e,query:t,dslQuery:u,filters:y,fromDate:O,toDate:F,dataViewOrDataViewId:T,field:w,color:E=x(),"data-test-subj":L="fieldStats",overrideMissingContent:M,overrideFooter:A,onAddFilter:z,overrideFieldTopValueBar:I,onStateChange:C})=>{const{fieldFormats:B,uiSettings:N,charts:R,dataViews:$,data:G}=e,[P,q]=Object(s.useState)({isLoading:!1}),[H,Q]=Object(s.useState)(null),U=Object(s.useRef)(null),W=Object(s.useRef)(!1),K=Object(s.useCallback)((e=>{W.current||q(e)}),[q,W]);Object(s.useEffect)((function(){C&&C(P)}),[C,P]);const Z=Object(s.useCallback)((e=>{W.current||Q(e)}),[Q,W]);Object(s.useEffect)((()=>{!async function(){var e;if(!W.current)try{var s;const n="string"==typeof T?await $.get(T):T;if(Z(n),P.isLoading)return;K((e=>({...e,isLoading:!0}))),null===(s=U.current)||void 0===s||s.abort(),U.current=new AbortController;const i=await(async e=>{const{loadFieldStats:t}=await a.e(30).then(a.bind(null,690));return await t(e)})({services:{data:G},dataView:n,field:w,fromDate:O,toDate:F,dslQuery:null!=u?u:Object(p.buildEsQuery)(n,null!=t?t:[],null!=y?y:[],(e=N,{allowLeadingWildcards:e.get(l),queryStringOptions:e.get(r),ignoreFilterIfFieldNotInIndex:e.get(o),dateFormatTZ:e.get("dateFormat:tz")})),abortController:U.current});U.current=null,K((e=>({...e,isLoading:!1,totalDocuments:i.totalDocuments,sampledDocuments:i.sampledDocuments,sampledValues:i.sampledValues,histogram:i.histogram,topValues:i.topValues,numberSummary:i.numberSummary})))}catch(e){K((e=>({...e,isLoading:!1})))}}()}),[T,w,u,t,y,O,F,e]),Object(s.useEffect)((()=>()=>{var e;W.current=!0,null===(e=U.current)||void 0===e||e.abort()}),[]);const J=R.theme.useChartsTheme(),X=R.theme.useChartsBaseTheme(),Y=Object(s.useMemo)((()=>{var e;return E?{...J,barSeriesStyle:{...J.barSeriesStyle,rect:{...(null===(e=J.barSeriesStyle)||void 0===e?void 0:e.rect)||{},fill:E}}}:J}),[J,E]),{isLoading:ee,histogram:te,topValues:ae,numberSummary:se,sampledValues:ne,sampledDocuments:ie,totalDocuments:re}=P;let le=!!P.histogram;const oe=c.a.parse(O),ue=c.a.parse(F),ce=_(null==ae?void 0:ae.buckets),de=S(ce,ne);ce&&te&&te.buckets.length&&ae&&ae.buckets.length&&(le=de/ce>.9);const[me,ge]=Object(s.useState)(le);if(ee)return Object(h.jsx)(d.EuiLoadingSpinner,{"data-test-subj":`${L}-statsLoading`});if(!H)return null;const be=H.getFormatterForField(w);let pe=Object(h.jsx)(n.a.Fragment,null);function fe(e){const t="unifiedFieldStats-statsFooter-docsCount",a=re?Object(h.jsx)(d.EuiText,{color:"subdued",size:"xs","data-test-subj":`${L}-statsFooter`},ie&&ie<re?Object(h.jsx)(m.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:ie,sampledDocumentsFormatted:Object(h.jsx)("strong",{"data-test-subj":t},B.getDefaultInstance(i.b.NUMBER,[i.a.INTEGER]).convert(ie))}}):Object(h.jsx)(m.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromTotalRecordsLabel",defaultMessage:"Calculated from {totalDocumentsFormatted} {totalDocuments, plural, one {record} other {records}}.",values:{totalDocuments:re,totalDocumentsFormatted:Object(h.jsx)("strong",{"data-test-subj":t},B.getDefaultInstance(i.b.NUMBER,[i.a.INTEGER]).convert(re))}})):Object(h.jsx)(n.a.Fragment,null);return Object(h.jsx)(n.a.Fragment,null,pe?Object(h.jsx)("div",{"data-test-subj":`${L}-title`},pe):Object(h.jsx)(n.a.Fragment,null),Object(h.jsx)(d.EuiSpacer,{size:"s"}),e,A?null==A?void 0:A({element:a,totalDocuments:re,sampledDocuments:ie}):Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(d.EuiSpacer,{size:"m"}),a))}if(!Object(j.c)(w)){const e=Object(h.jsx)(D,{message:b.i18n.translate("unifiedFieldList.fieldStats.notAvailableForThisFieldDescription",{defaultMessage:"Analysis is not available for this field."})});return M?M({reason:"unsupported",element:e}):e}if(Object(j.b)(w)&&V(se))return pe=Object(h.jsx)(d.EuiTitle,{size:"xxxs"},Object(h.jsx)("h6",null,b.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"}))),fe(Object(h.jsx)(k,{dataView:H,field:w,numberSummary:se,"data-test-subj":L}));if(!(te&&0!==te.buckets.length||ae&&0!==ae.buckets.length)){const e=ie&&re&&ie<re?Object(h.jsx)(D,{message:b.i18n.translate("unifiedFieldList.fieldStats.noFieldDataInSampleDescription",{defaultMessage:"No field data for {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:ie,sampledDocumentsFormatted:B.getDefaultInstance(i.b.NUMBER,[i.a.INTEGER]).convert(ie)}})}):Object(h.jsx)(D,{message:b.i18n.translate("unifiedFieldList.fieldStats.noFieldDataDescription",{defaultMessage:"No field data for the current search."})});return M?M({reason:"no-data",element:e}):e}if(te&&te.buckets.length&&ae&&ae.buckets.length?pe=Object(h.jsx)(n.a.Fragment,null,Object(h.jsx)(d.EuiButtonGroup,{"data-test-subj":"unifiedFieldStats-buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:b.i18n.translate("unifiedFieldList.fieldStats.displayToggleLegend",{defaultMessage:"Toggle either the"}),options:[{label:b.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"}),id:"topValues","data-test-subj":`${L}-buttonGroup-topValuesButton`},{label:b.i18n.translate("unifiedFieldList.fieldStats.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram","data-test-subj":`${L}-buttonGroup-distributionButton`}],onChange:e=>{ge("histogram"===e)},idSelected:me?"histogram":"topValues"}),Object(h.jsx)(d.EuiSpacer,{size:"xs"})):"date"===w.type?pe=Object(h.jsx)(d.EuiTitle,{size:"xxxs"},Object(h.jsx)("h6",null,b.i18n.translate("unifiedFieldList.fieldStats.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):ae&&ae.buckets.length&&(pe=Object(h.jsx)(d.EuiTitle,{size:"xxxs"},Object(h.jsx)("h6",null,Object(f.c)(w)?b.i18n.translate("unifiedFieldList.fieldStats.examplesLabel",{defaultMessage:"Examples"}):b.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"})))),te&&te.buckets.length){const e=b.i18n.translate("unifiedFieldList.fieldStats.countLabel",{defaultMessage:"Count"});if("date"===w.type)return fe(Object(h.jsx)("div",{"data-test-subj":"unifiedFieldStats-timeDistribution"},Object(h.jsx)("div",{"data-test-subj":`${L}-histogram`},Object(h.jsx)(g.Chart,{size:{height:200,width:268}},Object(h.jsx)(g.Tooltip,{type:g.TooltipType.None}),Object(h.jsx)(g.Settings,{locale:b.i18n.getLocale(),theme:Y,baseTheme:X,xDomain:oe&&ue?{min:oe.valueOf(),max:ue.valueOf(),minInterval:Math.round((ue.valueOf()-oe.valueOf())/10)}:void 0}),Object(h.jsx)(g.Axis,{id:"key",position:g.Position.Bottom,tickFormat:oe&&ue?Object(g.niceTimeFormatter)([oe.valueOf(),ue.valueOf()]):void 0,showOverlappingTicks:!0}),Object(h.jsx)(g.HistogramBarSeries,{data:te.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:g.ScaleType.Time,yScaleType:g.ScaleType.Linear,timeZone:"local"})))));if(me||!ae||!ae.buckets.length)return fe(Object(h.jsx)("div",{"data-test-subj":"unifiedFieldStats-histogram"},Object(h.jsx)(g.Chart,{"data-test-subj":`${L}-histogram`,size:{height:200,width:"100%"}},Object(h.jsx)(g.Tooltip,{type:g.TooltipType.None}),Object(h.jsx)(g.Settings,{locale:b.i18n.getLocale(),rotation:90,theme:Y,baseTheme:X}),Object(h.jsx)(g.Axis,{id:"key",position:g.Position.Left,showOverlappingTicks:!0,tickFormat:e=>be.convert(e)}),Object(h.jsx)(g.HistogramBarSeries,{data:te.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:g.ScaleType.Linear,yScaleType:g.ScaleType.Linear}))))}return ae&&ae.buckets.length?fe(Object(h.jsx)(v,{areExamples:Object(f.c)(w),buckets:ae.buckets,dataView:H,field:w,sampledValuesCount:ne,color:E,"data-test-subj":L,onAddFilter:z,overrideFieldTopValueBar:I})):null};t.default=e=>Object(h.jsx)(error_boundary_ErrorBoundary,null,Object(h.jsx)(T,e))}}]);