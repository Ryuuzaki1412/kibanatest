/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[18],{100:function(e,t,a){"use strict";a.r(t),a.d(t,"mountApp",(function(){return fe}));var s=a(72),n=a.n(s),o=a(2),l=a.n(o),i=a(283),r=a(3),c=a(15),d=a(29),u=a(23),b=a(229),m=a(105),j=a(0),p=a(108),x=a(6);const g=()=>Object(x.jsx)(d.EuiPageTemplate.EmptyPrompt,{"data-test-subj":"mlPageAccessDenied",color:"danger",iconType:"warning",title:Object(x.jsx)("h2",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.noPermissionToAccessLabel",defaultMessage:"Access denied"})),body:Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.noGrantedPrivilegesDescription",defaultMessage:"You donâ€™t have permission to manage Machine Learning jobs. Access to the plugin requires the Machine Learning feature to be visible in this space."}))}),f=({basePath:e})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiPageTemplate.EmptyPrompt,{title:Object(x.jsx)("h2",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.insufficientLicenseLabel",defaultMessage:"Machine learning is a subscription feature"})),"data-test-subj":"mlPageInsufficientLicense",body:Object(x.jsx)(d.EuiFlexGroup,{direction:"column"},Object(x.jsx)(d.EuiFlexItem,null,Object(x.jsx)(d.EuiText,{color:"subdued"},Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.insufficientLicenseDescription",defaultMessage:"Select an option to unlock it."})))),Object(x.jsx)(d.EuiFlexItem,null,Object(x.jsx)(d.EuiFlexGroup,{justifyContent:"center"},Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiButtonEmpty,{"data-test-subj":"license-prompt-upgrade",key:"upgrade-subscription-button",target:"_blank",href:"https://www.elastic.co/subscriptions"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.insufficientLicenseDescription.SubscriptionLink",defaultMessage:"Upgrade your subscription"}))),Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiButton,{fill:!0,"data-test-subj":"license-prompt-trial",key:"start-trial-button",target:"_blank",href:`${e.get()}/app/management/stack/license_management/home`},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.insufficientLicenseDescription.startTrialLink",defaultMessage:"Start trial"}))))))}));var O=a(372),y=a(177),h=a(155),E=a.n(h),M=a(107),I=a(9);const F=({jobs:e,autoExpand:t=!1})=>0===e.length?null:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiCallOut,{title:r.i18n.translate("xpack.ml.importExport.importFlyout.cannotImportJobCallout.title",{defaultMessage:"{num, plural, one {# job} other {# jobs}} cannot be imported",values:{num:e.length}}),color:"warning","data-test-subj":"mlJobMgmtImportJobsCannotBeImportedCallout"},t?Object(x.jsx)(S,{jobs:e}):Object(x.jsx)(d.EuiAccordion,{id:"advancedOptions",paddingSize:"s","aria-label":r.i18n.translate("xpack.ml.importExport.importFlyout.cannotImportJobCallout.jobListAria",{defaultMessage:"view jobs"}),buttonContent:Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.cannotImportJobCallout.jobListButton",defaultMessage:"View jobs"})},Object(x.jsx)(S,{jobs:e}))),Object(x.jsx)(d.EuiSpacer,{size:"m"})),S=({jobs:e})=>Object(x.jsx)(l.a.Fragment,null,e.length>0&&Object(x.jsx)(l.a.Fragment,null,e.map((({jobId:e,missingIndices:t,missingFilters:a})=>Object(x.jsx)(d.EuiText,{size:"s"},Object(x.jsx)("h5",null,e),t.length>0&&Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.cannotImportJobCallout.missingIndex",defaultMessage:"Missing index {num, plural, one {pattern} other {patterns}}: {indices}",values:{num:t.length,indices:t.join(",")}}),a.length>0&&Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.cannotImportJobCallout.missingFilters",defaultMessage:"Missing filter {num, plural, one {list} other {lists}}: {filters}",values:{num:a.length,filters:a.join(",")}})))))),v=()=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiSpacer,{size:"l"}),Object(x.jsx)(d.EuiCallOut,{title:r.i18n.translate("xpack.ml.importExport.importFlyout.cannotReadFileCallout.title",{defaultMessage:"File cannot be read"}),color:"warning"},Object(x.jsx)("div",{"data-test-subj":"mlJobMgmtImportJobsFileReadErrorCallout"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.cannotReadFileCallout.body",defaultMessage:"Please select a file contained Machine Learning jobs which have been exported from Kibana using the Export Jobs option"}))));var k=a(104);class JobImportService{_readFile(e){return new Promise(((t,a)=>{if(e&&e.size){const s=new FileReader;s.readAsText(e),s.onload=()=>{const e=s.result;if("string"==typeof e)try{const a=JSON.parse(e);t(a)}catch(e){a()}else a()}}else a()}))}async readJobConfigs(e){try{const a=await this._readFile(e),s=Array.isArray(a)?a:[a];if(t=s,Array.isArray(t)&&t.some((e=>e.job&&e.datafeed))){const e=s.map((e=>e.job.job_id));return{jobs:s,jobIds:e,jobType:"anomaly-detector"}}if(function(e){return Array.isArray(e)&&e.some((e=>e.dest&&e.analysis))}(s)){const e=s.map((e=>e.id));return{jobs:s,jobIds:e,jobType:"data-frame-analytics"}}return{jobs:[],jobIds:[],jobType:null}}catch(e){return{jobs:[],jobIds:[],jobType:null}}var t}renameAdJobs(e,t){return t.length!=t.length?t:t.map(((t,a)=>{const{jobId:s}=e[a];return t.job.job_id=s,t.datafeed.job_id=s,t.datafeed.datafeed_id=`datafeed-${s}`,t}))}renameDfaJobs(e,t){return t.length!=t.length?t:t.map(((t,a)=>{const{jobId:s,destIndex:n}=e[a];return t.id=s,void 0!==n&&(t.dest.index=n),t}))}async validateJobs(e,t,a,s){const n=new Set(await a()),o=new Set((await s()).map((e=>e.filter_id))),l=[],i=[];return("anomaly-detector"===t?e.map((e=>({jobId:e.job.job_id,indices:e.datafeed.indices,filters:C(e.job)}))):e.map((e=>({jobId:e.id,destIndex:e.dest.index,indices:Array.isArray(e.source.index)?e.source.index:[e.source.index]})))).forEach((({jobId:e,indices:a,filters:s=[],destIndex:r})=>{const c=a.filter((e=>!1===n.has(e))),d=s.filter((e=>!1===o.has(e)));0===c.length&&0===d.length?l.push({jobId:e,..."data-frame-analytics"===t?{destIndex:r}:{}}):i.push({jobId:e,missingIndices:c,missingFilters:d})})),{jobs:l,skippedJobs:i}}}function C(e){const t=new Set;return e.analysis_config.detectors.forEach((e=>{void 0!==e.custom_rules&&e.custom_rules.forEach((e=>{void 0!==e.scope&&Object.values(e.scope).forEach((e=>{t.add(e.filter_id)}))}))})),[...t]}var T=a(250),w=a(111),D=a(44);const J=r.i18n.translate("xpack.ml.importExport.importFlyout.validateJobId.jobNameEmpty",{defaultMessage:"Enter a valid job ID"}),_=r.i18n.translate("xpack.ml.importExport.importFlyout.validateJobId.jobNameAllowedCharacters",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"}),A=r.i18n.translate("xpack.ml.importExport.importFlyout.validateJobId.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:D.b}}),B=r.i18n.translate("xpack.ml.importExport.importFlyout.validateJobId.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."}),L=r.i18n.translate("xpack.ml.importExport.importFlyout.validateDestIndex.destIndexEmpty",{defaultMessage:"Enter a valid destination index"}),z=r.i18n.translate("xpack.ml.importExport.importFlyout.validateDestIndex.destIndexInvalid",{defaultMessage:"Invalid destination index name."}),V=r.i18n.translate("xpack.ml.importExport.importFlyout.validateDestIndex.destIndexExists",{defaultMessage:"An index with this name already exists. Be aware that running this analytics job will modify this destination index."}),P=({isDisabled:e})=>{const{services:{data:{dataViews:{getTitles:t}},notifications:{toasts:a},mlServices:{mlUsageCollection:s,mlApiServices:{jobs:{bulkCreateJobs:n},dataFrameAnalytics:{createDataFrameAnalytics:i},filters:{filters:u}}}}}=Object(I.d)(),b=Object(o.useMemo)((()=>new JobImportService),[]),[j,p]=Object(o.useState)(!1),[g,f]=Object(o.useState)([]),[O,y]=Object(o.useState)([]),[h,S]=Object(o.useState)([]),[C,P]=Object(o.useState)([]),[W,U]=Object(o.useState)(!1),[G,$]=Object(o.useState)(null),[H,q]=Object(o.useState)(0),[Y,K]=Object(o.useState)(!0),[Q,X]=Object(o.useState)(!0),[Z,ee]=Object(o.useState)(""),[te,ae]=Object(o.useState)(!1),[se,ne]=Object(o.useState)(!1),{displayErrorToast:oe,displaySuccessToast:le}=Object(o.useMemo)((()=>Object(k.b)(a)),[a]),{isADEnabled:ie,isDFAEnabled:re}=Object(m.d)(),[ce]=((e,t,a,s,n)=>{const{jobs:{jobsExist:l},dataFrameAnalytics:{jobsExist:i},checkIndicesExists:r}=Object(I.c)();return[Object(o.useCallback)((async()=>{const a=[],o=[],c="anomaly-detector"===e;if(t.filter((({jobIdValidated:e})=>!1===e)).forEach((e=>{e.jobIdValid=!0,e.jobIdInvalidMessage="",""===e.jobId?(e.jobIdValid=!1,e.jobIdInvalidMessage=J,e.jobIdValidated=c):e.jobId.length>D.b?(e.jobIdValid=!1,e.jobIdInvalidMessage=A,e.jobIdValidated=c):!1===Object(w.l)(e.jobId)&&(e.jobIdValid=!1,e.jobIdInvalidMessage=_,e.jobIdValidated=c),!0===e.jobIdValid&&a.push(e.jobId)})),"data-frame-analytics"===e&&t.filter((({destIndexValidated:e})=>!1===e)).forEach((e=>{void 0!==e.destIndex&&(e.destIndexValid=!0,e.destIndexInvalidMessage="",""===e.destIndex?(e.destIndexValid=!1,e.destIndexInvalidMessage=L,e.destIndexValidated=!0):!1===Object(T.a)(e.destIndex)&&(e.destIndexValid=!1,e.destIndexInvalidMessage=z,e.destIndexValidated=!0),!0===e.destIndexValid&&o.push(e.destIndex))})),null!==e){const c="anomaly-detector"===e?l:i,d=await c(a,!0);if(t.forEach((e=>{const t=d[e.jobId];if(t){const{exists:a}=t;e.jobIdValid=!a,e.jobIdInvalidMessage=a?B:"",e.jobIdValidated=!0}})),"data-frame-analytics"===e){const e=await r({indices:o});t.forEach((t=>{if(void 0!==t.destIndex&&!1===t.destIndexValidated){var a;const s=!0===(null===(a=e[t.destIndex])||void 0===a?void 0:a.exists);t.destIndexInvalidMessage=s?V:"",t.destIndexValidated=!0}}))}s([...t]),n(!1)}}),[a,t])]})(G,h,Z,S,ae);E()(ce,400,[Z]);const de=Object(o.useCallback)(((e=!1)=>{f([]),y([]),S([]),ee(""),U(!1),$(null),q(0),ae(!1),ne(e)}),[]);Object(o.useEffect)((function(){de()}),[j]);const ue=Object(o.useCallback)((async e=>{if(ne(!1),0!==e.length)try{const a=await b.readJobConfigs(e[0]);if(null===a.jobType||"anomaly-detector"===a.jobType&&!1===ie||"data-frame-analytics"===a.jobType&&!1===re)return void de(!0);q(a.jobs.length);const s=await b.validateJobs(a.jobs,a.jobType,t,u);if("anomaly-detector"===a.jobType){const e=a.jobs.filter((e=>s.jobs.map((({jobId:e})=>e)).includes(e.job.job_id)));f(e)}else if("data-frame-analytics"===a.jobType){const e=a.jobs.filter((e=>s.jobs.map((({jobId:e})=>e)).includes(e.id)));y(e)}$(a.jobType),S(s.jobs.map((({jobId:e,destIndex:t})=>({jobId:e,originalId:e,jobIdValid:!0,jobIdInvalidMessage:"",jobIdValidated:!1,destIndex:t,originalDestIndex:t,destIndexValid:!0,destIndexInvalidMessage:"",destIndexValidated:!1}))));const n=N(s.jobs,a.jobType);ee(n),ae(!0),P(s.skippedJobs)}catch(e){oe(e)}else de()}),[]),be=Object(o.useCallback)((async()=>{U(!0);try{if("anomaly-detector"===G&&!0===ie){const e=b.renameAdJobs(h,g);await me(e),s.count("imported_anomaly_detector_jobs",e.length)}else if("data-frame-analytics"===G&&!0===re){const e=b.renameDfaJobs(h,O);await je(e),s.count("imported_data_frame_analytics_jobs",e.length)}}catch(e){oe(e)}U(!1),p(!1)}),[G,h,g,O]),me=Object(o.useCallback)((async e=>{const t=await n(e);let a=0;const o=[],l=new Set;Object.entries(t).forEach((([e,{job:t,datafeed:s}])=>{t.error||s.error?(l.add(e),t.error&&o.push(t.error),s.error&&o.push(s.error)):a++})),a>0&&pe(a),o.length>0&&(xe(o,l.size),s.count("import_failed_anomaly_detector_jobs",l.size))}),[]),je=Object(o.useCallback)((async e=>{const t=[],a=await Promise.all(e.map((async({id:e,...a})=>{try{return await i(e,a)}catch(e){t.push(e)}}))),n=Object.values(a).filter((e=>void 0!==e)).length;n>0&&pe(n),t.length>0&&(xe(t,t.length),s.count("import_failed_data_frame_analytics_jobs",t.length))}),[]),pe=Object(o.useCallback)((e=>{const t=r.i18n.translate("xpack.ml.importExport.importFlyout.importJobSuccessToast",{defaultMessage:"{count, plural, one {# job} other {# jobs}} successfully imported",values:{count:e}});le(t)}),[]),xe=Object(o.useCallback)(((e,t)=>{const a=r.i18n.translate("xpack.ml.importExport.importFlyout.importJobErrorToast",{defaultMessage:"{count, plural, one {# job} other {# jobs}} failed to import correctly",values:{count:t}}),s=e.map(M.c);oe(s,a)}),[]),ge=Object(o.useCallback)((e=>{if("anomaly-detector"===G){const t=[...g];t.splice(e,1),f(t)}else if("data-frame-analytics"===G){const t=[...O];t.splice(e,1),y(t)}const t=[...h];t.splice(e,1),S(t);const a=N(t,G);ee(a),ae(!0)}),[h,g,O]);Object(o.useEffect)((()=>{const e=0===h.length||!0===W||!0===te||h.some((({jobIdValid:e,destIndexValid:t})=>!1===e||!1===t));K(e),X(!0===W||!0===te)}),[h,Z,te,W]);const fe=Object(o.useCallback)(((e,t)=>{h[t].jobId=e,h[t].jobIdValid=!1,h[t].jobIdValidated=!1,S([...h]);const a=N(h,G);ee(a),ae(!0)}),[h]),Oe=Object(o.useCallback)(((e,t)=>{h[t].destIndex=e,h[t].destIndexValid=!1,h[t].destIndexValidated=!1,h[t].destIndexInvalidMessage="",S([...h]);const a=N(h,G);ee(a),ae(!0)}),[h]),ye=({index:e})=>Object(x.jsx)(d.EuiButtonIcon,{iconType:"trash","aria-label":r.i18n.translate("xpack.ml.importExport.importFlyout.deleteButtonAria",{defaultMessage:"Delete"}),color:Q?"text":"danger",disabled:Q,onClick:()=>ge(e)});return!1===ie&&!1===re?null:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(R,{onClick:function(){p(!j)},isDisabled:e}),!0===j&&!1===e&&Object(x.jsx)(d.EuiFlyout,{onClose:p.bind(null,!1),hideCloseButton:!0,size:"m","data-test-subj":"mlJobMgmtImportJobsFlyout"},Object(x.jsx)(d.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(d.EuiTitle,{size:"m"},Object(x.jsx)("h2",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.flyoutHeader",defaultMessage:"Import jobs"})))),Object(x.jsx)(d.EuiFlyoutBody,null,Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiText,{textAlign:"center"},Object(x.jsx)(d.EuiFilePicker,{disabled:W,fullWidth:!0,id:"filePicker",initialPromptText:r.i18n.translate("xpack.ml.importExport.importFlyout.fileSelect",{defaultMessage:"Select or drag and drop a file"}),onChange:ue,className:"file-datavisualizer-file-picker"})),se?Object(x.jsx)(v,null):null,H>0&&null!==G&&Object(x.jsx)("div",{"data-test-subj":"mlJobMgmtImportJobsFileRead"},Object(x.jsx)(d.EuiSpacer,{size:"l"}),"anomaly-detector"===G&&Object(x.jsx)("div",{"data-test-subj":"mlJobMgmtImportJobsADTitle"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.selectedFiles.ad",defaultMessage:"{num} anomaly detection {num, plural, one {job} other {jobs}} read from file",values:{num:H}})),"data-frame-analytics"===G&&Object(x.jsx)("div",{"data-test-subj":"mlJobMgmtImportJobsDFATitle"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.selectedFiles.dfa",defaultMessage:"{num} data frame analytics {num, plural, one {job} other {jobs}} read from file",values:{num:H}})),Object(x.jsx)(d.EuiSpacer,{size:"m"}),Object(x.jsx)(F,{jobs:C,autoExpand:0===h.length||1===C.length}),Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.importableFiles",defaultMessage:"Import {num, plural, one {# job} other {# jobs}}",values:{num:h.length}}),Object(x.jsx)(d.EuiSpacer,{size:"m"}),h.map(((e,t)=>Object(x.jsx)("div",{key:e.originalId},Object(x.jsx)(d.EuiPanel,{hasBorder:!0},Object(x.jsx)(d.EuiFlexGroup,null,Object(x.jsx)(d.EuiFlexItem,null,Object(x.jsx)(d.EuiFormRow,{error:e.jobIdInvalidMessage,isInvalid:!1===e.jobIdValid},Object(x.jsx)(d.EuiFieldText,{prepend:r.i18n.translate("xpack.ml.importExport.importFlyout.jobId",{defaultMessage:"Job ID"}),disabled:W,compressed:!0,value:e.jobId,onChange:e=>fe(e.target.value,t),isInvalid:!1===e.jobIdValid,"data-test-subj":"mlJobMgmtImportJobIdInput"})),"data-frame-analytics"===G&&Object(x.jsx)(d.EuiFormRow,{helpText:!0===e.destIndexValid?e.destIndexInvalidMessage:"",error:!1===e.destIndexValid?e.destIndexInvalidMessage:"",isInvalid:!1===e.destIndexValid},Object(x.jsx)(d.EuiFieldText,{prepend:r.i18n.translate("xpack.ml.importExport.importFlyout.destIndex",{defaultMessage:"Destination index"}),disabled:W,compressed:!0,value:e.destIndex,onChange:e=>Oe(e.target.value,t),isInvalid:!1===e.destIndexValid}))),Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(ye,{index:t})))),Object(x.jsx)(d.EuiSpacer,{size:"m"}))))))),Object(x.jsx)(d.EuiFlyoutFooter,null,Object(x.jsx)(d.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiButtonEmpty,{iconType:"cross",onClick:p.bind(null,!1),flush:"left"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.closeButton",defaultMessage:"Close"}))),Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiButton,{disabled:Y,onClick:be,fill:!0,"data-test-subj":"mlJobMgmtImportImportButton"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importFlyout.closeButton.importButton",defaultMessage:"Import"})))))))},R=({isDisabled:e,onClick:t})=>Object(x.jsx)(d.EuiButtonEmpty,{iconType:"importAction",onClick:t,isDisabled:e,"data-test-subj":"mlJobsImportButton"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.importButton",defaultMessage:"Import jobs"}));function N(e,t){return e.map((({jobId:e})=>e)).join("")+("data-frame-analytics"===t?e.map((({destIndex:e})=>e)).join(""):"")}const W=({jobs:e})=>{const[t,a,s]=function(e){return e.reduce(((e,t)=>{const a=t.calendarIds.length>0,s=t.filterIds.length>0;return(a||s)&&(e[0].push(t),a&&e[1].push(t),s&&e[2].push(t)),e}),[[],[],[]])}(e),n=a.length>0,o=s.length>0;return!1===n&&!1===o?null:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiCallOut,{title:$(t,a.length,s.length),color:"warning"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.calendarDependencies",defaultMessage:"When you export jobs, calendars and filter lists are not included. You must create the filter lists before you import jobs; otherwise, the import fails. If you want the new jobs to continue to ignore scheduled events, you must create the calendars."}),Object(x.jsx)(d.EuiSpacer,null),n&&Object(x.jsx)(d.EuiAccordion,{id:"advancedOptions",paddingSize:"s","aria-label":r.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingCalendarsAria",{defaultMessage:"Jobs using calendars"}),buttonContent:Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingCalendarsButton",defaultMessage:"Jobs using calendars"})},Object(x.jsx)(U,{jobs:a})),o&&Object(x.jsx)(d.EuiAccordion,{id:"advancedOptions",paddingSize:"s","aria-label":r.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingFiltersAria",{defaultMessage:"Jobs using filter lists"}),buttonContent:Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.jobUsingFiltersButton",defaultMessage:"Jobs using filter lists"})},Object(x.jsx)(G,{jobs:s}))),Object(x.jsx)(d.EuiSpacer,{size:"m"}))},U=({jobs:e})=>Object(x.jsx)(l.a.Fragment,null,e.length>0&&Object(x.jsx)(l.a.Fragment,null,e.map((({jobId:e,calendarIds:t})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiText,{size:"s"},Object(x.jsx)("h5",null,e),t.length>0&&Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.calendarList",defaultMessage:"{num, plural, one {calendar} other {calendars}}: {calendars}",values:{num:t.length,calendars:t.join(", ")}})),Object(x.jsx)(d.EuiSpacer,{size:"s"})))))),G=({jobs:e})=>Object(x.jsx)(l.a.Fragment,null,e.length>0&&Object(x.jsx)(l.a.Fragment,null,e.map((({jobId:e,filterIds:t})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiText,{size:"s"},Object(x.jsx)("h5",null,e),t.length>0&&Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.filterList",defaultMessage:"Filter {num, plural, one {list} other {lists}}: {filters}",values:{num:t.length,filters:t.join(", ")}})),Object(x.jsx)(d.EuiSpacer,{size:"s"}))))));function $(e,t,a){return t>0&&0===a?r.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.calendarOnlyTitle",{defaultMessage:"{jobCount, plural, one {# job uses} other {# jobs use}} {calendarCount, plural, one {a calendar} other {calendars}}",values:{jobCount:e.length,calendarCount:t}}):0===t&&a>0?r.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.filterOnlyTitle",{defaultMessage:"{jobCount, plural, one {# job uses} other {# jobs use}} {filterCount, plural, one {a filter list} other {filter lists}}",values:{jobCount:e.length,filterCount:a}}):r.i18n.translate("xpack.ml.importExport.exportFlyout.exportJobDependenciesWarningCallout.filterAndCalendarTitle",{defaultMessage:"{jobCount, plural, one {# job uses} other {# jobs use}} filter lists and calendars",values:{jobCount:e.length}})}var H=a(671),q=a(214);class jobs_export_service_JobsExportService{constructor(e){this._mlApiServices=e}async exportAnomalyDetectionJobs(e){const t=await Promise.all(e.map((e=>this._mlApiServices.jobs.jobForCloning(e,!0))));this._export(t,"anomaly-detector")}async exportDataframeAnalyticsJobs(e){const{data_frame_analytics:t}=await this._mlApiServices.dataFrameAnalytics.getDataFrameAnalytics(e.join(","),!0);this._export(t,"data-frame-analytics")}_export(e,t){const a=1===e.length?e[0]:e,s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),n=this._createFileName(t);Object(H.saveAs)(s,n)}_createFileName(e){return("anomaly-detector"===e?"anomaly_detection":"data_frame_analytics")+"_jobs.json"}async getJobDependencies(e){const t=await this._mlApiServices.calendars(),a=e.reduce(((e,t)=>(Array.isArray(t.groups)&&t.groups.forEach((a=>{void 0===e[a]&&(e[a]=[]),e[a].push(t.job_id)})),e)),{}),s=t.reduce(((t,s)=>(s.job_ids.forEach((n=>{n===q.a?e.forEach((e=>{void 0===t[e.job_id]&&(t[e.job_id]=[]),t[e.job_id].push(s.calendar_id)})):void 0!==a[n]?a[n].forEach((e=>{void 0===t[e]&&(t[e]=[]),t[e].push(s.calendar_id)})):(void 0===t[n]&&(t[n]=[]),t[n].push(s.calendar_id))})),t)),{}),n=e.reduce(((e,t)=>(void 0===e[t.job_id]&&(e[t.job_id]=[]),t.analysis_config.detectors.forEach((a=>{void 0!==a.custom_rules&&a.custom_rules.forEach((a=>{void 0!==a.scope&&Object.values(a.scope).forEach((a=>{e[t.job_id].push(a.filter_id)}))}))})),e)),{});return e.map((e=>{var t,a;const o=e.job_id;return{jobId:o,calendarIds:null!==(t=[...new Set(s[o])])&&void 0!==t?t:[],filterIds:null!==(a=[...new Set(n[o])])&&void 0!==a?a:[]}}))}}const Y=({isDisabled:e,currentTab:t})=>{const{services:{notifications:{toasts:a},mlServices:{mlUsageCollection:s,mlApiServices:n}}}=Object(I.d)(),{getJobs:i,dataFrameAnalytics:{getDataFrameAnalytics:u}}=n,b=Object(o.useMemo)((()=>new jobs_export_service_JobsExportService(n)),[n]),[j,p]=Object(o.useState)(!0),[g,f]=Object(o.useState)(!0),[O,y]=Object(o.useState)(!1),[h,E]=Object(o.useState)([]),[M,F]=Object(o.useState)([]),[S,v]=Object(o.useState)([]),[C,T]=Object(o.useState)(!1),[w,D]=Object(o.useState)(t),[J,_]=Object(o.useState)(!1),[A,B]=Object(o.useState)(t),{displayErrorToast:L,displaySuccessToast:z}=Object(o.useMemo)((()=>Object(k.b)(a)),[a]),{isADEnabled:V,isDFAEnabled:P}=Object(m.d)(),[R,N]=Object(o.useState)([]),[U,G]=Object(o.useState)([]),$=Object(o.useRef)(!0);function H(e,t){v(e?[...S,t]:S.filter((e=>e!==t)))}Object(o.useEffect)((()=>()=>{$.current=!1}),[]),Object(o.useEffect)((function(){p(!0),f(!0),E([]),v([]),T(!1),D(t),_(!1),O&&(V&&i().then((({jobs:e})=>{!1!==$.current&&(p(!1),E(e.map((e=>e.job_id))),b.getJobDependencies(e).then((e=>{!1!==$.current&&(N(e),p(!1))})).catch((e=>{if(!1===$.current)return;const t=r.i18n.translate("xpack.ml.importExport.exportFlyout.calendarsError",{defaultMessage:"Could not load calendars"});L(e,t)})))})).catch((e=>{if(!1===$.current)return;const t=r.i18n.translate("xpack.ml.importExport.exportFlyout.adJobsError",{defaultMessage:"Could not load anomaly detection jobs"});L(e,t)})),P&&u().then((({data_frame_analytics:e})=>{!1!==$.current&&(f(!1),F(e.map((e=>e.id))))})).catch((e=>{if(!1===$.current)return;const t=r.i18n.translate("xpack.ml.importExport.exportFlyout.dfaJobsError",{defaultMessage:"Could not load data frame analytics jobs"});L(e,t)})))}),[t,L,u,i,V,P,b,O]);const q=Object(o.useCallback)((e=>{if(e!==w)return S.length>0?(B(e),void _(!0)):void Y(e)}),[S,w]);function Y(e){_(!1),v([]),D(e)}function Z(){const e="anomaly-detector"===w?h:M;S.length===e.length?v([]):v([...e])}return Object(o.useEffect)((()=>{G(R.filter((({jobId:e})=>S.includes(e))))}),[R,S]),!1===V&&!1===P?null:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(K,{onClick:function(){y(!O)},isDisabled:e}),!0===O&&!1===e&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiFlyout,{onClose:()=>y(!1),hideCloseButton:!0,size:"s","data-test-subj":"mlJobMgmtExportJobsFlyout"},Object(x.jsx)(d.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(d.EuiTitle,{size:"m"},Object(x.jsx)("h2",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.flyoutHeader",defaultMessage:"Export jobs"})))),Object(x.jsx)(d.EuiFlyoutBody,null,Object(x.jsx)(W,{jobs:U}),Object(x.jsx)(d.EuiTabs,{size:"s"},!0===V?Object(x.jsx)(d.EuiTab,{isSelected:"anomaly-detector"===w,onClick:()=>q("anomaly-detector"),disabled:C,"data-test-subj":"mlJobMgmtExportJobsADTab"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.adTab",defaultMessage:"Anomaly detection"})):null,!0===P?Object(x.jsx)(d.EuiTab,{isSelected:"data-frame-analytics"===w,onClick:()=>q("data-frame-analytics"),disabled:C,"data-test-subj":"mlJobMgmtExportJobsDFATab"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.dfaTab",defaultMessage:"Analytics"})):null),Object(x.jsx)(d.EuiSpacer,{size:"s"}),Object(x.jsx)(l.a.Fragment,null,!0===V&&"anomaly-detector"===w&&Object(x.jsx)(l.a.Fragment,null,!0===j?Object(x.jsx)(Q,null):Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiButtonEmpty,{size:"xs",onClick:Z,isDisabled:e,"data-test-subj":"mlJobMgmtExportJobsSelectAllButton"},S.length===h.length?Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.adDeselectAllButton",defaultMessage:"Deselect all"}):Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.adSelectAllButton",defaultMessage:"Select all"})),Object(x.jsx)(d.EuiSpacer,{size:"xs"}),Object(x.jsx)("div",{"data-test-subj":"mlJobMgmtExportJobsADJobList"},h.map((e=>Object(x.jsx)("div",{key:e},Object(x.jsx)(d.EuiCheckbox,{id:e,label:e,checked:S.includes(e),onChange:t=>H(t.target.checked,e)}),Object(x.jsx)(d.EuiSpacer,{size:"s"}))))))),!0===P&&"data-frame-analytics"===w&&Object(x.jsx)(l.a.Fragment,null,!0===g?Object(x.jsx)(Q,null):Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiButtonEmpty,{size:"xs",onClick:Z,isDisabled:e,"data-test-subj":"mlJobMgmtExportJobsSelectAllButton"},S.length===M.length?Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.dfaDeselectAllButton",defaultMessage:"Deselect all"}):Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.dfaSelectAllButton",defaultMessage:"Select all"})),Object(x.jsx)(d.EuiSpacer,{size:"xs"}),Object(x.jsx)("div",{"data-test-subj":"mlJobMgmtExportJobsDFAJobList"},M.map((e=>Object(x.jsx)("div",{key:e},Object(x.jsx)(d.EuiCheckbox,{id:e,label:e,checked:S.includes(e),onChange:t=>H(t.target.checked,e)}),Object(x.jsx)(d.EuiSpacer,{size:"s"}))))))))),Object(x.jsx)(d.EuiFlyoutFooter,null,Object(x.jsx)(d.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiButtonEmpty,{iconType:"cross",onClick:y.bind(null,!1),flush:"left"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.closeButton",defaultMessage:"Close"}))),Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiButton,{disabled:0===S.length||!0===C,onClick:async function(){T(!0);const e=r.i18n.translate("xpack.ml.importExport.exportFlyout.exportDownloading",{defaultMessage:"Your file is downloading in the background"});z(e);try{"anomaly-detector"===w?await b.exportAnomalyDetectionJobs(S):await b.exportDataframeAnalyticsJobs(S),s.count("anomaly-detector"===w?"exported_anomaly_detector_jobs":"exported_data_frame_analytics_jobs",S.length),T(!1),y(!1)}catch(e){const t=r.i18n.translate("xpack.ml.importExport.exportFlyout.exportError",{defaultMessage:"Could not export selected jobs"});L(e,t),T(!1)}},fill:!0,"data-test-subj":"mlJobMgmtExportExportButton"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.exportButton",defaultMessage:"Export"})))))),!0===J?Object(x.jsx)(X,{onCancel:_.bind(null,!1),onConfirm:()=>Y(A)}):null))},K=({isDisabled:e,onClick:t})=>Object(x.jsx)(d.EuiButtonEmpty,{iconType:"exportAction",onClick:t,isDisabled:e,"data-test-subj":"mlJobsExportButton"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportButton",defaultMessage:"Export jobs"})),Q=()=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiSpacer,{size:"l"}),Object(x.jsx)(d.EuiFlexGroup,{justifyContent:"spaceAround"},Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(d.EuiLoadingSpinner,{size:"l"})))),X=({onCancel:e,onConfirm:t})=>Object(x.jsx)(d.EuiConfirmModal,{title:r.i18n.translate("xpack.ml.importExport.exportFlyout.switchTabsConfirm.title",{defaultMessage:"Change tabs?"}),onCancel:e,onConfirm:t,cancelButtonText:r.i18n.translate("xpack.ml.importExport.exportFlyout.switchTabsConfirm.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:r.i18n.translate("xpack.ml.importExport.exportFlyout.switchTabsConfirm.confirmButton",{defaultMessage:"Confirm"}),defaultFocusedButton:"confirm"},Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.importExport.exportFlyout.switchTabsConfirm.text",defaultMessage:"Changing tabs will clear currently selected jobs"})));var Z=a(280),ee=a(302),te=a(281);function ae(e){switch(e){case"anomaly-detector":return se;case"data-frame-analytics":return ne;case"trained-model":return oe;default:return[]}}const se=[{field:"id",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.ad.id",{defaultMessage:"ID"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnId",scope:"row",width:"250px",render:e=>Object(x.jsx)(ee.a,{id:e})},{field:"description",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.ad.description",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnDescription"},{field:"jobState",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.ad.jobState",{defaultMessage:"Job state"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnJobState",width:"100px"},{field:"datafeedState",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.ad.datafeedState",{defaultMessage:"Datafeed state"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnDatafeedState",width:"150px"}],ne=[{field:"id",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.dfa.id",{defaultMessage:"ID"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnId",scope:"row",width:"250px",render:e=>Object(x.jsx)(te.a,{jobId:e})},{field:"description",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.dfa.description",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnDescription"},{field:"source_index",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.dfa.source_index",{defaultMessage:"Source index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnSourceIndex",width:"200px"},{field:"dest_index",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.dfa.dest_index",{defaultMessage:"Destination index"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnDestIndex",width:"200px"},{field:"job_type",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.dfa.job_type",{defaultMessage:"Type"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnJobType",width:"150px"},{field:"state",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.dfa.state",{defaultMessage:"Status"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnState",width:"100px"}],oe=[{field:"id",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.id",{defaultMessage:"ID"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnId",scope:"row",width:"250px",render:e=>Object(x.jsx)(Z.c,{id:e})},{field:"description",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.description",{defaultMessage:"Description"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnDescription"},{field:"type",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.type",{defaultMessage:"Type"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnType",width:"250px"},{field:"state",name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.trainedModels.state",{defaultMessage:"State"}),sortable:!0,truncateText:!0,"data-test-subj":"mlSpaceManagementTableColumnState",width:"100px"}];var le=a(28);const ie=r.i18n.translate("xpack.ml.management.jobsSpacesList.jobObjectNoun",{defaultMessage:"job"}),re=r.i18n.translate("xpack.ml.management.jobsSpacesList.modelObjectNoun",{defaultMessage:"trained model"}),ce=({spacesApi:e,spaceIds:t,id:a,mlSavedObjectType:s,refresh:n})=>{const{savedObjects:{updateJobsSpaces:i,updateModelsSpaces:c}}=Object(I.c)(),{displayErrorToast:u}=Object(k.c)(),[b,m]=Object(o.useState)(!1);function j(){m(!1),n()}function p(e){Object.entries(e).forEach((([e,{success:t,error:a}])=>{if(!1===t){const t=r.i18n.translate("xpack.ml.management.jobsSpacesList.updateSpaces.error",{defaultMessage:"Error updating {id}",values:{id:e}});u(a,t)}}))}const g=Object(o.useCallback)(e.ui.components.getSpaceList,[e]),f=Object(o.useCallback)(e.ui.components.getShareToSpaceFlyout,[e]),O={savedObjectTarget:{type:le.a,id:a,namespaces:t,title:a,noun:"trained-model"===s?re:ie},behaviorContext:"outside-space",changeSpacesHandler:async function(e,t,n){const o=t.includes("*")?[]:n;(t.length||o.length)&&p("trained-model"===s?await c([a],t,o):await i(s,[a],t,o)),j()},onClose:j};return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiButtonEmpty,{onClick:()=>m(!0),style:{height:"auto"},"data-test-subj":"mlJobListRowManageSpacesButton"},Object(x.jsx)(g,{namespaces:t,displayLimit:0,behaviorContext:"outside-space"})),b&&Object(x.jsx)(f,O))};function de(e,t){return t.map((([t,a])=>{const s=[...new Set(e.map((e=>e[t])).flat())].sort(((e,t)=>e.localeCompare(t))).map((e=>({value:e,name:e})));return{type:"field_value_selection",multiSelect:"or",field:t,name:a,options:s}}))}const ue=({spacesApi:e,setCurrentTab:t})=>{const{getList:a}=function(){const{services:{mlServices:{httpService:e}}}=Object(I.d)();return Object(o.useMemo)((()=>function(e){return{getList:t=>e.http({path:`${j.d}/management/list/${t}`,method:"GET",version:"1"})}}(e)),[e])}(),[s,n]=Object(o.useState)(null),[i,c]=Object(o.useState)(),[u,b]=Object(o.useState)([]),[p,g]=Object(o.useState)(),[f,O]=Object(o.useState)(!1),{isADEnabled:y,isDFAEnabled:h,isNLPEnabled:E}=Object(m.d)(),{onTableChange:M,pagination:F,sorting:S,setPageIndex:v}=function(e,t,a="asc"){const[s,n]=Object(o.useState)(0),[l,i]=Object(o.useState)(10),[r,c]=Object(o.useState)(t),[d,u]=Object(o.useState)(a);return{onTableChange:({page:e={index:0,size:10},sort:t={field:r,direction:d}})=>{const{index:a,size:s}=e;n(a),i(s);const{field:o,direction:l}=t;c(o),u(l)},pagination:{pageIndex:s,pageSize:l,totalItemCount:(null!=e?e:[]).length,pageSizeOptions:[10,20,50],showPerPageOptions:!0},sorting:{sort:{field:r,direction:d}},setPageIndex:n}}(null!=i?i:[],"id"),k=Object(o.useRef)(!0);Object(o.useEffect)((()=>()=>{k.current=!1}),[]),Object(o.useEffect)((function(){!0===y?n("anomaly-detector"):!0===h?n("data-frame-analytics"):!0===E&&n("trained-model")}),[y,h,E]);const C=Object(o.useRef)(null),T=Object(o.useCallback)((e=>{null!==e&&(C.current=e,O(!0),a(e).then((t=>{k.current&&e===C.current&&(c(t),O(!1),g(function(e,t){switch(e){case"anomaly-detector":return de(t,[["jobState",r.i18n.translate("xpack.ml.management.spaceManagementFilters.ad.jobState",{defaultMessage:"Job state"})],["datafeedState",r.i18n.translate("xpack.ml.management.spaceManagementFilters.ad.datafeedState",{defaultMessage:"Datafeed state"})]]);case"data-frame-analytics":return de(t,[["job_type",r.i18n.translate("xpack.ml.management.spaceManagementFilters.dfa.job_type",{defaultMessage:"Type"})],["state",r.i18n.translate("xpack.ml.management.spaceManagementFilters.dfa.state",{defaultMessage:"Status"})]]);case"trained-model":return de(t,[["type",r.i18n.translate("xpack.ml.management.spaceManagementFilters.trainedModels.type",{defaultMessage:"Type"})]]);default:return}}(e,t)))})).catch((()=>{k.current&&(c([]),g(void 0),O(!1))})))}),[a,C]);Object(o.useEffect)((function(){c(void 0),null!==s&&(b(w()),t(s),T(s),v(0))}),[s]);const w=Object(o.useCallback)((()=>null===s?[]:[...ae(s),...void 0!==e?[{name:r.i18n.translate("xpack.ml.management.spaceManagementTableColumn.spaces",{defaultMessage:"spaces"}),"data-test-subj":"mlSpaceManagementTableColumnSpaces",sortable:!0,truncateText:!0,align:"right",width:"10%",render:t=>{var a;return Object(x.jsx)(ce,{spacesApi:e,spaceIds:null!==(a=t.spaces)&&void 0!==a?a:[],id:t.id,mlSavedObjectType:s,refresh:T.bind(null,s)})}}]:[]]),[s,e,T]),D=Object(o.useCallback)((()=>Object(x.jsx)(l.a.Fragment,null,f?Object(x.jsx)(d.EuiProgress,{size:"xs",color:"accent"}):null,Object(x.jsx)(d.EuiSpacer,{size:"m"}),void 0===i?null:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"none"},Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(be,{onRefreshClick:T.bind(null,s),isRefreshing:f}))),Object(x.jsx)(d.EuiInMemoryTable,{"data-test-subj":`mlSpacesManagementTable-${s} ${f?"loading":"loaded"}`,items:i,columns:u,search:{box:{incremental:!0},filters:p},onTableChange:M,pagination:F,sorting:S,rowProps:e=>({"data-test-subj":`mlSpacesManagementTable-${s} row-${e.id}`})})))),[i,u,f,p,s,T,M]),J=Object(o.useMemo)((()=>{const e=[];return!0===y&&e.push({"data-test-subj":"mlStackManagementAnomalyDetectionTab",id:"anomaly-detector",name:r.i18n.translate("xpack.ml.management.list.anomalyDetectionTab",{defaultMessage:"Anomaly detection"}),content:D()}),!0===h&&e.push({"data-test-subj":"mlStackManagementAnalyticsTab",id:"data-frame-analytics",name:r.i18n.translate("xpack.ml.management.list.analyticsTab",{defaultMessage:"Analytics"}),content:D()}),!0!==E&&!0!==h||e.push({"data-test-subj":"mlStackManagementTrainedModelsTab",id:"trained-model",name:r.i18n.translate("xpack.ml.management.list.trainedModelsTab",{defaultMessage:"Trained models"}),content:D()}),e}),[D,y,h,E]);return Object(x.jsx)(d.EuiTabbedContent,{"data-test-subj":"mlSpacesManagementTable",onTabClick:({id:e})=>{n(e)},size:"s",tabs:J,initialSelectedTab:J[0]})},be=({onRefreshClick:e,isRefreshing:t})=>Object(x.jsx)(d.EuiButtonEmpty,{"data-test-subj":"mlRefreshJobListButton"+(t?" loading":" loaded"),onClick:e,isLoading:t,iconType:"refresh",iconSide:"left",iconSize:"m"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.list.refreshButtonLabel",defaultMessage:"Refresh"})),me=({currentTabId:e})=>{const{services:{docLinks:{links:{ml:t}}}}=Object(I.d)();let a=t.anomalyDetectionJobs,s=r.i18n.translate("xpack.ml.management.jobsList.anomalyDetectionDocsLabel",{defaultMessage:"Anomaly detection jobs docs"});return"data-frame-analytics"===e?(a=t.dataFrameAnalytics,s=r.i18n.translate("xpack.ml.management.jobsList.analyticsDocsLabel",{defaultMessage:"Analytics jobs docs"})):"trained-model"===e&&(a=t.trainedModels,s=r.i18n.translate("xpack.ml.management.jobsList.trainedModelsDocsLabel",{defaultMessage:"Trained models docs"})),Object(x.jsx)(d.EuiButtonEmpty,{href:a,target:"_blank",iconType:"help","data-test-subj":"mlDocumentationLink"},s)},je=({children:e})=>Object(x.jsx)(l.a.Fragment,null,e),pe=({coreStart:e,share:t,history:a,spacesApi:s,data:n,usageCollection:h,fieldFormats:E,isServerless:M,mlFeatures:I})=>{const[F,S]=Object(o.useState)(!1),[v,k]=Object(o.useState)(!1),[C,T]=Object(o.useState)(!0),[w,D]=Object(o.useState)(!1),[J,_]=Object(o.useState)("anomaly-detector"),A=e.i18n.Context,B=e.theme.theme$,L=Object(o.useMemo)((()=>Object(y.getMlGlobalServices)(e.http,h)),[e.http,h]);Object(o.useEffect)((()=>{(async()=>{try{await Object(p.c)(L)}catch(e){e.mlFeatureEnabledInSpace&&!1===e.isPlatinumOrTrialLicense?T(!1):k(!0)}S(!0)})()}),[]);const z=Object(o.useCallback)(s?s.ui.components.getSpacesContextProvider:je,[s]);return!1===F?null:v?Object(x.jsx)(g,null):!1===C?Object(x.jsx)(f,{basePath:e.http.basePath}):Object(x.jsx)(b.a,{coreStart:{application:e.application}},Object(x.jsx)(A,null,Object(x.jsx)(u.KibanaThemeProvider,{theme$:B},Object(x.jsx)(u.KibanaContextProvider,{services:{...e,share:t,data:n,usageCollection:h,fieldFormats:E,spacesApi:s,mlServices:L}},Object(x.jsx)(z,{feature:j.g},Object(x.jsx)(m.b,{isServerless:M,mlFeatures:I},Object(x.jsx)(i.b,{history:a},Object(x.jsx)(d.EuiPageTemplate.Header,{pageTitle:Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.jobsListTitle",defaultMessage:"Machine Learning"}),description:Object(x.jsx)(c.FormattedMessage,{id:"xpack.ml.management.jobsList.jobsListTagline",defaultMessage:"Identify, analyze, and process your data using advanced analysis techniques."}),rightSideItems:[Object(x.jsx)(me,{currentTabId:J})],bottomBorder:!0,paddingSize:"none"}),Object(x.jsx)(d.EuiSpacer,{size:"l"}),Object(x.jsx)(d.EuiPageTemplate.Section,{paddingSize:"none",id:"kibanaManagementMLSection","data-test-subj":"mlPageStackManagementJobsList"},Object(x.jsx)(d.EuiFlexGroup,null,Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.EuiButtonEmpty,{onClick:()=>D(!0),"data-test-subj":"mlStackMgmtSyncButton"},r.i18n.translate("xpack.ml.management.jobsList.syncFlyoutButton",{defaultMessage:"Synchronize saved objects"})),w&&Object(x.jsx)(O.a,{onClose:function(){D(!1)}}),Object(x.jsx)(d.EuiSpacer,{size:"s"}))),Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(Y,{isDisabled:!1,currentTab:"trained-model"===J?"anomaly-detector":J})),Object(x.jsx)(d.EuiFlexItem,{grow:!1},Object(x.jsx)(P,{isDisabled:!1}))),Object(x.jsx)(ue,{spacesApi:s,setCurrentTab:_})))))))))},xe="/management/ml/jobs_list",ge=(e,t,a,o,i,r,c,d,u,b)=>(n.a.render(l.a.createElement(pe,{coreStart:a,history:t,share:o,data:i,spacesApi:u,usageCollection:b,fieldFormats:r,isServerless:c,mlFeatures:d}),e),()=>{Object(s.unmountComponentAtNode)(e)});async function fe(e,t,a,s,n){const[o,l]=await e.getStartServices();return t.setBreadcrumbs([{text:r.i18n.translate("xpack.ml.management.breadcrumb",{defaultMessage:"Machine Learning"}),href:`#${xe}`}]),ge(t.element,t.history,o,l.share,l.data,l.fieldFormats,s,n,l.spaces,a.usageCollection)}},671:function(e,t,a){var s,n=n||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,a=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in s,o=e.webkitRequestFileSystem,l=e.requestFileSystem||o||e.mozRequestFileSystem,i=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},r="application/octet-stream",c=0,d=function(t){var s=function(){"string"==typeof t?a().revokeObjectURL(t):t.remove()};e.chrome?s():setTimeout(s,500)},u=function(e,t,a){for(var s=(t=[].concat(t)).length;s--;){var n=e["on"+t[s]];if("function"==typeof n)try{n.call(e,a||e)}catch(e){i(e)}}},b=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},m=function(t,i,m){m||(t=b(t));var j,p,x,g=this,f=t.type,O=!1,y=function(){u(g,"writestart progress write writeend".split(" "))},h=function(){!O&&j||(j=a().createObjectURL(t)),p?p.location.href=j:null==e.open(j,"_blank")&&"undefined"!=typeof safari&&(e.location.href=j),g.readyState=g.DONE,y(),d(j)},E=function(e){return function(){if(g.readyState!==g.DONE)return e.apply(this,arguments)}},M={create:!0,exclusive:!1};if(g.readyState=g.INIT,i||(i="download"),n)return j=a().createObjectURL(t),s.href=j,s.download=i,void setTimeout((function(){var e,t;e=s,t=new MouseEvent("click"),e.dispatchEvent(t),y(),d(j),g.readyState=g.DONE}));e.chrome&&f&&f!==r&&(x=t.slice||t.webkitSlice,t=x.call(t,0,t.size,r),O=!0),o&&"download"!==i&&(i+=".download"),(f===r||o)&&(p=e),l?(c+=t.size,l(e.TEMPORARY,c,E((function(e){e.root.getDirectory("saved",M,E((function(e){var a=function(){e.getFile(i,M,E((function(e){e.createWriter(E((function(a){a.onwriteend=function(t){p.location.href=e.toURL(),g.readyState=g.DONE,u(g,"writeend",t),d(e)},a.onerror=function(){var e=a.error;e.code!==e.ABORT_ERR&&h()},"writestart progress write abort".split(" ").forEach((function(e){a["on"+e]=g["on"+e]})),a.write(t),g.abort=function(){a.abort(),g.readyState=g.DONE},g.readyState=g.WRITING})),h)})),h)};e.getFile(i,{create:!1},E((function(e){e.remove(),a()})),E((function(e){e.code===e.NOT_FOUND_ERR?a():h()})))})),h)})),h)):h()},j=m.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,a){return a||(e=b(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(j.abort=function(){var e=this;e.readyState=e.DONE,u(e,"abort")},j.readyState=j.INIT=0,j.WRITING=1,j.DONE=2,j.error=j.onwritestart=j.onprogress=j.onwrite=j.onabort=j.onerror=j.onwriteend=null,function(e,t,a){return new m(e,t,a)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */e.exports?e.exports.saveAs=n:null!==a(672)&&null!=a(673)&&(void 0===(s=function(){return n}.apply(t,[]))||(e.exports=s))},672:function(e,t,a){e.exports=a(57)(1808)},673:function(e,t){(function(t){e.exports=t}).call(this,{})}}]);