/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[19],{157:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var s=a(23);const l=()=>Object(s.useKibana)()},201:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a(2);var s=a(12),l=a(10),n=a(23),i=a(136),o=a(177),r=a(6);function c(e,t,a,c,b,u){const{http:d,theme:j,i18n:m,overlays:x,application:{currentAppId$:O}}=t;return new Promise((async(g,p)=>{try{const p=()=>{E.close(),g()},E=x.openFlyout(Object(i.a)(Object(r.jsx)(n.KibanaContextProvider,{services:{...t,share:a,data:c,lens:u,dashboardService:b,mlServices:Object(o.getMlGlobalServices)(d)}},Object(r.jsx)(e,{onClose:()=>{p(),g()}})),{theme:j,i18n:m}),{"data-test-subj":"mlFlyoutLayerSelector",ownFocus:!0,onClose:p,size:"35vw"});O.pipe(Object(s.skip)(1),Object(s.takeUntil)(Object(l.from)(E.onClose)),Object(s.distinctUntilChanged)()).subscribe((()=>{E.close()}))}catch(e){p(e)}}))}},202:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var s,l=a(2),n=a.n(l),i=a(155),o=a.n(i),r=a(29),c=a(3),b=a(15),u=a(107),d=a(106),j=a(111),m=a(44),x=a(149),O=a(1),g=a(157),p=a(6);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.VALIDATING=1]="VALIDATING",e[e.SAVING=2]="SAVING",e[e.SAVE_SUCCESS=3]="SAVE_SUCCESS",e[e.SAVE_FAILED=4]="SAVE_FAILED"}(s||(s={}));const E=({children:e,createADJobInWizard:t,createADJob:a,layer:i,layerIndex:u,embeddable:E,timeRange:f,incomingCreateError:F,outerFormComplete:y})=>{var C;const{services:{share:h,application:A,mlServices:{mlApiServices:w}}}=Object(g.a)(),[k,M]=Object(l.useState)(""),[I,v]=Object(l.useState)(!0),[L,_]=Object(l.useState)(!0),[T,J]=Object(l.useState)(d.b),[z,R]=Object(l.useState)(""),[D,P]=Object(l.useState)(""),[V,N]=Object(l.useState)(s.DEFAULT),[B,G]=Object(l.useState)(null),U=null!==(C=null==i?void 0:i.jobType)&&void 0!==C?C:d.f.GEO,$=Object(l.useCallback)((async e=>{const t=h.url.locators.get(O.a);if(t){const a=I?e===d.f.MULTI_METRIC||e===d.f.GEO?O.b.ANOMALY_EXPLORER:O.b.SINGLE_METRIC_VIEWER:O.b.ANOMALY_DETECTION_JOBS_MANAGE,s=I?{jobIds:[k],timeRange:f}:{jobId:k},l=await t.getUrl({page:a,pageState:s});A.navigateToUrl(l)}}),[h,I,k,f,A]);return o()((function(){if(void 0===k||""===k)return;R(""),P("");const e=Object(j.e)({job_id:k,analysis_config:{detectors:[],bucket_span:T}},void 0,{max_model_memory_limit:"",effective_max_model_memory_limit:""},!0);e.contains("job_id_invalid")?R(c.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})):e.contains("job_id_invalid_max_length")?R(c.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:m.b}})):w.jobs.jobsExist([k]).then((e=>{e[k].exists&&R(c.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."}))})).catch((e=>{console.error("Could not validate whether job ID exists")})),e.contains("bucket_span_invalid")&&P(Object(x.a)(T)),N(s.DEFAULT)}),500,[k,T]),Object(p.jsx)(n.a.Fragment,null,V!==s.SAVE_SUCCESS&&V!==s.SAVING||F?Object(p.jsx)(n.a.Fragment,null,null!=e?e:null,Object(p.jsx)(r.EuiSpacer,{size:"m"}),Object(p.jsx)(r.EuiForm,null,Object(p.jsx)(r.EuiFormRow,{label:c.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.title",{defaultMessage:"Job ID"}),error:z,isInvalid:""!==z},Object(p.jsx)(r.EuiFieldText,{"data-test-subj":`mlLensLayerJobIdInput_${u}`,value:k,onChange:e=>{M(e.target.value),N(s.VALIDATING)}})),Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiAccordion,{"data-test-subj":`mlLensLayerAdditionalSettingsButton_${u}`,id:"additional-section",buttonContent:c.i18n.translate("xpack.ml.embeddables.lensLayerFlyout.createJobCallout.additionalSettings.title",{defaultMessage:"Additional settings"})},Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiFormRow,{label:c.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.placeholder",{defaultMessage:"Bucket span"}),error:D,isInvalid:""!==D},Object(p.jsx)(r.EuiFieldText,{"data-test-subj":`mlLensLayerBucketSpanInput_${u}`,value:T,onChange:e=>{J(e.target.value),N(s.VALIDATING)}})),Object(p.jsx)(r.EuiSpacer,{size:"l"}),Object(p.jsx)(r.EuiFormRow,null,Object(p.jsx)(r.EuiCheckbox,{id:"startJob","data-test-subj":`mlLensLayerStartJobCheckbox_${u}`,checked:I,onChange:e=>{return t=e.target.checked,v(t),void _(t&&L);var t},label:c.i18n.translate("xpack.ml.embeddables.lensLayerFlyout.createJobCallout.additionalSettings.start",{defaultMessage:"Start the job after saving"})})),Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiFormRow,null,Object(p.jsx)(r.EuiCheckbox,{id:"realTime",disabled:!1===I,"data-test-subj":`mlLensLayerRealTimeCheckbox_${u}`,checked:L,onChange:e=>_(e.target.checked),label:c.i18n.translate("xpack.ml.embeddables.lensLayerFlyout.createJobCallout.additionalSettings.realTime",{defaultMessage:"Leave the job running for new data"})})),Object(p.jsx)(r.EuiSpacer,{size:"m"}))),Object(p.jsx)(r.EuiSpacer,{size:"m"}),Object(p.jsx)(r.EuiFlexGroup,null,Object(p.jsx)(r.EuiFlexItem,null,Object(p.jsx)(r.EuiButton,{disabled:V===s.VALIDATING||""===k||""!==z||""!==D||!1===y,onClick:async function(){if(void 0===k||""===k)return;N(s.SAVING),G(null);const e=await a({jobId:k,bucketSpan:T,embeddable:E,startJob:I,runInRealTime:L}),t=S(e);null===t?N(s.SAVE_SUCCESS):(N(s.SAVE_FAILED),G(t))}.bind(null,u),size:"s","data-test-subj":`mlLensLayerCreateJobButton_${u}`},Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.createJobButton.saving",defaultMessage:"Create job"}))),Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiButtonEmpty,{onClick:t.bind(null,u),size:"s",iconType:"popout",iconSide:"right","data-test-subj":`mlLensLayerCreateWithWizardButton_${u}`},Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.createJobButton",defaultMessage:"Create job using wizard"}))))):null,V===s.SAVE_SUCCESS?Object(p.jsx)(n.a.Fragment,null,Object(p.jsx)(r.EuiFlexGroup,{gutterSize:"s","data-test-subj":`mlLensLayerCompatible.jobCreated.success_${u}`},Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiText,{size:"s"},Object(p.jsx)(r.EuiIcon,{type:"checkInCircleFilled",color:"success"}))),Object(p.jsx)(r.EuiFlexItem,null,Object(p.jsx)(r.EuiText,{size:"s"},Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyout.flyoutAdditionalSettings.saveSuccess",defaultMessage:"Job created"})))),Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiButtonEmpty,{onClick:$.bind(null,U),flush:"left","data-test-subj":`mlLensLayerResultsButton_${u}`},!1===I?Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.saveSuccess.resultsLink.jobList",defaultMessage:"View in job management page"}):U===d.f.MULTI_METRIC||U===d.f.GEO?Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.saveSuccess.resultsLink.multiMetric",defaultMessage:"View results in Anomaly Explorer"}):Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.saveSuccess.resultsLink.singleMetric",defaultMessage:"View results in Single Metric Viewer"}))):null,V===s.SAVING&&void 0===F?Object(p.jsx)(n.a.Fragment,null,Object(p.jsx)(r.EuiFlexGroup,null,Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.creatingJob",defaultMessage:"Creating job"})),Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiLoadingSpinner,null)))):null,V===s.SAVE_FAILED&&null!==B?Object(p.jsx)(n.a.Fragment,null,Object(p.jsx)(r.EuiSpacer,null),Object(p.jsx)(r.EuiCallOut,{color:"danger",title:B.text},B.errorText)):null,F?Object(p.jsx)(n.a.Fragment,null,Object(p.jsx)(r.EuiSpacer,null),Object(p.jsx)(r.EuiCallOut,{color:"danger",title:F.text},F.errorText)):null)},S=e=>e.jobCreated.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.jobCreated",{defaultMessage:"Job could not be created."}),errorText:Object(u.b)(e.jobCreated.error)}:e.datafeedCreated.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.datafeedCreated",{defaultMessage:"Job created but datafeed could not be created."}),errorText:Object(u.b)(e.datafeedCreated.error)}:e.jobOpened.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.jobOpened",{defaultMessage:"Job and datafeed created but the job could not be opened."}),errorText:Object(u.b)(e.jobOpened.error)}:e.datafeedStarted.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.datafeedStarted",{defaultMessage:"Job and datafeed created but the datafeed could not be started."}),errorText:Object(u.b)(e.datafeedStarted.error)}:null},697:function(e,t,a){"use strict";a.r(t),a.d(t,"showPatternAnalysisToADJobFlyout",(function(){return p}));var s=a(2),l=a.n(s),n=a(201),i=a(15),o=a(29),r=a(1),c=a(16),b=a(116),u=a(122),d=a(373),j=a(157),m=a(202),x=a(6);const O=({dataView:e,field:t,query:a,timeRange:n})=>{const{services:{data:O,share:g,uiSettings:p,mlServices:{mlApiServices:E},dashboardService:S}}=Object(j.a)(),[f,F]=Object(s.useState)(d.a.COUNT),[y,C]=Object(s.useState)(!1),[h,A]=Object(s.useState)(!1),[w,k]=Object(s.useState)([]),[M,I]=Object(s.useState)([]),[v,L]=Object(s.useState)(void 0),_=Object(s.useCallback)((()=>C(!y)),[y]),T=Object(s.useCallback)((()=>A(!h)),[h]);Object(s.useMemo)((()=>{const t=new u.a(E);t.initializeFromDataVIew(e).then((()=>{const e=[...Object(b.g)(t.categoryFields,[])].map((e=>({...e})));k(e)}))}),[e,E]);const J=Object(s.useMemo)((()=>new d.b(p,O.query.timefilter.timefilter,S,O,E)),[S,O,E,p]);return Object(s.useEffect)((()=>{I([]),A(!1)}),[y]),Object(s.useEffect)((()=>{L(!1===y||M.length>0)}),[y,M]),Object(x.jsx)(m.a,{createADJob:async function({jobId:s,bucketSpan:l,startJob:i,runInRealTime:o}){var r;const c=M.length&&null!==(r=e.getFieldByName(M[0].label))&&void 0!==r?r:null;return await J.createAndSaveJob(f,s,l,e,t,c,h,a,n,i,o)},createADJobInWizard:function(){var s;const l=M.length&&null!==(s=e.getFieldByName(M[0].label))&&void 0!==s?s:null;!async function(e,t,a,s,l,n,i,o){const b=o.url.locators.get(r.a),u=await b.getUrl({page:c.a.ANOMALY_DETECTION_CREATE_JOB_FROM_PATTERN_ANALYSIS,pageState:{categorizationType:e,dataViewId:t.id,field:a.name,partitionField:(null==s?void 0:s.name)||null,stopOnWarn:l,from:i.from,to:i.to,query:JSON.stringify(n)}});window.open(u,"_blank")}(f,e,t,l,h,a,n,g)},embeddable:void 0,timeRange:n,layer:void 0,layerIndex:0,outerFormComplete:v},Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(o.EuiCheckableCard,{id:"count",label:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(o.EuiTitle,{size:"xs"},Object(x.jsx)("h5",null,Object(x.jsx)(i.FormattedMessage,{defaultMessage:"Count",id:"xpack.ml.newJobFromPatternAnalysisFlyout.count.title"}))),Object(x.jsx)(o.EuiSpacer,{size:"s"}),Object(x.jsx)(i.FormattedMessage,{defaultMessage:"Look for anomalies in the event rate of a category.",id:"xpack.ml.newJobFromPatternAnalysisFlyout.count.description"})),checked:f===d.a.COUNT,onChange:()=>F(d.a.COUNT)}),Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiCheckableCard,{id:"rare",label:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(o.EuiTitle,{size:"xs"},Object(x.jsx)("h5",null,Object(x.jsx)(i.FormattedMessage,{defaultMessage:"Rare",id:"xpack.ml.newJobFromPatternAnalysisFlyout.rare.title"}))),Object(x.jsx)(o.EuiSpacer,{size:"s"}),Object(x.jsx)(i.FormattedMessage,{defaultMessage:"Look for categories that occur rarely in time.",id:"xpack.ml.newJobFromPatternAnalysisFlyout.rare.description"})),checked:f===d.a.RARE,onChange:()=>F(d.a.RARE)}),Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiSwitch,{name:"categorizationPerPartitionSwitch",disabled:!1,checked:y,onChange:_,"data-test-subj":"mlNewJobFromPatternAnalysisFlyoutSwitchCategorizationPerPartition",label:Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.newJobFromPatternAnalysisFlyout.perPartitionCategorizationSwitchLabel",defaultMessage:"Enable per-partition categorization"})}),y?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiCallOut,{size:"s",title:Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.newJobFromPatternAnalysisFlyout.categorizationPerPartitionField.infoCallout",defaultMessage:"Determine categories independently for each value of the partition field."})}),Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiFormRow,{label:Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.newJobFromPatternAnalysisFlyout.categorizationPerPartitionFieldLabel",defaultMessage:"Partition field"})},Object(x.jsx)(o.EuiComboBox,{singleSelection:{asPlainText:!0},options:w,selectedOptions:M,onChange:I,isClearable:!0})),Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiSwitch,{name:"categorizationPerPartitionSwitch",disabled:!1,checked:h,onChange:T,label:Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.newJobFromPatternAnalysisFlyout.stopOnWarnSwitchLabel",defaultMessage:"Stop on warn"})})):null,Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiHorizontalRule,{margin:"m"})))},g=({onClose:e,dataView:t,field:a,query:s,timeRange:n})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(x.jsx)(o.EuiTitle,{size:"s"},Object(x.jsx)("h3",null,Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.embeddables.newJobFromPatternAnalysisFlyout.title",defaultMessage:"Create anomaly detection job"}))),Object(x.jsx)(o.EuiSpacer,{size:"m"}),Object(x.jsx)(o.EuiText,{size:"s"},Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.embeddables.newJobFromPatternAnalysisFlyout.secondTitle",defaultMessage:"Create a categorization job for {field}",values:{field:a.name}}))),Object(x.jsx)(o.EuiFlyoutBody,null,Object(x.jsx)(O,{dataView:t,field:a,query:s,timeRange:n})),Object(x.jsx)(o.EuiFlyoutFooter,null,Object(x.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(o.EuiFlexItem,{grow:!1},Object(x.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:e,flush:"left"},Object(x.jsx)(i.FormattedMessage,{id:"xpack.ml.embeddables.newJobFromPatternAnalysisFlyout.closeButton",defaultMessage:"Close"}))))));async function p(e,t,a,s,l,i,o,r,c){return Object(n.a)((({onClose:l})=>Object(x.jsx)(g,{dataView:e,field:t,query:a,timeRange:s,onClose:l})),l,i,o,r,c)}}}]);