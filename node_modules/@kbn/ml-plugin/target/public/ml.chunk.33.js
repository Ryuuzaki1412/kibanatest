/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[33],{692:function(e,t,a){"use strict";a.r(t),a.d(t,"overviewPanelDefaultState",(function(){return se})),a.d(t,"OverviewPage",(function(){return oe}));var s=a(2),o=a.n(s),n=a(15),i=a(29),l=a(3),c=a(113),r=a(153),d=a(200),b=a(1),u=a(146),m=a(199),j=a(108),p=a(34),v=a(7),g=a(9),O=a(115);function x(){const e=Object(g.g)(),t=Object(c.i)(),a=Object(g.h)();return[{isPrimary:!0,name:l.i18n.translate("xpack.ml.overview.anomalyDetection.viewJobsActionName",{defaultMessage:"View jobs"}),description:l.i18n.translate("xpack.ml.overview.anomalyDetection.resultActions.openInJobManagementText",{defaultMessage:"View jobs"}),icon:"list",type:"icon",onClick:async t=>{const s=await(null==e?void 0:e.getUrl({page:b.b.ANOMALY_DETECTION_JOBS_MANAGE,pageState:{groupIds:[t.id]}}));await a(s)}},{isPrimary:!1,name:l.i18n.translate("xpack.ml.overview.anomalyDetection.viewResultsActionName",{defaultMessage:"View in Anomaly Explorer"}),description:l.i18n.translate("xpack.ml.overview.anomalyDetection.resultActions.openJobsInAnomalyExplorerText",{defaultMessage:"View in Anomaly Explorer"}),icon:"visTable",type:"icon",onClick:async s=>{const o=await(null==e?void 0:e.getUrl({page:b.b.ANOMALY_EXPLORER,pageState:{jobIds:s.jobIds,timeRange:t.getTime()}}));await a(o)}}]}var w=a(234),f=a(120),y=a(181),S=a(213),T=a(6);let h;!function(e){e.id="id",e.maxAnomalyScore="max_anomaly_score",e.overallSwimLane="overallSwimLane",e.jobIds="jobIds",e.latestTimestamp="latest_timestamp",e.docsProcessed="docs_processed",e.jobsInGroup="jobs_in_group"}(h||(h={}));const A=({items:e,chartsService:t})=>{const a=Object.values(e),[o,c]=Object(s.useState)(0),[r,d]=Object(s.useState)(10),[b,u]=Object(s.useState)(h.id),[m,j]=Object(s.useState)("asc"),p=Object(S.a)(),v=[{field:h.id,name:l.i18n.translate("xpack.ml.overview.anomalyDetection.tableId",{defaultMessage:"Group ID"}),render:e=>Object(T.jsx)(w.a,{id:e,isGroup:"ungrouped"!==e}),sortable:!0,truncateText:!0,width:"15%"},{name:Object(T.jsx)(i.EuiToolTip,{content:l.i18n.translate("xpack.ml.overview.anomalyDetection.tableOverallScoreTooltip",{defaultMessage:"Overall anomaly scores within selected time range"})},Object(T.jsx)("span",null,l.i18n.translate("xpack.ml.overview.anomalyDetection.overallScore",{defaultMessage:"Overall score"}),Object(T.jsx)(i.EuiIcon,{size:"s",color:"subdued",type:"questionInCircle",className:"eui-alignTop"}))),render:e=>{const a=e.overallSwimLane;return a?a.points.length>0&&a.points.every((e=>0===e.value))?Object(T.jsx)(n.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.noAnomaliesFoundMessage",defaultMessage:"No anomalies found"}):Object(T.jsx)(y.c,{timeBuckets:p,swimlaneData:e.overallSwimLane,swimlaneType:"overall",onResize:()=>{},isLoading:!1,id:e.id,showTimeline:!1,showYAxis:!1,showLegend:!1,noDataWarning:Object(T.jsx)(n.FormattedMessage,{id:"xpack.ml.overview.anomalyDetection.noResultsFoundMessage",defaultMessage:"No results found"}),chartsService:t}):null},width:"300px"},{field:h.jobsInGroup,name:l.i18n.translate("xpack.ml.overview.anomalyDetection.tableNumJobs",{defaultMessage:"Jobs in group"}),sortable:!0,truncateText:!0,width:"10%"},{field:h.latestTimestamp,name:l.i18n.translate("xpack.ml.overview.anomalyDetection.tableLatestTimestamp",{defaultMessage:"Latest timestamp"}),dataType:"date",render:e=>Object(O.c)(e),textOnly:!0,truncateText:!0,sortable:!0,width:"25%"},{field:h.docsProcessed,name:l.i18n.translate("xpack.ml.overview.anomalyDetection.tableDocsProcessed",{defaultMessage:"Docs processed"}),render:e=>Object(f.i)(e),textOnly:!0,sortable:!0,width:"15%"},{name:l.i18n.translate("xpack.ml.overview.anomalyDetection.tableActionLabel",{defaultMessage:"Actions"}),actions:x(),width:"80px",align:"right"}],g={initialPageIndex:o,initialPageSize:r,totalItemCount:a.length,pageSizeOptions:[10,20,50],showPerPageOptions:!0},A={sort:{field:b,direction:m}};return Object(T.jsx)(i.EuiInMemoryTable,{allowNeutralSort:!1,className:"mlAnomalyDetectionTable",columns:v,hasActions:!0,isExpandable:!1,isSelectable:!1,items:a,itemId:h.id,onTableChange:({page:e={index:0,size:10},sort:t={field:h.id,direction:"asc"}})=>{const{index:a,size:s}=e;c(a),d(s);const{field:o,direction:n}=t;u(o),j(n)},pagination:g,sorting:A,"data-test-subj":"mlOverviewTableAnomalyDetection"})};var M=a(11),L=a(32),_=a(150),k=a(104),E=a(291),D=a(105);const J=({anomalyTimelineService:e,setLazyJobCount:t})=>{const{services:{charts:a}}=Object(g.d)(),{displayErrorToast:o}=Object(k.c)(),{showNodeInfo:c}=Object(D.d)(),j=Object(_.a)(),[p,O]=Object(r.b)(u.g,se),x=Object(g.f)({page:b.b.ANOMALY_DETECTION_JOBS_MANAGE}),[w,f]=Object(s.useState)(!1),[y,S]=Object(s.useState)({}),[h,J]=Object(s.useState)(0),[N,I]=Object(s.useState)(),[C,P]=Object(s.useState)(),[z,B]=Object(s.useState)(),F=async t=>{try{const a=Object.fromEntries(Object.entries(t).filter((([e,t])=>t.jobs.length>0)).map((([t,a])=>[t,e.loadOverallData(a.jobs,300)]))),s=Object(v.zipObject)(Object.keys(a),await Promise.all(Object.values(a))),o={...t};for(const e in o)o.hasOwnProperty(e)&&(o[e].overallSwimLane=s[e]);S(o)}catch(e){o(e,l.i18n.translate("xpack.ml.overview.anomalyDetection.errorWithFetchingSwimLanesData",{defaultMessage:"An error occurred fetching anomaly results"}))}};Object(s.useEffect)((()=>{(async()=>{f(!0);let e=0;try{const a=(await M.ml.jobs.jobsSummary([])).map((t=>(t.latestTimestampSortValue=t.latestTimestampMs||0,t.awaitingNodeAssignment&&e++,t))),{groups:s,count:o}=function(e){const t={ungrouped:{id:"ungrouped",jobs:[],jobIds:[],docs_processed:0,latest_timestamp:0,max_anomaly_score:null,jobs_in_group:0}};e.forEach((e=>{e.groups.length>0?e.groups.forEach((a=>{void 0===t[a]?t[a]={id:a,jobs:[e],jobIds:[e.id],docs_processed:e.processed_record_count,latest_timestamp:e.latestTimestampMs,max_anomaly_score:null,jobs_in_group:1}:(t[a].jobs.push(e),t[a].jobIds.push(e.id),t[a].docs_processed+=e.processed_record_count,t[a].jobs_in_group++,(void 0===t[a].latest_timestamp||e.latestTimestampMs&&e.latestTimestampMs>t[a].latest_timestamp)&&(t[a].latest_timestamp=e.latestTimestampMs))})):(t.ungrouped.jobs.push(e),t.ungrouped.jobIds.push(e.id),t.ungrouped.docs_processed+=e.processed_record_count,t.ungrouped.jobs_in_group++,e.latestTimestampMs&&e.latestTimestampMs>t.ungrouped.latest_timestamp&&(t.ungrouped.latest_timestamp=e.latestTimestampMs))})),0===t.ungrouped.jobIds.length&&delete t.ungrouped;const a=Object.values(t).length;return{groups:t,count:a}}(a),n=function(e,t){const a={total:{label:l.i18n.translate("xpack.ml.overviewJobsList.statsBar.totalJobsLabel",{defaultMessage:"Total"}),value:0,show:!0,group:0},open:{label:l.i18n.translate("xpack.ml.overviewJobsList.statsBar.openJobsLabel",{defaultMessage:"Open"}),value:0,show:!0,group:0},closed:{label:l.i18n.translate("xpack.ml.overviewJobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed"}),value:0,show:!0,group:0},failed:{label:l.i18n.translate("xpack.ml.overviewJobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed"}),value:0,show:!1,group:0},...t?{activeNodes:{label:l.i18n.translate("xpack.ml.overviewJobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML nodes"}),value:0,show:!0,group:1}}:{},activeDatafeeds:{label:l.i18n.translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:!0,group:1}};if(void 0===e)return a;const s={};let o=0;if(e.forEach((e=>{e.jobState===L.c.OPENED?a.open.value++:e.jobState===L.c.CLOSED?a.closed.value++:e.jobState===L.c.FAILED&&o++,e.hasDatafeed&&e.datafeedState===L.a.STARTED&&a.activeDatafeeds.value++,void 0!==e.nodeName&&(s[e.nodeName]={})})),a.total.value=e.length,o?(a.failed.value=o,a.failed.show=!0):a.failed.show=!1,t&&(a.activeNodes.value=Object.keys(s).length),0===a.total.value)for(const[e,t]of Object.entries(a))"total"!==e&&(t.show=!1);return a}(a,c),i=Object(v.groupBy)(Object.entries(n).filter((([e,t])=>t.show)).map((([e,t])=>t)),"group");f(!1),B(void 0),I(i[0]),P(i[1]),J(o),S(s),F(s),t(e)}catch(e){B(void 0!==e.message?e.message:JSON.stringify(e)),f(!1)}})()}),[null==j?void 0:j.timeRange]);const R=Object(T.jsx)(s.Fragment,null,Object(T.jsx)(i.EuiCallOut,{title:l.i18n.translate("xpack.ml.overview.anomalyDetection.errorPromptTitle",{defaultMessage:"An error occurred getting the anomaly detection jobs list."}),color:"danger",iconType:"warning"},Object(T.jsx)("pre",null,z))),V=!z&&!1===w&&void 0===z&&0===h;return Object(T.jsx)(m.a,{isOpen:p.adJobs,onToggle:e=>{O({...p,adJobs:e})},header:Object(T.jsx)(n.FormattedMessage,{id:"xpack.ml.overview.adJobsPanel.header",defaultMessage:"Anomaly Detection Jobs"}),headerItems:[...N?[Object(T.jsx)(d.b,{inputStats:N,dataTestSub:"mlOverviewJobStatsBar"})]:[],...C?[Object(T.jsx)(d.b,{inputStats:C,dataTestSub:"mlOverviewJobStatsBarExtra"})]:[],Object(T.jsx)(i.EuiLink,{href:x},l.i18n.translate("xpack.ml.overview.anomalyDetection.manageJobsButtonText",{defaultMessage:"Manage jobs"}))]},V?Object(T.jsx)(E.a,null):null,void 0!==z&&R,w?Object(T.jsx)(i.EuiLoadingSpinner,{className:"mlOverviewPanel__spinner",size:"xl"}):null,!1===w&&void 0===z&&h>0?Object(T.jsx)(A,{items:y,chartsService:a}):null)};var N=a(103),I=a(131),C=a(281),P=a(218);const z=({item:e})=>{const{disabled:t,tooltipContent:a}=Object(P.a)(e),o=l.i18n.translate("xpack.ml.overview.analytics.resultActions.openJobText",{defaultMessage:"View job results"}),n=!1===t?o:a,c=Object(s.useMemo)((()=>Object(N.s)(e.config.analysis)),[e]),r=Object(g.f)({page:b.b.DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:e.id,analysisType:c}});return Object(T.jsx)(i.EuiToolTip,{position:"top",content:n},Object(T.jsx)(i.EuiButtonIcon,{href:r,size:"xs",iconType:"visTable","aria-label":o,"data-test-subj":"mlOverviewAnalyticsJobViewButton",isDisabled:t}))};function B(){const e=Object(g.g)(),t=Object(g.h)();return[{isPrimary:!1,name:l.i18n.translate("xpack.ml.overview.analytics.viewJobActionName",{defaultMessage:"View job"}),description:l.i18n.translate("xpack.ml.overview.analytics.viewJobActionName",{defaultMessage:"View job"}),type:"icon",icon:"list",onClick:async a=>{const s=await(null==e?void 0:e.getUrl({page:b.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE,pageState:{jobId:a.id}}));await t(s)}},{isPrimary:!1,name:l.i18n.translate("xpack.ml.overview.analytics.viewResultsActionName",{defaultMessage:"View results"}),description:l.i18n.translate("xpack.ml.overview.analytics.resultActions.openJobText",{defaultMessage:"View job results"}),render:e=>Object(T.jsx)(z,{item:e})}]}const F=({items:e})=>{const[t,a]=Object(s.useState)(0),[o,n]=Object(s.useState)(10),[c,r]=Object(s.useState)(I.b.id),[d,b]=Object(s.useState)("asc"),u=[{field:I.b.id,name:l.i18n.translate("xpack.ml.overview.analyticsList.id",{defaultMessage:"ID"}),sortable:!0,truncateText:!1,width:"20%"},{name:l.i18n.translate("xpack.ml.overview.analyticsList.type",{defaultMessage:"Type"}),sortable:e=>Object(N.s)(e.config.analysis),truncateText:!0,render:e=>Object(T.jsx)(i.EuiBadge,{color:"hollow"},Object(N.s)(e.config.analysis)),width:"150px"},{name:l.i18n.translate("xpack.ml.overview.analyticsList.status",{defaultMessage:"Status"}),sortable:e=>e.stats.state,truncateText:!0,render:e=>Object(C.c)(e.stats.state,e.stats.failure_reason),width:"100px"},C.d,{field:I.b.configCreateTime,name:l.i18n.translate("xpack.ml.overview.analyticsList.reatedTimeColumnName",{defaultMessage:"Creation time"}),dataType:"date",render:e=>Object(O.c)(e),textOnly:!0,truncateText:!0,sortable:!0,width:"25%"},{name:l.i18n.translate("xpack.ml.overview.analyticsList.tableActionLabel",{defaultMessage:"Actions"}),actions:B(),width:"80px"}],m={initialPageIndex:t,initialPageSize:o,totalItemCount:e.length,pageSizeOptions:[10,20,50],showPerPageOptions:!0},j={sort:{field:c,direction:d}};return Object(T.jsx)(i.EuiInMemoryTable,{allowNeutralSort:!1,className:"mlAnalyticsTable",columns:u,hasActions:!0,isExpandable:!1,isSelectable:!1,items:e,itemId:I.b.id,onTableChange:({page:e={index:0,size:10},sort:t={field:I.b.id,direction:"asc"}})=>{const{index:s,size:o}=e;a(s),n(o);const{field:i,direction:l}=t;r(i),b(l)},pagination:m,sorting:j,"data-test-subj":"mlOverviewTableAnalytics"})};var R=a(205),V=a(236),G={name:"1r5gb7q",styles:"display:inline-block"};const Y=({setLazyJobCount:e})=>{const t=Object(_.a)(),[a,o]=Object(s.useState)([]),[c,j]=Object(s.useState)(void 0),[p,v]=Object(s.useState)(),[O,x]=Object(s.useState)(!1),w=Object(g.f)({page:b.b.DATA_FRAME_ANALYTICS_JOBS_MANAGE}),[f,y]=Object(r.b)(u.g,se),S=Object(s.useCallback)((e=>{if(!e)return;const t=Object.entries(e).filter((([e,t])=>t.show)).map((([e,t])=>t));j(t)}),[]),h=Object(R.d)(o,S,v,x,e,!1);Object(s.useEffect)((()=>{h(!0)}),[t]);const A=Object(T.jsx)(i.EuiCallOut,{title:l.i18n.translate("xpack.ml.overview.analyticsList.errorPromptTitle",{defaultMessage:"An error occurred getting the data frame analytics list."}),color:"danger",iconType:"warning"},Object(T.jsx)("pre",null,p&&void 0!==p.message?p.message:JSON.stringify(p))),M=void 0===p&&!0===O&&0===a.length;return Object(T.jsx)(m.a,{isOpen:f.dfaJobs,onToggle:e=>{y({...f,dfaJobs:e})},header:Object(T.jsx)(n.FormattedMessage,{id:"xpack.ml.overview.analyticsList.PanelTitle",defaultMessage:"Data Frame Analytics Jobs"}),headerItems:[...c?[Object(T.jsx)(d.b,{inputStats:c,dataTestSub:"mlOverviewAnalyticsStatsBar"})]:[],Object(T.jsx)(i.EuiLink,{href:w},l.i18n.translate("xpack.ml.overview.analyticsList.manageJobsButtonText",{defaultMessage:"Manage jobs"}))]},M?Object(T.jsx)(V.a,null):null,void 0!==p?A:null,!1===O&&Object(T.jsx)(i.EuiLoadingSpinner,{css:G,size:"xl"}),!0===O&&a.length>0?Object(T.jsx)(F,{items:a}):null)};var U=a(226),q=a(152);const W=({createAnomalyDetectionJobDisabled:e,setAdLazyJobCount:t,setDfaLazyJobCount:a})=>{const{services:{uiSettings:n,mlServices:{mlApiServices:l}}}=Object(g.d)(),{isADEnabled:r,isDFAEnabled:d}=Object(D.d)(),b=Object(c.i)(),[u,m]=Object(s.useState)();return Object(s.useEffect)((()=>{m(new U.AnomalyTimelineService(b,n,Object(q.mlResultsServiceProvider)(l)))}),[]),void 0===u?null:Object(T.jsx)(o.a.Fragment,null,r?Object(T.jsx)(o.a.Fragment,null,Object(T.jsx)(J,{anomalyTimelineService:u,setLazyJobCount:t}),Object(T.jsx)(i.EuiSpacer,{size:"m"})):null,d?Object(T.jsx)(Y,{setLazyJobCount:a}):null)};var X=a(36),H=a(178),K=a(162),Q=a(208),Z=a(124),$=a(370),ee=a(114),te=a(292),ae=a(26);const se=Object.freeze({nodes:!0,adJobs:!0,dfaJobs:!0}),oe=()=>{const[e,t]=Object(j.f)(["canViewMlNodes","canCreateJob"]),a=!t||!Object(p.c)(),{services:{docLinks:v}}=Object(g.d)(),O=v.links.ml.guide,x=Object(g.f)({page:b.b.MEMORY_USAGE}),w=Object(c.i)({timeRangeSelector:!0,autoRefreshSelector:!0}),[f,y]=Object(s.useState)(0),[S,h]=Object(s.useState)(0),[A,M]=Object(r.b)(u.g,se);return Object(T.jsx)("div",null,Object(T.jsx)(ee.a,null,Object(T.jsx)(te.a,{title:l.i18n.translate("xpack.ml.overview.overviewLabel",{defaultMessage:"Overview"})})),Object(T.jsx)(X.b,null),Object(T.jsx)(H.a,{jobCount:f+S}),Object(T.jsx)(K.a,{onCloseFlyout:()=>{const{from:e,to:t}=w.getTime(),a={start:e,end:t};c.f.next({lastRefresh:Date.now(),timeRange:a})}}),Object(T.jsx)(Q.a,null),e?Object(T.jsx)(o.a.Fragment,null,Object(T.jsx)(m.a,{isOpen:A.nodes,onToggle:e=>{M({...A,nodes:e})},header:Object(T.jsx)(n.FormattedMessage,{id:"xpack.ml.overview.nodesPanel.header",defaultMessage:"Nodes"}),headerItems:[Object(T.jsx)(d.b,{inputStats:[{label:l.i18n.translate("xpack.ml.overview.nodesPanel.totalNodesLabel",{defaultMessage:"Total"}),value:Object(ae.c)(),"data-test-subj":"mlTotalNodesCount"}],dataTestSub:"mlOverviewAnalyticsStatsBar"}),Object(T.jsx)(i.EuiLink,{href:x},l.i18n.translate("xpack.ml.overview.nodesPanel.viewNodeLink",{defaultMessage:"View nodes"}))]},Object(T.jsx)($.a,{compactView:!0})),Object(T.jsx)(i.EuiSpacer,{size:"m"})):null,Object(T.jsx)(W,{createAnomalyDetectionJobDisabled:a,setAdLazyJobCount:y,setDfaLazyJobCount:h}),Object(T.jsx)(Z.a,{docLink:O}))};t.default=oe}}]);