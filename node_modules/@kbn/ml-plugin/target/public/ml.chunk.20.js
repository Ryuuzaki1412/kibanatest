/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.ml_bundle_jsonpfunction=window.ml_bundle_jsonpfunction||[]).push([[20],{157:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var s=a(23);const l=()=>Object(s.useKibana)()},201:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a(2);var s=a(12),l=a(10),r=a(23),n=a(136),o=a(177),i=a(6);function c(e,t,a,c,b,u){const{http:d,theme:j,i18n:x,overlays:m,application:{currentAppId$:O}}=t;return new Promise((async(g,E)=>{try{const E=()=>{p.close(),g()},p=m.openFlyout(Object(n.a)(Object(i.jsx)(r.KibanaContextProvider,{services:{...t,share:a,data:c,lens:u,dashboardService:b,mlServices:Object(o.getMlGlobalServices)(d)}},Object(i.jsx)(e,{onClose:()=>{E(),g()}})),{theme:j,i18n:x}),{"data-test-subj":"mlFlyoutLayerSelector",ownFocus:!0,onClose:E,size:"35vw"});O.pipe(Object(s.skip)(1),Object(s.takeUntil)(Object(l.from)(p.onClose)),Object(s.distinctUntilChanged)()).subscribe((()=>{p.close()}))}catch(e){E(e)}}))}},202:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var s,l=a(2),r=a.n(l),n=a(155),o=a.n(n),i=a(29),c=a(3),b=a(15),u=a(107),d=a(106),j=a(111),x=a(44),m=a(149),O=a(1),g=a(157),E=a(6);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.VALIDATING=1]="VALIDATING",e[e.SAVING=2]="SAVING",e[e.SAVE_SUCCESS=3]="SAVE_SUCCESS",e[e.SAVE_FAILED=4]="SAVE_FAILED"}(s||(s={}));const p=({children:e,createADJobInWizard:t,createADJob:a,layer:n,layerIndex:u,embeddable:p,timeRange:S,incomingCreateError:f,outerFormComplete:I})=>{var F;const{services:{share:C,application:L,mlServices:{mlApiServices:h}}}=Object(g.a)(),[A,v]=Object(l.useState)(""),[M,k]=Object(l.useState)(!0),[T,w]=Object(l.useState)(!0),[_,J]=Object(l.useState)(d.b),[z,D]=Object(l.useState)(""),[V,G]=Object(l.useState)(""),[R,B]=Object(l.useState)(s.DEFAULT),[N,U]=Object(l.useState)(null),$=null!==(F=null==n?void 0:n.jobType)&&void 0!==F?F:d.f.GEO,P=Object(l.useCallback)((async e=>{const t=C.url.locators.get(O.a);if(t){const a=M?e===d.f.MULTI_METRIC||e===d.f.GEO?O.b.ANOMALY_EXPLORER:O.b.SINGLE_METRIC_VIEWER:O.b.ANOMALY_DETECTION_JOBS_MANAGE,s=M?{jobIds:[A],timeRange:S}:{jobId:A},l=await t.getUrl({page:a,pageState:s});L.navigateToUrl(l)}}),[C,M,A,S,L]);return o()((function(){if(void 0===A||""===A)return;D(""),G("");const e=Object(j.e)({job_id:A,analysis_config:{detectors:[],bucket_span:_}},void 0,{max_model_memory_limit:"",effective_max_model_memory_limit:""},!0);e.contains("job_id_invalid")?D(c.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})):e.contains("job_id_invalid_max_length")?D(c.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:x.b}})):h.jobs.jobsExist([A]).then((e=>{e[A].exists&&D(c.i18n.translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."}))})).catch((e=>{console.error("Could not validate whether job ID exists")})),e.contains("bucket_span_invalid")&&G(Object(m.a)(_)),B(s.DEFAULT)}),500,[A,_]),Object(E.jsx)(r.a.Fragment,null,R!==s.SAVE_SUCCESS&&R!==s.SAVING||f?Object(E.jsx)(r.a.Fragment,null,null!=e?e:null,Object(E.jsx)(i.EuiSpacer,{size:"m"}),Object(E.jsx)(i.EuiForm,null,Object(E.jsx)(i.EuiFormRow,{label:c.i18n.translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.title",{defaultMessage:"Job ID"}),error:z,isInvalid:""!==z},Object(E.jsx)(i.EuiFieldText,{"data-test-subj":`mlLensLayerJobIdInput_${u}`,value:A,onChange:e=>{v(e.target.value),B(s.VALIDATING)}})),Object(E.jsx)(i.EuiSpacer,{size:"s"}),Object(E.jsx)(i.EuiAccordion,{"data-test-subj":`mlLensLayerAdditionalSettingsButton_${u}`,id:"additional-section",buttonContent:c.i18n.translate("xpack.ml.embeddables.lensLayerFlyout.createJobCallout.additionalSettings.title",{defaultMessage:"Additional settings"})},Object(E.jsx)(i.EuiSpacer,{size:"s"}),Object(E.jsx)(i.EuiFormRow,{label:c.i18n.translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.placeholder",{defaultMessage:"Bucket span"}),error:V,isInvalid:""!==V},Object(E.jsx)(i.EuiFieldText,{"data-test-subj":`mlLensLayerBucketSpanInput_${u}`,value:_,onChange:e=>{J(e.target.value),B(s.VALIDATING)}})),Object(E.jsx)(i.EuiSpacer,{size:"l"}),Object(E.jsx)(i.EuiFormRow,null,Object(E.jsx)(i.EuiCheckbox,{id:"startJob","data-test-subj":`mlLensLayerStartJobCheckbox_${u}`,checked:M,onChange:e=>{return t=e.target.checked,k(t),void w(t&&T);var t},label:c.i18n.translate("xpack.ml.embeddables.lensLayerFlyout.createJobCallout.additionalSettings.start",{defaultMessage:"Start the job after saving"})})),Object(E.jsx)(i.EuiSpacer,{size:"s"}),Object(E.jsx)(i.EuiFormRow,null,Object(E.jsx)(i.EuiCheckbox,{id:"realTime",disabled:!1===M,"data-test-subj":`mlLensLayerRealTimeCheckbox_${u}`,checked:T,onChange:e=>w(e.target.checked),label:c.i18n.translate("xpack.ml.embeddables.lensLayerFlyout.createJobCallout.additionalSettings.realTime",{defaultMessage:"Leave the job running for new data"})})),Object(E.jsx)(i.EuiSpacer,{size:"m"}))),Object(E.jsx)(i.EuiSpacer,{size:"m"}),Object(E.jsx)(i.EuiFlexGroup,null,Object(E.jsx)(i.EuiFlexItem,null,Object(E.jsx)(i.EuiButton,{disabled:R===s.VALIDATING||""===A||""!==z||""!==V||!1===I,onClick:async function(){if(void 0===A||""===A)return;B(s.SAVING),U(null);const e=await a({jobId:A,bucketSpan:_,embeddable:p,startJob:M,runInRealTime:T}),t=y(e);null===t?B(s.SAVE_SUCCESS):(B(s.SAVE_FAILED),U(t))}.bind(null,u),size:"s","data-test-subj":`mlLensLayerCreateJobButton_${u}`},Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.createJobButton.saving",defaultMessage:"Create job"}))),Object(E.jsx)(i.EuiFlexItem,{grow:!1},Object(E.jsx)(i.EuiButtonEmpty,{onClick:t.bind(null,u),size:"s",iconType:"popout",iconSide:"right","data-test-subj":`mlLensLayerCreateWithWizardButton_${u}`},Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.createJobButton",defaultMessage:"Create job using wizard"}))))):null,R===s.SAVE_SUCCESS?Object(E.jsx)(r.a.Fragment,null,Object(E.jsx)(i.EuiFlexGroup,{gutterSize:"s","data-test-subj":`mlLensLayerCompatible.jobCreated.success_${u}`},Object(E.jsx)(i.EuiFlexItem,{grow:!1},Object(E.jsx)(i.EuiText,{size:"s"},Object(E.jsx)(i.EuiIcon,{type:"checkInCircleFilled",color:"success"}))),Object(E.jsx)(i.EuiFlexItem,null,Object(E.jsx)(i.EuiText,{size:"s"},Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyout.flyoutAdditionalSettings.saveSuccess",defaultMessage:"Job created"})))),Object(E.jsx)(i.EuiSpacer,{size:"s"}),Object(E.jsx)(i.EuiButtonEmpty,{onClick:P.bind(null,$),flush:"left","data-test-subj":`mlLensLayerResultsButton_${u}`},!1===M?Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.saveSuccess.resultsLink.jobList",defaultMessage:"View in job management page"}):$===d.f.MULTI_METRIC||$===d.f.GEO?Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.saveSuccess.resultsLink.multiMetric",defaultMessage:"View results in Anomaly Explorer"}):Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.saveSuccess.resultsLink.singleMetric",defaultMessage:"View results in Single Metric Viewer"}))):null,R===s.SAVING&&void 0===f?Object(E.jsx)(r.a.Fragment,null,Object(E.jsx)(i.EuiFlexGroup,null,Object(E.jsx)(i.EuiFlexItem,{grow:!1},Object(E.jsx)(b.FormattedMessage,{id:"xpack.ml.embeddables.flyoutAdditionalSettings.creatingJob",defaultMessage:"Creating job"})),Object(E.jsx)(i.EuiFlexItem,{grow:!1},Object(E.jsx)(i.EuiLoadingSpinner,null)))):null,R===s.SAVE_FAILED&&null!==N?Object(E.jsx)(r.a.Fragment,null,Object(E.jsx)(i.EuiSpacer,null),Object(E.jsx)(i.EuiCallOut,{color:"danger",title:N.text},N.errorText)):null,f?Object(E.jsx)(r.a.Fragment,null,Object(E.jsx)(i.EuiSpacer,null),Object(E.jsx)(i.EuiCallOut,{color:"danger",title:f.text},f.errorText)):null)},y=e=>e.jobCreated.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.jobCreated",{defaultMessage:"Job could not be created."}),errorText:Object(u.b)(e.jobCreated.error)}:e.datafeedCreated.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.datafeedCreated",{defaultMessage:"Job created but datafeed could not be created."}),errorText:Object(u.b)(e.datafeedCreated.error)}:e.jobOpened.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.jobOpened",{defaultMessage:"Job and datafeed created but the job could not be opened."}),errorText:Object(u.b)(e.jobOpened.error)}:e.datafeedStarted.error?{text:c.i18n.translate("xpack.ml.embeddables.flyoutAdditionalSettings.jobCreateError.datafeedStarted",{defaultMessage:"Job and datafeed created but the datafeed could not be started."}),errorText:Object(u.b)(e.datafeedStarted.error)}:null},694:function(e,t,a){"use strict";a.r(t),a.d(t,"showLensVisToADJobFlyout",(function(){return E}));var s=a(2),l=a.n(s),r=a(201),n=a(15),o=a(29),i=a(284),c=a(106),b=a(157),u=a(202),d=a(6);const j=({layer:e,layerIndex:t,embeddable:a})=>{const{services:{data:r,share:j,uiSettings:x,mlServices:{mlApiServices:m},lens:O,dashboardService:g}}=Object(b.a)(),E=Object(s.useMemo)((()=>new i.QuickLensJobCreator(O,x,r.query.timefilter.timefilter,g,m)),[r,x]);return Object(d.jsx)(l.a.Fragment,null,Object(d.jsx)(u.a,{createADJob:async function({jobId:e,bucketSpan:a,embeddable:s,startJob:l,runInRealTime:r}){return await E.createAndSaveJob(e,a,s,l,r,t)},createADJobInWizard:function(){Object(i.redirectToADJobWizards)(a,t,j,O)},embeddable:a,timeRange:a.getInput().timeRange,layer:e,layerIndex:t},Object(d.jsx)(o.EuiFlexGroup,{gutterSize:"s","data-test-subj":"mlLensLayerCompatible"},Object(d.jsx)(o.EuiFlexItem,{grow:!1},Object(d.jsx)(o.EuiText,{size:"s"},Object(d.jsx)(o.EuiIcon,{type:"checkInCircleFilled",color:"success"}))),Object(d.jsx)(o.EuiFlexItem,null,Object(d.jsx)(o.EuiText,{size:"s"},e.jobType===c.f.MULTI_METRIC?Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.createJobCalloutTitle.multiMetric",defaultMessage:"This layer can be used to create a multi-metric job"}):Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.createJobCalloutTitle.singleMetric",defaultMessage:"This layer can be used to create a single metric job"}))))))};var x=a(107);const m=({layer:e})=>Object(d.jsx)(o.EuiFlexGroup,{gutterSize:"s",color:"subdued","data-test-subj":"mlLensLayerIncompatible"},Object(d.jsx)(o.EuiFlexItem,{grow:!1},Object(d.jsx)(o.EuiText,{size:"s"},Object(d.jsx)(o.EuiIcon,{type:"error",color:"subdued"}))),Object(d.jsx)(o.EuiFlexItem,null,Object(d.jsx)(o.EuiText,{color:"subdued",size:"s"},e.error?Object(x.b)(e.error):Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.defaultLayerError",defaultMessage:"This layer cannot be used to create an anomaly detection job"})))),O=({layer:e,layerIndex:t,embeddable:a})=>Object(d.jsx)(l.a.Fragment,null,Object(d.jsx)(o.EuiSplitPanel.Outer,{grow:!0},Object(d.jsx)(o.EuiSplitPanel.Inner,null,Object(d.jsx)(o.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},e.icon&&Object(d.jsx)(o.EuiFlexItem,{grow:!1},Object(d.jsx)(o.EuiIcon,{type:e.icon})),Object(d.jsx)(o.EuiFlexItem,{grow:!0},Object(d.jsx)(o.EuiText,{color:e.isCompatible?"":"subdued"},Object(d.jsx)("h5",null,e.label))))),Object(d.jsx)(o.EuiHorizontalRule,{margin:"none"}),Object(d.jsx)(o.EuiSplitPanel.Inner,{grow:!1,color:"plain"},e.isCompatible?Object(d.jsx)(j,{layer:e,layerIndex:t,embeddable:a}):Object(d.jsx)(m,{layer:e}))),Object(d.jsx)(o.EuiSpacer,null)),g=({onClose:e,embeddable:t})=>{const{services:{data:a,lens:r}}=Object(b.a)(),[c,u]=Object(s.useState)([]);return Object(s.useEffect)((()=>{(new i.VisualizationExtractor).getResultLayersFromEmbeddable(t,r).then(u).catch((t=>{console.error("Layers could not be extracted from embeddable",t),e()}))}),[a,r,t]),Object(d.jsx)(l.a.Fragment,null,Object(d.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(d.jsx)(o.EuiTitle,{size:"s"},Object(d.jsx)("h3",null,Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.title",defaultMessage:"Create anomaly detection job"}))),Object(d.jsx)(o.EuiSpacer,{size:"m"}),Object(d.jsx)(o.EuiText,{size:"s"},Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.secondTitle",defaultMessage:"Select a compatible layer from the visualization {title} to create an anomaly detection job.",values:{title:t.getTitle()}}))),Object(d.jsx)(o.EuiFlyoutBody,null,c.map(((e,a)=>Object(d.jsx)(O,{layer:e,layerIndex:a,key:e.id,embeddable:t})))),Object(d.jsx)(o.EuiFlyoutFooter,null,Object(d.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(d.jsx)(o.EuiFlexItem,{grow:!1},Object(d.jsx)(o.EuiButtonEmpty,{iconType:"cross",onClick:e,flush:"left"},Object(d.jsx)(n.FormattedMessage,{id:"xpack.ml.embeddables.lensLayerFlyout.closeButton",defaultMessage:"Close"}))))))};async function E(e,t,a,s,l,n){return Object(r.a)((({onClose:t})=>Object(d.jsx)(g,{embeddable:e,onClose:t})),t,a,s,l,n)}}}]);