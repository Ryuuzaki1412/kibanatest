/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observability_bundle_jsonpfunction=window.observability_bundle_jsonpfunction||[]).push([[15],{135:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"e",(function(){return l})),a.d(t,"d",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return s}));var r=a(0);const i=r.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.equationHelpMessage",{defaultMessage:"Supports basic math equations, valid charaters are: A-Z, +, -, /, *, (, ), ?, !, &, :, |, >, <, ="}),l=r.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.labelLabel",{defaultMessage:"Label (optional)"}),n=r.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.labelHelpMessage",{defaultMessage:"Custom label will show on the alert chart and in reason"}),o=r.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquation",{defaultMessage:"Custom equation"}),s=r.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.deleteRowButton",{defaultMessage:"Delete"})},218:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(66),i=a(1),l=r.__importDefault(a(219));t.default=function(e,t){void 0===t&&(t=[]);var a=l.default(e,t,{loading:!0}),r=a[0],n=a[1];return i.useEffect((function(){n()}),[n]),r}},219:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(66),i=a(1),l=r.__importDefault(a(220));t.default=function(e,t,a){void 0===t&&(t=[]),void 0===a&&(a={loading:!1});var n=i.useRef(0),o=l.default(),s=i.useState(a),u=s[0],c=s[1],d=i.useCallback((function(){for(var t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];var i=++n.current;return c((function(e){return r.__assign(r.__assign({},e),{loading:!0})})),e.apply(void 0,t).then((function(e){return o()&&i===n.current&&c({value:e,loading:!1}),e}),(function(e){return o()&&i===n.current&&c({error:e,loading:!1}),e}))}),t);return[u,d]}},220:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(1);t.default=function(){var e=r.useRef(!1),t=r.useCallback((function(){return e.current}),[]);return r.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},225:function(e,t,a){"use strict";a.r(t),a.d(t,"defaultExpression",(function(){return oe})),a.d(t,"default",(function(){return se}));var r=a(1),i=a.n(r),l=a(16),n=a(12),o=a(101),s=a(0),u=a(43),c=a(86),d=a(42),h=a(45),m=a(14);const g=(e,t)=>{const a=t?new RegExp(/0?\./):".",r=String(e).replace(a,"").length;return parseFloat((t?100*e:e/100).toPrecision(r))},p=e=>g(e,!0),f=e=>g(e,!1),y=(e,t,a)=>{var r,i;const l=Boolean(1===e.length&&(null===(r=e[0].field)||void 0===r?void 0:r.endsWith(".pct"))),n=Boolean(1===t.length&&(null===(i=t[0].field)||void 0===i?void 0:i.endsWith(".pct")));return n===l?a:n?a.map((e=>f(e))):l?a.map((e=>p(e))):a};var v=a(79),b=a.n(v),E=a(58);function x({children:e,onClose:t}){return i.a.createElement(n.EuiPopoverTitle,null,i.a.createElement(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},i.a.createElement(n.EuiFlexItem,null,e),i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiButtonIcon,{"data-test-subj":"o11yClosablePopoverTitleButton",iconType:"cross",color:"danger","aria-label":s.i18n.translate("xpack.observability.thresholdRule.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>t()}))))}var C=a(135);function T({onDelete:e,disableDelete:t}){return i.a.createElement(w,{"data-test-subj":"o11yMetricRowControlsButton","aria-label":C.b,iconType:"cross",color:"text",onClick:e,disabled:t,title:C.b,size:"xs"})}var w=b()(n.EuiButtonIcon).withConfig({displayName:"_StyledEuiButtonIcon",componentId:"sc-c52oi4-0"})({height:16});const _=s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.defaultCountFilterTitle",{defaultMessage:"all documents"});function F({name:e,aggType:t=h.a.COUNT,field:a,onDelete:o,dataView:c,filter:d,disableDelete:m,fields:g,aggregationTypes:p,onChange:f,errors:y}){const v=Object(r.useCallback)((()=>{o(e)}),[e,o]),[b,C]=Object(r.useState)(!1),w=Object(r.useMemo)((()=>g.reduce(((e,a)=>(t&&p[t].validNormalizedTypes.includes(a.normalizedType)&&e.push({label:a.name}),e)),[])),[g,p,t]),F=Object(r.useCallback)((a=>{f({name:e,field:a.length&&a[0].label||void 0,aggType:t})}),[e,t,f]),S=Object(r.useCallback)((t=>{f({name:e,field:t===h.a.COUNT?void 0:a,aggType:t})}),[e,a,f]),k=Object(r.useCallback)((a=>{f({name:e,filter:a,aggType:t})}),[e,t,f]),j=null!=Object(l.get)(y,["metrics",e,"aggType"]),M=null!=Object(l.get)(y,["metrics",e,"field"])||!a;return i.a.createElement(n.EuiFlexGroup,{gutterSize:"xs",alignItems:"flexEnd"},i.a.createElement(n.EuiFlexItem,{grow:!0},i.a.createElement(n.EuiPopover,{button:i.a.createElement(n.EuiFormRow,{fullWidth:!0,label:i.a.createElement(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},i.a.createElement(O,{grow:!1},s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.aggregationLabel",{defaultMessage:"Aggregation {name}",values:{name:e}})),!m&&i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(T,{onDelete:v,disableDelete:m})))},i.a.createElement(n.EuiExpression,{"data-test-subj":"aggregationName",description:p[t].text,value:t===h.a.COUNT?d||_:a,isActive:b,display:"columns",onClick:()=>{C(!0)},isInvalid:t!==h.a.COUNT&&!a})),isOpen:b,closePopover:()=>{C(!1)},display:"block",ownFocus:!0,anchorPosition:"downLeft",repositionOnScroll:!0},i.a.createElement("div",null,i.a.createElement(x,{onClose:()=>C(!1)},i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.aggregationLabel",defaultMessage:"Aggregation {name}",values:{name:e}})),i.a.createElement(n.EuiFlexGroup,{gutterSize:"l",alignItems:"flexEnd"},i.a.createElement(n.EuiFlexItem,{grow:!0},i.a.createElement(n.EuiFormRow,{label:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.aggregationType",{defaultMessage:"Aggregation type"})},i.a.createElement(n.EuiSelect,{"data-test-subj":"aggregationTypeSelect",id:"aggTypeField",value:t,fullWidth:!0,onChange:e=>{S(e.target.value)},options:Object.values(p).map((({text:e,value:t})=>({text:e,value:t}))),isInvalid:j}))),i.a.createElement(n.EuiFlexItem,{style:{minWidth:300}},t===h.a.COUNT?i.a.createElement(n.EuiFormRow,{label:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.filterLabel",{defaultMessage:"KQL Filter {name}",values:{name:e}})},i.a.createElement(E.a,{placeholder:" ",derivedIndexPattern:c,onChange:k,onSubmit:k,value:d})):i.a.createElement(n.EuiFormRow,{label:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.fieldLabel",{defaultMessage:"Field name"})},i.a.createElement(n.EuiComboBox,{fullWidth:!0,isInvalid:M,singleSelection:{asPlainText:!0},options:w,selectedOptions:a?[{label:a}]:[],onChange:F}))))))))}var O=b()(n.EuiFlexItem).withConfig({displayName:"_StyledEuiFlexItem",componentId:"sc-1kkkhzk-0"})({paddingTop:2,paddingBottom:2});const S={name:"A",aggType:h.a.COUNT},k=26,j=65+k,M=Object(l.range)(65,j).map((e=>String.fromCharCode(e)));function q({onChange:e,expression:t,fields:a,aggregationTypes:o,errors:c,dataView:d}){var h;const[m,g]=Object(r.useState)(null!==(h=null==t?void 0:t.metrics)&&void 0!==h?h:[S]),[p,f]=Object(r.useState)(!1),[v,b]=Object(r.useState)(null==t?void 0:t.equation),E=Object(r.useMemo)((()=>Object(l.debounce)(e,500)),[e]);Object(r.useEffect)((()=>{var e;g(null!==(e=null==t?void 0:t.metrics)&&void 0!==e?e:[S]),b(null==t?void 0:t.equation)}),[null==t?void 0:t.metrics,null==t?void 0:t.equation]);const T=Object(r.useCallback)((()=>{g((e=>{var a;const r=null!==(a=null==e?void 0:e.map((e=>e.name)))&&void 0!==a?a:[],i=Object(l.first)(Object(l.xor)(M,r)),n=[...e||[],{...S,name:i}];return E({...t,metrics:n,equation:v,threshold:y(e,n,t.threshold)}),n}))}),[E,v,t]),w=Object(r.useCallback)((e=>{g((a=>{var r;const i=null!==(r=null==a?void 0:a.filter((t=>t.name!==e)))&&void 0!==r?r:[S],l=i.length&&i||[S];return E({...t,metrics:l,equation:v,threshold:y(a,i,t.threshold)}),l}))}),[v,t,E]),_=Object(r.useCallback)((e=>{g((a=>{const r=null==a?void 0:a.map((t=>t.name===e.name?e:t));return E({...t,metrics:r,equation:v,threshold:y(a,r,t.threshold)}),r}))}),[v,t,E]),O=Object(r.useCallback)((e=>{b(e.target.value),E({...t,metrics:m,equation:e.target.value})}),[E,t,m]),j=(null==m?void 0:m.length)===k,q=1===(null==m?void 0:m.length),R=null==m?void 0:m.map((e=>i.a.createElement(F,{key:e.name,name:e.name,aggType:e.aggType,aggregationTypes:o,field:e.field,filter:e.filter,fields:a,onAdd:T,onDelete:w,disableAdd:j,disableDelete:q,onChange:_,errors:c,dataView:d}))),L=Object(r.useMemo)((()=>null==m?void 0:m.map((e=>e.name)).join(" + ")),[m]);return i.a.createElement("div",{style:{minWidth:"100%"}},i.a.createElement(n.EuiSpacer,{size:"s"}),R,i.a.createElement(n.EuiFlexGroup,null,i.a.createElement(n.EuiButtonEmpty,{"data-test-subj":"thresholdRuleCustomEquationEditorAddAggregationFieldButton",color:"primary",flush:"left",size:"xs",iconType:"plusInCircleFilled",onClick:T,isDisabled:j},i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.addCustomRow",defaultMessage:"Add aggregation/field"}))),i.a.createElement(n.EuiSpacer,{size:"m"}),i.a.createElement(n.EuiFlexItem,null,i.a.createElement(n.EuiPopover,{button:i.a.createElement(n.EuiFormRow,{"data-test-subj":"equationAndThreshold",fullWidth:!0,label:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.equationAndThreshold",{defaultMessage:"Equation and threshold"}),error:[c.equation]},i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiSpacer,{size:"xs"}),i.a.createElement(n.EuiExpression,{"data-test-subj":"customEquation",description:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.equationLabel",{defaultMessage:"Equation"}),value:null!=v?v:L,display:"columns",onClick:()=>{f(!0)},isInvalid:null!=c.equation}))),isOpen:p,closePopover:()=>{f(!1)},display:"block",ownFocus:!0,anchorPosition:"downLeft",repositionOnScroll:!0},i.a.createElement("div",null,i.a.createElement(x,{onClose:()=>f(!1)},i.a.createElement("span",null,i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.customEquationLabel",defaultMessage:"Custom equation"})," ",i.a.createElement(n.EuiIconTip,{content:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationTooltip",{defaultMessage:"This supports basic math (A + B / C) and boolean logic (A < B ? A : B)."}),position:"top"}))),i.a.createElement(n.EuiFormRow,{fullWidth:!0,helpText:C.c,isInvalid:null!=c.equation},i.a.createElement(n.EuiFieldText,{"data-test-subj":"thresholdRuleCustomEquationEditorFieldText",isInvalid:null!=c.equation,compressed:!0,fullWidth:!0,placeholder:L,onChange:O,value:null!=v?v:""}))))))}const R={...c.builtInComparators};delete R[c.COMPARATORS.NOT_BETWEEN];const L={...R,[h.b.OUTSIDE_RANGE]:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.outsideRangeLabel",{defaultMessage:"Is not between"}),value:h.b.OUTSIDE_RANGE,requiredValues:2}},V=Object(m.euiStyled)(n.EuiFlexGroup)`
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  margin: 0 -4px;
`,I=e=>{var t;const{dataView:a,children:o,setRuleParams:u,expression:c,errors:d,expressionId:m,remove:g,fields:p,canDelete:y,title:v}=e,{metrics:b,comparator:E=h.b.GT,threshold:x=[]}=c,T=Object(r.useMemo)((()=>{var e;return Boolean(1===b.length&&(null===(e=b[0].field)||void 0===e?void 0:e.endsWith(".pct")))}),[b]),[w,_]=Object(r.useState)((null==c?void 0:c.label)||void 0),F=Object(r.useCallback)((e=>{u(m,{...c,comparator:e})}),[m,c,u]),O=Object(r.useCallback)((e=>T?e.map((e=>f(e))):e),[T]),S=Object(r.useCallback)((e=>{const t=O(e);t.join()!==c.threshold.join()&&u(m,{...c,threshold:t})}),[m,c,O,u]),k=Object(r.useCallback)((e=>{u(m,e)}),[m,u]),j=Object(r.useMemo)((()=>Object(l.debounce)(k,300)),[k]),M=i.a.createElement(A,{comparator:E,threshold:x,updateComparator:F,updateThreshold:S,errors:null!==(t=d.critical)&&void 0!==t?t:{},isMetricPct:T}),R=p.map((e=>({normalizedType:e.type,name:e.name}))),L=Object(r.useCallback)((e=>{_(e.target.value),j({...c,label:e.target.value})}),[j,c]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiFlexGroup,{gutterSize:"xs",alignItems:"center"},i.a.createElement(n.EuiFlexItem,{grow:!0},i.a.createElement(n.EuiTitle,{size:"xs"},i.a.createElement("h5",null,v))),y&&i.a.createElement(n.EuiFlexItem,{grow:!1},i.a.createElement(n.EuiButtonIcon,{"data-test-subj":"o11yExpressionRowButton","aria-label":s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"text",iconType:"trash",onClick:()=>g(m)}))),i.a.createElement(n.EuiFlexGroup,{gutterSize:"xs"},i.a.createElement(n.EuiFlexItem,{grow:!0},i.a.createElement(V,{style:{gap:24}}),i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiSpacer,{size:"xs"}),i.a.createElement(q,{expression:c,fields:R,aggregationTypes:D,onChange:k,errors:d,dataView:a}),M,i.a.createElement(n.EuiSpacer,{size:"s"}),i.a.createElement(n.EuiFlexGroup,null,i.a.createElement(n.EuiFlexItem,null,i.a.createElement(n.EuiFormRow,{label:C.e,fullWidth:!0,helpText:C.d},i.a.createElement(n.EuiFieldText,{"data-test-subj":"thresholdRuleCustomEquationEditorFieldText",compressed:!0,fullWidth:!0,value:w,placeholder:C.a,onChange:L})))),i.a.createElement(n.EuiSpacer,{size:"s"})))),o)},A=({updateComparator:e,updateThreshold:t,threshold:a,isMetricPct:l,comparator:n,errors:o})=>{const s=Object(r.useMemo)((()=>l?a.map((e=>p(e))):a),[a,l]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(c.ThresholdExpression,{thresholdComparator:n||h.b.GT,threshold:s,customComparators:L,onChangeSelectedThresholdComparator:e,onChangeSelectedThreshold:t,errors:o,display:"fullWidth",unit:l?"%":""}))},D={avg:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.aggregationText.avg",{defaultMessage:"Average"}),fieldRequired:!0,validNormalizedTypes:["number","histogram"],value:h.a.AVERAGE},max:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.aggregationText.max",{defaultMessage:"Max"}),fieldRequired:!0,validNormalizedTypes:["number","date","histogram"],value:h.a.MAX},min:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.aggregationText.min",{defaultMessage:"Min"}),fieldRequired:!0,validNormalizedTypes:["number","date","histogram"],value:h.a.MIN},cardinality:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.aggregationText.cardinality",{defaultMessage:"Cardinality"}),fieldRequired:!1,value:h.a.CARDINALITY,validNormalizedTypes:["number","string","ip","date"]},count:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.aggregationText.count",{defaultMessage:"Count"}),fieldRequired:!1,value:h.a.COUNT,validNormalizedTypes:["number"]},sum:{text:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.aggregationText.sum",{defaultMessage:"Sum"}),fieldRequired:!1,value:h.a.SUM,validNormalizedTypes:["number","histogram"]}};var B=a(65),z=a.n(B);function N({options:e,onChange:t,fields:a,errorOptions:l,...o}){const u=Object(r.useCallback)((e=>{const a=e.map((e=>e.label));t(a)}),[t]),c=Array.isArray(e.groupBy)?e.groupBy.map((e=>({label:e,color:null!=l&&l.includes(e)?"danger":void 0}))):e.groupBy?[{label:e.groupBy,color:null!=l&&l.includes(e.groupBy)?"danger":void 0}]:[];return i.a.createElement(n.EuiComboBox,z()({"data-test-subj":"thresholdRuleMetricsExplorer-groupBy",placeholder:s.i18n.translate("xpack.observability.threshold.ruleExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":s.i18n.translate("xpack.observability.threshold.ruleExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:!0,singleSelection:!1,selectedOptions:c,options:a.filter((e=>e.aggregatable&&"string"===e.type)).map((e=>({label:e.name}))),onChange:u,isClearable:!0},o))}var P=a(218),$=a.n(P),G=a(2),W=a.n(G);const U="layer",Q="infra_lens_ad_hoc_default",H=10;function Y(e){return null!=e}const X=({columnName:e,options:t})=>{var a,r;const{interval:i="auto",...l}=null!==(a=null==t?void 0:t.params)&&void 0!==a?a:{};return{[e]:{dataType:"date",isBucketed:!0,label:"@timestamp",operationType:"date_histogram",scale:"interval",sourceField:null!==(r=null==t?void 0:t.sourceField)&&void 0!==r?r:"@timestamp",params:{interval:i,...l}}}},Z=({columnName:e,field:t,options:a})=>{const{size:r=H,...i}=null!=a?a:{};return{[e]:{label:`Top ${r} values of ${t}`,dataType:"string",operationType:"terms",scale:"ordinal",sourceField:t,isBucketed:!0,params:{size:r,orderBy:{type:"alphabetical",fallback:!1},orderDirection:"asc",otherBucket:!1,missingBucket:!1,parentFormat:{id:"terms"},include:[],exclude:[],includeIsRegex:!1,excludeIsRegex:!1,...i}}}},J=(e,t)=>{var a;return[{type:"index-pattern",id:null!==(a=e.id)&&void 0!==a?a:Q,name:`indexpattern-datasource-layer-${t}`}]},K="formula_accessor";class xy_chart_XYChart{constructor(e){W()(this,"_layers",null),this.chartConfig=e}getVisualizationType(){return"lnsXY"}get layers(){return this._layers||(this._layers=Array.isArray(this.chartConfig.layers)?this.chartConfig.layers:[this.chartConfig.layers]),this._layers}getLayers(){return this.layers.reduce(((e,t,a)=>{const r=`${U}_${a}`,i=`${K}_${a}`;return{...e,...t.getLayer(r,i,this.chartConfig.dataView,this.chartConfig.formulaAPI)}}),{})}getVisualizationState(){var e,t,a,r,i,l,n,o,s,u,c;return{...ee({layers:[...this.chartConfig.layers.map(((e,t)=>{const a=`${U}_${t}`,r=`${K}_${t}`;return e.getLayerConfig(a,r)}))]}),legend:null!==(e=null===(t=this.chartConfig.visualOptions)||void 0===t?void 0:t.legend)&&void 0!==e?e:{isVisible:!1,position:"right",showSingleSeries:!1},fittingFunction:null!==(a=null===(r=this.chartConfig.visualOptions)||void 0===r?void 0:r.missingValues)&&void 0!==a?a:"None",endValue:null===(i=this.chartConfig.visualOptions)||void 0===i?void 0:i.endValues,curveType:null===(l=this.chartConfig.visualOptions)||void 0===l?void 0:l.lineInterpolation,emphasizeFitting:!(null!==(n=this.chartConfig.visualOptions)&&void 0!==n&&n.showDottedLine),valueLabels:null===(o=this.chartConfig.visualOptions)||void 0===o?void 0:o.valueLabels,axisTitlesVisibilitySettings:null!==(s=null===(u=this.chartConfig.visualOptions)||void 0===u?void 0:u.axisTitlesVisibilitySettings)&&void 0!==s?s:{x:!1,yLeft:!1,yRight:!0},yLeftExtent:null===(c=this.chartConfig.visualOptions)||void 0===c?void 0:c.yLeftExtent}}getReferences(){return this.layers.flatMap(((e,t)=>{const a=`${U}_${t}`;return e.getReference(a,this.chartConfig.dataView)}))}getDataViews(){return[this.chartConfig.dataView,...this.chartConfig.layers.map((e=>e.getDataView())).filter((e=>!!e))]}getTitle(){var e,t;return null!==(e=null!==(t=this.chartConfig.title)&&void 0!==t?t:this.layers[0].getName())&&void 0!==e?e:""}}const ee=e=>({legend:{isVisible:!1,position:"right",showSingleSeries:!1},valueLabels:"show",yLeftScale:"linear",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},labelsOrientation:{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:"line",valuesInLegend:!1,hideEndzones:!0,...e});class FormulaColumn{constructor(e){this.valueConfig=e}getValueConfig(){return this.valueConfig}getData(e,t,a,r){const{value:i,...l}=this.getValueConfig(),n=r.insertOrReplaceFormulaColumn(e,{formula:i,...l},t,a);if(!n)throw new Error("Error generating the data layer for the chart");return n}}const te="aggs_breakdown",ae="x_date_histogram";class xy_data_layer_XYDataLayer{constructor(e){var t,a;W()(this,"column",void 0),W()(this,"layerConfig",void 0),this.column=e.data.map((e=>new FormulaColumn(e))),this.layerConfig={...e,layerType:null!==(t=e.layerType)&&void 0!==t?t:"data",options:{...e.options,buckets:{type:"date_histogram",...null===(a=e.options)||void 0===a?void 0:a.buckets}}}}getName(){return this.column[0].getValueConfig().label}getBaseLayer(e,t){var a,r,i;return{..."date_histogram"===(null===(a=t.buckets)||void 0===a?void 0:a.type)?X({columnName:ae,options:{params:{...t.buckets.params},sourceField:null!==(r=t.buckets.field)&&void 0!==r?r:e.timeFieldName}}):{},..."top_values"===(null===(i=t.breakdown)||void 0===i?void 0:i.type)?{...Z({columnName:te,field:null==t?void 0:t.breakdown.field,options:{...t.breakdown.params}})}:{}}}getLayer(e,t,a,r){var i,l,n,o,s,u;const c=[];"top_values"===(null===(i=this.layerConfig.options)||void 0===i||null===(l=i.breakdown)||void 0===l?void 0:l.type)&&c.push(te),"date_histogram"===(null===(n=this.layerConfig.options)||void 0===n||null===(o=n.buckets)||void 0===o?void 0:o.type)&&c.push(ae);const d={columnOrder:c,columns:{...this.getBaseLayer(null!==(s=this.layerConfig.dataView)&&void 0!==s?s:a,null!==(u=this.layerConfig.options)&&void 0!==u?u:{})}};return{[e]:this.column.reduce(((e,i,l)=>{var n;return{...e,...i.getData(`${t}_${l}`,e,null!==(n=this.layerConfig.dataView)&&void 0!==n?n:a,r)}}),d)}}getReference(e,t){var a;return J(null!==(a=this.layerConfig.dataView)&&void 0!==a?a:t,e)}getLayerConfig(e,t){var a,r,i,l,n,o;return{layerId:e,seriesType:null!==(a=null===(r=this.layerConfig.options)||void 0===r?void 0:r.seriesType)&&void 0!==a?a:"line",accessors:this.column.map(((e,a)=>`${t}_${a}`)),yConfig:this.layerConfig.data.map((({color:e},a)=>e?{forAccessor:`${t}_${a}`,color:e}:void 0)).filter(Y),layerType:"data",xAccessor:"date_histogram"===(null===(i=this.layerConfig.options)||void 0===i||null===(l=i.buckets)||void 0===l?void 0:l.type)?ae:void 0,splitAccessor:"top_values"===(null===(n=this.layerConfig.options)||void 0===n||null===(o=n.breakdown)||void 0===o?void 0:o.type)?te:void 0}}getDataView(){return this.layerConfig.dataView}}class StaticColumn{constructor(e){this.valueConfig=e}getValueConfig(){return this.valueConfig}getData(e,t){const{label:a,...r}=this.getValueConfig();return{linkToLayers:[],columnOrder:[...t.columnOrder,e],columns:{[e]:{label:null!=a?a:"Reference",dataType:"number",operationType:"static_value",isStaticValue:!0,isBucketed:!1,scale:"ratio",params:r,references:[],customLabel:!0}},sampling:1,incompleteColumns:{}}}}class xy_reference_lines_layer_XYReferenceLinesLayer{constructor(e){var t;W()(this,"column",void 0),W()(this,"layerConfig",void 0),this.column=e.data.map((e=>new StaticColumn(e))),this.layerConfig={...e,layerType:null!==(t=e.layerType)&&void 0!==t?t:"referenceLine"}}getName(){return this.column[0].getValueConfig().label}getLayer(e,t){return{[`${e}_reference`]:this.column.reduce(((e,a,r)=>({...e,...a.getData(`${t}_${r}_reference_column`,e)})),{columnOrder:[],columns:{}})}}getReference(e,t){var a;return J(null!==(a=this.layerConfig.dataView)&&void 0!==a?a:t,`${e}_reference`)}getLayerConfig(e,t){return{layerId:`${e}_reference`,layerType:"referenceLine",accessors:this.column.map(((e,a)=>`${t}_${a}_reference_column`)),yConfig:this.column.map(((e,a)=>({color:e.getValueConfig().color,forAccessor:`${t}_${a}_reference_column`,axisMode:"left",fill:e.getValueConfig().fill})))}}getDataView(){return this.layerConfig.dataView}}class data_view_cache_DataViewCache{constructor(e){W()(this,"cache",new Map),W()(this,"capacity",void 0),this.capacity=e,this.cache=new Map}static getInstance(e=10){return data_view_cache_DataViewCache.instance||(data_view_cache_DataViewCache.instance=new data_view_cache_DataViewCache(e)),data_view_cache_DataViewCache.instance}getSpec(e){var t;const a=null!==(t=e.id)&&void 0!==t?t:"lens_ad_hoc_default",r=this.cache.get(a);if(!r){const t=e.toSpec();return this.setSpec(a,t),t}return r}setSpec(e,t){if(this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}}W()(data_view_cache_DataViewCache,"instance",void 0);class lens_attributes_builder_LensAttributesBuilder{constructor(e){W()(this,"dataViewCache",void 0),this.lens=e,this.dataViewCache=data_view_cache_DataViewCache.getInstance()}build(){const{visualization:e}=this.lens;return{title:e.getTitle(),visualizationType:e.getVisualizationType(),references:e.getReferences(),state:{datasourceStates:{formBased:{layers:e.getLayers()}},internalReferences:e.getReferences(),filters:[],query:{language:"kuery",query:""},visualization:e.getVisualizationState(),adHocDataViews:(t=e.getDataViews().reduce(((e,t)=>({...e,...this.dataViewCache.getSpec(t)})),{}),{[null!==(a=t.id)&&void 0!==a?a:Q]:{...t}})}};var t,a}}class painless_tinymath_parser_PainlessTinyMathParser{constructor({equation:e,aggMap:t}){return W()(this,"IF","?"),W()(this,"ELSE",":"),W()(this,"AND","&"),W()(this,"OR","|"),W()(this,"NOT_EQUAL","!="),W()(this,"NOT","!"),W()(this,"openParenthesesRegex",/^\(*/g),W()(this,"notRegex",/^\!/g),W()(this,"closeParenthesesRegex",/\)*$/g),W()(this,"logicalConditionRegex",/(\s*[|&]{2})/g),W()(this,"aggMap",{}),W()(this,"equation",""),this.aggMap=t||this.aggMap,this.equation=this.clean(e)||this.equation,this}clean(e){return e.replace(/(\s|\n)/g,"").replace("===","==").replace("!==","!=")}diveIntoString(e,t,a){const r=e.length;let i=0;for(let l=e.indexOf(t);l<r;l++){const n=e.charAt(l);if(n===t&&(i+=1),n===a&&(i-=1),0===i)return l;if(l===r-1&&0!==i)throw new Error("Invalid expression")}}replaceCharactersWithAggMap(e,t){return e.replace(/[A-Z]/g,(e=>t[e]||e))}parseCondition(e){return e.includes(this.AND)||e.includes(this.OR)||e.includes(this.NOT_EQUAL)?e.split(this.logicalConditionRegex).filter((e=>""!==e.trim()||e.includes(this.IF))).map((e=>{if(e.includes("||"))return e.replace("||","+").trim();if(e.includes("&&"))return e.replace("&&","*").trim();let t=!1;e.includes(this.NOT)&&(t=!0),e.includes(this.NOT_EQUAL)&&(e=e.replace("!=","=="));let a=e.replace(this.notRegex,"").replace(this.openParenthesesRegex,"").replace(this.closeParenthesesRegex,"").replace(this.NOT,"").trim();/^[A-Z]$/.test(a)&&(a+=" > 0");let r=`ifelse(${a},${t?"0,1":"1,0"})`;const i=e.match(this.openParenthesesRegex),l=e.match(this.closeParenthesesRegex);return i&&i.length>0&&l&&l.length>0||(i&&i.length>0&&(r=i[0]+r),l&&l.length>0&&(r+=l[0])),r})).join(" ")+" > 0":e}getTrueBranch(e){const t=this.diveIntoString(e,this.IF,this.ELSE);return void 0!==t?e.substring(e.indexOf(this.IF)+1,t):""}getFalseBrach(e){const t=this.diveIntoString(e,this.IF,this.ELSE);return void 0!==t?e.substring(t+1):""}getCondition(e){return e.substring(0,e.indexOf(this.IF))}parse(){const e=t=>{const a=this.parseCondition(this.getCondition(t)),r=this.getTrueBranch(t),i=this.getFalseBrach(t);let l=`ifelse(${a}, ${r}, ${i})`;if(r.includes(this.IF)){const t=e(r);l=l.replace(r,t)}if(i.includes(this.IF)){const t=e(i);l=l.replace(i,t)}return this.replaceCharactersWithAggMap(l,this.aggMap)};if(!this.equation||""===this.equation)throw new Error("Invalid Equation");return this.equation.includes(this.IF)?e(this.equation):this.replaceCharactersWithAggMap(this.equation,this.aggMap)}}const re=e=>e===h.a.AVERAGE?"average":e===h.a.CARDINALITY?"unique_count":e,ie=e=>(Math.ceil(1.1*(e||0)*100)/100).toFixed(2).toString();function le({metricExpression:e,dataView:t,filterQuery:a,groupBy:l,error:o}){const{services:{lens:c}}=Object(d.a)(),{euiTheme:m}=Object(n.useEuiTheme)(),{metrics:g,timeSize:p,timeUnit:f,threshold:y,comparator:v,equation:b}=e,[E,x]=Object(r.useState)(),[C,T]=Object(r.useState)(),[w,_]=Object(r.useState)(""),[F,O]=Object(r.useState)(),[S,k]=Object(r.useState)(!1),j=$()((()=>c.stateHelperApi()),[c]);return Object(r.useEffect)((()=>{setTimeout((function(){const e=document.querySelector(".lnsEmbeddedError");if(e){const t=e.querySelectorAll("p");if(!t||t.length<2)return;t[0].innerText=s.i18n.translate("xpack.observability.customThreshold.rule..charts.error_equation.title",{defaultMessage:"An error occurred while rendering the chart"}),t[1].innerText=s.i18n.translate("xpack.observability.customThreshold.rule..charts.error_equation.description",{defaultMessage:"Check the rule equation."})}}))}),[S,E]),Object(r.useEffect)((()=>{var e;if(!y)return;const t=[],a=Boolean(1===g.length&&(null===(e=g[0].field)||void 0===e?void 0:e.endsWith(".pct"))),r={id:a?"percent":"number",params:{decimals:a?0:2}};if(v===h.b.OUTSIDE_RANGE||v===h.b.BETWEEN&&2===y.length){const e=new xy_reference_lines_layer_XYReferenceLinesLayer({data:[{value:(y[0]||0).toString(),color:m.colors.danger,fill:v===h.b.OUTSIDE_RANGE?"below":"above",format:r}]}),a=new xy_reference_lines_layer_XYReferenceLinesLayer({data:[{value:(y[1]||0).toString(),color:m.colors.danger,fill:v===h.b.OUTSIDE_RANGE?"above":"below",format:r}]});t.push(e,a)}else{let e="above";v!==h.b.LT&&v!==h.b.LT_OR_EQ||(e="below");const a=new xy_reference_lines_layer_XYReferenceLinesLayer({data:[{value:(y[0]||0).toString(),color:m.colors.danger,fill:e,format:r}]}),i=new xy_reference_lines_layer_XYReferenceLinesLayer({data:[{value:ie(y[0]),color:"transparent",fill:e,format:r}]});t.push(a,i)}O(t)}),[y,v,m.colors.danger,g]),Object(r.useEffect)((()=>{if(!g||0===g.length)return;const e=g.reduce(((e,t)=>{const a=re(t.aggType);let r=t.field;t.aggType===h.a.COUNT&&(r="___records___");let i=`${a}(${r})`;return null!=t&&t.filter&&(i=`${a}(${r},kql='${JSON.stringify(t.filter).replace(/"|\\/g,"")}')`),{...e,[t.name]:i}}),{});T(e)}),[g]),Object(r.useEffect)((()=>{try{if(!C)return;const e=new painless_tinymath_parser_PainlessTinyMathParser({aggMap:C,equation:b||Object.keys(C||{}).join(" + ")});_(e.parse())}catch(e){return void x(void 0)}}),[C,b]),Object(r.useEffect)((()=>{var e;if(!j.value||!t||!w)return;const a=Boolean(1===g.length&&(null===(e=g[0].field)||void 0===e?void 0:e.endsWith(".pct"))),r={type:"formula",value:w,label:"Custom Threshold",groupBy:l,format:{id:a?"percent":"number",params:{decimals:a?0:2}}},i={buckets:{type:"date_histogram",params:{interval:`${p}${f}`}},seriesType:"bar"};l&&null!=l&&l.length&&(i.breakdown={type:"top_values",field:l[0],params:{size:3,secondaryFields:l.slice(1),accuracyMode:!1}});const n=[new xy_data_layer_XYDataLayer({data:[r].map((e=>({type:e.type,value:e.value,label:e.label,format:e.format}))),options:i})];F&&n.push(...F);const o={...new lens_attributes_builder_LensAttributesBuilder({visualization:new xy_chart_XYChart({visualOptions:{valueLabels:"hide",axisTitlesVisibilitySettings:{x:!0,yLeft:!1,yRight:!0}},layers:n,formulaAPI:j.value.formula,dataView:t})}).build(),type:"lens"};x(o)}),[v,t,b,a,w,j.value,l,g,y,F,p,f]),!t||!E||null!=o&&o.equation||0!==Object.keys((null==o?void 0:o.metrics)||{}).length||!p?i.a.createElement("div",{style:{maxHeight:180,minHeight:180}},i.a.createElement(n.EuiEmptyPrompt,{iconType:"visArea",titleSize:"xxs","data-test-subj":"thresholdRuleNoChartData",body:i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule..charts.noData.title",defaultMessage:"No chart data available, check the rule {errorSourceField}",values:{errorSourceField:0!==Object.keys((null==o?void 0:o.metrics)||{}).length?"aggregation fields":null!=o&&o.equation?"equation":"conditions"}})})):i.a.createElement("div",null,i.a.createElement(c.EmbeddableComponent,{onLoad:k,id:"customThresholdPreviewChart",style:{height:180},timeRange:{from:`now-${20*p}${f}`,to:"now"},attributes:E,disableTriggers:!0,query:{language:"kuery",query:a||""}}))}const ne=500,oe={comparator:h.b.GT,metrics:[{name:"A",aggType:h.a.COUNT}],threshold:[100],timeSize:1,timeUnit:"m"};function se(e){var t;const{setRuleParams:a,ruleParams:h,errors:m,metadata:g,onChangeMetaData:p}=e,{data:f,dataViews:y,dataViewEditor:v,docLinks:b,unifiedSearch:{ui:{SearchBar:E}}}=Object(d.a)().services,[x,C]=Object(r.useState)(1),[T,w]=Object(r.useState)("m"),[_,F]=Object(r.useState)(),[O,S]=Object(r.useState)(),[k,j]=Object(r.useState)(),[M,q]=Object(r.useState)(),R=Object(r.useMemo)((()=>({fields:(null==_?void 0:_.fields)||[],title:(null==_?void 0:_.getIndexPattern())||"unknown-index"})),[_]);Object(r.useEffect)((()=>{(async()=>{let e=h.searchConfiguration;if(!h.searchConfiguration||!h.searchConfiguration.index){const t=f.search.searchSource.createEmpty();t.setField("query",f.query.queryString.getDefaultQuery());const a=await f.dataViews.getDefaultDataView();a&&(t.setField("index",a),F(a)),e=t.getSerializedFields()}try{var t;const i=await f.search.searchSource.create(e);if(a("searchConfiguration",{...e,...(null===(t=h.searchConfiguration)||void 0===t?void 0:t.query)&&{query:h.searchConfiguration.query}}),j(i),F(i.getField("index")),i.getField("index")){var r;const e=null===(r=i.getField("index"))||void 0===r?void 0:r.timeFieldName;S(e?void 0:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.dataViewError.noTimestamp",{defaultMessage:"The selected data view does not have a timestamp field, please select another data view."}))}else S(void 0)}catch(e){q(e)}})()}),[f.search.searchSource,f.dataViews,_]),Object(r.useEffect)((()=>{h.criteria&&h.criteria.length?(C(h.criteria[0].timeSize),w(h.criteria[0].timeUnit)):a("criteria",[oe]),void 0===h.alertOnNoData&&a("alertOnNoData",!0),void 0===h.alertOnGroupDisappear&&a("alertOnGroupDisappear",!0)}),[g]);const L=Object(r.useCallback)((e=>{const t=(h.criteria?h.criteria.slice():[]).map((e=>{var t;return null===(t=e.metrics)||void 0===t||t.forEach((e=>{e.field=void 0})),e}));a("criteria",t),null==k||k.setParent(void 0).setField("index",e),a("searchConfiguration",null==k?void 0:k.getSerializedFields()),F(e)}),[h.criteria,k,a]),V=Object(r.useCallback)(((e,t)=>{const r=h.criteria?h.criteria.slice():[];r[e]=t,a("criteria",r)}),[a,h.criteria]),A=Object(r.useCallback)((()=>{var e;const t=(null===(e=h.criteria)||void 0===e?void 0:e.slice())||[];t.push({...oe,timeSize:null!=x?x:oe.timeSize,timeUnit:null!=T?T:oe.timeUnit}),a("criteria",t)}),[a,h.criteria,x,T]),D=Object(r.useCallback)((e=>{var t;const r=(null===(t=h.criteria)||void 0===t?void 0:t.filter(((t,a)=>a!==e)))||[];a("criteria",r)}),[a,h.criteria]),B=Object(r.useCallback)((({query:e})=>{a("searchConfiguration",{...h.searchConfiguration,query:e})}),[a,h.searchConfiguration]),z=Object(r.useCallback)(Object(l.debounce)(B,ne),[B]),P=Object(r.useCallback)((e=>{a("groupBy",e&&e.length?e:"")}),[a]),$=Object(r.useMemo)((()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]})),[]),G=Object(r.useCallback)((e=>{var t;const r=(null===(t=h.criteria)||void 0===t?void 0:t.map((t=>({...t,timeSize:e}))))||[];C(e||void 0),a("criteria",r)}),[h.criteria,a]),W=Object(r.useCallback)((e=>{var t;const r=(null===(t=h.criteria)||void 0===t?void 0:t.map((t=>({...t,timeUnit:e}))))||[];w(e),a("criteria",r)}),[h.criteria,a]),U=Object(r.useMemo)((()=>h.groupBy&&h.groupBy.length>0),[h.groupBy]),Q=Object(r.useMemo)((()=>h.groupBy?(Array.isArray(h.groupBy)?h.groupBy:[h.groupBy]).map((e=>({groupName:e,pattern:new RegExp(`{"match(_phrase)?":{"${e}":"(.*?)"}}`)}))):null),[h.groupBy]),H=Object(r.useMemo)((()=>{const{filterQuery:e}=h;return"string"==typeof e&&Q?Q.map((({groupName:t,pattern:a})=>{if(a.test(e))return t})).filter((e=>"string"==typeof e)):[]}),[h,Q]);if(M)return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiCallOut,{color:"danger",iconType:"warning","data-test-subj":"thresholdRuleExpressionError"},i.a.createElement("p",null,M.message)),i.a.createElement(n.EuiSpacer,{size:"m"}));if(!k)return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiEmptyPrompt,{title:i.a.createElement(n.EuiLoadingSpinner,{size:"xl"})}),i.a.createElement(n.EuiSpacer,{size:"m"}));const Y=s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.searchBar.placeholder",{defaultMessage:"Search for observability data… (e.g. host.name:host-1)"});return i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiTitle,{size:"xs"},i.a.createElement("h5",null,i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.selectDataViewPrompt",defaultMessage:"Select a data view"}))),i.a.createElement(n.EuiSpacer,{size:"s"}),i.a.createElement(o.DataViewSelectPopover,{dependencies:{dataViews:y,dataViewEditor:v},dataView:_,metadata:{adHocDataViewList:(null==g?void 0:g.adHocDataViewList)||[]},onSelectDataView:L,onChangeMetaData:({adHocDataViewList:e})=>{p({...g,adHocDataViewList:e})}}),O&&i.a.createElement(n.EuiFormErrorText,{"data-test-subj":"thresholdRuleDataViewErrorNoTimestamp"},O),i.a.createElement(n.EuiSpacer,{size:"l"}),i.a.createElement(n.EuiTitle,{size:"xs"},i.a.createElement("h5",null,i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.defineTextQueryPrompt",defaultMessage:"Define query filter (optional)"}))),i.a.createElement(n.EuiSpacer,{size:"s"}),i.a.createElement(E,{appName:"Custom threshold rule",iconType:"search",placeholder:Y,indexPatterns:_?[_]:void 0,showQueryInput:!0,showQueryMenu:!1,showFilterBar:!1,showDatePicker:!1,showSubmitButton:!1,displayStyle:"inPage",onQueryChange:z,onQuerySubmit:B,dataTestSubj:"thresholdRuleUnifiedSearchBar",query:null===(t=h.searchConfiguration)||void 0===t?void 0:t.query}),m.filterQuery&&i.a.createElement(n.EuiFormErrorText,{"data-test-subj":"thresholdRuleDataViewErrorNoTimestamp"},m.filterQuery),i.a.createElement(n.EuiSpacer,{size:"l"}),h.criteria&&h.criteria.map(((e,t)=>{var a,r;return i.a.createElement("div",{key:t},t>0&&i.a.createElement(n.EuiHorizontalRule,{margin:"s"}),i.a.createElement(I,{canDelete:h.criteria&&h.criteria.length>1||!1,fields:R.fields,remove:D,addExpression:A,key:t,expressionId:t,setRuleParams:V,errors:m[t]||$,expression:e||{},dataView:R,title:1===h.criteria.length?i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.setConditions",defaultMessage:"Set rule conditions"}):i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.condition",defaultMessage:"Condition {conditionNumber}",values:{conditionNumber:t+1}})},i.a.createElement(le,{metricExpression:e,dataView:_,filterQuery:null===(a=h.searchConfiguration)||void 0===a||null===(r=a.query)||void 0===r?void 0:r.query,groupBy:h.groupBy,error:m[t]||$})))})),i.a.createElement(c.ForLastExpression,{timeWindowSize:x,timeWindowUnit:T,errors:$,onChangeWindowSize:G,onChangeWindowUnit:W,display:"fullWidth"}),i.a.createElement(n.EuiSpacer,{size:"m"}),i.a.createElement("div",null,i.a.createElement(n.EuiButtonEmpty,{"data-test-subj":"thresholdRuleExpressionsAddConditionButton",color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:A},i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.addCondition",defaultMessage:"Add condition"}))),i.a.createElement(n.EuiSpacer,{size:"m"}),i.a.createElement(n.EuiFormRow,{label:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.createAlertPerText",{defaultMessage:"Group alerts by (optional)"}),helpText:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.createAlertPerHelpText",{defaultMessage:'Create an alert for every unique value. For example: "host.id" or "cloud.region".'}),fullWidth:!0,display:"rowCompressed"},i.a.createElement(N,{onChange:P,fields:R.fields,options:{groupBy:h.groupBy||null},errorOptions:H})),H.length>0&&i.a.createElement(i.a.Fragment,null,i.a.createElement(n.EuiSpacer,{size:"s"}),i.a.createElement(n.EuiText,{size:"xs",color:"danger"},i.a.createElement(u.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertFlyout.alertPerRedundantFilterError",defaultMessage:"This rule may alert on {matchedGroups} less than expected, because the filter query contains a match for {groupCount, plural, one {this field} other {these fields}}. For more information, refer to {filteringAndGroupingLink}.",values:{matchedGroups:i.a.createElement("strong",null,H.join(", ")),groupCount:H.length,filteringAndGroupingLink:i.a.createElement(n.EuiLink,{"data-test-subj":"thresholdRuleExpressionsTheDocsLink",href:`${b.links.observability.metricsThreshold}#filtering-and-grouping`},s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.alertPerRedundantFilterError.docsLink",{defaultMessage:"the docs"}))}}))),i.a.createElement(n.EuiSpacer,{size:"s"}),i.a.createElement(n.EuiCheckbox,{id:"metrics-alert-group-disappear-toggle",label:i.a.createElement(i.a.Fragment,null,s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.alertOnGroupDisappear",{defaultMessage:"Alert me if a group stops reporting data"})," ",i.a.createElement(n.EuiToolTip,{content:s.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.groupDisappearHelpText",{defaultMessage:"Enable this to trigger the action if a previously detected group begins to report no results. This is not recommended for dynamically scaling infrastructures that may rapidly start and stop nodes automatically."})},i.a.createElement(n.EuiIcon,{type:"questionInCircle",color:"subdued"}))),disabled:!U,checked:Boolean(U&&h.alertOnGroupDisappear),onChange:e=>a("alertOnGroupDisappear",e.target.checked)}),i.a.createElement(n.EuiSpacer,{size:"m"}))}}}]);