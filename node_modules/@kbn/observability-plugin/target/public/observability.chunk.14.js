/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observability_bundle_jsonpfunction=window.observability_bundle_jsonpfunction||[]).push([[14],{113:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pipeable=t.pipe=void 0;var n=r(132);t.pipe=n.pipe;t.pipeable=function(e){var t={};return function(e){return"function"==typeof e.map}(e)&&(t.map=function(t){return function(r){return e.map(r,t)}}),function(e){return"function"==typeof e.contramap}(e)&&(t.contramap=function(t){return function(r){return e.contramap(r,t)}}),function(e){return"function"==typeof e.mapWithIndex}(e)&&(t.mapWithIndex=function(t){return function(r){return e.mapWithIndex(r,t)}}),function(e){return"function"==typeof e.ap}(e)&&(t.ap=function(t){return function(r){return e.ap(r,t)}},t.apFirst=function(t){return function(r){return e.ap(e.map(r,(function(e){return function(){return e}})),t)}},t.apSecond=function(t){return function(r){return e.ap(e.map(r,(function(){return function(e){return e}})),t)}}),function(e){return"function"==typeof e.chain}(e)&&(t.chain=function(t){return function(r){return e.chain(r,t)}},t.chainFirst=function(t){return function(r){return e.chain(r,(function(r){return e.map(t(r),(function(){return r}))}))}},t.flatten=function(t){return e.chain(t,n.identity)}),function(e){return"function"==typeof e.bimap}(e)&&(t.bimap=function(t,r){return function(n){return e.bimap(n,t,r)}},t.mapLeft=function(t){return function(r){return e.mapLeft(r,t)}}),function(e){return"function"==typeof e.extend}(e)&&(t.extend=function(t){return function(r){return e.extend(r,t)}},t.duplicate=function(t){return e.extend(t,n.identity)}),function(e){return"function"==typeof e.reduce}(e)&&(t.reduce=function(t,r){return function(n){return e.reduce(n,t,r)}},t.foldMap=function(t){var r=e.foldMap(t);return function(e){return function(t){return r(t,e)}}},t.reduceRight=function(t,r){return function(n){return e.reduceRight(n,t,r)}}),function(e){return"function"==typeof e.reduceWithIndex}(e)&&(t.reduceWithIndex=function(t,r){return function(n){return e.reduceWithIndex(n,t,r)}},t.foldMapWithIndex=function(t){var r=e.foldMapWithIndex(t);return function(e){return function(t){return r(t,e)}}},t.reduceRightWithIndex=function(t,r){return function(n){return e.reduceRightWithIndex(n,t,r)}}),function(e){return"function"==typeof e.alt}(e)&&(t.alt=function(t){return function(r){return e.alt(r,t)}}),function(e){return"function"==typeof e.compact}(e)&&(t.compact=e.compact,t.separate=e.separate),function(e){return"function"==typeof e.filter}(e)&&(t.filter=function(t){return function(r){return e.filter(r,t)}},t.filterMap=function(t){return function(r){return e.filterMap(r,t)}},t.partition=function(t){return function(r){return e.partition(r,t)}},t.partitionMap=function(t){return function(r){return e.partitionMap(r,t)}}),function(e){return"function"==typeof e.filterWithIndex}(e)&&(t.filterWithIndex=function(t){return function(r){return e.filterWithIndex(r,t)}},t.filterMapWithIndex=function(t){return function(r){return e.filterMapWithIndex(r,t)}},t.partitionWithIndex=function(t){return function(r){return e.partitionWithIndex(r,t)}},t.partitionMapWithIndex=function(t){return function(r){return e.partitionMapWithIndex(r,t)}}),function(e){return"function"==typeof e.promap}(e)&&(t.promap=function(t,r){return function(n){return e.promap(n,t,r)}}),function(e){return"function"==typeof e.compose}(e)&&(t.compose=function(t){return function(r){return e.compose(r,t)}}),function(e){return"function"==typeof e.throwError}(e)&&(t.fromOption=function(t){return function(r){return"None"===r._tag?e.throwError(t()):e.of(r.value)}},t.fromEither=function(t){return"Left"===t._tag?e.throwError(t.left):e.of(t.right)},t.fromPredicate=function(t,r){return function(n){return t(n)?e.of(n):e.throwError(r(n))}},t.filterOrElse=function(t,r){return function(n){return e.chain(n,(function(n){return t(n)?e.of(n):e.throwError(r(n))}))}}),t}},114:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n="/internal/rac/alerts"},135:function(e,t,r){"use strict";r.d(t,"c",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return s}));var n=r(0);const a=n.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.equationHelpMessage",{defaultMessage:"Supports basic math equations, valid charaters are: A-Z, +, -, /, *, (, ), ?, !, &, :, |, >, <, ="}),i=n.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.labelLabel",{defaultMessage:"Label (optional)"}),o=n.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.labelHelpMessage",{defaultMessage:"Custom label will show on the alert chart and in reason"}),l=n.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquation",{defaultMessage:"Custom equation"}),s=n.i18n.translate("xpack.observability.customThreshold.rule.alertFlyout.customEquationEditor.deleteRowButton",{defaultMessage:"Delete"})},153:function(e,t,r){"use strict";r(138);var n=r(114);r.d(t,"a",(function(){return n.a}))},224:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return De}));var n=r(6),a=r.n(n),i=r(0),o=r(43),l=r(1),s=r.n(l),c=r(12),u=r(4),m=r(80),d=r(77);const f=i.i18n.translate("observabilityAlertDetails.alertAnnotation.detailsTooltip",{defaultMessage:"Alert started"});function p({alertStart:e,color:t,dateFormat:r,id:n}){return Object(d.jsx)(m.LineAnnotation,{id:n,domainType:m.AnnotationDomainType.XDomain,dataValues:[{dataValue:e,header:a()(e).format(r),details:f}],style:{line:{strokeWidth:3,stroke:t,opacity:1}},marker:Object(d.jsx)(c.EuiIcon,{type:"warning",color:t}),markerPosition:m.Position.Top})}const h=i.i18n.translate("observabilityAlertDetails.alertActiveTimeRangeAnnotation.detailsTooltip",{defaultMessage:"Active"});function b({alertStart:e,alertEnd:t,color:r,id:n}){return Object(d.jsx)(m.RectAnnotation,{id:n,dataValues:[{coordinates:{y0:0,x0:e,x1:t},details:h}],style:{fill:r,opacity:.1}})}i.i18n.translate("observabilityAlertDetails.alertThresholdTimeRangeRect.detailsTooltip",{defaultMessage:"Threshold"}),i.i18n.translate("observabilityAlertDetails.alertThresholdAnnotation.detailsTooltip",{defaultMessage:"Alert started"}),r(153);var y=r(78),g=r(60),v=r(45),E=r(42);const T=e=>Number(e).toLocaleString("en",{maximumFractionDigits:1});let x;!function(e){e.bytesDecimal="bytesDecimal",e.bitsDecimal="bitsDecimal",e.abbreviatedNumber="abbreviatedNumber"}(x||(x={}));const j={[x.bytesDecimal]:["B","kB","MB","GB","TB","PB","EB","ZB","YB"],[x.bitsDecimal]:["bit","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],[x.abbreviatedNumber]:["","K","M","B","T"]},k={[x.bytesDecimal]:1e3,[x.bitsDecimal]:1e3,[x.abbreviatedNumber]:1e3},O=e=>t=>{const r=j[e],n=k[e],a=e===x.bitsDecimal?8*t:t,i=Math.min(Math.floor(Math.log(Math.abs(a))/Math.log(n)),r.length-1);return i<0?`${T(a)} ${r[0]}`:`${T(a/Math.pow(n,i))} ${r[i]}`},w={number:T,abbreviatedNumber:O(x.abbreviatedNumber),bytes:O(x.bytesDecimal),bits:O(x.bitsDecimal),percent:e=>`${T(100*e)}%`,highPrecision:e=>Number(e).toLocaleString("en",{maximumFractionDigits:5})},M=(e,t="{{value}}")=>r=>{if(null==r)return"";const n=(0,w[e])(Number(r));return t.replace(/{{value}}/g,n)},A=(e,t="")=>{const r=i.i18n.translate("xpack.observability.customThreshold.rule.alerting.noDataFormattedValue",{defaultMessage:"[NO DATA]"}),n=t.endsWith(".pct")?M("percent"):M("highPrecision");return null==e?r:n(e)};var S=r(91),F=r(55),L=r(16);let I;!function(e){e.color0="color0",e.color1="color1",e.color2="color2",e.color3="color3",e.color4="color4",e.color5="color5",e.color6="color6",e.color7="color7",e.color8="color8",e.color9="color9"}(I||(I={}));const D=Object(c.euiPaletteColorBlind)(),$={[I.color0]:D[1],[I.color1]:D[2],[I.color2]:D[0],[I.color3]:D[3],[I.color4]:D[4],[I.color5]:D[5],[I.color6]:D[6],[I.color7]:D[7],[I.color8]:D[8],[I.color9]:D[9]},N=(_=$,e=>_[e]);var _,B=r(24),R=r.n(B);const W=e=>{if(1===e.length){const t=(e=>{if(e&&e.field){const t=Object(L.last)(e.field.split(/\./));if("pct"===t)return v.c.percent;if("bytes"===t)return v.c.bytes}return v.c.number})(e[0]);return M(t)}return e=>R()(e).format("0.[0000]")};var P=r(56),C=r.n(P),q=r(13),U=r(27);const z=(e,t,r=!0)=>{try{return e?JSON.stringify(Object(U.toElasticsearchQuery)(Object(U.fromKueryExpression)(e),t)):""}catch(e){if(r)return"";throw e}};var G=r(105),Q=r(132),V=r(113),H=r(20);const K=([e,...t])=>{if(void 0===e)return[];if(e.type instanceof H.IntersectionType){const[,...e]=t;return K(e)}if(e.type instanceof H.UnionType){const[,...r]=t;return[e.key,...K(r)]}return[e.key,...K(t)]},Y=e=>new Error(e),Z=(e,t=Y)=>r=>Object(V.pipe)(e.decode(r),Object(G.fold)((e=>t=>{throw e((e=>`Failed to validate: \n${e.map((e=>`  ${(e=>{var t;return null!==(t=e.message)&&void 0!==t?t:`in ${K(e.context).join("/")}: ${JSON.stringify(e.value)} does not match expected type ${(({context:e})=>{var t,r,n;return null!==(t=null===(r=e[e.length-1])||void 0===r||null===(n=r.type)||void 0===n?void 0:n.name)&&void 0!==t?t:"unknown"})(e)}`})(e)}`)).join("\n")}`)(t))})(t),Q.identity)),J=(H.type({fromTimestamp:H.number,toTimestamp:H.number,interval:H.string,timeFieldName:H.string}),H.intersection([H.type({name:H.string,aggregation:v.e}),H.partial({field:H.string,filter:H.string})])),X=H.intersection([H.type({aggregation:H.string}),H.partial({field:H.union([H.string,H[void 0]]),custom_metrics:H.array(J),equation:H.string})]),ee=(H.intersection([H.type({aggregation:H.string,metrics:H.array(X)}),H.partial({limit:H.number,groupBy:H.union([H.string,H.array(H.string)]),filterQuery:H.string,source:H.string,forceInterval:H.boolean,dropLastBucket:H.boolean})]),H.type({from:H.number,to:H.number,interval:H.string}),H.record(H.string,H.union([H.string,H.null]))),te=H.type({total:H.number,afterKey:H.union([H.string,H.null,ee])}),re=H.keyof({date:null,number:null,string:null}),ne=H.type({name:H.string,type:re}),ae=H.intersection([H.type({timestamp:H.number}),H.record(H.string,H.union([H.string,H.number,H.null,H[void 0],H.array(H.object)]))]),ie=H.intersection([H.type({id:H.string,columns:H.array(ne),rows:H.array(ae)}),H.partial({keys:H.array(H.string)})]),oe=H.type({series:H.array(ie),pageInfo:te}),le={},se=(e,t,r,n,a=le,i="@timestamp")=>{const{timeSize:o,timeUnit:s}=e||{timeSize:1,timeUnit:"m"};return function(e,t,{fromTimestamp:r,toTimestamp:n,interval:a,timeFieldName:i},o=!0){const{http:l}=Object(q.useKibana)().services,{isLoading:s,data:c,error:u,refetch:m,fetchNextPage:d}=Object(y.useInfiniteQuery)({queryKey:["metricExplorer",e,r,n,t.title],queryFn:async({signal:o,pageParam:s={afterKey:null}})=>{if(!r||!n)throw new Error("Unable to parse timerange");if(!l)throw new Error("HTTP service is unavailable");if(!t.title)throw new Error("Data view is unavailable");const{afterKey:c}=s,u=await l.post("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify({forceInterval:e.forceInterval,dropLastBucket:null==e.dropLastBucket||e.dropLastBucket,metrics:e.metrics,groupBy:e.groupBy,afterKey:c,limit:e.limit,indexPattern:t.title,filterQuery:e.filterQuery&&z(e.filterQuery,t)||void 0,timerange:{interval:a,timeFieldName:i,from:r,to:n}}),signal:o});return Z(oe)(u)},getNextPageParam:e=>e.pageInfo,enabled:o&&!!r&&!!n&&!!l&&!!t.title,refetchOnWindowFocus:!1});return{data:c,error:u,fetchNextPage:d,isLoading:s,refetch:m}}(Object(l.useMemo)((()=>{var t,a;return{limit:1,forceInterval:!0,dropLastBucket:!1,groupBy:n,filterQuery:r,metrics:[{aggregation:"custom",custom_metrics:null!==(t=null==e||null===(a=e.metrics)||void 0===a?void 0:a.map(ce))&&void 0!==t?t:[],equation:e.equation}],aggregation:"custom"}}),[e.equation,JSON.stringify(e.metrics),r,n]),t,Object(l.useMemo)((()=>{var e,t;const r=null!==(e=a.from)&&void 0!==e?e:`now-${20*(o||1)}${s}`,n=null!==(t=a.to)&&void 0!==t?t:"now",l=C.a.parse(r).valueOf(),c=C.a.parse(n,{roundUp:!0}).valueOf();return{interval:`>=${o||1}${s}`,fromTimestamp:l,toTimestamp:c,timeFieldName:i}}),[a.from,a.to,o,s,i]))},ce=e=>"count"===e.aggType?{name:e.name,aggregation:v.a.COUNT,filter:e.filter}:{name:e.name,aggregation:e.aggType,field:e.field},ue={s:i.i18n.translate("xpack.observability.customThreshold.rule..timeLabels.seconds",{defaultMessage:"seconds"}),m:i.i18n.translate("xpack.observability.customThreshold.rule..timeLabels.minutes",{defaultMessage:"minutes"}),h:i.i18n.translate("xpack.observability.customThreshold.rule..timeLabels.hours",{defaultMessage:"hours"}),d:i.i18n.translate("xpack.observability.customThreshold.rule..timeLabels.days",{defaultMessage:"days"})},me=e=>e?m.DARK_THEME:m.LIGHT_THEME,de=({children:e})=>s.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),fe=({children:e})=>s.a.createElement("div",{style:{width:"100%",height:150}},e);function pe(){return s.a.createElement(de,null,s.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"thresholdRuleNoChartData"},s.a.createElement(o.FormattedMessage,{id:"xpack.observability.customThreshold.rule..charts.noDataMessage",defaultMessage:"No chart data available"})))}function he(){return s.a.createElement(de,null,s.a.createElement(c.EuiText,{color:"subdued","data-test-subj":"thresholdRuleLoadingData"},s.a.createElement(c.EuiLoadingChart,{size:"m"})))}const be=.3;function ye({threshold:e,sortedThresholds:t,comparator:r,color:n,id:a,firstTimestamp:i,lastTimestamp:o,domain:l}){if(!r||!e)return null;const c=[v.b.GT,v.b.GT_OR_EQ].includes(r),u=[v.b.LT,v.b.LT_OR_EQ].includes(r);return s.a.createElement(s.a.Fragment,null,s.a.createElement(m.LineAnnotation,{id:`${a}-thresholds`,domainType:m.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:t.map((e=>({dataValue:e}))),style:{line:{strokeWidth:2,stroke:N(n),opacity:1}}}),2===t.length&&r===v.b.BETWEEN?s.a.createElement(s.a.Fragment,null,s.a.createElement(m.RectAnnotation,{id:`${a}-lower-threshold`,"data-test-subj":"between-rect",style:{fill:N(n),opacity:be},dataValues:[{coordinates:{x0:i,x1:o,y0:Object(L.first)(e),y1:Object(L.last)(e)}}]})):null,2===t.length&&r===v.b.OUTSIDE_RANGE?s.a.createElement(s.a.Fragment,null,s.a.createElement(m.RectAnnotation,{id:`${a}-lower-threshold`,"data-test-subj":"outside-range-lower-rect",style:{fill:N(n),opacity:be},dataValues:[{coordinates:{x0:i,x1:o,y0:l.min,y1:Object(L.first)(e)}}]}),s.a.createElement(m.RectAnnotation,{id:`${a}-upper-threshold`,"data-test-subj":"outside-range-upper-rect",style:{fill:N(n),opacity:be},dataValues:[{coordinates:{x0:i,x1:o,y0:Object(L.last)(e),y1:l.max}}]})):null,u&&null!=Object(L.first)(e)?s.a.createElement(m.RectAnnotation,{id:`${a}-upper-threshold`,"data-test-subj":"below-rect",style:{fill:N(n),opacity:be},dataValues:[{coordinates:{x0:i,x1:o,y0:l.min,y1:Object(L.first)(e)}}]}):null,c&&null!=Object(L.first)(e)?s.a.createElement(m.RectAnnotation,{id:`${a}-upper-threshold`,"data-test-subj":"above-rect",style:{fill:N(n),opacity:be},dataValues:[{coordinates:{x0:i,x1:o,y0:Object(L.first)(e),y1:l.max}}]}):null)}var ge=r(135);const ve=e=>{const t=Object(L.min)(e);return Object(L.isNumber)(t)&&Number.isFinite(t)?t:void 0},Ee=e=>{const t=Object(L.max)(e);return Object(L.isNumber)(t)&&Number.isFinite(t)?t:void 0},Te=e=>{const t=e.rows.map((e=>e.metric_0)).filter((e=>Object(L.isNumber)(e)));return{min:ve(t)||0,max:Ee(t)||0}};var xe=r(33),je=r.n(xe);function ke(){const[e]=Object(q.useUiSetting$)(F.UI_SETTINGS.DATEFORMAT_TZ);return e&&"Browser"!==e?e:je.a.tz.guess()}function Oe(e){return v.d.bar===e.type?s.a.createElement(Me,e):s.a.createElement(we,e)}function we({name:e,color:t,id:r,series:n,type:a,stack:i,opacity:o}){const l=ke(),c=t&&N(t)||N(I.color0),u=Array.isArray(r)?r.map((e=>`metric_${e}`)).slice(r.length-1,r.length):[`metric_${r}`],d=Array.isArray(r)&&r.length>1?r.map((e=>`metric_${e}`)).slice(0,1):void 0,f=`series-${n.id}-${u.join("-")}`,p={line:{strokeWidth:2,visible:!0},area:{opacity:o||.5,visible:a===v.d.area}};return s.a.createElement(m.AreaSeries,{id:f,key:f,name:e,xScaleType:m.ScaleType.Time,yScaleType:m.ScaleType.Linear,xAccessor:"timestamp",yAccessors:u,y0Accessors:d,data:n.rows,stackAccessors:i?["timestamp"]:void 0,areaSeriesStyle:p,color:c,timeZone:l})}function Me({name:e,color:t,id:r,series:n,stack:a}){const i=ke(),o=t&&N(t)||N(I.color0),l=Array.isArray(r)?r.map((e=>`metric_${e}`)).slice(r.length-1,r.length):[`metric_${r}`],c=`series-${n.id}-${l.join("-")}`,u={rectBorder:{stroke:o,strokeWidth:1,visible:!0},rect:{opacity:1}};return s.a.createElement(m.BarSeries,{id:c,key:c,name:e,xScaleType:m.ScaleType.Time,yScaleType:m.ScaleType.Linear,xAccessor:"timestamp",yAccessors:l,data:n.rows,stackAccessors:a?["timestamp"]:void 0,barSeriesStyle:u,color:o,timeZone:i})}function Ae({expression:e,derivedIndexPattern:t,annotations:r,chartType:n=v.d.bar,filterQuery:u,groupBy:d,hideTitle:f=!1,timeRange:p,timeFieldName:h}){var b,y;const{charts:g,uiSettings:T}=Object(E.a)().services,{isLoading:x,data:j}=se(e,t,u,d,p,h),k=Object(l.useRef)(null),O=Object(S.useActiveCursor)(g.activeCursor,k,{isDateHistogram:!0});if(x)return s.a.createElement(he,null);if(!j)return s.a.createElement(pe,null);const w=(null==T?void 0:T.get("theme:darkMode"))||!1,M=Object(L.first)(Object(L.first)(j.pages).series);if(!M||!M.rows||0===M.rows.length)return s.a.createElement(pe,null);const A=Object(L.first)(M.rows).timestamp,D=Object(L.last)(M.rows).timestamp,$=e.label||ge.a,N=null==A||null==D?e=>`${e}`:Object(m.niceTimeFormatter)([A,D]),_=e.threshold.slice().sort(),B=null!==(b=null===(y=e.warningThreshold)||void 0===y?void 0:y.slice().sort())&&void 0!==b?b:[],R=[..._,...B].sort(),P={...M,rows:M.rows.map((e=>{const t={...e};return R.forEach(((e,r)=>{t[`metric_threshold_${r}`]=e})),t}))},C=Te(P),q={max:1.1*Math.max(C.max,Object(L.last)(R)||C.max),min:.9*Math.min(C.min,Object(L.first)(R)||C.min)};q.min===Object(L.first)(e.threshold)&&(q.min=.9*q.min);const{timeSize:U,timeUnit:z}=e,G=ue[z];return s.a.createElement(s.a.Fragment,null,s.a.createElement(fe,null,s.a.createElement(m.Chart,{ref:k},s.a.createElement(Oe,{type:n,name:$,color:I.color0,id:"0",series:P,stack:!1}),s.a.createElement(ye,{comparator:e.comparator,threshold:e.threshold,sortedThresholds:_,color:I.color1,id:"critical",firstTimestamp:A,lastTimestamp:D,domain:q}),e.warningComparator&&e.warningThreshold&&s.a.createElement(ye,{comparator:e.warningComparator,threshold:e.warningThreshold,sortedThresholds:B,color:I.color5,id:"warning",firstTimestamp:A,lastTimestamp:D,domain:q}),r,s.a.createElement(m.Axis,{id:"timestamp",position:m.Position.Bottom,showOverlappingTicks:!0,tickFormat:N}),s.a.createElement(m.Axis,{id:"values",position:m.Position.Left,tickFormat:W(e.metrics),domain:q}),s.a.createElement(m.Tooltip,{headerFormatter:({value:e})=>a()(e).format(T.get(F.UI_SETTINGS.DATE_FORMAT))}),s.a.createElement(m.Settings,{onPointerUpdate:O,externalPointerEvents:{tooltip:{visible:!0}},theme:me(w),locale:i.i18n.getLocale()}))),!f&&s.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==P.id?s.a.createElement(c.EuiText,{size:"xs",color:"subdued"},s.a.createElement(o.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:P.id,timeLabel:G,lookback:20*U}})):s.a.createElement(c.EuiText,{size:"xs",color:"subdued"},s.a.createElement(o.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:G,lookback:20*U}}))))}function Se({chartProps:{theme:e,baseTheme:t},comparator:r,id:n,threshold:a,title:o,value:l,valueFormatter:u}){const d=Object(c.useEuiBackgroundColor)("danger");return s.a.createElement(c.EuiPanel,{paddingSize:"none",style:{height:"100%",overflow:"hidden",position:"relative",minWidth:"100%"},hasShadow:!1,"data-test-subj":`thresholdRule-${a.join("-")}-${l}`},s.a.createElement(m.Chart,null,s.a.createElement(m.Settings,{theme:e,baseTheme:t,locale:i.i18n.getLocale()}),s.a.createElement(m.Metric,{id:n,data:[[{title:o,extra:s.a.createElement("span",null,i.i18n.translate("xpack.observability.customThreshold.rule.thresholdExtraTitle",{values:{comparator:r,threshold:a.map((e=>u(e))).join(" - ")},defaultMessage:"Alert when {comparator} {threshold}"})),color:d,value:l,valueFormatter:u,icon:({width:e,height:t,color:r})=>s.a.createElement(c.EuiIcon,{width:e,height:t,color:r,type:"alert"})}]]})))}const Fe="YYYY-MM-DD HH:mm",Le="alert_start_annotation",Ie="alert_time_range_annotation";function De({alert:e,rule:t,ruleLink:r,setAlertSummaryFields:n}){const{uiSettings:m,charts:d,data:f}=Object(E.a)().services,{euiTheme:h}=Object(c.useEuiTheme)(),[y,T]=Object(l.useState)(),[,x]=Object(l.useState)(),j=t.params,k={theme:d.theme.useChartsTheme(),baseTheme:d.theme.useChartsBaseTheme()},O=Object(g.a)(e.fields[u.U],e.fields[u.e]),w=e.fields[u.e]?a()(e.fields[u.e]).valueOf():void 0,M=[s.a.createElement(p,{alertStart:e.start,color:h.colors.danger,dateFormat:m.get("dateFormat")||Fe,id:Le,key:Le}),s.a.createElement(b,{alertStart:e.start,alertEnd:w,color:h.colors.danger,id:Ie,key:Ie})];Object(l.useEffect)((()=>{n([{label:i.i18n.translate("xpack.observability.customThreshold.rule.alertDetailsAppSection.summaryField.rule",{defaultMessage:"Rule"}),value:s.a.createElement(c.EuiLink,{"data-test-subj":"thresholdRuleAlertDetailsAppSectionRuleLink",href:r},t.name)}])}),[e,t,r,n]);const S=Object(l.useMemo)((()=>({fields:(null==y?void 0:y.fields)||[],title:(null==y?void 0:y.getIndexPattern())||"unknown-index"})),[y]);return Object(l.useEffect)((()=>{(async()=>{const e=j.searchConfiguration;try{const t=await f.search.searchSource.create(e);T(t.getField("index"))}catch(e){x(e)}})()}),[f.search.searchSource]),j.criteria?s.a.createElement(c.EuiFlexGroup,{direction:"column","data-test-subj":"thresholdAlertOverviewSection"},j.criteria.map(((t,r)=>{var n,a;return s.a.createElement(c.EuiFlexItem,{key:`criterion-${r}`},s.a.createElement(c.EuiPanel,{hasBorder:!0,hasShadow:!1},s.a.createElement(c.EuiTitle,{size:"xs"},s.a.createElement("h4",null,t.label||"CUSTOM"," ")),s.a.createElement(c.EuiText,{size:"s",color:"subdued"},s.a.createElement(o.FormattedMessage,{id:"xpack.observability.customThreshold.rule.alertDetailsAppSection.criterion.subtitle",defaultMessage:"Last {lookback} {timeLabel}",values:{lookback:t.timeSize,timeLabel:ue[t.timeUnit]}})),s.a.createElement(c.EuiSpacer,{size:"s"}),s.a.createElement(c.EuiFlexGroup,null,s.a.createElement(c.EuiFlexItem,{style:{minHeight:150,minWidth:160},grow:1},s.a.createElement(Se,{chartProps:k,id:`threshold-${r}`,threshold:t.threshold,value:e.fields[u.h][r],valueFormatter:e=>A(e,t.metrics[0]?t.metrics[0].name:void 0),title:i.i18n.translate("xpack.observability.customThreshold.rule.alertDetailsAppSection.thresholdTitle",{defaultMessage:"Threshold breached"}),comparator:t.comparator})),s.a.createElement(c.EuiFlexItem,{grow:5},s.a.createElement(Ae,{annotations:M,chartType:v.d.line,derivedIndexPattern:S,expression:t,filterQuery:null===(n=j.searchConfiguration)||void 0===n||null===(a=n.query)||void 0===a?void 0:a.query,groupBy:j.groupBy,hideTitle:!0,timeRange:O})))))}))):null}}}]);