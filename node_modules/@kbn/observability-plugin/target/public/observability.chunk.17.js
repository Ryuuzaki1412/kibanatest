/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.observability_bundle_jsonpfunction=window.observability_bundle_jsonpfunction||[]).push([[17],{115:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return l}));var n=a(83);function r(e){const t=e.substring(0,e.length-1),a=e.substring(e.length-1);return{value:parseInt(t,10),unit:a}}function o(e){switch(e.unit){case"m":return e.value;case"h":return 60*e.value;case"d":return 24*e.value*60;case"w":return 7*e.value*24*60;case"M":return 30*e.value*24*60;default:Object(n.assertNever)(e.unit)}}function l(e){switch(e){default:case"w":return"isoWeek";case"M":return"months"}}},129:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(102),r=a(78),o=a(25),l=a(42),i=a(106);function u({sloId:e,instanceId:t,shouldRefetch:a}){const{http:u}=Object(l.a)().services,{isInitialLoading:s,isLoading:d,isError:c,isSuccess:b,isRefetching:h,data:m,refetch:g}=Object(r.useQuery)({queryKey:i.a.detail(e),queryFn:async({signal:a})=>{try{return await u.get(`/api/observability/slos/${e}`,{query:{...!!t&&t!==n.a&&{instanceId:t}},signal:a})}catch(e){}},keepPreviousData:!0,enabled:Boolean(e),refetchInterval:a?o.c:void 0,refetchOnWindowFocus:!1});return{data:m,isLoading:d,isInitialLoading:s,isRefetching:h,isSuccess:b,isError:c,refetch:g}}},143:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(78),r=a(42),o=a(106);function l({name:e="",includeOutdatedOnly:t=!1,page:a=1,perPage:l=100}){const{http:i}=Object(r.a)().services,u=e.endsWith("*")?e:`${e}*`,{isLoading:s,isError:d,isSuccess:c,data:b,refetch:h}=Object(n.useQuery)({queryKey:o.a.definitions(u,a,l,t),queryFn:async({signal:e})=>{try{return await i.get("/api/observability/slos/_definitions",{query:{search:u,includeOutdatedOnly:t,page:a,perPage:l},signal:e})}catch(e){throw new Error(`Something went wrong. Error: ${e}`)}},retry:!1,refetchOnWindowFocus:!1});return{isLoading:s,isError:d,isSuccess:c,data:b,refetch:h}}},226:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return z}));var n=a(1),r=a.n(n),o=a(102),l=a(12),i=a(0),u=a(129),s=a(16),d=a(143);function c({initialSlo:e,onSelected:t,errors:a}){const[o,u]=Object(n.useState)([]),[c,h]=Object(n.useState)(),[m,g]=Object(n.useState)(""),{isLoading:v,data:w}=Object(d.a)({name:m}),p=void 0!==a&&a.length>0;Object(n.useEffect)((()=>{h(e?[{value:e.id,label:e.name}]:[])}),[e]),Object(n.useEffect)((()=>{var e;const t=!v&&null!=w&&w.results?null==w||null===(e=w.results)||void 0===e?void 0:e.map((e=>({value:e.id,label:e.name}))):[];u(t)}),[v,w]);const f=Object(n.useMemo)((()=>Object(s.debounce)((e=>g(e)),300)),[]);return r.a.createElement(l.EuiFormRow,{label:b,fullWidth:!0,isInvalid:p,error:p?a[0]:void 0},r.a.createElement(l.EuiComboBox,{"aria-label":i.i18n.translate("xpack.observability.slo.rules.sloSelector.ariaLabel",{defaultMessage:"SLO"}),placeholder:i.i18n.translate("xpack.observability.slo.rules.sloSelector.placeholder",{defaultMessage:"Select a SLO"}),"data-test-subj":"sloSelector",singleSelection:{asPlainText:!0},options:o,selectedOptions:c,async:!0,isLoading:v,onChange:e=>{var a;h(e);const n=1===e.length?null==w||null===(a=w.results)||void 0===a?void 0:a.find((t=>t.id===e[0].value)):void 0;t(n)},fullWidth:!0,onSearchChange:f,isInvalid:p}))}const b=i.i18n.translate("xpack.observability.slo.rules.sloSelector.rowLabel",{defaultMessage:"SLO"});var h=a(65),m=a.n(h),g=a(24),v=a.n(g),w=a(94),p=a(43);function f({onChange:e,initialBurnRate:t=1,maxBurnRate:a,errors:o}){const[u,s]=Object(n.useState)(t),d=void 0!==o&&o.length>0,[c,b]=Object(n.useState)(u.toFixed(2));return r.a.createElement(l.EuiFormRow,{label:r.a.createElement(r.a.Fragment,null,i.i18n.translate("xpack.observability.slo.rules.burnRate.rowLabel",{defaultMessage:"Burn rate threshold"})," ",r.a.createElement(l.EuiIconTip,{position:"top",content:i.i18n.translate("xpack.observability.slo.rules.burnRate.tooltip",{defaultMessage:"The burn rate is how fast the service consumes the error budget over the lookback period."})})),fullWidth:!0,isInvalid:d},r.a.createElement(l.EuiFieldNumber,{fullWidth:!0,step:.01,min:.01,max:a,value:c,onChange:t=>{(t=>{const a=Number(t.target.value);s(a),e(a)})(t),b(t.target.value)},onBlur:e=>{const t=e.target.value;b(Number(t).toFixed(2))},"data-test-subj":"burnRate"}))}var E=a(115);function W({shortWindowDuration:e,initialDuration:t,onChange:a,errors:o}){var u;const[s,d]=Object(n.useState)(null!==(u=null==t?void 0:t.value)&&void 0!==u?u:1),c=void 0!==o&&o.length>0;return r.a.createElement(l.EuiFormRow,{label:x(e),fullWidth:!0,isInvalid:c},r.a.createElement(l.EuiFieldNumber,{isInvalid:c,min:1,max:72,step:1,value:String(s),onChange:e=>{const t=Number(e.target.value);d(t),a({value:t,unit:"h"})},"aria-label":i.i18n.translate("xpack.observability.slo.rules.longWindow.valueLabel",{defaultMessage:"Lookback period in hours"}),"data-test-subj":"durationValueInput"}))}const x=e=>r.a.createElement(r.a.Fragment,null,i.i18n.translate("xpack.observability.slo.rules.longWindow.rowLabel",{defaultMessage:"Lookback (hours)"})," ",r.a.createElement(l.EuiIconTip,{position:"top",content:y(e)})),y=e=>i.i18n.translate("xpack.observability.slo.rules.longWindowDuration.tooltip",{defaultMessage:"Lookback period over which the burn rate is computed. A shorter lookback period of {shortWindowDuration} minutes (1/12 the lookback period) will be used for faster recovery",values:{shortWindowDuration:Object(E.c)(e)}});var R=a(31);function T({onChange:e,initialBurnRate:t=1,longLookbackWindowInHours:a,sloTimeWindowInHours:o,errors:u}){const[s,d]=Object(n.useState)(t*a/o*100),[c,b]=Object(n.useState)(s.toFixed(2)),h=void 0!==u&&u.length>0;return r.a.createElement(l.EuiFormRow,{label:r.a.createElement(r.a.Fragment,null,i.i18n.translate("xpack.observability.slo.rules.budgetConsumed.rowLabel",{defaultMessage:"% Budget consumed"})," ",r.a.createElement(l.EuiIconTip,{position:"top",content:i.i18n.translate("xpack.observability.slo.rules.budgetConsumed.tooltip",{defaultMessage:"How much budget is consumed before the first alert is fired."})})),fullWidth:!0,isInvalid:h},r.a.createElement(l.EuiFieldNumber,{fullWidth:!0,step:.01,min:.01,max:100,value:c,onChange:t=>{(t=>{const n=Number(t.target.value);d(n),e(o*(n/100/a))})(t),b(t.target.value)},onBlur:e=>{const t=e.target.value;b(Number(t).toFixed(2))},"data-test-subj":"budgetConsumed"}))}const k=[{value:R.b.id,text:R.b.name},{value:R.d.id,text:R.d.name},{value:R.f.id,text:R.f.name},{value:R.e.id,text:R.e.name}],O=(e,t)=>t?Math.floor(Object(E.c)(Object(E.b)(t.timeWindow.duration))/Object(E.c)(e)):1/0;function j({slo:e,id:t,burnRateThreshold:a,maxBurnRateThreshold:n,longWindow:o,shortWindow:u,actionGroup:s,onChange:d,onDelete:c,errors:b,disableDelete:h,budgetMode:m=!0}){var g;const w=a=>{d({id:t,burnRateThreshold:a,maxBurnRateThreshold:O(o,e),longWindow:o,shortWindow:u,actionGroup:s})},p=Math.round(Object(E.c)(Object(E.b)(null!==(g=null==e?void 0:e.timeWindow.duration)&&void 0!==g?g:"30d"))/60),x=[...b.longWindow,...b.burnRateThreshold];return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiFlexGroup,{direction:"row",alignItems:"center"},r.a.createElement(l.EuiFlexItem,null,r.a.createElement(W,{initialDuration:o,shortWindowDuration:u,onChange:e=>{const r=Object(E.c)(e),o=Math.floor(r/12);d({id:t,burnRateThreshold:a,maxBurnRateThreshold:n,longWindow:e,shortWindow:{value:o,unit:"m"},actionGroup:s})},errors:b.longWindow})),!m&&r.a.createElement(l.EuiFlexItem,null,r.a.createElement(f,{initialBurnRate:a,maxBurnRate:n,onChange:w,errors:b.burnRateThreshold})),m&&r.a.createElement(l.EuiFlexItem,null,r.a.createElement(T,{initialBurnRate:a,onChange:w,errors:b.burnRateThreshold,sloTimeWindowInHours:p,longLookbackWindowInHours:o.value})),r.a.createElement(l.EuiFlexItem,null,r.a.createElement(l.EuiFormRow,{label:i.i18n.translate("xpack.observability.slo.rules.actionGroupSelectorLabel",{defaultMessage:"Action Group"})},r.a.createElement(l.EuiSelect,{"data-test-subj":"sloBurnRateActionGroupSelctor",options:k,value:s,onChange:e=>{d({id:t,burnRateThreshold:a,maxBurnRateThreshold:n,longWindow:o,shortWindow:u,actionGroup:e.currentTarget.value})},"aria-label":i.i18n.translate("xpack.observability.slo.rules.actionGroupSelectorLabel",{defaultMessage:"Action Group"})}))),r.a.createElement(l.EuiFlexItem,{grow:0},r.a.createElement(l.EuiButtonIcon,{"data-test-subj":"sloBurnRateRuleDeleteWindowButton",iconType:"trash",color:"danger",style:{marginBottom:"-1em"},onClick:()=>c(t),disabled:h,title:i.i18n.translate("xpack.observability.slo.rules.deleteWindowLabel",{defaultMessage:"Delete window"}),"aria-label":i.i18n.translate("xpack.observability.slo.rules.deleteWindowLabel",{defaultMessage:"Delete window"})}))),r.a.createElement(l.EuiSpacer,{size:"xs"}),x.length>0&&r.a.createElement(l.EuiText,{color:"danger",size:"xs"},x.map((e=>r.a.createElement("p",{key:e},e)))),r.a.createElement(l.EuiText,{color:"subdued",size:"xs"},r.a.createElement("p",null,S(e&&(null==o?void 0:o.value)>0&&a>=1?v()(o.value/(a*Object(E.c)(o)/Object(E.c)(Object(E.b)(e.timeWindow.duration)))).format("0a"):"N/A",e&&o.value>0&&a>0?a*o.value/p:0,a,m))),r.a.createElement(l.EuiSpacer,{size:"s"}))}const S=(e,t,a,n=!1)=>n?i.i18n.translate("xpack.observability.slo.rules.errorBudgetExhaustion.budgetMode.text",{defaultMessage:"{formatedHours} hours until error budget exhaustion. The burn rate threshold is {burnRateThreshold}x.",values:{formatedHours:e,burnRateThreshold:v()(a).format("0[.0]")}}):i.i18n.translate("xpack.observability.slo.rules.errorBudgetExhaustion.burnRateMode.text",{defaultMessage:"{formatedHours} hours until error budget exhaustion. {budgetConsumed} budget consumed before first alert.",values:{formatedHours:e,budgetConsumed:v()(t).format("0.00%")}}),M=(e,t={})=>{const a=t.longWindow||{value:1,unit:"h"};return{id:Object(w.v4)(),burnRateThreshold:1,maxBurnRateThreshold:O(a,e),longWindow:a,shortWindow:{value:5,unit:"m"},actionGroup:R.b.id,...t}};function B({slo:e,windows:t,errors:a,onChange:o,totalNumberOfWindows:u}){const[s,d]=Object(n.useState)(!0),c=e=>{o(t.map((t=>e.id===t.id?e:t)))},b=e=>{o(t.length>1?t.filter((t=>t.id!==e)):t)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiTitle,{size:"xs"},r.a.createElement("h5",null,i.i18n.translate("xpack.observability.burnRateRuleEditor.h5.defineMultipleBurnRateLabel",{defaultMessage:"Define multiple burn rate windows"}))),r.a.createElement(l.EuiSpacer,{size:"s"}),t.map(((n,o)=>{const l=a[o]||{longWindow:new Array,burnRateThreshold:new Array};return r.a.createElement(j,m()({},n,{key:n.id,slo:e,errors:l,onChange:c,onDelete:b,disableDelete:1===t.length,budgetMode:s}))})),r.a.createElement(l.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},r.a.createElement(l.EuiFlexItem,{grow:0},r.a.createElement(l.EuiButtonEmpty,{"data-test-subj":"sloBurnRateRuleAddWindowButton",color:"primary",size:"s",iconType:"plusInCircleFilled",onClick:()=>{o([...t,M()])},isDisabled:t.length===(u||4),"aria-label":i.i18n.translate("xpack.observability.slo.rules.addWindowAriaLabel",{defaultMessage:"Add window"})},r.a.createElement(p.FormattedMessage,{id:"xpack.observability.slo.rules.addWIndowLabel",defaultMessage:"Add window"}))),r.a.createElement(l.EuiFlexItem,{grow:0},r.a.createElement(l.EuiSwitch,{compressed:!0,onChange:()=>{d((e=>!e))},checked:!s,label:i.i18n.translate("xpack.observability.slo.rules.useBurnRateModeLabel",{defaultMessage:"Burn rate mode"})}))),r.a.createElement(l.EuiSpacer,{size:"m"}))}const F=[{burnRateThreshold:3.36,longWindow:{value:1,unit:"h"},shortWindow:{value:5,unit:"m"},actionGroup:R.b.id},{burnRateThreshold:1.4,longWindow:{value:6,unit:"h"},shortWindow:{value:30,unit:"m"},actionGroup:R.d.id},{burnRateThreshold:.7,longWindow:{value:24,unit:"h"},shortWindow:{value:120,unit:"m"},actionGroup:R.f.id},{burnRateThreshold:.234,longWindow:{value:72,unit:"h"},shortWindow:{value:260,unit:"m"},actionGroup:R.e.id}],L=[{burnRateThreshold:14.4,longWindow:{value:1,unit:"h"},shortWindow:{value:5,unit:"m"},actionGroup:R.b.id},{burnRateThreshold:6,longWindow:{value:6,unit:"h"},shortWindow:{value:30,unit:"m"},actionGroup:R.d.id},{burnRateThreshold:3,longWindow:{value:24,unit:"h"},shortWindow:{value:120,unit:"m"},actionGroup:R.f.id},{burnRateThreshold:1,longWindow:{value:72,unit:"h"},shortWindow:{value:260,unit:"m"},actionGroup:R.e.id}],I={"1M":L,"1w":F,"90d":[{burnRateThreshold:43.2,longWindow:{value:1,unit:"h"},shortWindow:{value:5,unit:"m"},actionGroup:R.b.id},{burnRateThreshold:18,longWindow:{value:6,unit:"h"},shortWindow:{value:30,unit:"m"},actionGroup:R.d.id},{burnRateThreshold:9,longWindow:{value:24,unit:"h"},shortWindow:{value:120,unit:"m"},actionGroup:R.f.id},{burnRateThreshold:3,longWindow:{value:72,unit:"h"},shortWindow:{value:260,unit:"m"},actionGroup:R.e.id}],"30d":L,"7d":F},C=[.01,.1,.2,.5,1];function G({windows:e,slo:t}){const a=C.map((a=>{const n=e.reduce(((e,n,r)=>{const o=Object(E.c)(Object(E.b)(`${n.longWindow.value}${n.longWindow.unit}`)),l=Math.round((1-t.objective.target)/a*o*n.burnRateThreshold);return{...e,[`column_${r+1}`]:l<o?l:null}}),{});return{rate:a,...n}})),n=[{field:"rate",name:i.i18n.translate("xpack.observability.slo.rules.timeTable.rateColumnLabel",{defaultMessage:"Error rate"}),render:e=>v()(e).format("0%")},...e.map(((e,t)=>({field:`column_${t+1}`,name:`${e.longWindow.value}h @ ${v()(e.burnRateThreshold).format("0[.0]")}x`,align:"right",render:e=>e?function(e){if(e>59){const t=e%60,a=(e-t)/60;return i.i18n.translate("xpack.observability.slo.rules.timeTable.minuteHoursLabel",{defaultMessage:"{hours}h {mins}m",values:{hours:a,mins:t}})}return i.i18n.translate("xpack.observability.slo.rules.timeTable.minuteLabel",{defaultMessage:"{minutes}m",values:{minutes:e}})}(e):"-"})))];return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiTitle,{size:"xs"},r.a.createElement("h5",null,i.i18n.translate("xpack.observability.slo.rules.timeTable.title",{defaultMessage:"How long will it take for the alert to fire?"}))),r.a.createElement(l.EuiSpacer,{size:"s"}),r.a.createElement(l.EuiText,{size:"s"},r.a.createElement("p",null,i.i18n.translate("xpack.observability.slo.rules.timeTable.description",{defaultMessage:"The table below lists the error rates and approximately how long it would take to receive your first alert with the current configuration."}))),r.a.createElement(l.EuiSpacer,{size:"m"}),r.a.createElement(l.EuiBasicTable,{tableCaption:i.i18n.translate("xpack.observability.slo.rules.tableCaption",{defaultMessage:"Alerting time table"}),items:a,columns:n}),r.a.createElement(l.EuiSpacer,{size:"l"}))}function z(e){const{setRuleParams:t,ruleParams:a,errors:s}=e,{isLoading:d,data:b}=Object(u.a)({sloId:null==a?void 0:a.sloId}),[h,m]=Object(n.useState)(void 0);Object(n.useEffect)((()=>{m(d||void 0===b?void 0:b)}),[d,b,t]);const[g,v]=Object(n.useState)((null==a?void 0:a.windows)||[M(h,{burnRateThreshold:14.4,longWindow:{value:1,unit:"h"},shortWindow:{value:5,unit:"m"},actionGroup:R.b.id}),M(h,{burnRateThreshold:6,longWindow:{value:6,unit:"h"},shortWindow:{value:30,unit:"m"},actionGroup:R.d.id}),M(h,{burnRateThreshold:3,longWindow:{value:24,unit:"h"},shortWindow:{value:120,unit:"m"},actionGroup:R.f.id}),M(h,{burnRateThreshold:1,longWindow:{value:72,unit:"h"},shortWindow:{value:360,unit:"m"},actionGroup:R.e.id})]);return Object(n.useEffect)((()=>{v((()=>(h?I[null==h?void 0:h.timeWindow.duration]:I["30d"]).map((e=>M(h,e)))))}),[h]),Object(n.useEffect)((()=>{t("windows",g)}),[g,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiTitle,{size:"xs"},r.a.createElement("h5",null,i.i18n.translate("xpack.observability.burnRateRuleEditor.h5.chooseASLOToMonitorLabel",{defaultMessage:"Choose a SLO to monitor"}))),r.a.createElement(l.EuiSpacer,{size:"s"}),r.a.createElement(c,{initialSlo:h,onSelected:e=>{m(e),t("sloId",null==e?void 0:e.id)},errors:s.sloId}),(null==h?void 0:h.groupBy)&&h.groupBy!==o.a&&r.a.createElement(r.a.Fragment,null,r.a.createElement(l.EuiSpacer,{size:"l"}),r.a.createElement(l.EuiCallOut,{color:"warning",size:"s",title:i.i18n.translate("xpack.observability.slo.rules.groupByMessage",{defaultMessage:'The SLO you selected has been created with a group-by on "{groupByField}". This rule will monitor and generate an alert for every instance found in the group-by field.',values:{groupByField:h.groupBy}})})),r.a.createElement(l.EuiSpacer,{size:"l"}),h&&r.a.createElement(r.a.Fragment,null,r.a.createElement(B,{slo:h,windows:g,onChange:v,errors:s.windows}),r.a.createElement(G,{slo:h,windows:g})))}}}]);