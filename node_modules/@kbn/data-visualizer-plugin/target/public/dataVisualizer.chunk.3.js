/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.dataVisualizer_bundle_jsonpfunction=window.dataVisualizer_bundle_jsonpfunction||[]).push([[3],{108:function(e,t,a){var i=a(155),s=a(156),n=a(157),r=a(158),l=a(159),o=a(160),c=a(161);c.alea=i,c.xor128=s,c.xorwow=n,c.xorshift7=r,c.xor4096=l,c.tychei=o,e.exports=c},112:function(e,t,a){"use strict";a.d(t,"a",(function(){return oe}));var i=a(0),s=a(13),n=a(3),r=a(10),l=a(108),o=a.n(l),c=a(64),u=a(61),d=a.n(u),p=a(30);var b=a(116),m=a(17),g=a(88),f=a(55),j=a(71),x=a(7),v=a(94),O=a(52),h=a(53);const y=n.i18n.translate("xpack.dataVisualizer.index.lensChart.topValuesLabel",{defaultMessage:"Top values"}),E=n.i18n.translate("xpack.dataVisualizer.index.lensChart.countLabel",{defaultMessage:"Count"});function S(e,t,a,i){var s,r,l,o,u,d,p;const{lens:b,maps:m,data:g}=t,f=[],j=null!==(s=null==g?void 0:g.query.filterManager.getFilters())&&void 0!==s?s:[],v=()=>{const e={lastRefresh:Date.now()};c.e.next(e)};if(!0===(null===(r=t.application)||void 0===r||null===(l=r.capabilities)||void 0===l||null===(o=l.visualize)||void 0===o?void 0:o.show)&&void 0!==b){const t=null==b?void 0:b.canUseEditor();f.push({name:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensTitle",{defaultMessage:"Explore in Lens"}),description:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInLensDescription",{defaultMessage:"Explore in Lens"}),type:"icon",icon:"lensApp",available:e=>void 0!==function(e){let t;switch(e){case x.i.KEYWORD:case x.i.VERSION:t="string";break;case x.i.DATE:t="date";break;case x.i.NUMBER:t="number";break;case x.i.IP:t="ip";break;case x.i.BOOLEAN:t="string";break;default:t=void 0}return t}(e.type)&&t,onClick:t=>{const i=function(e,t,a,i){if(void 0===e||void 0===i.type||void 0===i.fieldName)return;const s=function(e,t,a){if(void 0!==t.fieldName)return e===x.i.DATE?function(e){return{columns:{col2:{dataType:"number",isBucketed:!1,label:E,operationType:"count",scale:"ratio",sourceField:h.DOCUMENT_FIELD_NAME},col1:{dataType:"date",isBucketed:!0,label:e.fieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:e.fieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t):e===x.i.NUMBER?function(e,t){var a;if(void 0===t.timeFieldName)return{columns:{col1:{label:e.fieldName,dataType:"number",isBucketed:!0,operationType:"range",params:{type:"histogram",maxBars:"auto",ranges:[]},sourceField:e.fieldName},col2:{label:E,dataType:"number",isBucketed:!1,sourceField:h.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}};const i=null!==(a=e.supportedAggs)&&void 0!==a&&a.has("avg")?"average":"max";return{columns:{col2:{dataType:"number",isBucketed:!1,label:"average"===i?n.i18n.translate("xpack.dataVisualizer.index.lensChart.averageOfLabel",{defaultMessage:"Average of {fieldName}",values:{fieldName:e.fieldName}}):n.i18n.translate("xpack.dataVisualizer.index.lensChart.maximumOfLabel",{defaultMessage:"Maximum of {fieldName}",values:{fieldName:e.fieldName}}),operationType:i,sourceField:e.fieldName},col1:{dataType:"date",isBucketed:!0,label:t.timeFieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:t.timeFieldName}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"line",xAccessor:"col1"}}}(t,a):e===x.i.IP||e===x.i.KEYWORD||e===x.i.VERSION?function(e){return{columns:{col1:{label:y,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"column",columnId:"col2"},size:10,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:E,dataType:"number",isBucketed:!1,sourceField:h.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):e===x.i.BOOLEAN?function(e){return{columns:{col1:{label:y,dataType:"string",isBucketed:!0,operationType:"terms",params:{orderBy:{type:"alphabetical"},size:2,orderDirection:"desc"},sourceField:e.fieldName},col2:{label:E,dataType:"number",isBucketed:!1,sourceField:h.DOCUMENT_FIELD_NAME,operationType:"count"}},layer:{accessors:["col2"],layerId:"layer1",layerType:"data",seriesType:"bar",xAccessor:"col1"}}}(t):void 0}(i.type,i,e);return s?{visualizationType:"lnsXY",title:n.i18n.translate("xpack.dataVisualizer.index.lensChart.chartTitle",{defaultMessage:"Lens for {fieldName}",values:{fieldName:i.fieldName}}),references:[{id:e.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:e.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"}],state:{datasourceStates:{formBased:{layers:{layer1:{columnOrder:["col1","col2"],columns:s.columns}}}},filters:a,query:{language:t.searchQueryLanguage,query:t.searchString},visualization:{axisTitlesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},fittingFunction:"None",gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},layers:[s.layer],legend:{isVisible:!0,position:"right"},preferredSeriesType:"line",tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!0},valueLabels:"hide"}}}:void 0}(e,a,j,t);i&&b.navigateToPrefilledEditor({id:`dataVisualizer-${t.fieldName}`,attributes:i})},"data-test-subj":"dataVisualizerActionViewInLensButton"})}var S;return null!=t&&t.uiActions&&m&&!0===(null===(u=t.application)||void 0===u||null===(d=u.capabilities)||void 0===d||null===(p=d.maps)||void 0===p?void 0:p.show)&&f.push({name:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsTitle",{defaultMessage:"Explore in Maps"}),description:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.exploreInMapsDescription",{defaultMessage:"Explore in Maps"}),type:"icon",icon:"gisApp",available:e=>e.type===x.i.GEO_POINT||e.type===x.i.GEO_SHAPE,onClick:async a=>{if(null!=t&&t.uiActions&&e){const i={indexPatternId:e.id,fieldName:a.fieldName,contextualFields:[],originatingApp:x.a},s=await(null==t?void 0:t.uiActions.getTriggerCompatibleActions(O.VISUALIZE_GEO_FIELD_TRIGGER,i));s.length>0&&void 0!==s[0]&&(null==t||t.uiActions.getTrigger(O.VISUALIZE_GEO_FIELD_TRIGGER).exec(i))}},"data-test-subj":"dataVisualizerActionViewInMapsButton"}),void 0!==i&&null!==(S=t.dataViewFieldEditor)&&void 0!==S&&S.userPermissions.editIndexPattern()&&(f.push({name:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldTitle",{defaultMessage:"Edit data view field"}),description:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.editDataViewFieldDescription",{defaultMessage:"Edit data view field"}),type:"icon",icon:"indexEdit",onClick:a=>{var s;i.current=null===(s=t.dataViewFieldEditor)||void 0===s?void 0:s.openEditor({ctx:{dataView:e},fieldName:a.fieldName,onSave:v})},"data-test-subj":"dataVisualizerActionEditIndexPatternFieldButton"}),f.push({name:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteDataViewFieldTitle",{defaultMessage:"Delete data view field"}),description:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.deleteIndexPatternFieldDescription",{defaultMessage:"Delete data view field"}),type:"icon",icon:"trash",available:e=>!0===e.deletable,onClick:a=>{var s;i.current=null===(s=t.dataViewFieldEditor)||void 0===s?void 0:s.openDeleteModal({ctx:{dataView:e},fieldName:a.fieldName,onDelete:v})},"data-test-subj":"dataVisualizerActionDeleteIndexPatternFieldButton"})),f}var F=a(78),w=a(6),N=a(14),M=a(9),A=a(58);const _=()=>({isRunning:!1,loaded:0,total:100}),z=()=>(e,t)=>({...e,...t}),T=1e5;var V=a(12),C=a(65);const I=e=>Object(V.a)(e,["rawResponse"]);function k(e){return"random_sampling"===e.mode}function R(e){return"normal_sampling"===e.mode}function P(e,t){if(!t)return e;const{seed:a}=t;return R(t)?{sample:{sampler:{shard_size:t.shardSize},aggs:e}}:k(t)?{sample:{random_sampler:{probability:t.probability,...a?{seed:a}:{}},aggs:e}}:{sample:{aggs:e,random_sampler:{probability:1,...a?{seed:a}:{}}}}}const L=(e,t)=>{const a=Object(V.a)(e,["buckets"])?e.buckets:[],i=Object(V.a)(e,["sum_other_doc_count"])?e.sum_other_doc_count:0,s=((null==a?void 0:a.reduce(((e,t)=>t.doc_count+e),0))||0)+i,n=a.map((e=>({...e,doc_count:t?Math.floor(e.doc_count*(t/s)):e.doc_count,percent:e.doc_count/s})));return{topValuesSampleSize:s,topValues:n}};var D=a(60);function q(e){return Object(V.a)(e,["coordinates"])&&Array.isArray(e.coordinates)}function B(e){return Object(V.a)(e,["lon","lat"])}const G=(e,t,a)=>{const i=Object(w.get)(t,[...a,`${e}_field_stats`,"actual_stats"],void 0);if(i)return{min:Object(w.get)(i,"min"),max:Object(w.get)(i,"max"),avg:Object(w.get)(i,"avg")};const s=Object(w.get)(t,[...a,`${e}_min_max`],{});return s?{min:Object(w.get)(s,["min","value"]),max:Object(w.get)(s,["max","value"])}:{}},Q=(e,t,a,i)=>{switch(a[0].type){case x.i.NUMBER:return((e,t,a,i)=>{const{samplerShardSize:n}=t,r=((e,t)=>{const{index:a,query:i,runtimeFieldMap:s}=e;let n=0;const r=Array.from(Array(20),(()=>n+=5)),l={};return t.forEach(((e,t)=>{const{safeFieldName:a,supportedAggs:i}=e,s=!Object(D.a)(i);if((s||i.has("stats"))&&(l[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}),(s||i.has("min")&&i.has("max"))&&(l[`${a}_min_max`]={filter:{exists:{field:e.fieldName}},aggs:{min:{min:{field:e.fieldName}},max:{max:{field:e.fieldName}}}}),(s||i.has("percentiles"))&&(l[`${a}_percentiles`]={percentiles:{field:e.fieldName,percents:r,keyed:!1}}),s||i.has("terms")){const t={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};l[`${a}_top`]=t}})),{index:a,size:0,body:{query:i,aggs:P(l,e.samplingOption),...Object(V.a)(s)?{runtime_mappings:s}:{}}}})(t,a);return e.search({params:r},i).pipe(Object(N.catchError)((e=>Object(s.of)({fields:a,error:Object(C.b)(e)}))),Object(N.map)((e=>{if(!I(e))return e;const i=e.rawResponse.aggregations,s=["sample"],r=[];return a.forEach(((e,a)=>{const l=e.safeFieldName,o=Object(w.get)(i,[...s,`${l}_field_stats`,"doc_count"],0),c=[...s,`${l}_top`];n<1&&e.cardinality>=T&&c.push("top");const u=Object(w.get)(i,[...c],{}),{topValuesSampleSize:d,topValues:p}=L(u),b={fieldName:e.fieldName,...G(l,i,s),isTopValuesSampled:R(t.samplingOption)||Object(D.a)(t.samplingProbability)&&t.samplingProbability<1,topValues:p,topValuesSampleSize:d,topValuesSamplerShardSize:Object(w.get)(i,["sample","doc_count"])};if(o>0){const e=Object(w.get)(i,[...s,`${l}_percentiles`,"values"],[]);if(e&&Object(D.a)(b.min)){const t=Object(w.find)(e,{key:50});b.median=void 0!==t?t.value:0,b.distribution=((e,t,a)=>{const i={percentiles:[],minPercentile:0,maxPercentile:100};if(0===e.length)return i;let s=[],n=a;if(n>=0){i.minPercentile=0,i.maxPercentile=90,s=e.slice(0,e.length-2);const t=n+1.5*(Object(w.last)(s).value-n);for(let a=s.length;a<e.length&&e[a].value<t;a++)s.push(e[a]),i.maxPercentile+=5}else{const t=n;n=e[0].value,i.minPercentile=5,i.maxPercentile=95,s=e.slice(1,e.length-1);const a=Object(w.last)(s).value,r=.25*(a-n);n-t<r&&(s.splice(0,0,e[0]),i.minPercentile=0,n=t),e[e.length-1].value-a<r&&(s.push(e[e.length-1]),i.maxPercentile=100)}const r=s.length;let l=n,o=0;for(let e=0;e<r;e++){const t=s[e];t.value.toPrecision(15)!==l.toPrecision(15)?(o>0&&i.percentiles.push({percent:5*o,minValue:l,maxValue:l}),i.percentiles.push({percent:5,minValue:l,maxValue:t.value}),l=t.value,o=0):(o++,e===r-1&&i.percentiles.push({percent:5*o,minValue:l,maxValue:l}))}return i})(e,0,b.min)}}r.push(b)})),r})))})(e,t,a,i);case x.i.KEYWORD:case x.i.IP:case x.i.VERSION:return((e,t,a,i)=>{const{samplerShardSize:n}=t,r=((e,t)=>{const{index:a,query:i,runtimeFieldMap:s}=e,n={};return t.forEach(((e,t)=>{const a=e.safeFieldName,i={terms:{field:e.fieldName,size:10,order:{_count:"desc"}}};n[`${a}_top`]=i})),{index:a,size:0,body:{query:i,aggs:P(n,e.samplingOption),...Object(V.a)(s)?{runtime_mappings:s}:{}}}})(t,a);return e.search({params:r},i).pipe(Object(N.catchError)((e=>Object(s.of)({fields:a,error:Object(C.b)(e)}))),Object(N.map)((e=>{if(!I(e))return e;const t=e.rawResponse.aggregations,i=["sample"],s=[];return a.forEach(((e,a)=>{const r=e.safeFieldName,l=[...i,`${r}_top`];n<1&&e.cardinality>=T&&l.push("top");const o=Object(w.get)(t,[...l],{}),{topValuesSampleSize:c,topValues:u}=L(o,Object(w.get)(t,["sample","probability"])<1?Object(w.get)(t,["sample","doc_count"]):void 0),d={fieldName:e.fieldName,isTopValuesSampled:!0,topValues:u,topValuesSampleSize:c,topValuesSamplerShardSize:Object(w.get)(t,["sample","doc_count"])};s.push(d)})),s})))})(e,t,a,i);case x.i.DATE:return((e,t,a,i)=>{const n=((e,t)=>{const{index:a,query:i,runtimeFieldMap:s}=e,n={};return t.forEach(((e,t)=>{const a=e.safeFieldName;n[`${a}_field_stats`]={filter:{exists:{field:e.fieldName}},aggs:{actual_stats:{stats:{field:e.fieldName}}}}})),{index:a,size:0,body:{query:i,aggs:P(n,e.samplingOption),...Object(V.a)(s)?{runtime_mappings:s}:{}}}})(t,a);return e.search({params:n},i).pipe(Object(N.catchError)((e=>Object(s.of)({fields:a,error:Object(C.b)(e)}))),Object(N.map)((e=>{if(!I(e))return e;const t=e.rawResponse.aggregations,i=["sample"];return a.map(((e,a)=>{const s=e.safeFieldName,n=Object(w.get)(t,[...i,`${s}_field_stats`,"actual_stats"],{});return{fieldName:e.fieldName,earliest:Object(w.get)(n,"min",0),latest:Object(w.get)(n,"max",0)}}))})))})(e,t,a,i);case x.i.BOOLEAN:return((e,t,a,i)=>{const n=((e,t)=>{const{index:a,query:i,runtimeFieldMap:s}=e,n={};return t.forEach(((e,t)=>{const a=e.safeFieldName;n[`${a}_value_count`]={filter:{exists:{field:e.fieldName}}},n[`${a}_values`]={terms:{field:e.fieldName,size:2}}})),{index:a,size:0,body:{query:i,aggs:P(n,e.samplingOption),...Object(V.a)(s)?{runtime_mappings:s}:{}}}})(t,a);return e.search({params:n},i).pipe(Object(N.catchError)((e=>Object(s.of)({fields:a,error:Object(C.b)(e)}))),Object(N.map)((e=>{if(!I(e))return e;const t=e.rawResponse.aggregations,i=["sample"],s=Object(w.get)(t,[...i,"doc_count"],0);return a.map(((e,a)=>{const n=e.fieldName,r=Object(w.get)(t,[...i,`${n}_value_count`,"doc_count"],0),l=Object(w.get)(t,[...i,`${n}_values`],{}),{topValuesSampleSize:o,topValues:c}=L(l),u=r>s?Object(w.get)(t,[...i,"probability"],1):1,d={fieldName:e.fieldName,count:r*u,trueCount:0,falseCount:0,topValues:c,topValuesSampleSize:o};return Object(w.get)(t,[...i,`${n}_values`,"buckets"],[]).forEach((e=>{d[`${e.key_as_string}Count`]=e.doc_count})),d}))})))})(e,t,a,i);case x.i.TEXT:default:return((e,t,a,i)=>{const{maxExamples:n}=t;return Object(s.combineLatest)(a.map((r=>{const l=((e,t)=>{const{index:a,timeFieldName:i,earliestMs:s,latestMs:n,query:r,runtimeFieldMap:l,maxExamples:o}=e,c=Math.max(100,null!=o?o:10),u=Object(A.d)(i,s,n,r);return Array.isArray(u)&&u.push({exists:{field:t.fieldName}}),{index:a,size:c,body:{fields:[t.fieldName],_source:!1,query:{bool:{filter:u}},...Object(V.a)(l)?{runtime_mappings:l}:{}}}})(t,r);return e.search({params:l},i).pipe(Object(N.catchError)((e=>Object(s.of)({fieldName:r.fieldName,fields:a,error:Object(C.b)(e)}))),Object(N.map)((e=>{if(!I(e))return e;const t=e.rawResponse,a={fieldName:r.fieldName,examples:[]};if(t.hits.total>0){const e=t.hits.hits.map((e=>{const t=Object(w.get)(e.fields,r.fieldName);return Array.isArray(t)&&t.length>0?t[0]:t}));a.examples=function(e,t=10){const a=[];if(!Object(D.a)(e))return a;for(let i=0;i<e.length;i++){const s=e[i];if("string"==typeof s&&-1===a.indexOf(s)?a.push(s):(q(s)&&-1===a.findIndex((e=>q(e)&&e.type===s.type&&s.coordinates.every(((t,a)=>t===e.coordinates[a]))))&&a.push(s),B(s)&&-1===a.findIndex((e=>B(e)&&s.lon===e.lon&&s.lat===e.lat))&&a.push(s)),a.length===t)return a}return a}(e,n)}return a})))})))})(e,t,a,i)}};var U=a(81);var $=a(91);const X=(e,t,a,i,s,n,r,l,o)=>{const c=e,u=Object(A.d)(s,n,r,t),d=(e=>{return void 0!==(null==(t=e)?void 0:t.aggregations)?t.aggregations:void 0!==(null==t?void 0:t.aggs)?t.aggs:void 0;var t})(l),p=void 0!==d?{...d}:{},b={...Object(V.a)(o)?o:{},...Object(V.a)(l)&&Object(V.a)(l.runtime_mappings)?l.runtime_mappings:{}};return a.forEach((({name:e,supportedAggs:t},a)=>{const i=Object(A.f)(e,a);if(t.has("count")&&(p[`${i}_count`]={filter:{exists:{field:e}}}),t.has("cardinality")){var s;let t;t=null!=l&&null!==(s=l.script_fields)&&void 0!==s&&s.hasOwnProperty(e)?p[`${i}_cardinality`]={cardinality:{script:null==l?void 0:l.script_fields[e].script}}:{cardinality:{field:e}},p[`${i}_cardinality`]=t}})),{index:c,track_total_hits:!1,size:0,body:{query:{bool:{filter:u}},...Object(V.a)(p)?{aggs:P(p,i)}:{},...Object(V.a)(b)?{runtime_mappings:b}:{}}}},W=(e,t,a)=>{const i={aggregatableExistsFields:[],aggregatableNotExistsFields:[]};return e&&0!==t.length?(e.forEach((({rawResponse:e,aggregatableFields:t})=>{const s=e.aggregations,n=["sample"],r=s.sample.doc_count;t.forEach((({name:e,supportedAggs:t},l)=>{const o=Object(A.f)(e,l),c=Object(w.get)(s,[...n,`${o}_count`,"doc_count"],0),u=c>r?Object(w.get)(s,[...n,"probability"],1):1;if(c>0){const t=Object(w.get)(s,[...n,`${o}_cardinality`,"value"]);i.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:r,count:c*u,cardinality:t}})}else{var d,p;if(null!=a&&null!==(d=a.script_fields)&&void 0!==d&&d.hasOwnProperty(e)||null!=a&&null!==(p=a.runtime_mappings)&&void 0!==p&&p.hasOwnProperty(e)){const t=Object(w.get)(s,[...n,`${o}_cardinality`,"value"]);i.aggregatableExistsFields.push({fieldName:e,existsInDocs:!0,stats:{sampleCount:r,count:c,cardinality:t}})}else i.aggregatableNotExistsFields.push({fieldName:e,existsInDocs:!1,stats:{}})}}))})),i):i},H=(e,t,a,i,s,n,r)=>{const l=e,o=Object(A.d)(i,s,n,t);return Array.isArray(o)&&o.push({exists:{field:a}}),{index:l,size:0,body:{query:{bool:{filter:o}},...Object(V.a)(r)?{runtime_mappings:r}:{}},track_total_hits:1}},Y=(e,t,a,i,s,n,r)=>{const l=t,o=Object(A.d)(i,s,n,a);return{index:l,body:{fields:e.map((e=>e)),query:{bool:{filter:o}},...Object(V.a)(r)?{runtime_mappings:r}:{},size:1e3}}},J=(e,t,a,i)=>{const s={nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]};return e&&0!==t.length?(t.forEach(((t,n)=>{const r=e.find((e=>e.rawResponse.fieldName===t)),l=void 0!==r&&r.rawResponse.hits.total>0,o={fieldName:t,existsInDocs:l,stats:{count:a[n],cardinality:i[n].size,sampleCount:1e3}};!0===l?s.nonAggregatableExistsFields.push(o):s.nonAggregatableNotExistsFields.push(o)})),s):s};var K=a(77);const Z=async(e,t,a,i,s,n)=>{var r,l;const c=null!=i?i:Math.abs(o()().int32()).toString(),{index:u,timeFieldName:d,earliest:p,latest:b,runtimeFieldMap:m,searchQuery:g,intervalMs:f}=t,j={randomlySampled:!1,took:0,totalCount:0,probability:1},x={bool:{filter:Object(A.d)(d,p,b,g)}},v={eventRate:{date_histogram:{field:d,fixed_interval:`${f}ms`,min_doc_count:0,extended_bounds:{min:p,max:b}}}},O=null!=s?s:1e-6,h=e=>({sampler:{aggs:v,random_sampler:{probability:e,seed:c}}}),y=void 0!==d&&""!==d&&void 0!==f&&f>0,E=(e,t=!1)=>({index:u,body:{query:x,...y?{aggs:e}:{},...Object(V.a)(m)?{runtime_mappings:m}:{}},track_total_hits:t,size:0}),S=await e.search({params:E(h(O),!y)},a).toPromise();if(void 0===S)throw Error(`An error occurred with the following query ${JSON.stringify(E(h(O)))}`);if(!y){var F;const e="number"==typeof S.rawResponse.hits.total?S.rawResponse.hits.total:null===(F=S.rawResponse.hits.total)||void 0===F?void 0:F.value;return{...j,randomlySampled:!1,took:S.rawResponse.took,totalCount:null!=e?e:0}}var N;if(Object(D.a)(s))return{...j,randomlySampled:1!==s,took:null===(N=S.rawResponse)||void 0===N?void 0:N.took,probability:s,...ee(S.rawResponse,t,!0)};const M=null===(r=S.rawResponse.aggregations)||void 0===r||null===(l=r.sampler)||void 0===l?void 0:l.doc_count,_=null!=n?n:1e5;if(void 0!==S&&M<_){const i=O*_/(M-2*Math.sqrt(M));if(i===1/0||M<=4){var z,T;const i=await e.search({params:E(h(1))},a).toPromise();return{...j,randomlySampled:!1,took:S.rawResponse.took+(null!==(z=null==i||null===(T=i.rawResponse)||void 0===T?void 0:T.took)&&void 0!==z?z:0),...ee(null==i?void 0:i.rawResponse,t,!0),probability:1}}{const s=K.c[Object(w.sortedIndex)(K.c,i)],n=await e.search({params:E(h(s))},a).toPromise();if(n)return{...j,randomlySampled:!0,took:S.rawResponse.took+n.rawResponse.took,...ee(n.rawResponse,t,!0),probability:s}}}return j},ee=(e,t,a=!1)=>{if(!e)return;let i=0;if(void 0===t.intervalMs||void 0===t.earliest||void 0===t.latest)return{totalCount:i};const s={},n=Object(w.get)(e,a?["aggregations","sampler","eventRate","buckets"]:["aggregations","eventRate","buckets"],[]);return Object(w.each)(n,(e=>{const t=e.key;s[t]=e.doc_count,i+=e.doc_count})),{interval:t.intervalMs,buckets:s,timeRangeEarliest:t.earliest,timeRangeLatest:t.latest,totalCount:i}};var te=a(109);var ae=a(93);const ie={COUNTER:new Set(["count","histogram","variable_width_histogram","rate","min","max","top_metrics","range"]),GAUGE:new Set(["count","max","top_metrics","missing","date_histogram","sum","rate","boxplot","value_count","avg","percentiles","cardinality","histogram","variable_width_histogram","frequent_item_sets","min","stats","diversified_sampler","percentile_ranks","median_absolute_deviation","multi_terms","auto_date_histogram","rare_terms","range","extended_stats","date_range","terms","significant_terms"]),AGGREGATABLE:new Set(["count","avg","cardinality","histogram","percentiles","stats","terms"]),DEFAULT:new Set},se=e=>Object(ae.b)(e)?ie.COUNTER:Object(ae.c)(e)?ie.GAUGE:e.aggregatable?ie.AGGREGATABLE:ie.DEFAULT,ne=Object(F.c)();function re(e){return!x.h.includes(e)}const le={mode:"random_sampling",seed:"",probability:0},oe=(e,t,a,l)=>{var u;const O=Object(i.useRef)(window.performance.now()),{services:h}=Object(f.a)(),{uiSettings:y,data:E,security:T,executionContext:I,analytics:R}=h,P=d()(null==I?void 0:I.context$),L=Object(i.useMemo)((()=>{const t={type:"visualization",name:m.a,id:e.id};return{...P||{},child:t}}),[P,e.id]);Object(p.useExecutionContext)(I,L);const{samplerShardSize:D,visibleFieldTypes:q,showEmptyFields:B}=t,[G,K]=Object(i.useState)(0),ee=e.sessionId,ae=Object(i.useMemo)((()=>{let e=Math.abs(o()().int32());return void 0!==T&&T.authc.getCurrentUser().then((t=>{const a=t.username;a&&(e=Math.abs(o()(a).int32()))})),e}),[T]),{currentSavedSearch:ie,currentDataView:oe,currentQuery:ce,currentFilters:ue,visibleFieldNames:de,fieldsToFetch:pe,samplingOption:be}=Object(i.useMemo)((()=>{var t,a;return{currentSavedSearch:null==e?void 0:e.savedSearch,currentDataView:e.dataView,currentQuery:null==e?void 0:e.query,visibleFieldNames:null!==(t=null==e?void 0:e.visibleFieldNames)&&void 0!==t?t:[],currentFilters:null==e?void 0:e.filters,fieldsToFetch:null==e?void 0:e.fieldsToFetch,samplingOption:null!==(a=null==e?void 0:e.samplingOption)&&void 0!==a?a:le}}),[e]),{searchQueryLanguage:me,searchString:ge,searchQuery:fe,queryOrAggregateQuery:je}=Object(i.useMemo)((()=>{const e=E.query.filterManager,a=Object(j.b)({dataView:oe,uiSettings:y,savedSearch:ie,query:ce,filters:ue,filterManager:E.query.filterManager});if(void 0===a||""!==t.searchString){if(t.filters){const a=null==e?void 0:e.getGlobalFilters();e&&e.setFilters(t.filters),a&&(null==e||e.addFilters(a))}return{searchQuery:t.searchQuery,searchString:t.searchString,searchQueryLanguage:t.searchQueryLanguage}}return{queryOrAggregateQuery:a.queryOrAggregateQuery,searchQuery:a.searchQuery,searchString:a.searchString,searchQueryLanguage:a.queryLanguage}}),[null==ie?void 0:ie.id,oe.id,t.searchString,t.searchQueryLanguage,JSON.stringify({searchQuery:t.searchQuery,currentQuery:ce,currentFilters:ue}),G]),xe=Object(b.a)(),ve=Object(c.f)({timeRangeSelector:void 0!==(null==oe?void 0:oe.timeFieldName),autoRefreshSelector:!0}),[Oe,he]=Object(i.useState)(ne.metricConfigs),[ye,Ee]=Object(i.useState)(ne.metricsLoaded),[Se,Fe]=Object(i.useState)(),[we,Ne]=Object(i.useState)(ne.nonMetricConfigs),[Me,Ae]=Object(i.useState)(ne.nonMetricsLoaded),_e=Object(i.useMemo)((()=>{const e=xe,t=ve;if(!e||!t||!oe)return;const a=t.getActiveBounds();let i,s;var n,l;void 0!==a&&void 0!==oe.timeFieldName&&(i=null===(n=a.min)||void 0===n?void 0:n.valueOf(),s=null===(l=a.max)||void 0===l?void 0:l.valueOf());const o=t.getActiveBounds();e.setInterval("auto"),o&&(e.setBounds(o),e.setBarTarget(75));const c=e.getInterval(),u=[],d=[],p=oe.fields;return null==p||p.forEach((e=>{if(pe&&!pe.includes(e.name))return;const t=void 0!==e.displayName?e.displayName:e.name;var a;x.h.includes(t)||(!0!==e.aggregatable||x.f.has(e.type)||null!==(a=e.esTypes)&&void 0!==a&&a.some((e=>e===r.a.AGGREGATE_METRIC_DOUBLE))?d.push(e.name):u.push({name:e.name,supportedAggs:se(e)}))})),{earliest:i,latest:s,aggInterval:c,intervalMs:null==c?void 0:c.asMilliseconds(),searchQuery:fe,samplerShardSize:D,sessionId:ee,index:oe.title,timeFieldName:oe.timeFieldName,runtimeFieldMap:oe.getRuntimeMappings(),aggregatableFields:u,nonAggregatableFields:d,fieldsToFetch:pe,browserSessionSeed:ae,samplingOption:{...be,seed:ae.toString()},embeddableExecutionContext:L}}),[xe,ve,oe.id,JSON.stringify(fe),JSON.stringify(be),D,ee,G,pe,ae,L]),{overallStats:ze,progress:Te}=function(e,t,a){const{services:{data:n,notifications:{toasts:r}}}=Object(f.a)(),[l,o]=Object(i.useState)(Object(F.c)().overallStats),[c,u]=Object(i.useReducer)(z(),_()),d=Object(i.useRef)(new AbortController),p=Object(i.useRef)(),b=Object(i.useCallback)((async()=>{try{var i;if(null===(i=p.current)||void 0===i||i.unsubscribe(),d.current.abort(),d.current=new AbortController,!e||0===t)return;u({..._(),isRunning:!0,error:void 0});const{aggregatableFields:c,nonAggregatableFields:b,index:m,searchQuery:g,timeFieldName:f,earliest:j,latest:x,runtimeFieldMap:v,samplingOption:O,sessionId:h,embeddableExecutionContext:y}=e,E={abortSignal:d.current.signal,sessionId:h,...y?{executionContext:y}:{}},S=await Z(n.search,e,E,O.seed,a),F=n.search.search({params:Y(b,m,g,f,j,x,v)},E).pipe(Object(N.map)((e=>e))),M=b.map((e=>n.search.search({params:H(m,g,e,f,j,x,v)},E).pipe(Object(N.map)((t=>({...t,rawResponse:{...t.rawResponse,fieldName:e}})))))),A=Object(w.chunk)(c,30);var l;k(O)&&(O.probability=null!==(l=S.probability)&&void 0!==l?l:1);const z=function(e,t=U.b){return Object(s.from)(e).pipe(Object(N.mergeMap)(((e,t)=>e.pipe(Object(N.last)(),Object(N.map)((e=>({index:t,value:e}))))),t),Object(N.toArray)(),Object(N.map)((e=>e.sort(((e,t)=>e.index-t.index)).map((e=>e.value)))))}([F,...A.map((e=>n.search.search({params:X(m,g,e,O,f,j,x,void 0,v)},E).pipe(Object(N.map)((t=>({...t,aggregatableFields:e})))))),...M],U.b);p.current=z.subscribe({next:e=>{var t;const a=[],i=[];let s;e.forEach(((e,t)=>{if(0===t&&(n=e,Object(V.a)(n,["rawResponse"])&&n.rawResponse.hasOwnProperty("hits"))){const t=e.rawResponse.hits.hits.map((e=>e.fields?Object($.a)(e.fields):{}));s=t}var n;(function(e){return Object(V.a)(e,["aggregatableFields"])})(e)&&a.push(e),function(e){return Object(V.a)(e,["rawResponse"])}(e)&&i.push(e)}));const n=null!==(t=null==S?void 0:S.totalCount)&&void 0!==t?t:0,r=W(a,c),l=new Array(b.length).fill(0),u=b.map((()=>new Set));s&&s.forEach((e=>{b.forEach(((t,a)=>{e.hasOwnProperty(t)&&(l[a]+=1,u[a].add(e[t]))}))}));const d=J(i,b,l,u);o({documentCountStats:S,...d,...r,totalCount:n})},error:t=>{Object(te.a)(r,e.index,Object(C.b)(t)),u({isRunning:!1,error:t})},complete:()=>{u({loaded:100,isRunning:!1})}})}catch(t){"AbortError"!==t.name&&Object(te.a)(r,e.index,Object(C.b)(t))}}),[n.search,e,r,t,a]),m=Object(i.useCallback)((()=>{var e;null===(e=p.current)||void 0===e||e.unsubscribe(),p.current=void 0,d.current.abort()}),[]);return Object(i.useEffect)((()=>{b()}),[b]),Object(i.useEffect)((()=>m),[m]),Object(i.useMemo)((()=>({progress:c,overallStats:l})),[l,c])}(_e,G,t.probability),Ve=Object(i.useMemo)((()=>{if(!(Te.loaded<100))return{metricConfigs:Oe.map((e=>{var t;return{...e,cardinality:null===(t=e.stats)||void 0===t?void 0:t.cardinality}})).filter((e=>void 0!==e)),nonMetricConfigs:we.map((e=>{var t;return{...e,cardinality:null===(t=e.stats)||void 0===t?void 0:t.cardinality}})).filter((e=>void 0!==e))}}),[Oe,we,Te.loaded]),Ce=Object(i.useMemo)((()=>{var e,a;return null!==(e=null===t.probability?null==ze||null===(a=ze.documentCountStats)||void 0===a?void 0:a.probability:t.probability)&&void 0!==e?e:1}),[t.probability,null==ze||null===(u=ze.documentCountStats)||void 0===u?void 0:u.probability]),Ie=function(e,t,a,r){const{services:{data:l,notifications:{toasts:o}}}=Object(f.a)(),[c,u]=Object(i.useState)(),[d,p]=Object(i.useReducer)(z(),_()),b=Object(i.useRef)(new AbortController),m=Object(i.useRef)(),j=Object(i.useRef)(),x=Object(i.useCallback)((()=>{var i,c,d;if(null===(i=m.current)||void 0===i||i.unsubscribe(),null===(c=j.current)||void 0===c||c.unsubscribe(),b.current.abort(),b.current=new AbortController,p({..._(),error:void 0}),u(void 0),!e||!t||0===t.metricConfigs.length&&0===t.nonMetricConfigs.length)return void p({loaded:100,isRunning:!1});const{sortField:f,sortDirection:x}=a,v=M.Comparators.property(f,M.Comparators.default(x)),O=[...t.metricConfigs,...t.nonMetricConfigs].sort(v),h=Object(g.a)(O,a.visibleFieldNames,a.visibleFieldTypes),{pageIndex:y,pageSize:E}=a,S=null===(d=h.filteredFields)||void 0===d?void 0:d.slice(y*E,(y+1)*E).filter((e=>!0===e.existsInDocs));if(!S||0===S.length)return void p({loaded:100,isRunning:!1});const F=Object(A.d)(e.timeFieldName,e.earliest,e.latest,e.searchQuery),z={index:e.index,samplerShardSize:e.samplerShardSize,timeFieldName:e.timeFieldName,earliestMs:e.earliest,latestMs:e.latest,runtimeFieldMap:e.runtimeFieldMap,intervalMs:e.intervalMs,query:{bool:{filter:F}},maxExamples:10,samplingProbability:r,browserSessionSeed:e.browserSessionSeed,samplingOption:e.samplingOption},{sessionId:T,embeddableExecutionContext:V}=e,C={abortSignal:b.current.signal,sessionId:T,...V?{executionContext:V}:{}},I=((e,t=10)=>{const a=[],i={};return e.forEach((e=>{const a=e.type;void 0===i[a]&&(i[a]=[[]]);let s=Object(w.last)(i[a]);s.length===t&&(s=[],i[a].push(s)),s.push(e)})),Object.values(i).forEach((e=>{a.push(...e)})),a})(S.map(((e,t)=>({...e,safeFieldName:Object(A.f)(e.fieldName,t)}))),10),k=new s.Subject,R=new s.Subject,P=I.map((e=>Q(l.search,z,e,C))).filter((e=>void 0!==e)),L=e=>{o.addError(e,{title:n.i18n.translate("xpack.dataVisualizer.index.errorFetchingFieldStatisticsMessage",{defaultMessage:"Error fetching field statistics"})}),p({isRunning:!1,error:e})},D=()=>{p({isRunning:!1})},q=new Map;m.current=Object(s.from)(P).pipe(Object(N.mergeMap)((e=>e),U.b)).subscribe({next:e=>{if(p({..._(),error:void 0}),e){const a=[];var t;Array.isArray(e)?e.forEach((e=>{void 0!==e.fieldName&&q.set(e.fieldName,e)})):a.push(...null!==(t=e.fields)&&void 0!==t?t:[]),u(q),p({loaded:q.size/S.length*100,isRunning:!0}),a.length>0&&(k.next(q),R.next(a))}},error:L,complete:D}),j.current=Object(s.combineLatest)([k,R.pipe(Object(N.switchMap)((e=>Object(s.combineLatest)(e.map((e=>Q(l.search,z,[e],C))).filter((e=>void 0!==e))))))]).subscribe({next:e=>{const t=Object(w.cloneDeep)(e[0]),a=e[1];Array.isArray(a)&&(a.forEach((e=>{Array.isArray(e)&&1===e.length&&t.set(e[0].fields[0],e[0])})),u(t),p({loaded:t.size/S.length*100,isRunning:!0}))},error:L,complete:D})}),[l.search,o,t,a.pageSize,a.pageIndex,a.sortDirection,a.sortField,r]),v=Object(i.useCallback)((()=>{var e,t;null===(e=m.current)||void 0===e||e.unsubscribe(),m.current=void 0,null===(t=j.current)||void 0===t||t.unsubscribe(),j.current=void 0,b.current.abort(),p({isRunning:!1})}),[]);return Object(i.useEffect)((()=>(x(),v)),[x,v]),{progress:d,fieldStats:c,startFetch:x,cancelFetch:v}}(_e,Ve,t,Ce),ke=Object(i.useMemo)((()=>.2*Te.loaded+.8*Ie.progress.loaded),[Te.loaded,Ie.progress.loaded]);Object(i.useEffect)((()=>{const e=Object(s.merge)(ve.getTimeUpdate$(),ve.getAutoRefreshFetch$(),c.e).subscribe((()=>{l&&l({time:ve.getTime(),refreshInterval:ve.getRefreshInterval()}),K(Date.now())}));return()=>{e.unsubscribe()}}));const Re=Object(i.useMemo)((()=>oe.fields),[oe]),Pe=Object(i.useCallback)((()=>{const e=[],t=ze.aggregatableExistsFields||[],a=Re.filter((e=>e.type===r.b.NUMBER&&void 0!==e.displayName&&!0===re(e.displayName))),i=a.filter((e=>t.find((t=>t.fieldName===e.spec.name))));if(!1===ye)return void Ee(!0);let s=ze.aggregatableExistsFields;a.length!==i.length&&!0===ye&&(s=s.concat(ze.aggregatableNotExistsFields));const n=!0===ye&&!0===B?a:i;n.forEach((t=>{var a;const i=s.find((e=>e.fieldName===t.spec.name));if(!i)return;const n={...i,fieldFormat:oe.getFormatterForField(t),type:x.i.NUMBER,secondaryType:Object(v.a)(t),loading:null===(a=null==i?void 0:i.existsInDocs)||void 0===a||a,aggregatable:!0,deletable:void 0!==t.runtimeField,supportedAggs:se(t)};t.displayName!==n.fieldName&&(n.displayName=t.displayName),e.push(n)})),Fe({totalMetricFieldsCount:a.length,visibleMetricsCount:n.length}),he(e)}),[oe,Re,ye,ze,B]),Le=Object(i.useCallback)((()=>{const e=Re.filter((e=>e.type!==r.b.NUMBER&&void 0!==e.displayName&&!0===re(e.displayName))),t=[];let a=[];const i=ze.aggregatableExistsFields||[],s=ze.nonAggregatableExistsFields||[];if(e.forEach((e=>{const n=i.find((t=>t.fieldName===e.spec.name));if(void 0!==n)t.push(e),a.push(n);else{const i=s.find((t=>t.fieldName===e.spec.name));void 0!==i&&(t.push(e),a.push(i))}})),!1===Me)return void Ae(!0);e.length!==a.length&&!0===B&&(a=a.concat(ze.aggregatableNotExistsFields,ze.nonAggregatableNotExistsFields));const n=[];(B?e:t).forEach((e=>{var t;const i=a.find((t=>t.fieldName===e.spec.name)),s={...i||{},secondaryType:Object(v.a)(e),fieldFormat:oe.getFormatterForField(e),aggregatable:e.aggregatable,loading:null===(t=null==i?void 0:i.existsInDocs)||void 0===t||t,deletable:void 0!==e.runtimeField},r=Object(v.a)(e);void 0!==r?s.type=r:(s.type=e.type,s.isUnsupportedType=!0),e.displayName!==s.fieldName&&(s.displayName=e.displayName),n.push(s)})),Ne(n)}),[oe,Re,Me,ze,B]);Object(i.useEffect)((()=>{Pe(),Le()}),[ze,B]),Object(i.useEffect)((()=>{if(100===ke&&void 0!==O.current){const e=window.performance.now()-O.current;O.current=void 0,function(e,t){e.reportEvent("performance_metric",t)}(R,{eventName:"dataVisualizerDataLoaded",duration:e})}}),[ke]);const De=Object(i.useMemo)((()=>{const e=Ie.fieldStats;let t=[...we,...Oe];return t=Object(g.a)(t,de,q).filteredFields,e&&(t=t.map((t=>{var a;const i=null!==(a=e.get(t.fieldName))&&void 0!==a?a:{};return i?{...t,loading:!1,stats:{...t.stats,...i}}:t}))),t}),[we,Oe,q,de,Ie.progress.loaded,t.pageIndex,t.pageSize]),qe=Object(i.useRef)();Object(i.useEffect)((()=>{const e=qe;return()=>{e.current&&e.current()}}),[]);const Be=Object(i.useMemo)((()=>{const t=S(e.dataView,h,{searchQueryLanguage:me,searchString:ge},e.allowEditDataView?qe:void 0);if(Array.isArray(t)&&!(t.length<1))return[{name:n.i18n.translate("xpack.dataVisualizer.index.dataGrid.actionsColumnLabel",{defaultMessage:"Actions"}),actions:t,width:"70px"}]}),[e.dataView,h,me,ge,e.allowEditDataView]);return{progress:ke,overallStatsProgress:Te,configs:De,queryOrAggregateQuery:je,searchQueryLanguage:me,searchString:ge,searchQuery:fe,extendedColumns:Be,documentCountStats:ze.documentCountStats,metricsStats:Se,overallStats:ze,timefilter:ve,setLastRefresh:K}}},114:function(e,t,a){"use strict";a.d(t,"a",(function(){return O}));var i=a(0),s=a(102),n=a(63),r=a(67),l=a(84),o=a(55),c=a(7),u=a(96),d=a(62),p=a(2);const b=({config:e,dataView:t,combinedQuery:a})=>{const{stats:s}=e,[b,m]=Object(i.useState)([]),{services:{maps:g,data:f}}=Object(o.a)();return Object(i.useEffect)((()=>{!async function(){if(void 0!==(null==t?void 0:t.id)&&void 0!==e&&void 0!==e.fieldName&&(e.type===c.i.GEO_POINT||e.type===c.i.GEO_SHAPE)){var i;const s={indexPatternId:t.id,geoFieldName:e.fieldName,geoFieldType:e.type,filters:null!==(i=f.query.filterManager.getFilters())&&void 0!==i?i:[],query:{query:a.searchString,language:a.searchQueryLanguage}},n=g?await g.createLayerDescriptors.createESSearchSourceLayerDescriptor(s):null;n&&m([...b,n])}}()}),[t,a,e,g,f.query]),void 0===(null==s?void 0:s.examples)?null:Object(p.jsx)(n.a,{dataTestSubj:"dataVisualizerIndexBasedMapContent"},Object(p.jsx)(r.a,{config:e}),Object(p.jsx)(l.a,{examples:null==s?void 0:s.examples}),Object(p.jsx)(d.a,{className:"dvPanel__wrapper dvMap__wrapper",grow:!0},Object(p.jsx)(u.a,{layerList:b})))};var m=a(113),g=a(9),f=a(27);const j=()=>Object(p.jsx)(i.Fragment,null,Object(p.jsx)(g.EuiText,{textAlign:"center"},Object(p.jsx)(g.EuiIcon,{type:"warning"})),Object(p.jsx)(g.EuiText,{textAlign:"center",size:"xs"},Object(p.jsx)(f.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.fieldNotInDocsLabel",defaultMessage:"This field does not appear in any documents for the selected time range"}))),x=()=>Object(p.jsx)(i.Fragment,null,Object(p.jsx)(g.EuiSpacer,{size:"xxl"}),Object(p.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(p.jsx)(g.EuiFlexItem,{grow:!1},Object(p.jsx)(g.EuiLoadingSpinner,{size:"l"}))),Object(p.jsx)(g.EuiFlexGroup,{justifyContent:"spaceAround"},Object(p.jsx)(g.EuiFlexItem,{grow:!1},Object(p.jsx)(g.EuiText,{color:"subdued"},Object(p.jsx)(f.FormattedMessage,{id:"xpack.dataVisualizer.dataGrid.field.loadingLabel",defaultMessage:"Loading"})))));var v=a(103);const O=({item:e,dataView:t,combinedQuery:a,onAddFilter:i,totalDocuments:n})=>{const r={...e,stats:{...e.stats,totalDocuments:n}},{loading:l,type:o,existsInDocs:u,fieldName:d}=r,g=Object(s.a)();return Object(p.jsx)("div",{css:g,"data-test-subj":`dataVisualizerFieldExpandedRow-${d}`},!0===l?Object(p.jsx)(x,null):function(){var e,s;if(!1===u)return Object(p.jsx)(j,null);if(null!==(e=r.stats)&&void 0!==e&&e.error)return Object(p.jsx)(v.a,{fieldName:d,error:null===(s=r.stats)||void 0===s?void 0:s.error});switch(o){case c.i.NUMBER:return Object(p.jsx)(m.e,{config:r,onAddFilter:i});case c.i.BOOLEAN:return Object(p.jsx)(m.a,{config:r,onAddFilter:i});case c.i.DATE:return Object(p.jsx)(m.b,{config:r});case c.i.GEO_POINT:case c.i.GEO_SHAPE:return Object(p.jsx)(b,{config:r,dataView:t,combinedQuery:a});case c.i.IP:return Object(p.jsx)(m.c,{config:r,onAddFilter:i});case c.i.KEYWORD:case c.i.VERSION:return Object(p.jsx)(m.d,{config:r,onAddFilter:i});case c.i.TEXT:return Object(p.jsx)(m.g,{config:r});default:return Object(p.jsx)(m.f,{config:r})}}())}},155:function(e,t,a){(function(e){var i;!function(e,s,n){function r(e){var t,a=this,i=(t=4022871197,function(e){e=String(e);for(var a=0;a<e.length;a++){var i=.02519603282416938*(t+=e.charCodeAt(a));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)});a.next=function(){var e=2091639*a.s0+2.3283064365386963e-10*a.c;return a.s0=a.s1,a.s1=a.s2,a.s2=e-(a.c=0|e)},a.c=1,a.s0=i(" "),a.s1=i(" "),a.s2=i(" "),a.s0-=i(e),a.s0<0&&(a.s0+=1),a.s1-=i(e),a.s1<0&&(a.s1+=1),a.s2-=i(e),a.s2<0&&(a.s2+=1),i=null}function l(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var a=new r(e),i=t&&t.state,s=a.next;return s.int32=function(){return 4294967296*a.next()|0},s.double=function(){return s()+11102230246251565e-32*(2097152*s()|0)},s.quick=s,i&&("object"==typeof i&&l(i,a),s.state=function(){return l(a,{})}),s}s&&s.exports?s.exports=o:a(59)&&a(69)?void 0===(i=function(){return o}.call(t,a,t,s))||(s.exports=i):this.alea=o}(0,e,a(59))}).call(this,a(68)(e))},156:function(e,t,a){(function(e){var i;!function(e,s,n){function r(e){var t=this,a="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:a+=e;for(var i=0;i<a.length+64;i++)t.x^=0|a.charCodeAt(i),t.next()}function l(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var a=new r(e),i=t&&t.state,s=function(){return(a.next()>>>0)/4294967296};return s.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=a.next,s.quick=s,i&&("object"==typeof i&&l(i,a),s.state=function(){return l(a,{})}),s}s&&s.exports?s.exports=o:a(59)&&a(69)?void 0===(i=function(){return o}.call(t,a,t,s))||(s.exports=i):this.xor128=o}(0,e,a(59))}).call(this,a(68)(e))},157:function(e,t,a){(function(e){var i;!function(e,s,n){function r(e){var t=this,a="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:a+=e;for(var i=0;i<a.length+64;i++)t.x^=0|a.charCodeAt(i),i==a.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function l(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var a=new r(e),i=t&&t.state,s=function(){return(a.next()>>>0)/4294967296};return s.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=a.next,s.quick=s,i&&("object"==typeof i&&l(i,a),s.state=function(){return l(a,{})}),s}s&&s.exports?s.exports=o:a(59)&&a(69)?void 0===(i=function(){return o}.call(t,a,t,s))||(s.exports=i):this.xorwow=o}(0,e,a(59))}).call(this,a(68)(e))},158:function(e,t,a){(function(e){var i;!function(e,s,n){function r(e){var t=this;t.next=function(){var e,a,i=t.x,s=t.i;return e=i[s],a=(e^=e>>>7)^e<<24,a^=(e=i[s+1&7])^e>>>10,a^=(e=i[s+3&7])^e>>>3,a^=(e=i[s+4&7])^e<<7,e=i[s+7&7],a^=(e^=e<<13)^e<<9,i[s]=a,t.i=s+1&7,a},function(e,t){var a,i=[];if(t===(0|t))i[0]=t;else for(t=""+t,a=0;a<t.length;++a)i[7&a]=i[7&a]<<15^t.charCodeAt(a)+i[a+1&7]<<13;for(;i.length<8;)i.push(0);for(a=0;a<8&&0===i[a];++a);for(8==a?i[7]=-1:i[a],e.x=i,e.i=0,a=256;a>0;--a)e.next()}(t,e)}function l(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var a=new r(e),i=t&&t.state,s=function(){return(a.next()>>>0)/4294967296};return s.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=a.next,s.quick=s,i&&(i.x&&l(i,a),s.state=function(){return l(a,{})}),s}s&&s.exports?s.exports=o:a(59)&&a(69)?void 0===(i=function(){return o}.call(t,a,t,s))||(s.exports=i):this.xorshift7=o}(0,e,a(59))}).call(this,a(68)(e))},159:function(e,t,a){(function(e){var i;!function(e,s,n){function r(e){var t=this;t.next=function(){var e,a,i=t.w,s=t.X,n=t.i;return t.w=i=i+1640531527|0,a=s[n+34&127],e=s[n=n+1&127],a^=a<<13,e^=e<<17,a^=a>>>15,e^=e>>>12,a=s[n]=a^e,t.i=n,a+(i^i>>>16)|0},function(e,t){var a,i,s,n,r,l=[],o=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,o=Math.max(o,t.length)),s=0,n=-32;n<o;++n)t&&(i^=t.charCodeAt((n+32)%t.length)),0===n&&(r=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,n>=0&&(r=r+1640531527|0,s=0==(a=l[127&n]^=i+r)?s+1:0);for(s>=128&&(l[127&(t&&t.length||0)]=-1),s=127,n=512;n>0;--n)i=l[s+34&127],a=l[s=s+1&127],i^=i<<13,a^=a<<17,i^=i>>>15,a^=a>>>12,l[s]=i^a;e.w=r,e.X=l,e.i=s}(t,e)}function l(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var a=new r(e),i=t&&t.state,s=function(){return(a.next()>>>0)/4294967296};return s.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=a.next,s.quick=s,i&&(i.X&&l(i,a),s.state=function(){return l(a,{})}),s}s&&s.exports?s.exports=o:a(59)&&a(69)?void 0===(i=function(){return o}.call(t,a,t,s))||(s.exports=i):this.xor4096=o}(0,e,a(59))}).call(this,a(68)(e))},160:function(e,t,a){(function(e){var i;!function(e,s,n){function r(e){var t=this,a="";t.next=function(){var e=t.b,a=t.c,i=t.d,s=t.a;return e=e<<25^e>>>7^a,a=a-i|0,i=i<<24^i>>>8^s,s=s-e|0,t.b=e=e<<20^e>>>12^a,t.c=a=a-i|0,t.d=i<<16^a>>>16^s,t.a=s-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):a+=e;for(var i=0;i<a.length+20;i++)t.b^=0|a.charCodeAt(i),t.next()}function l(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var a=new r(e),i=t&&t.state,s=function(){return(a.next()>>>0)/4294967296};return s.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},s.int32=a.next,s.quick=s,i&&("object"==typeof i&&l(i,a),s.state=function(){return l(a,{})}),s}s&&s.exports?s.exports=o:a(59)&&a(69)?void 0===(i=function(){return o}.call(t,a,t,s))||(s.exports=i):this.tychei=o}(0,e,a(59))}).call(this,a(68)(e))},161:function(e,t,a){var i;!function(s,n,r){var l,o=256,c=6,u="random",d=r.pow(o,c),p=r.pow(2,52),b=2*p,m=o-1;function g(e,t,a){var i=[],m=v(x((t=1==t?{entropy:!0}:t||{}).entropy?[e,O(n)]:null==e?function(){try{var e;return l&&(e=l.randomBytes)?e=e(o):(e=new Uint8Array(o),(s.crypto||s.msCrypto).getRandomValues(e)),O(e)}catch(e){var t=s.navigator,a=t&&t.plugins;return[+new Date,s,a,s.screen,O(n)]}}():e,3),i),g=new f(i),h=function(){for(var e=g.g(c),t=d,a=0;e<p;)e=(e+a)*o,t*=o,a=g.g(1);for(;e>=b;)e/=2,t/=2,a>>>=1;return(e+a)/t};return h.int32=function(){return 0|g.g(4)},h.quick=function(){return g.g(4)/4294967296},h.double=h,v(O(g.S),n),(t.pass||a||function(e,t,a,i){return i&&(i.S&&j(i,g),e.state=function(){return j(g,{})}),a?(r[u]=e,t):e})(h,m,"global"in t?t.global:this==r,t.state)}function f(e){var t,a=e.length,i=this,s=0,n=i.i=i.j=0,r=i.S=[];for(a||(e=[a++]);s<o;)r[s]=s++;for(s=0;s<o;s++)r[s]=r[n=m&n+e[s%a]+(t=r[s])],r[n]=t;(i.g=function(e){for(var t,a=0,s=i.i,n=i.j,r=i.S;e--;)t=r[s=m&s+1],a=a*o+r[m&(r[s]=r[n=m&n+t])+(r[n]=t)];return i.i=s,i.j=n,a})(o)}function j(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function x(e,t){var a,i=[],s=typeof e;if(t&&"object"==s)for(a in e)try{i.push(x(e[a],t-1))}catch(e){}return i.length?i:"string"==s?e:e+"\0"}function v(e,t){for(var a,i=e+"",s=0;s<i.length;)t[m&s]=m&(a^=19*t[m&s])+i.charCodeAt(s++);return O(t)}function O(e){return String.fromCharCode.apply(0,e)}if(v(r.random(),n),e.exports){e.exports=g;try{l=a(162)}catch(e){}}else void 0===(i=function(){return g}.call(t,a,t,e))||(e.exports=i)}("undefined"!=typeof self?self:this,[],Math)},162:function(e,t){},59:function(e,t,a){e.exports=a(20)(1808)},68:function(e,t,a){e.exports=a(20)(448)},69:function(e,t){(function(t){e.exports=t}).call(this,{})},78:function(e,t,a){"use strict";a.d(t,"c",(function(){return te})),a.d(t,"b",(function(){return ae})),a.d(t,"a",(function(){return ie}));var i=a(2),s=a(0),n=a.n(s),r=a(9),l=a(39),o=a(32),c=a(15),u=a(64),d=a(79),p=a(58),b=a(94),m=a(66),g=a(76),f=a(92),j=a(114),x=a(81),v=a(55),O=a(27),h=a(118);const y=({metricsStats:e,fieldsCountStats:t,showEmptyFields:a,toggleShowEmptyFields:s})=>{const{euiTheme:n}=Object(r.useEuiTheme)(),l=Object(i.css)({marginLeft:n.size.xs,[Object(r.useEuiBreakpoint)(["xs","s"])]:{flexDirection:"column",alignItems:"flex-start"}},"","");return Object(i.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",css:l,"data-test-subj":"dataVisualizerFieldCountPanel",responsive:!1,wrap:!0},Object(i.jsx)(h.b,{fieldsCountStats:t}),Object(i.jsx)(h.a,{metricsStats:e}),Object(i.jsx)(r.EuiFlexItem,{css:h.c},Object(i.jsx)(r.EuiSwitch,{"data-test-subj":"dataVisualizerShowEmptyFieldsSwitch",label:Object(i.jsx)(O.FormattedMessage,{id:"xpack.dataVisualizer.searchPanel.showEmptyFields",defaultMessage:"Show empty fields"}),checked:a,onChange:s})))};var E=a(3),S=a(77),F=a(104),w=a(28),N=a(29),M=a.n(N),A=a(44);function _(){return Object(i.jsx)(r.EuiFlexItem,{style:{alignItems:"center"}},Object(i.jsx)(r.EuiLoadingSpinner,{size:"l","data-test-subj":"loadingSpinner"}))}const z=({width:e,chartPoints:t,timeRangeEarliest:a,timeRangeLatest:n,interval:l,loading:o})=>{const{services:{data:c,uiSettings:u,fieldFormats:d,charts:p}}=Object(v.a)(),b=p.theme.useChartsTheme(),m=p.theme.useChartsBaseTheme(),g=d.deserialize({id:"date"}),f=u.get("visualization:useLegacyTimeAxis",!1),j=E.i18n.translate("xpack.dataVisualizer.dataGrid.field.documentCountChart.seriesLabel",{defaultMessage:"document count"}),x=Object(s.useMemo)((()=>t.length<1?[{time:a,value:0}]:1===t.length?[...t,{time:l?Number(t[0].time)+l:a,value:0}]:t),[t,a,n,l]),O=Object(s.useCallback)((e=>{c.query.timefilter.timefilter.setTime({from:M()(e.from).toISOString(),to:M()(e.to).toISOString(),mode:"absolute"})}),[c]),h=function(e){return e.isDefault("dateFormat:tz")?M.a.tz.guess()||M()().format("Z"):e.get("dateFormat:tz","Browser")}(u);return Object(i.jsx)(r.EuiFlexGroup,{alignItems:"center",css:Object(i.css)({width:null!=e?e:"100%"},"",""),"data-test-subj":"dataVisualizerDocumentCountChart"},o?Object(i.jsx)(_,null):Object(i.jsx)(w.Chart,{size:{width:"100%",height:120}},Object(i.jsx)(w.Settings,{onBrushEnd:({x:e})=>{if(!e)return;const[t,a]=e;O({from:t,to:a})},onElementClick:([e])=>{const t=e[0].x;O({from:t,to:t+l})},theme:b,baseTheme:m,locale:E.i18n.getLocale()}),Object(i.jsx)(w.Axis,{id:"bottom",position:w.Position.Bottom,showOverlappingTicks:!0,tickFormat:e=>g.convert(e),labelFormat:f?void 0:()=>"",timeAxisLayerCount:f?0:2,style:f?{}:A.MULTILAYER_TIME_AXIS_STYLE}),Object(i.jsx)(w.Axis,{id:"left",position:w.Position.Left}),Object(i.jsx)(w.HistogramBarSeries,{id:"document_count",name:j,xScaleType:w.ScaleType.Time,yScaleType:w.ScaleType.Linear,xAccessor:"time",yAccessors:["value"],data:x,timeZone:h,yNice:!0})))};var T=a(105),V=a(106);const C=Object(i.jsx)("div",{"data-test-subj":"dvRandomSamplerCalculatingProbabilityMsg"},Object(i.jsx)(r.EuiSpacer,{size:"m"}),Object(i.jsx)(O.FormattedMessage,{id:"xpack.dataVisualizer.randomSamplerSettingsPopUp.calculatingProbabilityLabel",defaultMessage:"Calculating the optimal probability"})),I=({documentCountStats:e,totalCount:t,samplingProbability:a,setSamplingProbability:l,loading:o,randomSamplerPreference:c,setRandomSamplerPreference:u})=>{const[d,p]=Object(s.useState)(!1),b=Object(s.useCallback)((()=>{p(!d)}),[d]),m=Object(s.useCallback)((()=>{p(!1)}),[p]),g=Object(s.useMemo)((()=>{switch(c){case S.b.OFF:return E.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.offCalloutMessage",{defaultMessage:"Random sampling can be turned on for the total document count and chart to increase speed although some accuracy will be lost."});case S.b.ON_AUTOMATIC:return E.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.onAutomaticCalloutMessage",{defaultMessage:"The total document count and chart use random sampler aggregations. The probability is automatically set to balance accuracy and speed."});case S.b.ON_MANUAL:default:return E.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.onManualCalloutMessage",{defaultMessage:"The total document count and chart use random sampler aggregations. A lower percentage probability increases performance, but some accuracy is lost."})}}),[c]);if(void 0===e)return void 0!==t?Object(i.jsx)(F.a,{totalCount:t}):null;const{timeRangeEarliest:f,timeRangeLatest:j}=e;if(void 0===f||void 0===j)return Object(i.jsx)(F.a,{totalCount:t});let x=[];if(void 0!==e.buckets){const t=null==e?void 0:e.buckets;x=Object.entries(t).map((([e,t])=>({time:+e,value:t})))}const v=!0===e.randomlySampled;return Object(i.jsx)(n.a.Fragment,null,Object(i.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs"},Object(i.jsx)(F.a,{totalCount:t,approximate:v,loading:o}),Object(i.jsx)(r.EuiFlexItem,{grow:!1,style:{marginLeft:"auto"}},Object(i.jsx)(r.EuiPopover,{"data-test-subj":"dvRandomSamplerOptionsPopover",id:"dataVisualizerSamplingOptions",button:Object(i.jsx)(r.EuiToolTip,{content:E.i18n.translate("xpack.dataVisualizer.samplingOptionsButton",{defaultMessage:"Sampling options"})},Object(i.jsx)(r.EuiButtonIcon,{size:"xs",iconType:"gear",onClick:b,"data-test-subj":"dvRandomSamplerOptionsButton","aria-label":E.i18n.translate("xpack.dataVisualizer.samplingOptionsButton",{defaultMessage:"Sampling options"})})),isOpen:d,closePopover:m,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(i.jsx)(r.EuiPanel,{style:{maxWidth:400}},Object(i.jsx)(r.EuiFlexItem,{grow:!0},Object(i.jsx)(r.EuiCallOut,{size:"s",color:"primary",title:g})),Object(i.jsx)(r.EuiSpacer,{size:"m"}),Object(i.jsx)(r.EuiFormRow,{"data-test-subj":"dvRandomSamplerOptionsFormRow",label:E.i18n.translate("xpack.dataVisualizer.randomSamplerSettingsPopUp.randomSamplerRowLabel",{defaultMessage:"Random sampling"})},Object(i.jsx)(r.EuiSelect,{"data-test-subj":"dvRandomSamplerOptionsSelect",options:S.d,value:c,onChange:e=>u(e.target.value)})),c===S.b.ON_MANUAL?Object(i.jsx)(T.a,{samplingProbability:a,setSamplingProbability:l}):null,c===S.b.ON_AUTOMATIC?o?C:Object(i.jsx)(V.a,{samplingProbability:a}):null)),Object(i.jsx)(r.EuiFlexItem,null))),Object(i.jsx)(z,{chartPoints:x,timeRangeEarliest:f,timeRangeLatest:j,interval:e.interval,loading:o}))};var k=a(7),R=a(107),P=a(85);const L=({overallStats:e,setVisibleFieldNames:t,visibleFieldNames:a,showEmptyFields:n})=>{const r=Object(s.useMemo)((()=>{const t=[];return e&&Object.keys(e).forEach((a=>{const i=e[a];Array.isArray(i)&&i.length>0&&i.forEach((e=>{!0!==e.existsInDocs&&!0!==n||void 0===e.fieldName?t.push({value:e.fieldName,disabled:!0}):t.push({value:e.fieldName})}))})),t}),[e,n]),l=Object(s.useMemo)((()=>E.i18n.translate("xpack.dataVisualizer.index.fieldNameSelect",{defaultMessage:"Field name"})),[]);return Object(i.jsx)(P.a,{title:l,options:r,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldNameSelect"})};var D=a(176),q=a(120),B=a(83);const G=({indexedFieldTypes:e,setVisibleFieldTypes:t,visibleFieldTypes:a})=>{const l=Object(m.a)(),o=Object(s.useMemo)((()=>e.map((e=>{var t;const a=null!==(t=Object(D.a)(e))&&void 0!==t?t:e;return{value:e,name:Object(i.jsx)(r.EuiFlexGroup,null,Object(i.jsx)(r.EuiFlexItem,{grow:!0}," ",a),e&&Object(i.jsx)(r.EuiFlexItem,{grow:!1},Object(i.jsx)(B.a,{type:e,tooltipEnabled:!1})))}}))),[e]),c=Object(s.useMemo)((()=>E.i18n.translate("xpack.dataVisualizer.index.fieldTypeSelect",{defaultMessage:"Field type"})),[]);return Object(i.jsx)(n.a.Fragment,null,Object(i.jsx)(P.a,{title:c,options:o,onChange:t,checkedOptions:a,dataTestSubj:"dataVisualizerFieldTypeSelect",postfix:Object(i.jsx)(q.a,{fieldTypes:e}),cssStyles:{filterGroup:Object(i.css)("margin-left:",l.euiSizeS,";","")}}))},Q=({dataView:e,searchString:t,searchQuery:a,searchQueryLanguage:s,overallStats:n,indexedFieldTypes:l,setVisibleFieldTypes:o,visibleFieldTypes:c,setVisibleFieldNames:u,visibleFieldNames:d,setSearchParams:p,showEmptyFields:b})=>{const m=Object(i.css)({marginLeft:"0px !important",paddingLeft:"0px !important",paddingRight:"0px !important",flexDirection:"row",[Object(r.useEuiBreakpoint)(["xs","s","m","l"])]:{padding:0}},"",""),g=Object(i.css)({alignItems:"baseline",[Object(r.useEuiBreakpoint)(["xs","s","m","l"])]:{flexDirection:"column"}},"",""),f=Object(i.css)({[Object(r.useEuiBreakpoint)(["xs","s","m","l"])]:{minWidth:"max(100%, 300px)"}},"",""),j=Object(r.useIsWithinMaxBreakpoint)("xl");return Object(i.jsx)(r.EuiFlexGroup,{gutterSize:"none","data-test-subj":"dataVisualizerSearchPanel",css:g,responsive:!1},Object(i.jsx)(r.EuiFlexItem,{grow:9,css:f},Object(i.jsx)(R.a,{dataView:e,setSearchParams:p,searchString:t,searchQuery:a,searchQueryLanguage:s})),j?Object(i.jsx)(r.EuiSpacer,{size:"s"}):null,Object(i.jsx)(r.EuiFlexItem,{grow:2,css:m},Object(i.jsx)(L,{overallStats:n,setVisibleFieldNames:u,visibleFieldNames:d,showEmptyFields:b}),Object(i.jsx)(G,{indexedFieldTypes:l,setVisibleFieldTypes:o,visibleFieldTypes:c})))};var U=a(6),$=a(60),X=a(75),W=a.n(X);const H=({icon:e,iconAreaLabel:t,title:a,description:s,onClick:n,href:l,isDisabled:o,"data-test-subj":c})=>{const u=Object(m.a)(),d={...l?{href:l}:{},...n?{onClick:n}:{}};return Object(i.jsx)(r.EuiPanel,{style:{cursor:o?"not-allowed":void 0},hasShadow:!1,hasBorder:!0},Object(i.jsx)(r.EuiLink,W()({style:{display:"block",pointerEvents:o?"none":void 0,background:"transparent",outline:"none"},"data-test-subj":c,color:"subdued"},d),Object(i.jsx)(r.EuiFlexGroup,{gutterSize:"s",responsive:!0},Object(i.jsx)(r.EuiFlexItem,{grow:!1,css:Object(i.css)({paddingTop:u.euiSizeXS},"","")},"string"==typeof e?Object(i.jsx)(r.EuiIcon,{size:"m",type:e,"aria-label":t}):e),Object(i.jsx)(r.EuiFlexItem,null,Object(i.jsx)(r.EuiTitle,{size:"xs"},Object(i.jsx)("h3",null,a)),Object(i.jsx)(r.EuiText,{color:"subdued",size:"s"},Object(i.jsx)("p",null,s))))))},Y=({dataView:e,searchString:t,searchQueryLanguage:a,getAdditionalLinks:l})=>{const[o]=Object(c.f)("_g"),[u,d]=Object(s.useState)(""),[p,b]=Object(s.useState)(),{services:{data:m,application:{capabilities:g},discover:f}}=Object(v.a)();Object(s.useEffect)((()=>{let i=!1;const s=e.id,n=e.getIndexPattern();return Array.isArray(l)&&void 0!==s&&Promise.all(l.map((async e=>{const t=await e({dataViewId:s,dataViewTitle:n});if(Array.isArray(t))return await Promise.all(t.map((async e=>({...e,canDisplay:await e.canDisplay(),href:await e.getUrl()}))))}))).then((e=>{b(Object(U.flatten)(e).filter($.a).filter((e=>!0===e.canDisplay)))})),(async()=>{var e,n,r;if(null===(e=null===(n=g.discover)||void 0===n?void 0:n.show)||void 0===e||!e)return;if(!f.locator)return void console.error("Discover locator not available");const l=await f.locator.getUrl({indexPatternId:s,filters:null!==(r=m.query.filterManager.getFilters())&&void 0!==r?r:[],query:t&&void 0!==a?{query:t,language:a}:void 0,timeRange:null!=o&&o.time?o.time:void 0,refreshInterval:null!=o&&o.refreshInterval?o.refreshInterval:void 0});i||d(l)})(),()=>{i=!0}}),[e,t,a,o,g,f,m.query,l]);const j=u||Array.isArray(p)&&p.length>0,x=Object(i.css)({[Object(r.useEuiBreakpoint)(["xl","xxl"])]:{width:"240px"},width:"100%"},"","");return j?Object(i.jsx)("div",{"data-test-subj":"dataVisualizerActionsPanel",css:x},Object(i.jsx)(r.EuiTitle,{size:"s"},Object(i.jsx)("h2",null,Object(i.jsx)(O.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.exploreTitle",defaultMessage:"Explore your data"}))),Object(i.jsx)(r.EuiSpacer,{size:"m"}),u&&Object(i.jsx)(n.a.Fragment,null,Object(i.jsx)(H,{href:u,icon:"discoverApp",description:E.i18n.translate("xpack.dataVisualizer.index.actionsPanel.viewIndexInDiscoverDescription",{defaultMessage:"Explore the documents in your index."}),title:Object(i.jsx)(O.FormattedMessage,{id:"xpack.dataVisualizer.index.actionsPanel.discoverAppTitle",defaultMessage:"Discover"}),"data-test-subj":"dataVisualizerViewInDiscoverCard"}),Object(i.jsx)(r.EuiSpacer,{size:"m"})),Array.isArray(p)&&p.map((e=>Object(i.jsx)(s.Fragment,{key:`dv-action-card-${e.title}`},Object(i.jsx)(H,{href:e.href,icon:e.icon,description:e.description,title:e.title,"data-test-subj":e["data-test-subj"],key:e.href}),Object(i.jsx)(r.EuiSpacer,{size:"m"}))))):null};var J=a(71);function K(e){const{services:{dataViewFieldEditor:t,application:a}}=Object(v.a)(),{useNewFieldsApi:n,currentDataView:l}=e,o=!!(null==t?void 0:t.userPermissions.editIndexPattern())&&n,[c,d]=Object(s.useState)(!1),p=Object(s.useRef)();return Object(s.useEffect)((()=>()=>{p.current&&p.current()}),[]),void 0!==t&&l&&o?Object(i.jsx)(r.EuiPopover,{panelPaddingSize:"s",isOpen:c,closePopover:()=>{d(!1)},ownFocus:!0,"data-test-subj":"dataVisualizerDataViewManagementPopover",button:Object(i.jsx)(r.EuiButtonIcon,{color:"text",iconType:"boxesHorizontal","data-test-subj":"dataVisualizerDataViewManagementButton","aria-label":E.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.actionsPopoverLabel",{defaultMessage:"Data view settings"}),onClick:()=>{d(!c)}})},Object(i.jsx)(r.EuiContextMenuPanel,{"data-test-subj":"dataVisualizerDataViewManagementMenu",size:"s",items:[Object(i.jsx)(r.EuiContextMenuItem,{key:"add",icon:"indexOpen","data-test-subj":"dataVisualizerAddDataViewFieldAction",onClick:()=>{d(!1),p.current=t.openEditor({ctx:{dataView:l},onSave:()=>{const e={lastRefresh:Date.now()};u.e.next(e)}})}},E.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.addFieldButton",{defaultMessage:"Add field to data view"})),Object(i.jsx)(r.EuiContextMenuItem,{key:"manage",icon:"indexSettings","data-test-subj":"dataVisualizerManageDataViewAction",onClick:()=>{var t;d(!1),a.navigateToApp("management",{path:`/kibana/dataViews/dataView/${null===(t=e.currentDataView)||void 0===t?void 0:t.id}`})}},E.i18n.translate("xpack.dataVisualizer.index.dataViewManagement.manageFieldButton",{defaultMessage:"Manage data view fields"}))]})):null}var Z=a(112);const ee={match_all:{}};function te(){return{overallStats:{totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]},metricConfigs:[],totalMetricFieldCount:0,populatedMetricFieldCount:0,metricsLoaded:!1,nonMetricConfigs:[],nonMetricsLoaded:!1,documentCountStats:void 0}}const ae=e=>({pageIndex:0,pageSize:25,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],samplerShardSize:5e3,searchString:"",searchQuery:ee,searchQueryLanguage:p.b.KUERY,filters:[],showDistributions:!0,showAllFields:!1,showEmptyFields:!1,probability:null,rndSamplerPref:S.b.ON_AUTOMATIC,...e}),ie=e=>{var t,a,p,O;const h=Object(m.a)(),[E,F]=Object(d.b)(g.c,S.b.ON_AUTOMATIC),[w,N]=Object(d.b)(g.d,S.a),[M,A]=Object(d.b)(g.b,u.c.EXCLUDE),_=Object(s.useMemo)((()=>ae({rndSamplerPref:E,probability:w})),[]),{services:z}=Object(v.a)(),{uiSettings:T,data:V}=z,[C,R]=Object(c.e)(x.a,_),[P,L]=Object(c.f)("_g"),[D,q]=Object(s.useState)(e.currentSavedSearch),{currentDataView:B,currentSessionId:G,getAdditionalLinks:U}=e,$=B.fields,X=Object(s.useMemo)((()=>{const e=[];return $.forEach((t=>{if(!k.h.includes(t.name)&&!0!==t.scripted){const a=Object(b.a)(t);void 0===a||e.includes(a)||e.push(a)}})),e.sort()}),[$]),W=Object(s.useCallback)((e=>{null!==D&&q(null),R({...C,searchQuery:e.searchQuery,searchString:e.searchString,searchQueryLanguage:e.queryLanguage,filters:e.filters})}),[D,C,R]),H=null!==(t=C.visibleFieldTypes)&&void 0!==t?t:_.visibleFieldTypes,ee=null!==(a=C.visibleFieldNames)&&void 0!==a?a:_.visibleFieldNames,te=null!==(p=C.showEmptyFields)&&void 0!==p?p:_.showEmptyFields,ie=Object(s.useMemo)((()=>({dataView:B,savedSearch:D,sessionId:G,visibleFieldNames:ee,allowEditDataView:!0,id:"index_data_visualizer"})),[B.id,null==D?void 0:D.id,ee,G]),{configs:se,searchQueryLanguage:ne,searchString:re,overallStats:le,searchQuery:oe,documentCountStats:ce,metricsStats:ue,timefilter:de,setLastRefresh:pe,progress:be,extendedColumns:me,overallStatsProgress:ge}=Object(Z.a)(ie,C,E,L);Object(s.useEffect)((()=>{var e,t;switch(E){case S.b.OFF:return void fe(1);case S.b.ON_MANUAL:return void fe(null!==(e=null!==(t=null==C?void 0:C.probability)&&void 0!==t?t:null==ce?void 0:ce.probability)&&void 0!==e?e:null);case S.b.ON_AUTOMATIC:default:return void fe(null)}}),[C.probability,null==ce?void 0:ce.probability,E]);const fe=Object(s.useCallback)((e=>{E===S.b.ON_MANUAL&&null!==e&&N(e),R({...C,probability:e})}),[C,N,E,R]),je=Object(s.useCallback)((e=>{e===S.b.ON_MANUAL&&fe(w&&w>0&&w<=.5?w:S.a),F(e)}),[w,fe,F]);Object(s.useEffect)((function(){return()=>{V.query.filterManager.getFilters().filter((e=>{var t;return(null===(t=e.$state)||void 0===t?void 0:t.store)===l.FilterStateStore.APP_STATE})).forEach((e=>V.query.filterManager.removeFilter(e)))}}),[V.query.filterManager]),Object(s.useEffect)((()=>{pe(Date.now())}),[B.id,pe]),Object(s.useEffect)((()=>{void 0!==(null==P?void 0:P.time)&&de.setTime({from:P.time.from,to:P.time.to})}),[JSON.stringify(null==P?void 0:P.time),de]),Object(s.useEffect)((()=>{void 0!==(null==P?void 0:P.refreshInterval)&&de.setRefreshInterval(P.refreshInterval)}),[JSON.stringify(null==P?void 0:P.refreshInterval),de]);const xe=Object(s.useCallback)(((e,t,a)=>{var i;const s=Object(o.generateFilters)(V.query.filterManager,e,t,a,B);s&&V.query.filterManager.addFilters(s);const n={query:re||"",language:ne},r=Object(J.a)({query:re||"",language:ne},null!==(i=V.query.filterManager.getFilters())&&void 0!==i?i:[],B,T);W({searchQuery:r,searchString:n.query,queryLanguage:n.language,filters:V.query.filterManager.getFilters()})}),[B,V.query.filterManager,ne,re,W,T]),ve=Object(s.useMemo)((()=>{let e=0,t=0;return Object.keys(le).forEach((e=>{const a=le[e];Array.isArray(a)&&a.length>0&&(t+=a.length)})),e=!0===te?t:le.aggregatableExistsFields.length+le.nonAggregatableExistsFields.length,{visibleFieldsCount:e,totalFieldsCount:t}}),[le,te]),Oe=Object(s.useCallback)((function(e,t){return e.reduce(((e,a)=>{const s=t.find((e=>e.fieldName===a));return void 0!==s&&(e[a]=Object(i.jsx)(j.a,{item:s,dataView:B,combinedQuery:{searchQueryLanguage:ne,searchString:re},onAddFilter:xe,totalDocuments:le.totalCount})),e}),{})}),[B,ne,re,xe,le.totalCount]),he=Object(s.useRef)();Object(s.useEffect)((()=>{const e=he;return()=>{e.current&&e.current()}}),[]),Object(s.useEffect)((()=>{null==V||V.query.queryString.setQuery({query:re,language:ne})}),[V,ne,re]);const ye=Object(s.useMemo)((()=>void 0!==B.timeFieldName&&""!==B.timeFieldName),[B.timeFieldName]),Ee=Object(r.useIsWithinMaxBreakpoint)("l"),Se=Object(i.css)({[Object(r.useEuiBreakpoint)(["xs","s","m","l"])]:{flexDirection:"column",alignItems:"flex-start"}},"","");return Object(i.jsx)(r.EuiPageTemplate,{offset:0,restrictWidth:!1,bottomBorder:!1,grow:!1,"data-test-subj":"dataVisualizerIndexPage",paddingSize:"none"},Object(i.jsx)(r.EuiPageTemplate.Section,null,Object(i.jsx)(r.EuiPageTemplate.Header,{"data-test-subj":"dataVisualizerPageHeader",css:Se},Object(i.jsx)(r.EuiFlexGroup,{"data-test-subj":"dataViewTitleHeader",direction:"row",alignItems:"center",css:Object(i.css)({padding:`${h.euiSizeS} 0`,marginRight:`${h.euiSize}`},"","")},Object(i.jsx)(r.EuiTitle,{size:"s"},Object(i.jsx)("h2",null,B.getName())),Object(i.jsx)(K,{currentDataView:B,useNewFieldsApi:!0})),Ee?Object(i.jsx)(r.EuiSpacer,{size:"m"}):null,Object(i.jsx)(r.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s","data-test-subj":"dataVisualizerTimeRangeSelectorSection"},ye?Object(i.jsx)(r.EuiFlexItem,{grow:!1},Object(i.jsx)(u.d,{frozenDataPreference:M,setFrozenDataPreference:A,dataView:B,query:void 0,disabled:!1,timefilter:de})):null,Object(i.jsx)(r.EuiFlexItem,{grow:!1},Object(i.jsx)(u.b,{isAutoRefreshOnly:!ye,showRefresh:!ye,width:"full"})))),Object(i.jsx)(r.EuiSpacer,{size:"m"}),Object(i.jsx)(r.EuiFlexGroup,{gutterSize:"m",direction:Ee?"column":"row"},Object(i.jsx)(r.EuiFlexItem,null,Object(i.jsx)(r.EuiPanel,{hasShadow:!1,hasBorder:!0},Object(i.jsx)(Q,{dataView:B,searchString:re,searchQuery:oe,searchQueryLanguage:ne,setSearchParams:W,overallStats:le,indexedFieldTypes:X,setVisibleFieldTypes:e=>{R({...C,visibleFieldTypes:e})},visibleFieldTypes:H,visibleFieldNames:ee,setVisibleFieldNames:e=>{R({...C,visibleFieldNames:e})},showEmptyFields:te,onAddFilter:xe}),void 0!==(null==le?void 0:le.totalCount)&&Object(i.jsx)(n.a.Fragment,null,Object(i.jsx)(r.EuiSpacer,{size:"m"}),Object(i.jsx)(r.EuiFlexGroup,{gutterSize:"s",direction:"column"},Object(i.jsx)(I,{documentCountStats:ce,totalCount:le.totalCount,setSamplingProbability:fe,samplingProbability:null===C.probability?null==ce?void 0:ce.probability:C.probability,loading:ge.loaded<100,randomSamplerPreference:E,setRandomSamplerPreference:je}))),Object(i.jsx)(r.EuiSpacer,{size:"m"}),Object(i.jsx)(y,{showEmptyFields:te,toggleShowEmptyFields:()=>{R({...C,showEmptyFields:!C.showEmptyFields})},fieldsCountStats:ve,metricsStats:ue}),Object(i.jsx)(r.EuiSpacer,{size:"m"}),Object(i.jsx)(r.EuiProgress,{value:be,max:100,size:"xs"}),Object(i.jsx)(f.a,{items:se,pageState:C,updatePageState:R,getItemIdToExpandedRowMap:Oe,extendedColumns:me,loading:be<100,overallStatsRunning:ge.isRunning,showPreviewByDefault:null===(O=C.showDistributions)||void 0===O||O,onChange:R,totalCount:le.totalCount}))),Ee?Object(i.jsx)(r.EuiSpacer,{size:"m"}):null,Object(i.jsx)(r.EuiFlexItem,{grow:!1},Object(i.jsx)(Y,{dataView:B,searchQueryLanguage:ne,searchString:re,getAdditionalLinks:U})))))}},81:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return s}));const i="DATA_VISUALIZER_INDEX_VIEWER",s=10}}]);