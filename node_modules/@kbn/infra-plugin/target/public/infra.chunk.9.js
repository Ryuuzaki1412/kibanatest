/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[9],{109:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),i=!1,n={};t.default=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];var s=[],c=[],l=function(e){var t=a.createContext(n);i&&e&&(t.displayName=e),s.push(t),c.push(function(e){return function(){var t=a.useContext(e);if(i&&t===n){var r=e.displayName?"The context consumer of "+e.displayName+" must be wrapped with its corresponding Provider":"Component must be wrapped with Provider.";console.warn(r)}return t}}(t))};r.length?r.forEach((function(e){return l(e.name)})):l(e.name);var u=function(t){for(var i=t.children,n=function(e,t){if(null==e)return{};var r,a,i={},n=Object.keys(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||(i[r]=e[r]);return i}(t,["children"]),o=e(n),c=i,l=0;l<s.length;l+=1){var u=s[l],m=r[l]||function(e){return e};c=a.createElement(u.Provider,{value:m(o)},c)}return c};return i&&e.name&&(u.displayName="Constate"),[u].concat(c)}},110:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return f})),r.d(t,"c",(function(){return p}));var a=r(109),i=r.n(a),n=r(2),o=r.n(n),s=r(24),c=r(111),l=r(1);const u=l.i18n.translate("xpack.infra.sourceConfiguration.missingHttp",{defaultMessage:"Failed to load source: No HTTP client available."});class MissingHttpClientException extends Error{constructor(){super(u),Object.setPrototypeOf(this,new.target.prototype),this.name="MissingHttpClientException"}}const m=(e,t)=>e?"metrics"===t?e.configuration.metricAlias:`${e.configuration.metricAlias}`:"unknown-index",[d,f]=i()((({sourceId:e})=>{var t;const{services:r}=Object(s.useKibana)(),a=(()=>{const{notifications:e}=Object(s.useKibana)();return{updateFailure:t=>{e.toasts.danger({toastLifeTimeMs:3e3,title:l.i18n.translate("xpack.infra.sourceConfiguration.updateFailureTitle",{defaultMessage:"Configuration update failed"}),body:[l.i18n.translate("xpack.infra.sourceConfiguration.updateFailureBody",{defaultMessage:"We couldn't apply the changes to the Metrics configuration. Try again later."}),t].filter(Boolean).join(" ")})},updateSuccess:()=>{e.toasts.success({toastLifeTimeMs:3e3,title:l.i18n.translate("xpack.infra.sourceConfiguration.updateSuccessTitle",{defaultMessage:"Metrics settings successfully updated"})})}}})(),i=r.http,o=`/api/metrics/source/${e}`,[u,d]=Object(n.useState)(void 0),[f,p]=Object(c.b)({cancelPreviousOn:"resolution",createPromise:()=>{if(!i)throw new MissingHttpClientException;return i.fetch(o,{method:"GET"})},onResolve:e=>{e&&d(e.source)}},[i,e]),[b,g]=Object(c.b)({createPromise:async e=>{if(!i)throw new MissingHttpClientException;return await i.patch(o,{method:"PATCH",body:JSON.stringify(e)})},onResolve:e=>{e&&(a.updateSuccess(),d(e.source))},onReject:e=>{var t;a.updateFailure(null===(t=e.body)||void 0===t?void 0:t.message)}},[i,e]);Object(n.useEffect)((()=>{p()}),[p,e]);const h="rejected"===f.state,y="uninitialized"===f.state,v="pending"===f.state,O=v||"pending"===b.state,j=u?!!u.version:void 0,E=Boolean(null==u||null===(t=u.status)||void 0===t?void 0:t.metricIndicesExist),T=null==u?void 0:u.version;return{createSourceConfiguration:g,createDerivedIndexPattern:()=>({fields:null!=u&&u.status?u.status.indexFields:[],title:m(u,"metrics")}),isLoading:O,isLoadingSource:v,isUninitialized:y,hasFailedLoadingSource:h,loadSource:p,loadSourceRequest:f,loadSourceFailureMessage:h?`${f.value}`:void 0,metricIndicesExist:E,source:u,sourceExists:j,sourceId:e,updateSourceConfiguration:g,version:T}})),p=e=>(t="default")=>function(r){return o.a.createElement(d,{sourceId:t},o.a.createElement(e,r))}},115:function(e,t,r){"use strict";r.d(t,"b",(function(){return h})),r.d(t,"g",(function(){return y}));var a=r(18),i=r.n(a),n=r(0),o=r(109),s=r.n(o),c=r(2),l=r(9);r.d(t,"c",(function(){return l.d})),r.d(t,"a",(function(){return l.c})),r.d(t,"e",(function(){return l.g})),r.d(t,"d",(function(){return l.f})),r.d(t,"f",(function(){return l.h}));var u=r(132),m=r(26),d=r(141);n.type({fromTimestamp:n.number,toTimestamp:n.number,interval:n.string});const f=">=10s",p={type:l.c.line,yAxisMode:l.d.fromZero,stack:!1},b={aggregation:"avg",metrics:[{aggregation:"avg",field:"system.cpu.total.norm.pct",color:m.a.color0},{aggregation:"avg",field:"kubernetes.pod.cpu.usage.node.pct",color:m.a.color1},{aggregation:"avg",field:"docker.cpu.total.pct",color:m.a.color2}],source:"default"};function g(e,t){const r=localStorage.getItem(e),[a,i]=Object(c.useState)(function(e,t){if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}(r,t));return Object(c.useEffect)((()=>{localStorage.setItem(e,JSON.stringify(a))}),[e,a]),[a,i]}const[h,y]=s()((()=>{const e={from:"now-1h",to:"now"},[t]=Object(d.a)(e),{from:r,to:a}=t(),[n,o]=g("MetricsExplorerOptions",b),[s,l]=Object(c.useState)({from:r,to:a,interval:f}),[m,h]=Object(c.useState)((({from:e,to:t})=>({fromTimestamp:i.a.parse(e).valueOf(),toTimestamp:i.a.parse(t,{roundUp:!0}).valueOf(),interval:f}))({from:r,to:a}));Object(d.b)(e,{from:s.from,to:s.to});const[y,v]=g("MetricsExplorerChartOptions",p),[O,j]=Object(c.useState)(!1),{metricThresholdPrefill:E}=Object(u.b)(),T=Object(c.useMemo)((()=>E),[E]);return Object(c.useEffect)((()=>{if(T){const{setPrefillOptions:e}=T,{metrics:t,groupBy:r,filterQuery:a}=n;e({metrics:t,groupBy:r,filterQuery:a})}}),[n,T]),{defaultViewState:{options:b,chartOptions:p,currentTimerange:s},options:n,chartOptions:y,setChartOptions:v,timeRange:s,isAutoReloading:O,setOptions:o,setTimeRange:l,startAutoReload:()=>j(!0),stopAutoReload:()=>j(!1),timestamps:m,setTimestamps:h}}))},128:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(67).__importDefault(r(135));t.default=function(e){a.default((function(){e()}))}},132:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return c}));var a=r(109),i=r.n(a),n=r(8),o=r(2);const[s,c]=i()((()=>({metricThresholdPrefill:(()=>{const[e,t]=Object(o.useState)({groupBy:void 0,filterQuery:void 0,metrics:[]}),{groupBy:r,filterQuery:a,metrics:i}=e;return{groupBy:r,filterQuery:a,metrics:i,setPrefillOptions(r){Object(n.isEqual)(r,e)||t(r)}}})(),inventoryPrefill:(()=>{const[e,t]=Object(o.useState)("host"),[r,a]=Object(o.useState)(),[i,n]=Object(o.useState)({type:"cpu"}),[s,c]=Object(o.useState)([]);return{nodeType:e,filterQuery:r,metric:i,customMetrics:s,setNodeType:t,setFilterQuery:a,setMetric:n,setCustomMetrics:c}})()})))},135:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(e){a.useEffect(e,[])}},138:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a=(e,t)=>`metric_${t}`},139:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r(45);const i=(e,t,r=!0)=>{try{return e?JSON.stringify(Object(a.toElasticsearchQuery)(Object(a.fromKueryExpression)(e),t)):""}catch(e){if(r)return"";throw e}}},141:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"b",(function(){return u}));var a=r(2),i=r(199),n=r.n(i),o=r(128),s=r.n(o),c=r(22);const l=({from:e,to:t})=>{const{services:r}=Object(c.b)();return[Object(a.useCallback)((()=>{const a=r.data.query.timefilter.timefilter;return a.isTimeTouched()?a.getTime():{from:e,to:t}}),[r.data.query.timefilter.timefilter,e,t]),r.data.query.timefilter.timefilter.setTime]},u=(e,t,r)=>{const{services:i}=Object(c.b)(),[o,u]=l(e);s()((()=>{e.from===t.from&&e.to===t.to||u({from:t.from,to:t.to})})),n()((()=>{u({from:t.from,to:t.to})}),[t.from,t.to,u]),Object(a.useEffect)((()=>{const e=i.data.query.timefilter.timefilter.getTimeUpdate$().subscribe((()=>{if(r){const e=o();r(e)}}));return()=>e.unsubscribe()}),[o,r,i.data.query.timefilter.timefilter])}},145:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r(8),i=r(138);const n=e=>{const t=Object(a.min)(e);return Object(a.isNumber)(t)&&Number.isFinite(t)?t:void 0},o=e=>{const t=Object(a.max)(e);return Object(a.isNumber)(t)&&Number.isFinite(t)?t:void 0},s=(e,t,r=!1)=>{const s=e.rows.reduce(((e,s)=>{const c=t.map(((e,t)=>s[Object(i.a)(e,t)]||null)).filter((e=>Object(a.isNumber)(e))),l=n(c),u=r?1.1*Object(a.sum)(c):o(c);return e.concat([l||null,u||null])}),[]).filter((e=>Object(a.isNumber)(e)));return{min:n(s)||0,max:o(s)||0}}},146:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(87),i=r.n(a),n=r(46),o=r(43),s=r(187);const c=e=>{if("custom"===(null==e?void 0:e.aggregation))return e=>i()(e).format("0.[0000]");if(e&&e.field){const t=Object(s.a)(e);return t===o.b.bits&&"rate"===e.aggregation?Object(n.b)(o.b.bits,"{{value}}/s"):Object(n.b)(t)}return Object(n.b)(o.b.number)}},147:function(e,t,r){"use strict";r.d(t,"a",(function(){return m}));var a=r(2),i=r.n(a),n=r(79),o=r(26),s=r(188),c=r(115),l=r(129),u=r(138);const m=e=>c.a.bar===e.type?i.a.createElement(f,e):i.a.createElement(d,e),d=({metric:e,id:t,series:r,type:a,stack:m,opacity:d})=>{const f=Object(l.a)(),p=e.color&&Object(o.b)(e.color)||Object(o.b)(o.a.color0),b=Array.isArray(t)?t.map((t=>Object(u.a)(e,t))).slice(t.length-1,t.length):[Object(u.a)(e,t)],g=Array.isArray(t)&&t.length>1?t.map((t=>Object(u.a)(e,t))).slice(0,1):void 0,h=`series-${r.id}-${b.join("-")}`,y={line:{strokeWidth:2,visible:!0},area:{opacity:d||.5,visible:a===c.a.area}};return i.a.createElement(n.AreaSeries,{id:h,key:h,name:Object(s.a)(e),xScaleType:n.ScaleType.Time,yScaleType:n.ScaleType.Linear,xAccessor:"timestamp",yAccessors:b,y0Accessors:g,data:r.rows,stackAccessors:m?["timestamp"]:void 0,areaSeriesStyle:y,color:p,timeZone:f})},f=({metric:e,id:t,series:r,stack:a})=>{const c=Object(l.a)(),m=e.color&&Object(o.b)(e.color)||Object(o.b)(o.a.color0),d=Array.isArray(t)?t.map((t=>Object(u.a)(e,t))).slice(t.length-1,t.length):[Object(u.a)(e,t)],f=`series-${r.id}-${d.join("-")}`,p={rectBorder:{stroke:m,strokeWidth:1,visible:!0},rect:{opacity:1}};return i.a.createElement(n.BarSeries,{id:f,key:f,name:Object(s.a)(e),xScaleType:n.ScaleType.Time,yScaleType:n.ScaleType.Linear,xAccessor:"timestamp",yAccessors:d,data:r.rows,stackAccessors:a?["timestamp"]:void 0,barSeriesStyle:p,color:m,timeZone:c})}},156:function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"e",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return c}));var a=r(1);const i=a.i18n.translate("xpack.infra.metrics.alertFlyout.customEquationEditor.equationHelpMessage",{defaultMessage:"Supports basic math expressions"}),n=a.i18n.translate("xpack.infra.metrics.alertFlyout.customEquationEditor.labelLabel",{defaultMessage:"Label (optional)"}),o=a.i18n.translate("xpack.infra.metrics.alertFlyout.customEquationEditor.labelHelpMessage",{defaultMessage:"Custom label will show on the alert chart and in reason/alert title"}),s=a.i18n.translate("xpack.infra.metrics.alertFlyout.customEquation",{defaultMessage:"Custom equation"}),c=a.i18n.translate("xpack.infra.metrics.alertFlyout.customEquationEditor.deleteRowButton",{defaultMessage:"Delete"})},165:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(85),i=r(24),n=r(28),o=r(139),s=r(19);function c(e,t,r,{fromTimestamp:c,toTimestamp:l,interval:u},m=!0){const{http:d}=Object(i.useKibana)().services,{isLoading:f,data:p,error:b,refetch:g,fetchNextPage:h}=Object(a.useInfiniteQuery)({queryKey:["metricExplorer",e,c,l],queryFn:async({signal:a,pageParam:i={afterKey:null}})=>{if(!c||!l)throw new Error("Unable to parse timerange");if(!d)throw new Error("HTTP service is unavailable");if(!t)throw new Error("Source is unavailable");const{afterKey:m}=i,f=await d.post("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify({forceInterval:e.forceInterval,dropLastBucket:null==e.dropLastBucket||e.dropLastBucket,metrics:"count"===e.aggregation?[{aggregation:"count"}]:e.metrics,groupBy:e.groupBy,afterKey:m,limit:e.limit,indexPattern:t.metricAlias,filterQuery:e.filterQuery&&Object(o.a)(e.filterQuery,r)||void 0,timerange:{interval:u,from:c,to:l}}),signal:a});return Object(s.b)(n.f)(f)},getNextPageParam:e=>e.pageInfo,enabled:m&&!!c&&!!l&&!!d&&!!t,refetchOnWindowFocus:!1});return{data:p,error:b,fetchNextPage:h,isLoading:f,refetch:g}}},170:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var a=r(79),i=r(8),n=r(2),o=r.n(n),s=r(17),c=r(26);const l=.3,u=({threshold:e,sortedThresholds:t,comparator:r,color:n,id:u,firstTimestamp:m,lastTimestamp:d,domain:f})=>{if(!r||!e)return null;const p=[s.b.GT,s.b.GT_OR_EQ].includes(r),b=[s.b.LT,s.b.LT_OR_EQ].includes(r);return o.a.createElement(o.a.Fragment,null,o.a.createElement(a.LineAnnotation,{id:`${u}-thresholds`,domainType:a.AnnotationDomainType.YDomain,"data-test-subj":"threshold-line",dataValues:t.map((e=>({dataValue:e}))),style:{line:{strokeWidth:2,stroke:Object(c.b)(n),opacity:1}}}),2===t.length&&r===s.b.BETWEEN?o.a.createElement(o.a.Fragment,null,o.a.createElement(a.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"between-rect",style:{fill:Object(c.b)(n),opacity:l},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(i.first)(e),y1:Object(i.last)(e)}}]})):null,2===t.length&&r===s.b.OUTSIDE_RANGE?o.a.createElement(o.a.Fragment,null,o.a.createElement(a.RectAnnotation,{id:`${u}-lower-threshold`,"data-test-subj":"outside-range-lower-rect",style:{fill:Object(c.b)(n),opacity:l},dataValues:[{coordinates:{x0:m,x1:d,y0:f.min,y1:Object(i.first)(e)}}]}),o.a.createElement(a.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"outside-range-upper-rect",style:{fill:Object(c.b)(n),opacity:l},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(i.last)(e),y1:f.max}}]})):null,b&&null!=Object(i.first)(e)?o.a.createElement(a.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"below-rect",style:{fill:Object(c.b)(n),opacity:l},dataValues:[{coordinates:{x0:m,x1:d,y0:f.min,y1:Object(i.first)(e)}}]}):null,p&&null!=Object(i.first)(e)?o.a.createElement(a.RectAnnotation,{id:`${u}-upper-threshold`,"data-test-subj":"above-rect",style:{fill:Object(c.b)(n),opacity:l},dataValues:[{coordinates:{x0:m,x1:d,y0:Object(i.first)(e),y1:f.max}}]}):null)}},187:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(8),i=r(43);const n=e=>{if(e&&e.field){const t=Object(a.last)(e.field.split(/\./));if("pct"===t)return i.b.percent;if("bytes"===t&&"rate"===e.aggregation)return i.b.bits;if("bytes"===t)return i.b.bytes}return i.b.number}},188:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));const a=e=>e.label?e.label:`${e.aggregation}(${e.field||""})`},199:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),i=r(200);t.default=function(e,t){var r=i.useFirstMountState();a.useEffect((function(){if(!r)return e()}),t)}},200:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useFirstMountState=void 0;var a=r(2);t.useFirstMountState=function(){var e=a.useRef(!0);return e.current?(e.current=!1,!0):e.current}},223:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var a=r(2),i=r.n(a),n=r(79),o=r(40),s=r(1);const c=({chartProps:{theme:e,baseTheme:t},comparator:r,id:a,threshold:c,title:l,value:u,valueFormatter:m})=>{const d=Object(o.useEuiBackgroundColor)("danger");return i.a.createElement(o.EuiPanel,{paddingSize:"none",style:{height:"100%",overflow:"hidden",position:"relative",minWidth:"100%"},hasShadow:!1,"data-test-subj":`threshold-${c}-${u}`},i.a.createElement(n.Chart,null,i.a.createElement(n.Settings,{theme:e,baseTheme:t,locale:s.i18n.getLocale()}),i.a.createElement(n.Metric,{id:a,data:[[{title:l,extra:i.a.createElement("span",null,s.i18n.translate("xpack.infra.alerting.thresholdExtraTitle",{values:{comparator:r,threshold:m(c)},defaultMessage:"Alert when {comparator} {threshold}"})),color:d,value:u,valueFormatter:m,icon:({width:e,height:t,color:r})=>i.a.createElement(o.EuiIcon,{width:e,height:t,color:r,type:"alert"})}]]})))}},227:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var a=r(32),i=r.n(a);const n=(e,t)=>{const r=i.a.duration(i()(t).diff(i()(e))),a=i()().toISOString(),n=r.asMinutes()<160?i.a.duration(20,"minutes").asMilliseconds():r.asMilliseconds()/8;return{from:i()(e).subtract(n,"millisecond").toISOString(),to:t&&i()(t).add(n,"millisecond").isBefore(a)?i()(t).add(n,"millisecond").toISOString():a}}},228:function(e,t,r){"use strict";r.d(t,"a",(function(){return k}));var a=r(2),i=r.n(a),n=r(79),o=r(40),s=r(76),c=r(94),l=r(8),u=r(1),m=r(118),d=r(26),f=r(147),p=r(115),b=r(146),g=r(145),h=r(18),y=r.n(h),v=r(165);const O={},j=e=>"count"===e.aggType?{name:e.name,aggregation:"count",filter:e.filter}:{name:e.name,aggregation:e.aggType,field:e.field};var E=r(138),T=r(22),x=r(131),S=r(170),w=r(156);const k=({expression:e,derivedIndexPattern:t,annotations:r,chartType:h=p.a.bar,filterQuery:k,groupBy:M,hideTitle:A=!1,source:F,timeRange:P})=>{var L,C;const{charts:_}=Object(T.b)().services,B=Object(m.a)(),{isLoading:$,data:R}=((e,t,r,i,n,o=O)=>{const{timeSize:s,timeUnit:c}=e||{timeSize:1,timeUnit:"m"},l=Object(a.useMemo)((()=>{var t,r;return{limit:1,forceInterval:!0,dropLastBucket:!1,groupBy:n,filterQuery:i,metrics:["custom"===e.aggType?{aggregation:"custom",custom_metrics:null!==(t=null==e||null===(r=e.customMetrics)||void 0===r?void 0:r.map(j))&&void 0!==t?t:[],equation:e.equation}:{field:e.metric,aggregation:e.aggType}],aggregation:e.aggType||"avg"}}),[e.aggType,e.equation,e.metric,e.customMetrics,i,n]),u=Object(a.useMemo)((()=>{var e,t;const r=null!==(e=o.from)&&void 0!==e?e:`now-${20*(s||1)}${c}`,a=null!==(t=o.to)&&void 0!==t?t:"now",i=y.a.parse(r).valueOf(),n=y.a.parse(a,{roundUp:!0}).valueOf();return{interval:`>=${s||1}${c}`,fromTimestamp:i,toTimestamp:n}}),[o,s,c]);return Object(v.a)(l,null==r?void 0:r.configuration,t,u)})(e,t,F,k,M,P),I=Object(a.useRef)(null),N=Object(c.useActiveCursor)(_.activeCursor,I,{isDateHistogram:!0});if($)return i.a.createElement(x.c,null);if(!R)return i.a.createElement(x.e,null);const q=Object(l.first)(Object(l.first)(R.pages).series);if(!q||!q.rows||0===q.rows.length)return i.a.createElement(x.e,null);const Q=Object(l.first)(q.rows).timestamp,D=Object(l.last)(q.rows).timestamp,H={field:e.metric,aggregation:e.aggType,color:d.a.color0};"custom"===H.aggregation&&(H.label=e.label||w.a);const U=null==Q||null==D?e=>`${e}`:Object(n.niceTimeFormatter)([Q,D]),z=e.threshold.slice().sort(),W=null!==(L=null===(C=e.warningThreshold)||void 0===C?void 0:C.slice().sort())&&void 0!==L?L:[],V=[...z,...W].sort(),K={...q,rows:q.rows.map((e=>{const t={...e};return V.forEach(((e,r)=>{t[Object(E.a)(H,`threshold_${r}`)]=e})),t}))},G=Object(g.a)(K,[H],!1),J={max:1.1*Math.max(G.max,Object(l.last)(V)||G.max),min:.9*Math.min(G.min,Object(l.first)(V)||G.min)};J.min===Object(l.first)(e.threshold)&&(J.min=.9*J.min);const{timeSize:Y,timeUnit:Z}=e,X=x.f[Z];return i.a.createElement(i.a.Fragment,null,i.a.createElement(x.a,null,i.a.createElement(n.Chart,{ref:I},i.a.createElement(f.a,{type:h,metric:H,id:"0",series:K,stack:!1}),i.a.createElement(S.a,{comparator:e.comparator,threshold:e.threshold,sortedThresholds:z,color:d.a.color1,id:"critical",firstTimestamp:Q,lastTimestamp:D,domain:J}),e.warningComparator&&e.warningThreshold&&i.a.createElement(S.a,{comparator:e.warningComparator,threshold:e.warningThreshold,sortedThresholds:W,color:d.a.color5,id:"warning",firstTimestamp:Q,lastTimestamp:D,domain:J}),r,i.a.createElement(n.Axis,{id:"timestamp",position:n.Position.Bottom,showOverlappingTicks:!0,tickFormat:U}),i.a.createElement(n.Axis,{id:"values",position:n.Position.Left,tickFormat:Object(b.a)(H),domain:J}),i.a.createElement(n.Tooltip,x.h),i.a.createElement(n.Settings,{onPointerUpdate:N,externalPointerEvents:{tooltip:{visible:!0}},baseTheme:B.baseTheme,locale:u.i18n.getLocale()}))),!A&&i.a.createElement("div",{style:{textAlign:"center"}},"ALL"!==K.id?i.a.createElement(o.EuiText,{size:"xs",color:"subdued"},i.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:K.id,timeLabel:X,lookback:20*Y}})):i.a.createElement(o.EuiText,{size:"xs",color:"subdued"},i.a.createElement(s.FormattedMessage,{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:X,lookback:20*Y}}))))}},532:function(e,t,r){"use strict";r.r(t),r.d(t,"AlertDetailsAppSection",(function(){return S}));var a=r(1),i=r(76),n=r(2),o=r.n(n),s=r(32),c=r.n(s),l=r(40),u=r(12),m=r(294),d=r(227),f=r(46);const p=(e,t="")=>{const r=a.i18n.translate("xpack.infra.metrics.alerting.noDataFormattedValue",{defaultMessage:"[NO DATA]"}),i=t.endsWith(".pct")?Object(f.b)("percent"):Object(f.b)("highPrecision");return null==e?r:i(e)};var b=r(131),g=r(223),h=r(110);const y=e=>{const t=e.metric?`(${e.metric})`:"";return e.aggType+t+e.comparator+e.threshold.join(",")};var v=r(115),O=r(22),j=r(228);const E="YYYY-MM-DD HH:mm",T="alert_start_annotation",x="alert_time_range_annotation";function S({alert:e,rule:t,ruleLink:r,setAlertSummaryFields:s}){const{uiSettings:f,charts:S}=Object(O.b)().services,{source:w,createDerivedIndexPattern:k}=Object(h.b)(),{euiTheme:M}=Object(l.useEuiTheme)(),A=Object(n.useMemo)((()=>k()),[k]),F={theme:S.theme.useChartsTheme(),baseTheme:S.theme.useChartsBaseTheme()},P=Object(d.a)(e.fields[u.U],e.fields[u.e]),L=e.fields[u.e]?c()(e.fields[u.e]).valueOf():void 0,C=[o.a.createElement(m.b,{alertStart:e.start,color:M.colors.danger,dateFormat:f.get("dateFormat")||E,id:T,key:T}),o.a.createElement(m.a,{alertStart:e.start,alertEnd:L,color:M.colors.danger,id:x,key:x})];return Object(n.useEffect)((()=>{s([{label:a.i18n.translate("xpack.infra.metrics.alertDetailsAppSection.summaryField.rule",{defaultMessage:"Rule"}),value:o.a.createElement(l.EuiLink,{"data-test-subj":"alertDetailsAppSectionRuleLink",href:r},t.name)}])}),[e,t,r,s]),t.params.criteria?o.a.createElement(l.EuiFlexGroup,{direction:"column","data-test-subj":"metricThresholdAppSection"},t.params.criteria.map(((r,n)=>o.a.createElement(l.EuiFlexItem,{key:y(r)},o.a.createElement(l.EuiPanel,{hasBorder:!0,hasShadow:!1},o.a.createElement(l.EuiTitle,{size:"xs"},o.a.createElement("h4",null,r.aggType.toUpperCase()," ","metric"in r?r.metric:void 0)),o.a.createElement(l.EuiText,{size:"s",color:"subdued"},o.a.createElement(i.FormattedMessage,{id:"xpack.infra.metrics.alertDetailsAppSection.criterion.subtitle",defaultMessage:"Last {lookback} {timeLabel}",values:{lookback:r.timeSize,timeLabel:b.f[r.timeUnit]}})),o.a.createElement(l.EuiSpacer,{size:"s"}),o.a.createElement(l.EuiFlexGroup,null,o.a.createElement(l.EuiFlexItem,{style:{minHeight:150,minWidth:160},grow:1},o.a.createElement(g.a,{chartProps:F,id:`threshold-${y(r)}`,threshold:r.threshold[0],value:e.fields[u.h][n],valueFormatter:e=>p(e,"metric"in r?r.metric:void 0),title:a.i18n.translate("xpack.infra.metrics.alertDetailsAppSection.thresholdTitle",{defaultMessage:"Threshold breached"}),comparator:r.comparator})),o.a.createElement(l.EuiFlexItem,{grow:5},o.a.createElement(j.a,{annotations:C,chartType:v.a.line,derivedIndexPattern:A,expression:r,filterQuery:t.params.filterQueryText,groupBy:t.params.groupBy,hideTitle:!0,source:w,timeRange:P})))))))):null}t.default=Object(h.c)(S)("default")}}]);