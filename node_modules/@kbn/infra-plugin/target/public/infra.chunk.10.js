/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[10],{108:function(e,t,r){e.exports=r(66)(3)},111:function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return CanceledPromiseError}));var a=r(4),n=r.n(a),i=r(2),o=r(150),l=r.n(o);const s=({createPromise:e,onResolve:t=u,onReject:r=u,cancelPreviousOn:a="never",triggerOrThrow:n="whenMounted"},o)=>{const s=l()(),c=Object(i.useCallback)((()=>{switch(n){case"always":return!0;case"whenMounted":return s()}}),[s,n]),d=Object(i.useRef)([]),[m,p]=Object(i.useState)({state:"uninitialized"}),g=Object(i.useCallback)((()=>{p({state:"uninitialized"})}),[]),f=Object(i.useMemo)((()=>(...n)=>{let i;const o=new Promise(((e,t)=>{i=t})),l=d.current,s=()=>{l.forEach((e=>e.cancel()))},m=e(...n),g=Promise.race([m,o]);p({state:"pending",promise:g}),"creation"===a&&s();const f={cancel:()=>{i(new CanceledPromiseError)},cancelSilently:()=>{i(new SilentCanceledPromiseError)},promise:g.then((e=>(["settlement","resolution"].includes(a)&&s(),d.current=d.current.filter((e=>e.promise!==f.promise)),t&&c()&&t(e),p((t=>"pending"===t.state&&t.promise===g?{state:"resolved",promise:f.promise,value:e}:t)),e)),(e=>{if(!(e instanceof SilentCanceledPromiseError)){if(["settlement","rejection"].includes(a)&&s(),d.current=d.current.filter((e=>e.promise!==f.promise)),c()){if(!r)throw e;r(e)}p((t=>"pending"===t.state&&t.promise===g?{state:"rejected",promise:g,value:e}:t))}}))};return d.current=[...d.current,f],f.promise.catch(u),f.promise}),o);return Object(i.useEffect)((()=>()=>{d.current.forEach((e=>e.cancelSilently()))}),[]),[m,f,g]};class CanceledPromiseError extends Error{constructor(e){super(e),n()(this,"isCanceled",!0),Object.setPrototypeOf(this,new.target.prototype)}}class SilentCanceledPromiseError extends CanceledPromiseError{}const u=()=>{}},112:function(e,t,r){"use strict";r.d(t,"k",(function(){return a.b})),r.d(t,"m",(function(){return s})),r.d(t,"l",(function(){return u})),r.d(t,"a",(function(){return b.a})),r.d(t,"r",(function(){return b.u})),r.d(t,"p",(function(){return b.s})),r.d(t,"q",(function(){return b.t})),r.d(t,"e",(function(){return b.f})),r.d(t,"w",(function(){return b.B})),r.d(t,"x",(function(){return b.C})),r.d(t,"f",(function(){return b.g})),r.d(t,"y",(function(){return b.D})),r.d(t,"z",(function(){return b.E})),r.d(t,"b",(function(){return b.c})),r.d(t,"n",(function(){return b.q})),r.d(t,"o",(function(){return b.r})),r.d(t,"g",(function(){return b.h})),r.d(t,"A",(function(){return b.F})),r.d(t,"B",(function(){return b.G})),r.d(t,"h",(function(){return b.i})),r.d(t,"C",(function(){return b.H})),r.d(t,"D",(function(){return b.I})),r.d(t,"d",(function(){return b.e})),r.d(t,"v",(function(){return b.A})),r.d(t,"u",(function(){return b.z})),r.d(t,"c",(function(){return b.d})),r.d(t,"s",(function(){return b.x})),r.d(t,"t",(function(){return b.y})),r.d(t,"i",(function(){return b.j})),r.d(t,"E",(function(){return b.M})),r.d(t,"F",(function(){return b.N})),r.d(t,"j",(function(){return b.k})),r.d(t,"H",(function(){return b.P})),r.d(t,"G",(function(){return b.O})),r.d(t,"I",(function(){return b.Q})),r(116);var a=r(28),n=r(44),i=(r(33),r(0));const o=i.type({value:i.number}),l=(i.type({hostTerm:i.record(i.string,i.string),indexPattern:i.string,to:i.number,sortBy:i.type({name:i.string,isAscending:i.boolean}),searchFilter:i.array(i.record(i.string,i.record(i.string,i.unknown)))}),i.type({summaryEvent:i.type({summary:i.type({hits:i.type({hits:i.array(i.type({_source:i.type({system:i.type({process:i.type({summary:i.record(i.string,i.number)})})})}))})})}),processes:i.type({filteredProcs:i.type({buckets:i.array(i.type({key:i.string,cpu:o,memory:o,startTime:i.type({value_as_string:i.string}),meta:i.type({hits:i.type({hits:i.array(i.type({_source:i.type({process:i.type({pid:i.number}),system:i.type({process:i.type({state:i.string})}),user:i.type({name:i.string})})}))})})}))})})}),i.union([i.number,i.string])),s=i.type({processList:i.array(i.type({cpu:i.union([i.null,i.number]),memory:i.union([i.null,i.number]),startTime:i.number,pid:i.number,state:i.string,user:i.string,command:i.string})),summary:i.exact(i.partial({total:l,running:l,sleeping:l,dead:l,stopped:l,idle:l,zombie:l,unknown:l}))}),u=(i.type({hostTerm:i.record(i.string,i.string),indexPattern:i.string,to:i.number,command:i.string}),i.type({process:i.type({filteredProc:i.type({buckets:i.array(i.type({timeseries:i.type({buckets:i.array(i.type({key:i.number,memory:o,cpu:o}))})}))})})}),i.type({cpu:n.a,memory:n.a}));var c=r(13);const d=i.keyof({cpu:null,normalizedLoad1m:null,diskSpaceUsage:null,memory:null,memoryFree:null,rx:null,tx:null}),m=i.type({from:c.c,to:c.c}),p=i.keyof({"cloud.provider":null,"host.ip":null,"host.os.name":null}),g=i.type({name:d,value:i.union([i.number,i.null])}),f=i.type({name:p,value:i.union([i.string,i.null])}),E=(i.intersection([i.partial({query:i.UnknownRecord}),i.type({type:i.literal("host"),limit:i.union([Object(c.d)(1,500),Object(c.b)(20)]),metrics:i.array(i.type({type:d})),sourceId:i.string,range:m})]),i.type({name:i.string,metrics:i.array(g),metadata:i.array(f)}));i.type({type:i.literal("host"),nodes:i.array(E)});var b=r(7);r(49),r(52),r(48),r(51),r(50)},116:function(e,t,r){"use strict";r.d(t,"a",(function(){return b}));var a=r(0),n=r(20);a.type({nodeId:a.string,nodeType:n.ItemTypeRT,sourceId:a.string,timeRange:a.type({from:a.number,to:a.number})});const i=a.type({name:a.string,source:a.string}),o=a.partial({codename:a.string,family:a.string,kernel:a.string,name:a.string,platform:a.string,version:a.string,build:a.string}),l=a.partial({name:a.string,hostname:a.string,id:a.string,ip:a.union([a.array(a.string),a.string]),mac:a.union([a.array(a.string),a.string]),os:o,architecture:a.string,containerized:a.boolean}),s=a.partial({id:a.string,name:a.string}),u=a.partial({id:a.string,name:a.string}),c=a.partial({id:a.string}),d=a.partial({interface:a.string,type:a.string}),m=a.partial({instance:s,provider:a.string,account:u,availability_zone:a.string,project:c,machine:d,region:a.string}),p=a.partial({id:a.string,version:a.string,policy:a.string}),g=(a.partial({cloud:m,host:l,agent:p,"@timestamp":a.string}),a.partial({cloud:m,host:l,agent:p,timestamp:a.string})),f=a.type({id:a.string,name:a.string,features:a.array(i)}),E=a.partial({info:g}),b=a.intersection([f,E])},118:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r(40),n=r(22);function i(){var e,t,r;const{euiTheme:i}=Object(a.useEuiTheme)(),{services:{charts:o}}=Object(n.b)(),l=o.theme.useChartsBaseTheme(),s=o.theme.useChartsTheme();return{baseTheme:l,theme:{...s,background:{...s.background,color:"transparent"},crosshair:{band:{...null===(e=s.crosshair)||void 0===e?void 0:e.band,fill:i.colors.lightShade}},axes:{gridLine:{horizontal:{visible:!1},vertical:{...null===(t=s.axes)||void 0===t||null===(r=t.gridLine)||void 0===r?void 0:r.vertical,dash:void 0}}}}}}},128:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(67).__importDefault(r(135));t.default=function(e){a.default((function(){e()}))}},129:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var a=r(91),n=r.n(a),i=r(24),o=r(81);function l(){const[e]=Object(i.useUiSetting$)(o.UI_SETTINGS.DATEFORMAT_TZ);return e&&"Browser"!==e?e:n.a.tz.guess()}},131:function(e,t,r){"use strict";r.d(t,"h",(function(){return p})),r.d(t,"d",(function(){return g})),r.d(t,"f",(function(){return f})),r.d(t,"i",(function(){return E})),r.d(t,"j",(function(){return b})),r.d(t,"g",(function(){return v})),r.d(t,"a",(function(){return y})),r.d(t,"e",(function(){return x})),r.d(t,"c",(function(){return C})),r.d(t,"b",(function(){return O}));var a=r(2),n=r.n(a),i=r(79),o=r(32),l=r.n(o),s=r(1),u=r(40),c=r(76),d=r(8),m=r(23);const p={headerFormatter:({value:e})=>l()(e).format("Y-MM-DD HH:mm:ss")},g=20,f={s:s.i18n.translate("xpack.infra.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:s.i18n.translate("xpack.infra.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:s.i18n.translate("xpack.infra.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:s.i18n.translate("xpack.infra.alerts.timeLabels.days",{defaultMessage:"days"})},E=(e,t)=>Object(a.useMemo)((()=>"number"==typeof e&&"number"==typeof t?Object(i.niceTimeFormatter)([e,t]):e=>`${e}`),[e,t]),b=m.a,v=(e,t=!1)=>{let r=null,a=null;const n=e.reduce(((e,t)=>(t.points.forEach((t=>{const r=e[t.timestamp]||[];e[t.timestamp]=[...r,t.value]})),e)),{});Object.values(n).forEach((e=>{const n=t?Object(d.sum)(e):Object(d.max)(e),i=Object(d.min)(e);n&&(!a||n>a)&&(a=n),i&&(!r||i<r)&&(r=i)}));const i=Object.keys(n).map(Number),o=Object(d.min)(i)||0,l=Object(d.max)(i)||0;return{yMin:r||0,yMax:a||0,xMin:o,xMax:l}},h=({children:e})=>n.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},e),y=({children:e})=>n.a.createElement("div",{style:{width:"100%",height:150}},e),x=()=>n.a.createElement(h,null,n.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"noChartData"},n.a.createElement(c.FormattedMessage,{id:"xpack.infra.alerts.charts.noDataMessage",defaultMessage:"No chart data available"}))),C=()=>n.a.createElement(h,null,n.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"loadingData"},n.a.createElement(u.EuiLoadingChart,{size:"m"}))),O=()=>n.a.createElement(h,null,n.a.createElement(u.EuiText,{color:"subdued","data-test-subj":"chartErrorState"},n.a.createElement(c.FormattedMessage,{id:"xpack.infra.alerts.charts.errorMessage",defaultMessage:"Uh oh, something went wrong"})))},135:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(e){a.useEffect(e,[])}},150:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(){var e=a.useRef(!1),t=a.useCallback((function(){return e.current}),[]);return a.useEffect((function(){return e.current=!0,function(){e.current=!1}})),t}},155:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(67),n=r(2),i=a.__importDefault(r(169));t.default=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var a=i.default(e,t),o=a[0],l=a[1],s=a[2];return n.useEffect(s,r),[o,l]}},169:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2);t.default=function(e,t){void 0===t&&(t=0);var r=a.useRef(!1),n=a.useRef(),i=a.useRef(e),o=a.useCallback((function(){return r.current}),[]),l=a.useCallback((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,i.current()}),t)}),[t]),s=a.useCallback((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return a.useEffect((function(){i.current=e}),[e]),a.useEffect((function(){return l(),s}),[t]),[o,s,l]}},230:function(e,t,r){"use strict";r.d(t,"a",(function(){return C}));var a=r(2),n=r.n(a),i=r(155),o=r.n(i),l=r(1),s=r(79),u=r(40),c=r(76),d=r(118),m=r(131),p=r(14),g=r(26),f=r(112),E=r(24),b=r(54),v=r(19),h=r(111);const y=async(e,t,r,a,n)=>{const i=await t(f.a,{method:"POST",body:JSON.stringify(f.q.encode({data:{logView:e,alertParams:r,buckets:a,executionTimeRange:n}})),version:"1"});return Object(v.b)(f.r)(i)};var x=r(129);const C=({ruleParams:e,chartCriterion:t,logViewReference:r,showThreshold:i,executionTimeRange:o,annotations:l,filterSeriesByGroupName:s})=>{const u=Object(a.useMemo)((()=>{const{field:r,comparator:a,value:n}=t,i={criteria:r&&a&&n?[{field:r,comparator:a,value:n}]:[],count:{comparator:e.count.comparator,value:e.count.value},timeSize:e.timeSize,timeUnit:e.timeUnit,groupBy:e.groupBy};try{return Object(v.b)(f.p)(i)}catch(e){return null}}),[e.timeSize,e.timeUnit,e.groupBy,e.count.comparator,e.count.value,t]);return null===u||0===u.criteria.length?null:n.a.createElement(O,{buckets:u.groupBy&&0!==u.groupBy.length?m.d/4:m.d,logViewReference:r,threshold:e.count,chartAlertParams:u,showThreshold:i,executionTimeRange:o,annotations:l,filterSeriesByGroupName:s})},O=({buckets:e,logViewReference:t,threshold:r,chartAlertParams:i,showThreshold:f,executionTimeRange:v,annotations:C,filterSeriesByGroupName:O})=>{const T=Object(d.a)(),j=Object(x.a)(),{getChartPreviewData:w,isLoading:k,hasError:S,chartPreviewData:F}=(({logViewReference:e,ruleParams:t,buckets:r,executionTimeRange:n,filterSeriesByGroupName:i})=>{const{http:o}=Object(E.useKibana)().services,[l,s]=Object(a.useState)([]),[u,c]=Object(a.useState)(!1),[d,m]=Object(h.b)({cancelPreviousOn:"creation",createPromise:async()=>{if(c(!1),Object(b.e)(t.criteria)){var a;const u=await Promise.all([y(e,o.fetch,{...t,criteria:[...t.criteria[0]]},r,n),y(e,o.fetch,{...t,criteria:[...t.criteria[1]]},r,n)]);let c=u[0].data.series[0].points,d=u[1].data.series[0].points,m="ratio";var l,s;null!==(a=t.groupBy)&&void 0!==a&&a.length&&i&&(m=i,c=(null===(l=u[0].data.series.find((e=>e.id===i)))||void 0===l?void 0:l.points)||[],d=(null===(s=u[1].data.series.find((e=>e.id===i)))||void 0===s?void 0:s.points)||[]);const p=[];for(let e=0;e<c.length;e++){const t={timestamp:c[e].timestamp,value:0};if(0===c[e].value||0===d[e].value)p.push(t);else{const r=c[e].value/d[e].value;p.push({...t,value:r})}}return{data:{series:[{id:m,points:p}]}}}return await y(e,o.fetch,t,r,n)},onResolve:({data:{series:e}})=>{c(!1),s(e)},onReject:e=>{c(!0)}},[e,o,t,r]);return{chartPreviewData:l,hasError:u,isLoading:Object(a.useMemo)((()=>"pending"===d.state),[d.state]),getChartPreviewData:m}})({logViewReference:t,ruleParams:i,buckets:e,executionTimeRange:v});o()((()=>{w()}),500,[w]);const{timeSize:M,timeUnit:P,groupBy:_}=i,R=!!(_&&_.length>0),L=!!(f&&r&&r.comparator)&&[p.a.GT,p.a.GT_OR_EQ].includes(r.comparator),z=!!(f&&r&&r.comparator)&&[p.a.LT,p.a.LT_OR_EQ].includes(r.comparator),A=Object(a.useMemo)((()=>{if(!R)return F;if(O&&O.length)return F.filter((e=>O.includes(e.id)));const e=F.sort(((e,t)=>{const r=Math.max(...e.points.map((e=>e.value)));return Math.max(...t.points.map((e=>e.value)))-r}));return(!L&&!z||L?e:e.reverse()).slice(0,5)}),[R,O,F,L,z]),B=Object(a.useMemo)((()=>A.reduce(((e,t)=>[...e,...t.points.reduce(((e,r)=>[...e,{...r,groupBy:t.id}]),[])]),[])),[A]),G=M*e,I=F.length>0,{yMin:V,yMax:N,xMin:Q,xMax:D}=Object(m.g)(A,!1),U={max:f&&r?1.1*Math.max(N,r.value):1.1*N,min:f&&r?Math.min(V,r.value):V};f&&r&&U.min===r.value&&(U.min=.9*U.min);const W=_&&_.length>0?_.join(", "):null,H=Object(m.i)(Q,D),$=m.f[P];return k?n.a.createElement(m.c,null):S?n.a.createElement(m.b,null):I?n.a.createElement(n.a.Fragment,null,n.a.createElement(m.a,null,n.a.createElement(s.Chart,null,n.a.createElement(s.BarSeries,{id:"criterion-preview",xScaleType:s.ScaleType.Time,yScaleType:s.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],splitSeriesAccessors:["groupBy"],stackAccessors:void 0,data:B,barSeriesStyle:{rectBorder:{stroke:R?void 0:Object(g.b)(g.a.color0),strokeWidth:1,visible:!0},rect:{opacity:1}},color:R?void 0:Object(g.b)(g.a.color0),timeZone:j}),f&&r?n.a.createElement(s.LineAnnotation,{id:"threshold-line",domainType:s.AnnotationDomainType.YDomain,dataValues:[{dataValue:r.value}],style:{line:{strokeWidth:2,stroke:Object(g.b)(g.a.color1),opacity:1}}}):null,f&&r&&z?n.a.createElement(s.RectAnnotation,{id:"below-threshold",style:{fill:Object(g.b)(g.a.color1),opacity:.3},dataValues:[{coordinates:{x0:Q,x1:D,y0:U.min,y1:r.value}}]}):null,C,f&&r&&L?n.a.createElement(s.RectAnnotation,{id:"above-threshold",style:{fill:Object(g.b)(g.a.color1),opacity:.3},dataValues:[{coordinates:{x0:Q,x1:D,y0:r.value,y1:U.max}}]}):null,n.a.createElement(s.Axis,{id:"timestamp",position:s.Position.Bottom,showOverlappingTicks:!0,tickFormat:H}),n.a.createElement(s.Axis,{id:"values",position:s.Position.Left,tickFormat:m.j,domain:U}),n.a.createElement(s.Settings,{baseTheme:T.baseTheme,locale:l.i18n.getLocale()}),n.a.createElement(s.Tooltip,m.h))),!v&&n.a.createElement("div",{style:{textAlign:"center"}},null!=W?n.a.createElement(u.EuiText,{size:"xs",color:"subdued"},n.a.createElement(c.FormattedMessage,{id:"xpack.infra.logs.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data, grouped by {groupByLabel} (showing {displayedGroups}/{totalGroups} groups)",values:{groupByLabel:W,timeLabel:$,lookback:G,displayedGroups:A.length,totalGroups:F.length}})):n.a.createElement(u.EuiText,{size:"xs",color:"subdued"},n.a.createElement(c.FormattedMessage,{id:"xpack.infra.logs.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel} of data",values:{timeLabel:$,lookback:G}})))):n.a.createElement(m.e,null)}},530:function(e,t,r){"use strict";r.r(t),r.d(t,"ExpressionEditor",(function(){return X})),r.d(t,"SourceStatusWrapper",(function(){return ee})),r.d(t,"Editor",(function(){return te})),r.d(t,"ExpressionLike",(function(){return re}));var a=r(40),n=r(1),i=r(2),o=r.n(i),l=r(128),s=r.n(l),u=r(90),c=r(42),d=r(14),m=r(19),p=r(22);const g=({onChange:e,fields:t,selectedGroups:r=[],label:n,placeholder:l})=>{const s=Object(i.useCallback)((t=>{const r=t.map((e=>e.label));e(r)}),[e]),u=Object(i.useMemo)((()=>r.map((e=>({label:e})))),[r]),c=Object(i.useMemo)((()=>t.filter((e=>e.aggregatable)).map((e=>({label:e.name})))),[t]);return o.a.createElement("div",{style:{minWidth:"300px"}},o.a.createElement(a.EuiComboBox,{placeholder:l,"aria-label":n,fullWidth:!0,singleSelection:!1,selectedOptions:u,options:c,onChange:s,isClearable:!0}))},f=n.i18n.translate("xpack.infra.alerting.alertFlyout.groupByLabel",{defaultMessage:"Group By"}),E=n.i18n.translate("xpack.infra.alerting.alertFlyout.groupBy.placeholder",{defaultMessage:"Nothing (ungrouped)"}),b=({selectedGroups:e=[],fields:t,label:r,onChange:n})=>{const[l,s]=Object(i.useState)(!1),u=Object(i.useMemo)((()=>e.length>0?e.join(", "):E),[e]),c=null!=r?r:f;return o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiPopover,{id:"groupByExpression",button:o.a.createElement(a.EuiExpression,{description:c,uppercase:!0,value:u,isActive:l,onClick:()=>s(!l)}),isOpen:l,closePopover:()=>s(!1),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},o.a.createElement("div",{style:{zIndex:11e3}},o.a.createElement(a.EuiPopoverTitle,null,c),o.a.createElement(g,{selectedGroups:e,onChange:n,fields:t,label:c,placeholder:E})))))};var v=r(62),h=r(108),y=r.n(h),x=r(76),C=r(8);const O=n.i18n.translate("xpack.infra.logs.alertFlyout.firstCriterionFieldPrefix",{defaultMessage:"with"}),T=n.i18n.translate("xpack.infra.logs.alertFlyout.successiveCriterionFieldPrefix",{defaultMessage:"and"}),j=n.i18n.translate("xpack.infra.logs.alertFlyout.criterionFieldTitle",{defaultMessage:"Field"}),w=n.i18n.translate("xpack.infra.logs.alertFlyout.criterionComparatorValueTitle",{defaultMessage:"Comparison : Value"}),k=e=>"number"===(null==e?void 0:e.type)?[{value:d.a.GT,text:d.b[d.a.GT]},{value:d.a.GT_OR_EQ,text:d.b[d.a.GT_OR_EQ]},{value:d.a.LT,text:d.b[d.a.LT]},{value:d.a.LT_OR_EQ,text:d.b[d.a.LT_OR_EQ]},{value:d.a.EQ,text:d.b[`${d.a.EQ}:number`]},{value:d.a.NOT_EQ,text:d.b[`${d.a.NOT_EQ}:number`]}]:null!=e&&e.aggregatable?[{value:d.a.EQ,text:d.b[d.a.EQ]},{value:d.a.NOT_EQ,text:d.b[d.a.NOT_EQ]}]:[{value:d.a.MATCH,text:d.b[d.a.MATCH]},{value:d.a.NOT_MATCH,text:d.b[d.a.NOT_MATCH]},{value:d.a.MATCH_PHRASE,text:d.b[d.a.MATCH_PHRASE]},{value:d.a.NOT_MATCH_PHRASE,text:d.b[d.a.NOT_MATCH_PHRASE]}],S=(e,t)=>e.find((e=>e.name===t)),F=({idx:e,fields:t,criterion:r,updateCriterion:l,removeCriterion:s,canDelete:u,errors:c})=>{var m,p,g;const[f,E]=Object(i.useState)(!1),[b,v]=Object(i.useState)(!1),h=Object(i.useMemo)((()=>t.map((e=>({label:e.name})))),[t]),y=Object(i.useMemo)((()=>r.field?S(t,r.field):void 0),[t,r]),x=Object(i.useMemo)((()=>k(y)),[y]),F=Object(i.useCallback)((([r])=>{if(!r)return void l(e,{field:""});const a=r.label,n=S(t,a);if((null==y?void 0:y.type)!==(null==n?void 0:n.type)||(null==y?void 0:y.aggregatable)!==(null==n?void 0:n.aggregatable)){const t=k(n);l(e,{field:a,comparator:t[0].value,value:void 0})}else l(e,{field:a});E(!1)}),[y,t,e,l]),M=r.field?[{label:r.field}]:[];return o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!0},o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiPopover,{id:"criterion-field",button:o.a.createElement(a.EuiExpression,{description:0===e?O:T,uppercase:!0,value:null!==(m=r.field)&&void 0!==m?m:"a chosen field",isActive:f,color:0===c.field.length?"success":"danger",onClick:e=>{e.stopPropagation(),E(!f)}}),isOpen:f,closePopover:()=>E(!1),onClick:e=>e.stopPropagation(),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},o.a.createElement("div",null,o.a.createElement(a.EuiPopoverTitle,null,j),o.a.createElement(a.EuiFormRow,{style:{minWidth:"300px"},isInvalid:c.field.length>0,error:c.field},o.a.createElement(a.EuiComboBox,{compressed:!0,fullWidth:!0,isClearable:!1,singleSelection:{asPlainText:!0},options:h,selectedOptions:M,onChange:F}))))),o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiPopover,{id:"criterion-comparator-value",button:o.a.createElement(a.EuiExpression,{description:r.comparator&&null!==(p=null!==(g=d.b[`${r.comparator}:${null==y?void 0:y.type}`])&&void 0!==g?g:d.b[r.comparator])&&void 0!==p?p:"",uppercase:!0,value:r.value,isActive:b,color:0===c.comparator.length&&0===c.value.length?"success":"danger",onClick:e=>{e.stopPropagation(),v(!b)}}),isOpen:b,closePopover:()=>v(!1),onClick:e=>e.stopPropagation(),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},o.a.createElement("div",null,o.a.createElement(a.EuiPopoverTitle,null,w),o.a.createElement(a.EuiFlexGroup,{gutterSize:"l"},o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiFormRow,{isInvalid:c.comparator.length>0,error:c.comparator},o.a.createElement(a.EuiSelect,{"data-test-subj":"infraCriterionSelect",compressed:!0,hasNoInitialSelection:null==r.comparator,value:r.comparator,onChange:t=>l(e,{comparator:t.target.value}),options:x}))),o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiFormRow,{isInvalid:c.value.length>0,error:c.value},"number"===(null==y?void 0:y.type)?o.a.createElement(a.EuiFieldNumber,{"data-test-subj":"infraCriterionFieldNumber",compressed:!0,value:r.value,onChange:t=>{const r=parseFloat(t.target.value);l(e,{value:Object(C.isNumber)(r)&&Object(C.isFinite)(r)?r:void 0})}}):o.a.createElement(a.EuiFieldText,{"data-test-subj":"infraCriterionFieldText",compressed:!0,value:r.value,onChange:t=>l(e,{value:t.target.value})}))))))))),u&&o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiButtonIcon,{"data-test-subj":"infraCriterionButton","aria-label":n.i18n.translate("xpack.infra.logs.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:t=>{t.stopPropagation(),s(e)}})))};var M=r(230);const P=n.i18n.translate("xpack.infra.logs.alerting.threshold.ratioCriteriaQueryAText",{defaultMessage:"Query A"}),_=n.i18n.translate("xpack.infra.logs.alerting.threshold.ratioCriteriaQueryBText",{defaultMessage:"Query B"}),R=e=>{const{criteria:t,errors:r}=e;return t&&0!==t.length?Object(d.k)(t)?o.a.createElement(z,y()({},e,{criteria:t,errors:r})):o.a.createElement(A,y()({},e,{criteria:t,errors:r})):null},L=e=>{const{updateCriterion:t,removeCriterion:r,addCriterion:n,criteria:i,fields:l,errors:s,ruleParams:u,logViewReference:c,isRatio:d=!1}=e;return o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!0},i.map(((e,n)=>o.a.createElement(a.EuiAccordion,{id:`criterion-${n}`,buttonContent:o.a.createElement(F,{idx:n,fields:l,criterion:e,updateCriterion:t,removeCriterion:r,canDelete:i.length>1,errors:s[n]}),key:n,arrowDisplay:"right"},o.a.createElement(M.a,{ruleParams:u,chartCriterion:e,logViewReference:c,showThreshold:!d})))),o.a.createElement(G,{addCriterion:n})))},z=e=>{const{criteria:t,defaultCriterion:r,errors:n,updateCriteria:l}=e,s=Object(i.useCallback)((e=>{const r=[e,Object(d.g)(t)];l(r)}),[l,t]),u=Object(i.useCallback)((e=>{const r=[Object(d.h)(t),e];l(r)}),[l,t]),{updateCriterion:c,addCriterion:m,removeCriterion:p}=B(Object(d.h)(t),r,s),{updateCriterion:g,addCriterion:f,removeCriterion:E}=B(Object(d.g)(t),r,u);return o.a.createElement(o.a.Fragment,null,o.a.createElement(a.EuiSpacer,{size:"xxl"}),o.a.createElement(re,{text:P}),o.a.createElement(L,y()({},e,{criteria:Object(d.h)(t),updateCriterion:c,addCriterion:m,removeCriterion:p,errors:n[0],isRatio:!0})),o.a.createElement(a.EuiSpacer,{size:"l"}),o.a.createElement(re,{text:_}),o.a.createElement(L,y()({},e,{criteria:Object(d.g)(t),updateCriterion:g,addCriterion:f,removeCriterion:E,errors:n[1],isRatio:!0})))},A=e=>{const{criteria:t,defaultCriterion:r,updateCriteria:a,errors:n}=e,{updateCriterion:i,addCriterion:l,removeCriterion:s}=B(t,r,a);return o.a.createElement(L,y()({},e,{updateCriterion:i,addCriterion:l,removeCriterion:s,errors:n[0]}))},B=(e,t,r)=>({updateCriterion:Object(i.useCallback)(((t,a)=>{const n=e.map(((e,r)=>t===r?{...e,...a}:e));r(n)}),[e,r]),addCriterion:Object(i.useCallback)((()=>{const a=[...e,t];r(a)}),[e,t,r]),removeCriterion:Object(i.useCallback)((t=>{const a=e.filter(((e,r)=>r!==t));r(a)}),[e,r])}),G=({addCriterion:e})=>o.a.createElement("div",null,o.a.createElement(a.EuiButtonEmpty,{"data-test-subj":"infraAddCriterionButtonAddConditionButton",color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:e},o.a.createElement(x.FormattedMessage,{id:"xpack.infra.logs.alertFlyout.addCondition",defaultMessage:"Add condition"}))),I=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdPrefix",{defaultMessage:"is"}),V=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdPopoverTitle",{defaultMessage:"Threshold"}),N=({comparator:e,value:t,updateThreshold:r,errors:n})=>{const[l,s]=Object(i.useState)(!1);return o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiPopover,{id:"threshold",button:o.a.createElement(a.EuiExpression,{description:I,uppercase:!0,value:`${e?d.b[e]:""} ${"number"==typeof t?t:""}`,isActive:l,onClick:()=>s(!l)}),isOpen:l,closePopover:()=>s(!1),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},o.a.createElement(o.a.Fragment,null,o.a.createElement(a.EuiPopoverTitle,null,V),o.a.createElement(a.EuiFlexGroup,null,o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiFormRow,null,o.a.createElement(a.EuiSelect,{"data-test-subj":"infraThresholdSelect",compressed:!0,value:e,onChange:e=>r({comparator:e.target.value}),options:[{value:d.a.LT,text:d.b[d.a.LT]},{value:d.a.LT_OR_EQ,text:d.b[d.a.LT_OR_EQ]},{value:d.a.GT,text:d.b[d.a.GT]},{value:d.a.GT_OR_EQ,text:d.b[d.a.GT_OR_EQ]}]}))),o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiFormRow,{isInvalid:n.value.length>0,error:n.value},o.a.createElement(a.EuiFieldNumber,{"data-test-subj":"infraThresholdFieldNumber",compressed:!0,value:t,onChange:e=>{const t=parseFloat(e.target.value);r({value:Object(C.isNumber)(t)&&Object(C.isFinite)(t)?t:void 0})}}))))))))},Q=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypePrefix",{defaultMessage:"when the"}),D=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeCountSuffix",{defaultMessage:"of log entries"}),U=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeRatioSuffix",{defaultMessage:"of Query A to Query B"}),W=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeCount",{defaultMessage:"count"}),H=n.i18n.translate("xpack.infra.logs.alertFlyout.thresholdTypeRatio",{defaultMessage:"ratio"}),$=({criteria:e,updateType:t})=>{const[r,n]=Object(i.useState)(!1),l=(e=>Object(d.k)(e)?"ratio":"count")(e);return o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiPopover,{id:"thresholdType",button:o.a.createElement(o.a.Fragment,null,o.a.createElement(a.EuiExpression,{description:Q,uppercase:!0,value:"ratio"===l?H:W,isActive:r,onClick:()=>n(!r)}),o.a.createElement(re,{text:"ratio"===l?U.toUpperCase():D.toUpperCase()})),isOpen:r,closePopover:()=>n(!1),ownFocus:!0,panelPaddingSize:"s",anchorPosition:"downLeft"},o.a.createElement(a.EuiFlexGroup,null,o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiSelect,{"data-test-subj":"infraTypeSwitcherSelect",compressed:!0,value:l,onChange:e=>t("ratio"===l?"count":"ratio"),options:[{value:"ratio",text:H},{value:"count",text:W}]}))))))},q=n.i18n.translate("xpack.infra.logs.alertFlyout.logViewDescription",{defaultMessage:"Log View"}),Y=({logView:e})=>o.a.createElement(a.EuiFlexGroup,{gutterSize:"s"},o.a.createElement(a.EuiFlexItem,{grow:!1},o.a.createElement(a.EuiToolTip,{content:e.indices},o.a.createElement(a.EuiExpression,{description:q,value:e.name})))),Z={timeSize:5,timeUnit:"m"},J="log.level",K=(e,t)=>e.some((e=>e.name===J))?{field:J,comparator:d.a.EQ,value:t}:{field:void 0,comparator:void 0,value:void 0},X=e=>{var t,r;const a=null!==(t=null===(r=e.metadata)||void 0===r?void 0:r.isInternal)&&void 0!==t&&t,{services:{logsShared:n}}=Object(p.b)();return o.a.createElement(o.a.Fragment,null,a?o.a.createElement(ee,e,o.a.createElement(te,e)):o.a.createElement(c.LogViewProvider,{logViews:n.logViews.client},o.a.createElement(ee,e,o.a.createElement(te,e))))},ee=({children:e})=>{const{load:t,isLoading:r,hasFailedLoading:i,isUninitialized:l}=Object(c.useLogViewContext)();return o.a.createElement(o.a.Fragment,null,r||l?o.a.createElement("div",null,o.a.createElement(a.EuiSpacer,{size:"m"}),o.a.createElement(a.EuiLoadingSpinner,{size:"l"}),o.a.createElement(a.EuiSpacer,{size:"m"})):i?o.a.createElement(a.EuiCallOut,{title:n.i18n.translate("xpack.infra.logs.alertFlyout.sourceStatusError",{defaultMessage:"Sorry, there was a problem loading field information"}),color:"danger",iconType:"warning"},o.a.createElement(a.EuiButton,{"data-test-subj":"infraSourceStatusWrapperTryAgainButton",onClick:t,iconType:"refresh"},n.i18n.translate("xpack.infra.logs.alertFlyout.sourceStatusErrorTryAgain",{defaultMessage:"Try again"}))):e)},te=e=>{var t,r;const{setRuleParams:l,ruleParams:p,errors:g}=e,[f,E]=Object(i.useState)(!1),{logViewReference:h,resolvedLogView:y}=Object(c.useLogViewContext)();if("log-view-reference"!==h.type)throw new Error("The Log Threshold rule type only supports persisted Log Views");const{criteria:x,threshold:C,timeSizeUnit:O,timeWindowSize:T}=Object(i.useMemo)((()=>Object(m.b)(v.a)(g)),[g]),j=Object(i.useMemo)((()=>null!=y&&y.fields?y.fields.filter((e=>("string"===e.type||"number"===e.type)&&e.searchable)):[]),[y]),w=Object(i.useMemo)((()=>null!=y&&y.fields?y.fields.filter((e=>"string"===e.type&&e.aggregatable)):[]),[y]),k=Object(i.useCallback)((e=>{const t={...p.count,...e};l("count",t)}),[p.count,l]),S=Object(i.useCallback)((e=>{l("criteria",e)}),[l]),F=Object(i.useCallback)((e=>{l("timeSize",e)}),[l]),M=Object(i.useCallback)((e=>{d.o.is(e)&&l("timeUnit",e)}),[l]),P=Object(i.useCallback)((e=>{l("groupBy",e)}),[l]),_=Object(i.useMemo)((()=>{return e=j,t=h,{...Z,logView:t,count:{value:75,comparator:d.a.GT},criteria:[K(e,"error")]};var e,t}),[j,h]),L=Object(i.useCallback)((e=>{const t="count"===e?_:(r=j,a=h,{...Z,logView:a,count:{value:2,comparator:d.a.GT},criteria:[[K(r,"error")],[K(r,"warning")]]});var r,a;l("count",t.count),l("criteria",t.criteria)}),[_,l,j,h]);s()((()=>{const e={..._,...p};for(const[t,r]of Object.entries(e))l(t,r);E(!0)}));const z=Object(i.useMemo)((()=>p.groupBy&&p.groupBy.length>0&&p.count&&!Object(d.j)(p.count.comparator,p.count.value)),[p]);if(!f)return null;const A=p.criteria?o.a.createElement(R,{fields:j,criteria:p.criteria,defaultCriterion:_.criteria[0],errors:x,ruleParams:p,logViewReference:h,updateCriteria:S}):null;return o.a.createElement(o.a.Fragment,null,y&&o.a.createElement(Y,{logView:y}),o.a.createElement($,{criteria:p.criteria||[],updateType:L}),p.criteria&&!Object(d.k)(p.criteria)&&A,o.a.createElement(N,{comparator:null===(t=p.count)||void 0===t?void 0:t.comparator,value:null===(r=p.count)||void 0===r?void 0:r.value,updateThreshold:k,errors:C}),o.a.createElement(u.ForLastExpression,{timeWindowSize:p.timeSize,timeWindowUnit:p.timeUnit,onChangeWindowSize:F,onChangeWindowUnit:M,errors:{timeWindowSize:T,timeSizeUnit:O}}),o.a.createElement(b,{selectedGroups:p.groupBy,onChange:P,fields:w}),p.criteria&&Object(d.k)(p.criteria)&&A,z&&o.a.createElement(o.a.Fragment,null,o.a.createElement(a.EuiSpacer,{size:"l"}),o.a.createElement(a.EuiCallOut,{color:"warning"},n.i18n.translate("xpack.infra.logs.alertFlyout.groupByOptimizationWarning",{defaultMessage:'When setting a "group by" we highly recommend using the "{comparator}" comparator for your threshold. This can lead to significant performance improvements.',values:{comparator:d.a.GT}}))),o.a.createElement(a.EuiSpacer,{size:"l"}))};t.default=X;const re=({text:e})=>o.a.createElement("div",{className:"euiExpression euiExpression-isUppercase euiExpression--success"},o.a.createElement("span",{className:"euiExpression__description"},e))}}]);