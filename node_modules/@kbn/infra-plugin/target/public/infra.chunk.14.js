/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[14],{112:function(e,t,r){"use strict";r.d(t,"k",(function(){return n.b})),r.d(t,"m",(function(){return l})),r.d(t,"l",(function(){return u})),r.d(t,"a",(function(){return h.a})),r.d(t,"r",(function(){return h.u})),r.d(t,"p",(function(){return h.s})),r.d(t,"q",(function(){return h.t})),r.d(t,"e",(function(){return h.f})),r.d(t,"w",(function(){return h.B})),r.d(t,"x",(function(){return h.C})),r.d(t,"f",(function(){return h.g})),r.d(t,"y",(function(){return h.D})),r.d(t,"z",(function(){return h.E})),r.d(t,"b",(function(){return h.c})),r.d(t,"n",(function(){return h.q})),r.d(t,"o",(function(){return h.r})),r.d(t,"g",(function(){return h.h})),r.d(t,"A",(function(){return h.F})),r.d(t,"B",(function(){return h.G})),r.d(t,"h",(function(){return h.i})),r.d(t,"C",(function(){return h.H})),r.d(t,"D",(function(){return h.I})),r.d(t,"d",(function(){return h.e})),r.d(t,"v",(function(){return h.A})),r.d(t,"u",(function(){return h.z})),r.d(t,"c",(function(){return h.d})),r.d(t,"s",(function(){return h.x})),r.d(t,"t",(function(){return h.y})),r.d(t,"i",(function(){return h.j})),r.d(t,"E",(function(){return h.M})),r.d(t,"F",(function(){return h.N})),r.d(t,"j",(function(){return h.k})),r.d(t,"H",(function(){return h.P})),r.d(t,"G",(function(){return h.O})),r.d(t,"I",(function(){return h.Q})),r(116);var n=r(28),a=r(44),i=(r(33),r(0));const o=i.type({value:i.number}),s=(i.type({hostTerm:i.record(i.string,i.string),indexPattern:i.string,to:i.number,sortBy:i.type({name:i.string,isAscending:i.boolean}),searchFilter:i.array(i.record(i.string,i.record(i.string,i.unknown)))}),i.type({summaryEvent:i.type({summary:i.type({hits:i.type({hits:i.array(i.type({_source:i.type({system:i.type({process:i.type({summary:i.record(i.string,i.number)})})})}))})})}),processes:i.type({filteredProcs:i.type({buckets:i.array(i.type({key:i.string,cpu:o,memory:o,startTime:i.type({value_as_string:i.string}),meta:i.type({hits:i.type({hits:i.array(i.type({_source:i.type({process:i.type({pid:i.number}),system:i.type({process:i.type({state:i.string})}),user:i.type({name:i.string})})}))})})}))})})}),i.union([i.number,i.string])),l=i.type({processList:i.array(i.type({cpu:i.union([i.null,i.number]),memory:i.union([i.null,i.number]),startTime:i.number,pid:i.number,state:i.string,user:i.string,command:i.string})),summary:i.exact(i.partial({total:s,running:s,sleeping:s,dead:s,stopped:s,idle:s,zombie:s,unknown:s}))}),u=(i.type({hostTerm:i.record(i.string,i.string),indexPattern:i.string,to:i.number,command:i.string}),i.type({process:i.type({filteredProc:i.type({buckets:i.array(i.type({timeseries:i.type({buckets:i.array(i.type({key:i.number,memory:o,cpu:o}))})}))})})}),i.type({cpu:a.a,memory:a.a}));var c=r(13);const m=i.keyof({cpu:null,normalizedLoad1m:null,diskSpaceUsage:null,memory:null,memoryFree:null,rx:null,tx:null}),d=i.type({from:c.c,to:c.c}),p=i.keyof({"cloud.provider":null,"host.ip":null,"host.os.name":null}),g=i.type({name:m,value:i.union([i.number,i.null])}),y=i.type({name:p,value:i.union([i.string,i.null])}),f=(i.intersection([i.partial({query:i.UnknownRecord}),i.type({type:i.literal("host"),limit:i.union([Object(c.d)(1,500),Object(c.b)(20)]),metrics:i.array(i.type({type:m})),sourceId:i.string,range:d})]),i.type({name:i.string,metrics:i.array(g),metadata:i.array(y)}));i.type({type:i.literal("host"),nodes:i.array(f)});var h=r(7);r(49),r(52),r(48),r(51),r(50)},116:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n=r(0),a=r(20);n.type({nodeId:n.string,nodeType:a.ItemTypeRT,sourceId:n.string,timeRange:n.type({from:n.number,to:n.number})});const i=n.type({name:n.string,source:n.string}),o=n.partial({codename:n.string,family:n.string,kernel:n.string,name:n.string,platform:n.string,version:n.string,build:n.string}),s=n.partial({name:n.string,hostname:n.string,id:n.string,ip:n.union([n.array(n.string),n.string]),mac:n.union([n.array(n.string),n.string]),os:o,architecture:n.string,containerized:n.boolean}),l=n.partial({id:n.string,name:n.string}),u=n.partial({id:n.string,name:n.string}),c=n.partial({id:n.string}),m=n.partial({interface:n.string,type:n.string}),d=n.partial({instance:l,provider:n.string,account:u,availability_zone:n.string,project:c,machine:m,region:n.string}),p=n.partial({id:n.string,version:n.string,policy:n.string}),g=(n.partial({cloud:d,host:s,agent:p,"@timestamp":n.string}),n.partial({cloud:d,host:s,agent:p,timestamp:n.string})),y=n.type({id:n.string,name:n.string,features:n.array(i)}),f=n.partial({info:g}),h=n.intersection([y,f])},155:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(67),a=r(2),i=n.__importDefault(r(169));t.default=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=i.default(e,t),o=n[0],s=n[1],l=n[2];return a.useEffect(l,r),[o,s]}},169:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);t.default=function(e,t){void 0===t&&(t=0);var r=n.useRef(!1),a=n.useRef(),i=n.useRef(e),o=n.useCallback((function(){return r.current}),[]),s=n.useCallback((function(){r.current=!1,a.current&&clearTimeout(a.current),a.current=setTimeout((function(){r.current=!0,i.current()}),t)}),[t]),l=n.useCallback((function(){r.current=null,a.current&&clearTimeout(a.current)}),[]);return n.useEffect((function(){i.current=e}),[e]),n.useEffect((function(){return s(),l}),[t]),[o,l,s]}},230:function(e,t,r){"use strict";r.d(t,"a",(function(){return T}));var n=r(2),a=r.n(n),i=r(155),o=r.n(i),s=r(1),l=r(79),u=r(40),c=r(76),m=r(118),d=r(131),p=r(14),g=r(26),y=r(112),f=r(24),h=r(54),b=r(19),E=r(111);const v=async(e,t,r,n,a)=>{const i=await t(y.a,{method:"POST",body:JSON.stringify(y.q.encode({data:{logView:e,alertParams:r,buckets:n,executionTimeRange:a}})),version:"1"});return Object(b.b)(y.r)(i)};var x=r(129);const T=({ruleParams:e,chartCriterion:t,logViewReference:r,showThreshold:i,executionTimeRange:o,annotations:s,filterSeriesByGroupName:l})=>{const u=Object(n.useMemo)((()=>{const{field:r,comparator:n,value:a}=t,i={criteria:r&&n&&a?[{field:r,comparator:n,value:a}]:[],count:{comparator:e.count.comparator,value:e.count.value},timeSize:e.timeSize,timeUnit:e.timeUnit,groupBy:e.groupBy};try{return Object(b.b)(y.p)(i)}catch(e){return null}}),[e.timeSize,e.timeUnit,e.groupBy,e.count.comparator,e.count.value,t]);return null===u||0===u.criteria.length?null:a.a.createElement(k,{buckets:u.groupBy&&0!==u.groupBy.length?d.d/4:d.d,logViewReference:r,threshold:e.count,chartAlertParams:u,showThreshold:i,executionTimeRange:o,annotations:s,filterSeriesByGroupName:l})},k=({buckets:e,logViewReference:t,threshold:r,chartAlertParams:i,showThreshold:y,executionTimeRange:b,annotations:T,filterSeriesByGroupName:k})=>{const w=Object(m.a)(),O=Object(x.a)(),{getChartPreviewData:j,isLoading:S,hasError:R,chartPreviewData:z}=(({logViewReference:e,ruleParams:t,buckets:r,executionTimeRange:a,filterSeriesByGroupName:i})=>{const{http:o}=Object(f.useKibana)().services,[s,l]=Object(n.useState)([]),[u,c]=Object(n.useState)(!1),[m,d]=Object(E.b)({cancelPreviousOn:"creation",createPromise:async()=>{if(c(!1),Object(h.e)(t.criteria)){var n;const u=await Promise.all([v(e,o.fetch,{...t,criteria:[...t.criteria[0]]},r,a),v(e,o.fetch,{...t,criteria:[...t.criteria[1]]},r,a)]);let c=u[0].data.series[0].points,m=u[1].data.series[0].points,d="ratio";var s,l;null!==(n=t.groupBy)&&void 0!==n&&n.length&&i&&(d=i,c=(null===(s=u[0].data.series.find((e=>e.id===i)))||void 0===s?void 0:s.points)||[],m=(null===(l=u[1].data.series.find((e=>e.id===i)))||void 0===l?void 0:l.points)||[]);const p=[];for(let e=0;e<c.length;e++){const t={timestamp:c[e].timestamp,value:0};if(0===c[e].value||0===m[e].value)p.push(t);else{const r=c[e].value/m[e].value;p.push({...t,value:r})}}return{data:{series:[{id:d,points:p}]}}}return await v(e,o.fetch,t,r,a)},onResolve:({data:{series:e}})=>{c(!1),l(e)},onReject:e=>{c(!0)}},[e,o,t,r]);return{chartPreviewData:s,hasError:u,isLoading:Object(n.useMemo)((()=>"pending"===m.state),[m.state]),getChartPreviewData:d}})({logViewReference:t,ruleParams:i,buckets:e,executionTimeRange:b});o()((()=>{j()}),500,[j]);const{timeSize:L,timeUnit:A,groupBy:M}=i,P=!!(M&&M.length>0),B=!!(y&&r&&r.comparator)&&[p.a.GT,p.a.GT_OR_EQ].includes(r.comparator),D=!!(y&&r&&r.comparator)&&[p.a.LT,p.a.LT_OR_EQ].includes(r.comparator),_=Object(n.useMemo)((()=>{if(!P)return z;if(k&&k.length)return z.filter((e=>k.includes(e.id)));const e=z.sort(((e,t)=>{const r=Math.max(...e.points.map((e=>e.value)));return Math.max(...t.points.map((e=>e.value)))-r}));return(!B&&!D||B?e:e.reverse()).slice(0,5)}),[P,k,z,B,D]),F=Object(n.useMemo)((()=>_.reduce(((e,t)=>[...e,...t.points.reduce(((e,r)=>[...e,{...r,groupBy:t.id}]),[])]),[])),[_]),G=L*e,I=z.length>0,{yMin:V,yMax:C,xMin:H,xMax:U}=Object(d.g)(_,!1),N={max:y&&r?1.1*Math.max(C,r.value):1.1*C,min:y&&r?Math.min(V,r.value):V};y&&r&&N.min===r.value&&(N.min=.9*N.min);const q=M&&M.length>0?M.join(", "):null,W=Object(d.i)(H,U),Q=d.f[A];return S?a.a.createElement(d.c,null):R?a.a.createElement(d.b,null):I?a.a.createElement(a.a.Fragment,null,a.a.createElement(d.a,null,a.a.createElement(l.Chart,null,a.a.createElement(l.BarSeries,{id:"criterion-preview",xScaleType:l.ScaleType.Time,yScaleType:l.ScaleType.Linear,xAccessor:"timestamp",yAccessors:["value"],splitSeriesAccessors:["groupBy"],stackAccessors:void 0,data:F,barSeriesStyle:{rectBorder:{stroke:P?void 0:Object(g.b)(g.a.color0),strokeWidth:1,visible:!0},rect:{opacity:1}},color:P?void 0:Object(g.b)(g.a.color0),timeZone:O}),y&&r?a.a.createElement(l.LineAnnotation,{id:"threshold-line",domainType:l.AnnotationDomainType.YDomain,dataValues:[{dataValue:r.value}],style:{line:{strokeWidth:2,stroke:Object(g.b)(g.a.color1),opacity:1}}}):null,y&&r&&D?a.a.createElement(l.RectAnnotation,{id:"below-threshold",style:{fill:Object(g.b)(g.a.color1),opacity:.3},dataValues:[{coordinates:{x0:H,x1:U,y0:N.min,y1:r.value}}]}):null,T,y&&r&&B?a.a.createElement(l.RectAnnotation,{id:"above-threshold",style:{fill:Object(g.b)(g.a.color1),opacity:.3},dataValues:[{coordinates:{x0:H,x1:U,y0:r.value,y1:N.max}}]}):null,a.a.createElement(l.Axis,{id:"timestamp",position:l.Position.Bottom,showOverlappingTicks:!0,tickFormat:W}),a.a.createElement(l.Axis,{id:"values",position:l.Position.Left,tickFormat:d.j,domain:N}),a.a.createElement(l.Settings,{baseTheme:w.baseTheme,locale:s.i18n.getLocale()}),a.a.createElement(l.Tooltip,d.h))),!b&&a.a.createElement("div",{style:{textAlign:"center"}},null!=q?a.a.createElement(u.EuiText,{size:"xs",color:"subdued"},a.a.createElement(c.FormattedMessage,{id:"xpack.infra.logs.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data, grouped by {groupByLabel} (showing {displayedGroups}/{totalGroups} groups)",values:{groupByLabel:q,timeLabel:Q,lookback:G,displayedGroups:_.length,totalGroups:z.length}})):a.a.createElement(u.EuiText,{size:"xs",color:"subdued"},a.a.createElement(c.FormattedMessage,{id:"xpack.infra.logs.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel} of data",values:{timeLabel:Q,lookback:G}})))):a.a.createElement(d.e,null)}},525:function(e,t,r){"use strict";r.r(t);var n=r(32),a=r.n(n),i=r(2),o=r.n(i),s=r(40),l=r(1),u=r(39),c=r(79),m=r(93),d=r(12),p=r(18),g=r.n(p),y=r(294),f=r(22),h=r(230);t.default=({rule:e})=>{const{http:t,notifications:r}=Object(f.b)().services,n=e.params.criteria[0],i={from:"now-30d",to:"now"},p={gte:g.a.parse(i.from).valueOf(),lte:g.a.parse(i.to,{roundUp:!0}).valueOf()},{data:{histogramTriggeredAlerts:b,avgTimeToRecoverUS:E,totalTriggeredAlerts:v},isLoading:x,isError:T}=Object(y.c)({http:t,featureIds:[d.ob.LOGS],ruleId:e.id,dateRange:i});T&&(null==r||r.toasts.addDanger({title:l.i18n.translate("xpack.infra.alertDetails.logsAlertHistoryChart.error.toastTitle",{defaultMessage:"Logs alerts history chart error"}),text:l.i18n.translate("xpack.infra.alertDetails.logsAlertHistoryChart.error.toastDescription",{defaultMessage:"An error occurred when fetching logs alert history chart data"})}));const k=(null==b?void 0:b.filter((e=>e.doc_count>0)).map((e=>({dataValue:e.key,header:String(e.doc_count),details:a()(e.key_as_string).format("yyyy-MM-DD")}))))||[];return o.a.createElement(s.EuiPanel,{hasBorder:!0,"data-test-subj":"logsHistoryChartAlertDetails"},o.a.createElement(s.EuiFlexGroup,{direction:"column",gutterSize:"none",responsive:!1},o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiTitle,{size:"xs"},o.a.createElement("h2",null,l.i18n.translate("xpack.infra.logs.alertDetails.chartHistory.chartTitle",{defaultMessage:"Logs threshold alerts history"})))),o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiText,{size:"s",color:"subdued"},l.i18n.translate("xpack.infra.logs.alertDetails.chartHistory.last30days",{defaultMessage:"Last 30 days"})))),o.a.createElement(s.EuiSpacer,{size:"s"}),o.a.createElement(s.EuiFlexGroup,{gutterSize:"l"},o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiFlexGroup,{gutterSize:"xs",direction:"column"},o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiText,{color:"danger"},o.a.createElement(s.EuiTitle,{size:"s"},o.a.createElement("h3",null,x?o.a.createElement(s.EuiLoadingSpinner,{size:"s"}):v||"-")))),o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiText,{size:"s",color:"subdued"},l.i18n.translate("xpack.infra.logs.alertDetails.chartHistory.alertsTriggered",{defaultMessage:"Alerts triggered"}))))),o.a.createElement(s.EuiFlexGroup,{gutterSize:"xs",direction:"column"},o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiText,null,o.a.createElement(s.EuiTitle,{size:"s"},o.a.createElement("h3",null,x?o.a.createElement(s.EuiLoadingSpinner,{size:"s"}):E?Object(u.convertTo)({unit:"minutes",microseconds:E,extended:!0}).formatted:"-")))),o.a.createElement(s.EuiFlexItem,{grow:!1},o.a.createElement(s.EuiText,{size:"s",color:"subdued"},l.i18n.translate("xpack.infra.logs.alertDetails.chartHistory.avgTimeToRecover",{defaultMessage:"Avg time to recover"}))))),o.a.createElement(s.EuiSpacer,{size:"s"}),o.a.createElement(h.a,{annotations:[o.a.createElement(c.LineAnnotation,{id:"annotations",key:"annotationsAlertHistory",domainType:c.AnnotationDomainType.XDomain,dataValues:k,style:{line:{strokeWidth:3,stroke:m.euiThemeVars.euiColorDangerText,opacity:1}},marker:o.a.createElement(s.EuiIcon,{type:"warning",color:"danger"}),markerBody:e=>o.a.createElement(o.a.Fragment,null,o.a.createElement(s.EuiBadge,{color:"danger"},o.a.createElement(s.EuiText,{size:"xs",color:"white"},e.header)),o.a.createElement(s.EuiSpacer,{size:"xs"})),markerPosition:c.Position.Top})],ruleParams:e.params,logViewReference:e.params.logView,chartCriterion:n,showThreshold:!0,executionTimeRange:p}))}}}]);