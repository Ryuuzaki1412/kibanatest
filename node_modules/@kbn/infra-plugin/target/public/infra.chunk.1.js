/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.infra_bundle_jsonpfunction=window.infra_bundle_jsonpfunction||[]).push([[1],{110:function(e,t,s){"use strict";s.d(t,"a",(function(){return g})),s.d(t,"b",(function(){return p})),s.d(t,"c",(function(){return h}));var i=s(109),n=s.n(i),r=s(2),o=s.n(r),a=s(24),u=s(111),c=s(1);const l=c.i18n.translate("xpack.infra.sourceConfiguration.missingHttp",{defaultMessage:"Failed to load source: No HTTP client available."});class MissingHttpClientException extends Error{constructor(){super(l),Object.setPrototypeOf(this,new.target.prototype),this.name="MissingHttpClientException"}}const d=(e,t)=>e?"metrics"===t?e.configuration.metricAlias:`${e.configuration.metricAlias}`:"unknown-index",[g,p]=n()((({sourceId:e})=>{var t;const{services:s}=Object(a.useKibana)(),i=(()=>{const{notifications:e}=Object(a.useKibana)();return{updateFailure:t=>{e.toasts.danger({toastLifeTimeMs:3e3,title:c.i18n.translate("xpack.infra.sourceConfiguration.updateFailureTitle",{defaultMessage:"Configuration update failed"}),body:[c.i18n.translate("xpack.infra.sourceConfiguration.updateFailureBody",{defaultMessage:"We couldn't apply the changes to the Metrics configuration. Try again later."}),t].filter(Boolean).join(" ")})},updateSuccess:()=>{e.toasts.success({toastLifeTimeMs:3e3,title:c.i18n.translate("xpack.infra.sourceConfiguration.updateSuccessTitle",{defaultMessage:"Metrics settings successfully updated"})})}}})(),n=s.http,o=`/api/metrics/source/${e}`,[l,g]=Object(r.useState)(void 0),[p,h]=Object(u.b)({cancelPreviousOn:"resolution",createPromise:()=>{if(!n)throw new MissingHttpClientException;return n.fetch(o,{method:"GET"})},onResolve:e=>{e&&g(e.source)}},[n,e]),[f,m]=Object(u.b)({createPromise:async e=>{if(!n)throw new MissingHttpClientException;return await n.patch(o,{method:"PATCH",body:JSON.stringify(e)})},onResolve:e=>{e&&(i.updateSuccess(),g(e.source))},onReject:e=>{var t;i.updateFailure(null===(t=e.body)||void 0===t?void 0:t.message)}},[n,e]);Object(r.useEffect)((()=>{h()}),[h,e]);const b="rejected"===p.state,y="uninitialized"===p.state,S="pending"===p.state,v=S||"pending"===f.state,O=l?!!l.version:void 0,j=Boolean(null==l||null===(t=l.status)||void 0===t?void 0:t.metricIndicesExist),x=null==l?void 0:l.version;return{createSourceConfiguration:m,createDerivedIndexPattern:()=>({fields:null!=l&&l.status?l.status.indexFields:[],title:d(l,"metrics")}),isLoading:v,isLoadingSource:S,isUninitialized:y,hasFailedLoadingSource:b,loadSource:h,loadSourceRequest:p,loadSourceFailureMessage:b?`${p.value}`:void 0,metricIndicesExist:j,source:l,sourceExists:O,sourceId:e,updateSourceConfiguration:m,version:x}})),h=e=>(t="default")=>function(s){return o.a.createElement(g,{sourceId:t},o.a.createElement(e,s))}},115:function(e,t,s){"use strict";s.d(t,"b",(function(){return b})),s.d(t,"g",(function(){return y}));var i=s(18),n=s.n(i),r=s(0),o=s(109),a=s.n(o),u=s(2),c=s(9);s.d(t,"c",(function(){return c.d})),s.d(t,"a",(function(){return c.c})),s.d(t,"e",(function(){return c.g})),s.d(t,"d",(function(){return c.f})),s.d(t,"f",(function(){return c.h}));var l=s(132),d=s(26),g=s(141);r.type({fromTimestamp:r.number,toTimestamp:r.number,interval:r.string});const p=">=10s",h={type:c.c.line,yAxisMode:c.d.fromZero,stack:!1},f={aggregation:"avg",metrics:[{aggregation:"avg",field:"system.cpu.total.norm.pct",color:d.a.color0},{aggregation:"avg",field:"kubernetes.pod.cpu.usage.node.pct",color:d.a.color1},{aggregation:"avg",field:"docker.cpu.total.pct",color:d.a.color2}],source:"default"};function m(e,t){const s=localStorage.getItem(e),[i,n]=Object(u.useState)(function(e,t){if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}(s,t));return Object(u.useEffect)((()=>{localStorage.setItem(e,JSON.stringify(i))}),[e,i]),[i,n]}const[b,y]=a()((()=>{const e={from:"now-1h",to:"now"},[t]=Object(g.a)(e),{from:s,to:i}=t(),[r,o]=m("MetricsExplorerOptions",f),[a,c]=Object(u.useState)({from:s,to:i,interval:p}),[d,b]=Object(u.useState)((({from:e,to:t})=>({fromTimestamp:n.a.parse(e).valueOf(),toTimestamp:n.a.parse(t,{roundUp:!0}).valueOf(),interval:p}))({from:s,to:i}));Object(g.b)(e,{from:a.from,to:a.to});const[y,S]=m("MetricsExplorerChartOptions",h),[v,O]=Object(u.useState)(!1),{metricThresholdPrefill:j}=Object(l.b)(),x=Object(u.useMemo)((()=>j),[j]);return Object(u.useEffect)((()=>{if(x){const{setPrefillOptions:e}=x,{metrics:t,groupBy:s,filterQuery:i}=r;e({metrics:t,groupBy:s,filterQuery:i})}}),[r,x]),{defaultViewState:{options:f,chartOptions:h,currentTimerange:a},options:r,chartOptions:y,setChartOptions:S,timeRange:a,isAutoReloading:v,setOptions:o,setTimeRange:c,startAutoReload:()=>O(!0),stopAutoReload:()=>O(!1),timestamps:d,setTimestamps:b}}))},132:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return u}));var i=s(109),n=s.n(i),r=s(8),o=s(2);const[a,u]=n()((()=>({metricThresholdPrefill:(()=>{const[e,t]=Object(o.useState)({groupBy:void 0,filterQuery:void 0,metrics:[]}),{groupBy:s,filterQuery:i,metrics:n}=e;return{groupBy:s,filterQuery:i,metrics:n,setPrefillOptions(s){Object(r.isEqual)(s,e)||t(s)}}})(),inventoryPrefill:(()=>{const[e,t]=Object(o.useState)("host"),[s,i]=Object(o.useState)(),[n,r]=Object(o.useState)({type:"cpu"}),[a,u]=Object(o.useState)([]);return{nodeType:e,filterQuery:s,metric:n,customMetrics:a,setNodeType:t,setFilterQuery:i,setMetric:r,setCustomMetrics:u}})()})))},138:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const i=(e,t)=>`metric_${t}`},139:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var i=s(45);const n=(e,t,s=!0)=>{try{return e?JSON.stringify(Object(i.toElasticsearchQuery)(Object(i.fromKueryExpression)(e),t)):""}catch(e){if(s)return"";throw e}}},145:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var i=s(8),n=s(138);const r=e=>{const t=Object(i.min)(e);return Object(i.isNumber)(t)&&Number.isFinite(t)?t:void 0},o=e=>{const t=Object(i.max)(e);return Object(i.isNumber)(t)&&Number.isFinite(t)?t:void 0},a=(e,t,s=!1)=>{const a=e.rows.reduce(((e,a)=>{const u=t.map(((e,t)=>a[Object(n.a)(e,t)]||null)).filter((e=>Object(i.isNumber)(e))),c=r(u),l=s?1.1*Object(i.sum)(u):o(u);return e.concat([c||null,l||null])}),[]).filter((e=>Object(i.isNumber)(e)));return{min:r(a)||0,max:o(a)||0}}},146:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var i=s(87),n=s.n(i),r=s(46),o=s(43),a=s(187);const u=e=>{if("custom"===(null==e?void 0:e.aggregation))return e=>n()(e).format("0.[0000]");if(e&&e.field){const t=Object(a.a)(e);return t===o.b.bits&&"rate"===e.aggregation?Object(r.b)(o.b.bits,"{{value}}/s"):Object(r.b)(t)}return Object(r.b)(o.b.number)}},147:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var i=s(2),n=s.n(i),r=s(79),o=s(26),a=s(188),u=s(115),c=s(129),l=s(138);const d=e=>u.a.bar===e.type?n.a.createElement(p,e):n.a.createElement(g,e),g=({metric:e,id:t,series:s,type:i,stack:d,opacity:g})=>{const p=Object(c.a)(),h=e.color&&Object(o.b)(e.color)||Object(o.b)(o.a.color0),f=Array.isArray(t)?t.map((t=>Object(l.a)(e,t))).slice(t.length-1,t.length):[Object(l.a)(e,t)],m=Array.isArray(t)&&t.length>1?t.map((t=>Object(l.a)(e,t))).slice(0,1):void 0,b=`series-${s.id}-${f.join("-")}`,y={line:{strokeWidth:2,visible:!0},area:{opacity:g||.5,visible:i===u.a.area}};return n.a.createElement(r.AreaSeries,{id:b,key:b,name:Object(a.a)(e),xScaleType:r.ScaleType.Time,yScaleType:r.ScaleType.Linear,xAccessor:"timestamp",yAccessors:f,y0Accessors:m,data:s.rows,stackAccessors:d?["timestamp"]:void 0,areaSeriesStyle:y,color:h,timeZone:p})},p=({metric:e,id:t,series:s,stack:i})=>{const u=Object(c.a)(),d=e.color&&Object(o.b)(e.color)||Object(o.b)(o.a.color0),g=Array.isArray(t)?t.map((t=>Object(l.a)(e,t))).slice(t.length-1,t.length):[Object(l.a)(e,t)],p=`series-${s.id}-${g.join("-")}`,h={rectBorder:{stroke:d,strokeWidth:1,visible:!0},rect:{opacity:1}};return n.a.createElement(r.BarSeries,{id:p,key:p,name:Object(a.a)(e),xScaleType:r.ScaleType.Time,yScaleType:r.ScaleType.Linear,xAccessor:"timestamp",yAccessors:g,data:s.rows,stackAccessors:i?["timestamp"]:void 0,barSeriesStyle:h,color:d,timeZone:u})}},153:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(2),n=function(e,t){return"boolean"==typeof t?t:!e};t.default=function(e){return i.useReducer(n,e)}},164:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var i=s(1),n=s(45),r=s(2),o=s.n(r),a=s(286),u=s(295);const c=({derivedIndexPattern:e,onSubmit:t,onChange:s,value:c,placeholder:d,curryLoadSuggestions:g=l,compressed:p})=>{const[h,f]=Object(r.useState)(c||""),[m,b]=Object(r.useState)(!0);Object(r.useEffect)((()=>{c&&f(c)}),[c]);const y=e=>{b(function(e){try{Object(n.fromKueryExpression)(e)}catch(e){return!1}return!0}(e)),f(e),s&&s(e)},S={...e,fields:e.fields},v=i.i18n.translate("xpack.infra.homePage.toolbar.kqlSearchFieldPlaceholder",{defaultMessage:"Search for infrastructure dataâ€¦ (e.g. host.name:host-1)"});return o.a.createElement(a.a,{indexPattern:S},(({isLoadingSuggestions:e,loadSuggestions:s,suggestions:i})=>o.a.createElement(u.a,{compressed:p,"aria-label":d,isLoadingSuggestions:e,isValid:m,loadSuggestions:g(s),onChange:y,onSubmit:t,placeholder:d||v,suggestions:i,value:h})))},l=e=>(...t)=>e(...t)},187:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var i=s(8),n=s(43);const r=e=>{if(e&&e.field){const t=Object(i.last)(e.field.split(/\./));if("pct"===t)return n.b.percent;if("bytes"===t&&"rate"===e.aggregation)return n.b.bits;if("bytes"===t)return n.b.bytes}return n.b.number}},188:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const i=e=>e.label?e.label:`${e.aggregation}(${e.field||""})`},286:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var i=s(4),n=s.n(i),r=s(2),o=s.n(r),a=s(24);class WithKueryAutocompletionComponent extends o.a.Component{constructor(...e){super(...e),n()(this,"state",{currentRequest:null,suggestions:[]}),n()(this,"loadSuggestions",(async(e,t,s,i)=>{const{indexPattern:n}=this.props,r="kuery";if(!this.props.kibana.services.unifiedSearch.autocomplete.hasQuerySuggestions(r))return;this.setState({currentRequest:{expression:e,cursorPosition:t},suggestions:[]});const o=await this.props.kibana.services.unifiedSearch.autocomplete.getQuerySuggestions({language:r,query:e,selectionStart:t,selectionEnd:t,indexPatterns:[n],boolFilter:[]})||[],a=i?i(o):o;this.setState((i=>i.currentRequest&&i.currentRequest.expression!==e&&i.currentRequest.cursorPosition!==t?i:{...i,currentRequest:null,suggestions:s?a.slice(0,s):a}))}))}render(){const{currentRequest:e,suggestions:t}=this.state;return this.props.children({isLoadingSuggestions:null!==e,loadSuggestions:this.loadSuggestions,suggestions:t})}}const u=Object(a.withKibana)(WithKueryAutocompletionComponent)},295:function(e,t,s){"use strict";s.d(t,"a",(function(){return autocomplete_field_AutocompleteField}));var i=s(4),n=s.n(i),r=s(40),o=s(2),a=s.n(o),u=s(31);function c(...e){return(t,s)=>e.reduce(((e,t)=>t(e,s)||e),t)}s(8);var l=s(102),d=s(159);const g=e=>{const{isSelected:t,onClick:s,onMouseEnter:i,suggestion:n}=e;return a.a.createElement(p,{isSelected:t,onClick:s,onMouseEnter:i},a.a.createElement(f,{suggestionType:n.type},a.a.createElement(r.EuiIcon,{type:y(n.type)})),a.a.createElement(m,null,n.text),a.a.createElement(b,null,n.description))};g.defaultProps={isSelected:!1};const p=u.euiStyled.div`
  display: flex;
  flex-direction: row;
  font-size: ${e=>e.theme.eui.euiFontSizeS};
  height: ${e=>e.theme.eui.euiSizeXL};
  white-space: nowrap;
  background-color: ${e=>e.isSelected?e.theme.eui.euiColorLightestShade:"transparent"};
`,h=u.euiStyled.div`
  align-items: center;
  cursor: pointer;
  display: flex;
  flex-direction: row;
  height: ${e=>e.theme.eui.euiSizeXL};
  padding: ${e=>e.theme.eui.euiSizeXS};
`,f=Object(u.euiStyled)(h)`
  background-color: ${e=>Object(d.transparentize)(.9,S(e.theme,e.suggestionType))};
  color: ${e=>S(e.theme,e.suggestionType)};
  flex: 0 0 auto;
  justify-content: center;
  width: ${e=>e.theme.eui.euiSizeXL};
`,m=Object(u.euiStyled)(h)`
  flex: 2 0 0;
  font-family: ${e=>e.theme.eui.euiCodeFontFamily};
`,b=Object(u.euiStyled)(h)`
  flex: 3 0 0;

  p {
    display: inline;

    span {
      font-family: ${e=>e.theme.eui.euiCodeFontFamily};
    }
  }
`,y=e=>{switch(e){case l.QuerySuggestionTypes.Field:return"kqlField";case l.QuerySuggestionTypes.Value:return"kqlValue";case l.QuerySuggestionTypes.RecentSearch:return"search";case l.QuerySuggestionTypes.Conjunction:return"kqlSelector";case l.QuerySuggestionTypes.Operator:return"kqlOperand";default:return"empty"}},S=(e,t)=>{switch(t){case l.QuerySuggestionTypes.Field:return null==e?void 0:e.eui.euiColorVis7;case l.QuerySuggestionTypes.Value:return null==e?void 0:e.eui.euiColorVis0;case l.QuerySuggestionTypes.Operator:return null==e?void 0:e.eui.euiColorVis1;case l.QuerySuggestionTypes.Conjunction:return null==e?void 0:e.eui.euiColorVis2;case l.QuerySuggestionTypes.RecentSearch:default:return null==e?void 0:e.eui.euiColorMediumShade}};class autocomplete_field_AutocompleteField extends a.a.Component{constructor(...e){super(...e),n()(this,"state",{areSuggestionsVisible:!1,isFocused:!1,selectedIndex:null}),n()(this,"inputElement",null),n()(this,"handleChangeInputRef",(e=>{this.inputElement=e})),n()(this,"handleChange",(e=>{this.changeValue(e.currentTarget.value)})),n()(this,"handleKeyDown",(e=>{const{suggestions:t}=this.props;switch(e.key){case"ArrowUp":e.preventDefault(),t.length>0&&this.setState(c(x,v));break;case"ArrowDown":e.preventDefault(),t.length>0?this.setState(c(x,O)):this.updateSuggestions();break;case"Enter":e.preventDefault(),null!==this.state.selectedIndex?this.applySelectedSuggestion():this.submit();break;case"Escape":e.preventDefault(),this.setState(E)}})),n()(this,"handleKeyUp",(e=>{switch(e.key){case"ArrowLeft":case"ArrowRight":case"Home":case"End":this.updateSuggestions()}})),n()(this,"handleFocus",(()=>{this.setState(c(x,T))})),n()(this,"handleBlur",(()=>{this.setState(c(E,w))})),n()(this,"selectSuggestionAt",(e=>()=>{this.setState(j(e))})),n()(this,"applySelectedSuggestion",(()=>{null!==this.state.selectedIndex&&this.applySuggestionAt(this.state.selectedIndex)()})),n()(this,"applySuggestionAt",(e=>()=>{const{value:t,suggestions:s}=this.props,i=s[e];if(!i)return;const n=t.substr(0,i.start)+i.text+t.substr(i.end);this.setState(E),this.changeValue(n),this.focusInputElement()})),n()(this,"changeValue",(e=>{const{onChange:t}=this.props;t&&t(e)})),n()(this,"focusInputElement",(()=>{this.inputElement&&this.inputElement.focus()})),n()(this,"showSuggestions",(()=>{this.setState(x)})),n()(this,"submit",(()=>{const{isValid:e,onSubmit:t,value:s}=this.props;e&&t&&t(s),this.setState(E)})),n()(this,"updateSuggestions",(()=>{const e=this.inputElement&&this.inputElement.selectionStart||0;this.props.loadSuggestions(this.props.value,e,200)}))}render(){const{suggestions:e,isLoadingSuggestions:t,isValid:s,placeholder:i,value:n,disabled:o,"aria-label":u,compressed:c}=this.props,{areSuggestionsVisible:l,selectedIndex:d}=this.state;return a.a.createElement(r.EuiOutsideClickDetector,{onOutsideClick:this.handleBlur},a.a.createElement(C,null,a.a.createElement(r.EuiFieldSearch,{compressed:c,fullWidth:!0,disabled:o,inputRef:this.handleChangeInputRef,isLoading:t,isInvalid:!s,onChange:this.handleChange,onFocus:this.handleFocus,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onSearch:this.submit,placeholder:i,value:n,"aria-label":u,"data-test-subj":"infraSearchField"}),l&&!t&&e.length>0?a.a.createElement(k,{"data-test-subj":"infraSuggestionsPanel"},e.map(((e,t)=>a.a.createElement(g,{key:e.text,suggestion:e,isSelected:t===d,onMouseEnter:this.selectSuggestionAt(t),onClick:this.applySuggestionAt(t)})))):null))}componentDidMount(){this.inputElement&&this.props.autoFocus&&this.inputElement.focus()}componentDidUpdate(e){const t=e.value!==this.props.value,s=e.suggestions!==this.props.suggestions;t&&this.updateSuggestions(),t&&""===this.props.value&&this.submit(),s&&this.state.isFocused&&this.showSuggestions()}}const v=(e,t)=>({...e,selectedIndex:0===t.suggestions.length?null:null!==e.selectedIndex?(e.selectedIndex+t.suggestions.length-1)%t.suggestions.length:Math.max(t.suggestions.length-1,0)}),O=(e,t)=>({...e,selectedIndex:0===t.suggestions.length?null:null!==e.selectedIndex?(e.selectedIndex+1)%t.suggestions.length:0}),j=e=>(t,s)=>({...t,selectedIndex:0===s.suggestions.length?null:e>=0&&e<s.suggestions.length?e:0}),x=e=>({...e,areSuggestionsVisible:!0}),E=e=>({...e,areSuggestionsVisible:!1,selectedIndex:null}),T=e=>({...e,isFocused:!0}),w=e=>({...e,isFocused:!1}),C=u.euiStyled.div`
  position: relative;
`,k=Object(u.euiStyled)(r.EuiPanel).attrs((()=>({paddingSize:"none",hasShadow:!0})))`
  position: absolute;
  width: 100%;
  margin-top: 2px;
  overflow-x: hidden;
  overflow-y: scroll;
  z-index: ${e=>e.theme.eui.euiZLevel1};
  max-height: 322px;
`}}]);