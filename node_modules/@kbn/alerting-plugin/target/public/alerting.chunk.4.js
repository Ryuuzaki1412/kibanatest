/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.alerting_bundle_jsonpfunction=window.alerting_bundle_jsonpfunction||[]).push([[4],{39:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(15),i=n.n(a),s=n(32),c=n(6),o=n(31),l=n(35);const r=e=>{const t=e.rRule.dtstart,n=i()(t).add(e.duration),a=Object(c.has)(e,"rRule.interval"),r={title:e.title,startDate:t,endDate:n.toISOString(),timezone:[e.rRule.tzid],recurring:a,categoryIds:e.categoryIds||[],scopedQuery:e.scopedQuery};if(!a)return r;const b=e.rRule,d=u(b),j=b.freq,m=b.until?o.d.ON_DATE:b.count?o.d.AFTER_X:o.d.NEVER,p={frequency:d?"CUSTOM":j,interval:b.interval,ends:m};return d&&(p.customFrequency=j),b.until&&(p.until=b.until),b.count&&(p.count=b.count),j!==s.a.MONTHLY&&b.byweekday&&(p.byweekday=Object(l.a)(b.byweekday,i()(t))),j===s.a.MONTHLY&&(b.byweekday?p.bymonth="weekday":b.bymonthday&&(p.bymonth="day")),r.recurringSchedule=p,r},u=e=>{const t=e.freq;return!(!(e.interval&&e.interval>1)&&(!t||t!==s.a.DAILY||e.byweekday)&&!(t&&t===s.a.WEEKLY&&e.byweekday&&e.byweekday.length>1)&&(!t||t!==s.a.MONTHLY||!e.bymonthday))}},40:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n(11);var a=n(13),i=n(12);const s=({size:e})=>Object(i.jsx)(a.EuiFlexGroup,{"data-test-subj":"center-justified-spinner",justifyContent:"center"},Object(i.jsx)(a.EuiFlexItem,{grow:!1},Object(i.jsx)(a.EuiLoadingSpinner,{size:e||"xl"})))},63:function(e,t,n){"use strict";n.r(t),n.d(t,"MaintenanceWindowsPage",(function(){return U})),n.d(t,"default",(function(){return U}));var a=n(11),i=n.n(a),s=n(13),c=n(30),o=n(36),l=n(29),r=n(12);const u=Object(r.jsx)("h2",null,l.qb),b=Object(r.jsx)("p",null,l.ob),d=i.a.memo((({onClickCreate:e,showCreateButton:t=!0,docLinks:n})=>{const i=Object(a.useMemo)((()=>t?[Object(r.jsx)(s.EuiButton,{key:"create-action",fill:!0,onClick:e},l.nb),Object(r.jsx)(s.EuiButtonEmpty,{key:"documentation-button",target:"_blank",href:n.alerting.maintenanceWindows,iconType:"help"},l.pb)]:null),[t,e,n]);return Object(r.jsx)(s.EuiPageTemplate.EmptyPrompt,{"data-test-subj":"mw-empty-prompt",title:u,body:b,actions:i})}));d.displayName="EmptyPrompt";var j=n(33),m=n(32);let p;m.a.YEARLY,m.a.MONTHLY,m.a.WEEKLY,m.a.DAILY,function(e){e.asc="asc",e.desc="desc"}(p||(p={}));var O=n(31),x=n(15),g=n.n(x),E=n(6),h=n(1),v=n(44),y=n(38),w=n(39);const f=i.a.memo((({maintenanceWindowFindResponse:e})=>{const[t,n]=Object(a.useState)(!1),i=Object(a.useCallback)((()=>{n((e=>!e))}),[]),c=Object(a.useCallback)((()=>{n(!1)}),[]),{startDate:o,recurringSchedule:u,topEvents:b,presets:d}=Object(a.useMemo)((()=>{const t=Object(w.a)(e),n=g()(t.startDate),a=Object(E.findIndex)(e.events,(t=>t.gte===e.eventStartTime&&t.lte===e.eventEndTime));return{startDate:n,recurringSchedule:t.recurringSchedule,topEvents:e.events.slice(a+1,a+4),presets:Object(y.a)(n)}}),[e]);return Object(r.jsx)(s.EuiPopover,{button:Object(r.jsx)(s.EuiButtonIcon,{"data-test-subj":"upcoming-events-icon-button",color:"text",display:"base",iconType:"calendar",size:"s","aria-label":"Upcoming events",onClick:i}),isOpen:t,closePopover:c,anchorPosition:"downCenter"},Object(r.jsx)(s.EuiPopoverTitle,{"data-test-subj":"upcoming-events-popover-title"},l.T(Object(v.a)(o,u,d))),Object(r.jsx)(s.EuiFlexGroup,{direction:"column",responsive:!1,gutterSize:"none"},Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiText,{style:{fontWeight:700},color:"subdued",size:"s"},l.Pb),Object(r.jsx)(s.EuiSpacer,{size:"m"})),b.map(((e,t)=>Object(r.jsx)(s.EuiFlexItem,{"data-test-subj":"upcoming-events-popover-item",key:`startDate.${t}`,grow:!1},Object(r.jsx)(s.EuiFlexGroup,{responsive:!1,alignItems:"center",justifyContent:"flexStart",style:{width:"300px"}},Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiIcon,{color:"subdued",type:"calendar"})),Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiText,{color:"subdued",size:"s"},Object(s.formatDate)(e.gte,h.MAINTENANCE_WINDOW_DATE_FORMAT)))),t<b.length-1?Object(r.jsx)(s.EuiHorizontalRule,{style:{inlineSize:"unset",marginInline:"-16px"},margin:"s"}):null)))))}));f.displayName="UpcomingEventsPopover";const C=i.a.memo((({query:e,onChange:t})=>{const[n,c]=Object(a.useState)([]),[o,u]=Object(a.useState)(!1),b=Object(a.useCallback)((a=>()=>{const i=n.includes(a)?n.filter((e=>e!==a)):[...n,a];c(i);let s=e.removeSimpleFieldClauses("status").removeOrFieldClauses("status");i.length>0&&(s=i.reduce(((e,t)=>e.addOrFieldValue("status",t,!0,"eq")),s)),null==t||t(s)}),[e,t,n]),d=Object(a.useCallback)((()=>{u((e=>!e))}),[u]),j=Object(a.useCallback)((()=>{u(!1)}),[u]);return Object(r.jsx)(s.EuiFilterGroup,null,Object(r.jsx)(s.EuiPopover,{isOpen:o,closePopover:j,button:Object(r.jsx)(s.EuiFilterButton,{"data-test-subj":"status-filter-button",iconType:"arrowDown",hasActiveFilters:n.length>0,numActiveFilters:n.length,numFilters:n.length,onClick:d},l.Ib)},Object(r.jsx)(i.a.Fragment,null,O.j.map((e=>Object(r.jsx)(s.EuiFilterSelectItem,{key:e.value,"data-test-subj":`status-filter-${e.value}`,onClick:b(e.value),checked:n.includes(e.value)?"on":void 0},e.name))))))}));C.displayName="StatusFilter";var I=n(34),T=n.n(I);const k=i.a.memo((({id:e,status:t,onEdit:n,onCancel:c,onArchive:o,onCancelAndArchive:u})=>{const[b,d]=Object(a.useState)(!1),[j,m]=Object(a.useState)(!1),[p,O]=Object(a.useState)(),x=Object(a.useCallback)((()=>{d((e=>!e))}),[]),g=Object(a.useCallback)((()=>{d(!1)}),[]),E=Object(a.useCallback)((()=>m(!1)),[]),h=Object(a.useCallback)((e=>{O(e),m(!0)}),[]),v=Object(a.useMemo)((()=>{const t={cancel:{props:{title:l.j,onConfirm:()=>{E(),c(e)},cancelButtonText:l.h,confirmButtonText:l.j},subtitle:l.i},cancelAndArchive:{props:{title:l.g,onConfirm:()=>{E(),u(e)},cancelButtonText:l.h,confirmButtonText:l.g},subtitle:l.f},archive:{props:{title:l.d,onConfirm:()=>{E(),o(e,!0)},cancelButtonText:l.e,confirmButtonText:l.d},subtitle:l.c},unarchive:{props:{title:l.Ob,onConfirm:()=>{E(),o(e,!1)},cancelButtonText:l.e,confirmButtonText:l.Ob},subtitle:l.Nb}};let n;if(j&&p){const e=t[p];n=Object(r.jsx)(s.EuiConfirmModal,T()({},e.props,{style:{width:600},onCancel:E,defaultFocusedButton:"confirm",buttonColor:"danger"}),Object(r.jsx)("p",null,e.subtitle))}return n}),[e,p,j,E,o,c,u]),y=Object(a.useMemo)((()=>{const a={edit:Object(r.jsx)(s.EuiContextMenuItem,{"data-test-subj":"table-actions-edit",key:"edit",icon:"pencil",onClick:()=>{g(),n(e)}},l.Eb),cancel:Object(r.jsx)(s.EuiContextMenuItem,{"data-test-subj":"table-actions-cancel",key:"cancel",icon:"stopSlash",onClick:()=>{g(),h("cancel")}},l.Cb),cancelAndArchive:Object(r.jsx)(s.EuiContextMenuItem,{"data-test-subj":"table-actions-cancel-and-archive",key:"cancel-and-archive",icon:"trash",onClick:()=>{g(),h("cancelAndArchive")}},l.Db),archive:Object(r.jsx)(s.EuiContextMenuItem,{"data-test-subj":"table-actions-archive",key:"archive",icon:"trash",onClick:()=>{g(),h("archive")}},l.a),unarchive:Object(r.jsx)(s.EuiContextMenuItem,{"data-test-subj":"table-actions-unarchive",key:"unarchive",icon:"exit",onClick:()=>{g(),h("unarchive")}},l.Fb)};return{running:["edit","cancel","cancelAndArchive"],upcoming:["edit","archive"],finished:["edit","archive"],archived:["unarchive"]}[t].map((e=>a[e]))}),[e,t,n,g,h]),w=Object(a.useMemo)((()=>Object(r.jsx)(s.EuiButtonIcon,{"data-test-subj":"table-actions-icon-button",iconType:"boxesHorizontal",size:"s","aria-label":"Upcoming events",onClick:x})),[x]);return Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(s.EuiFlexGroup,{justifyContent:"flexEnd",alignItems:"center"},Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiPopover,{button:w,isOpen:b,closePopover:g,panelPaddingSize:"none",anchorPosition:"downCenter","data-test-subj":"table-actions-popover"},Object(r.jsx)(s.EuiContextMenuPanel,{items:y})))),v)}));k.displayName="TableActionsPopover";var A=n(0),F=n(14);const _=({r_rule:e,category_ids:t,...n})=>({...n,rRule:e,categoryIds:t});async function N({http:e,maintenanceWindowId:t}){const n=await e.post(`${h.INTERNAL_BASE_ALERTING_API_PATH}/rules/maintenance_window/${encodeURIComponent(t)}/_finish`);return _(n)}var M=n(46),S=n(47);const W=[{field:"title",name:l.wb,truncateText:!0},{field:"status",name:l.Ib,"data-test-subj":"maintenance-windows-column-status",render:e=>Object(r.jsx)(s.EuiBadge,{color:O.i[e].color},O.i[e].label),sortable:({status:e})=>O.k[e]},{field:"eventStartTime",name:l.Hb,dataType:"date",render:(e,t)=>Object(r.jsx)(s.EuiFlexGroup,{responsive:!1,alignItems:"center"},Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(s.formatDate)(e,h.MAINTENANCE_WINDOW_DATE_FORMAT)),t.events.length>1?Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(f,{maintenanceWindowFindResponse:t})):null),sortable:!0},{field:"eventEndTime",name:l.Gb,dataType:"date",render:e=>Object(s.formatDate)(e,h.MAINTENANCE_WINDOW_DATE_FORMAT)}],D={sort:{field:"status",direction:p.asc}},P=e=>({className:e.status,"data-test-subj":"list-item"}),L=i.a.memo((({loading:e,items:t,readOnly:n,refreshData:i})=>{const o={filters:[{type:"custom_component",component:C}],toolsRight:Object(r.jsx)(s.EuiButton,{"data-test-subj":"refresh-button",iconType:"refresh",onClick:i},l.zb)},{euiTheme:u}=Object(s.useEuiTheme)(),{navigateToEditMaintenanceWindows:b}=Object(j.b)(),d=Object(a.useCallback)((e=>b(e)),[b]),{mutate:m,isLoading:p}=function(){const{http:e,notifications:{toasts:t}}=Object(c.a)().services;return Object(F.useMutation)((t=>N({http:e,maintenanceWindowId:t})),{onSuccess:e=>{t.addSuccess(A.i18n.translate("xpack.alerting.maintenanceWindowsFinishedSuccess",{defaultMessage:"Cancelled running maintenance window '{title}'",values:{title:e.title}}))},onError:()=>{t.addDanger(A.i18n.translate("xpack.alerting.maintenanceWindowsFinishedFailure",{defaultMessage:"Failed to cancel maintenance window."}))}})}(),O=Object(a.useCallback)((e=>m(e,{onSuccess:()=>i()})),[m,i]),{mutate:x,isLoading:g}=Object(M.a)(),E=Object(a.useCallback)(((e,t)=>x({maintenanceWindowId:e,archive:t},{onSuccess:()=>i()})),[x,i]),{mutate:h,isLoading:v}=function(){const{http:e,notifications:{toasts:t}}=Object(c.a)().services;return Object(F.useMutation)((async t=>(await N({http:e,maintenanceWindowId:t}),Object(S.a)({http:e,maintenanceWindowId:t,archive:!0}))),{onSuccess:e=>{t.addSuccess(A.i18n.translate("xpack.alerting.maintenanceWindowsFinishedAndArchiveSuccess",{defaultMessage:"Cancelled and archived running maintenance window '{title}'",values:{title:e.title}}))},onError:()=>{t.addDanger(A.i18n.translate("xpack.alerting.maintenanceWindowsFinishedAndArchiveFailure",{defaultMessage:"Failed to cancel and archive maintenance window."}))}})}(),y=Object(a.useCallback)((e=>h(e,{onSuccess:()=>i()})),[h,i]),w=Object(a.useMemo)((()=>Object(r.css)(".euiTableRow{&.running{background-color:",u.colors.highlight,";}}","")),[u.colors.highlight]),f=Object(a.useMemo)((()=>[{name:"",render:({status:e,id:t})=>Object(r.jsx)(k,{id:t,status:e,onEdit:d,onCancel:O,onArchive:E,onCancelAndArchive:y})}]),[E,O,y,d]),I=Object(a.useMemo)((()=>n?W:W.concat(f)),[f,n]);return Object(r.jsx)(s.EuiInMemoryTable,{"data-test-subj":"maintenance-windows-table",css:w,itemId:"id",loading:e||p||g||v,tableCaption:"Maintenance Windows List",items:t,columns:I,pagination:!0,sorting:D,rowProps:P,search:o,hasActions:!0})}));L.displayName="MaintenanceWindowsList";const B=({expiration_date:e,r_rule:t,event_start_time:n,event_end_time:a,created_by:i,updated_by:s,created_at:c,updated_at:o,...l})=>({...l,expirationDate:e,rRule:t,eventStartTime:n,eventEndTime:a,createdBy:i,updatedBy:s,createdAt:c,updatedAt:o}),R=e=>{const{enabled:t=!0}=e||{},{http:n,notifications:{toasts:a}}=Object(c.a)().services,{isLoading:i,isFetching:s,data:o=[],refetch:l}=Object(F.useQuery)({queryKey:["findMaintenanceWindows"],queryFn:()=>async function({http:e}){const t=await e.get(`${h.INTERNAL_BASE_ALERTING_API_PATH}/rules/maintenance_window/_find`);return t.data.map((e=>B(e)))}({http:n}),onError:e=>{e&&a.addDanger(A.i18n.translate("xpack.alerting.maintenanceWindowsListFailure",{defaultMessage:"Unable to load maintenance windows."}))},refetchOnWindowFocus:!1,retry:!1,cacheTime:0,enabled:t});return{maintenanceWindows:o,isLoading:t&&(i||s),refetch:l}};var z=n(40),G=n(41),H=n(42);const Y=Object(r.jsx)("h2",{"data-test-subj":"license-prompt-title"},l.Rb),q=i.a.memo((()=>{const{application:e}=Object(c.a)().services;return Object(r.jsx)(s.EuiPageTemplate.EmptyPrompt,{"data-test-subj":"mw-license-prompt",title:Y,body:Object(r.jsx)(s.EuiFlexGroup,{direction:"column"},Object(r.jsx)(s.EuiFlexItem,null,Object(r.jsx)(s.EuiText,{color:"subdued"},Object(r.jsx)("p",null,l.Sb))),Object(r.jsx)(s.EuiFlexItem,null,Object(r.jsx)(s.EuiFlexGroup,{justifyContent:"center"},Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiButtonEmpty,{"data-test-subj":"license-prompt-upgrade",key:"upgrade-subscription-button",target:"_blank",href:"https://www.elastic.co/subscriptions"},l.Qb)),Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiButton,{fill:!0,"data-test-subj":"license-prompt-trial",key:"start-trial-button",target:"_blank",href:e.getUrlForApp("management",{path:"stack/license_management/home"})},l.Bb)))))})}));q.displayName="LicensePrompt";const U=i.a.memo((()=>{const{application:{capabilities:e},chrome:t,docLinks:n}=Object(c.a)().services,{isAtLeastPlatinum:u}=Object(H.a)(),b=u(),{navigateToCreateMaintenanceWindow:m}=Object(j.a)(),{isLoading:p,maintenanceWindows:O,refetch:x}=R({enabled:b});Object(o.a)(h.MAINTENANCE_WINDOW_DEEP_LINK_IDS.maintenanceWindows);const g=Object(a.useCallback)((()=>{m()}),[m]),E=Object(a.useCallback)((()=>x()),[x]),v=e[h.MAINTENANCE_WINDOW_FEATURE_ID].show,y=e[h.MAINTENANCE_WINDOW_FEATURE_ID].save,w=!p&&0===O.length&&v&&y,f=v&&!y,C=Object(a.useCallback)((()=>{f&&t.setBadge({text:l.xb,tooltip:l.yb,iconType:"glasses"})}),[t,f]);return Object(a.useEffect)((()=>(C(),()=>{t.setBadge()})),[C,t]),p?Object(r.jsx)(z.a,null):Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(s.EuiPageHeader,{bottomBorder:!0,alignItems:"top"},Object(r.jsx)(s.EuiPageHeaderSection,null,Object(r.jsx)(s.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:!1},Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(s.EuiTitle,{size:"l"},Object(r.jsx)("h1",null,l.tb))),Object(r.jsx)(s.EuiFlexItem,{grow:!1},Object(r.jsx)(G.a,null))),Object(r.jsx)(s.EuiSpacer,null),Object(r.jsx)(s.EuiText,{size:"m"},Object(r.jsx)("p",null,l.ub))),!w&&b&&y?Object(r.jsx)(s.EuiPageHeaderSection,null,Object(r.jsx)(s.EuiButton,{"data-test-subj":"mw-create-button",onClick:g,iconType:"plusInCircle",fill:!0},l.lb)):null),b?w?Object(r.jsx)(d,{onClickCreate:g,docLinks:n.links}):Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(s.EuiSpacer,{size:"xl"}),Object(r.jsx)(L,{readOnly:f,refreshData:E,loading:p,items:O})):Object(r.jsx)(q,null))}));U.displayName="MaintenanceWindowsPage"}}]);