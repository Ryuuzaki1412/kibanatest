(window.expressionPartitionVis_bundle_jsonpfunction=window.expressionPartitionVis_bundle_jsonpfunction||[]).push([[1],Array(30).concat([function(e,t,n){e.exports=n(25)(3)},function(e,t,n){e.exports=n(25)(70)},function(e,t,n){"use strict";e.exports=n(39)},function(e,t,n){"use strict";e.exports=n(46)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(29),o=n(11),i=a.__importDefault(n(35));t.default=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[]);var a=i.default(e,t),r=a[0],s=a[1],l=a[2];return o.useEffect(l,n),[r,s]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(11);t.default=function(e,t){void 0===t&&(t=0);var n=a.useRef(!1),o=a.useRef(),i=a.useRef(e),r=a.useCallback((function(){return n.current}),[]),s=a.useCallback((function(){n.current=!1,o.current&&clearTimeout(o.current),o.current=setTimeout((function(){n.current=!0,i.current()}),t)}),[t]),l=a.useCallback((function(){n.current=null,o.current&&clearTimeout(o.current)}),[]);return a.useEffect((function(){i.current=e}),[e]),a.useEffect((function(){return s(),l}),[t]),[r,l,s]}},function(e,t,n){"use strict";e.exports=n(37)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(38);n(27),n(32),n(33);var o=a.default({key:"css"}),i=o.flush,r=o.hydrate,s=o.cx,l=o.merge,c=o.getRegisteredStyles,u=o.injectGlobal,d=o.keyframes,m=o.css,p=o.sheet,v=o.cache;t.cache=v,t.css=m,t.cx=s,t.flush=i,t.getRegisteredStyles=c,t.hydrate=r,t.injectGlobal=u,t.keyframes=d,t.merge=l,t.sheet=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(27),o=n(32),i=n(33);function r(e){return e&&e.__esModule?e:{default:e}}var s=r(a);function l(e,t){if(void 0===e.inserted[t.name])return e.insert("",t,e.sheet,!0)}function c(e,t,n){var a=[],o=i.getRegisteredStyles(e,a,n);return a.length<2?n:o+t(a)}var u=function e(t){for(var n="",a=0;a<t.length;a++){var o=t[a];if(null!=o){var i=void 0;switch(typeof o){case"boolean":break;case"object":if(Array.isArray(o))i=e(o);else for(var r in i="",o)o[r]&&r&&(i&&(i+=" "),i+=r);break;default:i=o}i&&(n&&(n+=" "),n+=i)}}return n};t.default=function(e){var t=s.default(e);t.sheet.speedy=function(e){this.isSpeedy=e},t.compat=!0;var n=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var r=o.serializeStyles(n,t.registered,void 0);return i.insertStyles(t,r,!1),t.key+"-"+r.name};return{css:n,cx:function(){for(var e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return c(t.registered,n,u(a))},injectGlobal:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=o.serializeStyles(n,t.registered);l(t,i)},keyframes:function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];var i=o.serializeStyles(n,t.registered),r="animation-"+i.name;return l(t,{name:i.name,styles:"@keyframes "+r+"{"+i.styles+"}"}),r},hydrate:function(e){e.forEach((function(e){t.inserted[e]=!0}))},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:i.getRegisteredStyles.bind(null,t.registered),merge:c.bind(null,t.registered,n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(40),o=n(42),i=n(44);function r(e){return e&&e.__esModule?e:{default:e}}var s=r(a),l=r(o),c=/[A-Z]|^ms/g,u=/_EMO_([^_]+?)_([^]*?)_EMO_/g,d=function(e){return 45===e.charCodeAt(1)},m=function(e){return null!=e&&"boolean"!=typeof e},p=r(i).default((function(e){return d(e)?e:e.replace(c,"-$&").toLowerCase()})),v=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(u,(function(e,t,n){return h={name:t,styles:n,next:h},t}))}return 1===l.default[e]||d(e)||"number"!=typeof t||0===t?t:t+"px"};function g(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return h={name:n.name,styles:n.styles,next:h},n.name;if(void 0!==n.styles){var a=n.next;if(void 0!==a)for(;void 0!==a;)h={name:a.name,styles:a.styles,next:h},a=a.next;return n.styles+";"}return function(e,t,n){var a="";if(Array.isArray(n))for(var o=0;o<n.length;o++)a+=g(e,t,n[o])+";";else for(var i in n){var r=n[i];if("object"!=typeof r)null!=t&&void 0!==t[r]?a+=i+"{"+t[r]+"}":m(r)&&(a+=p(i)+":"+v(i,r)+";");else if(!Array.isArray(r)||"string"!=typeof r[0]||null!=t&&void 0!==t[r[0]]){var s=g(e,t,r);switch(i){case"animation":case"animationName":a+=p(i)+":"+s+";";break;default:a+=i+"{"+s+"}"}}else for(var l=0;l<r.length;l++)m(r[l])&&(a+=p(i)+":"+v(i,r[l])+";")}return a}(e,t,n);case"function":if(void 0!==e){var o=h,i=n(e);return h=o,g(e,t,i)}}if(null==t)return n;var r=t[n];return void 0!==r?r:n}var h,f=/label:\s*([^\s;\n{]+)\s*(;|$)/g;t.serializeStyles=function(e,t,n){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var a=!0,o="";h=void 0;var i=e[0];null==i||void 0===i.raw?(a=!1,o+=g(n,t,i)):o+=i[0];for(var r=1;r<e.length;r++)o+=g(n,t,e[r]),a&&(o+=i[r]);f.lastIndex=0;for(var l,c="";null!==(l=f.exec(o));)c+="-"+l[1];return{name:s.default(o)+c,styles:o,next:h}}},function(e,t,n){"use strict";e.exports=n(41)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t,n=0,a=0,o=e.length;o>=4;++a,o-=4)t=1540483477*(65535&(t=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(o){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}},function(e,t,n){"use strict";e.exports=n(43)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1}},function(e,t,n){"use strict";e.exports=n(45)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="undefined"!=typeof document,o=function(e,t,n){var o=e.key+"-"+t.name;(!1===n||!1===a&&void 0!==e.compat)&&void 0===e.registered[o]&&(e.registered[o]=t.styles)};t.getRegisteredStyles=function(e,t,n){var a="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):a+=n+" "})),a},t.insertStyles=function(e,t,n){o(e,t,n);var i=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var r="",s=t;do{var l=e.insert(t===s?"."+i:"",s,e.sheet,!0);a||void 0===l||(r+=l),s=s.next}while(void 0!==s);if(!a&&0!==r.length)return r}},t.registerStyles=o},,,function(e,t,n){"use strict";n.r(t);var a=n(30),o=n.n(a),i=n(11),r=n.n(i),s=n(5),l=n(0),c=n(21),u=n(23),d=n(3),m=n(4),p=n(9);function v(e){return null!=e}var g=n(1),h=n(2),f=n(31),b=n.n(f);function y(e){try{return b()(e)}catch{return b()("red")}}function x(e,t){const[n,a,o]=y(e).rgb();return`rgba(${n},${a},${o},${t})`}function j(e,t){const[n,a,o,i]=y(e).rgba(),[r,s,l,c]=y(t).rgba();if(1===i)return b.a.rgb(n,a,o).hex();const u=i+c*(1-i);return 0===u?"#00000000":`rgba(${Math.round((n*i+r*c*(1-i))/u)}, ${Math.round((a*i+s*c*(1-i))/u)}, ${Math.round((o*i+l*c*(1-i))/u)}, ${u})`}n(22);var O=n(8),C=n(24),M=n(26);const w=Object(M.createSlice)({name:"colorMapping",initialState:{assignmentMode:"auto",assignments:[],specialAssignments:[],paletteId:"eui",colorMode:{type:"categorical"}},reducers:{updateModel:(e,t)=>{e.assignmentMode=t.payload.assignmentMode,e.assignments=[...t.payload.assignments],e.specialAssignments=[...t.payload.specialAssignments],e.paletteId=t.payload.paletteId,e.colorMode={...t.payload.colorMode}},updatePalette:(e,t)=>{e.paletteId=t.payload.paletteId,e.assignments=[...t.payload.assignments],e.colorMode={...t.payload.colorMode}},assignStatically:(e,t)=>{e.assignmentMode="manual",e.assignments=[...t.payload]},assignAutomatically:e=>{e.assignmentMode="auto",e.assignments=[]},addNewAssignment:(e,t)=>{e.assignments.push({...t.payload})},updateAssignment:(e,t)=>{e.assignments[t.payload.assignmentIndex]={...t.payload.assignment,touched:!0}},updateAssignmentRule:(e,t)=>{e.assignments[t.payload.assignmentIndex]={...e.assignments[t.payload.assignmentIndex],rule:t.payload.rule}},updateAssignmentColor:(e,t)=>{e.assignments[t.payload.assignmentIndex]={...e.assignments[t.payload.assignmentIndex],color:t.payload.color,touched:!0}},updateSpecialAssignmentColor:(e,t)=>{e.specialAssignments[t.payload.assignmentIndex]={...e.specialAssignments[t.payload.assignmentIndex],color:t.payload.color,touched:!0}},removeAssignment:(e,t)=>{e.assignments.splice(t.payload,1)},changeColorMode:(e,t)=>{e.colorMode={...t.payload}},updateGradientColorStep:(e,t)=>{"gradient"===e.colorMode.type&&(e.colorMode={...e.colorMode,steps:e.colorMode.steps.map(((e,n)=>n===t.payload.index?{...t.payload.color,touched:!0}:{...e,touched:!1}))})},removeGradientColorStep:(e,t)=>{if("gradient"!==e.colorMode.type)return;const n=[...e.colorMode.steps];n.splice(t.payload,1);const a=2===e.colorMode.steps.length?"desc"===e.colorMode.sort?0===t.payload?"asc":"desc":0===t.payload?"desc":"asc":e.colorMode.sort;e.colorMode={...e.colorMode,steps:[...n],sort:a}},addGradientColorStep:(e,t)=>{"gradient"===e.colorMode.type&&(e.colorMode={...e.colorMode,steps:[...e.colorMode.steps.slice(0,t.payload.at),{...t.payload.color,touched:!1},...e.colorMode.steps.slice(t.payload.at)]})},changeGradientSortOrder:(e,t)=>{"gradient"===e.colorMode.type&&(e.colorMode={...e.colorMode,sort:t.payload})}}}),{updatePalette:S,assignStatically:A,assignAutomatically:I,addNewAssignment:P,updateAssignment:k,updateAssignmentColor:E,updateSpecialAssignmentColor:_,updateAssignmentRule:z,removeAssignment:T,changeColorMode:L,updateGradientColorStep:V,removeGradientColorStep:F,addGradientColorStep:R,changeGradientSortOrder:N,updateModel:D}=w.actions;w.reducer;var B=n(12);const G=["#f2f4fb","#d4d9e5","#98a2b3","#696f7d","#353642"],$=G.slice(),H=G.slice().reverse(),W={id:"neutral",name:"Neutral",colorCount:$.length,type:"categorical",getColor:(e,t)=>t?H[e]:$[e]};n(34);const U=Object(M.createSlice)({name:"colorMapping",initialState:{colorPicker:{index:0,visibile:!1,type:"assignment"}},reducers:{colorPickerVisibility:(e,t)=>{e.colorPicker.visibile=t.payload.visible,e.colorPicker.index=t.payload.index,e.colorPicker.type=t.payload.type},switchColorPickerVisibility:e=>{e.colorPicker.visibile=!e.colorPicker.visibile},showColorPickerVisibility:e=>{e.colorPicker.visibile=!0},hideColorPickerVisibility:e=>{e.colorPicker.visibile=!1}}}),{colorPickerVisibility:K,switchColorPickerVisibility:Y,showColorPickerVisibility:Z,hideColorPickerVisibility:q}=U.actions;U.reducer;const J=["#20377d","#7de2d1","#ff957d","#f04e98","#0077cc","#fec514"],Q={id:"elastic_brand_2023",name:"Elastic Brand",colorCount:J.length,type:"categorical",getColor:e=>J[e]},X=["#54b399","#6092c0","#d36086","#9170b8","#ca8eae","#d6bf57","#b9a888","#da8b45","#aa6556","#e7664c"],ee={id:"eui_amsterdam_color_blind",name:"Default",colorCount:X.length,type:"categorical",getColor:e=>X[e]},te=["#00a69b","#57c17b","#6f87d8","#663db8","#bc52bc","#9e3533","#daa05d"],ne={id:"kibana_v7_legacy",name:"Kibana Legacy",colorCount:te.length,type:"categorical",getColor:e=>te[e]},ae=new Map([[ee.id,ee],[Q.id,Q],[ne.id,ne],[W.id,W]]);const oe=10;function ie(e,t){switch(e.type){case"matchExactly":return Array.isArray(t)?e.values.some((e=>Array.isArray(e)&&e.length===t.length&&e.every(((e,n)=>e===t[n])))):e.values.includes(`${t}`);case"matchExactlyCI":return e.values.some((e=>e.toLowerCase()===`${t}`));case"range":return"number"==typeof t&&function(e,t){return e.min===e.max&&e.min===t||(e.minInclusive?t>=e.min:t>e.min)&&(e.maxInclusive?t<=e.max:t<e.max)}(e,t);default:return!1}}function re(e,t,n,a,o,i){switch(t.type){case"colorCode":case"categorical":return se(t,n,a);case"gradient":{if("categorical"===e.type)return"red";const t=function(e,t,n){const a=1===e.steps.length?[se(e.steps[0],t,n),j(x(se(e.steps[0],t,n),.3),n?"black":"white")]:e.steps.map((e=>se(e,t,n)));a.sort((()=>"asc"===e.sort?-1:1));const o=b.a.scale(a).mode("lab");return e=>o(e).hex()}(e,n,a);return 0===i?"red":t(1===i?0:o/(i-1))}}}function se(e,t,n){return"colorCode"===e.type?e.colorCode:y(t(e.paletteId).getColor(e.colorIndex,n)).hex()}new Map([["__other__",l.i18n.translate("coloring.colorMapping.terms.otherBucketLabel",{defaultMessage:"Other"})],["",l.i18n.translate("coloring.colorMapping.terms.emptyLabel",{defaultMessage:"(empty)"})]]);var le=n(6);const ce=e=>e.respectSourceOrder?([,e],[,t])=>{var n,a;const[o]=null!==(n=e.inputIndex)&&void 0!==n?n:[],[i]=null!==(a=t.inputIndex)&&void 0!==a?a:[];return void 0!==o&&void 0!==i?o-i:t.value-e.value}:void 0;var ue=n(28);const de=(e,t,n)=>{var a;if(null!=e&&null!==(a=e.meta)&&void 0!==a&&a.params){const n=null!=e&&e.id?t[null==e?void 0:e.id]:void 0;if(n)return n}if(null!=e&&e.format)return n(e.format)},me=(e,t,n)=>{var a;return null!==(a=de(e,t,n))&&void 0!==a?a:n()},pe=(e,t,n,a)=>{const o=de(t,n,a);var i;return o?null!==(i=o.convert(e))&&void 0!==i?i:"":String(e)},ve=e=>[le.a.MOSAIC,le.a.TREEMAP].includes(e);function ge(e){return Object(B.isMultiFieldKey)(e)?e.keys.map(String):`${e}`}const he=(e,t,n,a)=>e===le.a.MOSAIC?((e,t,n)=>(a,o,i)=>{if(2===t&&0===e)return"rgba(0,0,0,0)";const r=i[s.PATH_KEY],l=ge(2===t?r[3].value:r[2].value);return n(l)})(t,n,a):((e,t,n)=>(a,o,i)=>{const r=ge(i[s.PATH_KEY][2].value),l=n(r);return Object(u.lightenColor)(l,e+1,t)})(t,n,a),fe=l.i18n.translate("expressionPartitionVis.emptySlice",{defaultMessage:"(empty)"}),be=(e,t,n,a,o={},i,r,s,l,c,d)=>{var m;const v={valueFont:{fontWeight:700}};n.labels.values||(v.valueFormatter=()=>"");const g=Boolean(n.dimensions.splitColumn||n.dimensions.splitRow);let h;!c&&null!==(m=t[1])&&void 0!==m&&m.id&&r&&n.palette&&(h=((e,t,n,{params:a},o,i)=>{const r=new Map(e.map((e=>{var n;return[pe(e[null!==(n=t.id)&&void 0!==n?n:""],t,o,i.deserialize),void 0]})));let s=0;return{getColor:e=>{const t=String(e);if(!r.has(t))return;let o=r.get(t);return o||(o=n.getCategoricalColor([{name:t,totalSeriesAtDepth:r.size,rankAtDepth:s++}],{behindText:!1},a)||void 0,r.set(t,o),o)}}})(i,t[1],null==r?void 0:r.get(n.palette.name),n.palette,s,l));const f=((e,t,n,a)=>({[le.a.PIE]:()=>ce(t),[le.a.DONUT]:()=>ce(t),[le.a.WAFFLE]:()=>([,e],[,t])=>t.value-e.value,[le.a.TREEMAP]:()=>{},[le.a.MOSAIC]:()=>((e,t)=>{var n;const a=null!==(n=t[0])&&void 0!==n&&n.id?(o=e,i=t[0].id,[...new Set(o.rows.map((e=>e[i])))].reduce(((e,t,n)=>(e[t]=n,e)),{})):{};var o,i;return([e,n],[o,i])=>1===t.length||n.children.length&&e in a&&i.children.length&&o in a?a[e]-a[o]:i.value-n.value})(n,a)}[e]()))(e,n,a,t),b=Ee(i,t),y=function(e,t,n,a,o){var i,r,s;const{colorMapping:l,dimensions:c}=o;if(!l)return;if(!(e!==le.a.DONUT&&e!==le.a.PIE&&e!==le.a.TREEMAP||c.buckets&&0!==(null===(i=c.buckets)||void 0===i?void 0:i.length)))return;const u=e===le.a.MOSAIC&&2===t.length?Object(p.c)(n,null===(r=t[1])||void 0===r?void 0:r.id):Object(p.c)(n,null===(s=t[0])||void 0===s?void 0:s.id);return function(e,t,n,a){const o=t(e.paletteId),i="auto"===e.assignmentMode?function(e,t,n){const a="categorical"===n.type,o="categories"===e.type?e.categories.length:e.bins,i=a?Math.min(t.colorCount,o):Math.min(oe,o);return("categories"===e.type?e.categories.map((e=>({type:"matchExactly",values:[e]}))):Array.from({length:e.bins},((t,n)=>{const a=(e.max-e.min)/e.bins;return{type:"range",min:e.max-n*a-a,max:e.max-n*a,minInclusive:!0,maxInclusive:!1}}))).slice(0,i).map(((e,n)=>a?{rule:e,color:{type:"categorical",paletteId:t.id,colorIndex:n},touched:!1}:{rule:e,color:{type:"gradient"},touched:!1}))}(a,o,e.colorMode):e.assignments,r="categories"===a.type?i.filter((e=>"auto"===e.rule.type||"matchExactly"===e.rule.type&&0===e.rule.values.length)):[],s="categories"===a.type?a.categories.filter((e=>!i.some((({rule:t})=>ie(t,e))))):[];return a=>{if("string"==typeof a||Array.isArray(a)){const o=s.indexOf(a);if(o>-1){if(o<r.length){const a=i.findIndex((e=>e===r[o]));return re(e.colorMode,r[o].color,t,n,a,i.length)}return se(e.specialAssignments[0].color,t,n)}const l=i.findIndex((({rule:e})=>ie(e,a)));if(l>-1){const a=i[l];return re(e.colorMode,a.color,t,n,l,i.length)}return se(e.specialAssignments[0].color,t,n)}{const o=i.findIndex((({rule:e})=>ie(e,a)));if(o>-1){const a=i[o];return re(e.colorMode,a.color,t,n,o,i.length)}return se(e.specialAssignments[0].color,t,n)}}}(JSON.parse(l),function(e,t){return n=>{var a;return null!==(a=e.get(n))&&void 0!==a?a:t}}(ae,W),a,{type:"categories",categories:u})}(e,t,i,d,n);return t.map(((a,m)=>{var p,x;return{groupByRollup:e=>{var t;return a.id?null!==(t=e[a.id])&&void 0!==t?t:fe:a.name},showAccessor:e=>!0,nodeLabel:e=>pe(e,a,s,l.deserialize),fillLabel:0===m&&e===le.a.MOSAIC?{...v,minFontSize:14,maxFontSize:14,clipText:!0}:v,sortPredicate:null!==(p=a.meta)&&void 0!==p&&null!==(x=p.sourceParams)&&void 0!==x&&x.consolidatedMetricsColumn?([,e],[,t])=>{var n,a;const[o]=null!==(n=e.inputIndex)&&void 0!==n?n:[],[i]=null!==(a=t.inputIndex)&&void 0!==a?a:[];return void 0!==o&&void 0!==i?o-i:t.value-e.value}:f,shape:{fillColor:y?he(e,m,t.length,y):(p,v,f)=>((e,t,n,a,o,i={},r,{columnsLength:s,rowsLength:l},c,d,m,p,v,g,h,f)=>{var b,y,x;const j=v?"rgba(0,0,0,0)":"rgba(255,255,255,0)",O=h.format&&null!==(b=g.deserialize(h.format).convert(t))&&void 0!==b?b:"";if(c.distinctColors)return((e,t,n={},a,o,i,{parentSeries:r,allSeries:s},l)=>{var c,u;if(n.hasOwnProperty(e))return n[e];if(n.hasOwnProperty(l))return n[l];const d=s.findIndex((t=>Object(ue.isEqual)(t,e))),m=t&&r.includes(e);return null==o?void 0:o.get(a.palette.name).getCategoricalColor([{name:e,rankAtDepth:m?r.findIndex((t=>t===e)):d>-1?d:0,totalSeriesAtDepth:m?r.length:s.length||1}],{maxDepth:1,totalSeries:s.length||1,behindText:a.labels.show,syncColors:i},null!==(c=null===(u=a.palette)||void 0===u?void 0:u.params)&&void 0!==c?c:{colors:[]})})(t,o,i,c,d,p,r,O)||j;const C=((e,t,n,a,o,i)=>{const r=[];let s=e;for(;s.parent&&s.depth>0;){const e=s.parent.children[s.sortIndex][0],l=String(e),c=n&&t.includes(l),u=pe(e,i,a,o.deserialize);r.unshift({name:null!=u?u:l,rankAtDepth:c?t.findIndex((e=>e===l)):s.sortIndex,totalSeriesAtDepth:c?t.length:s.parent.children.length}),s=s.parent}return r})(n,r.parentSeries,o,f,g,h),M=((e,t,n)=>{let a;return t.hasOwnProperty(n)&&(a=t[n]),e.forEach((e=>{Object.keys(t).includes(e.name)&&(a=t[e.name])})),a})(C,i,O);if(M)return Object(u.lightenColor)(M,C.length,s);if(e===le.a.MOSAIC&&m&&C[1])return m.getColor(C[1].name)||j;if(ve(e)){if(a<s-1)return j;C.length>1&&(e===le.a.MOSAIC?C.shift():C.pop())}return(null==d?void 0:d.get(c.palette.name).getCategoricalColor(C,{behindText:c.labels.show||ve(e),maxDepth:s,totalSeries:l,syncColors:p},null!==(y=null===(x=c.palette)||void 0===x?void 0:x.params)&&void 0!==y?y:{colors:[]}))||j})(e,p,f,m,g,o,b,{columnsLength:t.length,rowsLength:i.length},n,r,h,c,d,l,a,s)}}}))};function ye(e){switch(e){case s.Position.Bottom:return"upCenter";case s.Position.Top:return"downCenter";case s.Position.Left:return"rightCenter";default:return"leftCenter"}}function xe(e,t,n){const a=t.find((t=>Object.keys(t).find((n=>t[n]===e)))),o=a&&Object.keys(a).find((t=>a[t]===e));return n.findIndex((e=>e.id===o))+1}const je=Object(i.createContext)(void 0),Oe=({anchor:e,color:t,onClose:n,onChange:a,seriesIdentifiers:[o]})=>{var r;const s=o.key,l=Object(i.useContext)(je),d=Object(i.useCallback)((()=>{null==n||n()}),[n]);if(!l)return null;const{legendPosition:m,setColor:p,bucketColumns:v,palette:g,data:h,uiState:f,distinctColors:y}=l,x=null!==(r=null==f?void 0:f.get("vis.colors",{}))&&void 0!==r?r:{},j=Object.keys(x).includes(s.toString());let C=!1;if(!y){const e=function(e,t,n){return t.find((t=>e.id&&t[e.id]===n))}(v[0],h,s)||!v[0].id;if(!e)return null}const M=b()(t).hex();return Object(O.jsx)(c.EuiOutsideClickDetector,{onOutsideClick:d},Object(O.jsx)(c.EuiWrappingPopover,{isOpen:!0,ownFocus:!0,display:"block",button:e,anchorPosition:ye(m),closePopover:n,panelPaddingSize:"s"},Object(O.jsx)(u.ColorPicker,{color:"kibana_palette"===g?M:M.toLowerCase(),onChange:e=>{e&&a(e),p(e,s),e&&C||n()},label:s,maxDepth:v.length,layerIndex:xe(s,h,v),useLegacyColors:"kibana_palette"===g,colorIsOverwritten:j,onKeyDown:e=>{13===e.keyCode&&(null==n||n()),C=!0}})))};let Ce;!function(e){e.HOVER_DOWN="hover-down",e.HOVER_RIGHT="hover-right",e.INLINE="inline"}(Ce||(Ce={}));const Me=async(e,t)=>{if(!e)return!1;const n=await t.createFiltersFromValueClickAction(e.data);return Boolean(n.length)};function we(e){return null!=e}const Se=1e3,Ae=(e,t,n=1)=>{const a=Boolean(e.dimensions.splitColumn||e.dimensions.splitRow),o=(e.labels.position===le.b.INSIDE||a)&&e.labels.show,i=t&&!a?{outerSizeRatio:n*Math.min(Se/Math.min(null==t?void 0:t.width,null==t?void 0:t.height),1)}:{outerSizeRatio:void 0},r={};var s;return r.partition={...null!=i?i:{}},e.labels.show&&e.labels.position===le.b.DEFAULT&&e.labels.last_level&&(r.partition.linkLabel={maxCount:Number.POSITIVE_INFINITY,maximumSection:Number.POSITIVE_INFINITY,maxTextLength:null!==(s=e.labels.truncate)&&void 0!==s?s:void 0}),!o&&e.labels.show||(r.partition.linkLabel={maxCount:0,...e.labels.show?{}:{maximumSection:Number.POSITIVE_INFINITY}}),o||!t||a||(r.partition.outerSizeRatio=n),r},Ie=e=>e.labels.show?{}:{partition:{fillLabel:{textColor:"rgba(0,0,0,0)"}}},Pe=(e,t)=>Object(m.getColumnByAccessor)(e,t.columns),ke=(e,t,n,a)=>{const o=Object(m.getColumnByAccessor)(t,e),i=o.id,r=me(o,n,a);return e=>{const t=e[i];if(void 0!==t)return r.convert(t)}},Ee=(e,t)=>{const n=t[0].id,a=new Set,o=new Set;return t.forEach((({id:t})=>{t&&e.forEach((e=>{o.add(e[t]),t===n&&a.add(e[n])}))})),{allSeries:[...o],parentSeries:[...a]}},_e=e=>Boolean(e),ze=e=>e.length>1,Te=(e,t,n=[])=>t===le.c.SHOW||t===le.c.DEFAULT&&((e,t)=>({[le.a.PIE]:()=>ze(t),[le.a.DONUT]:()=>ze(t),[le.a.TREEMAP]:()=>!1,[le.a.MOSAIC]:()=>!1,[le.a.WAFFLE]:()=>!0}[e]()))(e,n);var Le=n(36);const Ve={subdued:Object(Le.css)("fill:",C.euiThemeVars.euiTextSubduedColor,";",""),accent:Object(Le.css)("fill:",C.euiThemeVars.euiColorVis0,";","")},Fe=({title:e,titleId:t,...n})=>Object(O.jsx)("svg",o()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(O.jsx)("title",{id:t},e):null,Object(O.jsx)("path",{d:"M17.827 21.189a10.001 10.001 0 005.952-7.148c.124-.578-.343-1.091-.935-1.091H14a1 1 0 01-1-1V3.106c0-.592-.513-1.059-1.092-.935a10 10 0 105.919 19.018z",className:Ve.subdued}),Object(O.jsx)("path",{d:"M22.462 3.538A12.29 12.29 0 0016.094.16C15.512.048 15 .514 15 1.106V10a1 1 0 001 1h8.895c.591 0 1.057-.512.945-1.094a12.288 12.288 0 00-3.378-6.368z",className:Ve.accent})),Re=({title:e,titleId:t,...n})=>Object(O.jsx)("svg",o()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(O.jsx)("title",{id:t},e):null,Object(O.jsx)("path",{d:"M19.21 21.119a11 11 0 006.595-8.1c.11-.577-.355-1.082-.942-1.082H20.75c-.477 0-.878.342-1.046.788a5.028 5.028 0 11-6.474-6.474c.447-.168.788-.569.788-1.046V1.094c0-.588-.505-1.053-1.082-.943a11 11 0 106.272 20.968h.002z",className:Ve.subdued}),Object(O.jsx)("path",{d:"M22.778 3.176A11 11 0 0017.084.154C16.507.042 16 .507 16 1.095v4.116c0 .475.34.875.784 1.044l.14.055A5.026 5.026 0 0119.7 9.17c.168.445.568.784 1.044.784h4.115c.588 0 1.053-.506.942-1.084a11 11 0 00-3.023-5.694z",className:Ve.accent})),Ne=({title:e,titleId:t,...n})=>Object(O.jsx)("svg",o()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(O.jsx)("title",{id:t},e):null,Object(O.jsx)("path",{d:"M0 1a1 1 0 011-1h13a1 1 0 011 1v20a1 1 0 01-1 1H1a1 1 0 01-1-1V1z",className:Ve.subdued}),Object(O.jsx)("path",{d:"M17 1a1 1 0 011-1h11a1 1 0 011 1v12a1 1 0 01-1 1H18a1 1 0 01-1-1V1z",className:Ve.accent}),Object(O.jsx)("path",{d:"M29 16H18a1 1 0 00-1 1v4a1 1 0 001 1h11a1 1 0 001-1v-4a1 1 0 00-1-1z",className:Ve.subdued})),De=({title:e,titleId:t,...n})=>Object(O.jsx)("svg",o()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(O.jsx)("title",{id:t}):null,Object(O.jsx)("path",{className:Ve.subdued,d:"M2 0a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1H2zM2 14a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1H2zM11 13a1 1 0 011-1h6a1 1 0 011 1v8a1 1 0 01-1 1h-6a1 1 0 01-1-1v-8zM12 0a1 1 0 100 2h6a1 1 0 100-2h-6zM21 15a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1h-6a1 1 0 01-1-1v-6zM22 0a1 1 0 00-1 1v4a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1h-6z"}),Object(O.jsx)("path",{className:Ve.accent,d:"M11 5a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1h-6a1 1 0 01-1-1V5zM1 7a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1H2a1 1 0 01-1-1V7zM22 8a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V9a1 1 0 00-1-1h-6z"})),Be=({title:e,titleId:t,...n})=>Object(O.jsx)("svg",o()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},n),e?Object(O.jsx)("title",{id:t}):null,Object(O.jsx)("path",{className:Ve.accent,d:"M16 1a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V1zM4 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM17 6a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V7a1 1 0 00-1-1h-2zM23 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM5 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1H5zM4 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V7zM11 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM10 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7zM11 12a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM22 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7z"}),Object(O.jsx)("path",{className:Ve.subdued,d:"M22 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM4 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM16 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM11 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM23 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM16 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2z"})),Ge="__pie_chart_split__",$e="__pie_chart_sm__",He=({splitColumnAccessor:e,splitRowAccessor:t})=>e||t?Object(O.jsx)(r.a.Fragment,null,Object(O.jsx)(s.GroupBy,{id:Ge,by:(n,a)=>{const o=e||t;return o?"function"==typeof o?o(a):a[o]:n.id},sort:s.Predicate.DataIndex}),Object(O.jsx)(s.SmallMultiples,{id:$e,splitVertically:t?Ge:void 0,splitHorizontally:e?Ge:void 0,style:{verticalPanelPadding:{outer:.1,inner:.1},horizontalPanelPadding:{outer:.1,inner:.1}}})):null;var We=n(13);const Ue=({hasNegativeValues:e=!1,chartType:t,renderComplete:n})=>{if(e){const e=Object(O.jsx)(We.FormattedMessage,{id:"expressionPartitionVis.negativeValuesFound",defaultMessage:"{chartType} chart can't render with negative values.",values:{chartType:`${t[0].toUpperCase()}${t.slice(1)}`}});return Object(O.jsx)(u.EmptyPlaceholder,{dataTestSubj:"partitionVisNegativeValues",icon:"warning",iconColor:"warning",message:e,renderComplete:n})}return Object(O.jsx)(u.EmptyPlaceholder,{dataTestSubj:"partitionVisEmptyValues",icon:(a=t,{[le.a.PIE]:Fe,[le.a.DONUT]:Re,[le.a.TREEMAP]:Ne,[le.a.MOSAIC]:De,[le.a.WAFFLE]:Be}[a]),renderComplete:n});var a},Ke={name:"199pkds",styles:"display:flex;flex:1 1 auto;min-height:0;min-width:0;width:100%;height:100%"},Ye={name:"abj0un",styles:"min-height:0;min-width:0;margin-left:auto;margin-right:auto;width:100%;height:100%"},Ze=e=>{var t,n,a,r,f,b;const{columnCellValueActions:y,visData:x,visParams:j,visType:C,services:M,syncColors:w,interactive:S,overrides:A,hasOpenedOnAggBasedEditor:I}=e,P=Object(i.useMemo)((()=>((e,t)=>{if([le.a.PIE,le.a.DONUT].includes(e))return t;const{last_level:n,truncate:a,...o}=t.labels;return{...t,labels:o}})(C,j)),[j,C]),k=e.chartsThemeService.useChartsTheme(),E=e.chartsThemeService.useChartsBaseTheme(),{table:_,metricAccessor:z,bucketAccessors:T}=Object(i.useMemo)((()=>((e,t=[],n,a)=>{if(n.length<2)return{table:e,metricAccessor:n[0],bucketAccessors:t};const o=null==t?void 0:t.map((t=>Object(m.getColumnByAccessor)(t,e.columns))).filter(v),i=null==n?void 0:n.map((t=>Object(m.getColumnByAccessor)(t,e.columns))).filter(v),r=[],s="metric-name",l="value";e.rows.forEach((e=>{i.forEach((t=>{const n={};o.forEach((({id:t})=>{n[t]=e[t]})),n[s]=a[t.id],n[l]=e[t.id],r.push(n)}))}));const c=[...o,{id:s,name:s,meta:{type:"string",sourceParams:{consolidatedMetricsColumn:!0}}},{id:l,name:l,meta:{type:"number"}}];return{metricAccessor:l,bucketAccessors:[...o.map((({id:e})=>e)),s],table:{type:"datatable",columns:c,rows:r}}})(x,P.dimensions.buckets,P.dimensions.metrics,P.metricsToLabels)),[x,P.dimensions.buckets,P.dimensions.metrics,P.metricsToLabels]),{bucketColumns:L,metricColumn:V}=Object(i.useMemo)((()=>((e,t)=>{const{metric:n,buckets:a}=e;if(a.length>0){const e=a.map((e=>({...Object(m.getColumnByAccessor)(e,t.columns),format:Object(m.getFormatByAccessor)(e,t.columns)}))),o=e[e.length-1].id,i=t.columns.findIndex((e=>e.id===o));return{bucketColumns:e,metricColumn:Pe(null!=n?n:{accessor:i+1,type:"vis_dimension",format:{}},t)}}const o=Pe(null!=n?n:{accessor:0,type:"vis_dimension",format:{}},t);return{metricColumn:o,bucketColumns:[{name:o.name}]}})({metric:z,buckets:T},_)),[T,z,_]),F=Object(i.useMemo)((()=>((e,t)=>e.columns.reduce(((e,n)=>{var a;return{...e,[n.id]:null!=n&&null!==(a=n.meta)&&void 0!==a&&a.params?t(n.meta.params):void 0}}),{}))(_,M.fieldFormats.deserialize)),[M.fieldFormats.deserialize,_]),R=Object(i.useCallback)((()=>{var t,n;const a=Te(C,P.legendDisplay,L);return null!==(t=null===(n=e.uiState)||void 0===n?void 0:n.get("vis.legendOpen",a))&&void 0!==t?t:a}),[L,e.uiState,P.legendDisplay,C]),[N,D]=Object(i.useState)((()=>R())),B=void 0!==e.uiState,[G,$]=Object(i.useState)(!1),[H,W]=Object(i.useState)(),U=Object(i.useRef)(null);Object(i.useEffect)((()=>{if(U&&U.current&&G){const e=U.current.getBoundingClientRect().height,t=U.current.getBoundingClientRect().width;W({width:t,height:e})}}),[G,U]),Object(i.useEffect)((()=>{const e=R();D(e)}),[R]);const K=Object(i.useCallback)(((t=!0)=>{t&&(e.renderComplete(),$(!0))}),[e]),Y=Object(i.useCallback)(((t,n,a,o,i)=>{const r=((e,t,n,a,o,i,r,s)=>{const l=[],c=a.rows.findIndex((n=>e.every(((e,a)=>{const o=t[a].id;if(!o&&!r)return;const i=!o||n[o]===e.groupByRollup;if(!r)return i;const l=(null==s?void 0:s.convert(n[r.id]))||n[r.id];return i&&l===e.smAccessorValue})))),u=Math.floor(c/i);var d;(l.push(...e.map(((e,n)=>{var r,s;const l=a.columns.findIndex((e=>e.id===t[n].id));if(-1!==l)return{column:null!==(r=a.columns[l].meta)&&void 0!==r&&null!==(s=r.sourceParams)&&void 0!==s&&s.consolidatedMetricsColumn?l+c%i:l,row:u,value:e.groupByRollup,table:o}})).filter(Boolean)),r)&&(t[0].id||l.push({column:a.columns.findIndex((e=>e.id===n)),row:c,table:a,value:null===(d=a.columns.find((e=>e.id===n)))||void 0===d?void 0:d.name}),l.push({column:a.columns.findIndex((e=>e.id===r.id)),row:c,table:a,value:e[0].smAccessorValue}));return l})(t,n,V.id,a,x,P.dimensions.metrics.length,o,i);e.fireEvent({name:"filter",data:{data:r}})}),[V.id,x,e,P.dimensions.metrics.length]),Z=Object(i.useCallback)((e=>t=>{const n=((e,t)=>e.columns.reduce(((n,{id:a},o)=>{const i=t.key,r=e.rows.findIndex((e=>e[a]===i));return r>-1&&n.push({table:e,column:o,row:r,value:i}),n}),[]))(e,t);return{name:"filter",data:{negate:!1,data:n}}}),[]),q=Object(i.useCallback)(((t,n=!1)=>{e.fireEvent({...t,data:{...t.data,negate:n}})}),[e]),J=Object(i.useCallback)((()=>{D((t=>{var n;const a=!t;return null===(n=e.uiState)||void 0===n||n.set("vis.legendOpen",a),a}))}),[e.uiState]),Q=Object(i.useCallback)(((t,n)=>{var a,o,i,r;const s=(null===(a=e.uiState)||void 0===a?void 0:a.get("vis.colors"))||{};s[n]!==t&&t?s[n]=t:delete s[n],null===(o=e.uiState)||void 0===o||o.setSilent("vis.colors",null),null===(i=e.uiState)||void 0===i||i.set("vis.colors",s),null===(r=e.uiState)||void 0===r||r.emit("reload")}),[e.uiState]),X=Object(i.useCallback)(((e,t)=>{const n=e[t.id];return Number.isFinite(n)&&n>=0?n:0}),[]),ee=M.fieldFormats.deserialize,te=me(V,F,ee),{splitColumn:ne,splitRow:ae}=P.dimensions,oe=ne?me("string"==typeof ne[0]?Object(m.getColumnByAccessor)(ne[0],_.columns):ne[0],F,ee):ae?me("string"==typeof ae[0]?Object(m.getColumnByAccessor)(ae[0],_.columns):ae[0],F,ee):void 0,ie=M.fieldFormats.deserialize({id:"percent",params:{pattern:`0,0.[${"0".repeat(null!==(t=P.labels.percentDecimals)&&void 0!==t?t:g.a)}]%`}}),re=e.chartsThemeService.useDarkMode(),se=Object(i.useMemo)((()=>{var t;return be(C,L,P,_,{...null===(t=e.uiState)||void 0===t?void 0:t.get("vis.colors",{}),...e.visParams.labels.colorOverrides},_.rows,e.palettesRegistry,F,M.fieldFormats,w,re)}),[C,L,P,_,e.uiState,e.visParams.labels.colorOverrides,e.palettesRegistry,F,M.fieldFormats,w,re]),ce=Object(i.useMemo)((()=>S?((e,t,n,a,o,r,u,d)=>({series:[p]})=>{var v;const[g,h]=Object(i.useState)(!1),[f,b]=Object(i.useState)(!0),y=Object(i.useMemo)((()=>t(p)),[p]),x=Object(i.useMemo)((()=>((e,t)=>t.columns.findIndex((({id:n})=>!!t.rows.find((t=>t[n]===e)))))(p.key,r)),[p]),[j,C]=Object(s.useLegendAction)();if(Object(i.useEffect)((()=>{(async()=>{b(await e(y,u))})()}),[y]),-1===x)return null;const M=((e,t,n,a,o)=>{let i="";if(e.dimensions.buckets){const l=(r=e.dimensions.buckets,s=n,(null==r?void 0:r.find((e=>"string"!=typeof e&&e.accessor===s)))||(null==r?void 0:r[s]));i=l?a(Object(m.getFormatByAccessor)(l,t.columns)).convert(o):""}var r,s;return i||o})(o,r,x,d.deserialize,p.key),w=null!==(v=a[x])&&void 0!==v?v:[],S=[];!(e=>e.some((({type:e})=>"cellAction-filter"===e)))(w)&&f&&y&&S.push({name:l.i18n.translate("expressionPartitionVis.legend.filterForValueButtonAriaLabel",{defaultMessage:"Filter for"}),"data-test-subj":`legend-${M}-filterIn`,icon:Object(O.jsx)(c.EuiIcon,{type:"plusInCircle",size:"m"}),onClick:()=>{h(!1),n(y)}},{name:l.i18n.translate("expressionPartitionVis.legend.filterOutValueButtonAriaLabel",{defaultMessage:"Filter out"}),"data-test-subj":`legend-${M}-filterOut`,icon:Object(O.jsx)(c.EuiIcon,{type:"minusInCircle",size:"m"}),onClick:()=>{h(!1),n(y,!0)}});const A=r.columns[x].meta;if(w.forEach((e=>{S.push({name:e.displayName,"data-test-subj":`legend-${M}-${e.id}`,icon:Object(O.jsx)(c.EuiIcon,{type:e.iconType,size:"m"}),onClick:()=>{e.execute([{columnMeta:A,value:p.key}]),h(!1)}})})),0===S.length)return null;const I=[{id:"main",title:M,items:S}],P=Object(O.jsx)("div",{tabIndex:0,ref:j,role:"button","aria-pressed":"false",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",marginLeft:4,marginRight:4},"data-test-subj":`legend-${M}`,onKeyPress:()=>h(!g),onClick:()=>h(!g),"aria-label":l.i18n.translate("expressionPartitionVis.legend.legendActionsAria",{defaultMessage:"Legend actions"})},Object(O.jsx)(c.EuiIcon,{size:"s",type:"boxesVertical"}));return Object(O.jsx)(c.EuiPopover,{button:P,isOpen:g,closePopover:()=>{h(!1),C()},panelPaddingSize:"none",anchorPosition:"upLeft",title:l.i18n.translate("expressionPartitionVis.legend.filterOptionsLegend",{defaultMessage:"{legendDataLabel}, filter options",values:{legendDataLabel:M}})},Object(O.jsx)(c.EuiContextMenu,{initialPanelId:"main",panels:I}))})(Me,Z(_),q,y,P,_,M.data.actions,M.fieldFormats):void 0),[y,Z,q,S,M.data.actions,M.fieldFormats,_,P]),ue=Object(i.useMemo)((()=>{var e;const t=_.rows.reduce(((e,t)=>e+t[V.id]),0),n=null!==(e=_.rows.map((e=>e[V.id]/t)).filter((e=>e<.02)))&&void 0!==e?e:[];return n.length?1/(1+Math.min(.05*n.length,.2)):1}),[_.rows,V]),{theme:de={},...pe}=Object(p.d)(A,"settings"),ve=Object(i.useMemo)((()=>((e,t,n,a,o=1,i)=>{var r,s,l,c,u,d,m;const p=Boolean(t.dimensions.splitColumn||t.dimensions.splitRow),v=a&&!p&&i?{chartPaddings:{top:(1-Math.min(1,Se/(null==a?void 0:a.height)))/2*(null==a?void 0:a.height),bottom:(1-Math.min(1,Se/(null==a?void 0:a.height)))/2*(null==a?void 0:a.height),left:(1-Math.min(1,Se/(null==a?void 0:a.width)))/2*(null==a?void 0:a.height),right:(1-Math.min(1,Se/(null==a?void 0:a.width)))/2*(null==a?void 0:a.height)}}:null,g={fontFamily:null===(r=n.barSeriesStyle)||void 0===r||null===(s=r.displayValue)||void 0===s?void 0:s.fontFamily,outerSizeRatio:1,minFontSize:10,maxFontSize:16,emptySizeRatio:0,sectorLineStroke:null===(l=n.lineSeriesStyle)||void 0===l||null===(c=l.point)||void 0===c?void 0:c.fill,sectorLineWidth:1.5,circlePadding:4,linkLabel:{maxCount:5,fontSize:11,textColor:null===(u=n.axes)||void 0===u||null===(d=u.axisTitle)||void 0===d?void 0:d.fill,maxTextLength:null!==(m=t.labels.truncate)&&void 0!==m?m:void 0}},{partition:h={},...f}=((e,t,n,a)=>({[le.a.PIE]:()=>Ae(t,n,a),[le.a.DONUT]:()=>((e,...t)=>{const{partition:n,...a}=Ae(e,...t);return{...a,partition:{...n,emptySizeRatio:e.emptySizeRatio}}})(t,n,a),[le.a.TREEMAP]:()=>Ie(t),[le.a.MOSAIC]:()=>Ie(t),[le.a.WAFFLE]:()=>Ae(t,n,a)}[e]()))(e,t,a,o);return{partition:{...g,...h},chartMargins:{top:0,bottom:0,left:0,right:0},...null!=v?v:{},...f}})(C,P,k,H,ue,I)),[C,P,k,H,ue,I]),ge=document.getElementById("app-fixed-viewport"),he=null!==(n=P.legendPosition)&&void 0!==n?n:s.Position.Right,fe=ne?ke(_.columns,ne[0],F,ee):void 0,ye=ae?ke(_.columns,ae[0],F,ee):void 0,xe=ne?Object(m.getColumnByAccessor)(ne[0],_.columns):ae?Object(m.getColumnByAccessor)(ae[0],_.columns):void 0,Ce=S&&T.filter((e=>"metric-name"!==e)).length>0,Ee={...ge?{boundary:ge}:{},type:P.addTooltip?s.TooltipType.Follow:s.TooltipType.None,actions:Ce?[{disabled:e=>e.length<1,label:e=>0===e.length?l.i18n.translate("expressionPartitionVis.tooltipActions.emptyFilterSelection",{defaultMessage:"Select at least one series to filter"}):l.i18n.translate("expressionPartitionVis.tooltipActions.filterValues",{defaultMessage:"Filter {seriesNumber} series",values:{seriesNumber:e.length}}),onSelect:t=>{const n=((e,t,n)=>{const a=n.rows.findIndex((n=>e.every((({valueAccessor:e,seriesIdentifier:a})=>{if("number"!=typeof e||e<1)return;const o=t[e-1].id;return o?n[o]===a.key:void 0}))));return e.map((({valueAccessor:e})=>{if("number"!=typeof e||e<1)return;const o=t[e-1].id;if(!o)return;const i=n.columns.findIndex((e=>e.id===o));return-1!==i?{column:i,row:a}:void 0})).filter(we)})(t,L,_);e.fireEvent({name:"multiFilter",data:{data:[{table:_,cells:n}]}})}}]:void 0},ze=Object(i.useMemo)((()=>_.rows.every((e=>0===e[V.id]))),[_.rows,V]),Le=0===_.rows.length,Ve=_.rows.every((e=>!e[V.id])),Fe=Object(i.useMemo)((()=>_.rows.some((e=>{const t=e[V.id];return"number"==typeof t&&t<0}))),[_.rows,V]),Re=!P.nestedLegend||((e,t)=>({[le.a.PIE]:()=>_e(t),[le.a.DONUT]:()=>_e(t),[le.a.TREEMAP]:()=>_e(t),[le.a.MOSAIC]:()=>_e(t),[le.a.WAFFLE]:()=>!0}[e]()))(C,xe),Ne=!(Le||Ve||ze||Fe),{euiTheme:De}=Object(c.useEuiTheme)(),Be=B?(Ge=De,Object(O.css)(Ye," inset:0;position:absolute;padding:",Ge.size.s,";","")):Ye;var Ge;const We=(Ze=C,{[le.a.PIE]:s.PartitionLayout.sunburst,[le.a.DONUT]:s.PartitionLayout.sunburst,[le.a.TREEMAP]:s.PartitionLayout.treemap,[le.a.MOSAIC]:s.PartitionLayout.mosaic,[le.a.WAFFLE]:s.PartitionLayout.waffle}[Ze]);var Ze;const qe=Object(i.useMemo)((()=>{if(!N||!Re)return;const[e]=L;if(!e.id)return;const t={};return _.rows.forEach(((n,a)=>{const o=n[e.id];o in t||(t[o]=a)})),(e,n)=>null==e.key?1:null==n.key?-1:t[e.key]-t[n.key]}),[L,Re,N,_.rows]);return Object(O.jsx)("div",{css:Be,"data-test-subj":"partitionVisChart"},Ne?Object(O.jsx)("div",{css:Ke,ref:U},Object(O.jsx)(je.Provider,{value:{legendPosition:he,setColor:Q,bucketColumns:L,palette:P.palette.name,data:_.rows,uiState:e.uiState,distinctColors:null!==(a=P.distinctColors)&&void 0!==a&&a}},B&&Object(O.jsx)(u.LegendToggle,{onClick:J,showLegend:N,legendPosition:he}),Object(O.jsx)(s.Chart,o()({size:"100%"},Object(p.d)(A,"chart")),Object(O.jsx)(He,{splitColumnAccessor:fe,splitRowAccessor:ye}),Object(O.jsx)(s.Tooltip,Ee),Object(O.jsx)(s.Settings,o()({noResults:Object(O.jsx)(Ue,{chartType:C,renderComplete:K}),debugState:null!==(r=window._echDebugStateFlag)&&void 0!==r&&r,showLegend:null!=N?N:Te(C,P.legendDisplay,L),legendPosition:he,legendSize:d.LegendSizeToPixels[null!==(f=P.legendSize)&&void 0!==f?f:d.DEFAULT_LEGEND_SIZE],legendMaxDepth:P.nestedLegend?void 0:1,legendColorPicker:e.uiState?Oe:void 0,flatLegend:Re,legendSort:qe,showLegendExtra:P.showValuesInLegend,onElementClick:([e])=>{const[t]=e;Y(t,L,_,xe,oe)},legendAction:ce,theme:[{background:{color:"transparent"}},ve,k,{legend:{labelOptions:{maxLines:P.truncateLegend?null!==(b=P.maxLegendLines)&&void 0!==b?b:1:0}}},...Array.isArray(de)?de:[de]],baseTheme:E,onRenderChange:K,ariaLabel:e.visParams.ariaLabel,ariaUseDefaultSummary:!e.visParams.ariaLabel,locale:l.i18n.getLocale()},pe)),Object(O.jsx)(s.Partition,o()({id:C,smallMultiples:$e,data:_.rows,layout:We,specialFirstInnermostSector:P.startFromSecondLargestSlice,valueAccessor:e=>X(e,V),percentFormatter:e=>ie.convert(e/100),valueGetter:P.labels.show&&P.labels.valuesFormat!==h.d.VALUE&&P.labels.values?h.d.PERCENT:void 0,valueFormatter:e=>P.labels.show&&P.labels.values?te.convert(e):"",layers:se,topGroove:P.labels.show?void 0:0},Object(p.d)(A,"partition")))))):Object(O.jsx)(Ue,{hasNegativeValues:Fe,chartType:C,renderComplete:K}))};t.default=Object(i.memo)(Ze)}])]);