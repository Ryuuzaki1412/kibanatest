(window.unifiedHistogram_bundle_jsonpfunction=window.unifiedHistogram_bundle_jsonpfunction||[]).push([[1],Array(30).concat([function(e,t,i){"use strict";let n,s;i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return s})),function(e){e.Single="single",e.Static="static",e.Resizable="resizable"}(n||(n={})),function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(s||(s={}))},function(e,t,i){"use strict";e.exports=i(37)},function(e,t,i){"use strict";e.exports=i(44)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2);t.default=function(e){n.useEffect(e,[])}},function(e,t,i){"use strict";e.exports=i(35)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(36);i(16),i(31),i(32);var s=n.default({key:"css"}),a=s.flush,r=s.hydrate,o=s.cx,l=s.merge,u=s.getRegisteredStyles,c=s.injectGlobal,d=s.keyframes,g=s.css,m=s.sheet,b=s.cache;t.cache=b,t.css=g,t.cx=o,t.flush=a,t.getRegisteredStyles=u,t.hydrate=r,t.injectGlobal=c,t.keyframes=d,t.merge=l,t.sheet=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(16),s=i(31),a=i(32);function r(e){return e&&e.__esModule?e:{default:e}}var o=r(n);function l(e,t){if(void 0===e.inserted[t.name])return e.insert("",t,e.sheet,!0)}function u(e,t,i){var n=[],s=a.getRegisteredStyles(e,n,i);return n.length<2?i:s+t(n)}var c=function e(t){for(var i="",n=0;n<t.length;n++){var s=t[n];if(null!=s){var a=void 0;switch(typeof s){case"boolean":break;case"object":if(Array.isArray(s))a=e(s);else for(var r in a="",s)s[r]&&r&&(a&&(a+=" "),a+=r);break;default:a=s}a&&(i&&(i+=" "),i+=a)}}return i};t.default=function(e){var t=o.default(e);t.sheet.speedy=function(e){this.isSpeedy=e},t.compat=!0;var i=function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=s.serializeStyles(i,t.registered,void 0);return a.insertStyles(t,r,!1),t.key+"-"+r.name};return{css:i,cx:function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return u(t.registered,i,c(n))},injectGlobal:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var a=s.serializeStyles(i,t.registered);l(t,a)},keyframes:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var a=s.serializeStyles(i,t.registered),r="animation-"+a.name;return l(t,{name:a.name,styles:"@keyframes "+r+"{"+a.styles+"}"}),r},hydrate:function(e){e.forEach((function(e){t.inserted[e]=!0}))},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:a.getRegisteredStyles.bind(null,t.registered),merge:u.bind(null,t.registered,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(38),s=i(40),a=i(42);function r(e){return e&&e.__esModule?e:{default:e}}var o=r(n),l=r(s),u=/[A-Z]|^ms/g,c=/_EMO_([^_]+?)_([^]*?)_EMO_/g,d=function(e){return 45===e.charCodeAt(1)},g=function(e){return null!=e&&"boolean"!=typeof e},m=r(a).default((function(e){return d(e)?e:e.replace(u,"-$&").toLowerCase()})),b=function(e,t){switch(e){case"animation":case"animationName":if("string"==typeof t)return t.replace(c,(function(e,t,i){return p={name:t,styles:i,next:p},t}))}return 1===l.default[e]||d(e)||"number"!=typeof t||0===t?t:t+"px"};function f(e,t,i){if(null==i)return"";if(void 0!==i.__emotion_styles)return i;switch(typeof i){case"boolean":return"";case"object":if(1===i.anim)return p={name:i.name,styles:i.styles,next:p},i.name;if(void 0!==i.styles){var n=i.next;if(void 0!==n)for(;void 0!==n;)p={name:n.name,styles:n.styles,next:p},n=n.next;return i.styles+";"}return function(e,t,i){var n="";if(Array.isArray(i))for(var s=0;s<i.length;s++)n+=f(e,t,i[s])+";";else for(var a in i){var r=i[a];if("object"!=typeof r)null!=t&&void 0!==t[r]?n+=a+"{"+t[r]+"}":g(r)&&(n+=m(a)+":"+b(a,r)+";");else if(!Array.isArray(r)||"string"!=typeof r[0]||null!=t&&void 0!==t[r[0]]){var o=f(e,t,r);switch(a){case"animation":case"animationName":n+=m(a)+":"+o+";";break;default:n+=a+"{"+o+"}"}}else for(var l=0;l<r.length;l++)g(r[l])&&(n+=m(a)+":"+b(a,r[l])+";")}return n}(e,t,i);case"function":if(void 0!==e){var s=p,a=i(e);return p=s,f(e,t,a)}}if(null==t)return i;var r=t[i];return void 0!==r?r:i}var p,h=/label:\s*([^\s;\n{]+)\s*(;|$)/g;t.serializeStyles=function(e,t,i){if(1===e.length&&"object"==typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var n=!0,s="";p=void 0;var a=e[0];null==a||void 0===a.raw?(n=!1,s+=f(i,t,a)):s+=a[0];for(var r=1;r<e.length;r++)s+=f(i,t,e[r]),n&&(s+=a[r]);h.lastIndex=0;for(var l,u="";null!==(l=h.exec(s));)u+="-"+l[1];return{name:o.default(s)+u,styles:s,next:p}}},function(e,t,i){"use strict";e.exports=i(39)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t,i=0,n=0,s=e.length;s>=4;++n,s-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),i=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&i)+(59797*(i>>>16)<<16);switch(s){case 3:i^=(255&e.charCodeAt(n+2))<<16;case 2:i^=(255&e.charCodeAt(n+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(n)))+(59797*(i>>>16)<<16)}return(((i=1540483477*(65535&(i^=i>>>13))+(59797*(i>>>16)<<16))^i>>>15)>>>0).toString(36)}},function(e,t,i){"use strict";e.exports=i(41)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1}},function(e,t,i){"use strict";e.exports=i(43)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=Object.create(null);return function(i){return void 0===t[i]&&(t[i]=e(i)),t[i]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="undefined"!=typeof document,s=function(e,t,i){var s=e.key+"-"+t.name;(!1===i||!1===n&&void 0!==e.compat)&&void 0===e.registered[s]&&(e.registered[s]=t.styles)};t.getRegisteredStyles=function(e,t,i){var n="";return i.split(" ").forEach((function(i){void 0!==e[i]?t.push(e[i]+";"):n+=i+" "})),n},t.insertStyles=function(e,t,i){s(e,t,i);var a=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var r="",o=t;do{var l=e.insert(t===o?"."+a:"",o,e.sheet,!0);n||void 0===l||(r+=l),o=o.next}while(void 0!==o);if(!n&&0!==r.length)return r}},t.registerStyles=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(29).__importDefault(i(33));t.default=function(e){n.default((function(){e()}))}},,function(e,t,i){"use strict";i.r(t),i.d(t,"UnifiedHistogramContainer",(function(){return _e}));var n,s=i(5),a=i.n(s),r=i(2),o=i.n(r),l=i(14),u=i(13),c=i(45),d=i.n(c),g=i(3),m=i(20),b=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},n(e,t)},function(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),f="html",p="svg",h=function(e,t){var i,n,s,a={};if(e===f)s=document.createElement("div");else{if(e!==p)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');s=document.createElementNS("http://www.w3.org/2000/svg","g")}if(t&&"object"==typeof t)for(var r=0,o=Object.entries(t.attributes);r<o.length;r++){var l=o[r],u=l[0],c=l[1];s.setAttribute(u,c)}var d={element:s,elementType:e,setPortalProps:function(e){a=e},getInitialPortalProps:function(){return a},mount:function(t,s){if(s!==n){if(d.unmount(),t!==i&&!function(e,t){if(t===f)return e instanceof HTMLElement;if(t===p)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(t,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+t.tagName+">.");t.replaceChild(d.element,s),i=t,n=s}},unmount:function(e){e&&e!==n||i&&n&&(i.replaceChild(n,d.element),i=void 0,n=void 0)}};return d},v=function(e){function t(t){var i=e.call(this,t)||this;return i.addPropsChannel=function(){Object.assign(i.props.node,{setPortalProps:function(e){i.setState({nodeProps:e})}})},i.state={nodeProps:i.props.node.getInitialPortalProps()},i}return b(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,i=t.children,n=t.node;return m.createPortal(r.Children.map(i,(function(t){return r.isValidElement(t)?r.cloneElement(t,e.state.nodeProps):t})),n.element)},t}(r.PureComponent),j=function(e){function t(t){var i=e.call(this,t)||this;return i.placeholderNode=r.createRef(),i.passPropsThroughPortal(),i}return b(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,i=t.parentNode;e.mount(i,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,i=t.parentNode;e.mount(i,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return r.createElement("div",{ref:this.placeholderNode})},t}(r.PureComponent),O=h.bind(null,f),y=(h.bind(null,p),i(34)),C=i(7),x=i(30);const w=Object(C.a)(Object(r.lazy)((()=>i.e(2).then(i.bind(null,48)))));var S=i(12),T=i(17),H=i(21),R=i(0),E={name:"d3v9zr",styles:"overflow:hidden"},I={name:"y6n6nb",styles:"flex-grow:0"};function k({hits:e,append:t}){var i;if(!e.total&&"loading"===e.status)return null;const n=Object(R.jsx)("strong",{"data-test-subj":"partial"===e.status?"unifiedHistogramQueryHitsPartial":"unifiedHistogramQueryHits"},Object(R.jsx)(H.FormattedNumber,{value:null!==(i=e.total)&&void 0!==i?i:0})),s=I,a=E;return Object(R.jsx)(g.EuiFlexGroup,{gutterSize:"s",responsive:!1,justifyContent:"center",alignItems:"center",css:s},Object(R.jsx)(g.EuiFlexItem,{grow:!1,"aria-live":"polite",css:a},Object(R.jsx)(g.EuiText,{className:"eui-textTruncate"},"partial"===e.status&&Object(R.jsx)(H.FormattedMessage,{id:"unifiedHistogram.partialHits",defaultMessage:"â‰¥{formattedHits} {hits, plural, one {hit} other {hits}}",values:{hits:e.total,formattedHits:n}}),"partial"!==e.status&&Object(R.jsx)(H.FormattedMessage,{id:"unifiedHistogram.hitsPluralTitle",defaultMessage:"{formattedHits} {hits, plural, one {hit} other {hits}}",values:{hits:e.total,formattedHits:n}}))),"partial"===e.status&&Object(R.jsx)(g.EuiFlexItem,{grow:!1},Object(R.jsx)(g.EuiLoadingSpinner,{size:"m","aria-label":S.i18n.translate("unifiedHistogram.hitCountSpinnerAriaLabel",{defaultMessage:"Final hit count still loading"})})),t)}var F=i(22),P=i(6),A=i(15);const q=({data:e,dataView:t,timeInterval:i,timeRange:n,response:s})=>{var a;if(!i||!s)return{};const r=function({dataView:e,timeInterval:t,timeRange:i,data:n}){const s=[{type:"count",schema:"metric"},{type:"date_histogram",schema:"segment",params:{field:e.timeFieldName,interval:t,timeRange:i}}];return n.search.aggs.createAggConfigs(e,s)}({dataView:t,timeInterval:i,timeRange:n,data:e}),o=r.aggs[1];return Object(A.tabifyAggResponse)(r,s),A.search.aggs.isDateHistogramBucketAggConfig(o)?null==o||null===(a=o.buckets)||void 0===a?void 0:a.getInterval():void 0};var M=i(23),V=i.n(M),z={name:"y6n6nb",styles:"flex-grow:0"};const B=({uiSettings:e,bucketInterval:t,timeRange:{from:i,to:n},timeInterval:s,isPlainRecord:a,timeField:o})=>{const l=Object(r.useMemo)((()=>e.get("dateFormat")),[e]),u=Object(r.useCallback)((e=>e?l?e.format(l):String(e):""),[l]),c=Object(r.useMemo)((()=>{var e;if(!o&&a)return"";const r={from:V.a.parse(i),to:V.a.parse(n,{roundUp:!0})},l=Boolean(a)?"":S.i18n.translate("unifiedHistogram.histogramTimeRangeIntervalDescription",{defaultMessage:"(interval: {value})",values:{value:`${"auto"===s?`${S.i18n.translate("unifiedHistogram.histogramTimeRangeIntervalAuto",{defaultMessage:"Auto"})} - `:""}${null!==(e=null==t?void 0:t.description)&&void 0!==e?e:S.i18n.translate("unifiedHistogram.histogramTimeRangeIntervalLoading",{defaultMessage:"Loading"})}`}});return`${u(r.from)} - ${u(r.to)} ${l}`}),[null==t?void 0:t.description,i,a,o,s,n,u]),{euiTheme:d}=Object(g.useEuiTheme)(),m=Object(R.css)("padding:0 ",d.size.s," 0 ",d.size.s,";","");let b=c?Object(R.jsx)(g.EuiText,{size:"xs",textAlign:"center",css:m},c):null;if(null!=t&&t.scaled){const e=S.i18n.translate("unifiedHistogram.timeIntervalWithValueWarning",{defaultMessage:"Warning"}),i=S.i18n.translate("unifiedHistogram.bucketIntervalTooltip",{defaultMessage:"This interval creates {bucketsDescription} to show in the selected time range, so it has been scaled to {bucketIntervalDescription}.",values:{bucketsDescription:t.scale&&t.scale>1?S.i18n.translate("unifiedHistogram.bucketIntervalTooltip.tooLargeBucketsText",{defaultMessage:"buckets that are too large"}):S.i18n.translate("unifiedHistogram.bucketIntervalTooltip.tooManyBucketsText",{defaultMessage:"too many buckets"}),bucketIntervalDescription:t.description}}),n=z;b=Object(R.jsx)(g.EuiFlexGroup,{alignItems:"baseline",justifyContent:"center",gutterSize:"none",responsive:!1,css:n},Object(R.jsx)(g.EuiFlexItem,{grow:!1},b),Object(R.jsx)(g.EuiFlexItem,{grow:!1},Object(R.jsx)(g.EuiIconTip,{type:"warning",color:"warning",title:e,content:i})))}return{timeRangeText:c,timeRangeDisplay:b}},_=e=>{const t=Object(r.useRef)(e);return Object(r.useEffect)((()=>{t.current=e}),[e]),Object(r.useRef)(((...e)=>{var i;return null===(i=t.current)||void 0===i?void 0:i.call(t,...e)})).current};var L=i(24);const $=({request:e,getTimeRange:t,refetch$:i,attributesContext:n,onLoad:s})=>{const a=Object(r.useCallback)((()=>{const{attributes:i,requestData:a}=n;return{requestData:JSON.stringify(a),lensProps:N({searchSessionId:null==e?void 0:e.searchSessionId,getTimeRange:t,attributes:i,onLoad:s})}}),[n,t,s,null==e?void 0:e.searchSessionId]),[o,l]=Object(r.useState)(a()),u=_((()=>l(a())));return Object(r.useEffect)((()=>{const e=i.subscribe(u);return()=>e.unsubscribe()}),[i,u]),o},N=({searchSessionId:e,getTimeRange:t,attributes:i,onLoad:n})=>({id:"unifiedHistogramLensComponent",viewMode:L.ViewMode.VIEW,timeRange:t(),attributes:i,noPadding:!0,searchSessionId:e,executionContext:{description:"fetch chart data and total hits"},onLoad:n}),D=(e,t,i)=>{var n,s,a,r,o,l;if(i&&e)return null===(n=Object.values(null!=t?t:{}))||void 0===n||null===(s=n[0])||void 0===s||null===(a=s.rows)||void 0===a?void 0:a.length;if(i&&!e){var u,c;let e=0;return null===(u=Object.values(null!=t?t:{}))||void 0===u||null===(c=u[0])||void 0===c||c.rows.forEach((t=>{e+=t.rows})),e}return null==t||null===(r=t.unifiedHistogram)||void 0===r||null===(o=r.meta)||void 0===o||null===(l=o.statistics)||void 0===l?void 0:l.totalCount};function W({services:{data:e,lens:t,uiSettings:i},dataView:n,request:s,hits:l,chart:{timeInterval:u},isPlainRecord:c,hasLensSuggestions:d,getTimeRange:m,refetch$:b,lensAttributesContext:f,disableTriggers:p,disabledActions:h,onTotalHitsChange:v,onChartLoad:j,onFilter:O,onBrushEnd:y,withDefaultActions:C}){const[x,w]=Object(r.useState)(),[S,T]=Object(r.useState)("100%"),{timeRangeText:H,timeRangeDisplay:E}=B({uiSettings:i,bucketInterval:x,timeRange:m(),timeInterval:u,isPlainRecord:c,timeField:n.timeFieldName}),I=Object(r.useRef)(null),{height:k,width:A}=Object(g.useResizeObserver)(I.current),{attributes:M}=f;Object(r.useEffect)((()=>{"lnsMetric"===M.visualizationType?T(`${k<A?k:A}px`):T("100%")}),[M,k,A]);const V=_(((t,i,s)=>{var a,r,o;const g=null==i||null===(a=i.requests)||void 0===a?void 0:a.getRequests()[0],b=(null==g?void 0:g.status)===F.RequestStatus.ERROR,f=null==g||null===(r=g.response)||void 0===r?void 0:r.json,p=null==f?void 0:f.rawResponse;if(b)return null==v||v(P.a.error,void 0),void(null==j||j({adapters:null!=i?i:{}}));const h=null==i||null===(o=i.tables)||void 0===o?void 0:o.tables,O=D(d,h,c);if(null==v||v(t?P.a.loading:P.a.complete,null!=O?O:null==l?void 0:l.total),p){const t=q({data:e,dataView:n,timeInterval:u,timeRange:m(),response:p});w(t)}null==j||j({adapters:null!=i?i:{},embeddableOutput$:s})})),{lensProps:z,requestData:L}=$({request:s,getTimeRange:m,refetch$:b,attributesContext:f,onLoad:V}),{euiTheme:N}=Object(g.useEuiTheme)(),W=Object(R.css)("position:relative;flex-grow:1;margin-block:",N.size.xs,";&>div{height:100%;position:absolute;width:100%;}& .lnsExpressionRenderer{width:",S,";margin:auto;}& .echLegend .echLegendList{padding-right:",N.size.s,";}&>.euiLoadingChart{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);}","");return Object(R.jsx)(o.a.Fragment,null,Object(R.jsx)("div",{"data-test-subj":"unifiedHistogramChart","data-time-range":H,"data-request-data":L,css:W,ref:I},Object(R.jsx)(t.EmbeddableComponent,a()({},z,{disableTriggers:p,disabledActions:h,onFilter:O,onBrushEnd:y,withDefaultActions:C}))),E)}const G={maxWidth:550,avCharWidth:7,paddingsWidth:116},U=(e,t)=>e.reduce(((e,i)=>{const n=t.find((e=>i[e]));if(!n)return e;const s=i[n].length;return e>s?e:s}),0),Q=e=>e.reduce(((e,t)=>e>t.length?e:t.length),0);const X=new Set(["string","boolean","number","ip"]),Z=e=>X.has(e.type)&&e.aggregatable&&!e.scripted&&"counter"!==e.timeSeriesMetric,J={truncation:"middle"},K={asPlainText:!0},Y=({dataView:e,breakdown:t,onBreakdownFieldChange:i})=>{var n;const s=e.fields.filter(Z).map((e=>({label:e.displayName,value:e.name}))).sort(((e,t)=>e.label.toLowerCase().localeCompare(t.label.toLowerCase()))),a=t.field?[{label:t.field.displayName,value:t.field.name}]:[],o=Object(r.useCallback)((t=>{const n=t.length?e.fields.find((e=>e.name===t[0].value)):void 0;null==i||i(n)}),[e.fields,i]),[l,u]=Object(r.useState)(!1),c=Object(r.useCallback)((()=>u(!0)),[]),d=Object(r.useCallback)((()=>setTimeout((()=>u(!1)))),[]),{euiTheme:m}=Object(g.useEuiTheme)(),b=Object(R.css)("width:100%;max-width:",22*m.base,"px;",""),f=(p=s,function(e,t){const{maxWidth:i,avCharWidth:n,paddingsWidth:s,minWidth:a}={...G,...t},r=s+e*n;return a&&r<a?a:Math.min(r,i)}((h=["label"])?U(p,h):Q(p),v));var p,h,v;return Object(R.jsx)(g.EuiToolTip,{position:"top",content:l||null===(n=t.field)||void 0===n?void 0:n.displayName,anchorProps:{css:b}},Object(R.jsx)(g.EuiComboBox,{"data-test-subj":"unifiedHistogramBreakdownFieldSelector",prepend:S.i18n.translate("unifiedHistogram.breakdownFieldSelectorLabel",{defaultMessage:"Break down by"}),placeholder:S.i18n.translate("unifiedHistogram.breakdownFieldSelectorPlaceholder",{defaultMessage:"Select field"}),"aria-label":S.i18n.translate("unifiedHistogram.breakdownFieldSelectorAriaLabel",{defaultMessage:"Break down by"}),inputPopoverProps:{panelMinWidth:f,anchorPosition:"downRight"},singleSelection:K,options:s,selectedOptions:a,onChange:o,truncationProps:J,compressed:!0,fullWidth:!0,onFocus:c,onBlur:d}))},ee=({suggestions:e,activeSuggestion:t,onSuggestionChange:i})=>{var n;const s=e.map((e=>({label:e.title,value:e.title}))),a=t?[{label:t.title,value:t.title}]:[],o=Object(r.useCallback)((n=>{const s=n.length?e.find((e=>e.title===n[0].value)):t;null==i||i(s)}),[t,i,e]),[l,u]=Object(r.useState)(!1),c=Object(r.useCallback)((()=>u(!0)),[]),d=Object(r.useCallback)((()=>setTimeout((()=>u(!1)))),[]),{euiTheme:m}=Object(g.useEuiTheme)(),b=Object(R.css)("width:100%;max-width:",15*m.base,"px;","");return Object(R.jsx)(g.EuiToolTip,{position:"top",content:l||null==t?void 0:t.title,anchorProps:{css:b}},Object(R.jsx)(g.EuiComboBox,{"data-test-subj":"unifiedHistogramSuggestionSelector",prepend:Object(R.jsx)(g.EuiIcon,{type:null!==(n=null==t?void 0:t.previewIcon)&&void 0!==n?n:"empty"}),placeholder:S.i18n.translate("unifiedHistogram.suggestionSelectorPlaceholder",{defaultMessage:"Select visualization"}),singleSelection:{asPlainText:!0},options:s,selectedOptions:a,onChange:o,fullWidth:!0,isClearable:!1,compressed:!0,onFocus:c,onBlur:d,renderOption:t=>{var i;const n=e.find((e=>e.title===t.label));return Object(R.jsx)(g.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(R.jsx)(g.EuiFlexItem,{grow:null},Object(R.jsx)(g.EuiIcon,{type:null!==(i=null==n?void 0:n.previewIcon)&&void 0!==i?i:"empty"})),Object(R.jsx)(g.EuiFlexItem,null,t.label))}}))};var te=i(18),ie=i(25),ne=i(33),se=i.n(ne);const ae=({services:e,dataView:t,request:i,hits:n,chartVisible:s,filters:a,query:o,getTimeRange:l,refetch$:u,onTotalHitsChange:c,isPlainRecord:d})=>{const g=Object(r.useRef)(),m=_((()=>{re({services:e,abortController:g,dataView:t,request:i,hits:n,chartVisible:s,filters:a,query:o,timeRange:l(),onTotalHitsChange:c,isPlainRecord:d})}));se()(m),Object(r.useEffect)((()=>{const e=u.subscribe(m);return()=>e.unsubscribe()}),[m,u])},re=async({services:e,abortController:t,dataView:i,request:n,hits:s,chartVisible:a,filters:r,query:o,timeRange:l,onTotalHitsChange:u,isPlainRecord:c})=>{var d;if(null===(d=t.current)||void 0===d||d.abort(),t.current=void 0,a||!s)return;null==u||u(P.a.loading,s.total);const g=new AbortController;t.current=g;const m=c?await le({services:e,abortController:g,dataView:i,request:n,query:o,timeRange:l}):await oe({services:e,abortController:g,dataView:i,request:n,filters:r,query:o,timeRange:l});m&&(null==u||u(m.resultStatus,m.result))},oe=async({services:{data:e},abortController:t,dataView:i,request:n,filters:s,query:a,timeRange:r})=>{const o=e.search.searchSource.createEmpty();o.setField("index",i).setField("query",a).setField("size",0).setField("trackTotalHits",!0);let u=s;if(i.type===T.DataViewType.ROLLUP)o.setOverwriteDataViewType(void 0);else{const t=e.query.timefilter.timefilter.createFilter(i,r);t&&(u=[...u,t])}o.setField("filter",u);const c=null!=n&&n.adapter?{adapter:n.adapter,title:S.i18n.translate("unifiedHistogram.inspectorRequestDataTitleTotalHits",{defaultMessage:"Total hits"}),description:S.i18n.translate("unifiedHistogram.inspectorRequestDescriptionTotalHits",{defaultMessage:"This request queries Elasticsearch to fetch the total hits."})}:void 0,d=o.fetch$({inspector:c,sessionId:null==n?void 0:n.searchSessionId,abortSignal:t.signal,executionContext:{description:"fetch total hits"},disableWarningToasts:!0}).pipe(Object(l.filter)((e=>!Object(A.isRunningResponse)(e))),Object(l.map)((e=>e.rawResponse.hits.total)),Object(l.catchError)((e=>Object(l.of)(e)))),g=await Object(l.lastValueFrom)(d);return{resultStatus:g instanceof Error?P.a.error:P.a.complete,result:g}},le=async({services:{expressions:e},abortController:t,dataView:i,request:n,query:s,timeRange:a})=>{const r=await Object(te.textBasedQueryStateToAstWithValidation)({query:s,time:a,dataView:i});if(t.signal.aborted)return;if(!r)return{resultStatus:P.a.error,result:new Error("Invalid text based query")};const o=await Object(l.lastValueFrom)(e.run(r,null,{inspectorAdapters:{requests:null==n?void 0:n.adapter},searchSessionId:null==n?void 0:n.searchSessionId,executionContext:{description:"fetch total hits"}}).pipe(Object(l.pluck)("result")));return t.signal.aborted?void 0:Object(ie.isExpressionValueError)(o)?{resultStatus:P.a.error,result:new Error(o.error.message)}:{resultStatus:P.a.complete,result:o.rows.length}},ue=({services:e,query:t,filters:i,timeRange:n})=>{const{data:s}=e,a=Object(r.useMemo)((()=>null!=i?i:[]),[i]),o=Object(r.useMemo)((()=>null!=t?t:s.query.queryString.getDefaultQuery()),[s.query.queryString,t]),l=Object(r.useMemo)((()=>null!=n?n:s.query.timefilter.timefilter.getTimeDefaults()),[s.query.timefilter.timefilter,n]),u=Object(r.useRef)(Object(te.getAbsoluteTimeRange)(l));return{filters:a,query:o,getTimeRange:Object(r.useCallback)((()=>u.current),[]),updateTimeRange:_((()=>{u.current=Object(te.getAbsoluteTimeRange)(l)})),relativeTimeRange:l}};var ce={name:"1d3w5wq",styles:"width:100%"},de={name:"x4odxv",styles:"flex-grow:1;display:flex;flex-direction:column;position:relative;.series>rect{fill-opacity:0.5;stroke-width:1;}"};const ge=e=>{const{euiTheme:t}=Object(g.useEuiTheme)();return{resultCountCss:Object(R.css)("padding:",t.size.s," ",t.size.s," ",e?0:t.size.s," ",t.size.s,";min-height:",2.5*t.base,"px;",""),resultCountInnerCss:Object(R.css)(Object(g.useEuiBreakpoint)(["xs","s"]),"{align-items:center;}",""),resultCountTitleCss:Object(R.css)("flex-basis:auto;",Object(g.useEuiBreakpoint)(["xs","s"]),"{margin-bottom:0!important;}",""),resultCountToggleCss:Object(R.css)("flex-basis:auto;min-width:0;",Object(g.useEuiBreakpoint)(["xs","s"]),"{align-items:flex-end;}",""),histogramCss:de,breakdownFieldSelectorGroupCss:ce,breakdownFieldSelectorItemCss:Object(R.css)("min-width:0;align-items:flex-end;padding-left:",t.size.s,";",""),suggestionsSelectorItemCss:Object(R.css)("min-width:0;align-items:flex-start;padding-left:",t.size.s,";",""),chartToolButtonCss:Object(R.css)("display:flex;justify-content:center;padding-left:",t.size.s,";","")}},me=({chart:e,onChartHiddenChange:t})=>{const[i,n]=Object(r.useState)(!1),s=Object(r.useCallback)((()=>{n(!i)}),[i]),a=Object(r.useCallback)((()=>{n(!1)}),[n]),o=Object(r.useRef)({element:null,moveFocus:!1});Object(r.useEffect)((()=>{o.current.moveFocus&&o.current.element&&o.current.element.focus()}),[null==e?void 0:e.hidden]);const l=Object(r.useCallback)((()=>{const i=!(null!=e&&e.hidden);o.current.moveFocus=!i,null==t||t(i)}),[null==e?void 0:e.hidden,t]);return{showChartOptionsPopover:i,chartRef:o,toggleChartOptions:s,closeChartOptions:a,toggleHideChart:l}};function be({services:e,lensAttributesContext:t,lensAdapters:i,lensEmbeddableOutput$:n,currentSuggestion:s,isFlyoutVisible:a,setIsFlyoutVisible:o,isPlainRecord:l,query:c,onSuggestionChange:d}){const[g,m]=Object(r.useState)(null),b=Object(r.useRef)(void 0),f=Object(r.useRef)(void 0),p=Object(r.useRef)(void 0),h=Object(r.useCallback)(((e,t)=>{const i={...s,...e&&{datasourceState:e},...t&&{visualizationState:t}};null==d||d(i)}),[s,d]);return Object(r.useEffect)((()=>{var r,d;const g=null==i||null===(r=i.tables)||void 0===r?void 0:r.tables,v=Boolean(g)&&!Object(u.isEqual)(f.current,g)&&c!==(null==p?void 0:p.current),j=(null==s?void 0:s.title)!==(null==b||null===(d=b.current)||void 0===d?void 0:d.title);l&&(v||j||!a)&&async function(){const a=await e.lens.EditLensConfigPanelApi(),r=Object(R.jsx)(a,{attributes:t.attributes,updatePanelState:h,lensAdapters:i,output$:n,displayFlyoutHeader:!0,closeFlyout:()=>{o(!1)},wrapInFlyout:!0,datasourceId:"textBased"});m(r),b.current=s,f.current=g,v&&(p.current=c)}()}),[t.attributes,e.lens,h,l,s,c,a,o,i,n]),l?g:null}var fe=i(26);const pe=({title:e,filters:t,query:i,dataView:n,timeInterval:s,breakdownField:a,suggestion:r})=>{var o,l,u,c;const d=a&&Z(a);let g=["date_column","count_column"];d&&(g=["breakdown_column",...g]);let m={date_column:{dataType:"date",isBucketed:!0,label:null!==(o=n.timeFieldName)&&void 0!==o?o:"",operationType:"date_histogram",scale:"interval",sourceField:n.timeFieldName,params:{interval:null!=s?s:"auto"}},count_column:{dataType:"number",isBucketed:!1,label:S.i18n.translate("unifiedHistogram.countColumnLabel",{defaultMessage:"Count of records"}),operationType:"count",scale:"ratio",sourceField:"___records___",params:{format:{id:"number",params:{decimals:0}}}}};d&&(m={...m,breakdown_column:{dataType:"string",isBucketed:!0,label:S.i18n.translate("unifiedHistogram.breakdownColumnLabel",{defaultMessage:"Top 3 values of {fieldName}",values:{fieldName:null==a?void 0:a.displayName}}),operationType:"terms",scale:"ordinal",sourceField:a.name,params:{size:3,orderBy:{type:"column",columnId:"count_column"},orderDirection:"desc",otherBucket:!0,missingBucket:!1,parentFormat:{id:"terms"}}}});const b=Object.assign({},null==r?void 0:r.datasourceState),f=Object.assign({},null==r?void 0:r.visualizationState),p=r&&r.datasourceState?{[r.datasourceId]:{...b}}:{formBased:{layers:{unifiedHistogram:{columnOrder:g,columns:m}}}},h=r?{...f}:{layers:[{accessors:["count_column"],layerId:"unifiedHistogram",layerType:"data",seriesType:"bar_stacked",xAccessor:"date_column",...d?{splitAccessor:"breakdown_column"}:{yConfig:[{forAccessor:"count_column"}]}}],legend:{isVisible:!0,position:"right",legendSize:fe.LegendSize.EXTRA_LARGE,shouldTruncate:!1},preferredSeriesType:"bar_stacked",valueLabels:"hide",fittingFunction:"None",minBarHeight:2,showCurrentTimeMarker:!0,axisTitlesVisibilitySettings:{x:!1,yLeft:!1,yRight:!1},gridlinesVisibilitySettings:{x:!0,yLeft:!0,yRight:!1},tickLabelsVisibilitySettings:{x:!0,yLeft:!0,yRight:!1}};return{attributes:{title:null!==(l=null!=e?e:null==r?void 0:r.title)&&void 0!==l?l:S.i18n.translate("unifiedHistogram.lensTitle",{defaultMessage:"Edit visualization"}),references:[{id:null!==(u=n.id)&&void 0!==u?u:"",name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:null!==(c=n.id)&&void 0!==c?c:"",name:"indexpattern-datasource-layer-unifiedHistogram",type:"index-pattern"}],state:{datasourceStates:p,filters:t,query:i,visualization:h,...n&&n.id&&!n.isPersisted()&&{adHocDataViews:{[n.id]:n.toSpec(!1)}}},visualizationType:r?r.visualizationId:"lnsXY"},requestData:{dataViewId:n.id,timeField:n.timeFieldName,timeInterval:s,breakdownField:null==a?void 0:a.name}}},he=({dataView:e,request:t,hits:i,chart:n,chartVisible:s,breakdown:a,filters:o,query:c,relativeTimeRange:d,currentSuggestion:g,disableAutoFetching:m,input$:b,beforeRefetch:f})=>{const p=Object(r.useRef)();return Object(r.useEffect)((()=>{if(m)return;const r=ve({dataView:e,request:t,hits:i,chart:n,chartVisible:s,breakdown:a,filters:o,query:c,relativeTimeRange:d,currentSuggestion:g});Object(u.isEqual)(p.current,r)||(p.current&&b.next({type:"refetch"}),p.current=r)}),[a,n,s,g,e,m,o,i,b,c,d,t]),Object(r.useMemo)((()=>b.pipe(Object(l.filter)((e=>"refetch"===e.type)),Object(l.tap)(f),Object(l.share)())),[f,b])},ve=({dataView:e,request:t,hits:i,chart:n,chartVisible:s,breakdown:a,filters:r,query:o,relativeTimeRange:l,currentSuggestion:c})=>Object(u.cloneDeep)([e.id,null==t?void 0:t.searchSessionId,Boolean(i),s,null==n?void 0:n.timeInterval,Boolean(a),null==a?void 0:a.field,r,o,l,null==c?void 0:c.visualizationId]),je=({services:e,dataView:t,relativeTimeRange:i,lensAttributes:n,isPlainRecord:s})=>{const[a,o]=Object(r.useState)(!1),l=Object(r.useCallback)((async()=>{if(!t.id||s)return!1;if(!t.isTimeBased()||!t.getTimeField().visualizable)return!1;const i=await e.uiActions.getTriggerCompatibleActions("VISUALIZE_FIELD_TRIGGER",{dataViewSpec:t.toSpec(!1),fieldName:t.timeFieldName});return Boolean(i.length)}),[t,s,e.uiActions]),u=Object(r.useMemo)((()=>{if(a)return()=>{e.lens.navigateToPrefilledEditor({id:"",timeRange:i,attributes:n})}}),[a,n,i,e.lens]);return Object(r.useEffect)((()=>{l().then(o)}),[l]),u},Oe=Object(r.memo)(W);function ye({className:e,services:t,dataView:i,query:n,filters:s,timeRange:a,relativeTimeRange:u,request:c,hits:d,chart:m,breakdown:b,currentSuggestion:f,allSuggestions:p,isPlainRecord:h,appendHitsCounter:v,appendHistogram:j,disableAutoFetching:O,disableTriggers:y,disabledActions:C,input$:x,lensAdapters:w,lensEmbeddableOutput$:H,isOnHistogramMode:E,histogramQuery:I,isChartLoading:F,onResetChartHeight:P,onChartHiddenChange:q,onTimeIntervalChange:M,onSuggestionChange:V,onBreakdownFieldChange:z,onTotalHitsChange:B,onChartLoad:_,onFilter:L,onBrushEnd:$,withDefaultActions:N}){var D;const[W,G]=Object(r.useState)(!1),[U,Q]=Object(r.useState)(!1),{showChartOptionsPopover:X,chartRef:Z,toggleChartOptions:J,closeChartOptions:K,toggleHideChart:te}=me({chart:m,onChartHiddenChange:q}),ie=function({chart:e,toggleHideChart:t,onTimeIntervalChange:i,closePopover:n,onResetChartHeight:s,isPlainRecord:a}){if(!e)return[];const r=A.search.aggs.intervalOptions.findIndex((t=>t.val===e.timeInterval)),o=r>-1?A.search.aggs.intervalOptions[r].display:A.search.aggs.intervalOptions[0].display,l=[{name:e.hidden?S.i18n.translate("unifiedHistogram.showChart",{defaultMessage:"Show chart"}):S.i18n.translate("unifiedHistogram.hideChart",{defaultMessage:"Hide chart"}),icon:e.hidden?"eye":"eyeClosed",onClick:()=>{t(),n()},"data-test-subj":"unifiedHistogramChartToggle"}];e.hidden||(s&&l.push({name:S.i18n.translate("unifiedHistogram.resetChartHeight",{defaultMessage:"Reset to default height"}),icon:"refresh",onClick:()=>{s(),n()},"data-test-subj":"unifiedHistogramChartResetHeight"}),a||l.push({name:S.i18n.translate("unifiedHistogram.timeIntervalWithValue",{defaultMessage:"Time interval: {timeInterval}",values:{timeInterval:o}}),panel:1,"data-test-subj":"unifiedHistogramTimeIntervalPanel"}));const u=[{id:0,title:S.i18n.translate("unifiedHistogram.chartOptions",{defaultMessage:"Chart options"}),items:l}];return e.hidden||a||u.push({id:1,initialFocusedItemIndex:r>-1?r:0,title:S.i18n.translate("unifiedHistogram.timeIntervals",{defaultMessage:"Time intervals"}),items:A.search.aggs.intervalOptions.filter((({val:e})=>"custom"!==e)).map((({display:t,val:s})=>({name:t,label:t,icon:s===e.timeInterval?"check":"empty",onClick:()=>{null==i||i(s),n()},"data-test-subj":`unifiedHistogramTimeInterval-${t}`,className:s===e.timeInterval?"unifiedHistogramIntervalSelected":""})))}),u}({chart:m,toggleHideChart:te,onTimeIntervalChange:M,closePopover:K,onResetChartHeight:P,isPlainRecord:h}),ne=!(!m||m.hidden||!i.id||i.type===T.DataViewType.ROLLUP||!(h||!h&&i.isTimeBased())),se=Object(r.useMemo)((()=>null!=x?x:new l.Subject),[x]),{filters:re,query:oe,getTimeRange:le,updateTimeRange:ce,relativeTimeRange:de}=ue({services:t,query:n,filters:s,timeRange:a}),fe=he({dataView:i,request:c,hits:d,chart:m,chartVisible:ne,breakdown:b,filters:re,query:oe,relativeTimeRange:de,currentSuggestion:f,disableAutoFetching:O,input$:se,beforeRefetch:ce});ae({services:t,dataView:i,request:c,hits:d,chartVisible:ne,filters:re,query:oe,getTimeRange:le,refetch$:fe,onTotalHitsChange:B,isPlainRecord:h});const{resultCountCss:ve,resultCountInnerCss:ye,resultCountTitleCss:Ce,resultCountToggleCss:xe,histogramCss:we,breakdownFieldSelectorGroupCss:Se,breakdownFieldSelectorItemCss:Te,suggestionsSelectorItemCss:He,chartToolButtonCss:Re}=ge(ne),Ee=Object(r.useMemo)((()=>pe({title:null==m?void 0:m.title,filters:re,query:null!=I?I:oe,dataView:i,timeInterval:null==m?void 0:m.timeInterval,breakdownField:null==b?void 0:b.field,suggestion:f})),[null==b?void 0:b.field,null==m?void 0:m.timeInterval,null==m?void 0:m.title,f,i,re,oe,I]),Ie=Object(r.useCallback)((e=>{null==V||V(e)}),[V]);Object(r.useEffect)((()=>{!ne&&U&&Q(!1)}),[ne,U]);const ke=je({services:t,dataView:i,relativeTimeRange:null!=u?u:de,lensAttributes:Ee.attributes,isPlainRecord:h}),Fe=t.lens.SaveModalComponent,Pe=ne&&f&&(null===(D=t.capabilities.dashboard)||void 0===D?void 0:D.showWriteControls),Ae=Object(r.useMemo)((()=>Object(R.jsx)(g.EuiButtonIcon,{size:"xs",iconType:"pencil",onClick:()=>Q(!0),"data-test-subj":"unifiedHistogramEditFlyoutVisualization","aria-label":S.i18n.translate("unifiedHistogram.editVisualizationButton",{defaultMessage:"Edit visualization"}),disabled:U})),[U]),qe=f&&ne;return Object(R.jsx)(g.EuiFlexGroup,{className:e,direction:"column",alignItems:"stretch",gutterSize:"none",responsive:!1},Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:ve},Object(R.jsx)(g.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",gutterSize:"none",responsive:!1,css:ye},Object(R.jsx)(g.EuiFlexItem,{grow:!1,className:"eui-textTruncate eui-textNoWrap",css:Ce},d&&Object(R.jsx)(k,{hits:d,append:v})),m&&Object(R.jsx)(g.EuiFlexItem,{css:xe},Object(R.jsx)(g.EuiFlexGroup,{direction:"row",gutterSize:"none",responsive:!1,justifyContent:"flexEnd",css:Se},ne&&b&&Object(R.jsx)(g.EuiFlexItem,{css:Te},Object(R.jsx)(Y,{dataView:i,breakdown:b,onBreakdownFieldChange:z})),ne&&f&&p&&(null==p?void 0:p.length)>1&&Object(R.jsx)(g.EuiFlexItem,{css:He},Object(R.jsx)(ee,{suggestions:p,activeSuggestion:f,onSuggestionChange:Ie})),Pe&&Object(R.jsx)(o.a.Fragment,null,Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:Re},Object(R.jsx)(g.EuiToolTip,{content:S.i18n.translate("unifiedHistogram.saveVisualizationButton",{defaultMessage:"Save visualization"})},Object(R.jsx)(g.EuiButtonIcon,{size:"xs",iconType:"save",onClick:()=>G(!0),"data-test-subj":"unifiedHistogramSaveVisualization","aria-label":S.i18n.translate("unifiedHistogram.saveVisualizationButton",{defaultMessage:"Save visualization"})})))),qe&&Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:Re},U?Ae:Object(R.jsx)(g.EuiToolTip,{content:S.i18n.translate("unifiedHistogram.editVisualizationButton",{defaultMessage:"Edit visualization"})},Ae)),ke&&Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:Re},Object(R.jsx)(g.EuiToolTip,{content:S.i18n.translate("unifiedHistogram.editVisualizationButton",{defaultMessage:"Edit visualization"})},Object(R.jsx)(g.EuiButtonIcon,{size:"xs",iconType:"lensApp",onClick:ke,"data-test-subj":"unifiedHistogramEditVisualization","aria-label":S.i18n.translate("unifiedHistogram.editVisualizationButton",{defaultMessage:"Edit visualization"})}))),Object(R.jsx)(g.EuiFlexItem,{grow:!1,css:Re},Object(R.jsx)(g.EuiPopover,{id:"unifiedHistogramChartOptions",button:Object(R.jsx)(g.EuiToolTip,{content:S.i18n.translate("unifiedHistogram.chartOptionsButton",{defaultMessage:"Chart options"})},Object(R.jsx)(g.EuiButtonIcon,{size:"xs",iconType:"gear",onClick:J,"data-test-subj":"unifiedHistogramChartOptionsToggle","aria-label":S.i18n.translate("unifiedHistogram.chartOptionsButton",{defaultMessage:"Chart options"})})),isOpen:X,closePopover:K,panelPaddingSize:"none",anchorPosition:"downLeft"},Object(R.jsx)(g.EuiContextMenu,{initialPanelId:0,panels:ie}))))))),ne&&Object(R.jsx)(g.EuiFlexItem,null,Object(R.jsx)("section",{ref:e=>Z.current.element=e,tabIndex:-1,"aria-label":S.i18n.translate("unifiedHistogram.histogramOfFoundDocumentsAriaLabel",{defaultMessage:"Histogram of found documents"}),css:we},F&&Object(R.jsx)(g.EuiProgress,{size:"xs",color:"accent",position:"absolute","data-test-subj":"unifiedHistogramProgressBar"}),Object(R.jsx)(Oe,{services:t,dataView:i,request:c,hits:d,chart:m,getTimeRange:le,refetch$:fe,lensAttributesContext:Ee,isPlainRecord:h,disableTriggers:y,disabledActions:C,onTotalHitsChange:B,hasLensSuggestions:!Boolean(E),onChartLoad:_,onFilter:L,onBrushEnd:$,withDefaultActions:N})),j),Pe&&W&&Ee.attributes&&Object(R.jsx)(Fe,{initialInput:Ee.attributes,onSave:()=>{},onClose:()=>G(!1),isSaveable:!1}),U&&Object(R.jsx)(be,{services:t,lensAttributesContext:Ee,lensAdapters:w,lensEmbeddableOutput$:H,currentSuggestion:f,isFlyoutVisible:U,setIsFlyoutVisible:Q,isPlainRecord:h,query:n,onSuggestionChange:V}))}var Ce=i(19);const xe=["stats","project","keep"],we=({dataView:e,query:t,columns:i})=>[e.id,i,t],Se=({className:e,services:t,dataView:i,query:n,filters:s,currentSuggestion:a,isChartLoading:l,isPlainRecord:c,timeRange:d,relativeTimeRange:m,columns:b,request:f,hits:p,lensAdapters:h,lensEmbeddableOutput$:C,chart:S,breakdown:T,container:H,topPanelHeight:E,appendHitsCounter:I,disableAutoFetching:k,disableTriggers:F,disabledActions:P,lensSuggestionsApi:A,input$:q,onTopPanelHeightChange:M,onChartHiddenChange:V,onTimeIntervalChange:z,onBreakdownFieldChange:B,onSuggestionChange:_,onTotalHitsChange:L,onChartLoad:$,onFilter:N,onBrushEnd:D,children:W,withDefaultActions:G})=>{const{allSuggestions:U,currentSuggestion:Q,suggestionUnsupported:X,isOnHistogramMode:Z,histogramQuery:J}=(({dataView:e,query:t,originalSuggestion:i,isPlainRecord:n,columns:s,data:a,timeRange:o,lensSuggestionsApi:l,onSuggestionChange:c})=>{const d=Object(r.useMemo)((()=>{var i;const a={dataViewSpec:null==e?void 0:e.toSpec(),fieldName:"",textBasedColumns:s,query:t&&Object(Ce.isOfAggregateQueryType)(t)?t:void 0},r=n&&null!==(i=l(a,e,["lnsDatatable"]))&&void 0!==i?i:[],[o]=r;return{firstSuggestion:o,allSuggestions:r}}),[e,n,l,t,s]),[g,m]=Object(r.useState)(d.allSuggestions),b=null!=i?i:d.firstSuggestion,f=Object(r.useRef)(we({dataView:e,query:t,columns:s})),p=Object(r.useRef)(),h=Object(r.useMemo)((()=>{if(!b&&e.isTimeBased()&&t&&Object(Ce.isOfAggregateQueryType)(t)&&"esql"===Object(Ce.getAggregateQueryMode)(t)&&o){var i;let n=!1;if("esql"in t&&xe.forEach((e=>{t.esql.toLowerCase().includes(e)&&(n=!0)})),n)return;const s=((e,t)=>{const i=t.query.timefilter.timefilter.calculateBounds(e),n=i.min.valueOf();return(e=>{switch(!0){case e<=500:return"100 millisecond";case e<=5e3:return"1 second";case e<=7500:return"5 second";case e<=15e3:return"10 second";case e<=45e3:return"30 second";case e<=18e4:return"1 minute";case e<=45e4:return"5 minute";case e<=12e5:return"10 minute";case e<=27e5:return"30 minute";case e<=72e5:return"1 hour";case e<=216e5:return"3 hour";case e<=864e5:return"12 hour";case e<=6048e5:return"24 hour";case e<=18144e5:return"1 week";case e<36288e5:return"30 day";default:return"1 year"}})((i.max.valueOf()-n)/50)})(o,a),r=Object(Ce.getAggregateQueryMode)(t),u=`${Object(Ce.cleanupESQLQueryForLensSuggestions)(t[r])} | EVAL timestamp=DATE_TRUNC(${s}, ${e.timeFieldName}) | stats rows = count(*) by timestamp | rename timestamp as \`${e.timeFieldName} every ${s}\``,c={dataViewSpec:null==e?void 0:e.toSpec(),fieldName:"",textBasedColumns:[{id:`${e.timeFieldName} every ${s}`,name:`${e.timeFieldName} every ${s}`,meta:{type:"date"}},{id:"rows",name:"rows",meta:{type:"number"}}],query:{esql:u}},d=null!==(i=l(c,e,["lnsDatatable"]))&&void 0!==i?i:[];if(d.length)return p.current={esql:u},d[0]}p.current=void 0}),[b,e,t,o,a,l]);return Object(r.useEffect)((()=>{const i=we({dataView:e,query:t,columns:s});Object(u.isEqual)(f.current,i)||(m(d.allSuggestions),null==c||c(d.firstSuggestion),f.current=i)}),[s,e,c,t,d.firstSuggestion,d.allSuggestions]),{allSuggestions:g,currentSuggestion:null!=h?h:b,suggestionUnsupported:!b&&!h&&n,isOnHistogramMode:Boolean(h),histogramQuery:p.current?p.current:void 0}})({dataView:i,query:n,originalSuggestion:a,isPlainRecord:c,columns:b,timeRange:d,data:t.data,lensSuggestionsApi:A,onSuggestionChange:_}),K=X?void 0:S,[Y]=Object(r.useState)((()=>O({attributes:{class:"eui-fullHeight"}}))),[ee]=Object(r.useState)((()=>O({attributes:{class:"eui-fullHeight"}}))),te=Object(g.useIsWithinBreakpoints)(["xs","s"]),ie=te||!K||K.hidden,{euiTheme:ne}=Object(g.useEuiTheme)(),se=12*ne.base,ae=10*ne.base,re=te&&K&&!K.hidden?Object(y.css)("height:",se,"px;",""):"eui-fullHeight",oe=K||p?ie?x.b.Static:x.b.Resizable:x.b.Single,le=null!=E?E:se,ue=Object(r.useMemo)((()=>le!==se&&oe===x.b.Resizable?()=>null==M?void 0:M(void 0):void 0),[le,se,M,oe]);return Object(R.jsx)(o.a.Fragment,null,Object(R.jsx)(v,{node:Y},Object(R.jsx)(ye,{className:re,services:t,dataView:i,query:n,filters:s,timeRange:d,relativeTimeRange:m,request:f,hits:p,currentSuggestion:Q,isChartLoading:l,allSuggestions:U,isPlainRecord:c,chart:K,breakdown:T,appendHitsCounter:I,appendHistogram:Object(R.jsx)(g.EuiSpacer,{size:"s"}),disableAutoFetching:k,disableTriggers:F,disabledActions:P,input$:q,onResetChartHeight:ue,onChartHiddenChange:V,onTimeIntervalChange:z,onBreakdownFieldChange:B,onSuggestionChange:_,onTotalHitsChange:L,onChartLoad:$,onFilter:N,onBrushEnd:D,lensAdapters:h,lensEmbeddableOutput$:C,isOnHistogramMode:Z,histogramQuery:J,withDefaultActions:G})),Object(R.jsx)(v,{node:ee},W),Object(R.jsx)(w,{className:e,mode:oe,direction:x.a.Vertical,container:H,fixedPanelSize:le,minFixedPanelSize:se,minFlexPanelSize:ae,fixedPanel:Object(R.jsx)(j,{node:Y}),flexPanel:Object(R.jsx)(j,{node:ee}),"data-test-subj":"unifiedHistogram",onFixedPanelSizeChange:M}))};var Te=i(8),He=i(1),Re=i(27);const Ee=e=>e.breakdownField,Ie=e=>e.chartHidden,ke=e=>e.timeInterval,Fe=e=>e.topPanelHeight,Pe=e=>e.totalHitsResult,Ae=e=>e.totalHitsStatus,qe=e=>e.currentSuggestion,Me=e=>e.lensAdapters,Ve=e=>e.lensEmbeddableOutput$;var ze=i(28);const Be=(e,t,i)=>{const[n,s]=Object(r.useState)();return Object(r.useEffect)((()=>{const n=null==e?void 0:e.pipe(Object(ze.map)(t),Object(ze.distinctUntilChanged)(i)).subscribe(s);return()=>{null==n||n.unsubscribe()}}),[i,t,e]),n},_e=Object(r.forwardRef)(((e,t)=>{const[i,n]=Object(r.useState)(),[s,o]=Object(r.useState)(),[c,g]=Object(r.useState)(),[m]=Object(r.useState)((()=>new l.Subject)),[b,f]=Object(r.useState)();Object(r.useImperativeHandle)(t,(()=>b),[b]),d()((async()=>{const{getCreationOptions:t,services:i}=e,s=await(null==t?void 0:t()),a=await i.lens.stateHelperApi();n(Object(u.pick)(s,"disableAutoFetching","disableTriggers","disabledActions")),o((e=>{const{services:t,localStorageKeyPrefix:i,initialState:n}=e;let s,a,r=!1;var o;i&&(r=null!==(o=Object(He.b)(t.storage,i))&&void 0!==o&&o,s=Object(He.c)(t.storage,i),a=Object(He.a)(t.storage,i));const u=new l.BehaviorSubject({breakdownField:a,chartHidden:r,currentSuggestion:void 0,lensRequestAdapter:void 0,timeInterval:"auto",topPanelHeight:s,totalHitsResult:void 0,totalHitsStatus:Te.UnifiedHistogramFetchStatus.uninitialized,...n}),c=e=>{u.next({...u.getValue(),...e})};return{state$:u,setChartHidden:e=>{i&&Object(He.e)(t.storage,i,e),c({chartHidden:e})},setTopPanelHeight:e=>{i&&Object(He.f)(t.storage,i,e),c({topPanelHeight:e})},setBreakdownField:e=>{i&&Object(He.d)(t.storage,i,e),c({breakdownField:e})},setCurrentSuggestion:e=>{c({currentSuggestion:e})},setTimeInterval:e=>{c({timeInterval:e})},setLensRequestAdapter:e=>{c({lensRequestAdapter:e})},setLensAdapters:e=>{c({lensAdapters:e})},setLensEmbeddableOutput$:e=>{c({lensEmbeddableOutput$:e})},setTotalHits:e=>{u.getValue().totalHitsStatus===Te.UnifiedHistogramFetchStatus.partial&&e.totalHitsStatus===Te.UnifiedHistogramFetchStatus.loading||c(e)}}})({services:i,...s})),g((()=>a.suggestions))})),Object(r.useEffect)((()=>{s&&f({refetch:()=>{m.next({type:"refetch"})},...Object(u.pick)(s,"state$","setChartHidden","setTopPanelHeight","setBreakdownField","setTimeInterval","setTotalHits")})}),[m,s]);const{dataView:p,query:h,searchSessionId:v,requestAdapter:j,isChartLoading:O}=e,y=Be(null==s?void 0:s.state$,qe),C=Be(null==s?void 0:s.state$,Fe),x=(({stateService:e,dataView:t,query:i,searchSessionId:n,requestAdapter:s})=>{const a=Be(null==e?void 0:e.state$,Ee),o=Be(null==e?void 0:e.state$,Ie),l=Be(null==e?void 0:e.state$,ke),u=Be(null==e?void 0:e.state$,Pe),c=Be(null==e?void 0:e.state$,Ae),d=Be(null==e?void 0:e.state$,Me),g=Be(null==e?void 0:e.state$,Ve),m=Object(r.useMemo)((()=>i&&Object(Ce.isOfAggregateQueryType)(i)&&["sql","esql"].some((e=>e===Object(Ce.getAggregateQueryMode)(i)))),[i]),b=Object(r.useMemo)((()=>t&&t.type!==Re.DataViewType.ROLLUP&&t.isTimeBased()),[t]),f=Object(r.useMemo)((()=>{if(!(u instanceof Error))return{status:c,total:u}}),[u,c]),p=Object(r.useMemo)((()=>{if(b||m)return{hidden:o,timeInterval:l}}),[o,m,b,l]),h=Object(r.useMemo)((()=>{if(!m&&b)return{field:a?null==t?void 0:t.getFieldByName(a):void 0}}),[a,t,m,b]),v=Object(r.useMemo)((()=>({searchSessionId:n,adapter:s})),[s,n]),j=Object(r.useCallback)((t=>{null==e||e.setTopPanelHeight(t)}),[e]),O=Object(r.useCallback)((t=>{null==e||e.setTimeInterval(t)}),[e]),y=Object(r.useCallback)(((t,i)=>{null==e||e.setTotalHits({totalHitsStatus:t,totalHitsResult:i})}),[e]),C=Object(r.useCallback)((t=>{null==e||e.setChartHidden(t)}),[e]),x=Object(r.useCallback)((t=>{null==e||e.setLensRequestAdapter(t.adapters.requests),null==e||e.setLensAdapters(t.adapters),null==e||e.setLensEmbeddableOutput$(t.embeddableOutput$)}),[e]),w=Object(r.useCallback)((t=>{null==e||e.setBreakdownField(null==t?void 0:t.name)}),[e]),S=Object(r.useCallback)((t=>{null==e||e.setCurrentSuggestion(t)}),[e]);return Object(r.useEffect)((()=>{!o&&p||null==e||e.setLensRequestAdapter(void 0)}),[p,o,e]),{hits:f,chart:p,breakdown:h,request:v,isPlainRecord:m,lensAdapters:d,lensEmbeddableOutput$:g,onTopPanelHeightChange:j,onTimeIntervalChange:O,onTotalHitsChange:y,onChartHiddenChange:C,onChartLoad:x,onBreakdownFieldChange:w,onSuggestionChange:S}})({stateService:s,dataView:p,query:h,searchSessionId:v,requestAdapter:j});return i&&c&&b?Object(R.jsx)(Se,a()({},e,i,x,{currentSuggestion:y,isChartLoading:Boolean(O),topPanelHeight:C,input$:m,lensSuggestionsApi:c})):null}));t.default=_e}])]);