/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[16,48,55],{117:function(e,t,n){"use strict";n.d(t,"f",(function(){return a})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return c}));const a=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},r=(e,t)=>{var n,a;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(a=e.actions)||void 0===a?void 0:a.execute},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function u(e,t){var n,a;return null!==(n=null==t||null===(a=t.authorizedConsumers[e])||void 0===a?void 0:a.all)&&void 0!==n&&n}const c=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},121:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(6);const s=({decryption_health:e,execution_health:t,read_health:n,...a})=>({decryptionHealth:e,executionHealth:t,readHealth:n,...a}),r=({is_sufficiently_secure:e,has_permanent_encryption_key:t,alerting_framework_health:n,...a})=>({isSufficientlySecure:e,hasPermanentEncryptionKey:t,alertingFrameworkHealth:n,...a});async function i({http:e}){const t=await e.get(`${a.b}/_health`),n=s(t.alerting_framework_health);return{...r(t),alertingFrameworkHealth:n}}},129:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(2),s=n(1),r=n.n(s),i=n(3),u=n(0);const c=a.i18n.translate("xpack.triggersActionsUI.components.toastWithCircuitBreaker.seeFullError",{defaultMessage:"See full error"}),l=a.i18n.translate("xpack.triggersActionsUI.components.toastWithCircuitBreaker.hideFullError",{defaultMessage:"Hide full error"}),o=({children:e})=>{const[t,n]=Object(s.useState)(!1),a=Object(s.useCallback)((()=>{n((e=>!e))}),[]);return Object(u.jsx)(r.a.Fragment,null,t&&Object(u.jsx)(r.a.Fragment,null,Object(u.jsx)(i.EuiText,{size:"s"},e),Object(u.jsx)(i.EuiSpacer,null)),Object(u.jsx)(i.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(u.jsx)(i.EuiFlexItem,{grow:!1},Object(u.jsx)(i.EuiButton,{size:"s",color:"danger",onClick:a},t?l:c))))}},134:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(27);async function s({http:e}){return await e.get(`${a.a}/_config`)}},171:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(11),s=n(2);const r=e=>({isEnabled:!1,message:s.i18n.translate("xpack.triggersActionsUI.checkRuleTypeEnabled.ruleTypeDisabledByLicenseMessage",{defaultMessage:"This rule type requires a {minimumLicenseRequired} license.",values:{minimumLicenseRequired:Object(a.upperFirst)(e.minimumLicenseRequired)}})});function i(e){return!1===(null==e?void 0:e.enabledInLicense)?r(e):{isEnabled:!0}}},79:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return M}));var a=n(1),s=n.n(a),r=n(26),i=n(3),u=n(2),c=n(11),l=n(21),o=n(12),d=n(19),j=n(177),m=n(172),b=n(142),f=n(6),g=n(34);const p=({ruleTypeId:e,actions:t,...n})=>({...n,rule_type_id:e,actions:t.map((({group:e,id:t,params:n,frequency:a,alertsFilter:s,useAlertDataForTemplate:r})=>({group:e,id:t,params:n,frequency:{notify_when:a.notifyWhen,throttle:a.throttle,summary:a.summary},alerts_filter:s,...void 0!==r?{use_alert_data_for_template:r}:{}})))});var v=n(55),y=n(139),O=n(0);const h=({onConfirm:e,onCancel:t})=>Object(O.jsx)(i.EuiConfirmModal,{title:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveTitle",{defaultMessage:"Save rule with no actions?"}),onCancel:t,onConfirm:e,confirmButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveConfirmButtonText",{defaultMessage:"Save rule"}),cancelButtonText:u.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmRuleSaveModal"},Object(O.jsx)("p",null,Object(O.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmRuleSave.confirmRuleSaveWithoutActionsMessage",defaultMessage:"You can add an action at anytime."})));var x=n(173),S=n(117),E=n(124);const C=({isSaving:e,onSave:t,onCancel:n,isFormLoading:a})=>{const{loadingHealthCheck:c}=Object(E.b)();return Object(O.jsx)(i.EuiFlyoutFooter,null,Object(O.jsx)(i.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(O.jsx)(i.EuiFlexItem,{grow:!1},Object(O.jsx)(i.EuiButtonEmpty,{"data-test-subj":"cancelSaveRuleButton",onClick:n},u.i18n.translate("xpack.triggersActionsUI.sections.ruleAddFooter.cancelButtonLabel",{defaultMessage:"Cancel"}))),a?Object(O.jsx)(i.EuiFlexItem,{grow:!1},Object(O.jsx)(i.EuiSpacer,{size:"s"}),Object(O.jsx)(i.EuiLoadingSpinner,{size:"l"})):Object(O.jsx)(s.a.Fragment,null),Object(O.jsx)(i.EuiFlexItem,{grow:!1},Object(O.jsx)(i.EuiButton,{fill:!0,color:"success","data-test-subj":"saveRuleButton",type:"submit",iconType:"check",isDisabled:c,isLoading:e,onClick:t},Object(O.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleAddFooter.saveButtonLabel",defaultMessage:"Save"})))))};var T=n(30),I=n(174),k=n(57),F=n(134),w=n(205),R=n(129);const A=u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveErrorNotificationText",{defaultMessage:"Cannot create rule."}),M=({consumer:e,ruleTypeRegistry:t,actionTypeRegistry:n,onClose:s,canChangeTrigger:M,ruleTypeId:_,initialValues:B,reloadRules:U,onSave:L,hideGrouping:z,hideInterval:D,metadata:H,filteredRuleTypes:N,validConsumers:P,useRuleProducer:q,initialSelectedConsumer:W,...G})=>{var $;const V=null!=L?L:U,[J,K]=Object(a.useState)(H),Y=Object(a.useCallback)((e=>K(e)),[]),Q=Object(a.useMemo)((()=>({params:{},consumer:e,ruleTypeId:_,schedule:{interval:f.e},actions:[],tags:[],...B||{}})),[_,e,B]),[{rule:X},Z]=Object(a.useReducer)(b.a,{rule:Q}),[ee,te]=Object(a.useState)({isUsingSecurity:!1}),[ne,ae]=Object(a.useState)({}),[se,re]=Object(a.useState)(!1),[ie,ue]=Object(a.useState)(!1),[ce,le]=Object(a.useState)(!1),[oe,de]=Object(a.useState)(G.ruleTypeIndex),[je,me]=Object(a.useState)(!1),be=Object(a.useMemo)((()=>X.ruleTypeId&&f.l.includes(X.ruleTypeId)),[X]),[fe,ge]=Object(a.useState)(be?W:null),pe=(e,t)=>{Z({command:{type:"setProperty"},payload:{key:e,value:t}})},{http:ve,notifications:{toasts:ye},application:{capabilities:Oe}}=Object(T.b)().services,he=Object(S.f)(Oe);Object(a.useEffect)((()=>{(async()=>{te(await Object(F.a)({http:ve}))})()}),[ve]),Object(a.useEffect)((()=>{_&&pe("ruleTypeId",_)}),[_]),Object(a.useEffect)((()=>{G.ruleTypeIndex||(async()=>{const e=await Object(v.a)({http:ve}),t=new Map;for(const n of e)t.set(n.id,n);de(t)})()}),[G.ruleTypeIndex,ve]),Object(a.useEffect)((()=>{Object(c.isEmpty)(X.params)&&!Object(c.isEmpty)(ne)?ae({}):Object(c.isEmpty)(ne)&&ae(X.params)}),[X.params,ne]);const[xe,Se]=Object(a.useState)([]),[Ee,Ce]=Object(a.useState)(!1);Object(a.useEffect)((()=>{(async()=>{Ce(!0);const e=await Object(m.a)(X.actions,n);Ce(!1),Se([...e])})()}),[X.actions,n]),Object(a.useEffect)((()=>{var e;!ee.minimumScheduleInterval||null!=B&&null!==(e=B.schedule)&&void 0!==e&&e.interval||pe("schedule",{interval:Object(w.a)(ee.minimumScheduleInterval.value)})}),[ee.minimumScheduleInterval,B]),Object(a.useEffect)((()=>{if(X.ruleTypeId&&oe){const e=oe.get(X.ruleTypeId);null!=e&&e.defaultScheduleInterval&&!je&&pe("schedule",{interval:e.defaultScheduleInterval})}}),[X.ruleTypeId,oe,X.schedule.interval,je]),Object(a.useEffect)((()=>{X.schedule.interval===f.e||je||me(!0)}),[X.schedule.interval,je]);const Te=()=>{Object(I.a)(X,Q,!1)||Object(I.b)(X.params,ne)?le(!0):s(d.m.CANCELED,J)},Ie=async()=>{const e=await async function(){try{const e=await async function({http:e,rule:t}){const n=await e.post(`${f.b}/rule`,{body:JSON.stringify(p(t))});return Object(g.b)(n)}({http:ve,rule:{...X,...be&&fe?{consumer:fe}:{}}});return ye.addSuccess(u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.saveSuccessNotificationText",{defaultMessage:'Created rule "{ruleName}"',values:{ruleName:e.name}})),e}catch(t){var e;const n=Object(o.parseRuleCircuitBreakerErrorMessage)((null===(e=t.body)||void 0===e?void 0:e.message)||A);ye.addDanger({title:n.summary,...n.details&&{text:Object(l.toMountPoint)(Object(O.jsx)(R.a,null,n.details))}})}}();re(!1),e&&(s(d.m.SAVED,J),V&&V(J))},ke=X.ruleTypeId?t.get(X.ruleTypeId):null,{ruleBaseErrors:Fe,ruleErrors:we,ruleParamsErrors:Re}=Object(a.useMemo)((()=>Object(m.b)({...X,...be&&void 0!==fe?{consumer:fe}:{}},ke,ee)),[X,fe,be,ke,ee]),Ae=he&&0===(null===($=X.actions)||void 0===$?void 0:$.length);return Object(O.jsx)(i.EuiPortal,null,Object(O.jsx)(i.EuiFlyout,{onClose:Te,"aria-labelledby":"flyoutRuleAddTitle",size:"m",maxWidth:620,ownFocus:!0},Object(O.jsx)(i.EuiFlyoutHeader,{hasBorder:!0},Object(O.jsx)(i.EuiTitle,{size:"s","data-test-subj":"addRuleFlyoutTitle"},Object(O.jsx)("h3",{id:"flyoutTitle"},Object(O.jsx)(r.FormattedMessage,{defaultMessage:"Create rule",id:"xpack.triggersActionsUI.sections.ruleAdd.flyoutTitle"})))),Object(O.jsx)(E.a,null,Object(O.jsx)(y.a,{inFlyout:!0,waitForCheck:!0},Object(O.jsx)(i.EuiFlyoutBody,null,Object(O.jsx)(j.a,{canShowConsumerSelection:!0,rule:X,config:ee,dispatch:Z,errors:we,canChangeTrigger:M,operation:u.i18n.translate("xpack.triggersActionsUI.sections.ruleAdd.operationName",{defaultMessage:"create"}),validConsumers:P,selectedConsumer:fe,actionTypeRegistry:n,ruleTypeRegistry:t,metadata:J,filteredRuleTypes:N,hideGrouping:z,hideInterval:D,onChangeMetaData:Y,setConsumer:ge,useRuleProducer:q,initialSelectedConsumer:W})),Object(O.jsx)(C,{isSaving:se,isFormLoading:Ee,onSave:async()=>{if(re(!0),Ee||!Object(m.c)(X,we,xe))return e=Object(k.a)(X,Re,Fe,xe),Z({command:{type:"setRule"},payload:{key:"rule",value:e}}),void re(!1);var e;Ae?ue(!0):await Ie()},onCancel:Te}))),ie&&Object(O.jsx)(h,{onConfirm:async()=>{ue(!1),await Ie()},onCancel:()=>{re(!1),ue(!1)}}),ce&&Object(O.jsx)(x.a,{onConfirm:()=>{le(!1),s(d.m.CANCELED,J)},onCancel:()=>{le(!1)}})))}}}]);