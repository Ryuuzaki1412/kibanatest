/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[34],{116:function(e,t,n){"use strict";n.r(t),n.d(t,"AlertsTableState",(function(){return q})),n.d(t,"default",(function(){return q}));var s=n(1),r=n(11),i=n(3),o=n(10),l=n(48),a=n(21),u=n(5),c=n(2),d=n(95),b=n(9),g=n(143),p=n(35);const f=c.i18n.translate("xpack.triggersActionsUI.mutedAlerts.api.get",{defaultMessage:"Error fetching muted alerts data"});var m=n(206),j=n(322),w=n(26),h=n(295),v=n.n(h),y=n(178),O=n(161),C=n(0);const x={tall:490,short:250},A={maxWidth:500},S=({height:e="tall",controls:t,getInspectQuery:n,showInpectButton:s})=>Object(C.jsx)(i.EuiPanel,{color:"subdued","data-test-subj":"alertsStateTableEmptyState"},Object(C.jsx)(i.EuiFlexGroup,{alignItems:"flexEnd",justifyContent:"flexEnd"},s&&Object(C.jsx)(i.EuiFlexItem,{grow:!1},Object(C.jsx)(y.a,{getInspectQuery:n,inspectTitle:O.d})),(null==t?void 0:t.right)&&Object(C.jsx)(i.EuiFlexItem,{grow:!1},t.right)),Object(C.jsx)(i.EuiFlexGroup,{style:{height:x[e]},alignItems:"center",justifyContent:"center"},Object(C.jsx)(i.EuiFlexItem,{grow:!1},Object(C.jsx)(i.EuiPanel,{hasBorder:!0,style:A},Object(C.jsx)(i.EuiFlexGroup,null,Object(C.jsx)(i.EuiFlexItem,null,Object(C.jsx)(i.EuiText,{size:"s"},Object(C.jsx)(i.EuiTitle,null,Object(C.jsx)("h3",null,Object(C.jsx)(w.FormattedMessage,{id:"xpack.triggersActionsUI.empty.title",defaultMessage:"No results match your search criteria"}))),Object(C.jsx)("p",null,Object(C.jsx)(w.FormattedMessage,{id:"xpack.triggersActionsUI.empty.description",defaultMessage:"Try searching over a longer period of time or modifying your search"})))),Object(C.jsx)(i.EuiFlexItem,{grow:!1},Object(C.jsx)(i.EuiImage,{style:{width:200,height:148},size:"200",alt:"",url:v.a})))))));var E=n(19);const I=e=>new Map(Array.from(Array(e).keys()).map((e=>[e,{isLoading:!1}]))),T=(e,{action:t,rowIndex:n,rowCount:s,isLoading:r=!1})=>{const{rowSelection:i,rowCount:o}=e,l={...e};if(t===E.g.add&&void 0!==n){const e=new Map(i);e.set(n,{isLoading:r}),l.rowSelection=e}else if(t===E.g.delete&&void 0!==n){const e=new Map(i);e.delete(n),l.rowSelection=e}else if(t===E.g.selectCurrentPage)l.rowSelection=I(o);else if(t===E.g.selectAll)l.rowSelection=I(o),l.isAllSelected=!0;else if(t===E.g.clear)l.rowSelection=new Map,l.isAllSelected=!1;else if(t===E.g.rowCountUpdate&&void 0!==s)l.rowCount=s;else if(t===E.g.updateAllLoadingState){const e=new Map(Array.from(i.keys()).map((e=>[e,{isLoading:r}])));l.rowSelection=e}else t===E.g.updateRowLoadingState&&void 0!==n&&l.rowSelection.set(n,{isLoading:r});return l.areAllVisibleRowsSelected=l.rowSelection.size===l.rowCount,l};var _=n(138),F=n(30),M=n(166);const k=(e,t,n)=>{return{...B(n,e)||{id:e},schema:(s=R(e,t).type,"date"===s?"datetime":"number"===s?"numeric":"object"===s?"json":s)};var s},R=(e,t)=>{const n={type:"string"};if(!t||0===Object.keys(t).length)return n;const s=(e=>{const t=e.split(".");return 1===t.length?"base":t[0]})(e);if(!t[s])return n;const r=t[s].fields;if(!r)return n;return r[e]||n},L=(e,t,n)=>e.map((e=>(e=>Boolean(e.schema))(e)?e:k(e.id,t,n))),B=(e,t)=>e.find((({id:e})=>e===t)),P=({id:e,storageAlertsTable:t,columns:n,storage:s,visibleColumns:r})=>{t.current={...t.current,columns:n,visibleColumns:r},s.current.set(e,t.current)},z=({featureIds:e,storageAlertsTable:t,storage:n,id:i,defaultColumns:l,initialBrowserFields:a})=>{var u;const[c,d]=(({featureIds:e,initialBrowserFields:t})=>{const{http:n,notifications:{toasts:r}}=Object(F.b)().services,[i,o]=Object(s.useState)(void 0),[l,a]=Object(s.useState)((()=>null!=t?t:{})),[u,c]=Object(s.useState)([]),d=Object(s.useCallback)((async()=>{if(!n)return Promise.resolve({browserFields:{},fields:[]});try{return await n.get(`${_.a}/browser_fields`,{query:{featureIds:e}})}catch(e){return r.addDanger(M.d),Promise.resolve({browserFields:{},fields:[]})}}),[e,n,r]);return Object(s.useEffect)((()=>{t?a(t):void 0!==i||e.includes("siem")||(o(!0),(async()=>{const{browserFields:e,fields:t}=await d();c(t),a(e),o(!1)})())}),[d,i,e,t]),[i,l,u]})({featureIds:e,initialBrowserFields:a}),[b,g]=Object(s.useState)((()=>{let e=t.current.columns;return a&&l?e=L(e,a,l):e&&0===e.length&&(e=l),e})),[p,f]=Object(s.useState)(null!==(u=t.current.visibleColumns)&&void 0!==u?u:(e=>e.map((e=>e.id)))(b)),[m,j]=Object(s.useState)(!1),w=Object(s.useRef)(l),h=l!==w.current,v=Object(s.useCallback)((e=>{f(e),P({id:i,storage:n,storageAlertsTable:t,columns:b,visibleColumns:e})}),[b,i,n,t]);Object(s.useEffect)((()=>{var e;if(h&&w.current)return w.current=l,j(!1),g(t.current.columns),void f(null!==(e=t.current.visibleColumns)&&void 0!==e?e:p)}),[h,t,l,p]),Object(s.useEffect)((()=>{if(Object(r.isEmpty)(d)||m)return;const e=L(b,d,l);j(!0),g(e)}),[d,l,c,m,b]);const y=Object(s.useCallback)(((e,s)=>{g(e),P({id:i,storage:n,storageAlertsTable:t,columns:e,visibleColumns:s})}),[i,n,t]),C=Object(s.useCallback)((e=>{const t=(({column:e,columns:t,defaultColumns:n})=>{const s=t.findIndex((t=>t.id===e.id)),r=s>=0,i=(e=>{const t={...e};return t.id===o.b&&(t.isSortable=!1,t.displayAsText||(t.displayAsText=O.e)),t.id===o.p&&(t.isSortable=!1,t.displayAsText||(t.displayAsText=O.f)),t})(e);return r?(({columns:e,index:t})=>[...e.slice(0,t),...e.slice(t+1)])({columns:t,index:s}):(({column:e,columns:t,defaultColumns:n})=>{const s=n.findIndex((t=>t.id===e.id));return s>=0?[...t.slice(0,s),e,...t.slice(s)]:0===t.length?[e]:[t[0],e,...t.slice(1)]})({defaultColumns:n,column:i,columns:t})})({column:k(e,d,l),columns:b,defaultColumns:l});let n=p;n=p.includes(e)?p.filter((t=>t!==e)):[p[0],e,...p.slice(1)],f(n),y(t,n)}),[d,b,l,y,p]),x=Object(s.useCallback)((()=>{const e=L(l,d,l);y(e,e.map((e=>e.id)))}),[d,l,y]),A=Object(s.useCallback)((({columnId:e,width:t})=>{const n=b.findIndex((t=>t.id===e));n>-1&&(b.splice(n,1,{...b[n],initialWidth:t}),y(b,p))}),[b,y,p]),S=Object(s.useMemo)((()=>[...b.map((e=>({field:e.id,include_unmapped:!0})))]),[b]);return Object(s.useMemo)((()=>({columns:b,visibleColumns:p,isBrowserFieldDataLoading:c,browserFields:d,onToggleColumn:C,onResetColumns:x,onChangeVisibleColumns:v,onColumnResize:A,fields:S})),[d,b,S,c,A,x,C,v,p])},N=new u.QueryClient,W=c.i18n.translate("xpack.triggersActionsUI.cases.api.bulkGet",{defaultMessage:"Error fetching cases data"}),U=e=>{const t=new Map;for(const s of null!==(n=null==e?void 0:e.cases)&&void 0!==n?n:[]){var n;t.set(s.id,{...s})}return t};var V=n(218);const D={pageSize:10,pageIndex:0},Q={id:"",columns:[],sort:[],getRenderCellValue:()=>()=>null},q=e=>Object(C.jsx)(u.QueryClientProvider,{client:N,context:p.b},Object(C.jsx)(G,e)),G=({alertsTableConfigurationRegistry:e,configurationId:t,id:n,featureIds:c,query:w,pageSize:h,leadingControlColumns:v,rowHeightsOptions:x,renderCellValue:A,columns:E,gridStyle:I,browserFields:_,onUpdate:F,onLoaded:M,runtimeMappings:k,showAlertStatusWithFlapping:R,toolbarVisibility:L,shouldHighlightRow:B,dynamicRowHeight:P,lastReloadRequestTime:N})=>{var q,G,H,$,J,K,X,Y,Z,ee;const{cases:te}=Object(a.useKibana)().services,ne=null!==(q=null==e?void 0:e.has(t))&&void 0!==q&&q;ne||console.warn(`Missing Alert Table configuration for configuration ID: ${t}`);const se=ne?e.get(t):Q,re=Object(s.useRef)(new l.Storage(window.localStorage)),ie=re.current.get(n),oe=null==se||null===(G=se.usePersistentControls)||void 0===G?void 0:G.call(se),le=null!==(H=null==se?void 0:se.showInspectButton)&&void 0!==H&&H,ae=E&&!Object(r.isEmpty)(E)?E:null!==($=null==se?void 0:se.columns)&&void 0!==$?$:[],ue=ie&&ie.columns&&!Object(r.isEmpty)(null==ie?void 0:ie.columns)?null==ie?void 0:ie.columns:ae,ce=()=>{var e;return{columns:ue,sort:ie&&ie.sort&&!Object(r.isEmpty)(null==ie?void 0:ie.sort)?null==ie?void 0:ie.sort:null!==(e=null==se?void 0:se.sort)&&void 0!==e?e:[],visibleColumns:ie&&ie.visibleColumns&&!Object(r.isEmpty)(null==ie?void 0:ie.visibleColumns)?null==ie?void 0:ie.visibleColumns:ue.map((e=>e.id))}},de=Object(s.useRef)(ce());de.current=ce();const[be,ge]=Object(s.useState)(de.current.sort),[pe,fe]=Object(s.useState)({...D,pageSize:null!=h?h:D.pageSize}),{columns:me,browserFields:je,isBrowserFieldDataLoading:we,onToggleColumn:he,onResetColumns:ve,visibleColumns:ye,onChangeVisibleColumns:Oe,onColumnResize:Ce,fields:xe}=z({featureIds:c,storageAlertsTable:de,storage:re,id:n,defaultColumns:ae,initialBrowserFields:_}),Ae=Object(s.useCallback)((e=>{fe(e)}),[]),[Se,{alerts:Ee,oldAlertsData:Ie,ecsAlertsData:Te,isInitializing:_e,getInspectQuery:Fe,refetch:Me,totalAlerts:ke,updatedAt:Re}]=Object(m.a)({fields:xe,featureIds:c,query:w,pagination:pe,onPageChange:Ae,onLoaded:M,runtimeMappings:k,sort:be,skip:!1}),{data:Le}=((e,t=!0)=>{const{http:n,notifications:{toasts:s}}=Object(b.useKibana)().services;return Object(u.useQuery)(g.a.mutedAlerts(),(({signal:t})=>(async(e,t,n)=>{const s=d.nodeBuilder.or(t.ids.map((e=>d.nodeBuilder.is("alert.id",`alert:${e}`))));return e.post("/internal/alerting/rules/_find",{body:JSON.stringify({filter:JSON.stringify(s),fields:["id","mutedInstanceIds"],page:1,per_page:t.ids.length}),signal:n})})(n,{ids:e},t).then((({data:e})=>null==e?void 0:e.reduce(((e,t)=>(e[t.id]=t.muted_alert_ids,e)),{})))),{context:p.b,enabled:e.length>0&&t,onError:e=>{"AbortError"!==e.name&&s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:f})}})})([...new Set(Ee.map((e=>e["kibana.alert.rule.uuid"][0])))]);Object(s.useEffect)((()=>{e.update(t,{...se,actions:{toggleColumn:he}})}),[he]),Object(s.useEffect)((()=>{F&&F({isLoading:Se,totalCount:ke,refresh:Me})}),[Se,ke,F,Me]),Object(s.useEffect)((()=>{N&&Me()}),[N,Me]);const Be=Object(s.useMemo)((()=>(e=>new Set(e.filter((e=>{const t=e[o.b];return null!=t&&t.length>0})).map((e=>e[o.b])).flat()))(Ee)),[Ee]),Pe=Object(s.useMemo)((()=>(e=>new Set(e.filter((e=>{const t=e[o.p];return null!=t&&t.length>0})).map((e=>e[o.p])).flat()))(Ee)),[Ee]),ze=null==te?void 0:te.helpers.canUseCases(null!==(J=null==se||null===(K=se.cases)||void 0===K?void 0:K.owner)&&void 0!==J?J:[]),Ne=Boolean(null==ze?void 0:ze.read),We=(e=>e.some((({id:e})=>e===o.b)))(me)&&Ne,Ue=(e=>e.some((({id:e})=>e===o.p)))(me),{data:Ve,isFetching:De}=((e,t)=>{const{http:n,notifications:{toasts:s}}=Object(b.useKibana)().services;return Object(u.useQuery)(g.a.casesBulkGet(e),(({signal:t})=>(async(e,t,n)=>await e.post("/internal/cases/_bulk_get",{body:JSON.stringify({...t}),signal:n}))(n,{ids:e},t)),{context:p.b,enabled:e.length>0&&t,select:U,onError:e=>{"AbortError"!==e.name&&s.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:W})}})})(Array.from(Be.values()),We),{data:Qe,isFetching:qe}=Object(V.a)({ids:Array.from(Pe.values()),canFetchMaintenanceWindows:Ue,queryContext:p.b}),Ge=Object(s.useReducer)(T,{rowSelection:new Map,isAllSelected:!1,areAllVisibleRowsSelected:!1,rowCount:Ee.length}),He=Object(s.useCallback)((e=>{const t=e.map((e=>({[e.id]:{order:e.direction}})));de.current={...de.current,sort:t},re.current.set(n,de.current),ge(t)}),[n]),$e=Object(s.useCallback)((()=>({activePage:pe.pageIndex,alerts:Ee,alertsCount:ke,isInitializing:_e,isLoading:Se,getInspectQuery:Fe,onPageChange:Ae,onSortChange:He,refresh:Me,sort:be,updatedAt:Re,oldAlertsData:Ie,ecsAlertsData:Te})),[Ee,ke,Te,Fe,_e,Se,Ie,Ae,He,pe,Me,be,Re]),Je=null==te?void 0:te.ui.getCasesContext(),Ke=te&&Je,Xe=Object(s.useMemo)((()=>({data:null!=Ve?Ve:new Map,isLoading:De})),[Ve,De]),Ye=Object(s.useMemo)((()=>({data:null!=Qe?Qe:new Map,isLoading:qe})),[Qe,qe]),Ze=Object(s.useMemo)((()=>({alertsTableConfiguration:se,cases:Xe,maintenanceWindows:Ye,columns:me,bulkActions:[],deletedEventIds:[],disabledCellActions:[],pageSize:pe.pageSize,pageSizeOptions:[10,20,50,100],id:n,leadingControlColumns:null!=v?v:[],showAlertStatusWithFlapping:R,trailingControlColumns:[],useFetchAlertsData:$e,visibleColumns:ye,"data-test-subj":"internalAlertsState",updatedAt:Re,browserFields:je,onToggleColumn:he,onResetColumns:ve,onChangeVisibleColumns:Oe,onColumnResize:Ce,query:w,rowHeightsOptions:x,renderCellValue:A,gridStyle:I,controls:oe,showInspectButton:le,toolbarVisibility:L,shouldHighlightRow:B,dynamicRowHeight:P,featureIds:c})),[se,Xe,Ye,me,pe.pageSize,n,v,R,$e,ye,Re,je,he,ve,Oe,Ce,w,x,A,I,oe,le,L,B,P,c]);return ne?Object(C.jsx)(p.a.Provider,{value:{mutedAlerts:null!=Le?Le:{},bulkActions:Ge}},!Se&&0===ke&&Object(C.jsx)(y.b,null,Object(C.jsx)(S,{controls:oe,getInspectQuery:Fe,showInpectButton:le})),(Se||we)&&Object(C.jsx)(i.EuiProgress,{size:"xs",color:"accent","data-test-subj":"internalAlertsPageLoading"}),0!==ke&&Ke&&Object(C.jsx)(Je,{owner:null!==(X=null===(Y=se.cases)||void 0===Y?void 0:Y.owner)&&void 0!==X?X:[],permissions:ze,features:{alerts:{sync:null!==(Z=null===(ee=se.cases)||void 0===ee?void 0:ee.syncAlerts)&&void 0!==Z&&Z}}},Object(C.jsx)(j.AlertsTable,Ze)),0!==ke&&!Ke&&Object(C.jsx)(j.AlertsTable,Ze)):Object(C.jsx)(i.EuiEmptyPrompt,{"data-test-subj":"alertsTableNoConfiguration",iconType:"watchesApp",title:Object(C.jsx)("h2",null,O.b),body:Object(C.jsx)("p",null,O.a)})}},148:function(e,t,n){"use strict";function s(e){return e}function r(e){throw new Error("Called `absurd` function which should be uncallable")}Object.defineProperty(t,"__esModule",{value:!0}),t.bindTo_=t.bind_=t.hole=t.pipe=t.untupled=t.tupled=t.absurd=t.decrement=t.increment=t.tuple=t.flow=t.flip=t.constVoid=t.constUndefined=t.constNull=t.constFalse=t.constTrue=t.constant=t.not=t.unsafeCoerce=t.identity=void 0,t.identity=s,t.unsafeCoerce=s,t.not=function(e){return function(t){return!e(t)}},t.constant=function(e){return function(){return e}},t.constTrue=function(){return!0},t.constFalse=function(){return!1},t.constNull=function(){return null},t.constUndefined=function(){},t.constVoid=function(){},t.flip=function(e){return function(t,n){return e(n,t)}},t.flow=function(e,t,n,s,r,i,o,l,a){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return s(n(t(e.apply(this,arguments))))};case 5:return function(){return r(s(n(t(e.apply(this,arguments)))))};case 6:return function(){return i(r(s(n(t(e.apply(this,arguments))))))};case 7:return function(){return o(i(r(s(n(t(e.apply(this,arguments)))))))};case 8:return function(){return l(o(i(r(s(n(t(e.apply(this,arguments))))))))};case 9:return function(){return a(l(o(i(r(s(n(t(e.apply(this,arguments)))))))))}}},t.tuple=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},t.increment=function(e){return e+1},t.decrement=function(e){return e-1},t.absurd=r,t.tupled=function(e){return function(t){return e.apply(void 0,t)}},t.untupled=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e(t)}},t.pipe=function(e,t,n,s,r,i,o,l,a,u,c,d,b,g,p,f,m,j,w,h){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return s(n(t(e)));case 5:return r(s(n(t(e))));case 6:return i(r(s(n(t(e)))));case 7:return o(i(r(s(n(t(e))))));case 8:return l(o(i(r(s(n(t(e)))))));case 9:return a(l(o(i(r(s(n(t(e))))))));case 10:return u(a(l(o(i(r(s(n(t(e)))))))));case 11:return c(u(a(l(o(i(r(s(n(t(e))))))))));case 12:return d(c(u(a(l(o(i(r(s(n(t(e)))))))))));case 13:return b(d(c(u(a(l(o(i(r(s(n(t(e))))))))))));case 14:return g(b(d(c(u(a(l(o(i(r(s(n(t(e)))))))))))));case 15:return p(g(b(d(c(u(a(l(o(i(r(s(n(t(e))))))))))))));case 16:return f(p(g(b(d(c(u(a(l(o(i(r(s(n(t(e)))))))))))))));case 17:return m(f(p(g(b(d(c(u(a(l(o(i(r(s(n(t(e))))))))))))))));case 18:return j(m(f(p(g(b(d(c(u(a(l(o(i(r(s(n(t(e)))))))))))))))));case 19:return w(j(m(f(p(g(b(d(c(u(a(l(o(i(r(s(n(t(e))))))))))))))))));case 20:return h(w(j(m(f(p(g(b(d(c(u(a(l(o(i(r(s(n(t(e)))))))))))))))))))}},t.hole=r,t.bind_=function(e,t,n){var s;return Object.assign({},e,((s={})[t]=n,s))},t.bindTo_=function(e){return function(t){var n;return(n={})[e]=t,n}}},218:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var s=n(2),r=n(5),i=n(30),o=n(1),l=n(140),a=n.n(l),u=n(94),c=n(143),d=n(12);const b=s.i18n.translate("xpack.triggersActionsUI.alertsTable.api.bulkGetMaintenanceWindow.errorTitle",{defaultMessage:"Error fetching maintenance windows data"}),g=e=>{const t=new Map;for(const s of null!==(n=null==e?void 0:e.maintenanceWindows)&&void 0!==n?n:[]){var n;t.set(s.id,{...s})}return t},p=e=>{const{ids:t,canFetchMaintenanceWindows:n=!1,queryContext:s}=e,{http:l,notifications:{toasts:p},application:{capabilities:{maintenanceWindow:{show:f}}}}=Object(i.b)().services,{isAtLeastPlatinum:m}=(()=>{var e;const{licensing:t}=Object(i.b)().services,n=a()(null!==(e=null==t?void 0:t.license$)&&void 0!==e?e:new u.Observable,null),s=Object(o.useCallback)((e=>!!n&&n.isAvailable&&n.isActive&&n.hasAtLeast(e)),[n]);return{isAtLeastPlatinum:Object(o.useCallback)((()=>s("platinum")),[s])}})(),j=m(),{data:w,isFetching:h}=Object(r.useQuery)({queryKey:c.a.maintenanceWindowsBulkGet(t),enabled:j&&f&&t.length>0&&n,select:g,queryFn:()=>(async({http:e,ids:t})=>{return{maintenanceWindows:(n=await e.post(`${d.INTERNAL_ALERTING_API_MAINTENANCE_WINDOW_PATH}/_bulk_get`,{body:JSON.stringify({ids:t})})).maintenance_windows.map((e=>(({expiration_date:e,r_rule:t,created_by:n,updated_by:s,created_at:r,updated_at:i,event_start_time:o,event_end_time:l,category_ids:a,...u})=>({...u,expirationDate:e,rRule:t,createdBy:n,updatedBy:s,createdAt:r,updatedAt:i,eventStartTime:o,eventEndTime:l,categoryIds:a}))(e))),errors:n.errors.map((e=>(({status_code:e,...t})=>({...t,statusCode:e}))(e)))};var n})({http:l,ids:t}),onError:e=>{p.addError(e.body&&e.body.message?new Error(e.body.message):e,{title:b})},context:s});return{data:w,isFetching:h}}},295:function(e,t,n){e.exports=n.p+"94cccf20036d014924e63d4d595e88e1.svg"}}]);