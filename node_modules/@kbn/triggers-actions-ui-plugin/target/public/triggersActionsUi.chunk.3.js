/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[3],{124:function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return o}));var n=s(1),r=s(0);const a={loadingHealthCheck:!1,setLoadingHealthCheck:e=>{throw new Error("setLoadingHealthCheck was not initialized, set it when you invoke the context")}},l=Object(n.createContext)(a),i=({children:e})=>{const[t,s]=Object(n.useState)(!1),a=Object(n.useCallback)((e=>{s(e)}),[]),i=Object(n.useMemo)((()=>({loadingHealthCheck:t,setLoadingHealthCheck:a})),[t,a]);return Object(r.jsx)(l.Provider,{value:i},e)},o=()=>{const e=Object(n.useContext)(l);if(!e)throw new Error("HealthContext has not been set.");return e}},139:function(e,t,s){"use strict";s.d(t,"a",(function(){return g}));var n=s(1),r=s.n(n),a=s(128),l=s(130),i=s(26),o=s(3),c=s(2),u=(s(156),s(124)),d=s(30),p=s(52),m=s(27),b=s(121),j=s(0);const g=({children:e,waitForCheck:t,inFlyout:s=!1})=>{const{http:n,docLinks:i}=Object(d.b)().services,{setLoadingHealthCheck:c}=Object(u.b)(),[g,O]=r.a.useState(a.none);r.a.useEffect((()=>{!async function(){c(!0);const e=await async function({http:e}){const t=await e.get(`${m.a}/_health`);return t?{isRulesAvailable:t.isAlertsAvailable}:t}({http:n}),t={...e,isSufficientlySecure:!1,hasPermanentEncryptionKey:!1};if(t.isRulesAvailable){const e=await async function(e){try{return Object(a.some)(await Object(b.a)({http:e}))}catch(e){return a.none}}(n);Object(a.isSome)(e)?(t.isSufficientlySecure=e.value.isSufficientlySecure,t.hasPermanentEncryptionKey=e.value.hasPermanentEncryptionKey):(t.isSufficientlySecure=!0,t.hasPermanentEncryptionKey=!0),O(Object(a.some)(t))}c(!1)}()}),[n,c]);const v=s?"alertingFlyoutHealthCheck":"alertingHealthCheck";return Object(l.pipe)(g,Object(a.fold)((()=>t?Object(j.jsx)(r.a.Fragment,null,Object(j.jsx)(o.EuiSpacer,{size:"m"}),Object(j.jsx)(p.a,null)):Object(j.jsx)(r.a.Fragment,null,e)),(t=>null!=t&&t.isSufficientlySecure&&null!=t&&t.hasPermanentEncryptionKey?Object(j.jsx)(r.a.Fragment,null,e):t.isRulesAvailable?t.isSufficientlySecure||t.hasPermanentEncryptionKey?t.hasPermanentEncryptionKey?Object(j.jsx)(y,{docLinks:i,className:v}):Object(j.jsx)(h,{docLinks:i,className:v}):Object(j.jsx)(f,{docLinks:i,className:v}):Object(j.jsx)(x,{docLinks:i,className:v}))))},h=({docLinks:e,className:t})=>Object(j.jsx)(o.EuiEmptyPrompt,{iconType:"watchesApp","data-test-subj":"actionNeededEmptyPrompt",className:t,titleSize:"xs",title:Object(j.jsx)("h2",null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.components.healthCheck.encryptionErrorTitle",defaultMessage:"Additional setup required"})),body:Object(j.jsx)("div",{className:`${t}__body`},Object(j.jsx)("p",{role:"banner"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.encryptionErrorBeforeKey",{defaultMessage:"You must configure an encryption key to use Alerting. "}),Object(j.jsx)(o.EuiLink,{href:e.links.alerting.generalSettings,external:!0,target:"_blank"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.encryptionErrorAction",{defaultMessage:"Learn more."}))))}),y=({docLinks:e,className:t})=>Object(j.jsx)(o.EuiEmptyPrompt,{iconType:"watchesApp","data-test-subj":"actionNeededEmptyPrompt",className:t,titleSize:"xs",title:Object(j.jsx)("h2",null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.components.healthCheck.apiKeysDisabledErrorTitle",defaultMessage:"Additional setup required"})),body:Object(j.jsx)("div",{className:`${t}__body`},Object(j.jsx)("p",{role:"banner"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.apiKeysDisabledError",{defaultMessage:"You must enable API keys to use Alerting. "}),Object(j.jsx)(o.EuiLink,{href:e.links.security.elasticsearchEnableApiKeys,external:!0,target:"_blank"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.apiKeysDisabledErrorAction",{defaultMessage:"Learn more."}))))}),x=({docLinks:e,className:t})=>Object(j.jsx)(o.EuiEmptyPrompt,{iconType:"watchesApp","data-test-subj":"alertsNeededEmptyPrompt",className:t,titleSize:"xs",title:Object(j.jsx)("h2",null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.components.healthCheck.alertsErrorTitle",defaultMessage:"You must enable Alerting and Actions"})),body:Object(j.jsx)("div",{className:`${t}__body`},Object(j.jsx)("p",{role:"banner"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.alertsError",{defaultMessage:"To create a rule, you must enable the alerting and actions plugins. "}),Object(j.jsx)(o.EuiLink,{href:e.links.alerting.generalSettings,external:!0,target:"_blank"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.alertsErrorAction",{defaultMessage:"Learn how."}))))}),f=({docLinks:e,className:t})=>Object(j.jsx)(o.EuiEmptyPrompt,{iconType:"watchesApp","data-test-subj":"actionNeededEmptyPrompt",className:t,titleSize:"xs",title:Object(j.jsx)("h2",null,Object(j.jsx)(i.FormattedMessage,{id:"xpack.triggersActionsUI.components.healthCheck.apiKeysAndEncryptionErrorTitle",defaultMessage:"Additional setup required"})),body:Object(j.jsx)("div",{className:`${t}__body`},Object(j.jsx)("p",{role:"banner"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.apiKeysAndEncryptionError",{defaultMessage:"You must enable API keys and configure an encryption key to use Alerting. "}),Object(j.jsx)(o.EuiLink,{href:e.links.alerting.setupPrerequisites,external:!0,target:"_blank"},c.i18n.translate("xpack.triggersActionsUI.components.healthCheck.apiKeysAndEncryptionErrorAction",{defaultMessage:"Learn more."}))))})},142:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var n=s(11),r=s(60),a=s(15);const l=(e,t)=>{const{rule:s}=e;switch(t.command.type){case"setRule":{const{key:s,value:n}=t.payload;return"rule"===s?{...e,rule:n}:e}case"setProperty":{const{key:r,value:a}=t.payload;return Object(n.isEqual)(s[r],a)?e:{...e,rule:{...s,[r]:a}}}case"setScheduleProperty":{const{key:r,value:a}=t.payload;return s.schedule&&Object(n.isEqual)(s.schedule[r],a)?e:{...e,rule:{...s,schedule:{...s.schedule,[r]:a}}}}case"setRuleParams":{const{key:r,value:a}=t.payload;return Object(n.isEqual)(s.params[r],a)?e:{...e,rule:{...s,params:{...s.params,[r]:a}}}}case"setRuleActionParams":{const{key:r,value:a,index:l}=t.payload;if(void 0===l||null==s.actions[l]||s.actions[l][r]&&Object(n.isEqual)(s.actions[l][r],a))return e;{const t=s.actions.splice(l,1)[0],n={...t,params:{...t.params,[r]:a}};return s.actions.splice(l,0,n),{...e,rule:{...s,actions:[...s.actions]}}}}case"setRuleActionFrequency":{const{key:r,value:i,index:o}=t.payload;if(void 0===o||null==s.actions[o]||s.actions[o][r]&&Object(n.isEqual)(s.actions[o][r],i))return e;{var l;const t=s.actions.splice(o,1)[0],n={...t,frequency:{...null!==(l=t.frequency)&&void 0!==l?l:a.DEFAULT_FREQUENCY,[r]:i}};return s.actions.splice(o,0,n),{...e,rule:{...s,actions:[...s.actions]}}}}case"setRuleActionAlertsFilter":{const{key:a,value:l,index:i}=t.payload;if(void 0===i||null==s.actions[i]||s.actions[i][a]&&Object(n.isEqual)(s.actions[i][a],l))return e;{const t=s.actions.splice(i,1)[0],{alertsFilter:n,...o}=t,c={...n};l?c[a]=l:delete c[a];const u={...o,...Object(r.isEmpty)(c)?{}:{alertsFilter:c}};return s.actions.splice(i,0,u),{...e,rule:{...s,actions:[...s.actions]}}}}case"setRuleActionProperty":{const{key:r,value:a,index:l}=t.payload;if(void 0===l||Object(n.isEqual)(s.actions[l][r],a))return e;{const t={...s.actions.splice(l,1)[0],[r]:a};return s.actions.splice(l,0,t),{...e,rule:{...s,actions:[...s.actions]}}}}}}},156:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(157);case"v8light":return s(159)}},157:function(e,t,s){var n=s(50),r=s(158);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},158:function(e,t,s){(t=s(51)(!1)).push([e.i,".alertingFlyoutHealthCheck__body,.alertingHealthCheck__body{padding-left:32px;padding-right:32px}.alertingFlyoutHealthCheck__body{margin-top:16px}",""]),e.exports=t},159:function(e,t,s){var n=s(50),r=s(160);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},160:function(e,t,s){(t=s(51)(!1)).push([e.i,".alertingFlyoutHealthCheck__body,.alertingHealthCheck__body{padding-left:32px;padding-right:32px}.alertingFlyoutHealthCheck__body{margin-top:16px}",""]),e.exports=t},172:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return o})),s.d(t,"c",(function(){return u}));var n=s(11),r=s(2),a=s(12),l=s(96);function i(e,t,s){const n=t?t.validate(e.params).errors:[],i=function(e,t){const s={errors:{}},n={name:new Array,"schedule.interval":new Array,consumer:new Array,ruleTypeId:new Array,actionConnectors:new Array};s.errors=n,e.name||n.name.push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.requiredNameText",{defaultMessage:"Name is required."})),null===e.consumer&&n.consumer.push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.requiredConsumerText",{defaultMessage:"Scope is required."})),e.schedule.interval.length<2?n["schedule.interval"].push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.requiredIntervalText",{defaultMessage:"Check interval is required."})):t.minimumScheduleInterval&&t.minimumScheduleInterval.enforce&&Object(l.parseDuration)(e.schedule.interval)<Object(l.parseDuration)(t.minimumScheduleInterval.value)&&n["schedule.interval"].push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.belowMinimumText",{defaultMessage:"Interval must be at least {minimum}.",values:{minimum:Object(l.formatDuration)(t.minimumScheduleInterval.value,!0)}})),e.actions.filter((t=>{var s,n;if(null===(s=t.frequency)||void 0===s||!s.throttle)return!1;const r=Object(l.parseDuration)(t.frequency.throttle),i=e.schedule.interval&&e.schedule.interval.length>1?Object(l.parseDuration)(e.schedule.interval):0;return(null===(n=t.frequency)||void 0===n?void 0:n.notifyWhen)===a.RuleNotifyWhen.THROTTLE&&r<i})).length&&n["schedule.interval"].push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.actionThrottleBelowSchedule",{defaultMessage:"Custom action intervals cannot be shorter than the rule's check interval"})),e.ruleTypeId||n.ruleTypeId.push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.requiredRuleTypeIdText",{defaultMessage:"Rule type is required."}));const i=e.actions.find((e=>/^\d+$/.test(e.id)&&Object.keys(e.params).length>0));return void 0!==i&&n.actionConnectors.push(r.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.error.requiredActionConnector",{defaultMessage:"Action for {actionTypeId} connector is required.",values:{actionTypeId:i.actionTypeId}})),s}(e,s).errors;return{ruleParamsErrors:n,ruleBaseErrors:i,ruleErrors:{...n,...i}}}async function o(e,t){return await Promise.all(e.map((async e=>{var s;return(await(null===(s=t.get(e.actionTypeId))||void 0===s?void 0:s.validateParams(e.params))).errors})))}const c=e=>!!Object.values(e).find((e=>Object(n.isObject)(e)?c(e):e.length>=1));function u(e,t,s){return!c(t)&&s.every((e=>!c(e)))}},173:function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s(1);var n=s(3),r=s(26),a=s(2),l=s(0);const i=({onConfirm:e,onCancel:t})=>Object(l.jsx)(n.EuiConfirmModal,{title:a.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleClose.confirmRuleCloseTitle",{defaultMessage:"Discard unsaved changes to rule?"}),onCancel:t,onConfirm:e,buttonColor:"danger",confirmButtonText:a.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleClose.confirmRuleCloseConfirmButtonText",{defaultMessage:"Discard changes"}),cancelButtonText:a.i18n.translate("xpack.triggersActionsUI.sections.confirmRuleClose.confirmRuleCloseCancelButtonText",{defaultMessage:"Cancel"}),defaultFocusedButton:"confirm","data-test-subj":"confirmRuleCloseModal"},Object(l.jsx)("p",null,Object(l.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.confirmRuleClose.confirmRuleCloseMessage",defaultMessage:"You can't recover unsaved changes."})))},174:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return c}));var n=s(61),r=s.n(n),a=s(11);const l=["tags","schedule","actions"];function i(e){const{name:t,ruleTypeId:s,throttle:n,notifyWhen:r}=e;return{...t&&t.length>0?{name:t}:{},...s&&s.length>0?{ruleTypeId:s}:{},...n&&n.length>0?{throttle:n}:{},...r&&r.length>0?{notifyWhen:r}:{}}}function o(e,t,s){let n=r()(Object(a.pick)(e,l),Object(a.pick)(t,l));s&&(n=n&&r()(e.params,t.params));const o=r()(i(e),i(t));return!n||!o}function c(e,t){return!r()(e,t)}},177:function(e,t,s){"use strict";s.d(t,"a",(function(){return L}));var n=s(1),r=s.n(n),a=s(2),l=s(26),i=s(3),o=s(11),c=s(96),u=s(12),d=s(23),p=s(10),m=s(45),b=s(20),j=s(117),g=s(0);const h=({solutions:e,onChange:t})=>{const{euiTheme:s}=Object(i.useEuiTheme)(),[r,a]=Object(n.useState)([]),[o,c]=Object(n.useState)(!1);return Object(n.useEffect)((()=>{t&&t(r)}),[r]),Object(g.jsx)(i.EuiFilterGroup,null,Object(g.jsx)(i.EuiPopover,{isOpen:o,closePopover:()=>c(!1),button:Object(g.jsx)(i.EuiFilterButton,{iconType:"arrowDown",hasActiveFilters:r.length>0,numActiveFilters:r.length,numFilters:r.length,onClick:()=>c(!o),"data-test-subj":"solutionsFilterButton"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.solutionFilterLabel",defaultMessage:"Filter by use case"}))},Object(g.jsx)("div",{className:"eui-yScroll",css:Object(g.css)({maxHeight:30*s.base},"","")},[...e.entries()].map((([e,t])=>Object(g.jsx)(i.EuiFilterSelectItem,{key:e,onClick:()=>{const t=r.includes(e);a(t?r.filter((t=>t!==e)):[...r,e])},checked:r.includes(e)?"on":void 0,"data-test-subj":`solution${e}FilterOption`},t))))))};s(245);var y=s(30),x=s(6),f=s(171),O=s(15),v=s(56);const I=a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.selectLabel",{defaultMessage:"Role visibility"}),E={[p.ob.LOGS]:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.logs",{defaultMessage:"Logs"}),[p.ob.INFRASTRUCTURE]:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.infrastructure",{defaultMessage:"Metrics"}),[p.ob.APM]:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.apm",{defaultMessage:"APM and User Experience"}),[p.ob.UPTIME]:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.uptime",{defaultMessage:"Synthetics and Uptime"}),[p.ob.SLO]:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.slo",{defaultMessage:"SLOs"}),stackAlerts:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.stackAlerts",{defaultMessage:"Stack Rules"})},k=[p.ob.LOGS,p.ob.INFRASTRUCTURE,"stackAlerts"],T={asPlainText:!0},A=e=>{var t,s;const{consumers:r,errors:l,onChange:o,selectedConsumer:c,initialSelectedConsumer:u}=e,d=(null==l||null===(t=l.consumer)||void 0===t?void 0:t.length)>0,m=Object(n.useCallback)((e=>{if(e.length>0){const t=e[0];o(t.value)}else o(null)}),[o]),b=Object(n.useMemo)((()=>c&&r.includes(c)&&E[c]?c:null),[c,r]),j=Object(n.useMemo)((()=>b?[{value:b,label:E[b]}]:[]),[b]),h=Object(n.useMemo)((()=>r.reduce(((e,t)=>(E[t]&&e.push({value:t,"data-test-subj":t,label:E[t]}),e)),[]).sort(((e,t)=>e.value.localeCompare(t.value)))),[r]);return Object(n.useEffect)((()=>{if(!b){if(null===u)return;if(u&&r.includes(u))return void o(u);if(r.includes(p.vb))return void o(p.vb);o(r[0])}}),[]),Object(n.useEffect)((()=>{1===r.length?o(r[0]):r.includes(p.ob.OBSERVABILITY)&&o(p.ob.OBSERVABILITY)}),[r]),r.length<=1||r.includes(p.ob.OBSERVABILITY)?null:Object(g.jsx)(i.EuiFormRow,{fullWidth:!0,label:I,isInvalid:d,error:null!==(s=null==l?void 0:l.consumer)&&void 0!==s?s:""},Object(g.jsx)(i.EuiComboBox,{"data-test-subj":"ruleFormConsumerSelect","aria-label":a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.comboBox.ariaLabel",{defaultMessage:"Select a scope"}),placeholder:a.i18n.translate("xpack.triggersActionsUI.sections.ruleFormConsumerSelectionModal.comboBox.placeholder",{defaultMessage:"Select a scope"}),fullWidth:!0,singleSelection:T,options:h,selectedOptions:j,onChange:m}))};var F=s(205),C=s(54);const S=/^[1-9][0-9]*$/,M=()=>{};function R(e,t){var s;return null===(s=t.find((t=>t.id===e)))||void 0===s?void 0:s.name}const U=[],L=({rule:e,config:t,canChangeTrigger:s=!0,canShowConsumerSelection:I=!1,dispatch:E,errors:T,setHasActionsDisabled:L,setHasActionsWithBrokenConnector:w,setConsumer:P=M,selectedConsumer:N,operation:D,ruleTypeRegistry:z,actionTypeRegistry:q,metadata:B,filteredRuleTypes:G=U,hideGrouping:H=!1,hideInterval:W,connectorFeatureId:$=d.AlertingConnectorFeatureId,validConsumers:K,onChangeMetaData:V,useRuleProducer:Y,initialSelectedConsumer:J})=>{var Q,X,Z;const{notifications:{toasts:ee},docLinks:te,application:{capabilities:se},kibanaFeatures:ne,charts:re,data:ae,unifiedSearch:le,dataViews:ie}=Object(y.b)().services,oe=Object(j.f)(se),[ce,ue]=Object(n.useState)(null),de=Object(n.useRef)(null),pe=Object(F.a)(null===(Q=t.minimumScheduleInterval)||void 0===Q?void 0:Q.value),me=Object(c.getDurationNumberInItsUnit)(pe),be=Object(c.getDurationUnitValue)(pe),[je,ge]=Object(n.useState)(e.schedule.interval?Object(c.getDurationNumberInItsUnit)(e.schedule.interval):me),[he,ye]=Object(n.useState)(e.schedule.interval?Object(c.getDurationUnitValue)(e.schedule.interval):be),[xe,fe]=Object(n.useState)(void 0),[Oe,ve]=Object(n.useState)([]),[Ie,Ee]=Object(n.useState)([]),[ke,Te]=Object(n.useState)(),[Ae,Fe]=Object(n.useState)(),[Ce,Se]=Object(n.useState)(void 0),[Me,Re]=Object(n.useState)([]);let Ue=!1;const{ruleTypesState:{data:Le,error:_e,isLoading:we}}=Object(C.a)({filteredRuleTypes:G}),Pe=Object(n.useMemo)((()=>[...Le.values()]),[Le]);Object(n.useEffect)((()=>{e.ruleTypeId&&null!=Le&&Le.has(e.ruleTypeId)&&fe(Le.get(e.ruleTypeId).defaultActionGroupId);const t=(s=Pe,z.list().reduce(((e,t)=>{const n=s.find((e=>t.id===e.id));return n&&e.push({ruleType:n,ruleTypeModel:t}),e}),[]).filter((({ruleType:t})=>(({rule:e,ruleType:t,validConsumers:s})=>!!t&&(x.l.includes(t.id)?Array.isArray(s)?s.some((e=>Object(j.a)(e,t))):Object.entries(t.authorizedConsumers).some((([e,t])=>t.all)):Object(j.a)(e.consumer,t)))({rule:e,ruleType:t,validConsumers:K}))).filter((t=>e.consumer===u.ALERTS_FEATURE_ID?!t.ruleTypeModel.requiresAppContext:t.ruleType.producer===e.consumer)));var s;ve(t);const n=[...t.reduce(((e,t)=>{var s;return e.has(t.ruleType.producer)||e.set(t.ruleType.producer,null!==(s=ne?R(t.ruleType.producer,ne):Object(o.capitalize)(t.ruleType.producer))&&void 0!==s?s:Object(o.capitalize)(t.ruleType.producer)),e}),new Map).entries()];1===t.length&&t.every((e=>e.ruleType.producer===p.ob.OBSERVABILITY))||Se(new Map(n.sort((([,e],[,t])=>e.localeCompare(t)))))}),[Pe,Le,e.ruleTypeId,ne,e.consumer,z,K]),Object(n.useEffect)((()=>{_e&&ee.addDanger({title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.unableToLoadRuleTypesMessage",{defaultMessage:"Unable to load rule types"})})}),[_e,ee]),Object(n.useEffect)((()=>{ue(e.ruleTypeId?z.get(e.ruleTypeId):null),e.ruleTypeId&&Le&&Le.has(e.ruleTypeId)&&fe(Le.get(e.ruleTypeId).defaultActionGroupId)}),[e,e.ruleTypeId,Le,z]),Object(n.useEffect)((()=>{if(e.schedule.interval){const t=Object(c.getDurationNumberInItsUnit)(e.schedule.interval),s=Object(c.getDurationUnitValue)(e.schedule.interval);ge(t),ye(s)}}),[e.schedule.interval,me,be]),Object(n.useEffect)((()=>{de.current||(de.current=document.querySelector(".euiFlyoutBody__overflow"))}),[]);const Ne=Object(n.useCallback)((()=>{var e,t;return null==de||null===(e=de.current)||void 0===e||null===(t=e.scroll)||void 0===t?void 0:t.call(e,0,0)}),[]);Object(n.useEffect)((()=>{e.ruleTypeId&&Ne()}),[e.ruleTypeId,Ne]);const De=Object(n.useCallback)(((e,t)=>{E({command:{type:"setProperty"},payload:{key:e,value:t}})}),[E]),ze=Object(n.useCallback)((e=>De("actions",e)),[De]),qe=(e,t)=>{E({command:{type:"setScheduleProperty"},payload:{key:e,value:t}})},Be=(e,t,s)=>{E({command:{type:"setRuleActionProperty"},payload:{key:e,value:t,index:s}})},Ge=Object(n.useCallback)(((e,t,s)=>{E({command:{type:"setRuleActionParams"},payload:{key:e,value:t,index:s}})}),[E]),He=Object(n.useCallback)(((e,t,s)=>{E({command:{type:"setRuleActionFrequency"},payload:{key:e,value:t,index:s}})}),[E]),We=Object(n.useCallback)(((e,t,s)=>{E({command:{type:"setRuleActionAlertsFilter"},payload:{key:e,value:t,index:s}})}),[E]);Object(n.useEffect)((()=>{const e=ke?ke.trim().toLocaleLowerCase():null;Ee(Oe.filter((e=>Me.length>0?Me.find((t=>e.ruleType.producer===t)):e)).filter((t=>e?t.ruleType.name.toString().toLocaleLowerCase().includes(e)||t.ruleType.producer.toLocaleLowerCase().includes(e)||t.ruleTypeModel.description.toLocaleLowerCase().includes(e):t)))}),[z,Oe,ke,JSON.stringify(Me)]),Object(n.useEffect)((()=>{if(ce){const e=Pe.find((e=>e.id===ce.id));e&&Y&&!x.l.includes(e.id)&&P(e.producer)}}),[ce,Pe]);const $e=Object(n.useMemo)((()=>{var t;if(e.consumer!==u.ALERTS_FEATURE_ID)return[];const s=Oe.find((({ruleType:t})=>t.id===e.ruleTypeId));return null!=s&&null!==(t=s.ruleType)&&void 0!==t&&t.authorizedConsumers?Object.entries(s.ruleType.authorizedConsumers).reduce(((e,[t,s])=>(s.all&&(K||k).includes(t)&&e.push(t),e)),[]):[]}),[Oe,e,K]),Ke=Object(n.useMemo)((()=>!!I&&!!$e.length&&!!e.ruleTypeId&&x.l.includes(e.ruleTypeId)),[$e,e,I]),Ve=null!=e&&e.ruleTypeId?null==Le?void 0:Le.get(null==e?void 0:e.ruleTypeId):void 0,Ye=null==Ve||null===(X=Ve.recoveryActionGroup)||void 0===X?void 0:X.id,Je=e.tags?e.tags.map((e=>({label:e}))):[],Qe=Object(n.useCallback)(((e,t,s)=>{var n;return Object(u.isActionGroupDisabledForActionTypeId)(t===(null==e||null===(n=e.recoveryActionGroup)||void 0===n?void 0:n.id)?u.RecoveredActionGroup.id:t,s)}),[]),Xe=ce?ce.ruleParamsExpression:null,Ze=Ie.reduce(((e,t)=>{const s=t.ruleType.producer;if(s){const n=Object(f.a)(t.ruleType);n.isEnabled||(Ue=!0),(e[s]=e[s]||[]).push({name:t.ruleType.name,id:t.ruleTypeModel.id,checkEnabledResult:n,ruleTypeItem:t.ruleTypeModel})}return e}),{}),et=H?Object.entries(Ze).sort(((e,t)=>function(e,t,s){const n=e[1],r=t[1],a=void 0!==n.find((e=>e.checkEnabledResult.isEnabled)),l=void 0!==r.find((e=>e.checkEnabledResult.isEnabled));return a&&!l?-1:!a&&l?1:s?s.findIndex((e=>n.some((t=>t.id===e))))-s.findIndex((e=>r.some((t=>t.id===e)))):0}(e,t,G))):Object.entries(Ze).sort(((e,t)=>function(e,t,s){const n=e[0],r=t[0],a=e[1],l=t[1],i=void 0!==a.find((e=>e.checkEnabledResult.isEnabled)),o=void 0!==l.find((e=>e.checkEnabledResult.isEnabled));return i&&!o?-1:!i&&o?1:s?s.get(n).localeCompare(s.get(r)):n.localeCompare(r)}(e,t,Ce))),tt=et.map((([e,t],s)=>{var a;return Object(g.jsx)(n.Fragment,{key:`group${s}`},!H&&Object(g.jsx)(r.a.Fragment,null,Object(g.jsx)(i.EuiFlexGroup,{gutterSize:"none",alignItems:"center",className:"triggersActionsUI__ruleTypeNodeHeading"},Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiTitle,{"data-test-subj":`ruleType${s}Group`,size:"xxxs",textTransform:"uppercase"},Object(g.jsx)(i.EuiTextColor,{color:"subdued"},null!==(a=ne?R(e,ne):Object(o.capitalize)(e))&&void 0!==a?a:Object(o.capitalize)(e)))),Object(g.jsx)(i.EuiFlexItem,{grow:!1},Object(g.jsx)(i.EuiNotificationBadge,{color:"subdued"},t.length))),Object(g.jsx)(i.EuiHorizontalRule,{size:"full",margin:"xs"})),Object(g.jsx)(i.EuiListGroup,{flush:!0,gutterSize:"m",size:"m",maxWidth:!1},t.sort(((e,t)=>function(e,t){return!0===e.checkEnabledResult.isEnabled&&!1===t.checkEnabledResult.isEnabled?-1:!1===e.checkEnabledResult.isEnabled&&!0===t.checkEnabledResult.isEnabled?1:e.name.localeCompare(t.name)}(e,t))).map(((t,s)=>{const n=Object(g.jsx)("span",null,Object(g.jsx)("strong",null,t.name),Object(g.jsx)(i.EuiText,{color:"subdued",size:"s"},Object(g.jsx)("p",null,t.ruleTypeItem.description)));return Object(g.jsx)(i.EuiListGroupItem,{wrapText:!0,key:s,"data-test-subj":`${t.id}-SelectOption`,color:"primary",label:t.checkEnabledResult.isEnabled?n:Object(g.jsx)(i.EuiToolTip,{position:"top","data-test-subj":`${t.id}-disabledTooltip`,content:t.checkEnabledResult.message},n),isDisabled:!t.checkEnabledResult.isEnabled,onClick:()=>{De("ruleTypeId",t.id),ue(t.ruleTypeItem),ze([]),De("params",{}),Le&&Le.has(t.id)&&fe(Le.get(t.id).defaultActionGroupId),Y&&!x.l.includes(t.id)&&P(e)}})}))),Object(g.jsx)(i.EuiSpacer,{size:"m"}))})),st=[a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.checkFieldLabel",{defaultMessage:"Check every"}),Object(g.jsx)(i.EuiIconTip,{position:"right",type:"questionInCircle",content:a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.checkWithTooltip",{defaultMessage:"Define how often to evaluate the condition. Checks are queued; they run as close to the defined value as capacity allows."})})],nt=Object(n.useMemo)((()=>{var t;const s=!!Ve&&(Ve.hasFieldsForAAD||Ve.producer===p.ob.SIEM||Ve.hasAlertsMappings);return x.l.includes(null!==(t=null==e?void 0:e.ruleTypeId)&&void 0!==t?t:"")?(K||k).includes(N)&&s:s}),[null==e?void 0:e.ruleTypeId,N,Ve,K]),rt=Object(g.jsx)(r.a.Fragment,null,Object(g.jsx)(i.EuiHorizontalRule,null),Object(g.jsx)(i.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiTitle,{size:"s","data-test-subj":"selectedRuleTypeTitle"},Object(g.jsx)("h5",{id:"selectedRuleTypeTitle"},e.ruleTypeId&&Le&&Le.has(e.ruleTypeId)?Le.get(e.ruleTypeId).name:""))),s?Object(g.jsx)(i.EuiFlexItem,{grow:!1},Object(g.jsx)(i.EuiButtonIcon,{iconType:"cross",color:"danger","aria-label":a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.changeRuleTypeAriaLabel",{defaultMessage:"Delete"}),onClick:()=>{De("ruleTypeId",null),ue(null),De("params",{})}})):null),(null==ce?void 0:ce.description)&&Object(g.jsx)(i.EuiFlexGroup,null,Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiText,{color:"subdued",size:"s","data-test-subj":"ruleDescription"},ce.description," ",(null==ce?void 0:ce.documentationUrl)&&Object(g.jsx)(i.EuiLink,{external:!0,target:"_blank","data-test-subj":"ruleDocumentationLink",href:"function"==typeof ce.documentationUrl?ce.documentationUrl(te):ce.documentationUrl},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.documentationLabel",defaultMessage:"Learn more"}))))),Object(g.jsx)(i.EuiHorizontalRule,null),Xe&&xe&&e.ruleTypeId&&Ve?Object(g.jsx)(i.EuiErrorBoundary,null,Object(g.jsx)(n.Suspense,{fallback:Object(g.jsx)(v.a,null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.loadingRuleTypeParamsDescription",defaultMessage:"Loading rule type params…"}))},Object(g.jsx)(Xe,{id:e.id,ruleParams:e.params,ruleInterval:`${null!=je?je:1}${he}`,ruleThrottle:"",alertNotifyWhen:null!==(Z=e.notifyWhen)&&void 0!==Z?Z:"onActionGroupChange",errors:T,setRuleParams:(e,t)=>{E({command:{type:"setRuleParams"},payload:{key:e,value:t}})},setRuleProperty:De,defaultActionGroupId:xe,actionGroups:Ve.actionGroups,metadata:B,charts:re,data:ae,dataViews:ie,unifiedSearch:le,onChangeMetaData:V}))):null,!0!==W&&Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiFormRow,{fullWidth:!0,"data-test-subj":"intervalFormRow",display:"rowCompressed",helpText:t&&t.minimumScheduleInterval?T["schedule.interval"].length>0?"":t.minimumScheduleInterval.enforce?a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.checkEveryHelpText",{defaultMessage:"Interval must be at least {minimum}.",values:{minimum:Object(c.formatDuration)(t.minimumScheduleInterval.value,!0)}}):e.schedule.interval&&Object(c.parseDuration)(e.schedule.interval)<Object(c.parseDuration)(t.minimumScheduleInterval.value)?a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.checkEveryHelpSuggestionText",{defaultMessage:"Intervals less than {minimum} are not recommended due to performance considerations.",values:{minimum:Object(c.formatDuration)(t.minimumScheduleInterval.value,!0)}}):"":"",isInvalid:T["schedule.interval"].length>0,error:T["schedule.interval"]},Object(g.jsx)(i.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(i.EuiFlexItem,{grow:2},Object(g.jsx)(i.EuiFieldNumber,{prepend:st,fullWidth:!0,min:1,isInvalid:T["schedule.interval"].length>0,value:je||"",name:"interval","data-test-subj":"intervalInput",onChange:e=>{const t=e.target.value;if(""===t||S.test(t)){const e=""===t?"":parseInt(t,10);ge(e||void 0),qe("interval",`${e}${he}`)}}})),Object(g.jsx)(i.EuiFlexItem,{grow:3},Object(g.jsx)(i.EuiSelect,{fullWidth:!0,value:he,options:Object(m.b)(null!=je?je:1),onChange:e=>{ye(e.target.value),qe("interval",`${je}${e.target.value}`)},"data-test-subj":"intervalInputUnit"}))))),Ke&&Object(g.jsx)(r.a.Fragment,null,Object(g.jsx)(i.EuiSpacer,{size:"m"}),Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(A,{consumers:$e,onChange:P,errors:T,selectedConsumer:N,initialSelectedConsumer:J}))),Object(g.jsx)(i.EuiSpacer,{size:"l"}),oe&&xe&&ce&&e.ruleTypeId&&Ve?Object(g.jsx)(r.a.Fragment,null,T.actionConnectors.length>=1?Object(g.jsx)(r.a.Fragment,null,Object(g.jsx)(i.EuiSpacer,null),Object(g.jsx)(i.EuiCallOut,{color:"danger",size:"s",title:T.actionConnectors}),Object(g.jsx)(i.EuiSpacer,null)):null,Object(g.jsx)(i.EuiSpacer,{size:"m"}),Object(g.jsx)(b.a,{actions:e.actions,setHasActionsDisabled:L,setHasActionsWithBrokenConnector:w,messageVariables:Ve.actionVariables,defaultActionGroupId:xe,hasAlertsMappings:Ve.hasAlertsMappings,featureId:$,producerId:x.l.includes(e.ruleTypeId)?null!=N?N:e.consumer:Ve.producer,hasFieldsForAAD:nt,ruleTypeId:e.ruleTypeId,isActionGroupDisabledForActionType:(e,t)=>Qe(Ve,e,t),actionGroups:Ve.actionGroups.map((e=>e.id===Ve.recoveryActionGroup.id?{...e,omitMessageVariables:Ve.doesSetRecoveryContext?"keepContext":"all",defaultActionMessage:(null==ce?void 0:ce.defaultRecoveryMessage)||x.r}:{...e,defaultActionMessage:null==ce?void 0:ce.defaultActionMessage})),recoveryActionGroup:Ye,setActionUseAlertDataForTemplate:(e,t)=>{Be("useAlertDataForTemplate",e,t)},setActionIdByIndex:(e,t)=>Be("id",e,t),setActionGroupIdByIndex:(e,t)=>Be("group",e,t),setActions:ze,setActionParamsProperty:Ge,actionTypeRegistry:q,setActionFrequencyProperty:He,setActionAlertsFilterProperty:We,defaultSummaryMessage:(null==ce?void 0:ce.defaultSummaryMessage)||x.x,minimumThrottleInterval:[je,he]})):null);return Object(g.jsx)(i.EuiForm,null,Object(g.jsx)(i.EuiFlexGrid,{columns:1},Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiFormRow,{fullWidth:!0,id:"ruleName",label:Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.ruleNameLabel",defaultMessage:"Name"}),isInvalid:T.name.length>0&&void 0!==e.name,error:T.name},Object(g.jsx)(i.EuiFieldText,{fullWidth:!0,autoFocus:!0,isInvalid:T.name.length>0&&void 0!==e.name,name:"name","data-test-subj":"ruleNameInput",value:e.name||"",onChange:e=>{De("name",e.target.value)},onBlur:()=>{e.name||De("name","")}}))),Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiFormRow,{fullWidth:!0,label:a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.tagsFieldLabel",{defaultMessage:"Tags"}),labelAppend:Object(g.jsx)(i.EuiText,{color:"subdued",size:"xs"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.tagsFieldOptional",defaultMessage:"Optional"}))},Object(g.jsx)(i.EuiComboBox,{noSuggestions:!0,fullWidth:!0,"data-test-subj":"tagsComboBox",selectedOptions:Je,onCreateOption:e=>{const t=[...Je,{label:e}];De("tags",t.map((e=>e.label)))},onChange:e=>{De("tags",e.map((e=>e.label)))},onBlur:()=>{e.tags||De("tags",[])}})))),Object(g.jsx)(i.EuiSpacer,{size:"m"}),Object(g.jsx)("div",{"data-test-subj":"ruleGroupTypeSelectContainer"},ce?Object(g.jsx)(r.a.Fragment,null,rt):Oe.length?Object(g.jsx)(r.a.Fragment,null,Object(g.jsx)(i.EuiHorizontalRule,null),Object(g.jsx)(i.EuiFormRow,{fullWidth:!0,labelAppend:Ue&&Object(g.jsx)(i.EuiTitle,{size:"xxs"},Object(g.jsx)(i.EuiLink,{href:O.VIEW_LICENSE_OPTIONS_LINK,target:"_blank",external:!0,className:"actActionForm__getMoreActionsLink"},Object(g.jsx)(l.FormattedMessage,{defaultMessage:"Get more rule types",id:"xpack.triggersActionsUI.sections.actionForm.getMoreRuleTypesTitle"}))),label:Object(g.jsx)(i.EuiTitle,{size:"xxs"},Object(g.jsx)("h5",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.ruleTypeSelectLabel",defaultMessage:"Select rule type"})))},Object(g.jsx)(i.EuiFlexGroup,{gutterSize:"s"},Object(g.jsx)(i.EuiFlexItem,null,Object(g.jsx)(i.EuiFieldSearch,{fullWidth:!0,"data-test-subj":"ruleSearchField",onChange:e=>{Fe(e.target.value),""===e.target.value&&Te("")},onKeyUp:e=>{13===e.keyCode&&Te(Ae)},placeholder:a.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.searchPlaceholderTitle",{defaultMessage:"Search"})})),Ce?Object(g.jsx)(i.EuiFlexItem,{grow:!1},Object(g.jsx)(h,{key:"solution-filter",solutions:Ce,onChange:e=>Re(e)})):null)),Object(g.jsx)(i.EuiSpacer,null),T.ruleTypeId.length>=1&&void 0!==e.ruleTypeId?Object(g.jsx)(r.a.Fragment,null,Object(g.jsx)(i.EuiSpacer,null),Object(g.jsx)(i.EuiCallOut,{color:"danger",size:"s",title:T.ruleTypeId}),Object(g.jsx)(i.EuiSpacer,null)):null,tt):Le&&!we?Object(g.jsx)(_,{operation:D}):Object(g.jsx)(v.a,null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.loadingRuleTypesDescription",defaultMessage:"Loading rule types…"}))))},_=({operation:e})=>Object(g.jsx)(i.EuiEmptyPrompt,{iconType:"lock","data-test-subj":"noAuthorizedRuleTypesPrompt",titleSize:"xs",title:Object(g.jsx)("h2",null,Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.error.noAuthorizedRuleTypesTitle",defaultMessage:"You have not been authorized to {operation} any rule types",values:{operation:e}})),body:Object(g.jsx)("div",null,Object(g.jsx)("p",{role:"banner"},Object(g.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.error.noAuthorizedRuleTypes",defaultMessage:"In order to {operation} a Rule you need to have been granted the appropriate privileges.",values:{operation:e}})))})},205:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(12),r=s(6);function a(e){return e&&Object(n.parseDuration)(e)>Object(n.parseDuration)(r.e)?e:r.e}},245:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(246);case"v8light":return s(248)}},246:function(e,t,s){var n=s(50),r=s(247);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},247:function(e,t,s){(t=s(51)(!1)).push([e.i,".triggersActionsUI__ruleTypeNodeHeading{margin-left:8px;margin-right:8px}",""]),e.exports=t},248:function(e,t,s){var n=s(50),r=s(249);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);n(r,{insert:"head",singleton:!1}),e.exports=r.locals||{}},249:function(e,t,s){(t=s(51)(!1)).push([e.i,".triggersActionsUI__ruleTypeNodeHeading{margin-left:8px;margin-right:8px}",""]),e.exports=t}}]);