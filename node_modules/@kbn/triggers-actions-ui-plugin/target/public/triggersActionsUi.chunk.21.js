/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[21,48],{101:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleStatusPanel",(function(){return g})),s.d(t,"default",(function(){return p}));var a=s(2),n=s(1),i=s(32),r=s.n(i),l=s(26),u=s(3),o=s(8),c=s(120),d=s(91),b=s(145),j=s(0);const g=({rule:e,bulkEnableRules:t,bulkDisableRules:s,snoozeRule:i,unsnoozeRule:c,requestRefresh:g,isEditable:p,healthColor:x,statusMessage:O,refreshToken:f})=>{const[m,h]=Object(n.useState)(null),y=Object(n.useRef)(!1),E=Object(n.useCallback)((t=>i(e,t)),[e,i]),v=Object(n.useCallback)((t=>c(e,t)),[e,c]),T=Object(n.useMemo)((()=>{var t;return O||Object(j.jsx)(u.EuiStat,{titleSize:"xs",title:"--",description:"",isLoading:!(null!==(t=e.lastRun)&&void 0!==t&&t.outcome||e.nextRun)})}),[e,O]),{data:w,loadEventLogs:k}=Object(b.a)({id:e.id,dateStart:"now-24h",dateEnd:"now",page:0,perPage:10});Object(n.useEffect)((()=>{w&&h(w.total)}),[w]);const I=Object(n.useCallback)((()=>{k(),g()}),[g,k]);return Object(n.useEffect)((()=>{y.current&&k(),y.current=!0}),[f]),Object(j.jsx)(u.EuiPanel,{"data-test-subj":"ruleStatusPanel",hasBorder:!0,paddingSize:"none"},Object(j.jsx)(u.EuiPanel,{hasShadow:!1},Object(j.jsx)(u.EuiFlexGroup,{justifyContent:"flexStart"},Object(j.jsx)(u.EuiFlexItem,{grow:!1},Object(j.jsx)(u.EuiTitle,{size:"xxs"},Object(j.jsx)("h5",null,Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.statusPanel.ruleIsEnabledDisabledTitle",defaultMessage:"Rule is"})))),Object(j.jsx)(u.EuiFlexItem,null,Object(j.jsx)(o.h,{disableRule:()=>s({ids:[e.id]}),enableRule:()=>t({ids:[e.id]}),snoozeRule:async()=>{},unsnoozeRule:async()=>{},rule:e,onRuleChanged:I,direction:"row",isEditable:p,hideSnoozeOption:!0}))),Object(j.jsx)(u.EuiSpacer,{size:"s"}),Object(j.jsx)(u.EuiText,{size:"s",color:"subdued","data-test-subj":"ruleStatus-numberOfExecutions"},null!==m&&Object(j.jsx)(l.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.rule.statusPanel.totalExecutions",defaultMessage:"{executions, plural, one {# execution} other {# executions}} in the last 24 hr",values:{executions:m}}))),Object(j.jsx)(u.EuiHorizontalRule,{margin:"none"}),Object(j.jsx)(u.EuiPanel,{hasShadow:!1},Object(j.jsx)(u.EuiFlexGroup,{gutterSize:"none",direction:"row",responsive:!1},Object(j.jsx)(u.EuiFlexItem,null,Object(j.jsx)(u.EuiStat,{"data-test-subj":`ruleStatus-${e.executionStatus.status}`,titleSize:"m",descriptionElement:"strong",titleElement:"h5",title:Object(j.jsx)(u.EuiHealth,{"data-test-subj":`ruleStatus-${e.executionStatus.status}`,textSize:"m",color:x,style:{fontWeight:400}},T),description:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rulesList.ruleLastExecutionDescription",{defaultMessage:"Last response"})})),Object(j.jsx)(u.EuiFlexItem,{grow:!1},Object(j.jsx)(u.EuiSpacer,{size:"xs"}),Object(j.jsx)(u.EuiText,{color:"subdued",size:"xs"},r()(e.executionStatus.lastExecutionDate).fromNow())))),Object(j.jsx)(u.EuiHorizontalRule,{margin:"none"}),Object(j.jsx)(u.EuiPanel,{hasShadow:!1},Object(j.jsx)(d.RulesListNotifyBadge,{snoozeSettings:e,loading:!e,disabled:!p,onRuleChanged:I,snoozeRule:E,unsnoozeRule:v,showTooltipInline:!0})))},p=Object(c.a)(g)},121:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(6);const n=({decryption_health:e,execution_health:t,read_health:s,...a})=>({decryptionHealth:e,executionHealth:t,readHealth:s,...a}),i=({is_sufficiently_secure:e,has_permanent_encryption_key:t,alerting_framework_health:s,...a})=>({isSufficientlySecure:e,hasPermanentEncryptionKey:t,alertingFrameworkHealth:s,...a});async function r({http:e}){const t=await e.get(`${a.b}/_health`),s=n(t.alerting_framework_health);return{...i(t),alertingFrameworkHealth:s}}},142:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s(11),n=s(60),i=s(15);const r=(e,t)=>{const{rule:s}=e;switch(t.command.type){case"setRule":{const{key:s,value:a}=t.payload;return"rule"===s?{...e,rule:a}:e}case"setProperty":{const{key:n,value:i}=t.payload;return Object(a.isEqual)(s[n],i)?e:{...e,rule:{...s,[n]:i}}}case"setScheduleProperty":{const{key:n,value:i}=t.payload;return s.schedule&&Object(a.isEqual)(s.schedule[n],i)?e:{...e,rule:{...s,schedule:{...s.schedule,[n]:i}}}}case"setRuleParams":{const{key:n,value:i}=t.payload;return Object(a.isEqual)(s.params[n],i)?e:{...e,rule:{...s,params:{...s.params,[n]:i}}}}case"setRuleActionParams":{const{key:n,value:i,index:r}=t.payload;if(void 0===r||null==s.actions[r]||s.actions[r][n]&&Object(a.isEqual)(s.actions[r][n],i))return e;{const t=s.actions.splice(r,1)[0],a={...t,params:{...t.params,[n]:i}};return s.actions.splice(r,0,a),{...e,rule:{...s,actions:[...s.actions]}}}}case"setRuleActionFrequency":{const{key:n,value:l,index:u}=t.payload;if(void 0===u||null==s.actions[u]||s.actions[u][n]&&Object(a.isEqual)(s.actions[u][n],l))return e;{var r;const t=s.actions.splice(u,1)[0],a={...t,frequency:{...null!==(r=t.frequency)&&void 0!==r?r:i.DEFAULT_FREQUENCY,[n]:l}};return s.actions.splice(u,0,a),{...e,rule:{...s,actions:[...s.actions]}}}}case"setRuleActionAlertsFilter":{const{key:i,value:r,index:l}=t.payload;if(void 0===l||null==s.actions[l]||s.actions[l][i]&&Object(a.isEqual)(s.actions[l][i],r))return e;{const t=s.actions.splice(l,1)[0],{alertsFilter:a,...u}=t,o={...a};r?o[i]=r:delete o[i];const c={...u,...Object(n.isEmpty)(o)?{}:{alertsFilter:o}};return s.actions.splice(l,0,c),{...e,rule:{...s,actions:[...s.actions]}}}}case"setRuleActionProperty":{const{key:n,value:i,index:r}=t.payload;if(void 0===r||Object(a.isEqual)(s.actions[r][n],i))return e;{const t={...s.actions.splice(r,1)[0],[n]:i};return s.actions.splice(r,0,t),{...e,rule:{...s,actions:[...s.actions]}}}}}}},145:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var a=s(1),n=s(5),i=s(53),r=s.n(i),l=s(30),u=s(126);const o=e=>{var t;return e.includes("now")&&(null===(t=r.a.parse(e))||void 0===t?void 0:t.format())||e},c=e=>"*"===e.id;function d(e){const{http:t}=Object(l.b)().services,s=Object(a.useCallback)((()=>c(e)?Object(u.b)({http:t,...e,dateStart:o(e.dateStart),...e.dateEnd?{dateEnd:o(e.dateEnd)}:{}}):Object(u.a)({http:t,...e,dateStart:o(e.dateStart),...e.dateEnd?{dateEnd:o(e.dateEnd)}:{}})),[e,t]),{data:i,error:r,isLoading:d,isFetching:b,refetch:j}=Object(n.useQuery)({queryKey:["loadRuleEventLog",e],queryFn:s,onError:e.onError,retry:0,refetchOnWindowFocus:!1}),g=Object(a.useMemo)((()=>r&&413===r.body.statusCode),[r]);return Object(a.useMemo)((()=>({data:i,hasExceedLogs:g,isLoading:d||b,loadEventLogs:j})),[i,g,b,d,j])}},146:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s(2),n=s(6);const i=(e,t=!1)=>{switch(e){case"logs":return{text:a.i18n.translate("xpack.triggersActionsUI.logs.breadcrumbTitle",{defaultMessage:"Logs"}),...t?{href:`${n.v}`}:{}};case"connectors":return{text:a.i18n.translate("xpack.triggersActionsUI.connectors.breadcrumbTitle",{defaultMessage:"Connectors"}),...t?{href:`${n.s}`}:{}};case"rules":return{text:a.i18n.translate("xpack.triggersActionsUI.rules.breadcrumbTitle",{defaultMessage:"Rules"}),...t?{href:`${n.w}`}:{}};default:return{text:a.i18n.translate("xpack.triggersActionsUI.home.breadcrumbTitle",{defaultMessage:"Rules"}),...t?{href:`${n.t}`}:{}}}}},147:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var a=s(2);const n=e=>{let t;switch(e){case"logs":t=a.i18n.translate("xpack.triggersActionsUI.logs.breadcrumbTitle",{defaultMessage:"Logs"});break;case"connectors":t=a.i18n.translate("xpack.triggersActionsUI.connectors.breadcrumbTitle",{defaultMessage:"Connectors"});break;case"rules":t=a.i18n.translate("xpack.triggersActionsUI.rules.breadcrumbTitle",{defaultMessage:"Rules"});break;default:t=a.i18n.translate("xpack.triggersActionsUI.home.breadcrumbTitle",{defaultMessage:"Rules"})}return t}},179:function(e,t,s){"use strict";s.d(t,"a",(function(){return j}));var a=s(13),n=s.n(a),i=(s(1),s(22)),r=s(6),l=s(118);const u=({http:e,outcomeFilter:t,message:s,dateStart:a,dateEnd:n,namespaces:i})=>{const u=Object(l.a)({outcomeFilter:t,message:s});return e.post(`${r.i}/_global_connector_execution_kpi`,{body:JSON.stringify({filter:u.length?u.join(" and "):void 0,date_start:a,date_end:n,namespaces:i?JSON.stringify(i):i})})};var o=s(23);const c=async({http:e,dateStart:t,dateEnd:s,outcomeFilter:a,message:n,perPage:i=10,page:r=0,sort:u=[],namespaces:c})=>{const d=u,b=Object(l.a)({outcomeFilter:a,message:n});return(({data:e,...t})=>({data:e.map((e=>(e=>{const{duration_ms:t,schedule_delay_ms:s,...a}=e;return{execution_duration:e.duration_ms,schedule_delay:e.schedule_delay_ms,...a}})(e))),...t}))(await e.post(`${o.INTERNAL_BASE_ACTION_API_PATH}/_global_connector_execution_logs`,{body:JSON.stringify({date_start:t,date_end:s,filter:b.length?b.join(" and "):void 0,per_page:i,page:r+1,sort:d.length?JSON.stringify(d):void 0,namespaces:c?JSON.stringify(c):void 0})}))};var d=s(30),b=s(0);function j(e){return t=>{const{http:s}=Object(d.b)().services;return Object(b.jsx)(e,n()({},t,{loadActionTypes:async()=>Object(i.d)({http:s}),loadGlobalConnectorExecutionLogAggregations:async e=>c({...e,http:s}),loadGlobalConnectorExecutionKPIAggregations:async e=>u({...e,http:s})}))}}},302:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(303);case"v8light":return s(305)}},303:function(e,t,s){var a=s(50),n=s(304);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},304:function(e,t,s){(t=s(51)(!1)).push([e.i,".ruleActionsPopover__deleteButton{color:#f86b63}",""]),e.exports=t},305:function(e,t,s){var a=s(50),n=s(306);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},306:function(e,t,s){(t=s(51)(!1)).push([e.i,".ruleActionsPopover__deleteButton{color:#bd271e}",""]),e.exports=t},307:function(e,t,s){switch(window.__kbnThemeTag__){case"v8dark":return s(308);case"v8light":return s(310)}},308:function(e,t,s){var a=s(50),n=s(309);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},309:function(e,t,s){(t=s(51)(!1)).push([e.i,".rulesList__health{width:100%}.rulesList__health .euiFlexItem:last-of-type{max-width:100%;min-width:0;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;width:85%}.ruleDurationWarningIcon{bottom:4px;position:relative}",""]),e.exports=t},310:function(e,t,s){var a=s(50),n=s(311);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},311:function(e,t,s){(t=s(51)(!1)).push([e.i,".rulesList__health{width:100%}.rulesList__health .euiFlexItem:last-of-type{max-width:100%;min-width:0;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;width:85%}.ruleDurationWarningIcon{bottom:4px;position:relative}",""]),e.exports=t},324:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleDetailsRoute",(function(){return Y})),s.d(t,"getRuleData",(function(){return X})),s.d(t,"default",(function(){return Z}));var a=s(2),n=s(1),i=s.n(n),r=s(3),l=s(89),u=s(26),o=s(21),c=s(12),d=s(10),b=s(228),j=s(226),g=s(227),p=(s(302),s(0));const x=({rule:e,canSaveRule:t,onDelete:s,onApiKeyUpdate:i,onEnableDisable:l,onRunRule:u})=>{const[o,c]=Object(n.useState)(!1);return Object(p.jsx)(r.EuiPopover,{button:Object(p.jsx)(r.EuiButtonEmpty,{disabled:!1,"data-test-subj":"ruleActionsButton","data-testid":"ruleActionsButton",iconType:"boxesHorizontal",onClick:()=>c(!o),"aria-label":a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.popoverButtonTitle",{defaultMessage:"Actions"})}),isOpen:o,closePopover:()=>c(!1),ownFocus:!0,panelPaddingSize:"none"},Object(p.jsx)(r.EuiContextMenu,{initialPanelId:0,panels:[{id:0,items:[{disabled:!t,"data-test-subj":"disableButton",onClick:async()=>{c(!1),l(!e.enabled)},name:e.enabled?a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.disableRuleButtonLabel",{defaultMessage:"Disable"}):a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.enableRuleButtonLabel",{defaultMessage:"Enable"})},{disabled:!t,"data-test-subj":"updateAPIKeyButton",onClick:()=>{c(!1),i(e.id)},name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.updateAPIKeyButtonLabel",{defaultMessage:"Update API key"})},{disabled:!t,"data-test-subj":"runRuleButton",onClick:()=>{c(!1),u(e.id)},name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.runRuleButtonLabel",{defaultMessage:"Run rule"})},{disabled:!t,className:"ruleActionsPopover__deleteButton","data-test-subj":"deleteRuleButton",onClick:()=>{c(!1),s(e.id)},name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.deleteRuleButtonLabel",{defaultMessage:"Delete rule"})}]}],className:"ruleActionsPopover","data-test-subj":"ruleActionsPopover","data-testid":"ruleActionsPopover"}))};var O=s(117),f=s(146),m=s(147),h=s(120),y=s(30),E=(s(307),s(33)),v=s(4),T=s(31),w=s(101),k=s(119);const I=Object(n.lazy)((()=>Promise.all([s.e(2),s.e(5),s.e(7),s.e(41)]).then(s.bind(null,107)))),S=Object(n.lazy)((()=>s.e(31).then(s.bind(null,343)))),R=Object(n.lazy)((()=>s.e(42).then(s.bind(null,108)))),A=Object(h.a)((function({rule:e,ruleType:t,readOnly:s,ruleSummary:n,muteAlertInstance:l,unmuteAlertInstance:u,requestRefresh:o,refreshToken:c,numberOfExecutions:d,onChangeDuration:b,durationEpoch:j=Date.now(),isLoadingChart:g}){const{ruleTypeRegistry:x,actionTypeRegistry:O}=Object(y.b)().services,f=Object.entries(n.alerts).map((([e,t])=>function(e,t,s){const a=!(null==s||!s.muted),n=s.status,i=null!=s&&s.activeStartDate?new Date(s.activeStartDate):void 0,r=i?e-i.valueOf():0,l=function(e){switch(e){case"Active":return 0;case"OK":return 1}return 2}(null==s?void 0:s.status),u=!(null==s||!s.tracked);return{alert:t,status:n,start:i,duration:r,isMuted:a,sortPriority:l,flapping:s.flapping,tracked:u,...s.maintenanceWindowIds?{maintenanceWindowIds:s.maintenanceWindowIds}:{}}}(j,e,t))).sort(((e,t)=>e.sortPriority-t.sortPriority)),m=async t=>{await(t.isMuted?u(e,t.alert):l(e,t.alert)),o()},h=Object(T.d)(e),A=Object(T.e)({rule:e,licenseErrorText:k.a,lastOutcomeTranslations:k.K,executionStatusTranslations:k.L}),_=()=>Object(v.a)(S,"xl")({items:f,readOnly:s,onMuteAction:m}),M=[{id:"rule_alert_list",name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rule.alertsTabText",{defaultMessage:"Alerts"}),"data-test-subj":"ruleAlertListTab",content:Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(r.EuiSpacer,null),_())},{id:"rule_event_log_list",name:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.rule.eventLogTabText",{defaultMessage:"History"}),"data-test-subj":"eventLogListTab",content:Object(v.a)(I,"xl")({fetchRuleSummary:!1,ruleId:e.id,ruleType:t,ruleSummary:n,numberOfExecutions:d,refreshToken:c,isLoadingRuleSummary:g,onChangeDuration:b,requestRefresh:o})}];return Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(r.EuiFlexGroup,{gutterSize:"s",wrap:!0},Object(p.jsx)(r.EuiFlexItem,{grow:2},Object(p.jsx)(w.default,{rule:e,isEditable:!s,healthColor:h,statusMessage:A,requestRefresh:o,refreshToken:c})),Object(v.a)(R,"xl")({rule:e,actionTypeRegistry:O,ruleTypeRegistry:x,hideEditButton:!0,onEditRule:o})),Object(p.jsx)(r.EuiSpacer,{size:"xl"}),Object(p.jsx)("input",{type:"hidden","data-test-subj":"alertsDurationEpoch",name:"alertsDurationEpoch",value:j}),Object(E.a)("rulesDetailLogs")?Object(p.jsx)(r.EuiTabbedContent,{"data-test-subj":"ruleDetailsTabbedContent",tabs:M}):_())}));var _=s(52);const M=Object(h.a)((({rule:e,ruleType:t,readOnly:s,requestRefresh:i,loadRuleSummary:r,refreshToken:l})=>{const{notifications:{toasts:u}}=Object(y.b)().services,[o,c]=Object(n.useState)(null),[d,b]=Object(n.useState)(60),[j,g]=Object(n.useState)(!0),x=Object(n.useRef)(null),O=Object(n.useRef)(l),f=Object(n.useCallback)((async(e=d)=>{g(!0),await async function(e,t,s,n,i){try{s(await t(e,i))}catch(e){n.addDanger({title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.unableToLoadRulesMessage",{defaultMessage:"Unable to load rules: {message}",values:{message:e.message}})})}}(x.current,r,c,u,e),g(!1)}),[g,x,r,c,u,d]);Object(n.useEffect)((()=>{x.current!==e.id&&(x.current=e.id,f())}),[e,x,f]),Object(n.useEffect)((()=>{O.current!==l&&(O.current=l,f())}),[l,O,f]);const m=Object(n.useCallback)((e=>{b(e),f(e)}),[f]);return o?Object(p.jsx)(A,{requestRefresh:i,refreshToken:l,rule:e,ruleType:t,readOnly:s,ruleSummary:o,numberOfExecutions:d,isLoadingChart:j,onChangeDuration:m}):Object(p.jsx)(_.a,null)}));var F=s(13),D=s.n(F),L=s(128),C=s(130);const U=!1,P=({rule:e})=>{const{application:{navigateToUrl:t},http:{basePath:s},alerting:a}=Object(y.b)().services,[i,l]=Object(n.useState)(null);return Object(n.useEffect)((()=>{Object(C.pipe)(Object(L.fromNullable)(a),Object(L.fold)((()=>l(U)),(t=>t.getNavigation(e.id).then((e=>l(e||U))).catch((()=>{l(U)})))))}),[e.id,a]),Object(p.jsx)(r.EuiButtonEmpty,D()({"data-test-subj":"ruleDetails-viewInApp",isLoading:null===i,disabled:!B(i),iconType:"popout"},function(e,t,s,a){return B(e)?{onClick:()=>{s(a.prepend(e))}}:{}}(i,0,t,s)),Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.viewRuleInAppButtonLabel",defaultMessage:"View in app"}))};function B(e){return"string"==typeof e}var z=s(38),q=s(6),N=s(142),W=s(22),K=s(134),$=s(232),G=s(229);const H={minWidth:0},J=Object(h.a)((({rule:e,ruleType:t,actionTypes:s,bulkDisableRules:h,bulkEnableRules:E,bulkDeleteRules:v,snoozeRule:T,unsnoozeRule:w,requestRefresh:I,refreshToken:S})=>{var R,A,_;const F=Object(l.useHistory)(),{application:{capabilities:D},ruleTypeRegistry:L,actionTypeRegistry:C,setBreadcrumbs:U,chrome:B,http:J,notifications:{toasts:Q}}=Object(y.b)().services,[{},V]=Object(n.useReducer)(N.a,{rule:e}),[Y,X]=Object(n.useState)([]),[Z,ee]=Object(n.useState)([]),[te,se]=Object(n.useState)(!1),[ae,ne]=Object(n.useState)({isUsingSecurity:!1});Object(n.useEffect)((()=>{(async()=>{ne(await Object(K.a)({http:J}))})()}),[J]),Object(n.useEffect)((()=>{U([Object(f.a)("rules",!0),{text:e.name}]),B.docTitle.change(Object(m.a)("rules"))}),[]),Object(n.useEffect)((()=>{(async()=>{let t=[];try{t=await Object(W.e)({http:J})}catch(e){t=[]}if(t.length>0){const s=e.actions.some((e=>!t.find((t=>t.id===e.id))));se&&se(s)}})()}),[]);const ie=Object(O.c)(D),re=Object(O.a)(e.consumer,t)&&(ie||!ie&&0===e.actions.length),le=re&&!!L.has(e.ruleTypeId)&&!L.get(e.ruleTypeId).requiresAppContext,[ue,oe]=Object(n.useState)(!1);Object(n.useEffect)((()=>{if(e.schedule.interval&&ae.minimumScheduleInterval&&Object(c.parseDuration)(e.schedule.interval)<Object(c.parseDuration)(ae.minimumScheduleInterval.value)){const e=Q.addInfo({"data-test-subj":"intervalConfigToast",title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.scheduleIntervalToastTitle",{defaultMessage:"Configuration settings"}),text:Object(o.toMountPoint)(Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)("p",null,Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.scheduleIntervalToastMessage",defaultMessage:"This rule has an interval set below the minimum configured interval. This may impact performance."})),le&&Object(p.jsx)(r.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiButton,{"data-test-subj":"ruleIntervalToastEditButton",onClick:()=>{Q.remove(e),oe(!0)}},Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.scheduleIntervalToastMessageButton",defaultMessage:"Edit rule"}))))))})}}),[e.schedule.interval,ae.minimumScheduleInterval,Q,le]);const ce=le?Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(r.EuiButtonEmpty,{"data-test-subj":"openEditRuleFlyoutButton",iconType:"pencil",onClick:()=>oe(!0),name:"edit",disabled:!t.enabledInLicense},Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.editRuleButtonLabel",defaultMessage:"Edit"})),ue&&Object(p.jsx)(z.b,{initialRule:e,onClose:()=>{V({command:{type:"setRule"},payload:{key:"rule",value:e}}),oe(!1)},actionTypeRegistry:C,ruleTypeRegistry:L,ruleType:t,onSave:async()=>{F.push(Object(d.zb)(e.id))}})):null,[de,be]=Object(n.useState)(!1),{showToast:je}=Object(G.a)({});return Object(p.jsx)(i.a.Fragment,null,de&&Object(p.jsx)(g.a,{onConfirm:async()=>{be(!1);const{errors:e,total:t}=await v({ids:Y});je({action:"DELETE",errors:e,total:t}),X([]),F.push(q.w)},onCancel:()=>{be(!1),X([])},confirmButtonText:Object(k.y)(Y.length,k.w,k.f),confirmModalText:Object(k.z)(Y.length,k.w,k.f)}),Object(p.jsx)(b.a,{onCancel:()=>{ee([])},idsToUpdate:Z,apiUpdateApiKeyCall:j.a,setIsLoadingState:()=>{},onUpdated:async()=>{ee([]),I()}}),Object(p.jsx)(r.EuiPageHeader,{"data-test-subj":"ruleDetailsTitle",bottomBorder:!0,pageTitle:Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.ruleDetailsTitle",defaultMessage:"{ruleName}",values:{ruleName:e.name}}),description:Object(p.jsx)(r.EuiFlexGroup,{gutterSize:"m"},Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center"},Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiText,{size:"s"},Object(p.jsx)("p",null,Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.rulesListTable.columns.ruleTypeTitle",defaultMessage:"Type"})))),Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiBadge,{"data-test-subj":"ruleTypeLabel"},t.name)))),Object(O.d)(D)&&e.apiKeyOwner&&Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center"},Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiText,{size:"s"},Object(p.jsx)("p",null,Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.rulesListTable.columns.apiKeyOwnerTitle",defaultMessage:"API key owner"})))),Object(p.jsx)(r.EuiFlexItem,{grow:!1},Object(p.jsx)(r.EuiText,{size:"s","data-test-subj":"apiKeyOwnerLabel"},Object(p.jsx)("b",null,e.apiKeyOwner),e.apiKeyCreatedByUser?Object(p.jsx)(i.a.Fragment,null," ",Object(p.jsx)(r.EuiIconTip,{position:"right",content:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.userManagedApikey",{defaultMessage:"This rule is associated with an API key."})})):null))))),rightSideItems:[Object(p.jsx)(x,{canSaveRule:re,rule:e,onDelete:e=>{be(!0),X([e])},onApiKeyUpdate:e=>{ee([e])},onEnableDisable:async t=>{t?await E({ids:[e.id]}):await h({ids:[e.id]}),I()},onRunRule:async e=>{await Object($.a)(J,Q,e)}}),ce,Object(p.jsx)(r.EuiButtonEmpty,{"data-test-subj":"refreshRulesButton",iconType:"refresh",onClick:I,name:"refresh",color:"primary"},Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.rulesList.refreshRulesButtonLabel",defaultMessage:"Refresh"})),Object(p.jsx)(P,{rule:e})]}),Object(p.jsx)(r.EuiPageSection,null,e.enabled&&(null===(R=e.executionStatus.error)||void 0===R?void 0:R.reason)===c.RuleExecutionStatusErrorReasons.License?Object(p.jsx)(r.EuiFlexGroup,null,Object(p.jsx)(r.EuiFlexItem,null,Object(p.jsx)(r.EuiCallOut,{color:"danger","data-test-subj":"ruleErrorBanner",size:"s",iconType:"rule"},Object(p.jsx)("p",null,Object(p.jsx)(r.EuiIcon,{color:"danger",type:"warning"})," ",Object(p.jsx)("b",null,e.executionStatus.error&&e.executionStatus.error.reason?k.J[e.executionStatus.error.reason]:k.J.unknown),", ",null===(A=e.executionStatus.error)||void 0===A?void 0:A.message," ",Object(p.jsx)(r.EuiLink,{href:`${J.basePath.get()}/app/management/stack/license_management`,color:"primary",target:"_blank"},Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.manageLicensePlanBannerLinkTitle",defaultMessage:"Manage license"})))))):null,e.enabled&&"warning"===e.executionStatus.status?Object(p.jsx)(r.EuiFlexGroup,null,Object(p.jsx)(r.EuiFlexItem,null,Object(p.jsx)(r.EuiCallOut,{color:"warning","data-test-subj":"ruleWarningBanner",size:"s",iconType:"warning"},Object(p.jsx)("p",null,Object(p.jsx)(r.EuiIcon,{color:"warning",type:"warning"})," ",e.executionStatus.warning&&e.executionStatus.warning.reason?k.M[e.executionStatus.warning.reason]:k.M.unknown," ",null===(_=e.executionStatus.warning)||void 0===_?void 0:_.message)))):null,te&&Object(p.jsx)(r.EuiFlexGroup,null,Object(p.jsx)(r.EuiFlexItem,null,Object(p.jsx)(r.EuiSpacer,{size:"s"}),Object(p.jsx)(r.EuiCallOut,{color:"warning","data-test-subj":"actionWithBrokenConnectorWarningBanner",size:"s"},Object(p.jsx)("p",null,Object(p.jsx)(r.EuiIcon,{color:"warning",type:"warning"})," ",Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.actionWithBrokenConnectorWarningBannerTitle",defaultMessage:"There is an issue with one of the connectors associated with this rule."})," ",le&&Object(p.jsx)(r.EuiLink,{"data-test-subj":"actionWithBrokenConnectorWarningBannerEdit",color:"primary",onClick:()=>oe(!0)},Object(p.jsx)(u.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleDetails.actionWithBrokenConnectorWarningBannerEditText",defaultMessage:"Edit rule"})))))),Object(p.jsx)(r.EuiFlexGroup,null,Object(p.jsx)(r.EuiFlexItem,{style:H},Object(p.jsx)(M,{requestRefresh:I,refreshToken:S,rule:e,ruleType:t,readOnly:!re})))))}));var Q=s(57),V=s(179);const Y=({match:{params:{ruleId:e}},loadRuleTypes:t,loadActionTypes:s,resolveRule:l})=>{const{http:u,notifications:{toasts:o},spaces:c}=Object(y.b)().services,{basePath:d}=u,[b,j]=Object(n.useState)(null),[g,x]=Object(n.useState)(null),[O,f]=Object(n.useState)(null),[m,h]=Object(n.useState)(),E=Object(n.useCallback)((()=>new Promise(((e,t)=>{h({resolve:e,reject:t})}))),[h]);return Object(n.useEffect)((()=>{(async()=>{await X(e,t,l,s,j,x,f,o),null==m||m.resolve()})()}),[e,u,s,t,l,o,m]),Object(n.useEffect)((()=>{if(b){const e=b.outcome;if(c&&"aliasMatch"===e){const e=d.prepend(`insightsAndAlerting/triggersActions/rule/${b.id}`);c.ui.redirectLegacyUrl({path:e,aliasPurpose:b.alias_purpose,objectNoun:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.redirectObjectNoun",{defaultMessage:"rule"})})}}}),[b,c,d]),b&&g&&O?Object(p.jsx)(i.a.Fragment,null,(()=>{const e=b.outcome;if(c&&"conflict"===e){const e=b.alias_target_id,t=d.prepend(`insightsAndAlerting/triggersActions/rule/${e}`);return Object(p.jsx)(i.a.Fragment,null,Object(p.jsx)(r.EuiSpacer,null),c.ui.components.getLegacyUrlConflict({objectNoun:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.redirectObjectNoun",{defaultMessage:"rule"}),currentObjectId:null==b?void 0:b.id,otherObjectId:e,otherObjectPath:t}))}return null})(),Object(p.jsx)(J,{rule:b,ruleType:g,actionTypes:O,requestRefresh:E,refreshToken:m})):Object(p.jsx)(_.a,null)};async function X(e,t,s,n,i,r,l,u){try{const a=await s(e);i(a);const[u,o]=await Promise.all([t().then((e=>e.find((e=>e.id===a.ruleTypeId)))).then(Object(Q.b)(`Invalid Rule Type: ${a.ruleTypeId}`)),n().then(Object(Q.c)(new Set(a.actions.map((e=>e.actionTypeId))),(e=>`Invalid Connector Type: ${e}`),(e=>e.id)))]);r(u),l(o)}catch(e){u.addDanger({title:a.i18n.translate("xpack.triggersActionsUI.sections.ruleDetails.unableToLoadRuleMessage",{defaultMessage:"Unable to load rule: {message}",values:{message:e.message}})})}}const Z=Object(V.a)(Object(h.a)(Y))}}]);