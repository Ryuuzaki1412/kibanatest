/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[42,59],{108:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleDefinition",(function(){return y})),s.d(t,"default",(function(){return y}));var n=s(13),i=s.n(n),o=s(1),r=s(3),l=s(10),a=s(2),c=s(12),u=s(54),j=s(30),x=s(117),b=s(76),d=s(22);const g=e=>a.i18n.translate("xpack.triggersActionsUI.ruleDetails.connectorsLoadError",{defaultMessage:"Unable to load rule actions connectors. Reason: {message}",values:{message:e}});var p=s(165),O=s(0);function m({ruleActions:e,actionTypeRegistry:t,legacyNotifyWhen:s}){const{isLoadingActionConnectors:n,actionConnectors:i}=function({ruleActions:e}){const{http:t,notifications:{toasts:s}}=Object(j.b)().services,[n,i]=Object(o.useState)({isLoadingActionConnectors:!0,actionConnectors:[],errorActionConnectors:void 0}),r=Object(o.useCallback)((async()=>{try{if(!e||e.length<=0)return void i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:[]})));const s=await Object(d.e)({http:t});i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:s})))}catch(e){const t=g(e instanceof Error?e.message:"string"==typeof e?e:"");i((e=>({...e,isLoadingActionConnectors:!1,errorActionConnectors:t}))),s.addDanger({title:t})}}),[t,e,s]);return Object(o.useEffect)((()=>{r()}),[r]),{...n,reloadRuleActionConnectors:r}}({ruleActions:e}),l=i&&i.length>0,c=e&&e.length>0;if(!l||!c)return Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{size:"s"},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.noActions",{defaultMessage:"No actions"})));const u=e=>{const s=t.list().find((t=>t.id===e));return"string"==typeof(null==s?void 0:s.iconClass)?null==s?void 0:s.iconClass:Object(b.suspendedComponentWithProps)(null==s?void 0:s.iconClass)};return n?Object(O.jsx)(r.EuiLoadingSpinner,{size:"s"}):Object(O.jsx)(r.EuiFlexGroup,{direction:"column",gutterSize:"none"},e.map(((e,t)=>{var n;const{actionTypeId:o,id:l}=e,a=(e=>{const t=i.find((t=>t.id===e));return null==t?void 0:t.name})(l);return Object(O.jsx)(r.EuiFlexItem,{key:t},Object(O.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"s",component:"span"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiIcon,{size:"m",type:null!==(n=u(o))&&void 0!==n?n:"apps"})),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{"data-test-subj":`actionConnectorName-${t}-${a||o}`,size:"s"},a),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",component:"span"},Object(O.jsx)(r.EuiSpacer,{size:"xs"}),Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiIcon,{size:"s",type:"bell"})),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{"data-test-subj":`actionConnectorName-${t}-${a||o}`,size:"xs"},String((e=>{var t,n,i;return null!==(t=(null===(n=p.NOTIFY_WHEN_OPTIONS.find((t=>{var s;return t.value===(null===(s=e.frequency)||void 0===s?void 0:s.notifyWhen)})))||void 0===n?void 0:n.inputDisplay)||(null===(i=e.frequency)||void 0===i?void 0:i.notifyWhen))&&void 0!==t?t:s})(e))))))),Object(O.jsx)(r.EuiSpacer,{size:"s"}))})))}var f=s(38);const y=({rule:e,actionTypeRegistry:t,ruleTypeRegistry:s,onEditRule:n,hideEditButton:i=!1,filteredRuleTypes:b=[]})=>{var d;const{application:{capabilities:g}}=Object(j.b)().services,[p,y]=Object(o.useState)(!1),[h,v]=Object(o.useState)(),{ruleTypesState:{data:F,isLoading:A}}=Object(u.a)({filteredRuleTypes:b}),T=Object(o.useMemo)((()=>[...F.values()]),[F]),S=Object(o.useMemo)((()=>{if(T.length&&e)return T.find((t=>t.id===e.ruleTypeId))}),[e,T]);Object(o.useEffect)((()=>{v(S)}),[S]);const C=()=>{const t=null!=e&&e.params.criteria?(null==e?void 0:e.params.criteria).length:0;return a.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditions",{defaultMessage:"{numberOfConditions, plural, one {# condition} other {# conditions}}",values:{numberOfConditions:t}})},M=Object(x.f)(g),k=Object(x.c)(g),z=e&&Object(x.a)(e.consumer,h)&&(k||!k&&0===e.actions.length),D=Object(o.useMemo)((()=>!i&&z&&!!s.has(e.ruleTypeId)&&!s.get(e.ruleTypeId).requiresAppContext),[i,z,s,e]),U=Object(o.useMemo)((()=>s.has(e.ruleTypeId)?s.get(e.ruleTypeId).description:e.consumer===l.ob.SIEM?a.i18n.translate("xpack.triggersActionsUI.ruleDetails.securityDetectionRule",{defaultMessage:"Security detection rule"}):""),[e,s]);return Object(O.jsx)(r.EuiFlexItem,{"data-test-subj":"ruleSummaryRuleDefinition",grow:3},Object(O.jsx)(r.EuiPanel,{color:"subdued",hasBorder:!1,paddingSize:"m"},Object(O.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(O.jsx)(r.EuiTitle,{size:"s"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.definition",{defaultMessage:"Definition"}))),A?Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiLoadingSpinner,{"data-test-subj":"ruleDetailsEditButtonLoadingSpinner"})):D&&Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiButtonEmpty,{"data-test-subj":"ruleDetailsEditButton",iconType:"pencil",onClick:()=>y(!0)}))),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"baseline"},Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiFlexGroup,null,Object(O.jsx)(I,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.ruleType",{defaultMessage:"Rule type"})),A?Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiLoadingSpinner,{"data-test-subj":"ruleSummaryRuleTypeLoadingSpinner"})):Object(O.jsx)(E,{"data-test-subj":"ruleSummaryRuleType",itemValue:(null===(d=F.get(e.ruleTypeId))||void 0===d?void 0:d.name)||e.ruleTypeId})),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"flexStart",responsive:!1},Object(O.jsx)(I,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.description",{defaultMessage:"Description"})),Object(O.jsx)(E,{"data-test-subj":"ruleSummaryRuleDescription",itemValue:U})),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,null,Object(O.jsx)(I,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.runsEvery",{defaultMessage:"Runs every"})),Object(O.jsx)(E,{"data-test-subj":"ruleSummaryRuleInterval",itemValue:Object(c.formatDuration)(e.schedule.interval)})),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"center"},Object(O.jsx)(I,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditionsTitle",{defaultMessage:"Conditions"})),Object(O.jsx)(r.EuiFlexItem,{grow:3},Object(O.jsx)(r.EuiFlexGroup,{"data-test-subj":"ruleSummaryRuleConditions",alignItems:"center",gutterSize:"none"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},D?Object(O.jsx)(r.EuiButtonEmpty,{onClick:()=>y(!0),flush:"left"},Object(O.jsx)(r.EuiText,{size:"s"},C())):Object(O.jsx)(r.EuiText,{size:"s"},C()))))),Object(O.jsx)(r.EuiSpacer,{size:"m"})),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiFlexGroup,{alignItems:"baseline"},Object(O.jsx)(I,null,a.i18n.translate("xpack.triggersActionsUI.ruleDetails.actions",{defaultMessage:"Actions"})),Object(O.jsx)(r.EuiFlexItem,{grow:3},M?Object(O.jsx)(m,{ruleActions:e.actions,actionTypeRegistry:t,legacyNotifyWhen:e.notifyWhen}):Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{size:"s"},a.i18n.translate("xpack.triggersActionsUI.ruleDetails.cannotReadActions",{defaultMessage:"Connector feature privileges are required to view actions"})))))))),p&&Object(O.jsx)(f.b,{onSave:()=>(y(!1),n()),initialRule:e,onClose:()=>y(!1),ruleTypeRegistry:s,actionTypeRegistry:t}))};function E({itemValue:e,extraSpace:t=!0,...s}){return Object(O.jsx)(r.EuiFlexItem,i()({grow:t?3:1},s),Object(O.jsx)(r.EuiText,{size:"s"},e))}function I({children:e}){return Object(O.jsx)(r.EuiTitle,{size:"xxs"},Object(O.jsx)(r.EuiFlexItem,{style:{whiteSpace:"nowrap"},grow:1},e))}},165:function(e,t,s){"use strict";s.r(t),s.d(t,"NOTIFY_WHEN_OPTIONS",(function(){return x})),s.d(t,"RuleNotifyWhen",(function(){return b}));var n=s(1),i=s.n(n),o=s(2),r=s(26),l=s(3),a=s(128),c=s(130),u=s(45),j=s(0);const x=[{value:"onActionGroupChange",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.display",{defaultMessage:"On status changes"}),"data-test-subj":"onActionGroupChange",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"On status changes",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"Actions run if the alert status changes.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.description"}))))},{value:"onActiveAlert",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.display",{defaultMessage:"On check intervals"}),"data-test-subj":"onActiveAlert",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"On check intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.description"}))))},{value:"onThrottleInterval",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.display",{defaultMessage:"On custom action intervals"}),"data-test-subj":"onThrottleInterval",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"On custom action intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.description"}))))}],b=({rule:e,throttle:t,throttleUnit:s,onNotifyWhenChange:b,onThrottleChange:d})=>{const[g,p]=Object(n.useState)(t||1),[O,m]=Object(n.useState)(!1),[f,y]=Object(n.useState)("onActionGroupChange");Object(n.useEffect)((()=>{e.notifyWhen?y(e.notifyWhen):y(e.throttle?"onThrottleInterval":"onActiveAlert")}),[e]),Object(n.useEffect)((()=>{m("onThrottleInterval"===f)}),[f]);const E=Object(n.useCallback)((e=>{d("onThrottleInterval"===e?g:null,s),b(e),y(e)}),[]),I=Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.renotifyFieldLabel",defaultMessage:"Notify"})," ",Object(j.jsx)(l.EuiIconTip,{position:"right",type:"questionInCircle",content:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.renotifyWithTooltip",{defaultMessage:"Define how often alerts generate actions."})}));return Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiFormRow,{fullWidth:!0,label:I},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiSuperSelect,{"data-test-subj":"notifyWhenSelect",options:x,valueOfSelected:f,onChange:E}),O&&Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiSpacer,null),Object(j.jsx)(l.EuiFormRow,{fullWidth:!0},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiFieldNumber,{fullWidth:!0,min:1,value:g,name:"throttle","data-test-subj":"throttleInput",prepend:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.label",{defaultMessage:"Every"}),onChange:e=>{Object(c.pipe)(Object(a.some)(e.target.value.trim()),Object(a.filter)((e=>""!==e)),Object(a.map)((e=>parseInt(e,10))),Object(a.filter)((e=>!isNaN(e))),Object(a.map)((e=>{p(e),d(e,s)})))}})),Object(j.jsx)(l.EuiFlexItem,{grow:!1},Object(j.jsx)(l.EuiSelect,{"data-test-subj":"throttleUnitInput",value:s,options:Object(u.b)(null!=t?t:1),onChange:e=>{d(t,e.target.value)}})))))))))}}}]);