/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[14,32],{117:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return c}));const i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},a=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},o=(e,t)=>{var n,i;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(i=e.actions)||void 0===i?void 0:i.execute},s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function r(e,t){var n,i;return null!==(n=null==t||null===(i=t.authorizedConsumers[e])||void 0===i?void 0:i.all)&&void 0!==n&&n}const c=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},125:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(2);const a={label:i.i18n.translate("xpack.triggersActionsUI.technicalPreviewBadgeLabel",{defaultMessage:"Technical preview"}),tooltipContent:i.i18n.translate("xpack.triggersActionsUI.technicalPreviewBadgeDescription",{defaultMessage:"This functionality is in technical preview and may be changed or removed completely in a future release. Elastic will work to fix any issues, but features in technical preview are not subject to the support SLA of official GA features."})}},153:function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return p})),n(1);var i=n(11),a=n(2),o=n(26),s=n(3),r=n(15),c=(n(199),n(0));const l=e=>({isEnabled:!1,message:a.i18n.translate("xpack.triggersActionsUI.checkActionTypeEnabled.actionTypeDisabledByLicenseMessage",{defaultMessage:"This connector requires a {minimumLicenseRequired} license.",values:{minimumLicenseRequired:Object(i.upperFirst)(e.minimumLicenseRequired)}}),messageCard:Object(c.jsx)(s.EuiCard,{titleSize:"xs",title:a.i18n.translate("xpack.triggersActionsUI.licenseCheck.actionTypeDisabledByLicenseMessageTitle",{defaultMessage:"This feature requires a {minimumLicenseRequired} license.",values:{minimumLicenseRequired:Object(i.upperFirst)(e.minimumLicenseRequired)}}),description:a.i18n.translate("xpack.triggersActionsUI.licenseCheck.actionTypeDisabledByLicenseMessageDescription",{defaultMessage:"To re-enable this action, please upgrade your license."}),className:"actCheckActionTypeEnabled__disabledActionWarningCard",children:Object(c.jsx)(s.EuiLink,{href:r.VIEW_LICENSE_OPTIONS_LINK,target:"_blank"},Object(c.jsx)(o.FormattedMessage,{defaultMessage:"View license options",id:"xpack.triggersActionsUI.licenseCheck.actionTypeDisabledByLicenseLinkTitle"}))})}),u={isEnabled:!1,message:a.i18n.translate("xpack.triggersActionsUI.checkActionTypeEnabled.actionTypeDisabledByConfigMessage",{defaultMessage:"This connector is disabled by the Kibana configuration."}),messageCard:Object(c.jsx)(s.EuiCard,{title:a.i18n.translate("xpack.triggersActionsUI.licenseCheck.actionTypeDisabledByConfigMessageTitle",{defaultMessage:"This feature is disabled by the Kibana configuration."}),description:"",className:"actCheckActionTypeEnabled__disabledActionWarningCard"})};function d(e){return!1===(null==e?void 0:e.enabledInLicense)?l(e):!1===(null==e?void 0:e.enabledInConfig)?u:{isEnabled:!0}}function p(e,t){return!1===(null==e?void 0:e.enabledInLicense)?l(e):!1!==(null==e?void 0:e.enabledInConfig)||t.find((t=>t.actionTypeId===e.id))?{isEnabled:!0}:u}},154:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=(e,t,n,i=[])=>{const a=n[t.actionTypeId];return e.filter((e=>(i.includes(e.actionTypeId)||e.actionTypeId===t.actionTypeId)&&((null==a?void 0:a.enabledInConfig)||e.isPreconfigured)))}},155:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=[]},167:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(3),a=n(1),o=n.n(a),s=n(2),r=n(154),c=n(0);const l=o.a.memo(u);function u({allowGroupConnector:e,actionItem:t,accordionIndex:n,actionTypesIndex:o,actionTypeRegistered:s,connectors:l,onConnectorSelected:u}){var b;const g=Object(a.useMemo)((()=>Object(r.a)(l,t,o,e)),[t,o,e,l]),j=Object(a.useMemo)((()=>d(t.id,g,s,e)),[t.id,g,s,e]),f=Object(a.useMemo)((()=>p(g,s)),[g,s]),[y,h]=Object(a.useState)(j.length>0?j[0]:void 0),O=Object(a.useCallback)((e=>{var t,n;h(e[0]),u(null!==(t=null===(n=e[0].value)||void 0===n?void 0:n.id)&&void 0!==t?t:"")}),[u]);return Object(c.jsx)(i.EuiComboBox,{"aria-label":m,"data-test-subj":`selectActionConnector-${t.actionTypeId}-${n}`,fullWidth:!0,singleSelection:{asPlainText:!0},id:`selectActionConnector-${t.id}`,isClearable:!1,onChange:O,options:f,selectedOptions:j,prepend:null==y||null===(b=y.value)||void 0===b?void 0:b.prependComponent})}const d=(e,t,n,i=[])=>{const a=t.find((t=>t.id===e));return a?[b(a,n)]:[]},p=(e,t)=>e.map((e=>b(e,t))),b=(e,t)=>{const n=g(e,t);let i;if(null!=t.customConnectorSelectItem){const n=t.customConnectorSelectItem.getComponent(e);n&&(i=Object(c.jsx)(n,{actionConnector:e}))}return{label:n,value:{title:n,id:e.id,prependComponent:i},key:e.id,"data-test-subj":`dropdown-connector-${e.id}`}},g=(e,t)=>null!=t.customConnectorSelectItem?t.customConnectorSelectItem.getText(e):e.name,m=s.i18n.translate("xpack.triggersActionsUI.sections.actionForm.incidentManagementSystemLabel",{defaultMessage:"Incident management system"})},198:function(e,t,n){"use strict";function i(e,t,n){const i=a(e,n),o=a(t,n);return!0===i&&!1===o?-1:!1===i&&!0===o?1:e.name.localeCompare(t.name)}n.d(t,"a",(function(){return i}));const a=(e,t)=>{let n=e.enabled;return!e.enabledInConfig&&t&&t.length>0&&(n=void 0!==t.find((t=>t.actionTypeId===e.id))),n}},199:function(e,t,n){switch(window.__kbnThemeTag__){case"v8dark":return n(200);case"v8light":return n(202)}},200:function(e,t,n){var i=n(50),a=n(201);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);i(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},201:function(e,t,n){(t=n(51)(!1)).push([e.i,".actAccordionActionForm,.actCheckActionTypeEnabled__disabledActionWarningCard{background-color:#25262e}.actAccordionActionForm .euiCard{box-shadow:none}.actAccordionActionForm__button{padding:12px 12px 12px 24px}.actAccordionActionForm .euiAccordion__arrow{transform:translateX(12px) rotate(0deg)!important}.actAccordionActionForm .euiAccordion__arrow[aria-expanded=true]{transform:translateX(12px) rotate(90deg)!important}",""]),e.exports=t},202:function(e,t,n){var i=n(50),a=n(203);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);i(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},203:function(e,t,n){(t=n(51)(!1)).push([e.i,".actAccordionActionForm,.actCheckActionTypeEnabled__disabledActionWarningCard{background-color:#f5f7fa}.actAccordionActionForm .euiCard{box-shadow:none}.actAccordionActionForm__button{padding:12px 12px 12px 24px}.actAccordionActionForm .euiAccordion__arrow{transform:translateX(12px) rotate(0deg)!important}.actAccordionActionForm .euiAccordion__arrow[aria-expanded=true]{transform:translateX(12px) rotate(90deg)!important}",""]),e.exports=t},215:function(e,t,n){"use strict";n.r(t),n.d(t,"AlertsSearchBar",(function(){return m})),n.d(t,"default",(function(){return m}));var i=n(1),a=n(21),o=n(10),s=n(155),r=n(2);const c=r.i18n.translate("xpack.triggersActionsUI.alertsSearchBar.placeholder",{defaultMessage:"Search alerts (e.g. kibana.alert.evaluation.threshold > 75)"});var l=n(5),u=n(138);const d=[];var p=n(54),b=n(0);const g={type:"alerts",fields:{}};function m({appName:e,disableQueryLanguageSwitcher:t=!1,featureIds:n,ruleTypeId:m,query:j,filters:f,onQueryChange:y,onQuerySubmit:h,onFiltersUpdated:O,rangeFrom:x,rangeTo:A,showFilterBar:I=!1,showDatePicker:v=!0,showSubmitButton:T=!0,placeholder:F=c,submitOnBlur:E=!1}){var C;const{unifiedSearch:{ui:{SearchBar:w}}}=Object(a.useKibana)().services,[k,S]=Object(i.useState)("kuery"),{dataviews:M,loading:U}=function(e){const{http:t,data:n,notifications:{toasts:s}}=Object(a.useKibana)().services,[c,d]=Object(i.useState)(void 0),p=e.sort().join(","),b=1===e.length&&e.includes(o.ob.SIEM),g=e.length>1&&e.includes(o.ob.SIEM),m=e.length>0&&!b&&!g,j=()=>{s.addDanger(r.i18n.translate("xpack.triggersActionsUI.useAlertDataView.useAlertDataMessage",{defaultMessage:"Unable to load alert data view"}))},{data:f,isSuccess:y,isInitialLoading:h,isLoading:O}=Object(l.useQuery)({queryKey:["loadAlertIndexNames",p],queryFn:()=>async function({http:e,features:t}){const{index_name:n=[]}=await e.get(`${u.a}/index`,{query:{features:t}});return n}({http:t,features:p}),onError:j,refetchOnWindowFocus:!1,enabled:e.length>0&&!g}),{data:x,isSuccess:A,isInitialLoading:I,isLoading:v}=Object(l.useQuery)({queryKey:["loadAlertFields",p],queryFn:()=>async function({http:e,featureIds:t}){const{fields:n=[]}=await e.get(`${u.a}/browser_fields`,{query:{featureIds:t}});return n}({http:t,featureIds:e}),onError:j,refetchOnWindowFocus:!1,enabled:m});return Object(i.useEffect)((()=>()=>{null==c||c.map((e=>{n.dataViews.clearInstanceCache(e.id)}))}),[c]),Object(i.useEffect)((()=>{b&&y&&async function(){const e=await n.dataViews.create({title:(null!=f?f:[]).join(","),allowNoIndex:!0});d([e])}()}),[n.dataViews,f,y,b]),Object(i.useEffect)((()=>{var e;f&&x&&!b&&A&&y&&d([{title:(null!=f?f:[]).join(","),fieldFormatMap:{},fields:null===(e=null!=x?x:[])||void 0===e?void 0:e.map((e=>({...e,...e.esTypes&&e.esTypes.includes("flattened")?{type:"string"}:{}})))}])}),[x,n.dataViews,f,y,b,A]),Object(i.useMemo)((()=>({dataviews:c,loading:0!==e.length&&!g&&(b?h||O:h||O||I||v)})),[c,e.length,g,b,h,O,I,v])}(null!=n?n:[]),{aadFields:N,loading:W}=function(e){const{http:t,notifications:{toasts:n}}=Object(a.useKibana)().services,{data:o=d,isInitialLoading:s,isLoading:c}=Object(l.useQuery)({queryKey:["loadAlertAadFieldsPerRuleType",e],queryFn:()=>async function({http:e,ruleTypeId:t}){return t?await e.get(`${u.a}/aad_fields`,{query:{ruleTypeId:t}}):d}({http:t,ruleTypeId:e}),onError:()=>{n.addDanger(r.i18n.translate("xpack.triggersActionsUI.useRuleAADFields.errorMessage",{defaultMessage:"Unable to load alert fields per rule type"}))},refetchOnWindowFocus:!1,enabled:void 0!==e});return Object(i.useMemo)((()=>({aadFields:o,loading:void 0!==e&&(s||c)})),[o,s,c,e])}(m),_=m&&null!=N&&N.length?[{title:m,fields:N}]:M,D=Object(p.a)({filteredRuleTypes:void 0!==m?[m]:[],enabled:void 0!==m}),B=n&&1===n.length&&n.includes(o.ob.SIEM)||D&&m&&(null===(C=D.ruleTypesState.data.get(m))||void 0===C?void 0:C.producer)===o.ob.SIEM,P=Object(i.useCallback)((({dateRange:e,query:t})=>{var n;h({dateRange:e,query:"string"==typeof(null==t?void 0:t.query)?t.query:void 0}),S(null!==(n=null==t?void 0:t.language)&&void 0!==n?n:"kuery")}),[h,S]),L=Object(i.useCallback)((({dateRange:e,query:t})=>{var n;null==y||y({dateRange:e,query:"string"==typeof(null==t?void 0:t.query)?t.query:void 0}),S(null!==(n=null==t?void 0:t.language)&&void 0!==n?n:"kuery")}),[y,S]);return Object(b.jsx)(w,{appName:e,disableQueryLanguageSwitcher:t,indexPatterns:U||W?s.a:_,placeholder:F,query:{query:null!=j?j:"",language:k},filters:f,dateRangeFrom:x,dateRangeTo:A,displayStyle:"inPage",showFilterBar:I,onQuerySubmit:P,onFiltersUpdated:O,onRefresh:({dateRange:e})=>{h({dateRange:e})},showDatePicker:v,showQueryInput:!0,saveQueryMenuVisibility:"allowed_by_app_privilege",showSubmitButton:T,submitOnBlur:E,onQueryChange:L,suggestionsAbstraction:B?void 0:g})}},233:function(e,t,n){var i,a,o,s;
/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */s=function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function i(e){return"function"==typeof e}function a(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test,r=/\S/;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},l=/\s*/,u=/\s+/,d=/\s*=/,p=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/;function g(e){this.string=e,this.tail=e,this.pos=0}function m(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function j(){this.cache={}}g.prototype.eos=function(){return""===this.tail},g.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},g.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},m.prototype.push=function(e){return new m(e,this)},m.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var a,s,r=this,c=!1;r;){if(e.indexOf(".")>0)for(t=r.view,a=e.split("."),s=0;null!=t&&s<a.length;)s===a.length-1&&(c=o(t,a[s])),t=t[a[s++]];else t=r.view[e],c=o(r.view,e);if(c)break;r=r.parent}n[e]=t}return i(t)&&(t=t.call(this.view)),t},j.prototype.clearCache=function(){this.cache={}},j.prototype.parse=function(t,i){var o=this.cache,c=o[t];return null==c&&(c=o[t]=function(t,i){if(!t)return[];var o,c,m,j,f=[],y=[],h=[],O=!1,x=!1;function A(){if(O&&!x)for(;h.length;)delete y[h.pop()];else h=[];O=!1,x=!1}function I(e){if("string"==typeof e&&(e=e.split(u,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);o=new RegExp(a(e[0])+"\\s*"),c=new RegExp("\\s*"+a(e[1])),m=new RegExp("\\s*"+a("}"+e[1]))}I(i||e.tags);for(var v,T,F,E,C,w,k=new g(t);!k.eos();){if(v=k.pos,F=k.scanUntil(o))for(var S=0,M=F.length;S<M;++S)j=E=F.charAt(S),function(e,t){return s.call(e,t)}(r,j)?x=!0:h.push(y.length),y.push(["text",E,v,v+1]),v+=1,"\n"===E&&A();if(!k.scan(o))break;if(O=!0,T=k.scan(b)||"name",k.scan(l),"="===T?(F=k.scanUntil(d),k.scan(d),k.scanUntil(c)):"{"===T?(F=k.scanUntil(m),k.scan(p),k.scanUntil(c),T="&"):F=k.scanUntil(c),!k.scan(c))throw new Error("Unclosed tag at "+k.pos);if(C=[T,F,v,k.pos],y.push(C),"#"===T||"^"===T)f.push(C);else if("/"===T){if(!(w=f.pop()))throw new Error('Unopened section "'+F+'" at '+v);if(w[1]!==F)throw new Error('Unclosed section "'+w[1]+'" at '+v)}else"name"===T||"{"===T||"&"===T?x=!0:"="===T&&I(F)}if(w=f.pop())throw new Error('Unclosed section "'+w[1]+'" at '+k.pos);return function(e){for(var t,n=[],i=n,a=[],o=0,s=e.length;o<s;++o)switch((t=e[o])[0]){case"#":case"^":i.push(t),a.push(t),i=t[4]=[];break;case"/":a.pop()[5]=t[2],i=a.length>0?a[a.length-1][4]:n;break;default:i.push(t)}return n}(function(e){for(var t,n,i=[],a=0,o=e.length;a<o;++a)(t=e[a])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}(y))}(t,i)),c},j.prototype.render=function(e,t,n){var i=this.parse(e),a=t instanceof m?t:new m(t);return this.renderTokens(i,a,n,e)},j.prototype.renderTokens=function(e,t,n,i){for(var a,o,s,r="",c=0,l=e.length;c<l;++c)s=void 0,"#"===(o=(a=e[c])[0])?s=this.renderSection(a,t,n,i):"^"===o?s=this.renderInverted(a,t,n,i):">"===o?s=this.renderPartial(a,t,n,i):"&"===o?s=this.unescapedValue(a,t):"name"===o?s=this.escapedValue(a,t):"text"===o&&(s=this.rawValue(a)),void 0!==s&&(r+=s);return r},j.prototype.renderSection=function(e,t,a,o){var s=this,r="",c=t.lookup(e[1]);if(c){if(n(c))for(var l=0,u=c.length;l<u;++l)r+=this.renderTokens(e[4],t.push(c[l]),a,o);else if("object"==typeof c||"string"==typeof c||"number"==typeof c)r+=this.renderTokens(e[4],t.push(c),a,o);else if(i(c)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(c=c.call(t.view,o.slice(e[3],e[5]),(function(e){return s.render(e,t,a)})))&&(r+=c)}else r+=this.renderTokens(e[4],t,a,o);return r}},j.prototype.renderInverted=function(e,t,i,a){var o=t.lookup(e[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(e[4],t,i,a)},j.prototype.renderPartial=function(e,t,n){if(n){var a=i(n)?n(e[1]):n[e[1]];return null!=a?this.renderTokens(this.parse(a),t,n,a):void 0}},j.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},j.prototype.escapedValue=function(t,n){var i=n.lookup(t[1]);if(null!=i)return e.escape(i)},j.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.2",e.tags=["{{","}}"];var f=new j;return e.clearCache=function(){return f.clearCache()},e.parse=function(e,t){return f.parse(e,t)},e.render=function(e,t,i){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(a=e)?"array":typeof a)+'" was given as the first argument for mustache#render(template, view, partials)');var a;return f.render(e,t,i)},e.to_html=function(t,n,a,o){var s=e.render(t,n,a);if(!i(o))return s;o(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=g,e.Context=m,e.Writer=j,e},t&&"string"!=typeof t.nodeName?s(t):(a=[t],void 0===(o="function"==typeof(i=s)?i.apply(t,a):i)||(e.exports=o))},81:function(e,t,n){"use strict";n.r(t),n.d(t,"ActionForm",(function(){return ae})),n.d(t,"default",(function(){return ae}));var i=n(1),a=n.n(i),o=n(2),s=n(26),r=n(3),c=n(104),l=n(125),u=n(22),d=n(56),p=n(10),b=n(11),g=n(96),m=n(33),j=n(19),f=n(153),y=n(117),h=n(68),O=n(30),x=n(167),A=n(12),I=n(92),v=n(128),T=n(130),F=n(45),E=n(15),C=n(0);const w=[{isSummaryOption:!1,isForEachAlertOption:!0,value:{value:"onActionGroupChange",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.display",{defaultMessage:"On status changes"}),"data-test-subj":"onActionGroupChange",dropdownDisplay:Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)("strong",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"On status changes",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.label"})),Object(C.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(C.jsx)("p",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Actions run if the alert status changes.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.description"}))))}},{isSummaryOption:!0,isForEachAlertOption:!0,value:{value:"onActiveAlert",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.display",{defaultMessage:"On check intervals"}),"data-test-subj":"onActiveAlert",dropdownDisplay:Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)("strong",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"On check intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.label"})),Object(C.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(C.jsx)("p",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.description"}))))}},{isSummaryOption:!0,isForEachAlertOption:!0,value:{value:"onThrottleInterval",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.display",{defaultMessage:"On custom action intervals"}),"data-test-subj":"onThrottleInterval",dropdownDisplay:Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)("strong",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"On custom action intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.label"})),Object(C.jsx)(r.EuiText,{size:"s",color:"subdued"},Object(C.jsx)("p",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.description"}))))}}],k=({hasAlertsMappings:e,frequency:t=E.DEFAULT_FREQUENCY,throttle:n,throttleUnit:s,onNotifyWhenChange:c,onThrottleChange:l,onSummaryChange:u,showMinimumThrottleWarning:d,showMinimumThrottleUnitWarning:p,notifyWhenSelectOptions:b=w,defaultNotifyWhenValue:g=E.DEFAULT_FREQUENCY.notifyWhen})=>{const[m,j]=Object(i.useState)(!1),[f,y]=Object(i.useState)(g),[h,O]=Object(i.useState)(!1);Object(i.useEffect)((()=>{t.notifyWhen?y(t.notifyWhen):y(t.throttle?A.RuleNotifyWhen.THROTTLE:A.RuleNotifyWhen.ACTIVE)}),[t]),Object(i.useEffect)((()=>{j(f===A.RuleNotifyWhen.THROTTLE)}),[f]);const x=Object(i.useCallback)((e=>{c(e),y(e),setTimeout((()=>l(e===A.RuleNotifyWhen.THROTTLE?null!=n?n:1:null,s)),100)}),[c,l,n,s]),I=Object(i.useMemo)((()=>b.filter((e=>e.isSummaryOption)).map((e=>e.value))),[b]),k=Object(i.useMemo)((()=>b.filter((e=>e.isForEachAlertOption)).map((e=>e.value))),[b]),N=Object(i.useMemo)((()=>t.summary?I:k),[k,t.summary,I]),W=Object(i.useCallback)((e=>e&&!I.filter((e=>e.value===t.notifyWhen)).length||!e&&!k.filter((e=>e.value===t.notifyWhen)).length),[k,t.notifyWhen,I]),_=Object(i.useCallback)((e=>e?I.length?I[0].value:A.RuleNotifyWhen.ACTIVE:k.length?k[0].value:A.RuleNotifyWhen.ACTIVE),[k,I]),D=Object(i.useCallback)((e=>{u(e),O(!1),W(e)&&c(_(e))}),[u,W,c,_]),B=Object(i.useMemo)((()=>[Object(C.jsx)(U,{className:"euiSuperSelect__item",key:"summary",onClick:()=>D(!0),icon:t.summary?"check":"empty",id:"actionNotifyWhen-option-summary","data-test-subj":"actionNotifyWhen-option-summary"},M),Object(C.jsx)(U,{className:"euiSuperSelect__item",key:"for_each",onClick:()=>D(!1),icon:t.summary?"empty":"check",id:"actionNotifyWhen-option-for_each","data-test-subj":"actionNotifyWhen-option-for_each"},S)]),[t.summary,D]),P=Object(C.jsx)(r.EuiPopover,{"data-test-subj":"summaryOrPerRuleSelect",initialFocus:"#actionNotifyWhen-option-"+(t.summary?"summary":"for_each"),isOpen:h,closePopover:Object(i.useCallback)((()=>O(!1)),[O]),panelPaddingSize:"none",anchorPosition:"downLeft","aria-label":t.summary?M:S,"aria-roledescription":o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.actionNotifyWhen.summaryOrRulePerSelectRoleDescription",{defaultMessage:"Action frequency type select"}),button:Object(C.jsx)(r.EuiButtonEmpty,{size:"xs",iconType:"arrowDown",iconSide:"right",onClick:Object(i.useCallback)((()=>O(!h)),[h])},t.summary?M:S)},Object(C.jsx)(r.EuiContextMenuPanel,{items:B}));return Object(C.jsx)(r.EuiFormRow,{fullWidth:!0,label:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.actionNotifyWhen.actionFrequencyLabel",{defaultMessage:"Action frequency"})},Object(C.jsx)(r.EuiFlexGroup,{gutterSize:"s"},Object(C.jsx)(r.EuiFlexItem,null,Object(C.jsx)(r.EuiSuperSelect,{fullWidth:!0,prepend:e?P:Object(C.jsx)(a.a.Fragment,null),"data-test-subj":"notifyWhenSelect",options:N,valueOfSelected:f,onChange:x}),m&&Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)(r.EuiFormRow,{fullWidth:!0},Object(C.jsx)(r.EuiFlexGroup,{gutterSize:"s"},Object(C.jsx)(r.EuiFlexItem,{style:{flexGrow:.1}}),Object(C.jsx)(r.EuiFlexItem,{grow:2},Object(C.jsx)(r.EuiFieldNumber,{isInvalid:d,min:1,value:null!=n?n:1,name:"throttle","data-test-subj":"throttleInput",prepend:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.frequencyNotifyWhen.label",{defaultMessage:"Run every"}),onChange:e=>{Object(T.pipe)(Object(v.some)(e.target.value.trim()),Object(v.filter)((e=>""!==e)),Object(v.map)((e=>parseInt(e,10))),Object(v.filter)((e=>!isNaN(e))),Object(v.map)((e=>{l(e,s)})))}})),Object(C.jsx)(r.EuiFlexItem,{grow:3},Object(C.jsx)(r.EuiSelect,{isInvalid:p,"data-test-subj":"throttleUnitInput",value:s,options:Object(F.b)(null!=n?n:1),onChange:e=>{l(n,e.target.value)}})))),(d||p)&&Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSpacer,{size:"xs"}),Object(C.jsx)(r.EuiText,{size:"xs",color:"danger"},o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.notifyWhenThrottleWarning",{defaultMessage:"Custom action intervals cannot be shorter than the rule's check interval"})))))))},S=o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.actionNotifyWhen.forEachOption",{defaultMessage:"For each alert"}),M=o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.actionNotifyWhen.summaryOption",{defaultMessage:"Summary of alerts"}),U=Object(I.euiStyled)(r.EuiContextMenuItem)`
  min-width: 300px;
`;var N=n(233),W=n.n(N);const _=o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.warning.publicBaseUrl",{defaultMessage:"server.publicBaseUrl is not set. Generated URLs will be either relative or empty."});var D,B,P=n(32),L=n.n(P),q=n(21),R=n(61),G=n.n(R);const z=null!==(D=null===(B=L.a.tz)||void 0===B?void 0:B.names().map((e=>({label:e}))))&&void 0!==D?D:[{label:"UTC"}],$=({state:e,onChange:t})=>{const n=(()=>{var e,t;const n=null!==(e=Object(q.useUiSetting)("dateFormat:scaled"))&&void 0!==e?e:[["PT1M","HH:mm"]],[,i]=null!==(t=n.find((([e])=>"PT1M"===e)))&&void 0!==t?t:["","HH:mm"];return i})(),[s,c]=(e=>{const t={days:[],timezone:(()=>{var e,t;const n=Object(q.useUiSetting)("dateFormat:tz");return n&&"Browser"!==n?n:null!==(e=null===(t=L.a.tz)||void 0===t?void 0:t.guess())&&void 0!==e?e:"UTC"})(),hours:{start:"00:00",end:"00:00"}};return Object(i.useState)(e||t)})(e),[l,u]=Object(i.useState)([{label:s.timezone}]),d=Object(i.useMemo)((()=>Boolean(e)),[e]),p=(()=>{const e=Object(q.useUiSetting)("dateFormat:dow"),t=null!=e?e:"Sunday",n=E.I18N_WEEKDAY_OPTIONS_DDD.findIndex((e=>e.label.startsWith(t)));return[...E.I18N_WEEKDAY_OPTIONS_DDD.slice(n),...E.I18N_WEEKDAY_OPTIONS_DDD.slice(0,n)]})();Object(i.useEffect)((()=>{const n=d?s:void 0;G()(e,n)||t(n)}),[d,s,e,t]);const b=Object(i.useCallback)((()=>t(e?void 0:s)),[e,s,t]),g=Object(i.useCallback)((e=>{c({...s,...e})}),[s,c]),m=Object(i.useCallback)((e=>t=>{g({hours:{...s.hours,[e]:t.format("HH:mm")}})}),[g,s]),j=Object(i.useCallback)((e=>{if(!s)return;const t=Number(e),n=s.days.includes(t)?s.days.filter((e=>e!==t)):[...s.days,t];0!==n.length&&g({days:n})}),[s,g]),f=Object(i.useMemo)((()=>A.ISO_WEEKDAYS.reduce(((e,t)=>({...e,[t]:s.days.includes(t)})),{})),[s]),y=Object(i.useCallback)((e=>{u(e),e[0].label&&g({timezone:e[0].label})}),[g,u]),[h,O]=Object(i.useMemo)((()=>s.hours.start.split(":").map(Number)),[s]),[x,I]=Object(i.useMemo)((()=>s.hours.end.split(":").map(Number)),[s]);return Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSwitch,{label:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.ActionAlertsFilterTimeframeToggleLabel",{defaultMessage:"If alert is generated during timeframe"}),checked:d,onChange:b,"data-test-subj":"alertsFilterTimeframeToggle"}),d&&Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)(r.EuiFlexItem,null,Object(C.jsx)(r.EuiButtonGroup,{isFullWidth:!0,legend:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.ActionAlertsFilterTimeframeWeekdays",{defaultMessage:"Days of week"}),options:p,idToSelectedMap:f,type:"multi",onChange:j,"data-test-subj":"alertsFilterTimeframeWeekdayButtons"})),Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)(r.EuiFlexGroup,{alignItems:"center"},Object(C.jsx)(r.EuiFlexItem,{grow:2},Object(C.jsx)(r.EuiDatePickerRange,{fullWidth:!0,startDateControl:Object(C.jsx)(r.EuiDatePicker,{showTimeSelect:!0,showTimeSelectOnly:!0,dateFormat:n,timeFormat:n,selected:L()().set("hour",h).set("minute",O),onChange:m("start"),"data-test-subj":"alertsFilterTimeframeStart"}),endDateControl:Object(C.jsx)(r.EuiDatePicker,{showTimeSelect:!0,showTimeSelectOnly:!0,dateFormat:n,timeFormat:n,selected:L()().set("hour",x).set("minute",I),onChange:m("end"),"data-test-subj":"alertsFilterTimeframeEnd"})})),Object(C.jsx)(r.EuiFlexItem,{grow:1},Object(C.jsx)(r.EuiComboBox,{prepend:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.ActionAlertsFilterTimeframeTimezoneLabel",{defaultMessage:"Timezone"}),singleSelection:{asPlainText:!0},options:z,selectedOptions:l,onChange:y,isClearable:!1,"data-test-subj":"alertsFilterTimeframeTimezone"})))))};var V=n(215);const Q=({state:e,onChange:t,appName:n,featureIds:s,ruleTypeId:c})=>{var l;const[u,d]=Object(i.useState)(null!=e?e:{kql:"",filters:[]}),p=Object(i.useMemo)((()=>Boolean(e)),[e]);Object(i.useEffect)((()=>{const n=p?u:void 0;G()(e,n)||t(n)}),[p,u,e,t]);const b=Object(i.useCallback)((()=>t(e?void 0:u)),[e,u,t]),g=Object(i.useCallback)((e=>{d({...u,...e})}),[u,d]),m=Object(i.useCallback)((({query:e})=>g({kql:e})),[g]),j=Object(i.useCallback)((e=>g({filters:e})),[g]);return Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSwitch,{label:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.ActionAlertsFilterQueryToggleLabel",{defaultMessage:"If alert matches a query"}),checked:p,onChange:b,"data-test-subj":"alertsFilterQueryToggle"}),p&&Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)(V.AlertsSearchBar,{appName:n,featureIds:s,ruleTypeId:c,disableQueryLanguageSwitcher:!0,query:u.kql,filters:null!==(l=u.filters)&&void 0!==l?l:[],onQueryChange:m,onQuerySubmit:m,onFiltersUpdated:j,showFilterBar:!0,submitOnBlur:!0,showDatePicker:!1,showSubmitButton:!1,placeholder:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.ActionAlertsFilterQueryPlaceholder",{defaultMessage:"Filter alerts using KQL syntax"})})))};var K=n(57),H=n(138),Y=n(217);const X=(e,t)=>{var n,i,a,o;let s=t[e];return Object(b.isEmpty)(null!==(n=null===(i=s)||void 0===i?void 0:i.description)&&void 0!==n?n:"")&&e.includes("kibana.alert.")&&(s=t[e.replace("kibana.alert.","")]),null!==(a=null===(o=s)||void 0===o?void 0:o.description)&&void 0!==a?a:""};const J=o.i18n.translate("xpack.triggersActionsUI.sections.actionForm.preconfiguredTitleMessage",{defaultMessage:"(preconfigured)"}),Z=({actionItem:e,actionConnector:t,index:n,onAddConnector:c,onConnectorSelected:u,onDeleteAction:d,setActionUseAlertDataForTemplate:A,setActionParamsProperty:I,setActionFrequencyProperty:v,setActionAlertsFilterProperty:T,actionTypesIndex:F,connectors:E,defaultActionGroupId:w,defaultActionMessage:S,messageVariables:M,summaryMessageVariables:U,actionGroups:N,setActionGroupIdByIndex:D,actionTypeRegistry:B,isActionGroupDisabledForActionType:P,recoveryActionGroup:L,hideNotifyWhen:q=!1,defaultSummaryMessage:R,hasAlertsMappings:G,minimumThrottleInterval:z,notifyWhenSelectOptions:V,defaultNotifyWhenValue:Z,producerId:ee,featureId:te,ruleTypeId:ne,hasFieldsForAAD:ie,disableErrorMessages:ae})=>{var oe,se,re,ce,le,ue,de,pe,be,ge,me,je,fe,ye;const{application:{capabilities:he},http:Oe}=Object(O.b)().services,{euiTheme:xe}=Object(r.useEuiTheme)(),[Ae,Ie]=Object(i.useState)(!0),[ve,Te]=Object(i.useState)([]),Fe=null==N?void 0:N.find((({id:e})=>e===w)),Ee=null!==(oe=null==N?void 0:N.find((({id:t})=>t===e.group)))&&void 0!==oe?oe:Fe,[Ce,we]=Object(i.useState)(),[ke,Se]=Object(i.useState)({errors:{}}),[Me,Ue]=Object(i.useState)(null!==(se=e.frequency)&&void 0!==se&&se.throttle?Object(g.getDurationNumberInItsUnit)(e.frequency.throttle):null),[Ne,We]=Object(i.useState)(null!==(re=e.frequency)&&void 0!==re&&re.throttle?Object(g.getDurationUnitValue)(null===(ce=e.frequency)||void 0===ce?void 0:ce.throttle):"h"),[_e=-1,De]=null!=z?z:[-1,"s"],[Be,Pe]=Object(i.useState)(null),[Le,qe]=Object(i.useState)(!1),Re=null===(le=e.frequency)||void 0===le?void 0:le.summary,[Ge,ze]=Object(i.useState)(null!==(ue=null==e?void 0:e.useAlertDataForTemplate)&&void 0!==ue&&ue),[$e,Ve]=Object(i.useState)({}),{fields:Qe}=function(e,t,n){const[a,o]=Object(i.useState)(!1),[s,r]=Object(i.useState)([]);return Object(i.useEffect)((()=>{n&&0===s.length&&t&&(o(!0),async function({http:e,ruleTypeId:t}){return t&&e?await e.get(`${H.a}/aad_fields`,{query:{ruleTypeId:t}}):[]}({http:e,ruleTypeId:t}).then((e=>{r(e),o(!1)})))}),[s,n,e,t]),Object(i.useMemo)((()=>({isLoading:a,fields:s.map((e=>({name:e.name,description:X(e.name,Y.a)})))})),[s,a])}(Oe,ne,Ge),Ke=Object(i.useMemo)((()=>Ge?Qe:ve),[Qe,ve,Ge]);let He;try{He=Object(m.a)("showMustacheAutocompleteSwitch")&&ne}catch(e){He=!1}const Ye=Object(i.useCallback)((()=>{ze((e=>(A&&A(!e,n),!e)));const t={...e.params};for(const e of Object.keys(t)){var i;I(e,null!==(i=$e[e])&&void 0!==i?i:"",n)}Ve(t)}),[A,$e,Ve,I,e.params,n]),Xe=async()=>{const t=await B.get(e.actionTypeId);let n;return e.group===L&&(n=t.defaultRecoveredActionParams),n||(n=t.defaultActionParams),n},[Je,Ze]=Object(i.useMemo)((()=>{try{if(!Me)return[!1,!1];const e=Object(g.parseDuration)(`1${Ne}`),t=Object(g.parseDuration)(`1${De}`),n=e>t?Me:Math.max(Me,_e),i=Object(g.parseDuration)(`${Me}${Ne}`)>=t?Ne:De;return[n!==Me,i!==Ne]}catch(e){return[!1,!1]}}),[_e,De,Me,Ne]);Object(i.useEffect)((()=>{(async()=>{Te(M?function(e,t,n,i){const a=Object(h.b)(e,t,null==n?void 0:n.omitMessageVariables,i);return Object(b.partition)(a,(e=>!0!==e.deprecated)).reduce(((e,t)=>[...e,...t.sort(((e,t)=>e.name.toUpperCase().localeCompare(t.name.toUpperCase())))]),[])}(M,U,Ee,Re):[]);const t=await Xe();if(t)for(const[i,a]of Object.entries(t)){const t={};void 0!==e.params[i]&&null!==e.params[i]||(I(i,a,n),"string"==typeof a&&a.match(/{{.*?}}/g)||(t[i]=a)),Ve(t)}})()}),[e.group,null===(de=e.frequency)||void 0===de?void 0:de.summary]),Object(i.useEffect)((()=>{(async()=>{const e=await Xe();if(e&&Ce){const t={};for(const[i,a]of Object.entries(e))I(i,a,n),a.match(/{{.*?}}/g)||(t[i]=a);Ve(t)}})()}),[Ce]),Object(i.useEffect)((()=>{(async t=>{if(ae)return void Se({errors:{}});const n=await(null===(t=B.get(e.actionTypeId))||void 0===t?void 0:t.validateParams(e.params));Se(n)})()}),[e,ae]);const[et,tt]=Object(i.useState)(null);Object(i.useEffect)((()=>{(async()=>{tt(ae?null:Object(K.d)(e))})()}),[e,ae]),Object(i.useEffect)((()=>{Object(b.isEmpty)($e)&&e.params.subAction&&Ve(e.params)}),[e.params,$e]);const nt=Object(y.e)(he),it=(e,t)=>!!P&&P(e,t),at=Object(C.jsx)(k,{frequency:e.frequency,throttle:Me,throttleUnit:Ne,hasAlertsMappings:G,onNotifyWhenChange:Object(i.useCallback)((e=>{v("notifyWhen",e,n)}),[v,n]),onThrottleChange:Object(i.useCallback)(((e,t)=>{e&&(Ue(e),We(t)),v("throttle",e?`${e}${t}`:null,n)}),[v,n]),onSummaryChange:Object(i.useCallback)((e=>{qe(!0),v("summary",e,n)}),[v,n]),showMinimumThrottleWarning:Je,showMinimumThrottleUnitWarning:Ze,notifyWhenSelectOptions:V,defaultNotifyWhenValue:Z}),ot=B.get(t.actionTypeId);if(!ot)return null;const st=(null!==(pe=null==ot?void 0:ot.subtype)&&void 0!==pe?pe:[]).map((e=>e.id)),rt=ot.actionParamsFields,ct=Object(f.a)(F[t.actionTypeId],E.filter((e=>e.isPreconfigured))),lt=N&&Ee&&D&&!(null!==(be=e.frequency)&&void 0!==be&&be.summary),ut=ie||ee===p.ob.SIEM,dt=ct.isEnabled?Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSplitPanel.Inner,{color:"subdued",style:{borderBottom:`1px solid ${xe.colors.lightShade}`}},Object(C.jsx)(r.EuiFormRow,{fullWidth:!0,label:Object(C.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionTypeForm.actionIdLabel",defaultMessage:"{connectorInstance} connector",values:{connectorInstance:F?F[t.actionTypeId].name:t.actionTypeId}}),labelAppend:nt&&F&&F[t.actionTypeId].enabledInConfig?Object(C.jsx)(r.EuiButtonEmpty,{size:"xs","data-test-subj":`addNewActionConnectorButton-${e.actionTypeId}`,onClick:c},Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Add connector",id:"xpack.triggersActionsUI.sections.actionTypeForm.addNewConnectorEmptyButton"})):null},Object(C.jsx)(x.a,{allowGroupConnector:st,actionItem:e,accordionIndex:n,actionTypesIndex:F,actionTypeRegistered:ot,connectors:E,onConnectorSelected:u})),Object(C.jsx)(r.EuiSpacer,{size:"xl"}),!q&&at,lt&&Object(C.jsx)(a.a.Fragment,null,!q&&Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)(r.EuiSuperSelect,{prepend:Object(C.jsx)(r.EuiFormLabel,{htmlFor:`addNewActionConnectorActionGroup-${e.actionTypeId}`},Object(C.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionTypeForm.actionRunWhenInActionGroup",defaultMessage:"Run when"})),fullWidth:!0,id:`addNewActionConnectorActionGroup-${e.actionTypeId}`,"data-test-subj":`addNewActionConnectorActionGroup-${n}`,options:N.map((({id:t,name:i})=>{return{value:t,inputDisplay:(a=t,s=i,r=e.actionTypeId,P&&P(a,r)?o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.addNewActionConnectorActionGroup.display",{defaultMessage:"{actionGroupName} (Not Currently Supported)",values:{actionGroupName:s}}):s),disabled:it(t,e.actionTypeId),"data-test-subj":`addNewActionConnectorActionGroup-${n}-option-${t}`};var a,s,r})),valueOfSelected:Ee.id,onChange:e=>{D(e,n),we(e)}})),ut&&Object(C.jsx)(a.a.Fragment,null,!q&&Object(C.jsx)(r.EuiSpacer,{size:"xl"}),Object(C.jsx)(r.EuiFormRow,{error:et,isInvalid:!!et,fullWidth:!0},Object(C.jsx)(Q,{state:null===(ge=e.alertsFilter)||void 0===ge?void 0:ge.query,onChange:e=>T("query",e,n),featureIds:[ee],appName:te,ruleTypeId:ne})),Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)($,{state:null===(me=e.alertsFilter)||void 0===me?void 0:me.timeframe,onChange:e=>T("timeframe",e,n)}))),Object(C.jsx)(r.EuiSplitPanel.Inner,{color:"plain"},rt?Object(C.jsx)(r.EuiErrorBoundary,null,Object(C.jsx)(r.EuiFlexGroup,{gutterSize:"m",direction:"column"},He&&Object(C.jsx)(r.EuiFlexItem,null,Object(C.jsx)(r.EuiSwitch,{label:"Use template fields from alerts index",checked:Ge,onChange:Ye,"data-test-subj":"mustacheAutocompleteSwitch"})),Object(C.jsx)(r.EuiFlexItem,null,Object(C.jsx)(i.Suspense,{fallback:null},Object(C.jsx)(rt,{actionParams:e.params,errors:ke.errors,index:n,selectedActionGroupId:null==Ee?void 0:Ee.id,editAction:(e,t,n)=>{Pe(function(e,t,n){if(!t&&e&&"string"==typeof e){const t=(n||[]).reduce(((e,t)=>(t.usesPublicBaseUrl&&(e.push(t.name.replace(/^(params\.|context\.|state\.)/,"")),e.push(t.name)),e)),new Array);try{const n=new Set(W.a.parse(e).filter((([e])=>"name"===e)).map((([,e])=>e)));if(Object(b.some)(t,(e=>n.has(e))))return _}catch(e){return _}}return null}(t,Oe.basePath.publicBaseUrl,ve)),I(e,t,n)},messageVariables:Ke,defaultMessage:Re?R:null!==(je=null==Ee?void 0:Ee.defaultActionMessage)&&void 0!==je?je:S,useDefaultMessage:Le,actionConnector:t,executionMode:j.b.ActionForm,ruleTypeId:ne}),Be?Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSpacer,{size:"s"}),Object(C.jsx)(r.EuiCallOut,{size:"s",color:"warning",title:Be})):null)))):null)):ct.messageCard;return Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiSplitPanel.Outer,{hasShadow:Ae},Object(C.jsx)(r.EuiAccordion,{initialIsOpen:!0,key:n,id:n.toString(),onToggle:Ie,paddingSize:"none",className:"actAccordionActionForm",buttonContentClassName:"actAccordionActionForm__button","data-test-subj":`alertActionAccordion-${n}`,buttonContent:Object(C.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},!Ae&&Object(b.some)(ke.errors,(e=>!Object(b.isEmpty)(e)))?Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiToolTip,{content:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.actionErrorToolTip",{defaultMessage:"Action contains errors."})},Object(C.jsx)(r.EuiIcon,{"data-test-subj":"action-group-error-icon",type:"warning",color:"danger",size:"m"}))):Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiIcon,{type:ot.iconClass,size:"m"})),Object(C.jsx)(r.EuiFlexItem,null,Object(C.jsx)(r.EuiText,null,Object(C.jsx)("div",null,Object(C.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(s.FormattedMessage,{defaultMessage:"{actionConnectorName}",id:"xpack.triggersActionsUI.sections.actionTypeForm.existingAlertActionTypeEditTitle",values:{actionConnectorName:`${t.name} ${t.isPreconfigured?J:""}`}})),(Ee||(null===(fe=e.frequency)||void 0===fe?void 0:fe.summary))&&!Ae&&Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiBadge,{iconType:"clock"},null!==(ye=e.frequency)&&void 0!==ye&&ye.summary?o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.summaryGroupTitle",{defaultMessage:"Summary of alerts"}):o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.runWhenGroupTitle",{defaultMessage:"Run when {groupName}",values:{groupName:Ee.name.toLocaleLowerCase()}}))),Be&&!Ae&&Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiBadge,{"data-test-subj":"warning-badge",iconType:"warning",color:"warning"},o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.actionWarningsTitle",{defaultMessage:"1 warning"}))),Object(C.jsx)(r.EuiFlexItem,{grow:!1},!1===ct.isEnabled&&Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiIconTip,{type:"warning",color:"danger",content:o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.actionDisabledTitle",{defaultMessage:"This action is disabled"}),position:"right"}))))))),ot&&ot.isExperimental&&Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiBetaBadge,{"data-test-subj":"action-type-form-beta-badge",label:l.a.label,tooltipContent:l.a.tooltipContent}))),extraAction:Object(C.jsx)(r.EuiButtonIcon,{iconType:"minusInCircle",color:"danger",className:"actAccordionActionForm__extraAction","aria-label":o.i18n.translate("xpack.triggersActionsUI.sections.actionTypeForm.accordion.deleteIconAriaLabel",{defaultMessage:"Delete"}),onClick:d})},dt)),Object(C.jsx)(r.EuiSpacer,{size:"l"}))};var ee=n(97),te=n(198),ne=n(20),ie=n(4);const ae=({actions:e,defaultActionGroupId:t,setActionIdByIndex:n,setActionGroupIdByIndex:p,setActionUseAlertDataForTemplate:b,setActions:g,setActionParamsProperty:m,setActionFrequencyProperty:j,setActionAlertsFilterProperty:y,featureId:h,messageVariables:x,summaryMessageVariables:A,actionGroups:I,defaultActionMessage:v,setHasActionsDisabled:T,setHasActionsWithBrokenConnector:F,actionTypeRegistry:w,recoveryActionGroup:k,isActionGroupDisabledForActionType:S,hideActionHeader:M,hideNotifyWhen:U,defaultSummaryMessage:N,hasAlertsMappings:W,minimumThrottleInterval:_,notifyWhenSelectOptions:D,defaultRuleFrequency:B=E.DEFAULT_FREQUENCY,ruleTypeId:P,producerId:L,hasFieldsForAAD:q,disableErrorMessages:R})=>{const{http:G,notifications:{toasts:z}}=Object(O.b)().services,[$,V]=Object(i.useState)(!1),[Q,K]=Object(i.useState)(void 0),[H,Y]=Object(i.useState)(!0),[X,J]=Object(i.useState)([]),[ae,oe]=Object(i.useState)(!1),[se,re]=Object(i.useState)(!1),[ce,le]=Object(i.useState)(void 0),[ue,de]=Object(i.useState)([]),pe=Object(i.useCallback)((()=>V(!1)),[V]);Object(i.useEffect)((()=>{(async()=>{try{re(!0);const e=(await Object(u.d)({http:G,featureId:h})).sort(((e,t)=>e.name.localeCompare(t.name))),t={};for(const n of e)t[n.id]=n;le(t)}catch(e){z.addDanger({title:o.i18n.translate("xpack.triggersActionsUI.sections.actionForm.unableToLoadConnectorTypesMessage",{defaultMessage:"Unable to load connector types"})})}finally{re(!1)}})()}),[]),Object(i.useEffect)((()=>{(async()=>{try{oe(!0);const e=await Object(u.e)({http:G});J(e.filter((e=>!e.isMissingSecrets)))}catch(e){z.addDanger({title:o.i18n.translate("xpack.triggersActionsUI.sections.actionForm.unableToLoadActionsMessage",{defaultMessage:"Unable to load connectors"})})}finally{oe(!1)}})()}),[]),Object(i.useEffect)((()=>{X.length>0&&ce&&(()=>{const t=X.filter((e=>e.isPreconfigured)),n=e.some((e=>ce&&!ce[e.actionTypeId].enabled&&!Object(f.a)(ce[e.actionTypeId],t).isEnabled));T&&T(n)})()}),[X,ce]),Object(i.useEffect)((()=>{const t=e.some((e=>!X.find((t=>t.id===e.id))));F&&F(t)}),[e,X]);let be=null,ge=!1;if(ce){const i=X.filter((e=>e.isPreconfigured));be=w.list().filter((e=>ce[e.id]&&!e.hideInUi)).filter((e=>!!e.actionParamsFields)).sort(((e,t)=>Object(te.a)(ce[e.id],ce[t.id],i))).map((function(a,s){const u=ce[a.id],d=Object(f.a)(ce[a.id],i);if(!u.enabledInConfig&&!d.isEnabled)return null;u.enabledInLicense||(ge=!0);const p=Object(C.jsx)(r.EuiKeyPadMenuItem,{key:s,isDisabled:!d.isEnabled,"data-test-subj":`${a.id}-${h}-ActionTypeSelectOption`,label:ce[a.id].name,betaBadgeLabel:a.isExperimental?l.a.label:void 0,betaBadgeTooltipContent:a.isExperimental?l.a.tooltipContent:void 0,onClick:()=>function(i){var a;if(!t)return void z.addDanger({title:o.i18n.translate("xpack.triggersActionsUI.sections.actionForm.unableToAddAction",{defaultMessage:"Unable to add action, because default action group is not defined"})});Y(!1);const s=(null!==(a=null==i?void 0:i.subtype)&&void 0!==a?a:[]).map((e=>e.id));let r=X.filter((e=>e.actionTypeId===i.id));r.length>0?(e.push({id:"",actionTypeId:i.id,group:t,params:{},frequency:B,uuid:Object(c.v4)()}),n(r[0].id,e.length-1)):(r=X.filter((e=>s.includes(e.actionTypeId))),r.length>0&&(e.push({id:"",actionTypeId:r[0].actionTypeId,group:t,params:{},frequency:E.DEFAULT_FREQUENCY,uuid:Object(c.v4)()}),n(r[0].id,e.length-1))),0===r.length&&(e.push({id:"",actionTypeId:i.id,group:t,params:{},frequency:B}),n(e.length.toString(),e.length-1),de([...ue,e.length.toString()]))}(a)},Object(C.jsx)(r.EuiIcon,{size:"xl",type:"string"==typeof a.iconClass?a.iconClass:Object(ie.a)(a.iconClass)}));return Object(C.jsx)(r.EuiFlexItem,{grow:!1,key:`keypad-${a.id}`},d.isEnabled&&p,!1===d.isEnabled&&Object(C.jsx)(r.EuiToolTip,{position:"top",content:d.message},p))}))}return ae?Object(C.jsx)(d.a,null,Object(C.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionForm.loadingConnectorsDescription",defaultMessage:"Loading connectors…"})):Object(C.jsx)(a.a.Fragment,null,!M&&Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiTitle,{size:"s"},Object(C.jsx)("h4",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Actions",id:"xpack.triggersActionsUI.sections.actionForm.actionSectionsTitle"}))),Object(C.jsx)(r.EuiSpacer,{size:"m"})),ce&&e.map(((i,a)=>{const o=X.find((e=>e.id===i.id));return o?Object(C.jsx)(Z,{actionItem:i,actionConnector:o,index:a,key:`action-form-action-at-${i.uuid}`,setActionUseAlertDataForTemplate:b,setActionParamsProperty:m,setActionFrequencyProperty:j,setActionAlertsFilterProperty:y,actionTypesIndex:ce,connectors:X,defaultActionGroupId:t,messageVariables:x,summaryMessageVariables:A,actionGroups:I,defaultActionMessage:v,recoveryActionGroup:k,isActionGroupDisabledForActionType:S,setActionGroupIdByIndex:p,onAddConnector:()=>{K({actionTypeId:i.actionTypeId,indices:[a]}),V(!0)},onConnectorSelected:t=>{n(t,a);const i=X.find((e=>e.id===t));if(i&&o&&i.actionTypeId!==o.actionTypeId){const n=w.get(i.actionTypeId);if(n.convertParamsBetweenGroups){const o=e.map(((e,o)=>o===a?{...e,actionTypeId:i.actionTypeId,id:t,params:null!=n.convertParamsBetweenGroups?n.convertParamsBetweenGroups(e.params):{}}:e));g(o)}}},actionTypeRegistry:w,onDeleteAction:()=>{const t=e.filter(((e,t)=>t!==a));g(t),Y(0===t.length),K(void 0)},hideNotifyWhen:U,defaultSummaryMessage:N,hasAlertsMappings:W,minimumThrottleInterval:_,notifyWhenSelectOptions:D,defaultNotifyWhenValue:B.notifyWhen,featureId:h,producerId:L,ruleTypeId:P,hasFieldsForAAD:q,disableErrorMessages:R}):Object(C.jsx)(ee.AddConnectorInline,{actionTypesIndex:ce,actionItem:i,index:a,key:`action-form-action-at-${a}`,actionTypeRegistry:w,emptyActionsIds:ue,connectors:X,onDeleteConnector:()=>{const t=e.filter(((e,t)=>t!==a));g(t),Y(0===t.filter((e=>e.id!==i.id)).length),K(void 0)},onAddConnector:()=>{K({actionTypeId:i.actionTypeId,indices:e.map(((e,t)=>e.id===i.id?t:-1)).filter((e=>e>=0))}),V(!0)},onSelectConnector:t=>{n(t,a);const i=X.find((e=>e.id===t));if(i&&i.actionTypeId){const n=w.get(i.actionTypeId);if(n.convertParamsBetweenGroups){const o=e.map(((e,o)=>o===a?{...e,actionTypeId:i.actionTypeId,id:t,params:null!=n.convertParamsBetweenGroups?n.convertParamsBetweenGroups(e.params):{}}:e));g(o)}}}})})),H?Object(C.jsx)(a.a.Fragment,null,Object(C.jsx)(r.EuiFlexGroup,{id:"alertActionTypeTitle",justifyContent:"spaceBetween"},Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiTitle,{size:"xs"},Object(C.jsx)("h5",null,Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Select a connector type",id:"xpack.triggersActionsUI.sections.actionForm.selectConnectorTypeTitle"})))),ge&&Object(C.jsx)(r.EuiFlexItem,{grow:!1},Object(C.jsx)(r.EuiTitle,{size:"xs"},Object(C.jsx)("h5",null,Object(C.jsx)(r.EuiLink,{href:E.VIEW_LICENSE_OPTIONS_LINK,target:"_blank",external:!0,className:"actActionForm__getMoreActionsLink"},Object(C.jsx)(s.FormattedMessage,{defaultMessage:"Get more connectors",id:"xpack.triggersActionsUI.sections.actionForm.getMoreConnectorsTitle"})))))),Object(C.jsx)(r.EuiSpacer,null),Object(C.jsx)(r.EuiFlexGroup,{gutterSize:"m",wrap:!0},se?Object(C.jsx)(d.a,null,Object(C.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionForm.loadingConnectorTypesDescription",defaultMessage:"Loading connector types…"})):be)):Object(C.jsx)(r.EuiFlexGroup,null,Object(C.jsx)(r.EuiFlexItem,{grow:!0},Object(C.jsx)(r.EuiButton,{size:"m",fullWidth:!0,iconType:"plusInCircle","data-test-subj":"addAlertActionButton",onClick:()=>Y(!0)},Object(C.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.actionForm.addActionButtonLabel",defaultMessage:"Add action"})))),ce&&Q&&$?Object(C.jsx)(ne.b,{actionType:ce[Q.actionTypeId],onClose:pe,postSaveEventHandler:t=>{e[0].actionTypeId=t.actionTypeId,X.push(t),(Q.indices||[]).forEach((e=>n(t.id,e)))},actionTypeRegistry:w}):null)}},97:function(e,t,n){"use strict";n.r(t),n.d(t,"AddConnectorInline",(function(){return g})),n.d(t,"default",(function(){return g}));var i=n(1),a=n.n(i),o=n(2),s=n(26),r=n(3),c=n(125),l=n(117),u=n(30),d=n(154),p=n(167),b=n(0);const g=({actionTypesIndex:e,actionItem:t,index:n,connectors:g,onAddConnector:m,onDeleteConnector:j,onSelectConnector:f,actionTypeRegistry:y,emptyActionsIds:h})=>{var O;const{application:{capabilities:x}}=Object(u.b)().services,A=Object(l.e)(x),[I,v]=Object(i.useState)(!1),[T,F]=Object(i.useState)(!1),E=e?e[t.actionTypeId].name:t.actionTypeId,C=y.get(t.actionTypeId),w=(null!==(O=null==C?void 0:C.subtype)&&void 0!==O?O:[]).map((e=>e.id)),k=Object(i.useMemo)((()=>[`Unable to load ${C.actionTypeTitle} connector`]),[C.actionTypeTitle]),S=Object(b.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.connectorAddInline.emptyConnectorsLabel",defaultMessage:"No {actionTypeName} connectors",values:{actionTypeName:E}}),M=Object(b.jsx)(r.EuiText,{color:"danger"},Object(b.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.connectorAddInline.unableToLoadConnectorTitle",defaultMessage:"Unable to load connector"}));Object(i.useEffect)((()=>{Object(d.a)(g,t,e,w).length>0&&v(!0),F(!!h.find((e=>t.id===e)))}),[]);const U=Object(b.jsx)(r.EuiFormRow,{fullWidth:!0,label:Object(b.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.connectorAddInline.connectorAddInline.actionIdLabel",defaultMessage:"Use another {connectorInstance} connector",values:{connectorInstance:E}}),labelAppend:Object(b.jsx)(r.EuiButtonEmpty,{size:"xs","data-test-subj":`addNewActionConnectorButton-${t.actionTypeId}`,onClick:m},Object(b.jsx)(s.FormattedMessage,{defaultMessage:"Add connector",id:"xpack.triggersActionsUI.sections.connectorAddInline.connectorAddInline.addNewConnectorEmptyButton"})),error:k,isInvalid:!0},Object(b.jsx)(p.a,{actionItem:t,accordionIndex:n,actionTypesIndex:e,actionTypeRegistered:C,connectors:g,onConnectorSelected:f,allowGroupConnector:w}));return Object(b.jsx)(a.a.Fragment,null,Object(b.jsx)(r.EuiAccordion,{key:n,initialIsOpen:!0,id:n.toString(),className:"actAccordionActionForm",buttonContentClassName:"actAccordionActionForm__button","data-test-subj":`alertActionAccordion-${n}`,buttonContent:Object(b.jsx)(r.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(b.jsx)(r.EuiFlexItem,{grow:!1},Object(b.jsx)(r.EuiIcon,{type:C.iconClass,size:"m"})),Object(b.jsx)(r.EuiFlexItem,null,Object(b.jsx)(r.EuiText,null,Object(b.jsx)("div",null,Object(b.jsx)(s.FormattedMessage,{defaultMessage:"{actionConnectorName}",id:"xpack.triggersActionsUI.sections.connectorAddInline.newRuleActionTypeEditTitle",values:{actionConnectorName:C.actionTypeTitle}})))),!T&&Object(b.jsx)(r.EuiFlexItem,{grow:!1},Object(b.jsx)(r.EuiIconTip,{type:"warning",size:"m",color:"danger","data-test-subj":"alertActionAccordionErrorTooltip",content:Object(b.jsx)(s.FormattedMessage,{defaultMessage:"Unable to load connector",id:"xpack.triggersActionsUI.sections.connectorAddInline.unableToLoadConnectorTitle'"})})),C&&C.isExperimental&&Object(b.jsx)(r.EuiFlexItem,{grow:!1},Object(b.jsx)(r.EuiBetaBadge,{label:c.a.label,tooltipContent:c.a.tooltipContent}))),extraAction:Object(b.jsx)(r.EuiButtonIcon,{iconType:"minusInCircle",color:"danger",className:"actAccordionActionForm__extraAction","aria-label":o.i18n.translate("xpack.triggersActionsUI.sections.connectorAddInline.accordion.deleteIconAriaLabel",{defaultMessage:"Delete"}),onClick:j}),paddingSize:"l"},A?I?U:Object(b.jsx)(r.EuiEmptyPrompt,{title:T?S:M,actions:Object(b.jsx)(r.EuiButton,{color:"primary",fill:!0,size:"s","data-test-subj":`createActionConnectorButton-${n}`,onClick:m},Object(b.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.connectorAddInline.addConnectorButtonLabel",defaultMessage:"Create a connector"}))}):Object(b.jsx)(r.EuiCallOut,{title:S},Object(b.jsx)("p",null,Object(b.jsx)(s.FormattedMessage,{id:"xpack.triggersActionsUI.sections.connectorAddInline.unauthorizedToCreateForEmptyConnectors",defaultMessage:"Only authorized users can configure a connector. Contact your administrator."})))),Object(b.jsx)(r.EuiSpacer,{size:"xs"}))}}}]);