/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[17,48,58],{117:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return u})),n.d(t,"d",(function(){return c}));const i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},a=(e,t)=>{var n,i;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(i=e.actions)||void 0===i?void 0:i.execute},r=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function u(e,t){var n,i;return null!==(n=null==t||null===(i=t.authorizedConsumers[e])||void 0===i?void 0:i.all)&&void 0!==n&&n}const c=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},121:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(6);const s=({decryption_health:e,execution_health:t,read_health:n,...i})=>({decryptionHealth:e,executionHealth:t,readHealth:n,...i}),a=({is_sufficiently_secure:e,has_permanent_encryption_key:t,alerting_framework_health:n,...i})=>({isSufficientlySecure:e,hasPermanentEncryptionKey:t,alertingFrameworkHealth:n,...i});async function r({http:e}){const t=await e.get(`${i.b}/_health`),n=s(t.alerting_framework_health);return{...a(t),alertingFrameworkHealth:n}}},129:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(2),s=n(1),a=n.n(s),r=n(3),u=n(0);const c=i.i18n.translate("xpack.triggersActionsUI.components.toastWithCircuitBreaker.seeFullError",{defaultMessage:"See full error"}),l=i.i18n.translate("xpack.triggersActionsUI.components.toastWithCircuitBreaker.hideFullError",{defaultMessage:"Hide full error"}),o=({children:e})=>{const[t,n]=Object(s.useState)(!1),i=Object(s.useCallback)((()=>{n((e=>!e))}),[]);return Object(u.jsx)(a.a.Fragment,null,t&&Object(u.jsx)(a.a.Fragment,null,Object(u.jsx)(r.EuiText,{size:"s"},e),Object(u.jsx)(r.EuiSpacer,null)),Object(u.jsx)(r.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},Object(u.jsx)(r.EuiFlexItem,{grow:!1},Object(u.jsx)(r.EuiButton,{size:"s",color:"danger",onClick:i},t?l:c))))}},134:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(27);async function s({http:e}){return await e.get(`${i.a}/_config`)}},171:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(11),s=n(2);const a=e=>({isEnabled:!1,message:s.i18n.translate("xpack.triggersActionsUI.checkRuleTypeEnabled.ruleTypeDisabledByLicenseMessage",{defaultMessage:"This rule type requires a {minimumLicenseRequired} license.",values:{minimumLicenseRequired:Object(i.upperFirst)(e.minimumLicenseRequired)}})});function r(e){return!1===(null==e?void 0:e.enabledInLicense)?a(e):{isEnabled:!0}}},80:function(e,t,n){"use strict";n.r(t),n.d(t,"RuleEdit",(function(){return I})),n.d(t,"default",(function(){return I}));var i=n(1),s=n.n(i),a=n(26),r=n(12),u=n(3),c=n(11),l=n(2),o=n(21),d=n(19),j=n(177),b=n(172),g=n(142),f=n(6),p=n(34);const y=({actions:e,...t})=>({...t,actions:e.map((({group:e,id:t,params:n,frequency:i,uuid:s,alertsFilter:a,useAlertDataForTemplate:r})=>({group:e,id:t,params:n,frequency:{notify_when:i.notifyWhen,throttle:i.throttle,summary:i.summary},alerts_filter:a,...void 0!==r?{use_alert_data_for_template:r}:{},...s&&{uuid:s}})))});var h=n(55),m=n(139),O=n(124),x=n(30),E=n(173),v=n(174),T=n(57),k=n(134),F=n(129),w=n(0);const S=l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveErrorNotificationText",{defaultMessage:"Cannot update rule."}),C=e=>{const t=Object(c.cloneDeep)(Object(c.omit)(e,"notifyWhen","throttle")),n=Boolean(e.notifyWhen),i=Boolean(e.throttle);if(n||i){const i=n?{summary:!1,notifyWhen:e.notifyWhen,throttle:e.notifyWhen===r.RuleNotifyWhen.THROTTLE?e.throttle:null}:{summary:!1,notifyWhen:r.RuleNotifyWhen.THROTTLE,throttle:e.throttle};t.actions=t.actions.map((e=>({...e,frequency:i})))}return t},I=({initialRule:e,onClose:t,reloadRules:n,onSave:I,hideInterval:_,ruleTypeRegistry:R,actionTypeRegistry:A,metadata:B,...M})=>{const U=null!=I?I:n,[{rule:L},W]=Object(i.useReducer)(g.a,{rule:C(e)}),[H,D]=Object(i.useState)(!1),[N,z]=Object(i.useState)(!1),[q,P]=Object(i.useState)(!1),[$,G]=Object(i.useState)(!1),[J,K]=Object(i.useState)([]),[V,Q]=Object(i.useState)(!1),[X,Y]=Object(i.useState)(M.ruleType),[Z,ee]=Object(i.useState)({isUsingSecurity:!1}),[te,ne]=Object(i.useState)(B),ie=Object(i.useCallback)((e=>ne(e)),[]),{http:se,notifications:{toasts:ae}}=Object(x.b)().services,re=e=>{W({command:{type:"setRule"},payload:{key:"rule",value:e}})},ue=R.get(L.ruleTypeId);Object(i.useEffect)((()=>{(async()=>{ee(await Object(k.a)({http:se}))})()}),[se]),Object(i.useEffect)((()=>{(async()=>{Q(!0);const e=await Object(b.a)(L.actions,A);K([...e]),Q(!1)})()}),[L.actions,A]),Object(i.useEffect)((()=>{M.ruleType||X||(async()=>{const e=await Object(h.a)({http:se});for(const t of e)ue.id===t.id&&Y(t)})()}),[M.ruleType,ue.id,X,se]);const{ruleBaseErrors:ce,ruleErrors:le,ruleParamsErrors:oe}=Object(b.b)(L,ue,Z),de=()=>{Object(v.a)(L,e,!0)?G(!0):t(d.m.CANCELED,te)};return Object(w.jsx)(u.EuiPortal,null,Object(w.jsx)(u.EuiFlyout,{onClose:de,"aria-labelledby":"flyoutRuleEditTitle",size:"m",maxWidth:620,ownFocus:!0},Object(w.jsx)(u.EuiFlyoutHeader,{hasBorder:!0},Object(w.jsx)(u.EuiTitle,{size:"s","data-test-subj":"editRuleFlyoutTitle"},Object(w.jsx)("h3",{id:"flyoutTitle"},Object(w.jsx)(a.FormattedMessage,{defaultMessage:"Edit rule",id:"xpack.triggersActionsUI.sections.ruleEdit.flyoutTitle"})))),Object(w.jsx)(O.a,null,Object(w.jsx)(m.a,{inFlyout:!0,waitForCheck:!0},Object(w.jsx)(u.EuiFlyoutBody,null,N&&Object(w.jsx)(s.a.Fragment,null,Object(w.jsx)(u.EuiCallOut,{size:"s",color:"danger",iconType:"rule","data-test-subj":"hasActionsDisabled",title:l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.disabledActionsWarningTitle",{defaultMessage:"This rule has actions that are disabled"})}),Object(w.jsx)(u.EuiSpacer,null)),Object(w.jsx)(j.a,{rule:L,config:Z,dispatch:W,errors:le,actionTypeRegistry:A,hideInterval:_,ruleTypeRegistry:R,canChangeTrigger:!1,setHasActionsDisabled:z,setHasActionsWithBrokenConnector:P,operation:l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.operationName",{defaultMessage:"edit"}),metadata:te,onChangeMetaData:ie})),Object(w.jsx)(u.EuiFlyoutFooter,null,Object(w.jsx)(u.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(w.jsx)(u.EuiFlexItem,{grow:!1},Object(w.jsx)(u.EuiButtonEmpty,{"data-test-subj":"cancelSaveEditedRuleButton",onClick:()=>de()},l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.cancelButtonLabel",{defaultMessage:"Cancel"}))),V?Object(w.jsx)(u.EuiFlexItem,{grow:!1},Object(w.jsx)(u.EuiSpacer,{size:"s"}),Object(w.jsx)(u.EuiLoadingSpinner,{size:"l"})):Object(w.jsx)(s.a.Fragment,null),Object(w.jsx)(u.EuiFlexItem,{grow:!1},Object(w.jsx)(u.EuiFlexGroup,{alignItems:"center"},Z.isUsingSecurity&&Object(w.jsx)(u.EuiFlexItem,{grow:!1},Object(w.jsx)(u.EuiIconTip,{type:"warning",position:"top","data-test-subj":"changeInPrivilegesTip",content:l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.changeInPrivilegesLabel",{defaultMessage:"Saving this rule will change its privileges and might change its behavior."})})),Object(w.jsx)(u.EuiFlexItem,{grow:!1},Object(w.jsx)(u.EuiButton,{fill:!0,color:"success","data-test-subj":"saveEditedRuleButton",type:"submit",iconType:"check",isLoading:H,onClick:async()=>await async function(){D(!0);try{if(V||!Object(b.c)(L,le,J)||q)re(Object(T.a)(L,oe,ce,J));else{const e=await async function({http:e,rule:t,id:n}){const i=await e.put(`${f.b}/rule/${encodeURIComponent(n)}`,{body:JSON.stringify(y(Object(c.pick)(t,["name","tags","schedule","params","actions"])))});return Object(p.b)(i)}({http:se,rule:L,id:L.id});ae.addSuccess(l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveSuccessNotificationText",{defaultMessage:"Updated '{ruleName}'",values:{ruleName:e.name}})),t(d.m.SAVED,te),U&&U(te)}}catch(t){var e;const n=Object(r.parseRuleCircuitBreakerErrorMessage)((null===(e=t.body)||void 0===e?void 0:e.message)||S);ae.addDanger({title:n.summary,...n.details&&{text:Object(o.toMountPoint)(Object(w.jsx)(F.a,null,n.details))}})}D(!1)}()},Object(w.jsx)(a.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleEdit.saveButtonLabel",defaultMessage:"Save"}))))))))),$&&Object(w.jsx)(E.a,{onConfirm:()=>{G(!1),t(d.m.CANCELED,te)},onCancel:()=>{G(!1)}})))}}}]);