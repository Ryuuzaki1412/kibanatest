/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[35,42,59],{108:function(e,t,n){"use strict";n.r(t),n.d(t,"RuleDefinition",(function(){return v})),n.d(t,"default",(function(){return v}));var s=n(13),i=n.n(s),o=n(1),r=n(3),l=n(10),u=n(2),a=n(12),c=n(54),j=n(30),d=n(117),x=n(76),b=n(22);const g=e=>u.i18n.translate("xpack.triggersActionsUI.ruleDetails.connectorsLoadError",{defaultMessage:"Unable to load rule actions connectors. Reason: {message}",values:{message:e}});var p=n(165),O=n(0);function m({ruleActions:e,actionTypeRegistry:t,legacyNotifyWhen:n}){const{isLoadingActionConnectors:s,actionConnectors:i}=function({ruleActions:e}){const{http:t,notifications:{toasts:n}}=Object(j.b)().services,[s,i]=Object(o.useState)({isLoadingActionConnectors:!0,actionConnectors:[],errorActionConnectors:void 0}),r=Object(o.useCallback)((async()=>{try{if(!e||e.length<=0)return void i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:[]})));const n=await Object(b.e)({http:t});i((e=>({...e,isLoadingActionConnectors:!1,actionConnectors:n})))}catch(e){const t=g(e instanceof Error?e.message:"string"==typeof e?e:"");i((e=>({...e,isLoadingActionConnectors:!1,errorActionConnectors:t}))),n.addDanger({title:t})}}),[t,e,n]);return Object(o.useEffect)((()=>{r()}),[r]),{...s,reloadRuleActionConnectors:r}}({ruleActions:e}),l=i&&i.length>0,a=e&&e.length>0;if(!l||!a)return Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{size:"s"},u.i18n.translate("xpack.triggersActionsUI.ruleDetails.noActions",{defaultMessage:"No actions"})));const c=e=>{const n=t.list().find((t=>t.id===e));return"string"==typeof(null==n?void 0:n.iconClass)?null==n?void 0:n.iconClass:Object(x.suspendedComponentWithProps)(null==n?void 0:n.iconClass)};return s?Object(O.jsx)(r.EuiLoadingSpinner,{size:"s"}):Object(O.jsx)(r.EuiFlexGroup,{direction:"column",gutterSize:"none"},e.map(((e,t)=>{var s;const{actionTypeId:o,id:l}=e,u=(e=>{const t=i.find((t=>t.id===e));return null==t?void 0:t.name})(l);return Object(O.jsx)(r.EuiFlexItem,{key:t},Object(O.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"s",component:"span"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiIcon,{size:"m",type:null!==(s=c(o))&&void 0!==s?s:"apps"})),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{"data-test-subj":`actionConnectorName-${t}-${u||o}`,size:"s"},u),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",component:"span"},Object(O.jsx)(r.EuiSpacer,{size:"xs"}),Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiIcon,{size:"s",type:"bell"})),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{"data-test-subj":`actionConnectorName-${t}-${u||o}`,size:"xs"},String((e=>{var t,s,i;return null!==(t=(null===(s=p.NOTIFY_WHEN_OPTIONS.find((t=>{var n;return t.value===(null===(n=e.frequency)||void 0===n?void 0:n.notifyWhen)})))||void 0===s?void 0:s.inputDisplay)||(null===(i=e.frequency)||void 0===i?void 0:i.notifyWhen))&&void 0!==t?t:n})(e))))))),Object(O.jsx)(r.EuiSpacer,{size:"s"}))})))}var f=n(38);const v=({rule:e,actionTypeRegistry:t,ruleTypeRegistry:n,onEditRule:s,hideEditButton:i=!1,filteredRuleTypes:x=[]})=>{var b;const{application:{capabilities:g}}=Object(j.b)().services,[p,v]=Object(o.useState)(!1),[I,h]=Object(o.useState)(),{ruleTypesState:{data:F,isLoading:A}}=Object(c.a)({filteredRuleTypes:x}),T=Object(o.useMemo)((()=>[...F.values()]),[F]),S=Object(o.useMemo)((()=>{if(T.length&&e)return T.find((t=>t.id===e.ruleTypeId))}),[e,T]);Object(o.useEffect)((()=>{h(S)}),[S]);const C=()=>{const t=null!=e&&e.params.criteria?(null==e?void 0:e.params.criteria).length:0;return u.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditions",{defaultMessage:"{numberOfConditions, plural, one {# condition} other {# conditions}}",values:{numberOfConditions:t}})},M=Object(d.f)(g),k=Object(d.c)(g),z=e&&Object(d.a)(e.consumer,I)&&(k||!k&&0===e.actions.length),D=Object(o.useMemo)((()=>!i&&z&&!!n.has(e.ruleTypeId)&&!n.get(e.ruleTypeId).requiresAppContext),[i,z,n,e]),w=Object(o.useMemo)((()=>n.has(e.ruleTypeId)?n.get(e.ruleTypeId).description:e.consumer===l.ob.SIEM?u.i18n.translate("xpack.triggersActionsUI.ruleDetails.securityDetectionRule",{defaultMessage:"Security detection rule"}):""),[e,n]);return Object(O.jsx)(r.EuiFlexItem,{"data-test-subj":"ruleSummaryRuleDefinition",grow:3},Object(O.jsx)(r.EuiPanel,{color:"subdued",hasBorder:!1,paddingSize:"m"},Object(O.jsx)(r.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(O.jsx)(r.EuiTitle,{size:"s"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},u.i18n.translate("xpack.triggersActionsUI.ruleDetails.definition",{defaultMessage:"Definition"}))),A?Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiLoadingSpinner,{"data-test-subj":"ruleDetailsEditButtonLoadingSpinner"})):D&&Object(O.jsx)(r.EuiFlexItem,{grow:!1},Object(O.jsx)(r.EuiButtonEmpty,{"data-test-subj":"ruleDetailsEditButton",iconType:"pencil",onClick:()=>v(!0)}))),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"baseline"},Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiFlexGroup,null,Object(O.jsx)(E,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.ruleType",{defaultMessage:"Rule type"})),A?Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiLoadingSpinner,{"data-test-subj":"ruleSummaryRuleTypeLoadingSpinner"})):Object(O.jsx)(y,{"data-test-subj":"ruleSummaryRuleType",itemValue:(null===(b=F.get(e.ruleTypeId))||void 0===b?void 0:b.name)||e.ruleTypeId})),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"flexStart",responsive:!1},Object(O.jsx)(E,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.description",{defaultMessage:"Description"})),Object(O.jsx)(y,{"data-test-subj":"ruleSummaryRuleDescription",itemValue:w})),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,null,Object(O.jsx)(E,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.runsEvery",{defaultMessage:"Runs every"})),Object(O.jsx)(y,{"data-test-subj":"ruleSummaryRuleInterval",itemValue:Object(a.formatDuration)(e.schedule.interval)})),Object(O.jsx)(r.EuiSpacer,{size:"m"}),Object(O.jsx)(r.EuiFlexGroup,{alignItems:"center"},Object(O.jsx)(E,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.conditionsTitle",{defaultMessage:"Conditions"})),Object(O.jsx)(r.EuiFlexItem,{grow:3},Object(O.jsx)(r.EuiFlexGroup,{"data-test-subj":"ruleSummaryRuleConditions",alignItems:"center",gutterSize:"none"},Object(O.jsx)(r.EuiFlexItem,{grow:!1},D?Object(O.jsx)(r.EuiButtonEmpty,{onClick:()=>v(!0),flush:"left"},Object(O.jsx)(r.EuiText,{size:"s"},C())):Object(O.jsx)(r.EuiText,{size:"s"},C()))))),Object(O.jsx)(r.EuiSpacer,{size:"m"})),Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiFlexGroup,{alignItems:"baseline"},Object(O.jsx)(E,null,u.i18n.translate("xpack.triggersActionsUI.ruleDetails.actions",{defaultMessage:"Actions"})),Object(O.jsx)(r.EuiFlexItem,{grow:3},M?Object(O.jsx)(m,{ruleActions:e.actions,actionTypeRegistry:t,legacyNotifyWhen:e.notifyWhen}):Object(O.jsx)(r.EuiFlexItem,null,Object(O.jsx)(r.EuiText,{size:"s"},u.i18n.translate("xpack.triggersActionsUI.ruleDetails.cannotReadActions",{defaultMessage:"Connector feature privileges are required to view actions"})))))))),p&&Object(O.jsx)(f.b,{onSave:()=>(v(!1),s()),initialRule:e,onClose:()=>v(!1),ruleTypeRegistry:n,actionTypeRegistry:t}))};function y({itemValue:e,extraSpace:t=!0,...n}){return Object(O.jsx)(r.EuiFlexItem,i()({grow:t?3:1},n),Object(O.jsx)(r.EuiText,{size:"s"},e))}function E({children:e}){return Object(O.jsx)(r.EuiTitle,{size:"xxs"},Object(O.jsx)(r.EuiFlexItem,{style:{whiteSpace:"nowrap"},grow:1},e))}},117:function(e,t,n){"use strict";n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u}));const s=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.show},i=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.save},o=(e,t)=>{var n,s;return".sentinelone"===t?null==e||null===(n=e.actions)||void 0===n?void 0:n.save:null==e||null===(s=e.actions)||void 0===s?void 0:s.execute},r=e=>{var t;return null==e||null===(t=e.actions)||void 0===t?void 0:t.delete};function l(e,t){var n,s;return null!==(n=null==t||null===(s=t.authorizedConsumers[e])||void 0===s?void 0:s.all)&&void 0!==n&&n}const u=e=>{var t,n;return null==e||null===(t=e.management)||void 0===t||null===(n=t.security)||void 0===n?void 0:n.api_keys}},165:function(e,t,n){"use strict";n.r(t),n.d(t,"NOTIFY_WHEN_OPTIONS",(function(){return d})),n.d(t,"RuleNotifyWhen",(function(){return x}));var s=n(1),i=n.n(s),o=n(2),r=n(26),l=n(3),u=n(128),a=n(130),c=n(45),j=n(0);const d=[{value:"onActionGroupChange",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.display",{defaultMessage:"On status changes"}),"data-test-subj":"onActionGroupChange",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"On status changes",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"Actions run if the alert status changes.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActionGroupChange.description"}))))},{value:"onActiveAlert",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.display",{defaultMessage:"On check intervals"}),"data-test-subj":"onActiveAlert",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"On check intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onActiveAlert.description"}))))},{value:"onThrottleInterval",inputDisplay:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.display",{defaultMessage:"On custom action intervals"}),"data-test-subj":"onThrottleInterval",dropdownDisplay:Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)("strong",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"On custom action intervals",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.label"})),Object(j.jsx)(l.EuiText,{size:"s",color:"subdued"},Object(j.jsx)("p",null,Object(j.jsx)(r.FormattedMessage,{defaultMessage:"Actions run if rule conditions are met.",id:"xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.onThrottleInterval.description"}))))}],x=({rule:e,throttle:t,throttleUnit:n,onNotifyWhenChange:x,onThrottleChange:b})=>{const[g,p]=Object(s.useState)(t||1),[O,m]=Object(s.useState)(!1),[f,v]=Object(s.useState)("onActionGroupChange");Object(s.useEffect)((()=>{e.notifyWhen?v(e.notifyWhen):v(e.throttle?"onThrottleInterval":"onActiveAlert")}),[e]),Object(s.useEffect)((()=>{m("onThrottleInterval"===f)}),[f]);const y=Object(s.useCallback)((e=>{b("onThrottleInterval"===e?g:null,n),x(e),v(e)}),[]),E=Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(r.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleForm.renotifyFieldLabel",defaultMessage:"Notify"})," ",Object(j.jsx)(l.EuiIconTip,{position:"right",type:"questionInCircle",content:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.renotifyWithTooltip",{defaultMessage:"Define how often alerts generate actions."})}));return Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiFormRow,{fullWidth:!0,label:E},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiSuperSelect,{"data-test-subj":"notifyWhenSelect",options:d,valueOfSelected:f,onChange:y}),O&&Object(j.jsx)(i.a.Fragment,null,Object(j.jsx)(l.EuiSpacer,null),Object(j.jsx)(l.EuiFormRow,{fullWidth:!0},Object(j.jsx)(l.EuiFlexGroup,{gutterSize:"s"},Object(j.jsx)(l.EuiFlexItem,null,Object(j.jsx)(l.EuiFieldNumber,{fullWidth:!0,min:1,value:g,name:"throttle","data-test-subj":"throttleInput",prepend:o.i18n.translate("xpack.triggersActionsUI.sections.ruleForm.ruleNotifyWhen.label",{defaultMessage:"Every"}),onChange:e=>{Object(a.pipe)(Object(u.some)(e.target.value.trim()),Object(u.filter)((e=>""!==e)),Object(u.map)((e=>parseInt(e,10))),Object(u.filter)((e=>!isNaN(e))),Object(u.map)((e=>{p(e),b(e,n)})))}})),Object(j.jsx)(l.EuiFlexItem,{grow:!1},Object(j.jsx)(l.EuiSelect,{"data-test-subj":"throttleUnitInput",value:n,options:Object(c.b)(null!=t?t:1),onChange:e=>{b(t,e.target.value)}})))))))))}}}]);