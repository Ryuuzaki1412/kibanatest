/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.triggersActionsUi_bundle_jsonpfunction=window.triggersActionsUi_bundle_jsonpfunction||[]).push([[58],{80:function(e,t,s){"use strict";s.r(t),s.d(t,"RuleEdit",(function(){return R})),s.d(t,"default",(function(){return R}));var a=s(1),i=s.n(a),n=s(26),c=s(12),o=s(3),r=s(11),l=s(2),u=s(21),j=s(19),d=s(177),b=s(172),g=s(142),y=s(6),O=s(34);const p=({actions:e,...t})=>({...t,actions:e.map((({group:e,id:t,params:s,frequency:a,uuid:i,alertsFilter:n,useAlertDataForTemplate:c})=>({group:e,id:t,params:s,frequency:{notify_when:a.notifyWhen,throttle:a.throttle,summary:a.summary},alerts_filter:n,...void 0!==c?{use_alert_data_for_template:c}:{},...i&&{uuid:i}})))});var f=s(55),m=s(139),x=s(124),E=s(30),h=s(173),T=s(174),v=s(57),F=s(134),S=s(129),w=s(0);const C=l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveErrorNotificationText",{defaultMessage:"Cannot update rule."}),I=e=>{const t=Object(r.cloneDeep)(Object(r.omit)(e,"notifyWhen","throttle")),s=Boolean(e.notifyWhen),a=Boolean(e.throttle);if(s||a){const a=s?{summary:!1,notifyWhen:e.notifyWhen,throttle:e.notifyWhen===c.RuleNotifyWhen.THROTTLE?e.throttle:null}:{summary:!1,notifyWhen:c.RuleNotifyWhen.THROTTLE,throttle:e.throttle};t.actions=t.actions.map((e=>({...e,frequency:a})))}return t},R=({initialRule:e,onClose:t,reloadRules:s,onSave:R,hideInterval:A,ruleTypeRegistry:k,actionTypeRegistry:B,metadata:U,...M})=>{const W=null!=R?R:s,[{rule:N},_]=Object(a.useReducer)(g.a,{rule:I(e)}),[D,L]=Object(a.useState)(!1),[z,H]=Object(a.useState)(!1),[P,q]=Object(a.useState)(!1),[G,$]=Object(a.useState)(!1),[J,V]=Object(a.useState)([]),[K,Q]=Object(a.useState)(!1),[X,Y]=Object(a.useState)(M.ruleType),[Z,ee]=Object(a.useState)({isUsingSecurity:!1}),[te,se]=Object(a.useState)(U),ae=Object(a.useCallback)((e=>se(e)),[]),{http:ie,notifications:{toasts:ne}}=Object(E.b)().services,ce=e=>{_({command:{type:"setRule"},payload:{key:"rule",value:e}})},oe=k.get(N.ruleTypeId);Object(a.useEffect)((()=>{(async()=>{ee(await Object(F.a)({http:ie}))})()}),[ie]),Object(a.useEffect)((()=>{(async()=>{Q(!0);const e=await Object(b.a)(N.actions,B);V([...e]),Q(!1)})()}),[N.actions,B]),Object(a.useEffect)((()=>{M.ruleType||X||(async()=>{const e=await Object(f.a)({http:ie});for(const t of e)oe.id===t.id&&Y(t)})()}),[M.ruleType,oe.id,X,ie]);const{ruleBaseErrors:re,ruleErrors:le,ruleParamsErrors:ue}=Object(b.b)(N,oe,Z),je=()=>{Object(T.a)(N,e,!0)?$(!0):t(j.m.CANCELED,te)};return Object(w.jsx)(o.EuiPortal,null,Object(w.jsx)(o.EuiFlyout,{onClose:je,"aria-labelledby":"flyoutRuleEditTitle",size:"m",maxWidth:620,ownFocus:!0},Object(w.jsx)(o.EuiFlyoutHeader,{hasBorder:!0},Object(w.jsx)(o.EuiTitle,{size:"s","data-test-subj":"editRuleFlyoutTitle"},Object(w.jsx)("h3",{id:"flyoutTitle"},Object(w.jsx)(n.FormattedMessage,{defaultMessage:"Edit rule",id:"xpack.triggersActionsUI.sections.ruleEdit.flyoutTitle"})))),Object(w.jsx)(x.a,null,Object(w.jsx)(m.a,{inFlyout:!0,waitForCheck:!0},Object(w.jsx)(o.EuiFlyoutBody,null,z&&Object(w.jsx)(i.a.Fragment,null,Object(w.jsx)(o.EuiCallOut,{size:"s",color:"danger",iconType:"rule","data-test-subj":"hasActionsDisabled",title:l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.disabledActionsWarningTitle",{defaultMessage:"This rule has actions that are disabled"})}),Object(w.jsx)(o.EuiSpacer,null)),Object(w.jsx)(d.a,{rule:N,config:Z,dispatch:_,errors:le,actionTypeRegistry:B,hideInterval:A,ruleTypeRegistry:k,canChangeTrigger:!1,setHasActionsDisabled:H,setHasActionsWithBrokenConnector:q,operation:l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.operationName",{defaultMessage:"edit"}),metadata:te,onChangeMetaData:ae})),Object(w.jsx)(o.EuiFlyoutFooter,null,Object(w.jsx)(o.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(w.jsx)(o.EuiFlexItem,{grow:!1},Object(w.jsx)(o.EuiButtonEmpty,{"data-test-subj":"cancelSaveEditedRuleButton",onClick:()=>je()},l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.cancelButtonLabel",{defaultMessage:"Cancel"}))),K?Object(w.jsx)(o.EuiFlexItem,{grow:!1},Object(w.jsx)(o.EuiSpacer,{size:"s"}),Object(w.jsx)(o.EuiLoadingSpinner,{size:"l"})):Object(w.jsx)(i.a.Fragment,null),Object(w.jsx)(o.EuiFlexItem,{grow:!1},Object(w.jsx)(o.EuiFlexGroup,{alignItems:"center"},Z.isUsingSecurity&&Object(w.jsx)(o.EuiFlexItem,{grow:!1},Object(w.jsx)(o.EuiIconTip,{type:"warning",position:"top","data-test-subj":"changeInPrivilegesTip",content:l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.changeInPrivilegesLabel",{defaultMessage:"Saving this rule will change its privileges and might change its behavior."})})),Object(w.jsx)(o.EuiFlexItem,{grow:!1},Object(w.jsx)(o.EuiButton,{fill:!0,color:"success","data-test-subj":"saveEditedRuleButton",type:"submit",iconType:"check",isLoading:D,onClick:async()=>await async function(){L(!0);try{if(K||!Object(b.c)(N,le,J)||P)ce(Object(v.a)(N,ue,re,J));else{const e=await async function({http:e,rule:t,id:s}){const a=await e.put(`${y.b}/rule/${encodeURIComponent(s)}`,{body:JSON.stringify(p(Object(r.pick)(t,["name","tags","schedule","params","actions"])))});return Object(O.b)(a)}({http:ie,rule:N,id:N.id});ne.addSuccess(l.i18n.translate("xpack.triggersActionsUI.sections.ruleEdit.saveSuccessNotificationText",{defaultMessage:"Updated '{ruleName}'",values:{ruleName:e.name}})),t(j.m.SAVED,te),W&&W(te)}}catch(t){var e;const s=Object(c.parseRuleCircuitBreakerErrorMessage)((null===(e=t.body)||void 0===e?void 0:e.message)||C);ne.addDanger({title:s.summary,...s.details&&{text:Object(u.toMountPoint)(Object(w.jsx)(S.a,null,s.details))}})}L(!1)}()},Object(w.jsx)(n.FormattedMessage,{id:"xpack.triggersActionsUI.sections.ruleEdit.saveButtonLabel",defaultMessage:"Save"}))))))))),G&&Object(w.jsx)(h.a,{onConfirm:()=>{$(!1),t(j.m.CANCELED,te)},onCancel:()=>{$(!1)}})))}}}]);