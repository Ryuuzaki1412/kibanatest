(window.controls_bundle_jsonpfunction=window.controls_bundle_jsonpfunction||[]).push([[5],{104:function(e,t,i){"use strict";i.r(t),i.d(t,"RangeSliderControlContext",(function(){return V})),i.d(t,"useRangeSlider",(function(){return R})),i.d(t,"RangeSliderEmbeddable",(function(){return range_slider_embeddable_RangeSliderEmbeddable}));var a=i(1),n=i.n(a),s=i(5),r=i.n(s),o=i(2),l=i(6),d=i(40),c=i.n(d),u=i(41),h=i(29),p=i(42),g=i(20),b=i(21),m=i(0),f=i(58),S=i(34),v=i(17),w=i(8),x=i(63),_=(i(91),i(72)),j=i(64),y=i(4);const O=()=>{const e=R(),t=Object(l.useRef)(null),i=e.select((e=>e.explicitInput.id)),a=e.select((e=>e.explicitInput.value)),n=e.select((e=>e.componentState.min)),s=e.select((e=>e.componentState.max)),r=e.select((e=>e.componentState.error)),d=e.select((e=>e.componentState.field)),c=e.select((e=>e.componentState.isInvalid)),u=e.select((e=>e.output.loading)),h=e.select((e=>e.output.dataViewId)),[p,g]=Object(l.useState)(null!=a?a:["",""]),b=Object(j.a)({dataViewId:h,fieldSpec:d}),m=Object(l.useMemo)((()=>Object(o.debounce)((t=>{e.dispatch.setSelectedRange(t)}),750)),[e.dispatch]),[f,S]=Object(l.useMemo)((()=>{if(void 0===n||void 0===s)return[-1/0,1/0];const e=null!=a?a:["",""],[t,i]=[""===e[0]?n:parseFloat(e[0]),""===e[1]?s:parseFloat(e[1])];return[Math.min(t,n),Math.max(i,null!=s?s:1/0)]}),[n,s,a]);Object(l.useEffect)((()=>{g(null!=a?a:["",""])}),[a]);const v=Object(l.useMemo)((()=>[{value:null!=n?n:-1/0,label:b(String(n))},{value:null!=s?s:1/0,label:b(String(s))}]),[n,s,b]),O=Object(l.useMemo)((()=>[{min:null!=n?n:-1/0,max:null!=s?s:1/0,color:"success"}]),[n,s]),F=Object(l.useMemo)((()=>u||f===-1/0||S===1/0||f===S),[u,f,S]),I=Object(l.useCallback)((({inputValue:e,testSubj:t,placeholder:i})=>({isInvalid:c,placeholder:i,readOnly:!1,className:"rangeSliderAnchor__fieldNumber","data-test-subj":`rangeSlider__${t}`,value:e===i?"":e})),[c]);return r?Object(y.jsx)(x.a,{error:r}):Object(y.jsx)("span",{className:"rangeSliderAnchor__button","data-test-subj":`range-slider-control-${i}`},Object(y.jsx)(w.EuiDualRange,{ref:t,id:i,fullWidth:!0,showTicks:!0,ticks:v,levels:O,min:f,max:S,isLoading:u,inputPopoverProps:{panelMinWidth:_.a},onMouseUp:()=>{m.cancel(),e.dispatch.setSelectedRange(p)},readOnly:F,showInput:"inputWithPopover","data-test-subj":"rangeSlider__slider",minInputProps:I({inputValue:p[0],testSubj:"lowerBoundFieldNumber",placeholder:String(null!=n?n:-1/0)}),maxInputProps:I({inputValue:p[1],testSubj:"upperBoundFieldNumber",placeholder:String(null!=s?s:1/0)}),value:[p[0]||f,p[1]||S],onChange:([e,t])=>{g([String(e),String(t)]),m([String(e),String(t)])}}))},F={setSelectedRange:(e,t)=>{e.explicitInput.value=t.payload},setField:(e,t)=>{e.componentState.field=t.payload},setDataViewId:(e,t)=>{e.output.dataViewId=t.payload},setErrorMessage:(e,t)=>{e.componentState.error=t.payload},setLoading:(e,t)=>{e.output.loading=t.payload},setMinMax:(e,t)=>{void 0!==t.payload.min&&(e.componentState.min=Math.floor(t.payload.min)),void 0!==t.payload.max&&(e.componentState.max=Math.ceil(t.payload.max))},publishFilters:(e,t)=>{e.output.filters=t.payload},setIsInvalid:(e,t)=>{e.componentState.isInvalid=t.payload}},I=(e,t)=>{if(!e||!t)return!1;const{filters:i,...a}=e,{filters:n,...s}=t;return!!r()(a,s)&&!!Object(b.compareFilters)(null!=n?n:[],null!=i?i:[],b.COMPARE_ALL_OPTIONS)},V=Object(l.createContext)(null),R=()=>{const e=Object(l.useContext)(V);if(null==e)throw new Error("useRangeSlider must be used inside RangeSliderControlContext.");return e};class range_slider_embeddable_RangeSliderEmbeddable extends g.Embeddable{constructor(e,t,i,a){super(t,i,a),n()(this,"type",S.RANGE_SLIDER_CONTROL),n()(this,"deferEmbeddableLoad",!0),n()(this,"subscriptions",new h.Subscription),n()(this,"node",void 0),n()(this,"dataService",void 0),n()(this,"dataViewsService",void 0),n()(this,"dataView",void 0),n()(this,"field",void 0),n()(this,"filters",[]),n()(this,"select",void 0),n()(this,"getState",void 0),n()(this,"dispatch",void 0),n()(this,"onStateChange",void 0),n()(this,"cleanupStateTools",void 0),n()(this,"initialize",(async()=>{const e=this.getInput().value;e||this.setInitializationFinished();try{await this.runRangeSliderQuery(),await this.buildFilter()}catch(e){this.onLoadingError(e.message)}e&&this.setInitializationFinished(),this.setupSubscriptions()})),n()(this,"setupSubscriptions",(()=>{const e=this.getInput$().pipe(Object(p.map)((e=>{var t;return{validate:!Boolean(null===(t=e.ignoreParentSettings)||void 0===t?void 0:t.ignoreValidations),lastReloadRequestTime:e.lastReloadRequestTime,dataViewId:e.dataViewId,fieldName:e.fieldName,timeRange:e.timeRange,timeslice:e.timeslice,filters:e.filters,query:e.query}})),Object(p.distinctUntilChanged)(I),Object(p.skip)(1));this.subscriptions.add(e.pipe(Object(h.switchMap)((async e=>{try{await this.runRangeSliderQuery(),await this.buildFilter()}catch(e){this.onLoadingError(e.message)}}))).subscribe()),this.subscriptions.add(this.getInput$().pipe(Object(p.distinctUntilChanged)(((e,t)=>{var i,a;return Object(o.isEqual)(null!==(i=e.value)&&void 0!==i?i:["",""],null!==(a=t.value)&&void 0!==a?a:["",""])})),Object(p.skip)(1),Object(h.switchMap)(this.buildFilter)).subscribe())})),n()(this,"getCurrentDataViewAndField",(async()=>{const{explicitInput:{dataViewId:e,fieldName:t}}=this.getState();if(!this.dataView||this.dataView.id!==e)try{this.dataView=await this.dataViewsService.get(e),this.dispatch.setDataViewId(this.dataView.id)}catch(e){this.onLoadingError(e.message)}var i;return!this.dataView||this.field&&this.field.name===t||(this.field=this.dataView.getFieldByName(t),this.field?this.dispatch.setField(null===(i=this.field)||void 0===i?void 0:i.toSpec()):this.onLoadingError(m.i18n.translate("controls.rangeSlider.errors.fieldNotFound",{defaultMessage:"Could not locate field: {fieldName}",values:{fieldName:t}}))),{dataView:this.dataView,field:this.field}})),n()(this,"runRangeSliderQuery",(async()=>{this.dispatch.setLoading(!0);const{dataView:e,field:t}=await this.getCurrentDataViewAndField();if(!e||!t)return;const i=this.getInput(),{ignoreParentSettings:a,timeRange:n,timeslice:s}=i;let{filters:r=[]}=i;const o=void 0!==s?{from:new Date(s[0]).toISOString(),to:new Date(s[1]).toISOString(),mode:"absolute"}:n;if((null==a||!a.ignoreTimerange)&&o){const t=this.dataService.timefilter.createFilter(e,o);t&&(r=r.concat(t))}this.filters=r;const{min:l,max:d}=await this.fetchMinMax({dataView:e,field:t});this.dispatch.setMinMax({min:l,max:d})})),n()(this,"fetchMinMax",(async({dataView:e,field:t})=>{const i=await this.dataService.searchSource.create();i.setField("size",0),i.setField("index",e);const{ignoreParentSettings:a,query:n}=this.getInput();null!=a&&a.ignoreFilters||i.setField("filter",this.filters),n&&i.setField("query",n);const s={};t&&(t.scripted?s.script={source:t.script,lang:t.lang}:s.field=t.name);const r={maxAgg:{max:s},minAgg:{min:s}};i.setField("aggs",r);const l=await Object(h.lastValueFrom)(i.fetch$());return{min:Object(o.get)(l,"rawResponse.aggregations.minAgg.value"),max:Object(o.get)(l,"rawResponse.aggregations.maxAgg.value")}})),n()(this,"buildFilter",(async()=>{const{componentState:{min:e,max:t},explicitInput:{value:i}}=this.getState(),{ignoreParentSettings:a,query:n}=this.getInput(),[s,r]=null!=i?i:["",""],l=void 0!==e&&void 0!==t,d=!Object(o.isEmpty)(s),c=!Object(o.isEmpty)(r),p=d||c,{dataView:g,field:m}=await this.getCurrentDataViewAndField();if(!g||!m)return;if(!l||!p)return void Object(u.batch)((()=>{this.dispatch.setLoading(!1),this.dispatch.setIsInvalid(!(null!=a&&a.ignoreValidations)&&p),this.dispatch.setDataViewId(g.id),this.dispatch.publishFilters([]),this.dispatch.setErrorMessage(void 0)}));const f={};s&&(f.gte=Math.max(parseFloat(s),e)),r&&(f.lte=Math.min(parseFloat(r),t));const S=Object(b.buildRangeFilter)(m,f,g);if(S.meta.key=null==m?void 0:m.name,S.meta.type="range",S.meta.params=f,null==a||!a.ignoreValidations){var v,w;const e=await this.dataService.searchSource.create(),t=[...this.filters,S];e.setField("size",0),e.setField("index",g),e.setField("filter",t),n&&e.setField("query",n);const i=await Object(h.lastValueFrom)(e.fetch$()),a=null==i||null===(v=i.rawResponse)||void 0===v||null===(w=v.hits)||void 0===w?void 0:w.total;if(!("number"==typeof a?a:null==a?void 0:a.value))return void Object(u.batch)((()=>{this.dispatch.setLoading(!1),this.dispatch.setIsInvalid(!0),this.dispatch.setDataViewId(g.id),this.dispatch.publishFilters([]),this.dispatch.setErrorMessage(void 0)}))}Object(u.batch)((()=>{this.dispatch.setLoading(!1),this.dispatch.setIsInvalid(!1),this.dispatch.setDataViewId(g.id),this.dispatch.publishFilters([S]),this.dispatch.setErrorMessage(void 0)}))})),n()(this,"reload",(async()=>{try{await this.runRangeSliderQuery(),await this.buildFilter()}catch(e){this.onLoadingError(e.message)}})),n()(this,"destroy",(()=>{super.destroy(),this.cleanupStateTools(),this.subscriptions.unsubscribe()})),n()(this,"render",(e=>{this.node&&c.a.unmountComponentAtNode(this.node),this.node=e;const t=v.a.getContextProvider();c.a.render(Object(y.jsx)(f.a,{theme:v.a.getServices().core.theme},Object(y.jsx)(t,null,Object(y.jsx)(V.Provider,{value:this},Object(y.jsx)(O,null)))),e)})),({data:this.dataService,dataViews:this.dataViewsService}=v.a.getServices());const s=e.createReduxEmbeddableTools({embeddable:this,reducers:F,initialComponentState:{isInvalid:!1}});this.select=s.select,this.getState=s.getState,this.dispatch=s.dispatch,this.onStateChange=s.onStateChange,this.cleanupStateTools=s.cleanup,this.initialize()}onLoadingError(e){Object(u.batch)((()=>{this.dispatch.setLoading(!1),this.dispatch.publishFilters([]),this.dispatch.setErrorMessage(e)}))}clearSelections(){this.dispatch.setSelectedRange(["",""])}isChained(){return!0}}},91:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(92);case"v8light":return i(94)}},92:function(e,t,i){var a=i(53),n=i(93);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},93:function(e,t,i){(t=i(54)(!1)).push([e.i,".rangeSliderAnchor__button .euiFormControlLayout{background-color:initial;box-shadow:none;padding:0 0 2px}.rangeSliderAnchor__button .euiFormControlLayout .euiFormControlLayout__childrenWrapper{border-bottom-left-radius:0;border-bottom-right-radius:5px;border-top-left-radius:0;border-top-right-radius:5px}.rangeSliderAnchor__fieldNumber{background-color:initial;box-shadow:none;font-weight:500;text-align:center}.rangeSliderAnchor__fieldNumber:invalid{background-image:none;color:#7a7f89;font-weight:400;text-decoration:line-through}.rangeSliderAnchor__fieldNumber::placeholder,.rangeSliderAnchor__fieldNumber:placeholder-shown{color:#7a7f89;font-weight:400;text-decoration:none}",""]),e.exports=t},94:function(e,t,i){var a=i(53),n=i(95);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);a(n,{insert:"head",singleton:!1}),e.exports=n.locals||{}},95:function(e,t,i){(t=i(54)(!1)).push([e.i,".rangeSliderAnchor__button .euiFormControlLayout{background-color:initial;box-shadow:none;padding:0 0 2px}.rangeSliderAnchor__button .euiFormControlLayout .euiFormControlLayout__childrenWrapper{border-bottom-left-radius:0;border-bottom-right-radius:5px;border-top-left-radius:0;border-top-right-radius:5px}.rangeSliderAnchor__fieldNumber{background-color:initial;box-shadow:none;font-weight:500;text-align:center}.rangeSliderAnchor__fieldNumber:invalid{background-image:none;color:#69707d;font-weight:400;text-decoration:line-through}.rangeSliderAnchor__fieldNumber::placeholder,.rangeSliderAnchor__fieldNumber:placeholder-shown{color:#69707d;font-weight:400;text-decoration:none}",""]),e.exports=t}}]);