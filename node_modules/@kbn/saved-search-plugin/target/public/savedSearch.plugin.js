!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";r.r(t),r.d(t,"getSavedSearchUrl",(function(){return a})),r.d(t,"getSavedSearchFullPathUrl",(function(){return n})),r.d(t,"fromSavedSearchAttributes",(function(){return i})),r.d(t,"VIEW_MODE",(function(){return h})),r.d(t,"SavedSearchType",(function(){return s.d})),r.d(t,"LATEST_VERSION",(function(){return s.a})),r.d(t,"MIN_SAVED_SEARCH_SAMPLE_SIZE",(function(){return s.c})),r.d(t,"MAX_SAVED_SEARCH_SAMPLE_SIZE",(function(){return s.b})),r.d(t,"getKibanaContextFn",(function(){return g}));const a=e=>e?`#/view/${encodeURIComponent(e)}`:"#/",n=e=>`/app/discover${a(e)}`,i=(e,t,r,a)=>({id:e,searchSource:a,title:t.title,sort:t.sort,columns:t.columns,description:t.description,tags:r,grid:t.grid,hideChart:t.hideChart,viewMode:t.viewMode,hideAggregatedPreview:t.hideAggregatedPreview,rowHeight:t.rowHeight,isTextBasedQuery:t.isTextBasedQuery,usesAdHocDataView:t.usesAdHocDataView,timeRestore:t.timeRestore,timeRange:t.timeRange,refreshInterval:t.refreshInterval,rowsPerPage:t.rowsPerPage,sampleSize:t.sampleSize,breakdownField:t.breakdownField});var s=r(2),c=r(4),o=r(1),d=r(6),l=r(7);const u=(e=[],t)=>Object(c.uniqBy)([...Array.isArray(e)?e:[e],...Array.isArray(t)?t:[t]],(e=>JSON.stringify(e.query))),g=e=>({name:"kibana_context",type:"kibana_context",inputTypes:["kibana_context","null"],help:o.i18n.translate("savedSearch.kibana_context.help",{defaultMessage:"Updates kibana global context"}),args:{q:{types:["kibana_query","null"],multi:!0,aliases:["query","_"],help:o.i18n.translate("savedSearch.kibana_context.q.help",{defaultMessage:"Specify Kibana free form text query"})},filters:{types:["kibana_filter","null"],multi:!0,help:o.i18n.translate("savedSearch.kibana_context.filters.help",{defaultMessage:"Specify Kibana generic filters"})},timeRange:{types:["timerange","null"],default:null,help:o.i18n.translate("savedSearch.kibana_context.timeRange.help",{defaultMessage:"Specify Kibana time range filter"})},savedSearchId:{types:["string","null"],default:null,help:o.i18n.translate("savedSearch.kibana_context.savedSearchId.help",{defaultMessage:"Specify saved search ID to be used for queries and filters"})}},extract(e){const t=[];if(e.savedSearchId.length&&"string"==typeof e.savedSearchId[0]){const r="kibana_context.savedSearchId";return t.push({name:r,type:"search",id:e.savedSearchId[0]}),{state:{...e,savedSearchId:[r]},references:t}}return{state:e,references:t}},inject(e,t){const r=t.find((e=>"kibana_context.savedSearchId"===e.name));return r&&(e.savedSearchId[0]=r.id),e},async fn(t,r,{getKibanaRequest:a}){var n,i;const{getSavedSearch:s}=await e(a),o=r.timeRange||(null==t?void 0:t.timeRange);let g=u(null==t?void 0:t.query,(null==r||null===(n=r.q)||void 0===n?void 0:n.filter(Boolean))||[]);const h=(null==r||null===(i=r.filters)||void 0===i?void 0:i.map(l.unboxExpressionValue))||[];let p=[...(null==t?void 0:t.filters)||[]];if(r.savedSearchId){const e=await s(r.savedSearchId),{query:t,filter:a}=e.searchSource.getFields();t&&(g=u(g,t)),a&&(p=[...p,...Array.isArray(a)?a:[a]])}const v=h.filter((e=>!p.some((t=>Object(c.isEqual)(Object(d.fromCombinedFilter)(t).query,e.query)))));return p=[...p,...v],{type:"kibana_context",query:g,filters:Object(d.uniqFilters)(p.filter((e=>{var t;return!(null!==(t=e.meta)&&void 0!==t&&t.disabled)}))),timeRange:o}}});let h;!function(e){e.DOCUMENT_LEVEL="documents",e.AGGREGATED_LEVEL="aggregated"}(h||(h={}))},function(e,t){e.exports=__kbnSharedDeps__.KbnI18n},function(e,t,r){"use strict";r.d(t,"d",(function(){return a})),r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return s}));const a="search",n=1,i=1,s=1e4},function(e,t,r){e.exports=r(10)(2)},function(e,t){e.exports=__kbnSharedDeps__.Lodash},function(e,t,r){r.r(t);var a=__kbnBundles__.get("plugin/data/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t){e.exports=__kbnSharedDeps__.KbnEsQuery},function(e,t,r){r.r(t);var a=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(t,Object.getOwnPropertyDescriptors(a))},function(e,t,r){r(9),__kbnBundles__.define("plugin/savedSearch/public",r,11),__kbnBundles__.define("plugin/savedSearch/common",r,0)},function(e,t,r){r.p=window.__kbnPublicPath__.savedSearch},function(e,t){e.exports=__kbnSharedDeps_npm__},function(e,t,r){"use strict";r.r(t),r.d(t,"getSavedSearchFullPathUrl",(function(){return n.getSavedSearchFullPathUrl})),r.d(t,"getSavedSearchUrl",(function(){return n.getSavedSearchUrl})),r.d(t,"VIEW_MODE",(function(){return n.VIEW_MODE})),r.d(t,"plugin",(function(){return b}));var a=r(1),n=r(0),i=r(3),s=r.n(i),c=r(5),o=r(4);const d=async(e,{spaces:t,getSavedSrch:r})=>{const i=await r(e);if(i.error)throw new Error(`Could not locate that search (id: ${e})`);var s;if("conflict"===i.meta.outcome)throw new Error(await(async e=>a.i18n.translate("savedSearch.legacyURLConflict.errorMessage",{defaultMessage:"This search has the same URL as a legacy alias. Disable the alias to resolve this error : {json}",values:{json:e}}))(JSON.stringify({targetType:n.SavedSearchType,sourceId:e,targetSpace:null===(s=await(null==t?void 0:t.getActiveSpace()))||void 0===s?void 0:s.id})));return i},l=async({savedSearchId:e,attributes:t,references:r,sharingSavedObjectProps:a},{searchSourceCreate:i,savedObjectsTagging:s})=>{var o,d;const l=Object(c.parseSearchSourceJSON)(null!==(o=null===(d=t.kibanaSavedObjectMeta)||void 0===d?void 0:d.searchSourceJSON)&&void 0!==o?o:"{}"),u=Object(c.injectReferences)(l,r),g=((e,t,r,a,i,s)=>({...Object(n.fromSavedSearchAttributes)(e,t,r,i),sharingSavedObjectProps:s,references:a}))(e,t,s?s.ui.getTagIdsFromReferences(r):void 0,r,await i(u),a);return g},u="search",g=async({title:e,isTitleDuplicateConfirmed:t,onTitleDuplicate:r,contentManagement:a})=>!(e&&!t&&r&&await(async(e,t)=>{if(e)return(await t.search({contentTypeId:u,query:{text:`"${e}"`},options:{searchFields:["title"],fields:["title"]}})).hits.some((t=>t.attributes.title.toLowerCase()===e.toLowerCase()))})(e,a))||(r(),Promise.reject(new Error(`Saved search title already exists: ${e}`))),h=async(e,t,r,a)=>(e?await a.update({contentTypeId:u,id:e,data:t,options:{references:r}}):await a.create({contentTypeId:u,data:t,options:{references:r}})).item.id;var p=r(2);const v=({spaces:e,savedObjectsTaggingOss:t,search:r,contentManagement:a})=>({spaces:e,savedObjectsTagging:null==t?void 0:t.getTaggingApi(),searchSourceCreate:r.searchSource.create,getSavedSrch:e=>a.get({contentTypeId:p.d,id:e})}),f=e=>{var t;const{references:r,...a}=e;return{references:r,attributes:{...a,description:null!==(t=a.description)&&void 0!==t?t:""}}};class saved_searches_service_SavedSearchesService{constructor(e){s()(this,"get",(e=>(async(e,t)=>{const r=await d(e,t);return await l({savedSearchId:e,attributes:r.item.attributes,references:r.item.references,sharingSavedObjectProps:r.meta},t)})(e,v(this.deps)))),s()(this,"getAll",(async()=>{const{contentManagement:e}=this.deps;return(await e.search({contentTypeId:n.SavedSearchType,query:{}})).hits})),s()(this,"getNew",(()=>(({searchSource:e})=>({searchSource:e.createEmpty()}))({searchSource:this.deps.search.searchSource}))),s()(this,"find",(async e=>{const{contentManagement:t}=this.deps;return(await t.search({contentTypeId:n.SavedSearchType,query:{text:e},options:{searchFields:["title"],fields:["title"]}})).hits})),s()(this,"save",((e,t={})=>{const{contentManagement:r,savedObjectsTaggingOss:a}=this.deps;return(async(e,t,r,a)=>{var n;const i=t.copyOnSave||!e.id;if(i)try{await g({title:e.title,isTitleDuplicateConfirmed:t.isTitleDuplicateConfirmed,onTitleDuplicate:t.onTitleDuplicate,contentManagement:r})}catch{return}const{searchSourceJSON:s,references:c}=e.searchSource.serialize(),d=a?a.ui.updateTagsReferences(c,null!==(n=e.tags)&&void 0!==n?n:[]):c;return h(i?void 0:e.id,((e,t)=>{var r,a,n,i,s,c,d,l;return{kibanaSavedObjectMeta:{searchSourceJSON:t},title:null!==(r=e.title)&&void 0!==r?r:"",sort:null!==(a=e.sort)&&void 0!==a?a:[],columns:null!==(n=e.columns)&&void 0!==n?n:[],description:null!==(i=e.description)&&void 0!==i?i:"",grid:null!==(s=e.grid)&&void 0!==s?s:{},hideChart:null!==(c=e.hideChart)&&void 0!==c&&c,viewMode:e.viewMode,hideAggregatedPreview:e.hideAggregatedPreview,rowHeight:e.rowHeight,isTextBasedQuery:null!==(d=e.isTextBasedQuery)&&void 0!==d&&d,usesAdHocDataView:e.usesAdHocDataView,timeRestore:null!==(l=e.timeRestore)&&void 0!==l&&l,timeRange:e.timeRange?Object(o.pick)(e.timeRange,["from","to"]):void 0,refreshInterval:e.refreshInterval,rowsPerPage:e.rowsPerPage,sampleSize:e.sampleSize,breakdownField:e.breakdownField}})(e,s),d,r)})(e,t,r,null==a?void 0:a.getTaggingApi())})),this.deps=e}}const S={name:"kibana_context",from:{null:()=>({type:"kibana_context"})},to:{null:()=>({type:"null"}),filter:e=>{const{filters:t=[]}=e;return{type:"filter",filterType:"filter",and:t.map(c.adaptToExpressionValueFilter)}}}};class plugin_SavedSearchPublicPlugin{setup({getStartServices:e},{contentManagement:t,expressions:r}){return t.registry.register({id:n.SavedSearchType,version:{latest:n.LATEST_VERSION},name:a.i18n.translate("savedSearch.contentManagementType",{defaultMessage:"Saved search"})}),r.registerFunction(function({getStartServices:e}){return Object(n.getKibanaContextFn)((async()=>{const[,,{get:t}]=await e();return{getSavedSearch:t}}))}({getStartServices:e})),r.registerType(S),{}}start(e,{data:{search:t},spaces:r,savedObjectsTaggingOss:a,contentManagement:{client:n},embeddable:i}){const s={search:t,spaces:r,savedObjectsTaggingOss:a,contentManagement:n,embeddable:i},c=new saved_searches_service_SavedSearchesService(s);return{get:e=>c.get(e),getAll:()=>c.getAll(),getNew:()=>c.getNew(),save:(e,t)=>c.save(e,t),byValue:{attributeService:(o=s,o.embeddable.getAttributeService("search",{saveMethod:async(e,t)=>{const{references:r,attributes:a}=f(e);return{id:await h(t,a,r,o.contentManagement)}},unwrapMethod:async e=>{const t=await d(e,v(o));return{attributes:{...t.item.attributes,references:t.item.references},metaInfo:{sharingSavedObjectProps:t.meta}}},checkForDuplicateTitle:e=>g({title:e.newTitle,isTitleDuplicateConfirmed:e.isTitleDuplicateConfirmed,onTitleDuplicate:e.onTitleDuplicate,contentManagement:o.contentManagement})})),toSavedSearch:async(e,t)=>(async(e,t,r)=>{var a;const{sharingSavedObjectProps:n}=null!==(a=t.metaInfo)&&void 0!==a?a:{};return await l({...f(t.attributes),savedSearchId:e,sharingSavedObjectProps:n},v(r))})(e,t,s)}};var o}}function b(){return new plugin_SavedSearchPublicPlugin}}]);