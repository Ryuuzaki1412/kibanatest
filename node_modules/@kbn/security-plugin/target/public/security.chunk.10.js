/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.security_bundle_jsonpfunction=window.security_bundle_jsonpfunction||[]).push([[10],{163:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t(2),r=t(164);a.default=function(e,a){var t=r.useFirstMountState();s.useEffect((function(){if(!t)return e()}),a)}},164:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.useFirstMountState=void 0;var s=t(2);a.useFirstMountState=function(){var e=s.useRef(!0);return e.current?(e.current=!1,!0):e.current}},306:function(e,a,t){"use strict";t.r(a),t.d(a,"AccountManagementPage",(function(){return U}));var s=t(3),r=t(2),n=t.n(r),i=t(4),o=t(5),u=t(70),l=t(163),c=t.n(l),d=t(6),m=t(81),j=t(25);const g=["image/svg+xml","image/jpeg","image/png","image/gif"],b=64;const p=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i;var x=t(22),f=t(15),v=t(8);const O=Object(r.createContext)(void 0),h=O.Provider;function M(){const e=Object(r.useContext)(O);if(!e)throw new Error("FormChanges context is undefined, please verify you are calling useFormChangesContext() as child of a <FormChanges> component.");return e}var w=t(104),y=t(0);const F=e=>{const a=Object(u.useFormikContext)(),{report:t}=M(),i=a.getFieldMeta(e.for),o=i.value===i.initialValue;return Object(r.useEffect)((()=>t(o)),[o]),Object(y.jsx)(n.a.Fragment,null,e.children," ",o?void 0:Object(y.jsx)(s.EuiIcon,{type:"dot",color:"success",size:"s"}))};var P=t(106),k=t(83),E=t(71);const S=({user:e})=>{const{services:a}=Object(o.useKibana)();return Object(x.a)(e,a.application.capabilities)?Object(y.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,title:Object(y.jsx)("h2",null,Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.detailsGroupTitle",defaultMessage:"Details"})),description:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.detailsGroupDescription",defaultMessage:"Provide some basic information about yourself."})},Object(y.jsx)(P.a,{label:Object(y.jsx)(F,{for:"user.full_name"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.fullNameLabel",defaultMessage:"Full name"})),labelAppend:Object(y.jsx)(P.b,null),fullWidth:!0},Object(y.jsx)(w.a,{name:"user.full_name","data-test-subj":"userProfileFullName",fullWidth:!0})),Object(y.jsx)(P.a,{label:Object(y.jsx)(F,{for:"user.email"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.emailLabel",defaultMessage:"Email address"})),labelAppend:Object(y.jsx)(P.b,null),fullWidth:!0},Object(y.jsx)(w.a,{type:"email",name:"user.email","data-test-subj":"userProfileEmail",fullWidth:!0}))):null},T=({formik:e,isThemeOverridden:a,isOverriddenThemeDarkMode:t})=>{if(!e.values.data)return null;let r=e.values.data.userSettings.darkMode;a&&(r=t?"dark":"light");const n=({id:t,label:n,icon:i})=>Object(y.jsx)(s.EuiKeyPadMenuItem,{name:t,label:n,"data-test-subj":`themeKeyPadItem${n}`,checkable:"single",isSelected:r===t,isDisabled:a,onChange:()=>e.setFieldValue("data.userSettings.darkMode",t)},Object(y.jsx)(s.EuiIcon,{type:i,size:"l"}));return Object(y.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,fieldFlexItemProps:{style:{alignSelf:"flex-start"}},title:Object(y.jsx)("h2",null,Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.userSettingsTitle",defaultMessage:"Theme"})),description:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.themeFormGroupDescription",defaultMessage:"Select the appearance of your interface."})},Object(y.jsx)(P.a,{name:"data.userSettings.darkMode",fullWidth:!0},(e=>{const a=Object(y.jsx)(s.EuiKeyPadMenu,{"aria-label":i.i18n.translate("xpack.security.accountManagement.userProfile.userSettings.themeGroupDescription",{defaultMessage:"Elastic theme"}),"data-test-subj":"themeMenu",checkable:{legend:Object(y.jsx)(F,{for:"data.userSettings.darkMode"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.userSettings.theme",defaultMessage:"Mode"}))}},n({id:"",label:i.i18n.translate("xpack.security.accountManagement.userProfile.defaultModeButton",{defaultMessage:"Space default"}),icon:"spaces"}),n({id:"light",label:i.i18n.translate("xpack.security.accountManagement.userProfile.lightModeButton",{defaultMessage:"Light"}),icon:"sun"}),n({id:"dark",label:i.i18n.translate("xpack.security.accountManagement.userProfile.darkModeButton",{defaultMessage:"Dark"}),icon:"moon"}));return e?Object(y.jsx)(s.EuiToolTip,{"data-test-subj":"themeOverrideTooltip",content:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.overriddenMessage",defaultMessage:"This setting is overridden by the Kibana server and can not be changed."})},a):a})(a)))};function C({user:e,formik:a}){const{euiTheme:t}=Object(s.useEuiTheme)();if(!a.values.data)return null;const r=Object(E.c)(e);return Object(y.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,fieldFlexItemProps:{style:{alignSelf:"flex-start"}},title:Object(y.jsx)("h2",null,Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.avatarGroupTitle",defaultMessage:"Avatar"})),description:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.avatarGroupDescription",defaultMessage:"Provide your initials or upload an image to represent yourself."})},Object(y.jsx)(s.EuiFlexGroup,{responsive:!1},Object(y.jsx)(s.EuiFlexItem,{grow:!1},"image"!==a.values.avatarType||a.values.data.avatar.imageUrl?Object(y.jsx)(j.a,{user:{username:e.username,full_name:a.values.user.full_name},avatar:{imageUrl:"image"===a.values.avatarType?a.values.data.avatar.imageUrl:void 0,initials:a.values.data.avatar.initials||"?",color:p.test(a.values.data.avatar.color)?a.values.data.avatar.color:void 0},size:"xl"}):Object(y.jsx)(j.a,{size:"xl"})),Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(P.a,{name:"avatarType",label:Object(y.jsx)(F,{for:"avatarType"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.avatarTypeGroupDescription",defaultMessage:"Avatar type"})),fullWidth:!0},Object(y.jsx)(s.EuiButtonGroup,{legend:i.i18n.translate("xpack.security.accountManagement.userProfile.avatarTypeGroupDescription",{defaultMessage:"Avatar type"}),buttonSize:"m",idSelected:a.values.avatarType,options:[{id:"initials",label:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.initialsAvatarTypeLabel",defaultMessage:"Initials"})},{id:"image",label:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.imageAvatarTypeLabel",defaultMessage:"Image"}),iconType:"image"}],onChange:e=>a.setFieldValue("avatarType",e),isFullWidth:!0})))),Object(y.jsx)(s.EuiSpacer,null),"image"===a.values.avatarType?Object(y.jsx)(P.a,{label:Object(y.jsx)(F,{for:"data.avatar.imageUrl"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.imageUrlLabel",defaultMessage:"Image"})),fullWidth:!0},Object(y.jsx)(w.a,{as:s.EuiFilePicker,name:"data.avatar.imageUrl",value:void 0,initialPromptText:a.values.data.avatar.imageUrl?Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.prepopulatedImageUrlPromptText",defaultMessage:"Select or drag and drop a replacement image"}):Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.imageUrlPromptText",defaultMessage:"Select or drag and drop an image"}),onChange:(n=e=>{a.setFieldValue("data.avatar.imageUrl",null!=e?e:"")},async e=>{if(!e||!e.length)return void n(void 0);const a=e[0];if(-1!==g.indexOf(a.type)){const e=await(t=a,new Promise(((e,a)=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=a,s.readAsDataURL(t)}))),s=await function(e,a){return new Promise(((t,s)=>{const r=new Image;r.onload=()=>{if(r.width<=a&&r.height<=a)return t(e);try{const e=document.createElement("canvas"),s=e.getContext("2d");if(s){r.width>=r.height?(e.width=a,e.height=Math.floor(r.height*a/r.width)):(e.height=a,e.width=Math.floor(r.width*a/r.height)),s.drawImage(r,0,0,e.width,e.height);const n=e.toDataURL();return t(n)}}catch(e){return s(e)}return s()},r.onerror=s,r.src=e}))}(e,b);n(s)}var t}),validate:{required:i.i18n.translate("xpack.security.accountManagement.userProfile.imageUrlRequiredError",{defaultMessage:"Upload an image."})},accept:g.join(","),display:"default",fullWidth:!0})):Object(y.jsx)(s.EuiFlexGroup,{responsive:!1},Object(y.jsx)(s.EuiFlexItem,{grow:!1,style:{width:64}},Object(y.jsx)(P.a,{label:Object(y.jsx)(F,{for:"data.avatar.initials"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.initialsLabel",defaultMessage:"Initials"})),fullWidth:!0},Object(y.jsx)(w.a,{name:"data.avatar.initials",maxLength:2,validate:{required:i.i18n.translate("xpack.security.accountManagement.userProfile.initialsRequiredError",{defaultMessage:"Add initials"}),maxLength:{value:2,message:i.i18n.translate("xpack.security.accountManagement.userProfile.initialsMaxLengthError",{defaultMessage:"Enter no more than 2 characters."})}},fullWidth:!0}))),Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(P.a,{label:Object(y.jsx)(F,{for:"data.avatar.color"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.colorLabel",defaultMessage:"Color"})),labelAppend:r?null:Object(y.jsx)(s.EuiButtonEmpty,{onClick:()=>a.setFieldValue("data.avatar.color","#"+String(Math.floor(16777215*Math.random()).toString(16)).padStart(6,"0")),size:"xs",flush:"right",style:{height:t.base}},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.randomizeButton",defaultMessage:"Randomize"})),fullWidth:!0},Object(y.jsx)(w.a,{as:s.EuiColorPicker,name:"data.avatar.color",color:a.values.data.avatar.color,validate:{required:i.i18n.translate("xpack.security.accountManagement.userProfile.colorRequiredError",{defaultMessage:"Select a color."}),pattern:{value:p,message:i.i18n.translate("xpack.security.accountManagement.userProfile.colorPatternError",{defaultMessage:"Enter a valid HEX color code."})}},onChange:e=>{a.setFieldValue("data.avatar.color",e)},fullWidth:!0})))));var n}function I({user:e,onShowPasswordForm:a}){return Object(x.b)(e)?Object(y.jsx)(s.EuiDescribedFormGroup,{fullWidth:!0,title:Object(y.jsx)("h2",null,Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.passwordGroupTitle",defaultMessage:"Password"})),description:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.passwordGroupDescription",defaultMessage:"Protect your data with a strong password."})},Object(y.jsx)(s.EuiFormRow,{label:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.passwordLabel",defaultMessage:"Password"}),fullWidth:!0},Object(y.jsx)(s.EuiButton,{onClick:a,iconType:"lock","data-test-subj":"openChangePasswordForm"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.changePasswordButton",defaultMessage:"Change password"})))):null}const _=({user:e})=>{const{euiTheme:a}=Object(s.useEuiTheme)(),[t,i]=Object(r.useState)(!1),o=()=>i((e=>!e)),u=()=>i(!1),[l]=e.roles,c=e.roles.slice(1);return Object(y.jsx)(n.a.Fragment,null,Object(y.jsx)("div",{style:{maxWidth:a.breakpoint.m/6,display:"inline-block"}},Object(y.jsx)(s.EuiBadge,{key:l,color:"hollow","data-test-subj":`role${l}`},l)),c.length?(()=>{const e=Object(y.jsx)(s.EuiButtonEmpty,{size:"xs",onClick:o,"data-test-subj":"userRolesExpand"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.rolesCountLabel",defaultMessage:"+{count} more",values:{count:c.length}}));return Object(y.jsx)(s.EuiPopover,{panelPaddingSize:"s",button:e,isOpen:t,closePopover:u,"data-test-subj":"userRolesPopover"},Object(y.jsx)(s.EuiBadgeGroup,{gutterSize:"xs","data-test-subj":"remainingRoles",style:{maxWidth:"200px"}},c.map((e=>Object(y.jsx)(s.EuiBadge,{color:"hollow",key:e},e)))))})():null)},B=({user:e,data:a})=>{const{euiTheme:t}=Object(s.useEuiTheme)(),{services:l}=Object(o.useKibana)(),g=function({user:e,data:a}){var t,s,n,l,d,m,g,b;const{services:p}=Object(o.useKibana)(),{users:v}=Object(f.d)(),{update:O,showSuccessNotification:h}=Object(j.d)({notificationSuccess:{enabled:!1}}),[M,w]=Object(r.useState)({user:{full_name:e.full_name||"",email:e.email||""},data:a?{avatar:{initials:(null===(t=a.avatar)||void 0===t?void 0:t.initials)||Object(x.g)(e),color:(null===(s=a.avatar)||void 0===s?void 0:s.color)||Object(x.f)(e),imageUrl:(null===(n=a.avatar)||void 0===n?void 0:n.imageUrl)||""},userSettings:{darkMode:(null===(l=a.userSettings)||void 0===l?void 0:l.darkMode)||""}}:void 0,avatarType:null!=a&&null!==(d=a.avatar)&&void 0!==d&&d.imageUrl?"image":"initials"}),[y,F]=Object(r.useState)(!1),P=Object(u.useFormik)({onSubmit:async a=>{var t,s;const r=[];if(Object(x.a)(e,p.application.capabilities)&&r.push(v.saveUser({username:e.username,roles:e.roles,enabled:e.enabled,full_name:a.user.full_name,email:a.user.email})),a.data&&r.push(O("image"===a.avatarType?a.data:{...a.data,avatar:{...a.data.avatar,imageUrl:null}})),0===r.length)return;try{await Promise.all(r)}catch(e){return void p.notifications.toasts.addError(e,{title:i.i18n.translate("xpack.security.accountManagement.userProfile.submitErrorTitle",{defaultMessage:"Couldn't update profile"})})}w(a);let n=!1;(null===(t=M.data)||void 0===t?void 0:t.userSettings.darkMode)!==(null===(s=a.data)||void 0===s?void 0:s.userSettings.darkMode)&&(n=!0),h({isRefreshRequired:n})},initialValues:M,enableReinitialize:!0,validateOnBlur:y,validateOnChange:y});P.submitCount>0&&!y?F(!0):0===P.submitCount&&y&&F(!1);const k=Object(r.useRef)(!(null==a||null===(m=a.avatar)||void 0===m||!m.initials)&&(null===(g=a.avatar)||void 0===g?void 0:g.initials)!==Object(x.g)(e));return c()((()=>{if(!k.current){const a=Object(x.g)({username:e.username,full_name:P.values.user.full_name});P.setFieldValue("data.avatar.initials",a)}}),[P.values.user.full_name]),c()((()=>{if(!k.current&&P.values.data){const a=Object(x.g)({username:e.username,full_name:P.values.user.full_name});k.current=P.values.data.avatar.initials!==a}}),[null===(b=P.values.data)||void 0===b?void 0:b.avatar.initials]),P}({user:e,data:a}),b=(()=>{const[e,a]=Object(r.useState)(0);return{count:e,report:e=>{if(!e)return a((e=>e+1)),()=>a((e=>e-1))}}})(),p=Object(s.useGeneratedHtmlId)(),[O,M]=Object(r.useState)(!1),w=Object(x.a)(e,l.application.capabilities),F=e.elastic_cloud_user,{isThemeOverridden:P,isOverriddenThemeDarkMode:E}={isThemeOverridden:(B=l.settings.client).isOverridden("theme:darkMode"),isOverriddenThemeDarkMode:B.get("theme:darkMode")};var B;const U=[{title:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.usernameLabel",defaultMessage:"Username"}),description:e.username,helpText:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.usernameHelpText",defaultMessage:"User name cannot be changed after account creation."}),testSubj:"username"}];return w||(U.push({title:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.fullNameLabel",defaultMessage:"Full name"}),description:e.full_name,helpText:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.fullNameHelpText",defaultMessage:"Please contact an administrator to change your full name."}),testSubj:"full_name"}),U.push({title:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.emailLabel",defaultMessage:"Email address"}),description:e.email,helpText:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.emailHelpText",defaultMessage:"Please contact an administrator to change your email address."}),testSubj:"email"})),U.push({title:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.rolesLabel",defaultMessage:"{roles, plural, one {Role} other {Roles} }",values:{roles:e.roles.length}}),description:Object(y.jsx)(_,{user:e}),helpText:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.rolesHelpText",defaultMessage:"Roles control access and permissions across the Elastic Stack."}),testSubj:"userRoles"}),Object(y.jsx)(n.a.Fragment,null,Object(y.jsx)(u.FormikProvider,{value:g},Object(y.jsx)(h,{value:b},Object(y.jsx)(v.a,{text:i.i18n.translate("xpack.security.accountManagement.userProfile.title",{defaultMessage:"Profile"})},O?Object(y.jsx)(k.a,{username:e.username,onCancel:()=>M(!1),onSuccess:()=>M(!1)}):null,Object(y.jsx)(m.a,{className:"eui-fullHeight",restrictWidth:1e3},Object(y.jsx)(m.a.Header,{pageTitle:Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.title",defaultMessage:"Profile"}),id:p,rightSideItems:U.reverse().map((e=>Object(y.jsx)(s.EuiDescriptionList,{textStyle:"reverse",listItems:[{title:Object(y.jsx)(s.EuiText,{color:t.colors.darkestShade,size:"s"},Object(y.jsx)(s.EuiFlexGroup,{responsive:!1,alignItems:"center",gutterSize:"none"},Object(y.jsx)(s.EuiFlexItem,{grow:!1},e.title),Object(y.jsx)(s.EuiFlexItem,{grow:!1,style:{marginLeft:"0.33em"}},Object(y.jsx)(s.EuiIconTip,{type:"questionInCircle",content:e.helpText})))),description:Object(y.jsx)("span",{"data-test-subj":e.testSubj},e.description||Object(y.jsx)(s.EuiText,{color:t.colors.disabledText,size:"s"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.noneProvided",defaultMessage:"None provided"})))}],compressed:!0})))}),Object(y.jsx)(m.a.Section,null,Object(y.jsx)(u.Form,{"aria-labelledby":p},Object(y.jsx)(S,{user:e}),F?null:Object(y.jsx)(C,{user:e,formik:g}),Object(y.jsx)(I,{user:e,onShowPasswordForm:()=>M(!0)}),F?null:Object(y.jsx)(T,{formik:g,isThemeOverridden:P,isOverriddenThemeDarkMode:E}))),b.count>0?Object(y.jsx)(m.a.BottomBar,{paddingSize:"m",position:"fixed","data-test-subj":"userProfileBottomBar"},Object(y.jsx)(D,null)):null)))))},D=()=>{const e=Object(u.useFormikContext)(),{count:a}=M();return Object(y.jsx)(s.EuiFlexGroup,{alignItems:"center",style:{width:"100%"},responsive:!1},Object(y.jsx)(s.EuiFlexItem,null,Object(y.jsx)(s.EuiFlexGroup,{responsive:!1,gutterSize:"xs"},Object(y.jsx)(s.EuiFlexItem,{grow:!1},Object(y.jsx)(s.EuiIcon,{type:"dot",color:"success"})),Object(y.jsx)(s.EuiFlexItem,{grow:!1},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.unsavedChangesMessage",defaultMessage:"{count, plural, one {# unsaved change} other {# unsaved changes}}",values:{count:a}})))),Object(y.jsx)(s.EuiFlexItem,{grow:!1},Object(y.jsx)(s.EuiButtonEmpty,{onClick:e.handleReset,color:"text"},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.discardChangesButton",defaultMessage:"Discard"}))),Object(y.jsx)(s.EuiFlexItem,{grow:!1},Object(y.jsx)(s.EuiButton,{onClick:e.submitForm,"data-test-subj":"saveProfileChangesButton",isLoading:e.isSubmitting,isDisabled:e.submitCount>0&&!e.isValid,color:"success",iconType:"save",fill:!0},Object(y.jsx)(d.FormattedMessage,{id:"xpack.security.accountManagement.userProfile.saveChangesButton",defaultMessage:"{isSubmitting, select, true{Saving changes…} other{Save changes}}",values:{isSubmitting:e.isSubmitting}}))))},U=()=>{var e;const{services:a}=Object(o.useKibana)(),t=Object(f.c)(),r=Object(f.e)("avatar,userSettings"),n=r.error&&t.value&&Object(x.c)(t.value)?r.error:void 0,u=t.error||n;return u?Object(y.jsx)(s.EuiEmptyPrompt,{iconType:"warning",title:Object(y.jsx)("h2",null,u.message)}):!t.value||Object(x.c)(t.value)&&!r.value?null:Object(y.jsx)(v.a,{text:i.i18n.translate("xpack.security.accountManagement.userSettingsBreadcrumbRootLabel",{defaultMessage:"User settings"}),href:a.http.basePath.prepend("/security/account")},Object(y.jsx)(B,{user:t.value,data:null===(e=r.value)||void 0===e?void 0:e.data}))}},71:function(e,a,t){"use strict";t.d(a,"c",(function(){return r})),t.d(a,"b",(function(){return n})),t.d(a,"a",(function(){return i}));var s=t(4);const r=e=>{var a,t;return null!==(a=null===(t=e.metadata)||void 0===t?void 0:t._reserved)&&void 0!==a&&a},n=e=>{var a,t;return null!==(a=null===(t=e.metadata)||void 0===t?void 0:t._deprecated)&&void 0!==a&&a},i=e=>{var a,t;const r=null!==(a=null===(t=e.metadata)||void 0===t?void 0:t._deprecated_reason)&&void 0!==a?a:"";return s.i18n.translate("xpack.security.management.users.extendedUserDeprecationNotice",{defaultMessage:"The {username} user is deprecated. {reason}",values:{username:e.username,reason:r}})}},74:function(e,a,t){"use strict";t.d(a,"a",(function(){return u}));var s=t(18),r=t(2),n=t(29),i=t.n(n),o=t(51);function u(e){const a=function({onSubmit:e,validate:a,defaultValues:t}){const[n,o]=Object(r.useState)(t),[u,c]=Object(r.useState)({}),[d,m]=Object(r.useState)({}),[j,g]=Object(r.useState)(0),[b,p]=i()((async e=>{const t=await a(e);return c(t),0===Object.keys(t).length&&g(0),t}),[a]),[x,f]=i()((async a=>{const t=await p(a);if(m(function(e,a){return Object(s.cloneDeepWith)(e,(e=>{if("object"!=typeof e&&null!==e)return true}))}(a)),g(j+1),0===Object.keys(t).length)return e(a)}),[p,e]);return{setValue:async(e,a)=>{const t=l(n,e,a);o(t),await p(t)},setTouched:async(e,a=!0)=>{m(l(d,e,a)),await p(n)},setError:(e,a)=>{c(l(u,e,a)),m(l(d,e,!0))},reset:e=>{o(e),c({}),m({}),g(0)},submit:()=>f(n),values:n,errors:u,touched:d,isValidating:b.loading,isSubmitting:x.loading,submitError:x.error,isInvalid:Object.keys(u).length>0,isSubmitted:j>0}}(e),t={onSubmit:e=>{e.preventDefault(),a.submit()},onChange:e=>{const{name:t,type:s,checked:r,value:n}=e.target;t&&a.setValue(t,"checkbox"===s?r:n)},onBlur:e=>{const{name:t}=e.target;t&&a.setTouched(e.target.name)}};return[a,t]}function l(e,a,t){return Object(s.get)(e,a)!==t?Object(o.set)(Object(s.cloneDeep)(e),a,t):e}},83:function(e,a,t){"use strict";t.d(a,"a",(function(){return x}));var s=t(7),r=t.n(s),n=t(3),i=t(2),o=t.n(i),u=t(4),l=t(6),c=t(5),d=t(49),m=t(17),j=t(74),g=t(75),b=t(26),p=t(0);const x=({username:e,defaultValues:a={current_password:"",password:"",confirm_password:""},onSuccess:t,onCancel:s})=>{const{services:i}=Object(c.useKibana)(),{value:x,loading:f}=Object(m.c)(),v=(null==x?void 0:x.username)===e,O="kibana"===e||"kibana_system"===e,[h,{onBlur:M,...w}]=Object(j.a)({onSubmit:async a=>{try{await new b.UserAPIClient(i.http).changePassword(e,a.password,a.current_password),i.notifications.toasts.addSuccess(u.i18n.translate("xpack.security.management.users.changePasswordForm.successMessage",{defaultMessage:"Password successfully changed"})),null==t||t()}catch(e){var s,r;if(403!==(null===(s=e.body)||void 0===s?void 0:s.statusCode))throw i.notifications.toasts.addDanger({title:u.i18n.translate("xpack.security.management.users.changePasswordForm.errorMessage",{defaultMessage:"Could not change password"}),text:(null===(r=e.body)||void 0===r?void 0:r.message)||e.message}),e;h.setError("current_password",u.i18n.translate("xpack.security.management.users.changePasswordForm.currentPasswordInvalidError",{defaultMessage:"Invalid password."}))}},validate:async e=>((e,a)=>{const t={};return a&&(e.current_password||(t.current_password=u.i18n.translate("xpack.security.management.users.changePasswordForm.currentPasswordRequiredError",{defaultMessage:"Enter your current password."}))),e.password?e.password.length<6?t.password=u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordInvalidError",{defaultMessage:"Enter at least 6 characters."}):e.password!==e.confirm_password&&(t.confirm_password=u.i18n.translate("xpack.security.management.users.changePasswordForm.confirmPasswordInvalidError",{defaultMessage:"Passwords do not match."})):t.password=u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordRequiredError",{defaultMessage:"Enter a new password."}),t})(e,v),defaultValues:a}),y=Object(g.a)([f]),F=Object(n.useGeneratedHtmlId)({prefix:"modalForm"});return Object(p.jsx)(n.EuiModal,{onClose:s},Object(p.jsx)(n.EuiModalHeader,null,Object(p.jsx)(n.EuiModalHeaderTitle,{"data-test-subj":"confirmModalTitleText"},Object(p.jsx)(l.FormattedMessage,{id:"xpack.security.management.users.changePasswordForm.title",defaultMessage:"Change password"}))),Object(p.jsx)(n.EuiModalBody,null,Object(p.jsx)(n.EuiSkeletonText,{isLoading:f},Object(p.jsx)(n.EuiForm,r()({id:F,component:"form",noValidate:!0},w,{onBlur:e=>{requestAnimationFrame((()=>M(e)))}}),O?Object(p.jsx)(o.a.Fragment,null,Object(p.jsx)(n.EuiCallOut,{title:u.i18n.translate("xpack.security.management.users.changePasswordForm.systemUserTitle",{defaultMessage:"Kibana will lose connection to Elasticsearch"}),color:"danger",iconType:"warning",style:{maxWidth:d.euiThemeVars.euiFormMaxWidth}},Object(p.jsx)("p",null,Object(p.jsx)(l.FormattedMessage,{id:"xpack.security.management.users.changePasswordForm.systemUserWarning",defaultMessage:"After changing the password for the {username} user, Kibana will be unusable.",values:{username:e}})),Object(p.jsx)("p",null,Object(p.jsx)(l.FormattedMessage,{id:"xpack.security.management.users.changePasswordForm.systemUserDescription",defaultMessage:"To regain access, update your config file with the new password and restart Kibana."}))),Object(p.jsx)(n.EuiSpacer,null)):void 0,v?Object(p.jsx)(o.a.Fragment,null,Object(p.jsx)(n.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.currentPasswordLabel",{defaultMessage:"Current password"}),error:h.errors.current_password,isInvalid:h.touched.current_password&&!!h.errors.current_password},Object(p.jsx)(n.EuiFieldPassword,{name:"current_password",type:"dual",defaultValue:h.values.current_password,isInvalid:h.touched.current_password&&!!h.errors.current_password,autoComplete:"current-password",inputRef:y,"data-test-subj":"editUserChangePasswordCurrentPasswordInput"}))):Object(p.jsx)(n.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.userLabel",{defaultMessage:"User"})},Object(p.jsx)(n.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(p.jsx)(n.EuiFlexItem,{grow:!1},Object(p.jsx)(n.EuiIcon,{type:"user"})),Object(p.jsx)(n.EuiFlexItem,null,Object(p.jsx)(n.EuiSpacer,{size:"xs"}),Object(p.jsx)(n.EuiText,null,e),Object(p.jsx)(n.EuiSpacer,{size:"xs"})))),Object(p.jsx)(n.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordLabel",{defaultMessage:"New password"}),helpText:u.i18n.translate("xpack.security.management.users.changePasswordForm.passwordHelpText",{defaultMessage:"Password must be at least 6 characters."}),error:h.errors.password,isInvalid:h.touched.password&&!!h.errors.password},Object(p.jsx)(n.EuiFieldPassword,{name:"password",type:"dual",defaultValue:h.values.password,isInvalid:h.touched.password&&!!h.errors.password,autoComplete:"new-password",inputRef:v?void 0:y,"data-test-subj":"editUserChangePasswordNewPasswordInput"})),Object(p.jsx)(n.EuiFormRow,{label:u.i18n.translate("xpack.security.management.users.changePasswordForm.confirmPasswordLabel",{defaultMessage:"Confirm password"}),error:h.errors.confirm_password,isInvalid:h.touched.confirm_password&&!!h.errors.confirm_password},Object(p.jsx)(n.EuiFieldPassword,{name:"confirm_password",type:"dual",defaultValue:h.values.confirm_password,isInvalid:h.touched.confirm_password&&!!h.errors.confirm_password,autoComplete:"new-password","data-test-subj":"editUserChangePasswordConfirmPasswordInput"}))))),Object(p.jsx)(n.EuiModalFooter,null,Object(p.jsx)(n.EuiButtonEmpty,{"data-test-subj":"changePasswordFormCancelButton",isDisabled:h.isSubmitting,onClick:s},Object(p.jsx)(l.FormattedMessage,{id:"xpack.security.changePasswordForm.cancelButton",defaultMessage:"Cancel"})),Object(p.jsx)(n.EuiButton,{iconType:"lock",type:"submit",form:F,"data-test-subj":"changePasswordFormSubmitButton",isLoading:h.isSubmitting,isDisabled:f||h.isSubmitted&&h.isInvalid,color:O?"danger":void 0,fill:!0},Object(p.jsx)(l.FormattedMessage,{id:"xpack.security.changePasswordForm.confirmButton",defaultMessage:"{isSubmitting, select, true{Changing password…} other{Change password}}",values:{isSubmitting:h.isSubmitting}}))))}}}]);