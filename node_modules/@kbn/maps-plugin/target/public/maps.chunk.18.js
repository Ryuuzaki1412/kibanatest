/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.maps_bundle_jsonpfunction=window.maps_bundle_jsonpfunction||[]).push([[18],{173:function(e,t,s){"use strict";s.r(t),s.d(t,"suggestEMSTermJoinConfig",(function(){return i})),s.d(t,"emsAutoSuggest",(function(){return n}));var a=s(81);async function i(e){try{return n(e,await Object(a.getEmsFileLayers)())}catch(e){return null}}function n(e,t){const s=[];if(e.sampleValuesColumnName){const a=function(e,t,s){const a=[];return e.forEach((e=>{e.getFields().forEach((i=>{if(!i.alias||!i.alias.length)return;const n={layerId:e.getId(),field:i.id,displayName:e.getDisplayName()};i.alias.forEach((e=>{const o=new RegExp(e,"i"),l=!!t.match(o);let c;c=s?!(!i.values||!i.values.length)&&l&&r(s,i.values):l,c&&a.push(n)}))}))})),a}(t,e.sampleValuesColumnName,e.sampleValues);s.push(...a)}if(e.sampleValues&&e.sampleValues.length){const a=function(e,t){const s=[];return e.forEach((e=>{e.getFields().forEach((a=>{a.values&&a.values.length&&r(t,a.values)&&s.push({layerId:e.getId(),field:a.id,displayName:e.getDisplayName()})}))})),s}(t,e.sampleValues);s.push(...a)}const a=s.reduce(((e,t)=>{const s=e.find((e=>e.config.layerId===t.layerId&&e.config.field===t.layerId));return s?s.count+=1:e.push({config:t,count:1}),e}),[]);return a.sort(((e,t)=>t.count-e.count)),a.length?a[0].config:null}function r(e,t){for(let s=0;s<e.length;s++){const a=e[s].toString();if(!t.includes(a))return!1}return!0}},227:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var a=s(173);function i(e,t,s){const i=[];return t.rows.forEach((e=>{const t=e[s];t&&"__other__"!==t&&!i.includes(t)&&i.push(t)})),Object(a.emsAutoSuggest)({sampleValues:i},e)}},618:function(e,t,s){"use strict";s.r(t),s.d(t,"ChoroplethChart",(function(){return f}));var a=s(4),i=s.n(a),n=s(1),r=s(36),o=s(0),l=s(227),c=s(2),d=s.n(c),u=s(43),p=s(15),m=s(21),h=s(170),b=s(3);class passive_map_PassiveMap extends a.Component{constructor(...e){super(...e),d()(this,"_isMounted",!1),d()(this,"_prevPassiveLayer",this.props.passiveLayer),d()(this,"_embeddableRef",i.a.createRef()),d()(this,"_onRenderSubscription",void 0),d()(this,"state",{mapEmbeddable:null})}componentDidMount(){this._isMounted=!0,this._setupEmbeddable()}componentWillUnmount(){this._isMounted=!1,this.state.mapEmbeddable&&this.state.mapEmbeddable.destroy(),this._onRenderSubscription&&this._onRenderSubscription.unsubscribe()}componentDidUpdate(){this.state.mapEmbeddable&&this._prevPassiveLayer!==this.props.passiveLayer&&(this.state.mapEmbeddable.updateLayerById(this.props.passiveLayer),this._prevPassiveLayer=this.props.passiveLayer)}async _setupEmbeddable(){const e=Object(h.createBasemapLayerDescriptor)(),t=e?[e]:[],s=await this.props.factory.create({id:Object(u.v4)(),attributes:{title:"",layerListJSON:JSON.stringify([...t,this.props.passiveLayer])},filters:[],hidePanelTitles:!0,viewMode:m.ViewMode.VIEW,isLayerTOCOpen:!1,hideFilterActions:!0,mapSettings:{disableInteractive:!1,hideToolbarOverlay:!1,hideLayerControl:!1,hideViewControl:!1,initialLocation:r.INITIAL_LOCATION.AUTO_FIT_TO_BOUNDS,autoFitToDataBounds:!0}});s&&(this._onRenderSubscription=s.getOnRenderComplete$().subscribe((()=>{this._isMounted&&this.props.onRenderComplete()})),this._isMounted&&(s.setIsSharable(!1),this.setState({mapEmbeddable:s},(()=>{this.state.mapEmbeddable&&this._embeddableRef.current&&this.state.mapEmbeddable.render(this._embeddableRef.current)}))))}render(){return this.state.mapEmbeddable?Object(b.jsx)("div",{className:"mapEmbeddableContainer",ref:this._embeddableRef}):Object(b.jsx)(p.EuiLoadingChart,{mono:!0,size:"l"})}}function f({data:e,args:t,formatFactory:s,uiSettings:a,emsFileLayers:i,mapEmbeddableFactory:c,onRenderComplete:d}){if(!t.regionAccessor||!t.valueAccessor)return null;let u=t.emsLayerId?t.emsLayerId:o.Lb,p=t.emsField?t.emsField:"iso2";if(!t.emsLayerId||!t.emsField){const s=Object(l.a)(i,e,t.regionAccessor);s&&(u=s.layerId,p=s.field)}const m=function(e,t){const s=t.find((t=>t.getId()===e));return s?s.getDisplayName():null}(u,i),h={id:t.layerId,label:m?n.i18n.translate("xpack.maps.lens.choroplethChart.choroplethLayerLabel",{defaultMessage:"{emsLayerLabel} by {accessorLabel}",values:{emsLayerLabel:m,accessorLabel:y(e,t.valueAccessor)}}):"",joins:[{leftField:p,right:{id:t.valueAccessor,type:r.SOURCE_TYPES.TABLE_SOURCE,__rows:e.rows,__columns:[{name:t.regionAccessor,label:y(e,t.regionAccessor),type:"string"},{name:t.valueAccessor,label:y(e,t.valueAccessor),type:"number"}],term:t.regionAccessor}}],sourceDescriptor:{type:r.SOURCE_TYPES.EMS_FILE,id:u,tooltipProperties:[p]},style:{type:"VECTOR",properties:{[r.VECTOR_STYLES.FILL_COLOR]:{type:r.STYLE_TYPE.DYNAMIC,options:{color:"Blue to Red",colorCategory:"palette_0",fieldMetaOptions:{isEnabled:!0,sigma:3},type:r.COLOR_MAP_TYPE.ORDINAL,field:{name:t.valueAccessor,origin:r.FIELD_ORIGIN.JOIN},useCustomColorRamp:!1}},[r.VECTOR_STYLES.LINE_COLOR]:{type:r.STYLE_TYPE.STATIC,options:{color:"#3d3d3d"}},[r.VECTOR_STYLES.LINE_WIDTH]:{type:r.STYLE_TYPE.STATIC,options:{size:1}}},isTimeAware:!1},type:r.LAYER_TYPE.GEOJSON_VECTOR};return Object(b.jsx)(passive_map_PassiveMap,{passiveLayer:h,factory:c,onRenderComplete:d})}function y(e,t){const s=e.columns.find((e=>e.id===t));return s?s.name:t}}}]);