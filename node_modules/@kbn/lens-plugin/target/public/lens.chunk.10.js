/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[10],{116:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return o}));var s=a(27);const n=["_type","_source"];const i=e=>"_score"!==e.name&&["string","text","keyword","version","ip","number","geo_point","geo_shape"].includes(e.type),l=e=>!e.aggregatable&&i(e)||"geo_point"===e.type||"geo_shape"===e.type;function o(e,t){if(e=Object(s.defaults)(e,{count:5}),!i(e.field))throw new Error(`Analysis is not available this field type: "${e.field.type}". Field name: "${e.field.name}"`);const a=(l=e.hits,o=e.field,r=e.dataView,Object(s.map)(l,(function(e){return function(e,t,a){var i;const l={};function o(e,n=""){for(const[i,r]of Object.entries(e)){const e=n+i,u=null==t?void 0:t.fields.getByName(e);if(!1===(null==a?void 0:a.shallow)){const t="nested"===(null==u?void 0:u.type);if(Array.isArray(r)&&!t){r.forEach((t=>Object(s.isPlainObject)(t)&&o(t,e+".")));continue}}else if(void 0!==l[e])continue;const c=u&&"conflict"!==u.type,d=!Object(s.isPlainObject)(r);c||d?l[e]?Array.isArray(l[e])?l[e].push(r):l[e]=[l[e],r]:l[e]=r:o(r,e+".")}}return o(e.fields||{}),!1!==(null==a?void 0:a.source)&&e._source?o(e._source):null!=a&&a.includeIgnoredValues&&e.ignored_field_values&&Object.entries(e.ignored_field_values).forEach((([e,t])=>{l[e]?Array.isArray(l[e])?l[e]=[...l[e],...t]:l[e]=[l[e],...t]:l[e]=t})),null==t||null===(i=t.metaFields)||void 0===i||i.forEach((t=>{n.includes(t)||"_"!==t.charAt(0)||(l[t]=e[t])})),new Proxy(l,{ownKeys:e=>Reflect.ownKeys(e).sort(((e,a)=>{var s,n;const i=null==t||null===(s=t.metaFields)||void 0===s?void 0:s.includes(String(e)),l=null==t||null===(n=t.metaFields)||void 0===n?void 0:n.includes(String(a));return i&&l?String(e).localeCompare(String(a)):i?1:l?-1:String(e).localeCompare(String(a))}))})}(e,r,{includeIgnoredValues:!0})[o.name]})));var l,o,r;const{groups:u,sampledValues:c}=function(e,t){const a={};let n=0;return e.forEach((function(e){if(Object(s.isObject)(e)&&!Array.isArray(e))throw new Error("Analysis is not available for object fields.");let i,l=0;const o={};i=Array.isArray(e)?e:null==e?[]:[e],i.forEach((e=>{const s=t?t.convert(e):e;o[s]||(a.hasOwnProperty(s)?a[s].count++:a[s]={key:s,count:1,order:l++},o[s]=!0,n++)}))})),{groups:a,sampledValues:n}}(a,t);return{buckets:Object(s.sortBy)(u,["count","order"]).reverse().slice(0,e.count).map((e=>Object(s.pick)(e,["key","count"]))),sampledValues:c,sampledDocuments:e.hits.length}}},137:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"d",(function(){return c})),a.d(t,"c",(function(){return m})),a.d(t,"b",(function(){return g}));var s=a(50),n=a.n(s),i=a(116);const l=5e3,o=10,r=100;function u({dataViewPattern:e,timeFieldName:t,fromDate:a,toDate:s,dslQuery:n,runtimeMappings:i,aggs:l,fields:o,size:r}){const u=t?[{range:{[t]:{gte:a,lte:s,format:"strict_date_optional_time"}}},n]:[n];return 1===(null==o?void 0:o.length)&&u.push({exists:o[0]}),{index:e,body:{query:{bool:{filter:u}},aggs:l,fields:o,runtime_mappings:i,_source:(null==o||!o.length)&&void 0},track_total_hits:!0,size:null!=r?r:0}}async function c({searchHandler:e,dataView:t,field:a,fromDate:s,toDate:r,size:u}){return a.aggregatable?"geo_point"===a.type||"geo_shape"===a.type?await async function(e,t,a){try{const s=a.getFormatterForField(t);return await p(e,t,a,s)}catch(e){return console.error(e),{}}}(e,a,t):d(a)?"histogram"===a.type?await b(e,a,!1):g(a)?await async function(e,t){const a={sample:{sampler:{shard_size:l},aggs:{min_max_summary:{filter:{exists:{field:t.name}},aggs:{min:{min:{field:t.name}},max:{max:{field:t.name}}}}}}},s=await e({aggs:a}),n=s.aggregations.sample.min_max_summary.min.value,i=s.aggregations.sample.min_max_summary.max.value,o=s.aggregations.sample.doc_count;return{totalDocuments:j(s),sampledDocuments:o,sampledValues:o,numberSummary:{minValue:n,maxValue:i}}}(e,a):"number"===a.type?await b(e,a):"date"===a.type?await async function(e,t,a){const s=n.a.parse(a.fromDate),i=n.a.parse(a.toDate);if(!s)throw Error("Invalid fromDate value");if(!i)throw Error("Invalid toDate value");const l=Math.round((i.valueOf()-s.valueOf())/10);if(l<1)return{totalDocuments:0,histogram:{buckets:[]}};const o=`${l}ms`,r={histo:{date_histogram:{...f(t),fixed_interval:o}}},u=await e({aggs:r});return{totalDocuments:j(u),histogram:{buckets:u.aggregations.histo.buckets.map((e=>({count:e.doc_count,key:e.key})))}}}(e,a,{fromDate:s,toDate:r}):await async function(e,t,a=o){const s=f(t),n={sample:{sampler:{shard_size:l},aggs:{sample_count:{value_count:{...s}},top_values:{terms:{...s,size:a,shard_size:a<=10?25:void 0}}}}},i=await e({aggs:n}),r={buckets:i.aggregations.sample.top_values.buckets.map((e=>({count:e.doc_count,key:e.key})))};return{totalDocuments:j(i),sampledDocuments:i.aggregations.sample.doc_count,sampledValues:y(r,i.aggregations.sample.top_values.sum_other_doc_count)||i.aggregations.sample.sample_count.value,topValues:r}}(e,a,u):{}:Object(i.a)(a)?await p(e,a,t):{}}function d(e){return!("document"===e.type||e.type.includes("range")||"geo_point"===e.type||"geo_shape"===e.type||"murmur3"===e.type||"attachment"===e.type)}function m(e){return e.aggregatable&&d(e)||Object(i.c)(e)}function g(e){return"counter"===e.timeSeriesMetric}async function b(e,t,a=!0){const s=f(t),n={min_value:{min:{field:t.name}},max_value:{max:{field:t.name}},sample_count:{value_count:{...s}}},i={sample:{sampler:{shard_size:l},aggs:{...n}}},r={sample:{sampler:{shard_size:l},aggs:{...n,top_values:{terms:{...s,size:o}}}}},u=await e({aggs:a?r:i}),c=u.aggregations.sample.min_value.value,d=u.aggregations.sample.max_value.value,m="top_values"in u.aggregations.sample?u.aggregations.sample.top_values:{buckets:[],sum_other_doc_count:0},g={buckets:m.buckets.map((e=>({count:e.doc_count,key:e.key})))};let b=(d-c)/10;if(Number.isInteger(c)&&Number.isInteger(d)&&(b=Math.ceil(b)),0===b)return{totalDocuments:j(u),sampledValues:y(g,m.sum_other_doc_count)||u.aggregations.sample.sample_count.value,sampledDocuments:u.aggregations.sample.doc_count,topValues:g,histogram:a?{buckets:[]}:{buckets:[{count:u.aggregations.sample.doc_count,key:c}]}};const p={sample:{sampler:{shard_size:l},aggs:{histo:{histogram:{field:t.name,interval:b}}}}},h=await e({aggs:p});return{totalDocuments:j(u),sampledDocuments:u.aggregations.sample.doc_count,sampledValues:y(g,m.sum_other_doc_count)||u.aggregations.sample.sample_count.value,histogram:{buckets:h.aggregations.sample.histo.buckets.map((e=>({count:e.doc_count,key:e.key})))},topValues:g}}async function p(e,t,a,s){try{const n=f(t),l={size:r,fields:[n]},u=await e(l),c=Object(i.b)({hits:u.hits.hits,field:t,dataView:a,count:o},s);return{totalDocuments:j(u),sampledDocuments:c.sampledDocuments,sampledValues:c.sampledValues,topValues:{buckets:c.buckets}}}catch(e){return console.error(e),{}}}function f(e){return e.scripted?{script:{lang:e.lang,source:e.script}}:{field:e.name}}const j=e=>{var t,a;return null!==(t=null!==(a=e.hits.total.value)&&void 0!==a?a:e.hits.total)&&void 0!==t?t:0};function y(e,t){var a;return((null==e||null===(a=e.buckets)||void 0===a?void 0:a.reduce(((e,t)=>t.count+e),0))||0)+(t||0)}},561:function(e,t,a){"use strict";a.r(t);var s=a(7),n=a.n(s),i=a(98),l=a(542),o=a(50),r=a.n(o),u=a(4),c=a(28),d=a(35),m=a(0),g=a(23),b=a(116),p=a(137),f=a(174),j=a(516),y=a(2);const h=({areExamples:e,buckets:t,dataView:a,field:i,sampledValuesCount:l,color:o=v(),"data-test-subj":r,onAddFilter:c,overrideFieldTopValueBar:d})=>{if(null==t||!t.length)return null;const m=a.getFormatterForField(i),g=F(_(t),l),b=t.some((e=>!Number.isInteger(e.count/l)));return Object(y.jsx)("div",{"data-test-subj":e?"unifiedFieldStats-exampleValueBuckets":"unifiedFieldStats-topValueBuckets"},Object(y.jsx)("div",{"data-test-subj":`${r}-topValues`},t.map(((e,t)=>{const a=e.key,n=m.convert(a);return Object(y.jsx)(s.Fragment,{key:a},t>0&&Object(y.jsx)(u.EuiSpacer,{size:"s"}),Object(y.jsx)(j.default,{field:i,fieldValue:a,formattedFieldValue:n,formattedPercentage:x(e.count,l,b),progressValue:O(e.count,l),count:e.count,color:o,"data-test-subj":r,onAddFilter:c,overrideFieldTopValueBar:d}))})),g>0&&Object(y.jsx)(n.a.Fragment,null,Object(y.jsx)(u.EuiSpacer,{size:"s"}),Object(y.jsx)(j.default,{type:"other",field:i,fieldValue:void 0,formattedPercentage:x(g,l,b),progressValue:O(g,l),count:g,color:o,"data-test-subj":r,onAddFilter:c,overrideFieldTopValueBar:d}))))},v=()=>Object(u.euiPaletteColorBlind)()[1],x=(e,t,a)=>t>0?`${(Math.round(e/t*1e3)/10).toFixed(a?1:0)}%`:"",O=(e,t)=>t>0?e/t:0,_=e=>(null==e?void 0:e.reduce(((e,t)=>t.count+e),0))||0,F=(e,t)=>t&&e?t-e:0,S=({message:e})=>Object(y.jsx)(u.EuiText,{size:"s"},e),k=({dataView:e,field:t,numberSummary:a,"data-test-subj":s})=>{if(!a||!D(a))return null;const n=e.getFormatterForField(t),i=[{key:"min",label:m.i18n.translate("unifiedFieldList.fieldStats.numberSummary.minLabel",{defaultMessage:"min"}),value:n.convert(a.minValue,"text")},{key:"max",label:m.i18n.translate("unifiedFieldList.fieldStats.numberSummary.maxLabel",{defaultMessage:"max"}),value:n.convert(a.maxValue,"text")}],l=[{field:"label",name:"",align:u.LEFT_ALIGNMENT},{field:"value",name:"",render:e=>Object(y.jsx)("strong",null,e),align:u.RIGHT_ALIGNMENT}],o=m.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"});return Object(y.jsx)(u.EuiBasicTable,{compressed:!0,items:i,columns:l,tableCaption:o,"data-test-subj":`${s}-numberSummary`,responsive:!1,css:Object(y.css)("& .euiTableHeaderCell{",Object(u.euiScreenReaderOnly)(),";}& .euiTableRowCell{border-top:none;}","")})};function D(e){return"number"==typeof(null==e?void 0:e.minValue)&&"number"==typeof(null==e?void 0:e.maxValue)}var V=a(549);const T=({services:e,query:t,dslQuery:a,filters:o,fromDate:j,toDate:x,dataViewOrDataViewId:O,field:V,color:T=v(),"data-test-subj":w="fieldStats",overrideMissingContent:L,overrideFooter:E,onAddFilter:M,overrideFieldTopValueBar:A,onStateChange:z})=>{const{fieldFormats:C,uiSettings:B,charts:I,dataViews:N,data:R}=e,[$,G]=Object(s.useState)({isLoading:!1}),[P,H]=Object(s.useState)(null),Q=Object(s.useRef)(null),U=Object(s.useRef)(!1),q=Object(s.useCallback)((e=>{U.current||G(e)}),[G,U]);Object(s.useEffect)((function(){z&&z($)}),[z,$]);const K=Object(s.useCallback)((e=>{U.current||H(e)}),[H,U]);Object(s.useEffect)((()=>{!async function(){if(!U.current)try{var e;const s="string"==typeof O?await N.get(O):O;if(K(s),$.isLoading)return;q((e=>({...e,isLoading:!0}))),null===(e=Q.current)||void 0===e||e.abort(),Q.current=new AbortController;const n=await Object(f.a)({services:{data:R},dataView:s,field:V,fromDate:j,toDate:x,dslQuery:null!=a?a:Object(g.buildEsQuery)(s,null!=t?t:[],null!=o?o:[],Object(l.a)(B)),abortController:Q.current});Q.current=null,q((e=>({...e,isLoading:!1,totalDocuments:n.totalDocuments,sampledDocuments:n.sampledDocuments,sampledValues:n.sampledValues,histogram:n.histogram,topValues:n.topValues,numberSummary:n.numberSummary})))}catch(e){q((e=>({...e,isLoading:!1})))}}()}),[O,V,a,t,o,j,x,e]),Object(s.useEffect)((()=>()=>{var e;U.current=!0,null===(e=Q.current)||void 0===e||e.abort()}),[]);const W=I.theme.useChartsTheme(),Z=I.theme.useChartsBaseTheme(),J=Object(s.useMemo)((()=>{var e;return T?{...W,barSeriesStyle:{...W.barSeriesStyle,rect:{...(null===(e=W.barSeriesStyle)||void 0===e?void 0:e.rect)||{},fill:T}}}:W}),[W,T]),{isLoading:X,histogram:Y,topValues:ee,numberSummary:te,sampledValues:ae,sampledDocuments:se,totalDocuments:ne}=$;let ie=!!$.histogram;const le=r.a.parse(j),oe=r.a.parse(x),re=_(null==ee?void 0:ee.buckets),ue=F(re,ae);re&&Y&&Y.buckets.length&&ee&&ee.buckets.length&&(ie=ue/re>.9);const[ce,de]=Object(s.useState)(ie);if(X)return Object(y.jsx)(u.EuiLoadingSpinner,{"data-test-subj":`${w}-statsLoading`});if(!P)return null;const me=P.getFormatterForField(V);let ge=Object(y.jsx)(n.a.Fragment,null);function be(e){const t="unifiedFieldStats-statsFooter-docsCount",a=ne?Object(y.jsx)(u.EuiText,{color:"subdued",size:"xs","data-test-subj":`${w}-statsFooter`},se&&se<ne?Object(y.jsx)(c.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromSampleRecordsLabel",defaultMessage:"Calculated from {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:se,sampledDocumentsFormatted:Object(y.jsx)("strong",{"data-test-subj":t},C.getDefaultInstance(i.b.NUMBER,[i.a.INTEGER]).convert(se))}}):Object(y.jsx)(c.FormattedMessage,{id:"unifiedFieldList.fieldStats.calculatedFromTotalRecordsLabel",defaultMessage:"Calculated from {totalDocumentsFormatted} {totalDocuments, plural, one {record} other {records}}.",values:{totalDocuments:ne,totalDocumentsFormatted:Object(y.jsx)("strong",{"data-test-subj":t},C.getDefaultInstance(i.b.NUMBER,[i.a.INTEGER]).convert(ne))}})):Object(y.jsx)(n.a.Fragment,null);return Object(y.jsx)(n.a.Fragment,null,ge?Object(y.jsx)("div",{"data-test-subj":`${w}-title`},ge):Object(y.jsx)(n.a.Fragment,null),Object(y.jsx)(u.EuiSpacer,{size:"s"}),e,E?null==E?void 0:E({element:a,totalDocuments:ne,sampledDocuments:se}):Object(y.jsx)(n.a.Fragment,null,Object(y.jsx)(u.EuiSpacer,{size:"m"}),a))}if(!Object(p.c)(V)){const e=Object(y.jsx)(S,{message:m.i18n.translate("unifiedFieldList.fieldStats.notAvailableForThisFieldDescription",{defaultMessage:"Analysis is not available for this field."})});return L?L({reason:"unsupported",element:e}):e}if(Object(p.b)(V)&&D(te))return ge=Object(y.jsx)(u.EuiTitle,{size:"xxxs"},Object(y.jsx)("h6",null,m.i18n.translate("unifiedFieldList.fieldStats.numberSummary.summaryTableTitle",{defaultMessage:"Summary"}))),be(Object(y.jsx)(k,{dataView:P,field:V,numberSummary:te,"data-test-subj":w}));if(!(Y&&0!==Y.buckets.length||ee&&0!==ee.buckets.length)){const e=se&&ne&&se<ne?Object(y.jsx)(S,{message:m.i18n.translate("unifiedFieldList.fieldStats.noFieldDataInSampleDescription",{defaultMessage:"No field data for {sampledDocumentsFormatted} sample {sampledDocuments, plural, one {record} other {records}}.",values:{sampledDocuments:se,sampledDocumentsFormatted:C.getDefaultInstance(i.b.NUMBER,[i.a.INTEGER]).convert(se)}})}):Object(y.jsx)(S,{message:m.i18n.translate("unifiedFieldList.fieldStats.noFieldDataDescription",{defaultMessage:"No field data for the current search."})});return L?L({reason:"no-data",element:e}):e}if(Y&&Y.buckets.length&&ee&&ee.buckets.length?ge=Object(y.jsx)(n.a.Fragment,null,Object(y.jsx)(u.EuiButtonGroup,{"data-test-subj":"unifiedFieldStats-buttonGroup",buttonSize:"compressed",isFullWidth:!0,legend:m.i18n.translate("unifiedFieldList.fieldStats.displayToggleLegend",{defaultMessage:"Toggle either the"}),options:[{label:m.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"}),id:"topValues","data-test-subj":`${w}-buttonGroup-topValuesButton`},{label:m.i18n.translate("unifiedFieldList.fieldStats.fieldDistributionLabel",{defaultMessage:"Distribution"}),id:"histogram","data-test-subj":`${w}-buttonGroup-distributionButton`}],onChange:e=>{de("histogram"===e)},idSelected:ce?"histogram":"topValues"}),Object(y.jsx)(u.EuiSpacer,{size:"xs"})):"date"===V.type?ge=Object(y.jsx)(u.EuiTitle,{size:"xxxs"},Object(y.jsx)("h6",null,m.i18n.translate("unifiedFieldList.fieldStats.fieldTimeDistributionLabel",{defaultMessage:"Time distribution"}))):ee&&ee.buckets.length&&(ge=Object(y.jsx)(u.EuiTitle,{size:"xxxs"},Object(y.jsx)("h6",null,Object(b.c)(V)?m.i18n.translate("unifiedFieldList.fieldStats.examplesLabel",{defaultMessage:"Examples"}):m.i18n.translate("unifiedFieldList.fieldStats.topValuesLabel",{defaultMessage:"Top values"})))),Y&&Y.buckets.length){const e=m.i18n.translate("unifiedFieldList.fieldStats.countLabel",{defaultMessage:"Count"});if("date"===V.type)return be(Object(y.jsx)("div",{"data-test-subj":"unifiedFieldStats-timeDistribution"},Object(y.jsx)("div",{"data-test-subj":`${w}-histogram`},Object(y.jsx)(d.Chart,{size:{height:200,width:268}},Object(y.jsx)(d.Tooltip,{type:d.TooltipType.None}),Object(y.jsx)(d.Settings,{locale:m.i18n.getLocale(),theme:J,baseTheme:Z,xDomain:le&&oe?{min:le.valueOf(),max:oe.valueOf(),minInterval:Math.round((oe.valueOf()-le.valueOf())/10)}:void 0}),Object(y.jsx)(d.Axis,{id:"key",position:d.Position.Bottom,tickFormat:le&&oe?Object(d.niceTimeFormatter)([le.valueOf(),oe.valueOf()]):void 0,showOverlappingTicks:!0}),Object(y.jsx)(d.HistogramBarSeries,{data:Y.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:d.ScaleType.Time,yScaleType:d.ScaleType.Linear,timeZone:"local"})))));if(ce||!ee||!ee.buckets.length)return be(Object(y.jsx)("div",{"data-test-subj":"unifiedFieldStats-histogram"},Object(y.jsx)(d.Chart,{"data-test-subj":`${w}-histogram`,size:{height:200,width:"100%"}},Object(y.jsx)(d.Tooltip,{type:d.TooltipType.None}),Object(y.jsx)(d.Settings,{locale:m.i18n.getLocale(),rotation:90,theme:J,baseTheme:Z}),Object(y.jsx)(d.Axis,{id:"key",position:d.Position.Left,showOverlappingTicks:!0,tickFormat:e=>me.convert(e)}),Object(y.jsx)(d.HistogramBarSeries,{data:Y.buckets,id:e,xAccessor:"key",yAccessors:["count"],xScaleType:d.ScaleType.Linear,yScaleType:d.ScaleType.Linear}))))}return ee&&ee.buckets.length?be(Object(y.jsx)(h,{areExamples:Object(b.c)(V),buckets:ee.buckets,dataView:P,field:V,sampledValuesCount:ae,color:T,"data-test-subj":w,onAddFilter:M,overrideFieldTopValueBar:A})):null};t.default=e=>Object(y.jsx)(V.a,null,Object(y.jsx)(T,e))}}]);