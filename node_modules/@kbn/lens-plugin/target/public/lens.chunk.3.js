/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.lens_bundle_jsonpfunction=window.lens_bundle_jsonpfunction||[]).push([[3],Array(77).concat([function(e,t,a){e.exports=a(17)(1808)},function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return r}));const n="---",i="›";function s(e,t){return`${e}${n}${t}`}function l(e){if(e.includes(n)){const t=e.split(n);return t[t.length-1]}return e}function r(e,t,a){e.columns.filter((e=>e.isTransposed)).reverse().forEach((({columnId:n})=>{const l=t.columns.findIndex((e=>e.id===n)),r=t.columns[l],o=a[r.id],{uniqueValues:u,uniqueRawValues:c}=function(e,t,a){const n=new Map;e.rows.forEach((e=>{const i=e[a];n.set(t.convert(e[a]),i)}));return{uniqueValues:[...n.keys()],uniqueRawValues:[...n.values()]}}(t,o,n),d=e.columns.filter((e=>e.transposable)),p=e.columns.filter((e=>!e.transposable&&e.columnId!==n));t.columns.splice(l,1),function(e,t,a,n,l,r,o){!function(e,t,a){var n;e.columns=[...t],null===(n=a[0])||void 0===n||n.forEach(((t,n)=>{a.forEach((t=>{e.columns.push(t[n])}))}))}(e,t,a.map((e=>{const t=n.columns.find((t=>t.id===e.columnId)),a=l.map((a=>({...t,id:s(a,e.columnId),name:`${a} ${i} ${t.name}`})));return n.columns.splice(n.columns.findIndex((t=>t.id===e.columnId)),1,...a),l.map(((a,n)=>({...e,columnId:s(a,e.columnId),originalColumnId:e.originalColumnId||e.columnId,originalName:e.originalName||t.name,bucketValues:[...e.bucketValues||[],{originalBucketColumn:o,value:r[n]}]})))})))}(e,p,d,t,u,c,r),function(e,t,a,n,i,l){const r=function(e,t,a){const n={};return e.rows.forEach((e=>{const i=t.map((t=>a[t.columnId].convert(e[t.columnId]))).join(",");n[i]||(n[i]=[]),n[i].push(e)})),n}(e,t,a);e.rows=function(e,t,a,n,i){return Object.values(e).map((e=>{const l={};return t.forEach((t=>{l[t.columnId]=e[0][t.columnId]})),e.forEach((e=>{const t=a.convert(e[n]);i.forEach((a=>{l[s(t,a.columnId)]=e[a.columnId]}))})),l}))}(r,t,n,i,l)}(t,p,a,o,n,d)}))}},,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return l})),a.d(t,"g",(function(){return r})),a.d(t,"e",(function(){return o})),a.d(t,"f",(function(){return u})),a.d(t,"a",(function(){return c})),a.d(t,"d",(function(){return m}));var n=a(29),i=a(0);const s=n.euiLightVars.euiColorAccent,l="#F04E981A",r=e=>Boolean(e&&"range"===(null==e?void 0:e.key.type)),o=e=>Boolean(e&&"timestamp"in(null==e?void 0:e.key)),u=e=>Boolean(e&&"query"===e.type),c=(e,t,a)=>a?{...a,id:e}:p(e,t),d=i.i18n.translate("eventAnnotationCommon.manualAnnotation.defaultAnnotationLabel",{defaultMessage:"Event"}),p=(e,t)=>({label:d,type:"manual",key:{type:"point_in_time",timestamp:t},icon:"triangle",id:e}),m=(e,t,a)=>({filter:{type:"kibana_query",query:`${t}: *`,language:"kuery"},timeField:a,type:"query",key:{type:"point_in_time"},id:e,label:`${t}: *`})},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(78);function i(e,t){const a=null==e?void 0:e.columns.find((e=>e.id===t||Object(n.a)(e.id)===t));return"number"===(null==a?void 0:a.meta.type)}},,,,,,,,,,,,,function(e,t,a){e.exports=a(17)(448)},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return s}));var n=a(1),i=a.n(n);let s,l;!function(e){e._ID="_id",e._INDEX="_index",e._SOURCE="_source",e._TYPE="_type",e.STRING="string",e.TEXT="text",e.MATCH_ONLY_TEXT="match_only_text",e.KEYWORD="keyword",e.VERSION="version",e.BOOLEAN="boolean",e.OBJECT="object",e.DATE="date",e.DATE_NANOS="date_nanos",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.FLOAT="float",e.HALF_FLOAT="half_float",e.SCALED_FLOAT="scaled_float",e.DOUBLE="double",e.INTEGER="integer",e.LONG="long",e.SHORT="short",e.UNSIGNED_LONG="unsigned_long",e.AGGREGATE_METRIC_DOUBLE="aggregate_metric_double",e.FLOAT_RANGE="float_range",e.DOUBLE_RANGE="double_range",e.INTEGER_RANGE="integer_range",e.LONG_RANGE="long_range",e.NESTED="nested",e.BYTE="byte",e.IP="ip",e.IP_RANGE="ip_range",e.ATTACHMENT="attachment",e.TOKEN_COUNT="token_count",e.MURMUR3="murmur3",e.HISTOGRAM="histogram"}(s||(s={})),function(e){e._SOURCE="_source",e.ATTACHMENT="attachment",e.BOOLEAN="boolean",e.DATE="date",e.DATE_RANGE="date_range",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.IP="ip",e.IP_RANGE="ip_range",e.MURMUR3="murmur3",e.NUMBER="number",e.NUMBER_RANGE="number_range",e.STRING="string",e.UNKNOWN="unknown",e.CONFLICT="conflict",e.OBJECT="object",e.NESTED="nested",e.HISTOGRAM="histogram",e.MISSING="missing"}(l||(l={}));class kbn_field_type_KbnFieldType{constructor(e={}){i()(this,"name",void 0),i()(this,"sortable",void 0),i()(this,"filterable",void 0),i()(this,"esTypes",void 0),this.name=e.name||l.UNKNOWN,this.sortable=e.sortable||!1,this.filterable=e.filterable||!1,this.esTypes=Object.freeze((e.esTypes||[]).slice())}}new kbn_field_type_KbnFieldType({name:l.UNKNOWN});new kbn_field_type_KbnFieldType({name:l.STRING,sortable:!0,filterable:!0,esTypes:[s.STRING,s.TEXT,s.MATCH_ONLY_TEXT,s.KEYWORD,s.VERSION,s._TYPE,s._ID]}),new kbn_field_type_KbnFieldType({name:l.NUMBER,sortable:!0,filterable:!0,esTypes:[s.FLOAT,s.HALF_FLOAT,s.SCALED_FLOAT,s.DOUBLE,s.INTEGER,s.LONG,s.UNSIGNED_LONG,s.SHORT,s.BYTE,s.TOKEN_COUNT,s.AGGREGATE_METRIC_DOUBLE]}),new kbn_field_type_KbnFieldType({name:l.NUMBER_RANGE,sortable:!0,filterable:!0,esTypes:[s.FLOAT_RANGE,s.DOUBLE_RANGE,s.INTEGER_RANGE,s.LONG_RANGE]}),new kbn_field_type_KbnFieldType({name:l.DATE,sortable:!0,filterable:!0,esTypes:[s.DATE,s.DATE_NANOS]}),new kbn_field_type_KbnFieldType({name:l.DATE_RANGE,sortable:!0,filterable:!0,esTypes:[s.DATE_RANGE]}),new kbn_field_type_KbnFieldType({name:l.IP,sortable:!0,filterable:!0,esTypes:[s.IP]}),new kbn_field_type_KbnFieldType({name:l.IP_RANGE,sortable:!0,filterable:!0,esTypes:[s.IP_RANGE]}),new kbn_field_type_KbnFieldType({name:l.BOOLEAN,sortable:!0,filterable:!0,esTypes:[s.BOOLEAN]}),new kbn_field_type_KbnFieldType({name:l.OBJECT,esTypes:[s.OBJECT]}),new kbn_field_type_KbnFieldType({name:l.NESTED,esTypes:[s.NESTED]}),new kbn_field_type_KbnFieldType({name:l.GEO_POINT,esTypes:[s.GEO_POINT]}),new kbn_field_type_KbnFieldType({name:l.GEO_SHAPE,esTypes:[s.GEO_SHAPE]}),new kbn_field_type_KbnFieldType({name:l.ATTACHMENT,esTypes:[s.ATTACHMENT]}),new kbn_field_type_KbnFieldType({name:l.MURMUR3,esTypes:[s.MURMUR3]}),new kbn_field_type_KbnFieldType({name:l._SOURCE,esTypes:[s._SOURCE]}),new kbn_field_type_KbnFieldType({name:l.HISTOGRAM,filterable:!0,esTypes:[s.HISTOGRAM]}),new kbn_field_type_KbnFieldType({name:l.CONFLICT})},,function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return r})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return u}));var n=a(0),i=a(78),s=a(83);function l(e,t,a){var n;const i=Object(s.a)(a,e)&&(null==t?void 0:t.summaryRow)||"none";return{summaryRow:i,summaryLabel:null!==(n=null==t?void 0:t.summaryLabel)&&void 0!==n?n:r(i)}}function r(e){return o().find((({value:t})=>e===t)).label}function o(){return[{value:"none",label:n.i18n.translate("xpack.lens.table.summaryRow.none",{defaultMessage:"None"}),"data-test-subj":"lns-datatable-summary-none"},{value:"count",label:n.i18n.translate("xpack.lens.table.summaryRow.count",{defaultMessage:"Value count"}),"data-test-subj":"lns-datatable-summary-count"},{value:"sum",label:n.i18n.translate("xpack.lens.table.summaryRow.sum",{defaultMessage:"Sum"}),"data-test-subj":"lns-datatable-summary-sum"},{value:"avg",label:n.i18n.translate("xpack.lens.table.summaryRow.average",{defaultMessage:"Average"}),"data-test-subj":"lns-datatable-summary-avg"},{value:"min",label:n.i18n.translate("xpack.lens.table.summaryRow.minimum",{defaultMessage:"Minimum"}),"data-test-subj":"lns-datatable-summary-min"},{value:"max",label:n.i18n.translate("xpack.lens.table.summaryRow.maximum",{defaultMessage:"Maximum"}),"data-test-subj":"lns-datatable-summary-max"}]}function u(e,t,a,n){const s=function(e,t,a){const n=a.filter((e=>null!=e[t])).flatMap((e=>e[t])),i=n.length,s=n.reduce(((e,t)=>e+t),0);switch(e){case"sum":return s;case"count":return i;case"avg":return s/i;case"min":return Math.min(...n);case"max":return Math.max(...n);default:throw Error("No summary function found")}}(e.summaryRow,e.columnId,t.rows);return"count"===e.summaryRow?n.convert(s):a[Object(i.a)(e.columnId)].convert(s)}},,,,,,,,,,function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return s})),function(e){e.DOCUMENT="document",e.BINARY="binary",e.BOOLEAN="boolean",e.CONFLICT="conflict",e.COUNTER="counter",e.DATE="date",e.DATE_RANGE="date_range",e.DENSE_VECTOR="dense_vector",e.GAUGE="gauge",e.GEO_POINT="geo_point",e.GEO_SHAPE="geo_shape",e.HISTOGRAM="histogram",e.IP="ip",e.IP_RANGE="ip_range",e.FLATTENED="flattened",e.KEYWORD="keyword",e.MURMUR3="murmur3",e.NUMBER="number",e.NESTED="nested",e.RANK_FEATURE="rank_feature",e.RANK_FEATURES="rank_features",e.POINT="point",e.SHAPE="shape",e.SPARSE_VECTOR="sparse_vector",e.STRING="string",e.TEXT="text",e.VERSION="version"}(n||(n={}));const i=Object.values(n),s=e=>!!e&&i.includes(e)},,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(0),i=a(16),s=a.n(i),l=(a(7),a(2));const r=[{value:"asterisk",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"circle",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.circleIconLabel",{defaultMessage:"Circle"}),icon:({title:e,titleId:t,...a})=>Object(l.jsx)("svg",s()({width:16,height:16,viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{d:"M7.427.522c-.813.081-1.398.21-2.039.45a7.318 7.318 0 0 0-2.67 1.72A7.045 7.045 0 0 0 1.28 4.68 7.241 7.241 0 0 0 .507 8c0 1.196.243 2.24.773 3.32a7.047 7.047 0 0 0 1.425 1.975A7.047 7.047 0 0 0 4.68 14.72a7.254 7.254 0 0 0 3.32.773 7.254 7.254 0 0 0 3.32-.773 7.047 7.047 0 0 0 1.975-1.425 7.047 7.047 0 0 0 1.425-1.975A7.254 7.254 0 0 0 15.493 8a7.254 7.254 0 0 0-.773-3.32 7.045 7.045 0 0 0-1.438-1.988C12.111 1.524 10.695.818 9.027.571 8.773.533 7.659.499 7.427.522m1.426 1.041a6.519 6.519 0 0 1 3.091 1.271c.329.246.976.893 1.222 1.222.561.751.976 1.634 1.164 2.479a6.766 6.766 0 0 1 0 2.93c-.414 1.861-1.725 3.513-3.463 4.363a6.76 6.76 0 0 1-1.987.616c-.424.065-1.336.065-1.76 0-1.948-.296-3.592-1.359-4.627-2.993a7.502 7.502 0 0 1-.634-1.332A6.158 6.158 0 0 1 1.514 8c0-1.039.201-1.925.646-2.84.34-.698.686-1.18 1.253-1.747A5.956 5.956 0 0 1 5.16 2.16a6.452 6.452 0 0 1 3.693-.597"}))},{value:"editorComment",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pinFilled",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"starFilled",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.starFilledLabel",{defaultMessage:"Star filled"})},{value:"tag",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})},{value:"triangle",label:n.i18n.translate("eventAnnotationComponents.xyChart.iconSelect.triangleIconLabel",{defaultMessage:"Triangle"}),icon:({title:e,titleId:t,...a})=>Object(l.jsx)("svg",s()({width:"16",height:"16",fill:"none",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(l.jsx)("title",{id:t},e):null,Object(l.jsx)("path",{d:"M3.373 3.079c-.391.062-.637.158-.88.342-.545.415-.577 1.146-.087 1.979.174.296 3.984 6.347 4.164 6.613.32.474.755.838 1.117.937a1.7 1.7 0 0 0 .596.021c.138-.032.341-.126.49-.226.202-.135.523-.478.713-.762.378-.563 4.084-6.475 4.211-6.716.385-.733.368-1.339-.051-1.757-.168-.168-.437-.307-.767-.395l-.226-.06L8.12 3.05c-3.567-.004-4.579.002-4.747.029m9.267 1.004c.208.058.317.121.335.194.022.086-.029.259-.141.482-.129.258-4.174 6.679-4.327 6.87-.264.328-.441.419-.63.323-.116-.059-.33-.275-.454-.459-.276-.405-4.148-6.585-4.234-6.758a.93.93 0 0 1-.117-.364l-.011-.153.103-.053c.094-.048.288-.095.503-.121.044-.006 2.048-.008 4.453-.006 3.853.003 4.391.009 4.52.045"})),shouldRotate:!0}]},function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return f}));var n=a(7),i=a(4),s=a(15),l=a(542),r=a(144),o=a(134);const u=async()=>(await Promise.resolve().then(a.t.bind(null,23,7))).buildEsQuery,c=Object(i.htmlIdGenerator)(),d={fetchStatus:o.a.unknown,existingFieldsByFieldNameMap:{},numberOfFetches:0},p=new s.BehaviorSubject({});let m="";const g=e=>{const t=Object(n.useRef)(!0),[i,s]=Object(n.useState)(0),u=i>0,g=Object(n.useCallback)((async({dataViewId:e,query:n,filters:i,fromDate:r,toDate:u,services:{dataViews:c,data:g,core:f},onNoData:v,fetchId:h})=>{var x,y,j,O,I;if(!(e&&n&&r&&u))return;const k=null===(x=p.getValue())||void 0===x?void 0:x[e];if(!t.current)return;const T=(null!==(y=null==k?void 0:k.numberOfFetches)&&void 0!==y?y:0)+1;let M=null;try{M=await c.get(e,!1)}catch(e){}if(null===(j=M)||void 0===j||!j.title)return;s((e=>e+1));const w=Boolean(null===(O=(I=M).getAggregationRestrictions)||void 0===O?void 0:O.call(I)),C={...d,numberOfFetches:T};if(w)C.fetchStatus=o.a.succeeded,C.hasDataViewRestrictions=!0;else try{const t=await(async e=>{const{loadFieldExisting:t}=await a.e(17).then(a.bind(null,566));return await t(e)})({dslQuery:await b(M,n,i||[],Object(l.a)(f.uiSettings)),fromDate:r,toDate:u,timeFieldName:M.timeFieldName,data:g,uiSettingsClient:f.uiSettings,dataViewsService:c,dataView:M}),s=(null==t?void 0:t.existingFieldNames)||[];v&&1===T&&!s.filter((e=>{var t,a;return!(null!==(t=M)&&void 0!==t&&null!==(a=t.metaFields)&&void 0!==a&&a.includes(e))})).length&&v(e),C.existingFieldsByFieldNameMap=s.reduce(((e,t)=>(e[t]=!0,e)),{}),C.fetchStatus=o.a.succeeded}catch(e){C.fetchStatus=o.a.failed}t.current&&h===m&&p.next({...p.getValue(),[e]:C}),s((e=>e-1))}),[t,s]),f=e.dataViews.map((e=>{var t,a;return`${e.id}:${e.title}:${e.timeFieldName||"no-timefield"}:${null!==(t=null===(a=e.fields)||void 0===a?void 0:a.length)&&void 0!==t?t:0}`})).join(","),v=Object(n.useCallback)((async t=>{const a=window.performance.now(),n="fetchFieldsExistenceInfo",i=c();m=i;const s={fetchId:i,dataViewId:t,...e};if(t)return await g({...s,dataViewId:t}),void Object(r.a)(e.services.core.analytics,{eventName:n,duration:window.performance.now()-a,meta:{dataViewsCount:1}});await Promise.all(e.dataViews.map((e=>g({...s,dataViewId:e.id})))),Object(r.a)(e.services.core.analytics,{eventName:n,duration:window.performance.now()-a,meta:{dataViewsCount:e.dataViews.length}})}),[g,f,e.query,e.filters,e.fromDate,e.toDate,e.services.core]);return Object(n.useEffect)((()=>{e.disableAutoFetching||v()}),[v,e.disableAutoFetching]),Object(n.useEffect)((()=>()=>{t.current=!1,p.next({})}),[t]),Object(n.useMemo)((()=>({refetchFieldsExistenceInfo:v,isProcessing:u})),[v,u])},f=()=>{const e=Object(n.useRef)(!0),[t,a]=Object(n.useState)(p.getValue());Object(n.useEffect)((()=>{const t=p.subscribe((t=>{e.current&&Object.keys(t).length>0&&a((e=>({...e,...t})))}));return()=>{t.unsubscribe()}}),[a,e]);const i=Object(n.useCallback)(((e,a)=>{const n=t[e];return(null==n?void 0:n.fetchStatus)!==o.a.succeeded||(null==n?void 0:n.hasDataViewRestrictions)||Boolean(null==n?void 0:n.existingFieldsByFieldNameMap[a])}),[t]),s=Object(n.useCallback)((e=>e?t[e]:d),[t]),l=Object(n.useCallback)((e=>{var t;return(null===(t=s(e))||void 0===t?void 0:t.fetchStatus)||o.a.unknown}),[s]),r=Object(n.useCallback)((e=>{const t=s(e);return Boolean((null==t?void 0:t.fetchStatus)===o.a.failed||(null==t?void 0:t.hasDataViewRestrictions))}),[s]);return Object(n.useEffect)((()=>()=>{e.current=!1}),[e]),Object(n.useMemo)((()=>({hasFieldData:i,getFieldsExistenceStatus:l,isFieldsExistenceInfoUnavailable:r})),[i,l,r])};async function b(e,t,a,n){const i=await u();try{return i(e,t,a,n)}catch(e){return{bool:{must_not:{match_all:{}}}}}}},,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(16),i=a.n(n),s=a(7),l=a.n(s),r=a(4),o=a(2);const u=({children:e,condition:t,tooltipContent:a,...n})=>Object(o.jsx)(l.a.Fragment,null,t?Object(o.jsx)(r.EuiToolTip,i()({content:a,delay:"long"},n),Object(o.jsx)(l.a.Fragment,null,e)):e)},,,,,,,,,,function(e,t){e.exports={pow:function(e,t){if(null==t)throw new Error("Missing exponent");return Array.isArray(e)?e.map((e=>Math.pow(e,t))):Math.pow(e,t)}}},function(e,t){e.exports={eq:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e===t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e===t[a]))}return e===t}}},function(e,t,a){"use strict";let n,i;a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i})),function(e){e.failed="failed",e.succeeded="succeeded",e.unknown="unknown"}(n||(n={})),function(e){e.SpecialFields="SpecialFields",e.SelectedFields="SelectedFields",e.PopularFields="PopularFields",e.AvailableFields="AvailableFields",e.EmptyFields="EmptyFields",e.MetaFields="MetaFields",e.UnmappedFields="UnmappedFields"}(i||(i={}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(41);const i={number:{formatId:"number",decimalsToPattern:(e=2,t)=>0===e?"0,0"+(t?"a":""):`0,0.${"0".repeat(e)}${t?"a":""}`},percent:{formatId:"percent",decimalsToPattern:(e=2,t)=>0===e?`0,0${t?"a":""}%`:`0,0.${"0".repeat(e)}${t?"a":""}%`},bytes:{formatId:"bytes",decimalsToPattern:(e=2,t)=>0===e?"0,0b":`0,0.${"0".repeat(e)}b`},bits:{formatId:"bytes",decimalsToPattern:(e=2,t)=>0===e?"0,0bitd":`0,0.${"0".repeat(e)}bitd`},duration:{formatId:"duration",decimalsToPattern:()=>"",translateToFormatParams:e=>({inputFormat:e.fromUnit||n.DEFAULT_DURATION_INPUT_FORMAT.kind,outputFormat:e.toUnit||n.DEFAULT_DURATION_OUTPUT_FORMAT.method,outputPrecision:e.decimals,useShortSuffix:Boolean(e.compact),showSuffix:!0,includeSpaceWithSuffix:!0})},custom:{formatId:"custom",decimalsToPattern:()=>""}}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(421);case"v8light":return a(423)}},,,,,,,,,,,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(38),i=a(148),s=n.__importDefault(a(149));t.default=function(e,t){s.default(e,t,i.isDeepEqual)}},,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(229);case"v8light":return a(231)}},,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(241);case"v8light":return a(243)}},function(e,t,a){"use strict";e.exports=function e(t,a){if(t===a)return!0;if(t&&a&&"object"==typeof t&&"object"==typeof a){if(t.constructor!==a.constructor)return!1;var n,i,s;if(Array.isArray(t)){if((n=t.length)!=a.length)return!1;for(i=n;0!=i--;)if(!e(t[i],a[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===a.source&&t.flags===a.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===a.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===a.toString();if((n=(s=Object.keys(t)).length)!==Object.keys(a).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(a,s[i]))return!1;for(i=n;0!=i--;){var l=s[i];if(!e(t[l],a[l]))return!1}return!0}return t!=t&&a!=a}},,,,,,,function(e,t,a){const{get:n}=a(27),i=a(86),{functions:s}=a(326),{parse:l}=a(363),r=i((function(e,t){if(null==e)throw new Error("Missing expression");if("string"!=typeof e)throw new Error("Expression must be a string");try{return l(e,t)}catch(e){throw new Error(`Failed to parse expression. ${e.message}`)}}));function o(e,t,a){const i=Object.assign({},s,a);return function e(a){if("number"==typeof a)return a;if("function"===a.type)return function(t){const{name:a,args:n}=t,s=i[a];if(!s)throw new Error(`No such function: ${a}`);const l=n.map(e);return s.skipNumberValidation||u(l)?s(...l):NaN}(a);if("variable"===a.type){const e=function(e,t){const a=n(e,t);return void 0!==a?a:e[t]}(t,a.value);if(void 0===e)throw new Error(`Unknown variable: ${a.value}`);return e}if("namedArgument"===a.type)throw new Error(`Named arguments are not supported in tinymath itself, at ${a.name}`)}(e)}function u(e){return e.every((e=>Array.isArray(e)?u(e):"number"==typeof e&&!isNaN(e)))}e.exports={parse:r,evaluate:function(e,t={},a={}){return t=t||{},o(r(e),t,a)},interpret:o}},function(e,t){e.exports={add:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>e+t)):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e+t[a]))}return Array.isArray(e)?e.map((e=>e+t)):Array.isArray(t)?t.map((t=>t+e)):e+t}))}}},function(e,t){function a(e){if(Array.isArray(e))return e.length;throw new Error("Must pass an array")}a.skipNumberValidation=!0,e.exports={size:a}},function(e,t){const a=(e,t)=>Math.log(e)/Math.log(t);e.exports={log:function(e,t=Math.E){if(t<=0)throw new Error("Base out of range");if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Must be greater than 0");return a(e,t)}));if(e<0)throw new Error("Must be greater than 0");return a(e,t)}}},function(e,t){e.exports={max:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.max(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.max(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.max(e,t))):Array.isArray(t)?t.map((t=>Math.max(t,e))):Math.max(e,t)}))}}},function(e,t){e.exports={transpose:function(e,t){const a=e[t].length;return e[t].map(((t,n)=>e.map((e=>{if(Array.isArray(e)){if(e.length!==a)throw new Error("Array length mismatch");return e[n]}return e}))))}}},function(e,t){e.exports={min:function(...e){return 1===e.length?Array.isArray(e[0])?e[0].reduce(((e,t)=>Math.min(e,t))):e[0]:e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>Math.min(e,t[a])))}return Array.isArray(e)?e.map((e=>Math.min(e,t))):Array.isArray(t)?t.map((t=>Math.min(t,e))):Math.min(e,t)}))}}},function(e,t){e.exports={subtract:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e-t[a]))}return Array.isArray(e)?e.map((e=>e-t)):Array.isArray(t)?t.map((t=>e-t)):e-t}}},function(e,t){e.exports={lt:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e<t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e<t[a]))}return e<t}}},function(e,t){e.exports={gt:function(e,t){if(null==t)throw new Error("Missing b value");if(Array.isArray(e)){if(!Array.isArray(t))return e.every((e=>e>t));if(e.length!==t.length)throw new Error("Array length mismatch");return e.every(((e,a)=>e>t[a]))}return e>t}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n={META_FIELDS:"metaFields",DOC_HIGHLIGHT:"doc_table:highlight",QUERY_STRING_OPTIONS:"query:queryString:options",QUERY_ALLOW_LEADING_WILDCARDS:"query:allowLeadingWildcards",SEARCH_QUERY_LANGUAGE:"search:queryLanguage",SORT_OPTIONS:"sort:options",COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX:"courier:ignoreFilterIfFieldNotInIndex",COURIER_SET_REQUEST_PREFERENCE:"courier:setRequestPreference",COURIER_CUSTOM_REQUEST_PREFERENCE:"courier:customRequestPreference",COURIER_MAX_CONCURRENT_SHARD_REQUESTS:"courier:maxConcurrentShardRequests",SEARCH_INCLUDE_FROZEN:"search:includeFrozen",SEARCH_TIMEOUT:"search:timeout",HISTOGRAM_BAR_TARGET:"histogram:barTarget",HISTOGRAM_MAX_BARS:"histogram:maxBars",HISTORY_LIMIT:"history:limit",TIMEPICKER_REFRESH_INTERVAL_DEFAULTS:"timepicker:refreshIntervalDefaults",TIMEPICKER_QUICK_RANGES:"timepicker:quickRanges",TIMEPICKER_TIME_DEFAULTS:"timepicker:timeDefaults",FILTERS_PINNED_BY_DEFAULT:"filters:pinnedByDefault",FILTERS_EDITOR_SUGGEST_VALUES:"filterEditor:suggestValues",AUTOCOMPLETE_USE_TIMERANGE:"autocomplete:useTimeRange",AUTOCOMPLETE_VALUE_SUGGESTION_METHOD:"autocomplete:valueSuggestionMethod",DATE_FORMAT:"dateFormat",DATEFORMAT_TZ:"dateFormat:tz"}},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));const n=async e=>{const{loadFieldStats:t}=await a.e(11).then(a.bind(null,515));return await t(e)}},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(528);function i(e){return{type:Object(n.a)(e),scripted:e.scripted}}},function(e,t,a){"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},function(e,t,a){e.exports=a.p+"1cbd62546f764080f7071e03889e9de3.svg"},,,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return m})),a.d(t,"a",(function(){return f}));var n=a(16),i=a.n(n),s=a(7),l=a.n(s),r=a(30),o=a.n(r),u=a(4),c=a(2);const d={iconType:"questionInCircle",color:"gray"},p={binary:{iconType:"tokenBinary"},boolean:{iconType:"tokenBoolean"},conflict:{iconType:"warning",color:"euiColorVis9",shape:"square"},date:{iconType:"tokenDate"},date_range:{iconType:"tokenDate"},dense_vector:{iconType:"tokenVectorDense"},geo_point:{iconType:"tokenGeo"},geo_shape:{iconType:"tokenGeo"},ip:{iconType:"tokenIP"},ip_range:{iconType:"tokenIP"},flattened:{iconType:"tokenFlattened"},match_only_text:{iconType:"tokenString"},murmur3:{iconType:"tokenSearchType"},number:{iconType:"tokenNumber"},number_range:{iconType:"tokenNumber"},rank_feature:{iconType:"tokenRankFeature"},rank_features:{iconType:"tokenRankFeatures"},histogram:{iconType:"tokenHistogram"},_source:{iconType:"editorCodeBlock",color:"gray"},point:{iconType:"tokenShape"},shape:{iconType:"tokenShape"},sparse_vector:{iconType:"tokenVectorSparse"},string:{iconType:"tokenString"},text:{iconType:"tokenString"},keyword:{iconType:"tokenKeyword"},gauge:{iconType:"tokenMetricGauge"},counter:{iconType:"tokenMetricCounter"},nested:{iconType:"tokenNested"},version:{iconType:"tokenTag"}};function m({type:e,label:t,size:a="s",scripted:n,className:s,...l}){const r=p[e]||d;return Object(c.jsx)(u.EuiToken,i()({},r,{className:o()("kbnFieldIcon",s),"aria-label":t||e,title:t||e,size:a,fill:n?"dark":void 0},l))}a(445);const g={xs:"kbnFieldButton--xs",s:"kbnFieldButton--s"};function f({size:e,isActive:t=!1,fieldIcon:a,fieldName:n,fieldInfoIcon:s,fieldAction:r,flush:u,className:d,dragHandle:p,onClick:m,dataTestSubj:f,buttonProps:b,...v}){const h=o()("kbnFieldButton",e?g[e]:null,{"kbnFieldButton-isActive":t,"kbnFieldButton--flushBoth":"both"===u},d),x=o()("kbn-resetFocusState","kbnFieldButton__button"),y=Object(c.jsx)(l.a.Fragment,null,a&&Object(c.jsx)("span",{className:"kbnFieldButton__fieldIcon"},a),n&&Object(c.jsx)("span",{className:"kbnFieldButton__name eui-textBreakAll"},Object(c.jsx)("span",{className:"kbnFieldButton__nameInner"},n)),s&&Object(c.jsx)("div",{className:"kbnFieldButton__infoIcon"},s));return Object(c.jsx)("div",i()({className:h},v),p&&Object(c.jsx)("div",{className:"kbnFieldButton__dragHandle"},p),m?Object(c.jsx)("button",i()({onClick:e=>{"click"===e.type&&e.currentTarget.focus(),m()},"data-test-subj":f,className:x},b),y):Object(c.jsx)("div",{className:x,"data-test-subj":f},y),r&&Object(c.jsx)("div",{className:"kbnFieldButton__fieldAction"},r))}Object.keys(g)},,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(190);case"v8light":return a(192)}},function(e,t,a){var n=a(67),i=a(191);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell--multiline{white-space:pre-wrap}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(193);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDataTableContainer{height:100%}.lnsTableCell--multiline{white-space:pre-wrap}.lnsTableCell--left{text-align:left}.lnsTableCell--right{text-align:right}.lnsTableCell--center{text-align:center}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(195);case"v8light":return a(197)}},function(e,t,a){var n=a(67),i=a(196);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisualizationContainer{overflow:auto hidden;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{height:16px;width:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer{border-radius:6px;display:flex;height:100%;overflow:auto;position:relative;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin;width:100%}.lnsExpressionRenderer::-webkit-scrollbar{height:16px;width:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}.embPanel__content:hover .lnsEmbeddablePanelFeatureList_button{background:#1d1e24;color:#dfe5ef;transition:color .35s,background .35s}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(198);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisualizationContainer{overflow:auto hidden;scrollbar-color:#69707d80 #0000;scrollbar-width:thin;-webkit-user-select:text;user-select:text}.lnsVisualizationContainer::-webkit-scrollbar{height:16px;width:16px}.lnsVisualizationContainer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsVisualizationContainer::-webkit-scrollbar-corner,.lnsVisualizationContainer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer{border-radius:6px;display:flex;height:100%;overflow:auto;position:relative;scrollbar-color:#69707d80 #0000;scrollbar-width:thin;width:100%}.lnsExpressionRenderer::-webkit-scrollbar{height:16px;width:16px}.lnsExpressionRenderer::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsExpressionRenderer::-webkit-scrollbar-corner,.lnsExpressionRenderer::-webkit-scrollbar-track{background-color:#0000}.lnsExpressionRenderer .lnsExpressionRenderer__component{position:static}.lnsEmbeddedError{align-items:center;display:flex;flex-grow:1;justify-content:center;overflow:auto}.embPanel__content:hover .lnsEmbeddablePanelFeatureList_button{background:#fff;color:#343741;transition:color .35s,background .35s}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){var n=a(67),i=a(230);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(232);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}.lnsDynamicColoringClickable{cursor:pointer}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(234);case"v8light":return a(236)}},function(e,t,a){var n=a(67),i=a(235);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(237);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(16),i=a.n(n),s=(a(7),a(4)),l=a(119),r=a(2);const o=({onChange:e,value:t,defaultValue:a,allowFalsyValue:n,...o})=>{const{inputValue:u,handleInputChange:c,initialValue:d}=Object(l.a)({onChange:e,value:t,defaultValue:a},{allowFalsyValue:n});return Object(r.jsx)(s.EuiFieldText,i()({},o,{value:u,onChange:e=>{c(e.target.value)},placeholder:d}))},u=e=>Object(r.jsx)(o,i()({},e,{key:e.defaultValue}))},,,function(e,t,a){var n=a(67),i=a(242);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(244);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsPieToolbar__popover{width:400px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(246);case"v8light":return a(248)}},function(e,t,a){var n=a(67),i=a(247);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(249);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},,,,,,,function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(257);case"v8light":return a(259)}},function(e,t,a){var n=a(67),i=a(258);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(260);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisToolbarAxis__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(262);case"v8light":return a(264)}},function(e,t,a){var n=a(67),i=a(263);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(265);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(267);case"v8light":return a(269)}},function(e,t,a){var n=a(67),i=a(268);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(270);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsGaugeToolbar__popover{width:500px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(272);case"v8light":return a(274)}},function(e,t,a){var n=a(67),i=a(273);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(275);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsDynamicColoringRow{align-items:center}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){const{abs:n}=a(327),{add:i}=a(164),{cbrt:s}=a(328),{ceil:l}=a(329),{clamp:r}=a(330),{cos:o}=a(331),{count:u}=a(332),{cube:c}=a(333),{defaults:d}=a(334),{degtorad:p}=a(335),{divide:m}=a(336),{exp:g}=a(337),{first:f}=a(338),{fix:b}=a(339),{floor:v}=a(340),{last:h}=a(341),{log:x}=a(166),{log10:y}=a(342),{max:j}=a(167),{mean:O}=a(343),{median:I}=a(344),{min:k}=a(169),{mod:T}=a(345),{mode:M}=a(346),{multiply:w}=a(347),{pi:C}=a(348),{pow:E}=a(132),{radtodeg:S}=a(349),{random:F}=a(350),{range:P}=a(351),{round:_}=a(352),{sin:A}=a(353),{size:L}=a(165),{sqrt:D}=a(354),{square:R}=a(355),{subtract:B}=a(170),{sum:N}=a(356),{tan:z}=a(357),{unique:V}=a(358),{eq:G,lt:q,gt:H,lte:U,gte:$,ifelse:W}=a(359);e.exports={functions:{abs:n,add:i,cbrt:s,ceil:l,clamp:r,cos:o,count:u,cube:c,degtorad:p,defaults:d,divide:m,exp:g,first:f,fix:b,floor:v,ifelse:W,last:h,log:x,log10:y,max:j,mean:O,median:I,min:k,mod:T,mode:M,multiply:w,pi:C,pow:E,radtodeg:S,random:F,range:P,round:_,sin:A,size:L,sqrt:D,square:R,subtract:B,sum:N,tan:z,unique:V,eq:G,lt:q,gt:H,lte:U,gte:$}}},function(e,t){e.exports={abs:function(e){return Array.isArray(e)?e.map((e=>Math.abs(e))):Math.abs(e)}}},function(e,t){e.exports={cbrt:function(e){return Array.isArray(e)?e.map((e=>Math.cbrt(e))):Math.cbrt(e)}}},function(e,t){e.exports={ceil:function(e){return Array.isArray(e)?e.map((e=>Math.ceil(e))):Math.ceil(e)}}},function(e,t){const a=(e,t,a)=>{if(t>a)throw new Error("Min must be less than max");return Math.min(Math.max(e,t),a)};e.exports={clamp:function(e,t,n){if(null===n)throw new Error("Missing maximum value. You may want to use the 'min' function instead");if(null===t)throw new Error("Missing minimum value. You may want to use the 'max' function instead");if(Array.isArray(n)){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==n.length||e.length!==t.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t[i],n)))}if(Array.isArray(e)){if(e.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e[i],t,n)))}if(Array.isArray(t)){if(t.length!==n.length)throw new Error("Array length mismatch");return n.map(((n,i)=>a(e,t[i],n)))}return n.map((n=>a(e,t,n)))}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,n)=>a(e,t[n])))}return Array.isArray(e)?e.map((e=>a(e,t,n))):Array.isArray(t)?t.map((t=>a(e,t,n))):a(e,t,n)}}},function(e,t){e.exports={cos:function(e){return Array.isArray(e)?e.map((e=>Math.cos(e))):Math.cos(e)}}},function(e,t,a){const{size:n}=a(165);function i(e){return n(e)}i.skipNumberValidation=!0,e.exports={count:i}},function(e,t,a){const{pow:n}=a(132);e.exports={cube:function(e){return n(e,3)}}},function(e,t){function a(e,t){return Array.isArray(e)?e.map((e=>null==e?t:e)):null==e?t:e}e.exports={defaults:a},a.skipNumberValidation=!0},function(e,t){e.exports={degtorad:function(e){return Array.isArray(e)?e.map((e=>e*Math.PI/180)):e*Math.PI/180}}},function(e,t){e.exports={divide:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e/t[a]}))}if(Array.isArray(t))return t.map((t=>{if(0===t)throw new Error("Cannot divide by 0");return e/t}));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e/t)):e/t}}},function(e,t){e.exports={exp:function(e){return Array.isArray(e)?e.map((e=>Math.exp(e))):Math.exp(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[0]:e}a.skipNumberValidation=!0,e.exports={first:a}},function(e,t){const a=e=>e>0?Math.floor(e):Math.ceil(e);e.exports={fix:function(e){return Array.isArray(e)?e.map((e=>a(e))):a(e)}}},function(e,t){e.exports={floor:function(e){return Array.isArray(e)?e.map((e=>Math.floor(e))):Math.floor(e)}}},function(e,t){function a(e){return Array.isArray(e)?e[e.length-1]:e}a.skipNumberValidation=!0,e.exports={last:a}},function(e,t,a){const{log:n}=a(166);e.exports={log10:function(e){return n(e,10)}}},function(e,t,a){const{add:n}=a(164);e.exports={mean:function(...e){if(1===e.length)return Array.isArray(e[0])?n(e[0])/e[0].length:e[0];const t=n(...e);return Array.isArray(t)?t.map((t=>t/e.length)):t/e.length}}},function(e,t,a){const{transpose:n}=a(168),i=e=>{const t=e.length,a=Math.floor(t/2);return e.sort(((e,t)=>t-e)),t%2==0?(e[a]+e[a-1])/2:e[a]};e.exports={median:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={mod:function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("Array length mismatch");return e.map(((e,a)=>{if(0===t[a])throw new Error("Cannot divide by 0");return e%t[a]}))}if(Array.isArray(t))return t.map((t=>e%t));if(0===t)throw new Error("Cannot divide by 0");return Array.isArray(e)?e.map((e=>e%t)):e%t}}},function(e,t,a){const{transpose:n}=a(168),i=e=>{let t=0;const a={};return e.map((e=>{void 0===a[e]&&(a[e]=0),a[e]+=1,a[e]>t&&(t=a[e])})),Object.keys(a).filter((e=>a[e]===t)).map((e=>parseFloat(e))).sort(((e,t)=>e-t))};e.exports={mode:function(...e){if(1===e.length)return Array.isArray(e[0])?i(e[0]):e[0];const t=e.findIndex((e=>Array.isArray(e)));return-1!==t?n(e,t).map((e=>i(e))):i(e)}}},function(e,t){e.exports={multiply:function(...e){return e.reduce(((e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){if(t.length!==e.length)throw new Error("Array length mismatch");return e.map(((e,a)=>e*t[a]))}return Array.isArray(e)?e.map((e=>e*t)):Array.isArray(t)?t.map((t=>t*e)):e*t}))}}},function(e,t){e.exports={pi:function(){return Math.PI}}},function(e,t){e.exports={radtodeg:function(e){return Array.isArray(e)?e.map((e=>180*e/Math.PI)):180*e/Math.PI}}},function(e,t){e.exports={random:function(e,t){if(null==e)return Math.random();if(null==t){if(e<0)throw new Error("Min is greater than max");return Math.random()*e}if(e>t)throw new Error("Min is greater than max");return Math.random()*(t-e)+e}}},function(e,t,a){const{max:n}=a(167),{min:i}=a(169),{subtract:s}=a(170);e.exports={range:function(...e){return s(n(...e),i(...e))}}},function(e,t){const a=(e,t=0)=>Math.round(e*Math.pow(10,t))/Math.pow(10,t);e.exports={round:function(e,t){return Array.isArray(e)?e.map((e=>a(e,t))):a(e,t)}}},function(e,t){e.exports={sin:function(e){return Array.isArray(e)?e.map((e=>Math.sin(e))):Math.sin(e)}}},function(e,t){e.exports={sqrt:function(e){if(Array.isArray(e))return e.map((e=>{if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}));if(e<0)throw new Error("Unable find the square root of a negative number");return Math.sqrt(e)}}},function(e,t,a){const{pow:n}=a(132);e.exports={square:function(e){return n(e,2)}}},function(e,t){const a=(e,t)=>e+t;e.exports={sum:function(...e){return e.reduce(((e,t)=>Array.isArray(t)?e+t.reduce(a,0):e+t),0)}}},function(e,t){e.exports={tan:function(e){return Array.isArray(e)?e.map((e=>Math.tan(e))):Math.tan(e)}}},function(e,t){function a(e){return Array.isArray(e)?e.filter(((t,a)=>e.indexOf(t)===a)).length:1}a.skipNumberValidation=!0,e.exports={unique:a}},function(e,t,a){const{eq:n}=a(133),{lt:i}=a(171),{gt:s}=a(172),{lte:l}=a(360),{gte:r}=a(361),{ifelse:o}=a(362);e.exports={eq:n,lt:i,gt:s,lte:l,gte:r,ifelse:o}},function(e,t,a){const{eq:n}=a(133),{lt:i}=a(171);e.exports={lte:function(e,t){return n(e,t)||i(e,t)}}},function(e,t,a){const{eq:n}=a(133),{gt:i}=a(172);e.exports={gte:function(e,t){return n(e,t)||i(e,t)}}},function(e,t){function a(e,t,a){if("boolean"!=typeof e)throw Error("Condition clause is of the wrong type");if(null==t)throw new Error("Missing a value");if(null==a)throw new Error("Missing b value");return e?t:a}a.skipNumberValidation=!0,e.exports={ifelse:a}},function(e,t,a){"use strict";function n(e,t,a,i){var s=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(s,n.prototype),s.expected=t,s.found=a,s.location=i,s.name="SyntaxError",s}function i(e,t,a){return a=a||" ",e.length>t?e:(t-=e.length,e+(a+=a.repeat(t)).slice(0,t))}function s(e,t){var a,i={},s=(t=void 0!==t?t:{}).grammarSource,l={start:ze},r=ze,o='"',u='\\"',c="'",d="\\'",p=">",m="<",g="=",f="+",b="-",v="*",h="/",x="(",y=")",j=",",O=".",I="0",k=/^[ \t\n\r]/,T=/^[0-9A-Za-z._@[\]\-]/,M=/^[^"]/,w=/^[^']/,C=/^[a-zA-Z_]/,E=/^[a-zA-Z_\-]/,S=/^[eE]/,F=/^[1-9]/,P=/^[0-9]/,_=De("whitespace"),A=Le([" ","\t","\n","\r"],!1,!1),L=(Le([" "],!1,!1),Le(['"',"'"],!1,!1),Le([["A","Z"],["a","z"],"_","@",".","[","]","-"],!1,!1),Le([["0","9"],["A","Z"],["a","z"],".","_","@","[","]","-"],!1,!1)),D=De("literal"),R=Ae('"',!1),B=Ae('\\"',!1),N=Le(['"'],!0,!1),z=Ae("'",!1),V=Ae("\\'",!1),G=Le(["'"],!0,!1),q=Ae(">",!1),H=Ae("<",!1),U=Ae("=",!1),$=Ae("+",!1),W=Ae("-",!1),X=Ae("*",!1),Y=Ae("/",!1),Q=Ae("(",!1),K=Ae(")",!1),Z=De("arguments"),J=Ae(",",!1),ee=Le([["a","z"],["A","Z"],"_"],!1,!1),te=De("function"),ae=Le([["a","z"],["A","Z"],"_","-"],!1,!1),ne=De("number"),ie=Le(["e","E"],!1,!1),se=De("exponent"),le=Ae(".",!1),re=Ae("0",!1),oe=Le([["1","9"]],!1,!1),ue=Le([["0","9"]],!1,!1),ce=function(e){return e},de=function(){return'"'},pe=function(e){return{type:"variable",value:e.join(""),location:Qe(_e()),text:Pe()}},me=function(){return"'"},ge=function(e){return{type:"variable",value:e.join(""),location:Qe(_e()),text:Pe()}},fe=function(e){return{type:"variable",value:e.join(""),location:Qe(_e()),text:Pe()}},be=function(e,t,a){return{type:"function",name:Je(t),args:[e,a],location:Qe(_e()),text:Pe()}},ve=function(e,t){return Ze(e,t)},he=function(e,t){return Ze(e,t)},xe=function(e){return e},ye=function(e,t){return t},je=function(e,t){return[e].concat(t)},Oe=function(e){return e.join("")},Ie=function(e,t){return{type:"namedArgument",name:e.join(""),value:t,location:Qe(_e()),text:Pe()}},ke=function(e,t){return{type:"function",name:e.join(""),args:t||[],location:Qe(_e()),text:Pe()}},Te=function(){return parseFloat(Pe())},Me=0,we=0,Ce=[{line:1,column:1}],Ee=0,Se=[],Fe=0;if("startRule"in t){if(!(t.startRule in l))throw new Error("Can't start parsing from rule \""+t.startRule+'".');r=l[t.startRule]}function Pe(){return e.substring(we,Me)}function _e(){return Be(we,Me)}function Ae(e,t){return{type:"literal",text:e,ignoreCase:t}}function Le(e,t,a){return{type:"class",parts:e,inverted:t,ignoreCase:a}}function De(e){return{type:"other",description:e}}function Re(t){var a,n=Ce[t];if(n)return n;for(a=t-1;!Ce[a];)a--;for(n={line:(n=Ce[a]).line,column:n.column};a<t;)10===e.charCodeAt(a)?(n.line++,n.column=1):n.column++,a++;return Ce[t]=n,n}function Be(e,t){var a=Re(e),n=Re(t);return{source:s,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:n.line,column:n.column}}}function Ne(e){Me<Ee||(Me>Ee&&(Ee=Me,Se=[]),Se.push(e))}function ze(){return qe()}function Ve(){var t,a;for(Fe++,t=[],k.test(e.charAt(Me))?(a=e.charAt(Me),Me++):(a=i,0===Fe&&Ne(A));a!==i;)t.push(a),k.test(e.charAt(Me))?(a=e.charAt(Me),Me++):(a=i,0===Fe&&Ne(A));return Fe--,a=i,0===Fe&&Ne(_),t}function Ge(){var t;return T.test(e.charAt(Me))?(t=e.charAt(Me),Me++):(t=i,0===Fe&&Ne(L)),t}function qe(){var t;return(t=function(){var t,a,n,s,l;return t=Me,Ve(),(a=He())!==i?(n=Me,62===e.charCodeAt(Me)?(s=p,Me++):(s=i,0===Fe&&Ne(q)),s===i&&(60===e.charCodeAt(Me)?(s=m,Me++):(s=i,0===Fe&&Ne(H))),s!==i?(61===e.charCodeAt(Me)?(l=g,Me++):(l=i,0===Fe&&Ne(U)),l===i&&(l=null),n=s=[s,l]):(Me=n,n=i),n===i&&(n=Me,61===e.charCodeAt(Me)?(s=g,Me++):(s=i,0===Fe&&Ne(U)),s!==i?(61===e.charCodeAt(Me)?(l=g,Me++):(l=i,0===Fe&&Ne(U)),l!==i?n=s=[s,l]:(Me=n,n=i)):(Me=n,n=i)),n!==i&&(s=He())!==i?(l=Ve(),we=t,t=be(a,n,s)):(Me=t,t=i)):(Me=t,t=i),t}())===i&&(t=He())===i&&(t=function(){var t,a,n,s;return t=Me,Ve(),40===e.charCodeAt(Me)?(a=x,Me++):(a=i,0===Fe&&Ne(Q)),a!==i?(Ve(),(n=qe())!==i?(Ve(),41===e.charCodeAt(Me)?(s=y,Me++):(s=i,0===Fe&&Ne(K)),s!==i?(Ve(),we=t,t=xe(n)):(Me=t,t=i)):(Me=t,t=i)):(Me=t,t=i),t}()),t}function He(){var t;return(t=function(){var t,a,n,s,l,r;if(t=Me,Ve(),(a=Ue())!==i){if(n=[],s=Me,43===e.charCodeAt(Me)?(l=f,Me++):(l=i,0===Fe&&Ne($)),l===i&&(45===e.charCodeAt(Me)?(l=b,Me++):(l=i,0===Fe&&Ne(W))),l!==i&&(r=Ue())!==i?s=l=[l,r]:(Me=s,s=i),s!==i)for(;s!==i;)n.push(s),s=Me,43===e.charCodeAt(Me)?(l=f,Me++):(l=i,0===Fe&&Ne($)),l===i&&(45===e.charCodeAt(Me)?(l=b,Me++):(l=i,0===Fe&&Ne(W))),l!==i&&(r=Ue())!==i?s=l=[l,r]:(Me=s,s=i);else n=i;n!==i?(s=Ve(),we=t,t=ve(a,n)):(Me=t,t=i)}else Me=t,t=i;return t}())===i&&(t=Ue())===i&&(t=$e()),t}function Ue(){var t,a,n,s,l,r;if(t=Me,Ve(),(a=$e())!==i){for(n=[],s=Me,42===e.charCodeAt(Me)?(l=v,Me++):(l=i,0===Fe&&Ne(X)),l===i&&(47===e.charCodeAt(Me)?(l=h,Me++):(l=i,0===Fe&&Ne(Y))),l!==i&&(r=$e())!==i?s=l=[l,r]:(Me=s,s=i);s!==i;)n.push(s),s=Me,42===e.charCodeAt(Me)?(l=v,Me++):(l=i,0===Fe&&Ne(X)),l===i&&(47===e.charCodeAt(Me)?(l=h,Me++):(l=i,0===Fe&&Ne(Y))),l!==i&&(r=$e())!==i?s=l=[l,r]:(Me=s,s=i);s=Ve(),we=t,t=he(a,n)}else Me=t,t=i;return t}function $e(){var t;return(t=function(){var t,a,n,s;return t=Me,Ve(),40===e.charCodeAt(Me)?(a=x,Me++):(a=i,0===Fe&&Ne(Q)),a!==i?(Ve(),(n=He())!==i?(Ve(),41===e.charCodeAt(Me)?(s=y,Me++):(s=i,0===Fe&&Ne(K)),s!==i?(Ve(),we=t,t=xe(n)):(Me=t,t=i)):(Me=t,t=i)):(Me=t,t=i),t}())===i&&(t=function(){var t,a,n,s,l;if(Fe++,t=Me,Ve(),a=[],E.test(e.charAt(Me))?(n=e.charAt(Me),Me++):(n=i,0===Fe&&Ne(ae)),n!==i)for(;n!==i;)a.push(n),E.test(e.charAt(Me))?(n=e.charAt(Me),Me++):(n=i,0===Fe&&Ne(ae));else a=i;return a!==i?(40===e.charCodeAt(Me)?(n=x,Me++):(n=i,0===Fe&&Ne(Q)),n!==i?(Ve(),s=function(){var t,a,n,s,l,r,o;if(Fe++,t=Me,(a=We())!==i){for(n=[],s=Me,l=Ve(),44===e.charCodeAt(Me)?(r=j,Me++):(r=i,0===Fe&&Ne(J)),r!==i?(Ve(),(o=We())!==i?(we=s,s=ye(a,o)):(Me=s,s=i)):(Me=s,s=i);s!==i;)n.push(s),s=Me,l=Ve(),44===e.charCodeAt(Me)?(r=j,Me++):(r=i,0===Fe&&Ne(J)),r!==i?(Ve(),(o=We())!==i?(we=s,s=ye(a,o)):(Me=s,s=i)):(Me=s,s=i);s=Ve(),44===e.charCodeAt(Me)?(l=j,Me++):(l=i,0===Fe&&Ne(J)),l===i&&(l=null),we=t,t=je(a,n)}else Me=t,t=i;return Fe--,t===i&&(a=i,0===Fe&&Ne(Z)),t}(),s===i&&(s=null),Ve(),41===e.charCodeAt(Me)?(l=y,Me++):(l=i,0===Fe&&Ne(K)),l!==i?(Ve(),we=t,t=ke(a,s)):(Me=t,t=i)):(Me=t,t=i)):(Me=t,t=i),Fe--,t===i&&0===Fe&&Ne(te),t}())===i&&(t=function(){var t,a;return Fe++,t=Me,Ve(),(a=Xe())===i&&(a=function(){var t,a,n,s,l;if(t=Me,Ve(),34===e.charCodeAt(Me)?(a=o,Me++):(a=i,0===Fe&&Ne(R)),a!==i){for(n=[],s=Me,e.substr(Me,2)===u?(l=u,Me+=2):(l=i,0===Fe&&Ne(B)),l!==i&&(we=s,l=de()),(s=l)===i&&(M.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(N)));s!==i;)n.push(s),s=Me,e.substr(Me,2)===u?(l=u,Me+=2):(l=i,0===Fe&&Ne(B)),l!==i&&(we=s,l=de()),(s=l)===i&&(M.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(N)));34===e.charCodeAt(Me)?(s=o,Me++):(s=i,0===Fe&&Ne(R)),s!==i?(l=Ve(),we=t,t=pe(n)):(Me=t,t=i)}else Me=t,t=i;if(t===i){if(t=Me,Ve(),39===e.charCodeAt(Me)?(a=c,Me++):(a=i,0===Fe&&Ne(z)),a!==i){for(n=[],s=Me,e.substr(Me,2)===d?(l=d,Me+=2):(l=i,0===Fe&&Ne(V)),l!==i&&(we=s,l=me()),(s=l)===i&&(w.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(G)));s!==i;)n.push(s),s=Me,e.substr(Me,2)===d?(l=d,Me+=2):(l=i,0===Fe&&Ne(V)),l!==i&&(we=s,l=me()),(s=l)===i&&(w.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(G)));39===e.charCodeAt(Me)?(s=c,Me++):(s=i,0===Fe&&Ne(z)),s!==i?(l=Ve(),we=t,t=ge(n)):(Me=t,t=i)}else Me=t,t=i;if(t===i){if(t=Me,Ve(),a=[],(n=Ge())!==i)for(;n!==i;)a.push(n),n=Ge();else a=i;a!==i?(n=Ve(),we=t,t=fe(a)):(Me=t,t=i)}}return t}()),a!==i?(Ve(),we=t,t=ce(a)):(Me=t,t=i),Fe--,t===i&&0===Fe&&Ne(D),t}()),t}function We(){var t,a,n,s,l;if(t=Me,a=[],C.test(e.charAt(Me))?(n=e.charAt(Me),Me++):(n=i,0===Fe&&Ne(ee)),n!==i)for(;n!==i;)a.push(n),C.test(e.charAt(Me))?(n=e.charAt(Me),Me++):(n=i,0===Fe&&Ne(ee));else a=i;return a!==i?(n=Ve(),61===e.charCodeAt(Me)?(s=g,Me++):(s=i,0===Fe&&Ne(U)),s!==i?(Ve(),(l=Xe())===i&&(l=function(){var t,a,n,s,l;if(t=Me,34===e.charCodeAt(Me)?(a=o,Me++):(a=i,0===Fe&&Ne(R)),a!==i){for(n=[],s=Me,e.substr(Me,2)===u?(l=u,Me+=2):(l=i,0===Fe&&Ne(B)),l!==i&&(we=s,l=de()),(s=l)===i&&(M.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(N)));s!==i;)n.push(s),s=Me,e.substr(Me,2)===u?(l=u,Me+=2):(l=i,0===Fe&&Ne(B)),l!==i&&(we=s,l=de()),(s=l)===i&&(M.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(N)));34===e.charCodeAt(Me)?(s=o,Me++):(s=i,0===Fe&&Ne(R)),s!==i?(we=t,t=Oe(n)):(Me=t,t=i)}else Me=t,t=i;if(t===i){if(t=Me,39===e.charCodeAt(Me)?(a=c,Me++):(a=i,0===Fe&&Ne(z)),a!==i){for(n=[],s=Me,e.substr(Me,2)===d?(l=d,Me+=2):(l=i,0===Fe&&Ne(V)),l!==i&&(we=s,l=me()),(s=l)===i&&(w.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(G)));s!==i;)n.push(s),s=Me,e.substr(Me,2)===d?(l=d,Me+=2):(l=i,0===Fe&&Ne(V)),l!==i&&(we=s,l=me()),(s=l)===i&&(w.test(e.charAt(Me))?(s=e.charAt(Me),Me++):(s=i,0===Fe&&Ne(G)));39===e.charCodeAt(Me)?(s=c,Me++):(s=i,0===Fe&&Ne(z)),s!==i?(we=t,t=Oe(n)):(Me=t,t=i)}else Me=t,t=i;if(t===i){if(t=Me,a=[],(n=Ge())!==i)for(;n!==i;)a.push(n),n=Ge();else a=i;a!==i&&(we=t,a=Oe(a)),t=a}}return t}()),l!==i?(Ve(),we=t,t=Ie(a,l)):(Me=t,t=i)):(Me=t,t=i)):(Me=t,t=i),t===i&&(t=qe()),t}function Xe(){var t,a,n,s,l;return Fe++,t=Me,45===e.charCodeAt(Me)?(a=b,Me++):(a=i,0===Fe&&Ne(W)),a===i&&(a=null),n=function(){var t,a,n,s;if(48===e.charCodeAt(Me)?(t=I,Me++):(t=i,0===Fe&&Ne(re)),t===i)if(t=Me,F.test(e.charAt(Me))?(a=e.charAt(Me),Me++):(a=i,0===Fe&&Ne(oe)),a!==i){for(n=[],s=Ye();s!==i;)n.push(s),s=Ye();t=a=[a,n]}else Me=t,t=i;return t}(),n!==i?(s=function(){var t,a,n,s;if(t=Me,46===e.charCodeAt(Me)?(a=O,Me++):(a=i,0===Fe&&Ne(le)),a!==i){if(n=[],(s=Ye())!==i)for(;s!==i;)n.push(s),s=Ye();else n=i;n!==i?t=a=[a,n]:(Me=t,t=i)}else Me=t,t=i;return t}(),s===i&&(s=null),l=function(){var t,a,n,s,l;if(Fe++,t=Me,a=function(){var t;return S.test(e.charAt(Me))?(t=e.charAt(Me),Me++):(t=i,0===Fe&&Ne(ie)),t}(),a!==i){if(45===e.charCodeAt(Me)?(n=b,Me++):(n=i,0===Fe&&Ne(W)),n===i&&(n=null),s=[],(l=Ye())!==i)for(;l!==i;)s.push(l),l=Ye();else s=i;s!==i?t=a=[a,n,s]:(Me=t,t=i)}else Me=t,t=i;return Fe--,t===i&&(a=i,0===Fe&&Ne(se)),t}(),l===i&&(l=null),we=t,t=Te()):(Me=t,t=i),Fe--,t===i&&(a=i,0===Fe&&Ne(ne)),t}function Ye(){var t;return P.test(e.charAt(Me))?(t=e.charAt(Me),Me++):(t=i,0===Fe&&Ne(ue)),t}function Qe(e){return{min:e.start.offset,max:e.end.offset}}const Ke={"+":"add","-":"subtract","*":"multiply","/":"divide","<":"lt",">":"gt","==":"eq","<=":"lte",">=":"gte"};function Ze(e,t){const a=t.reduce(((e,[t,a])=>({type:"function",name:Ke[t],args:[e,a]})),e);return"object"==typeof a&&(a.location=Qe(_e()),a.text=Pe()),a}function Je([e,t]){return Ke[e+(t||"")]}if((a=r())!==i&&Me===e.length)return a;throw a!==i&&Me<e.length&&Ne({type:"end"}),function(e,t,a){return new n(n.buildMessage(e,t),e,t,a)}(Se,Ee<e.length?e.charAt(Ee):null,Ee<e.length?Be(Ee,Ee+1):Be(Ee,Ee))}a.r(t),a.d(t,"SyntaxError",(function(){return n})),a.d(t,"parse",(function(){return s})),function(e,t){function a(){this.constructor=e}a.prototype=t.prototype,e.prototype=new a}(n,Error),n.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var a,n=null;for(a=0;a<e.length;a++)if(e[a].source===this.location.source){n=e[a].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,l=this.location.source+":"+s.line+":"+s.column;if(n){var r=this.location.end,o=i("",s.line.toString().length),u=n[s.line-1],c=s.line===r.line?r.column:u.length+1;t+="\n --\x3e "+l+"\n"+o+" |\n"+s.line+" | "+u+"\n"+o+" | "+i("",s.column-1)+i("",c-s.column,"^")}else t+="\n at "+l}return t},n.buildMessage=function(e,t){var a={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e)}));return"["+(e.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function l(e){return a[e.type](e)}return"Expected "+function(e){var t,a,n=e.map(l);if(n.sort(),n.length>0){for(t=1,a=1;t<n.length;t++)n[t-1]!==n[t]&&(n[a]=n[t],a++);n.length=a}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+i(e)+'"':"end of input"}(t)+" found."}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(365);case"v8light":return a(367)}},function(e,t,a){var n=a(67),i=a(366);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.documentation__docs{background:#1d1e24}.documentation__docsHeader{margin:0}.documentation__docs--inline{display:flex;flex-direction:column;z-index:1}.documentation__docs--overlay .documentation__docsContent{height:40vh;width:min(75vh,90vw)}.documentation__docs--inline .documentation__docsContent{flex:1;min-height:0}.documentation__docsContent>*+*{border-left:1px solid #343741}.documentation__docsSidebar{background:#25262e}.documentation__docsSidebarInner{min-height:0}.documentation__docsSidebarInner>*+*{border-top:1px solid #343741}.documentation__docsSearch{padding:16px}.documentation__docsNav{height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.documentation__docsNav::-webkit-scrollbar{height:16px;width:16px}.documentation__docsNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.documentation__docsNav::-webkit-scrollbar-corner,.documentation__docsNav::-webkit-scrollbar-track{background-color:#0000}.documentation__docsNav:focus{outline:none}.documentation__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsNavGroup{padding:16px}.documentation__docsNavGroup+.documentation__docsNavGroup{border-top:1px solid #343741}.documentation__docsNavGroupLink{font-weight:inherit}.documentation__docsText{height:100%;overflow-x:hidden;overflow-y:auto;padding:16px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.documentation__docsText::-webkit-scrollbar{height:16px;width:16px}.documentation__docsText::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.documentation__docsText::-webkit-scrollbar-corner,.documentation__docsText::-webkit-scrollbar-track{background-color:#0000}.documentation__docsText:focus{outline:none}.documentation__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsTextGroup,.documentation__docsTextItem{margin-top:40px}.documentation__docsTextGroup{border-top:1px solid #343741;padding-top:40px}.documentationOverflow{z-index:9001}',""]),e.exports=t},function(e,t,a){var n=a(67),i=a(368);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.documentation__docs{background:#fff}.documentation__docsHeader{margin:0}.documentation__docs--inline{display:flex;flex-direction:column;z-index:1}.documentation__docs--overlay .documentation__docsContent{height:40vh;width:min(75vh,90vw)}.documentation__docs--inline .documentation__docsContent{flex:1;min-height:0}.documentation__docsContent>*+*{border-left:1px solid #d3dae6}.documentation__docsSidebar{background:#f5f7fa}.documentation__docsSidebarInner{min-height:0}.documentation__docsSidebarInner>*+*{border-top:1px solid #d3dae6}.documentation__docsSearch{padding:16px}.documentation__docsNav{height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.documentation__docsNav::-webkit-scrollbar{height:16px;width:16px}.documentation__docsNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.documentation__docsNav::-webkit-scrollbar-corner,.documentation__docsNav::-webkit-scrollbar-track{background-color:#0000}.documentation__docsNav:focus{outline:none}.documentation__docsNav[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsNavGroup{padding:16px}.documentation__docsNavGroup+.documentation__docsNavGroup{border-top:1px solid #d3dae6}.documentation__docsNavGroupLink{font-weight:inherit}.documentation__docsText{height:100%;overflow-x:hidden;overflow-y:auto;padding:16px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.documentation__docsText::-webkit-scrollbar{height:16px;width:16px}.documentation__docsText::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.documentation__docsText::-webkit-scrollbar-corner,.documentation__docsText::-webkit-scrollbar-track{background-color:#0000}.documentation__docsText:focus{outline:none}.documentation__docsText[tabindex="0"]:focus:focus-visible{outline-style:auto}.documentation__docsTextGroup,.documentation__docsTextItem{margin-top:40px}.documentation__docsTextGroup{border-top:1px solid #d3dae6;padding-top:40px}.documentationOverflow{z-index:9001}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(370);case"v8light":return a(372)}},function(e,t,a){var n=a(67),i=a(371);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #343741}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #343741}.lnsFormula__editorFooter,.lnsFormula__editorHeader{padding:8px}.lnsFormula__editorFooter{background-color:#25262e;border-bottom-left-radius:6px;border-bottom-right-radius:6px;z-index:1}.lnsFormula__editorFooterGroup,.lnsFormula__editorHeaderGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{color:#7a7f89;font-family:Menlo,Monaco,Courier New,monospace;left:16px;pointer-events:none;position:absolute;right:0;top:0}.lnsFormula__warningText+.lnsFormula__warningText{border-top:1px solid #343741;margin-top:8px;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#1d1e24}.lnsFormulaOverflow{z-index:9001}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(373);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsFormula{display:flex;flex-direction:column}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula{height:100%}.lnsFormula>*{flex:1;min-height:0}.lnsFormula>*+*{border-top:1px solid #d3dae6}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editor{border-bottom:none;display:flex;flex-direction:column}.lnsFormula__editor>*+*{border-top:1px solid #d3dae6}.lnsFormula__editorFooter,.lnsFormula__editorHeader{padding:8px}.lnsFormula__editorFooter{background-color:#f5f7fa;border-bottom-left-radius:6px;border-bottom-right-radius:6px;z-index:1}.lnsFormula__editorFooterGroup,.lnsFormula__editorHeaderGroup{display:block}.lnsFormula__editorContent{min-height:0;position:relative}.lnsIndexPatternDimensionEditor:not(.lnsIndexPatternDimensionEditor-isFullscreen) .lnsFormula__editorContent{height:200px}.lnsIndexPatternDimensionEditor-isFullscreen .lnsFormula__editorContent{flex:1}.lnsFormula__editorPlaceholder{color:#69707d;font-family:Menlo,Monaco,Courier New,monospace;left:16px;pointer-events:none;position:absolute;right:0;top:0}.lnsFormula__warningText+.lnsFormula__warningText{border-top:1px solid #d3dae6;margin-top:8px;padding-top:8px}.lnsFormula__editorHelp--inline{align-items:center;display:flex;padding:4px}.lnsFormula__editorHelp--inline>*+*{margin-left:4px}.lnsFormula__editorError{white-space:nowrap}.lnsFormula__docs{background:#fff}.lnsFormulaOverflow{z-index:9001}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(38),i=a(7),s=n.__importDefault(a(375));t.default=function(e){var t=i.useRef(e);t.current=e,s.default((function(){return function(){return t.current()}}))}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(7);t.default=function(e){n.useEffect(e,[])}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(377);case"v8light":return a(379)}},function(e,t,a){var n=a(67),i=a(378);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#343741}.lnFieldSelect__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(380);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnFieldSelect__option--incompatible{color:#d3dae6}.lnFieldSelect__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(382);case"v8light":return a(384)}},function(e,t,a){var n=a(67),i=a(383);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnFieldPicker__option--incompatible{color:#343741}.lnFieldPicker__option--nonExistant{background-color:#25262e}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(385);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnFieldPicker__option--incompatible{color:#d3dae6}.lnFieldPicker__option--nonExistant{background-color:#f5f7fa}",""]),e.exports=t},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(7),i=a.n(n),s=a(2);const l=()=>Object(s.jsx)(n.Fragment,null),r=i.a.lazy((()=>a.e(12).then(a.bind(null,514)))),o=function(e){return Object(s.jsx)(i.a.Suspense,{fallback:Object(s.jsx)(l,null)},Object(s.jsx)(r,e))}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(388);case"v8light":return a(390)}},function(e,t,a){var n=a(67),i=a(389);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(391);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsFiltersOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(393);case"v8light":return a(395)}},function(e,t,a){var n=a(67),i=a(394);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(396);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__filtersEditor{width:960px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(398);case"v8light":return a(400)}},function(e,t,a){var n=a(67),i=a(399);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__labelCustomRank{min-width:96px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(401);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsIndexPatternDimensionEditor__labelCustomRank{min-width:96px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(403);case"v8light":return a(405)}},function(e,t,a){var n=a(67),i=a(404);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsRangesOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(406);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsRangesOperation__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.lnsRangesOperation__popoverNumberField{width:14ch}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(408);case"v8light":return a(410)}},function(e,t,a){var n=a(67),i=a(409);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.lnsHelpPopover__panel{max-inline-size:480px!important}.lnsHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:12px;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.lnsHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,a){var n=a(67),i=a(411);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.lnsHelpPopover__panel{max-inline-size:480px!important}.lnsHelpPopover__content{height:100%;-webkit-mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);mask-image:linear-gradient(180deg,#ff00001a 0,red 7.5px,red calc(100% - 7.5px),#ff00001a);max-height:40vh;overflow-x:hidden;overflow-y:auto;padding:12px;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.lnsHelpPopover__content::-webkit-scrollbar{height:16px;width:16px}.lnsHelpPopover__content::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsHelpPopover__content::-webkit-scrollbar-corner,.lnsHelpPopover__content::-webkit-scrollbar-track{background-color:#0000}.lnsHelpPopover__content:focus{outline:none}.lnsHelpPopover__content[tabindex="0"]:focus:focus-visible{outline-style:auto}.lnsHelpPopover__buttonIcon{margin-right:4px}',""]),e.exports=t},function(e,t,a){var n=a(413),i=a(414),s=a(415),l=a(416),r=a(417),o=a(418),u=a(419);u.alea=n,u.xor128=i,u.xorwow=s,u.xorshift7=l,u.xor4096=r,u.tychei=o,e.exports=u},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t,a=this,n=(t=4022871197,function(e){e=String(e);for(var a=0;a<e.length;a++){var n=.02519603282416938*(t+=e.charCodeAt(a));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)});a.next=function(){var e=2091639*a.s0+2.3283064365386963e-10*a.c;return a.s0=a.s1,a.s1=a.s2,a.s2=e-(a.c=0|e)},a.c=1,a.s0=n(" "),a.s1=n(" "),a.s2=n(" "),a.s0-=n(e),a.s0<0&&(a.s0+=1),a.s1-=n(e),a.s1<0&&(a.s1+=1),a.s2-=n(e),a.s2<0&&(a.s2+=1),n=null}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var a=new l(e),n=t&&t.state,i=a.next;return i.int32=function(){return 4294967296*a.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(77)&&a(97)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.alea=o}(0,e,a(77))}).call(this,a(96)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:a+=e;for(var n=0;n<a.length+64;n++)t.x^=0|a.charCodeAt(n),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(77)&&a(97)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xor128=o}(0,e,a(77))}).call(this,a(96)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:a+=e;for(var n=0;n<a.length+64;n++)t.x^=0|a.charCodeAt(n),n==a.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(77)&&a(97)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xorwow=o}(0,e,a(77))}).call(this,a(96)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this;t.next=function(){var e,a,n=t.x,i=t.i;return e=n[i],a=(e^=e>>>7)^e<<24,a^=(e=n[i+1&7])^e>>>10,a^=(e=n[i+3&7])^e>>>3,a^=(e=n[i+4&7])^e<<7,e=n[i+7&7],a^=(e^=e<<13)^e<<9,n[i]=a,t.i=i+1&7,a},function(e,t){var a,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,a=0;a<t.length;++a)n[7&a]=n[7&a]<<15^t.charCodeAt(a)+n[a+1&7]<<13;for(;n.length<8;)n.push(0);for(a=0;a<8&&0===n[a];++a);for(8==a?n[7]=-1:n[a],e.x=n,e.i=0,a=256;a>0;--a)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&(n.x&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(77)&&a(97)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xorshift7=o}(0,e,a(77))}).call(this,a(96)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this;t.next=function(){var e,a,n=t.w,i=t.X,s=t.i;return t.w=n=n+1640531527|0,a=i[s+34&127],e=i[s=s+1&127],a^=a<<13,e^=e<<17,a^=a>>>15,e^=e>>>12,a=i[s]=a^e,t.i=s,a+(n^n>>>16)|0},function(e,t){var a,n,i,s,l,r=[],o=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,o=Math.max(o,t.length)),i=0,s=-32;s<o;++s)t&&(n^=t.charCodeAt((s+32)%t.length)),0===s&&(l=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,s>=0&&(l=l+1640531527|0,i=0==(a=r[127&s]^=n+l)?i+1:0);for(i>=128&&(r[127&(t&&t.length||0)]=-1),i=127,s=512;s>0;--s)n=r[i+34&127],a=r[i=i+1&127],n^=n<<13,a^=a<<17,n^=n>>>15,a^=a>>>12,r[i]=n^a;e.w=l,e.X=r,e.i=i}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&(n.X&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(77)&&a(97)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.xor4096=o}(0,e,a(77))}).call(this,a(96)(e))},function(e,t,a){(function(e){var n;!function(e,i,s){function l(e){var t=this,a="";t.next=function(){var e=t.b,a=t.c,n=t.d,i=t.a;return e=e<<25^e>>>7^a,a=a-n|0,n=n<<24^n>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^a,t.c=a=a-n|0,t.d=n<<16^a>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):a+=e;for(var n=0;n<a.length+20;n++)t.b^=0|a.charCodeAt(n),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var a=new l(e),n=t&&t.state,i=function(){return(a.next()>>>0)/4294967296};return i.double=function(){do{var e=((a.next()>>>11)+(a.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=a.next,i.quick=i,n&&("object"==typeof n&&r(n,a),i.state=function(){return r(a,{})}),i}i&&i.exports?i.exports=o:a(77)&&a(97)?void 0===(n=function(){return o}.call(t,a,t,i))||(i.exports=n):this.tychei=o}(0,e,a(77))}).call(this,a(96)(e))},function(e,t,a){var n;!function(i,s,l){var r,o=256,u=6,c="random",d=l.pow(o,u),p=l.pow(2,52),m=2*p,g=o-1;function f(e,t,a){var n=[],g=x(h((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(s)]:null==e?function(){try{var e;return r&&(e=r.randomBytes)?e=e(o):(e=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(e)),y(e)}catch(e){var t=i.navigator,a=t&&t.plugins;return[+new Date,i,a,i.screen,y(s)]}}():e,3),n),f=new b(n),j=function(){for(var e=f.g(u),t=d,a=0;e<p;)e=(e+a)*o,t*=o,a=f.g(1);for(;e>=m;)e/=2,t/=2,a>>>=1;return(e+a)/t};return j.int32=function(){return 0|f.g(4)},j.quick=function(){return f.g(4)/4294967296},j.double=j,x(y(f.S),s),(t.pass||a||function(e,t,a,n){return n&&(n.S&&v(n,f),e.state=function(){return v(f,{})}),a?(l[c]=e,t):e})(j,g,"global"in t?t.global:this==l,t.state)}function b(e){var t,a=e.length,n=this,i=0,s=n.i=n.j=0,l=n.S=[];for(a||(e=[a++]);i<o;)l[i]=i++;for(i=0;i<o;i++)l[i]=l[s=g&s+e[i%a]+(t=l[i])],l[s]=t;(n.g=function(e){for(var t,a=0,i=n.i,s=n.j,l=n.S;e--;)t=l[i=g&i+1],a=a*o+l[g&(l[i]=l[s=g&s+t])+(l[s]=t)];return n.i=i,n.j=s,a})(o)}function v(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function h(e,t){var a,n=[],i=typeof e;if(t&&"object"==i)for(a in e)try{n.push(h(e[a],t-1))}catch(e){}return n.length?n:"string"==i?e:e+"\0"}function x(e,t){for(var a,n=e+"",i=0;i<n.length;)t[g&i]=g&(a^=19*t[g&i])+n.charCodeAt(i++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(x(l.random(),s),e.exports){e.exports=f;try{r=a(420)}catch(e){}}else void 0===(n=function(){return f}.call(t,a,t,e))||(e.exports=n)}("undefined"!=typeof self?self:this,[],Math)},function(e,t){},function(e,t,a){var n=a(67),i=a(422);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{background:#1d1e24;padding:0 16px;position:sticky;top:0;z-index:1000}.lnsIndexPatternDimensionEditor-isFullscreen{bottom:0;left:0;position:absolute;right:0;top:0}.lnsIndexPatternDimensionEditor--padded{padding:16px}.lnsIndexPatternDimensionEditor--collapseNext{border-top:1px solid #343741;margin-bottom:-24px;margin-top:0!important}.lnsIndexPatternDimensionEditor--shaded{background-color:#25262e;border-bottom:1px solid #343741}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px;display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{min-block-size:24px;padding-bottom:0;padding-top:0}.lnsIndexPatternDimensionEditor__warning{margin-bottom:16px;margin-top:8px}.lnsIndexPatternDimensionEditor__droppable{border-radius:6px;padding:4px}.lnsIndexPatternDimensionEditor__droppableItem{margin-right:8px}.lnsIndexPatternDimensionEditor-advancedOptions button:focus,.lnsIndexPatternDimensionEditor-advancedOptions button:hover{-webkit-text-decoration-color:#36a2ef;text-decoration-color:#36a2ef}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(424);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsIndexPatternDimensionEditor{height:100%}.lnsIndexPatternDimensionEditor__header{background:#fff;padding:0 16px;position:sticky;top:0;z-index:1000}.lnsIndexPatternDimensionEditor-isFullscreen{bottom:0;left:0;position:absolute;right:0;top:0}.lnsIndexPatternDimensionEditor--padded{padding:16px}.lnsIndexPatternDimensionEditor--collapseNext{border-top:1px solid #d3dae6;margin-bottom:-24px;margin-top:0!important}.lnsIndexPatternDimensionEditor--shaded{background-color:#f5f7fa;border-bottom:1px solid #d3dae6}.lnsIndexPatternDimensionEditor__columns{column-count:2;column-gap:12px;display:block}.lnsIndexPatternDimensionEditor__operation .euiListGroupItem__label{width:100%}.lnsIndexPatternDimensionEditor__operation>button{min-block-size:24px;padding-bottom:0;padding-top:0}.lnsIndexPatternDimensionEditor__warning{margin-bottom:16px;margin-top:8px}.lnsIndexPatternDimensionEditor__droppable{border-radius:6px;padding:4px}.lnsIndexPatternDimensionEditor__droppableItem{margin-right:8px}.lnsIndexPatternDimensionEditor-advancedOptions button:focus,.lnsIndexPatternDimensionEditor-advancedOptions button:hover{-webkit-text-decoration-color:#07c;text-decoration-color:#07c}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(426);case"v8light":return a(428)}},function(e,t,a){var n=a(67),i=a(427);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".filterQueryInput__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.filterQueryInput__popover{width:960px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(429);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".filterQueryInput__popoverButton{font-size:14px;font-size:1rem;line-height:1.71429rem;min-height:32px;overflow-wrap:break-word!important;width:100%;word-break:break-word}.filterQueryInput__popover{width:960px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(431);case"v8light":return a(433)}},function(e,t,a){var n=a(67),i=a(432);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{height:100%;padding:16px 16px 0;width:100%}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{align-items:center;display:flex;margin-bottom:8px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{display:inline;font-weight:600;padding-left:8px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(434);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsInnerIndexPatternDataPanel{height:100%;padding:16px 16px 0;width:100%}.lnsInnerIndexPatternDataPanel__switcher{min-width:0}.lnsInnerIndexPatternDataPanel__header{align-items:center;display:flex;margin-bottom:8px}.lnsChangeIndexPatternPopover__trigger{padding:0 16px}.lnsLayerPanelChartSwitch_title{display:inline;font-weight:600;padding-left:8px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(436);case"v8light":return a(438)}},function(e,t,a){var n=a(67),i=a(437);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsFieldItem__fieldPanel{max-width:300px;min-width:260px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(439);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsFieldItem__fieldPanel{max-width:300px;min-width:260px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(441);case"v8light":return a(443)}},function(e,t,a){var n=a(67),i=a(442);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".unifiedFieldList__fieldPopover__fieldPopoverPanel{max-width:400px!important;min-width:260px!important}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(444);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".unifiedFieldList__fieldPopover__fieldPopoverPanel{max-width:400px!important;min-width:260px!important}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(446);case"v8light":return a(448)}},function(e,t,a){var n=a(67),i=a(447);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".kbnFieldButton{align-items:flex-start;border-radius:6px;display:flex;font-size:14px;font-size:1rem;line-height:1.71429rem;margin-bottom:4px;padding:0 8px;transition:box-shadow .15s cubic-bezier(.694,.0482,.335,1),background-color .15s cubic-bezier(.694,.0482,.335,1)}.kbnFieldButton-isActive,.kbnFieldButton:focus-within{outline:2px solid currentColor}.kbnFieldButton-isActive:focus-visible,.kbnFieldButton:focus-within:focus-visible{outline-style:auto}.kbnFieldButton-isActive:not(:focus-visible),.kbnFieldButton:focus-within:not(:focus-visible){outline:none}.kbnFieldButton__button{align-items:flex-start;display:flex;flex-grow:1;line-height:normal;padding:8px 0;text-align:left}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0}.kbnFieldButton__name{flex-grow:1;padding:0 8px}.kbnFieldButton__infoIcon{align-items:center;display:flex;flex-shrink:0;justify-content:center;line-height:0;min-height:16px}.kbnFieldButton__fieldAction{margin-left:8px}.kbnFieldButton__dragHandle{margin-right:8px}.kbnFieldButton__dragHandle,.kbnFieldButton__fieldAction{line-height:32px}.kbnFieldButton--xs{font-size:12px}.kbnFieldButton--xs .kbnFieldButton__button{padding:4px 0}.kbnFieldButton--xs .kbnFieldButton__fieldAction{margin-left:4px}.kbnFieldButton--xs .kbnFieldButton__dragHandle,.kbnFieldButton--xs .kbnFieldButton__fieldAction{line-height:24px}.kbnFieldButton--flushBoth{padding-left:0;padding-right:0}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(449);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".kbnFieldButton{align-items:flex-start;border-radius:6px;display:flex;font-size:14px;font-size:1rem;line-height:1.71429rem;margin-bottom:4px;padding:0 8px;transition:box-shadow .15s cubic-bezier(.694,.0482,.335,1),background-color .15s cubic-bezier(.694,.0482,.335,1)}.kbnFieldButton-isActive,.kbnFieldButton:focus-within{outline:2px solid currentColor}.kbnFieldButton-isActive:focus-visible,.kbnFieldButton:focus-within:focus-visible{outline-style:auto}.kbnFieldButton-isActive:not(:focus-visible),.kbnFieldButton:focus-within:not(:focus-visible){outline:none}.kbnFieldButton__button{align-items:flex-start;display:flex;flex-grow:1;line-height:normal;padding:8px 0;text-align:left}.kbnFieldButton__fieldIcon{flex-shrink:0;line-height:0}.kbnFieldButton__name{flex-grow:1;padding:0 8px}.kbnFieldButton__infoIcon{align-items:center;display:flex;flex-shrink:0;justify-content:center;line-height:0;min-height:16px}.kbnFieldButton__fieldAction{margin-left:8px}.kbnFieldButton__dragHandle{margin-right:8px}.kbnFieldButton__dragHandle,.kbnFieldButton__fieldAction{line-height:32px}.kbnFieldButton--xs{font-size:12px}.kbnFieldButton--xs .kbnFieldButton__button{padding:4px 0}.kbnFieldButton--xs .kbnFieldButton__fieldAction{margin-left:4px}.kbnFieldButton--xs .kbnFieldButton__dragHandle,.kbnFieldButton--xs .kbnFieldButton__fieldAction{line-height:24px}.kbnFieldButton--flushBoth{padding-left:0;padding-right:0}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(451);case"v8light":return a(453)}},function(e,t,a){var n=a(67),i=a(452);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".unifiedFieldListItemButton__action{opacity:0}.unifiedFieldListItemButton__action--always,.unifiedFieldListItemButton__action:focus{opacity:1}.unifiedFieldListItemButton{width:100%}.unifiedFieldListItemButton.kbnFieldButton-isActive,.unifiedFieldListItemButton.kbnFieldButton:focus-within{outline:none}.unifiedFieldListItemButton.kbnFieldButton-isActive:focus-visible,.unifiedFieldListItemButton.kbnFieldButton:focus-within:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus{outline:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus .kbnFieldButton__nameInner{outline:2px solid currentColor}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__nameInner{outline-style:auto}.unifiedFieldListItemButton .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__nameInner{outline:none}.unifiedFieldListItemButton button .kbnFieldButton__nameInner:hover{text-decoration:underline}.unifiedFieldListItemButton:hover .unifiedFieldListItemButton__action,.unifiedFieldListItemButton[class*=-isActive] .unifiedFieldListItemButton__action{opacity:1}.unifiedFieldListItemButton--missing{background:#1d1e24;color:#98a2b3}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(454);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".unifiedFieldListItemButton__action{opacity:0}.unifiedFieldListItemButton__action--always,.unifiedFieldListItemButton__action:focus{opacity:1}.unifiedFieldListItemButton{width:100%}.unifiedFieldListItemButton.kbnFieldButton-isActive,.unifiedFieldListItemButton.kbnFieldButton:focus-within{outline:none}.unifiedFieldListItemButton.kbnFieldButton-isActive:focus-visible,.unifiedFieldListItemButton.kbnFieldButton:focus-within:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus{outline:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible{outline-style:none}.unifiedFieldListItemButton .kbnFieldButton__button:focus .kbnFieldButton__nameInner{outline:2px solid currentColor}.unifiedFieldListItemButton .kbnFieldButton__button:focus:focus-visible .kbnFieldButton__nameInner{outline-style:auto}.unifiedFieldListItemButton .kbnFieldButton__button:focus:not(:focus-visible) .kbnFieldButton__nameInner{outline:none}.unifiedFieldListItemButton button .kbnFieldButton__nameInner:hover{text-decoration:underline}.unifiedFieldListItemButton:hover .unifiedFieldListItemButton__action,.unifiedFieldListItemButton[class*=-isActive] .unifiedFieldListItemButton__action{opacity:1}.unifiedFieldListItemButton--missing{background:#98a2b31a;color:#69707d}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(456);case"v8light":return a(458)}},function(e,t,a){var n=a(67),i=a(457);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{border:1px solid #343741;border-radius:6px;padding:40px 64px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(459);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsVisualizeGeoFieldWorkspacePanel__dragDrop{border:1px solid #d3dae6;border-radius:6px;padding:40px 64px}",""]),e.exports=t},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(7);t.default=function(e){var t=n.useRef();return n.useEffect((function(){t.current=e})),t.current}},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(462);case"v8light":return a(464)}},function(e,t,a){var n=a(67),i=a(463);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.lnsEmbeddablePanelFeatureList{height:100%;max-height:320px;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar{height:16px;width:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-corner,.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-track{background-color:#0000}.lnsEmbeddablePanelFeatureList:focus{outline:none}.lnsEmbeddablePanelFeatureList[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},function(e,t,a){var n=a(67),i=a(465);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.lnsEmbeddablePanelFeatureList{height:100%;max-height:320px;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar{height:16px;width:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-corner,.lnsEmbeddablePanelFeatureList::-webkit-scrollbar-track{background-color:#0000}.lnsEmbeddablePanelFeatureList:focus{outline:none}.lnsEmbeddablePanelFeatureList[tabindex="0"]:focus:focus-visible{outline-style:auto}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(467);case"v8light":return a(469)}},function(e,t,a){var n=a(67),i=a(468);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.kbnSolutionNav__flyout{background-color:#141519}.kbnSolutionNav{background:linear-gradient(160deg,#3437414d,#3437414d 32px,#f000 0),linear-gradient(175deg,#3437414d,#3437414d 16px,#f000 0);display:flex;flex-direction:column;height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#98a2b380 #0000;scrollbar-width:thin}.kbnSolutionNav::-webkit-scrollbar{height:16px;width:16px}.kbnSolutionNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#98a2b380;border:6px solid #0000;border-radius:16px}.kbnSolutionNav::-webkit-scrollbar-corner,.kbnSolutionNav::-webkit-scrollbar-track{background-color:#0000}.kbnSolutionNav:focus{outline:none}.kbnSolutionNav[tabindex="0"]:focus:focus-visible{outline-style:auto}@media only screen and (min-width:768px) and (max-width:991px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:992px) and (max-width:1199px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:1200px){.kbnSolutionNav{padding:24px;width:248px}}.kbnSolutionNav__title{align-items:center;display:inline-flex}.kbnSolutionNav__titleAvatar{align-self:flex-start;margin-right:12px}.kbnSolutionNav--hidden{opacity:0;pointer-events:none}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNav--hidden{transition:opacity .15s cubic-bezier(.694,.0482,.335,1)}}',""]),e.exports=t},function(e,t,a){var n=a(67),i=a(470);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.kbnSolutionNav__flyout{background-color:#fafbfd}.kbnSolutionNav{background:linear-gradient(160deg,#d3dae64d,#d3dae64d 32px,#f000 0),linear-gradient(175deg,#d3dae64d,#d3dae64d 16px,#f000 0);display:flex;flex-direction:column;height:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#69707d80 #0000;scrollbar-width:thin}.kbnSolutionNav::-webkit-scrollbar{height:16px;width:16px}.kbnSolutionNav::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#69707d80;border:6px solid #0000;border-radius:16px}.kbnSolutionNav::-webkit-scrollbar-corner,.kbnSolutionNav::-webkit-scrollbar-track{background-color:#0000}.kbnSolutionNav:focus{outline:none}.kbnSolutionNav[tabindex="0"]:focus:focus-visible{outline-style:auto}@media only screen and (min-width:768px) and (max-width:991px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:992px) and (max-width:1199px){.kbnSolutionNav{padding:24px;width:248px}}@media only screen and (min-width:1200px){.kbnSolutionNav{padding:24px;width:248px}}.kbnSolutionNav__title{align-items:center;display:inline-flex}.kbnSolutionNav__titleAvatar{align-self:flex-start;margin-right:12px}.kbnSolutionNav--hidden{opacity:0;pointer-events:none}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNav--hidden{transition:opacity .15s cubic-bezier(.694,.0482,.335,1)}}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(472);case"v8light":return a(474)}},function(e,t,a){var n=a(67),i=a(473);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){var n=a(68),i=a(176),s=a(177);t=n(!1);var l=i(s);t.push([e.i,".kbnSolutionAvatar{box-shadow:0 .7px 1.4px rgba(0,0,0,.175),0 1.9px 4px rgba(0,0,0,.125),0 4.5px 10px rgba(0,0,0,.125)}.kbnSolutionAvatar--xxl{background:#1d1e24 url("+l+") no-repeat;background-size:cover,125%;border-radius:100px;box-shadow:0 .9px 4px -1px #0003,0 2.6px 8px -1px #00000026,0 5.7px 12px -1px rgba(0,0,0,.125),0 15px 15px -1px #0000001a;display:inline-block;height:100px;line-height:100px;text-align:center;width:100px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(475);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){var n=a(68),i=a(176),s=a(177);t=n(!1);var l=i(s);t.push([e.i,".kbnSolutionAvatar{box-shadow:0 .7px 1.4px #00000012,0 1.9px 4px #0000000d,0 4.5px 10px #0000000d}.kbnSolutionAvatar--xxl{background:#fff url("+l+") no-repeat;background-size:cover,125%;border-radius:100px;box-shadow:0 .9px 4px -1px #00000014,0 2.6px 8px -1px #0000000f,0 5.7px 12px -1px #0000000d,0 15px 15px -1px #0000000a;display:inline-block;height:100px;line-height:100px;text-align:center;width:100px}",""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(477);case"v8light":return a(479)}},function(e,t,a){var n=a(67),i=a(478);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".kbnSolutionNavCollapseButton{left:232px;opacity:0;position:absolute;top:24px;z-index:2}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNavCollapseButton{transition:opacity .15s,left .15s,background .15s}}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover{transition-delay:0s!important}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover,.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{left:224px;opacity:1}.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{transition-delay:.7s}.kbnSolutionNavCollapseButton:not(.kbnSolutionNavCollapseButton-isCollapsed){background-color:#1d1e24!important}.kbnSolutionNavCollapseButton-isCollapsed{align-items:flex-start;border-radius:0;bottom:0;height:100%;left:0!important;opacity:1!important;padding-top:32px;right:auto;top:0;transition-delay:0s!important;width:40px}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(480);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".kbnSolutionNavCollapseButton{left:232px;opacity:0;position:absolute;top:24px;z-index:2}@media screen and (prefers-reduced-motion:no-preference){.kbnSolutionNavCollapseButton{transition:opacity .15s,left .15s,background .15s}}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover{transition-delay:0s!important}.kbnSolutionNavCollapseButton:focus,.kbnSolutionNavCollapseButton:hover,.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{left:224px;opacity:1}.kbnSolutionNav__sidebar:hover .kbnSolutionNavCollapseButton{transition-delay:.7s}.kbnSolutionNavCollapseButton:not(.kbnSolutionNavCollapseButton-isCollapsed){background-color:#fff!important}.kbnSolutionNavCollapseButton-isCollapsed{align-items:flex-start;border-radius:0;bottom:0;height:100%;left:0!important;opacity:1!important;padding-top:32px;right:auto;top:0;transition-delay:0s!important;width:40px}",""]),e.exports=t},function(e,t,a){e.exports=a.p+"baad30acfe492601d08a0e839c9bb3f5.svg"},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(483);case"v8light":return a(485)}},function(e,t,a){var n=a(67),i=a(484);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;height:100%;overflow:hidden}.lnsApp,.lnsApp__frame{display:flex;flex-direction:column}.lnsApp__frame{flex-grow:1;position:relative}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__withDivider:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__withDivider:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider:after{border-right:1px solid #343741;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}',""]),e.exports=t},function(e,t,a){var n=a(67),i=a(486);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,'.lnsAppWrapper{display:flex;flex-direction:column;flex-grow:1}.lnsApp{flex:1 1 auto;height:100%;overflow:hidden}.lnsApp,.lnsApp__frame{display:flex;flex-direction:column}.lnsApp__frame{flex-grow:1;position:relative}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider{margin-right:12px;position:relative}}@media only screen and (min-width:768px) and (max-width:991px){.lnsNavItem__withDivider:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:992px) and (max-width:1199px){.lnsNavItem__withDivider:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}@media only screen and (min-width:1200px){.lnsNavItem__withDivider:after{border-right:1px solid #d3dae6;bottom:0;content:"";display:block;pointer-events:none;position:absolute;right:-8px;top:0}}',""]),e.exports=t},function(e,t,a){switch(window.__kbnThemeTag__){case"v8dark":return a(488);case"v8light":return a(490)}},function(e,t,a){var n=a(67),i=a(489);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsConfigPanel__overlay{background:#25262e;-webkit-clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%);clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%)}.lnsConfigPanel__overlay .kbnOverlayMountWrapper{margin-left:-400px;padding-left:400px;pointer-events:none}.lnsConfigPanel__overlay .kbnOverlayMountWrapper .euiFlyoutFooter{pointer-events:auto}",""]),e.exports=t},function(e,t,a){var n=a(67),i=a(491);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);n(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},function(e,t,a){(t=a(68)(!1)).push([e.i,".lnsConfigPanel__overlay{background:#f5f7fa;-webkit-clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%);clip-path:polygon(-100% 0,100% 0,100% 100%,-100% 100%)}.lnsConfigPanel__overlay .kbnOverlayMountWrapper{margin-left:-400px;padding-left:400px;pointer-events:none}.lnsConfigPanel__overlay .kbnOverlayMountWrapper .euiFlyoutFooter{pointer-events:auto}",""]),e.exports=t},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(110);function i(e,t){var a;const i=t?t(e):function(e){var t;return e.timeSeriesMetric||(null!==(t=e.type)&&void 0!==t?t:"string")}(e),s=(null===(a=e.esTypes)||void 0===a?void 0:a[0])||null;return s&&["_id","_index"].includes(s)&&"string"===i?"keyword":"unknown"===i&&s&&Object(n.c)(s)||"string"===i&&s?s:i}},,,,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return o})),a(7);var n=a(4),i=a(0),s=a(2);const l=e=>{var t;return e.value?Object(s.jsx)(n.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(s.jsx)(n.EuiFlexItem,{grow:!1},Object(s.jsx)(n.EuiIcon,{type:null!==(t=e.icon)&&void 0!==t?t:e.value})),Object(s.jsx)(n.EuiFlexItem,null,e.label)):null};function r({value:e,onChange:t,customIconSet:a,defaultIcon:i="empty"}){var r;const o=a.find((t=>e===t.value))||a.find((e=>e.value===i));return Object(s.jsx)(n.EuiComboBox,{fullWidth:!0,"data-test-subj":"lns-icon-select",isClearable:!1,options:a,selectedOptions:[{label:o.label,value:o.value}],onChange:e=>{t(e[0].value)},singleSelection:{asPlainText:!0},renderOption:l,compressed:!0,prepend:(u=o.value,null!=u&&"empty"!==u?Object(s.jsx)(n.EuiIcon,{type:null!==(r=o.icon)&&void 0!==r?r:o.value}):void 0)});var u}function o({currentIcon:e,setIcon:t,customIconSet:a,defaultIcon:l="empty"}){return Object(s.jsx)(n.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:i.i18n.translate("visualizationUiComponents.iconSelect.label",{defaultMessage:"Icon decoration"})},Object(s.jsx)(r,{defaultIcon:l,customIconSet:a,value:e,onChange:t}))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(7),i=a.n(n),s=a(0),l=a(4),r=a(146),o=a(122),u=a(2);const c={auto:s.i18n.translate("visualizationUiComponents.colorPicker.tooltip.auto",{defaultMessage:"Lens automatically picks colors for you unless you specify a custom color."}),custom:s.i18n.translate("visualizationUiComponents.colorPicker.tooltip.custom",{defaultMessage:"Clear the custom color to return to “Auto” mode."})},d=({overwriteColor:e,defaultColor:t,isClearable:a,setConfig:d,label:p,disableHelpTooltip:m,disabledMessage:g,showAlpha:f})=>{const[b,v]=Object(n.useState)(e||t),[h,x]=Object(n.useState)(e||t),[y,j]=Object(n.useState)(Object(r.b)(b)),O=Object(n.useRef)(!1),I=Boolean(g);Object(n.useEffect)((()=>{O.current||e&&h&&e.toUpperCase()!==h.toUpperCase()&&(v(e),x(e.toUpperCase()),j(Object(r.b)(e))),O.current=!1}),[h,e,t]);const k=null!=p?p:s.i18n.translate("visualizationUiComponents.colorPicker.seriesColor.label",{defaultMessage:"Series color"}),T=Object(u.jsx)(l.EuiColorPicker,{fullWidth:!0,"data-test-subj":"indexPattern-dimension-colorPicker",compressed:!0,isClearable:void 0!==a?a:Boolean(e),onChange:(e,t)=>{v(e),O.current=!0,t.isValid&&(x(t.hex.toUpperCase()),j(Object(r.b)(t.hex)),d({color:t.hex})),""===e&&d({color:void 0})},color:I?"":b,disabled:I,placeholder:" ",onBlur:()=>{b||v(null!=h?h:t)},"aria-label":k,showAlpha:f,swatches:1===y?Object(l.euiPaletteColorBlind)():Object(l.euiPaletteColorBlind)().map((e=>Object(r.d)(e,y).hex()))});return Object(u.jsx)(l.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(u.jsx)(o.a,{delay:"long",position:"top",tooltipContent:b&&!I?c.custom:c.auto,condition:!m},Object(u.jsx)("span",null,k,!m&&Object(u.jsx)(i.a.Fragment,null,Object(u.jsx)(l.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))))},I?Object(u.jsx)(l.EuiToolTip,{position:"top",content:g,delay:"long",anchorClassName:"eui-displayBlock"},T):T)}},,,function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return s}));var n=a(23);const i=(e,t)=>{let a,i=!0;try{e&&("kuery"===e.language?Object(n.toElasticsearchQuery)(Object(n.fromKueryExpression)(e.query),t):Object(n.luceneStringToDsl)(e.query))}catch(e){i=!1,a=e.message}return{isValid:i,error:a}},s=(e,t)=>i(e,t).isValid},function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(4),i=a(0),s=a(7),l=a(2);function r({idPrefix:e,currentConfig:t,setConfig:a,isQueryBased:r,children:o}){const[u,c]=Object(s.useState)(function({textField:e,textVisibility:t}={},a){return t?a&&e?"field":"name":"none"}(t,r)),d=[{id:`${e}none`,label:i.i18n.translate("visualizationUiComponents.xyChart.lineMarker.textVisibility.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_textVisibility_none"},{id:`${e}name`,label:i.i18n.translate("visualizationUiComponents.xyChart.lineMarker.textVisibility.name",{defaultMessage:"Name"}),"data-test-subj":"lnsXY_textVisibility_name"}];return r&&d.push({id:`${e}field`,label:i.i18n.translate("visualizationUiComponents.xyChart.lineMarker.textVisibility.field",{defaultMessage:"Field"}),"data-test-subj":"lnsXY_textVisibility_field"}),Object(l.jsx)(n.EuiFormRow,{label:i.i18n.translate("visualizationUiComponents.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),display:"columnCompressed",fullWidth:!0},Object(l.jsx)("div",null,Object(l.jsx)(n.EuiButtonGroup,{legend:i.i18n.translate("visualizationUiComponents.lineMarker.textVisibility",{defaultMessage:"Text decoration"}),"data-test-subj":"lns-lineMarker-text-visibility",name:"textVisibilityStyle",buttonSize:"compressed",options:d,idSelected:u?`${e}${u}`:`${e}none`,onChange:n=>{const i=n.replace(e,"");"none"===i?a({textVisibility:!1,textField:void 0}):"name"===i?a({textVisibility:!0,textField:void 0}):"field"===i&&a({textVisibility:Boolean(null==t?void 0:t.textField)}),c(i)},isFullWidth:!0}),null==o?void 0:o(u)))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(7),i=a.n(n),s=a(0),l=a(4),r=a(2);const o=({currentConfig:e,setConfig:t,idPrefix:a})=>Object(r.jsx)(i.a.Fragment,null,Object(r.jsx)(l.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.label",{defaultMessage:"Line"})},Object(r.jsx)(l.EuiFlexGroup,{gutterSize:"s",justifyContent:"spaceBetween",responsive:!1},Object(r.jsx)(l.EuiFlexItem,null,Object(r.jsx)(p,{value:(null==e?void 0:e.lineWidth)||1,onChange:Object(n.useCallback)((e=>{t({lineWidth:e})}),[])})),Object(r.jsx)(l.EuiFlexItem,{grow:!1},Object(r.jsx)(l.EuiButtonGroup,{legend:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.label",{defaultMessage:"Line"}),"data-test-subj":"lnsXY_line_style",name:"lineStyle",buttonSize:"compressed",options:[{id:`${a}solid`,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.solid",{defaultMessage:"Solid"}),"data-test-subj":"lnsXY_line_style_solid",iconType:"lineSolid"},{id:`${a}dashed`,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.dashed",{defaultMessage:"Dashed"}),"data-test-subj":"lnsXY_line_style_dashed",iconType:"lineDashed"},{id:`${a}dotted`,label:s.i18n.translate("visualizationUiComponents.xyChart.lineStyle.dotted",{defaultMessage:"Dotted"}),"data-test-subj":"lnsXY_line_style_dotted",iconType:"lineDotted"}],idSelected:`${a}${(null==e?void 0:e.lineStyle)||"solid"}`,onChange:e=>{const n=e.replace(a,"");t({lineStyle:n})},isIconOnly:!0}))))),u=1,c=10;function d(e,t,a,n){return""===e?t:Math.max(u,Math.min(e,c))}const p=Object(n.memo)((({value:e,onChange:t})=>{const[a,i]=Object(n.useState)(String(e));return Object(r.jsx)(l.EuiFieldNumber,{"data-test-subj":"lnsXYThickness",value:a,fullWidth:!0,min:u,max:c,step:1,append:"px",compressed:!0,onChange:({currentTarget:{value:e}})=>{i(e);const a=""===e?"":Number(e),n=d(Number(e),Number(e));a===n&&t(n)},onBlur:()=>{if(a!==String(e)){const n=d(""===a?a:Number(a),e);t(n),i(String(n))}}})}))},,function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(173);function i(e){return{allowLeadingWildcards:e.get(n.a.QUERY_ALLOW_LEADING_WILDCARDS),queryStringOptions:e.get(n.a.QUERY_STRING_OPTIONS),ignoreFilterIfFieldNotInIndex:e.get(n.a.COURIER_IGNORE_FILTER_IF_FIELD_NOT_IN_INDEX),dateFormatTZ:e.get("dateFormat:tz")}}},function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(16),i=a.n(n),s=(a(381),a(7),a(0)),l=a(30),r=a.n(l),o=a(4),u=a(386),c=a(209),d=a(2);const p={truncation:"middle"},m={asPlainText:!0};function g(e){const{selectedOptions:t,options:a,onChoose:n,onDelete:l,fieldIsInvalid:g,"data-test-subj":f,...b}=e;let v=0;const h=null==a?void 0:a.map((({compatible:e,exists:t,...a})=>a.options?{...a,options:a.options.map((({exists:e,...t})=>(t.label.length>v&&(v=t.label.length),{...t,prepend:t.value.dataType?Object(d.jsx)(u.a,{type:t.value.dataType,fill:"none",className:"eui-alignMiddle"}):null,className:r()({"lnFieldPicker__option--incompatible":!t.compatible,"lnFieldPicker__option--nonExistant":!e})})))}:{...a,compatible:e,prepend:a.value.dataType?Object(d.jsx)(u.a,{type:a.value.dataType,fill:"none",className:"eui-alignMiddle"}):null,className:r()({"lnFieldPicker__option--incompatible":!e,"lnFieldPicker__option--nonExistant":!t})}));return Object(d.jsx)(o.EuiComboBox,i()({fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":null!=f?f:"indexPattern-dimension-field",placeholder:s.i18n.translate("visualizationUiComponents.fieldPicker.fieldPlaceholder",{defaultMessage:"Select a field"}),options:h,isInvalid:g,selectedOptions:t,singleSelection:m,truncationProps:p,inputPopoverProps:{panelMinWidth:Object(c.a)(v),anchorPosition:"downRight"},onChange:e=>{0!==e.length?n(e[0].value):null==l||l()}},b))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(16),i=a.n(n),s=(a(7),a(0)),l=a(4),r=a(122),o=a(2);const u=({idx:e,onRemoveClick:t,removeTitle:a,children:n,draggableProvided:u,isNotRemovable:c,isNotDraggable:d,isDragging:p,"data-test-subj":m="lns-fieldsBucketContainer"})=>{var g;const{euiTheme:f}=Object(l.useEuiTheme)();return Object(o.jsx)(l.EuiPanel,{paddingSize:"xs",hasShadow:p,color:p?"plain":"transparent","data-test-subj":m},Object(o.jsx)(l.EuiFlexGroup,{direction:"row",gutterSize:"s",alignItems:"center",responsive:!1},Object(o.jsx)(l.EuiFlexItem,i()({grow:!1},null!==(g=null==u?void 0:u.dragHandleProps)&&void 0!==g?g:{}),Object(o.jsx)(r.a,{tooltipContent:s.i18n.translate("visualizationUiComponents.fieldsBucketContainer.dragHandleDisabled",{defaultMessage:"Reordering requires more than one item."}),condition:null==d||d},Object(o.jsx)(l.EuiIcon,{size:"s",color:f.colors[d?"disabled":"text"],type:"grab","aria-label":s.i18n.translate("visualizationUiComponents.fieldsBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"}),"data-test-subj":`${m}-dragToReorder-${e}`}))),Object(o.jsx)(l.EuiFlexItem,{grow:!0,style:{minWidth:0}},n),Object(o.jsx)(l.EuiFlexItem,{grow:!1},Object(o.jsx)(r.a,{tooltipContent:s.i18n.translate("visualizationUiComponents.fieldsBucketContainer.deleteButtonDisabled",{defaultMessage:"A minimum of one item is required."}),condition:null!=c&&c},Object(o.jsx)(l.EuiButtonIcon,{iconType:"trash",color:"danger","aria-label":a,onClick:t,"data-test-subj":`${m}-removeField-${e}`,isDisabled:c})))))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a(7);var n=a(4),i=a(2);const s=({label:e,onClick:t,isDisabled:a,className:s,"data-test-subj":l="lns-newBucket-add"})=>Object(i.jsx)(n.EuiButtonEmpty,{"data-test-subj":l,size:"xs",iconType:"plusInCircle",onClick:t,isDisabled:a,flush:"left",className:s},e)},function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a(7);var n=a(0),i=a(27),s=a(40),l=a(119),r=a(2);const o=({value:e,onChange:t,dataView:a,isInvalid:o,onSubmit:u,disableAutoFocus:c,"data-test-subj":d,placeholder:p,appName:m,services:{data:g,uiSettings:f,http:b,notifications:v,docLinks:h,storage:x,unifiedSearch:y,dataViews:j}})=>{const{inputValue:O,handleInputChange:I}=Object(l.a)({value:e,onChange:t});return Object(r.jsx)(s.QueryStringInput,{dataTestSubj:null!=d?d:"indexPattern-filters-queryStringInput",size:"s",disableAutoFocus:c,isInvalid:o,bubbleSubmitEvent:!1,indexPatterns:[a],query:O,onChange:e=>{Object(i.isEqual)(e,O)||I(e)},onSubmit:()=>{O.query&&u()},placeholder:null!=p?p:"kuery"===O.language?n.i18n.translate("visualizationUiComponents.queryInput.queryPlaceholderKql",{defaultMessage:"{example}",values:{example:'method : "GET" or status : "404"'}}):n.i18n.translate("visualizationUiComponents.queryInput.queryPlaceholderLucene",{defaultMessage:"{example}",values:{example:"method:GET OR status:404"}}),languageSwitcherPopoverAnchorPosition:"rightDown",appName:m,deps:{unifiedSearch:y,notifications:v,http:b,docLinks:h,uiSettings:f,data:g,storage:x,dataViews:j}})}},function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(7),i=a.n(n),s=a(0),l=a(4),r=a(119),o=a(538),u=a(546),c=(a(425),a(2));const d=s.i18n.translate("visualizationUiComponents.filterQueryInput.label",{defaultMessage:"Filter by"}),p={query:"",language:"kuery"};function m({inputFilter:e,onChange:t,dataView:a,helpMessage:m,label:g=d,initiallyOpen:f,"data-test-subj":b,queryInputServices:v,appName:h}){const[x,y]=Object(n.useState)(Boolean(f)),{inputValue:j,handleInputChange:O}=Object(r.a)({value:null!=e?e:p,onChange:t}),I=Object(n.useCallback)((()=>{y(!1)}),[]),{isValid:k}=Object(o.b)(e,a),{isValid:T,error:M}=Object(o.b)(j,a);return Object(c.jsx)(l.EuiFormRow,{display:"rowCompressed",label:m?Object(c.jsx)(i.a.Fragment,null,g," ",Object(c.jsx)(l.EuiIconTip,{color:"subdued",content:m,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):g,fullWidth:!0,isInvalid:!k},Object(c.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(c.jsx)(l.EuiFlexItem,null,Object(c.jsx)(l.EuiPopover,{isOpen:x,closePopover:I,anchorClassName:"eui-fullWidth",panelClassName:"filterQueryInput__popover",initialFocus:b?`textarea[data-test-subj='${b}']`:void 0,button:Object(c.jsx)(l.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0},Object(c.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(c.jsx)(l.EuiFlexItem,{grow:!1}),Object(c.jsx)(l.EuiFlexItem,{grow:!0},Object(c.jsx)(l.EuiLink,{className:"filterQueryInput__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>{y(!x)},color:k?"text":"danger",title:s.i18n.translate("visualizationUiComponents.filterQueryInput.clickToEdit",{defaultMessage:"Click to edit"})},(null==e?void 0:e.query)||s.i18n.translate("visualizationUiComponents.filterQueryInput.emptyFilterQuery",{defaultMessage:"(empty)"})))))},Object(c.jsx)(l.EuiFormRow,{label:g,isInvalid:!T,error:M,fullWidth:!0,"data-test-subj":"indexPattern-filter-by-input"},Object(c.jsx)(u.a,{dataView:a.id?{type:"id",value:a.id}:{type:"title",value:a.title},disableAutoFocus:!0,value:j,onChange:O,isInvalid:!T,onSubmit:()=>{},"data-test-subj":b,appName:h,services:v}))))))}},function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a(7);var n=a(0),i=a(4),s=a(238),l=a(2);const r=({value:e,onChange:t,defaultValue:a})=>Object(l.jsx)(i.EuiFormRow,{label:n.i18n.translate("visualizationUiComponents.nameInput.columnLabel",{defaultMessage:"Name",description:"Name of a column of data"}),display:"columnCompressed",fullWidth:!0},Object(l.jsx)(s.a,{fullWidth:!0,compressed:!0,"data-test-subj":"name-input",value:e,onChange:t,defaultValue:a}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return ErrorBoundary}));var n=a(7),i=a.n(n);class ErrorBoundary extends i.a.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?null:this.props.children}}},,,,,,,,,function(e,t,a){"use strict";a.r(t),a.d(t,"getColumnCellValueActions",(function(){return R})),a.d(t,"getDatatableRenderer",(function(){return B})),a.d(t,"getDatatableVisualization",(function(){return se})),a.d(t,"DatatableVisualization",(function(){return DatatableVisualization})),a.d(t,"legacyMetricSupportedTypes",(function(){return Ce})),a.d(t,"getLegacyMetricVisualization",(function(){return Fe})),a.d(t,"LegacyMetricVisualization",(function(){return LegacyMetricVisualization})),a.d(t,"DEFAULT_MAX_COLUMNS",(function(){return lt})),a.d(t,"showingBar",(function(){return rt})),a.d(t,"getDefaultColor",(function(){return ot})),a.d(t,"supportedDataTypes",(function(){return ut})),a.d(t,"metricLabel",(function(){return pt})),a.d(t,"getMetricVisualization",(function(){return ht})),a.d(t,"MetricVisualization",(function(){return MetricVisualization})),a.d(t,"isCollapsed",(function(){return xa})),a.d(t,"hasNonCollapsedSliceBy",(function(){return ya})),a.d(t,"getDefaultColorForMultiMetricDimension",(function(){return ja})),a.d(t,"getPieVisualization",(function(){return Oa})),a.d(t,"PieVisualization",(function(){return PieVisualization})),a.d(t,"YAxisModes",(function(){return Ia.YAxisModes})),a.d(t,"SeriesTypes",(function(){return Ia.SeriesTypes})),a.d(t,"visualizationTypes",(function(){return Ia.visualizationTypes})),a.d(t,"getXyVisualization",(function(){return js})),a.d(t,"XyVisualization",(function(){return xy_XyVisualization})),a.d(t,"isBucketed",(function(){return Gs})),a.d(t,"filterOperationsAxis",(function(){return qs})),a.d(t,"isCellValueSupported",(function(){return Hs})),a.d(t,"getHeatmapVisualization",(function(){return $s})),a.d(t,"HeatmapVisualization",(function(){return HeatmapVisualization})),a.d(t,"isNumericMetric",(function(){return rl})),a.d(t,"isNumericDynamicMetric",(function(){return ol})),a.d(t,"CHART_NAMES",(function(){return ul})),a.d(t,"getGaugeVisualization",(function(){return dl})),a.d(t,"GaugeVisualization",(function(){return gauge_GaugeVisualization})),a.d(t,"getTagcloudVisualization",(function(){return Ml})),a.d(t,"TagcloudVisualization",(function(){return TagcloudVisualization})),a.d(t,"getEditLensConfiguration",(function(){return er})),a.d(t,"deleteColumn",(function(){return Iu})),a.d(t,"removeColumn",(function(){return nb})),a.d(t,"columnToOperation",(function(){return ib})),a.d(t,"getSuffixFormatter",(function(){return Gc})),a.d(t,"unitSuffixesLong",(function(){return zc})),a.d(t,"suffixFormatterId",(function(){return Vc})),a.d(t,"getFormBasedDatasource",(function(){return sb})),a.d(t,"getTextBasedDatasource",(function(){return jb})),a.d(t,"createFormulaPublicApi",(function(){return Ib})),a.d(t,"suggestionsApi",(function(){return ql})),a.d(t,"TextBasedDatasource",(function(){return text_based_TextBasedDatasource})),a.d(t,"FormBasedDatasource",(function(){return form_based_FormBasedDatasource})),a.d(t,"setUsageCollectionStart",(function(){return p.c})),a.d(t,"getUsageCollectionStart",(function(){return p.b})),a.d(t,"trackUiCounterEvents",(function(){return p.d})),a.d(t,"getExecutionContextEvents",(function(){return p.a})),a.d(t,"ErrorBoundary",(function(){return gf.a})),a.d(t,"initMemoizedErrorNotification",(function(){return gf.b})),a.d(t,"showMemoizedErrorNotification",(function(){return gf.c})),a.d(t,"EditorFrame",(function(){return kb.a})),a.d(t,"initializeDataViews",(function(){return kb.c})),a.d(t,"initializeSources",(function(){return kb.e})),a.d(t,"initializeVisualization",(function(){return kb.f})),a.d(t,"initializeDatasources",(function(){return kb.d})),a.d(t,"persistedStateToExpression",(function(){return kb.g})),a.d(t,"getMissingIndexPattern",(function(){return kb.b})),a.d(t,"EditorFrameService",(function(){return service_EditorFrameService})),a.d(t,"Embeddable",(function(){return embeddable_Embeddable})),a.d(t,"getLensServices",(function(){return Vv})),a.d(t,"mountApp",(function(){return Gv})),a.d(t,"getLensAttributeService",(function(){return qv})),a.d(t,"SaveModalContainer",(function(){return Dv.SaveModalContainer})),a.d(t,"runSaveLensVisualization",(function(){return Dv.runSaveLensVisualization})),a.d(t,"removePinnedFilters",(function(){return Dv.removePinnedFilters})),a.d(t,"createChartInfoApi",(function(){return Hv})),a.d(t,"isCompatible",(function(){return $v})),a.d(t,"getHref",(function(){return Xv})),a.d(t,"getLocation",(function(){return Yv})),a.d(t,"execute",(function(){return Qv})),a.d(t,"isActionCompatible",(function(){return Kv})),a.d(t,"executeAction",(function(){return Zv}));var n=a(16),i=a.n(n),s=a(7),l=a.n(s),r=a(37),o=a.n(r),u=a(0),c=a(28),d=a(32),p=a(80),m=(a(189),a(215)),g=a(147),f=a.n(g),b=a(4),v=a(59),h=a(73),x=a(2);const y=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M11 18a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1h10zm0-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V7a1 1 0 011-1h10zm18-6a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1V1a1 1 0 011-1h28z",className:h.a.subdued}),Object(x.jsx)("path",{d:"M20 18a1 1 0 011 1v2a1 1 0 01-.883.993L20 22h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 16h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1v-2a1 1 0 011-1h5zm-9-6a1 1 0 011 1v2a1 1 0 01-.883.993L20 10h-5a1 1 0 01-1-1V7a1 1 0 011-1h5zm9 0a1 1 0 011 1v2a1 1 0 01-1 1h-5a1 1 0 01-1-1V7a1 1 0 011-1h5z",className:h.a.accent}));a(194);var j=a(30),O=a.n(j);function I({children:e,className:t,...a}){return Object(x.jsx)("div",i()({"data-test-subj":"lnsVisualizationContainer",className:O()(t,"lnsVisualizationContainer")},a),e)}var k=a(71);let T;!function(e){e.HOVER_DOWN="hover-down",e.HOVER_RIGHT="hover-right",e.INLINE="inline"}(T||(T={}));var M=a(85),w=a.n(M),C=a(78),E=a(120),S=a(100);const F=l.a.createContext({}),P={border:"horizontal",header:"underline"},_=10,A=[_,20,30,50,100],L=e=>{var t,a,n;const i=Object(s.useRef)(null),l=e.interactive,[r,o]=Object(s.useState)({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection}),[c,d]=Object(s.useState)(e.data),[p,g]=Object(s.useState)(void 0);Object(s.useLayoutEffect)((()=>{setTimeout((()=>{e.renderComplete()}),300)}),[e]),Object(s.useEffect)((()=>{var t;g(e.args.pageSize?{pageIndex:0,pageSize:null!==(t=e.args.pageSize)&&void 0!==t?t:_}:void 0)}),[e.args.pageSize]),f()((()=>{o({columns:e.args.columns,sortingColumnId:e.args.sortingColumnId,sortingDirection:e.args.sortingDirection})}),[e.args.columns,e.args.sortingColumnId,e.args.sortingDirection]),f()((()=>{d(e.data)}),[e.data]);const h=Object(s.useRef)(c);h.current=c,Object(s.useEffect)((()=>{if(!(null!=p&&p.pageIndex||null!=p&&p.pageSize))return;const e=c.rows.length?Math.ceil(c.rows.length/p.pageSize)-1:0;g((t=>t?{pageIndex:t.pageIndex>e?e:t.pageIndex,pageSize:t.pageSize}:t))}),[null==p?void 0:p.pageIndex,null==p?void 0:p.pageSize,c.rows.length]);const j=Object(s.useRef)(e.untransposedData);j.current=e.untransposedData;const T=null===(t=e.rowHasRowClickTriggerActions)||void 0===t?void 0:t.some((e=>e)),{getType:M,dispatchEvent:L,renderMode:D,formatFactory:R}=e,B=Object(s.useMemo)((()=>c.columns.reduce(((e,t)=>{var a;return{...e,[t.id]:R(null===(a=t.meta)||void 0===a?void 0:a.params)}}),{})),[c,R]),N=Object(s.useCallback)((e=>{L({name:"filter",data:e})}),[L]),z=Object(s.useCallback)((e=>{L({name:"edit",data:e})}),[L]),V=Object(s.useCallback)((e=>z({action:"pagesize",size:e})),[z]),G=Object(s.useCallback)((e=>{g((t=>{if(t)return{pageSize:null==t?void 0:t.pageSize,pageIndex:e}}))}),[g]),q=Object(s.useCallback)((e=>{L({name:"tableRowContextMenuClick",data:e})}),[L]),H=Object(s.useMemo)((()=>l?((e,t)=>(a,n,i,s,l=!1)=>{const r={negate:l,data:[{row:s,column:i,value:n,table:e.current}]};t(r)})(h,N):void 0),[h,N,l]),U=Object(s.useMemo)((()=>l?e.columnCellValueActions:void 0),[e.columnCellValueActions,l]),$=Object(s.useMemo)((()=>l?((e,t)=>(a,n=!1)=>{if(!t.current)return;const i=t.current,s={negate:n,data:a.map((({originalBucketColumn:e,value:t})=>{const a=i.columns.findIndex((t=>t.id===e.id));return{row:i.rows.findIndex((a=>a[e.id]===t)),column:a,value:t,table:i}}))};e(s)})(N,j):void 0),[N,j,l]),W=Object(s.useMemo)((()=>r.columns.filter(((e,t)=>{var a,n,i;const s=h.current.columns[t];return(null==s||null===(a=s.meta)||void 0===a||null===(n=a.sourceParams)||void 0===n?void 0:n.type)&&"buckets"===(null===(i=M(s.meta.sourceParams.type))||void 0===i?void 0:i.type)})).map((e=>e.columnId))),[h,r,M]),X=0===c.rows.length||W.length&&e.data.rows.every((e=>W.every((t=>null==e[t])))),Y=Object(s.useMemo)((()=>r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((e=>e.columnId))),[r]),{sortingColumnId:Q,sortingDirection:K}=e.args,Z="edit"!==D,J=Object(s.useMemo)((()=>((e,t,a)=>n=>{const i=Object(C.a)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,width:n.width}:e))}),a({action:"resize",columnId:i,width:n.width})})(r,o,z)),[z,o,r]),ee=Object(s.useMemo)((()=>l?((e,t,a)=>n=>{const i=Object(C.a)(n.columnId);return t({...e,columns:e.columns.map((e=>e.columnId===n.columnId||e.originalColumnId===i?{...e,hidden:!0}:e))}),a({action:"toggle",columnId:i})})(r,o,z):void 0),[z,o,r,l]),te=Object(s.useMemo)((()=>c.columns.reduce(((e,t)=>({...e,[t.id]:"number"===t.meta.type})),{})),[c]),ae=Object(s.useMemo)((()=>{const e={};return r.columns.forEach((t=>{t.alignment?e[t.columnId]=t.alignment:e[t.columnId]=te[t.columnId]?"right":"left"})),e}),[r,te]),ne=Object(s.useMemo)((()=>Object(k.p)(r.columns.filter((({columnId:e})=>te[e])).map((({columnId:e})=>e)),e.data,C.a)),[e.data,te,r]),ie=null!==(a=e.args.headerRowHeight)&&void 0!==a?a:"single",se=null!==(n=e.args.headerRowHeightLines)&&void 0!==n?n:1,le=Object(s.useMemo)((()=>{var t;return((e,t,a,n,i,s,l,r,o,c,d,p,m,g,f,b)=>{const v=t.columns.reduce(((e,{id:t,name:a,meta:n},i)=>(e[t]={name:a,index:i,meta:n},e)),{}),h=({rowIndex:e,columnId:a})=>{var n,i;const s=null===(n=t.rows[e])||void 0===n?void 0:n[a],l=null==v?void 0:v[a];return{rowValue:s,contentsIsDefined:null!=s,cellContent:r(null==l||null===(i=l.meta)||void 0===i?void 0:i.params).convert(s)}};return l.map((e=>{var r;const{name:y,index:j}=v[e],O=(null==b?void 0:b[j])||!1,I=s.columns.find((({columnId:t})=>t===e)),k=[],T=null!==(r=null==g?void 0:g[j])&&void 0!==r?r:[];T.some((({type:e})=>"cellAction-filter"===e))||!O||!a||null!=I&&I.oneClickFilter||k.push((({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:s,contentsIsDefined:l,cellContent:r}=h({rowIndex:t,columnId:n}),o=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueText",{defaultMessage:"Filter for"}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterForValueAriaLabel",{defaultMessage:"Filter for: {cellContent}",values:{cellContent:r}});return l?Object(x.jsx)(i,{"aria-label":c,"data-test-subj":"lensDatatableFilterFor",onClick:()=>{a(e,s,j,t),null==f||f()},iconType:"plusInCircle"},o):null}),(({rowIndex:t,columnId:n,Component:i})=>{const{rowValue:s,contentsIsDefined:l,cellContent:r}=h({rowIndex:t,columnId:n}),o=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueText",{defaultMessage:"Filter out"}),c=u.i18n.translate("xpack.lens.table.tableCellFilter.filterOutValueAriaLabel",{defaultMessage:"Filter out: {cellContent}",values:{cellContent:r}});return l?Object(x.jsx)(i,{"data-test-subj":"lensDatatableFilterOut","aria-label":c,onClick:()=>{a(e,s,j,t,!0),null==f||f()},iconType:"minusInCircle"},o):null})),T.forEach((e=>{k.push((({rowIndex:a,columnId:n,Component:i})=>{const s=t.rows[a][n],l={value:s,columnMeta:v[n].meta};return null==s?null:Object(x.jsx)(i,{"aria-label":e.displayName,"data-test-subj":`lensDatatableCellAction-${e.id}`,onClick:()=>{e.execute([l]),null==f||f()},iconType:e.iconType},e.displayName)}))}));const M=Boolean(null==I?void 0:I.originalColumnId),w=null==I?void 0:I.width,C=null==I?void 0:I.hidden,E=null==I?void 0:I.originalColumnId,S=[];if(S.push({color:"text",size:"xs",onClick:()=>o({columnId:E||e,width:void 0}),iconType:"empty",label:u.i18n.translate("xpack.lens.table.resize.reset",{defaultMessage:"Reset width"}),"data-test-subj":"lensDatatableResetWidth",isDisabled:null==w}),!M&&c&&S.push({color:"text",size:"xs",onClick:()=>c({columnId:E||e}),iconType:"eyeClosed",label:u.i18n.translate("xpack.lens.table.hide.hideLabel",{defaultMessage:"Hide"}),"data-test-subj":"lensDatatableHide",isDisabled:!C&&l.length<=1}),!i&&M&&null!=I&&I.bucketValues&&n){const e=null==I?void 0:I.bucketValues;S.push({color:"text",size:"xs",onClick:()=>n(e,!1),iconType:"plusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterForValueText",{defaultMessage:"Filter for"}),"data-test-subj":"lensDatatableHide"}),S.push({color:"text",size:"xs",onClick:()=>n(e,!0),iconType:"minusInCircle",label:u.i18n.translate("xpack.lens.table.columnFilter.filterOutValueText",{defaultMessage:"Filter out"}),"data-test-subj":"lensDatatableHide"})}const F=d&&d[e],P="auto"===p||"custom"===p,_=Object(x.css)({..."custom"===p&&{WebkitLineClamp:m},...P&&{whiteSpace:"normal",display:"-webkit-box",WebkitBoxOrient:"vertical"},textAlign:F},"",""),A={id:e,cellActions:k,visibleCellActions:5,display:Object(x.jsx)("div",{css:_},y),displayAsText:y,actions:{showHide:!1,showMoveLeft:!1,showMoveRight:!1,showSortAsc:{label:u.i18n.translate("xpack.lens.table.sort.ascLabel",{defaultMessage:"Sort ascending"})},showSortDesc:{label:u.i18n.translate("xpack.lens.table.sort.descLabel",{defaultMessage:"Sort descending"})},additional:S}};return w&&(A.initialWidth=w),A}))})(0,c,H,$,Z,r,Y,R,J,ee,ae,ie,se,U,null===(t=i.current)||void 0===t?void 0:t.closeCellPopover,e.columnFilterable)}),[W,c,H,$,Z,r,Y,R,J,ee,ae,ie,se,U,e.columnFilterable]),re=Object(s.useMemo)((()=>T&&q&&l?[{headerCellRender:()=>null,width:40,id:"trailingControlColumn",rowCellRender:function({rowIndex:e}){const{rowHasRowClickTriggerActions:t}=Object(s.useContext)(F);return Object(x.jsx)(b.EuiButtonIcon,{"aria-label":u.i18n.translate("xpack.lens.table.actionsLabel",{defaultMessage:"Show actions"}),iconType:t&&!t[e]?"empty":"boxesVertical",color:"text",onClick:()=>{q({rowIndex:e,table:h.current,columns:r.columns.map((e=>e.columnId))})}})}}]:[]),[h,q,r,T,l]),oe=Object(s.useMemo)((()=>((e,t,a,n,i)=>({rowIndex:l,columnId:r,setCellProps:o})=>{var u,c;const{table:d,alignments:p,minMaxByColumnId:m,getColorForValue:g,handleFilterClick:f}=Object(s.useContext)(a),v=w()(n.theme$,{darkMode:!1}).darkMode,h=null==d||null===(u=d.rows[l])||void 0===u?void 0:u[r],y=t.columns.findIndex((({columnId:e})=>e===r)),{colorMode:j,palette:I,oneClickFilter:k}=t.columns[y]||{},T=k&&f,M=null===(c=e[r])||void 0===c?void 0:c.convert(h,T?"text":"html"),S=p&&p[r];return Object(s.useEffect)((()=>{const e=Object(C.a)(r);if(null!=m&&m[e]&&"none"!==j&&null!=I&&I.params&&g){const t=g(Object(E.d)(h),I.params,m[e]);if(t){const e={["cell"===j?"backgroundColor":"color"]:t};"cell"===j&&t&&(e.color=Object(E.c)(t,v)),o({style:e})}}return()=>{null!=m&&m[e]&&o({style:{backgroundColor:void 0,color:void 0}})}}),[h,r,o,j,I,m,g,v]),T?Object(x.jsx)("div",{"data-test-subj":"lnsTableCellContent",className:O()({"lnsTableCell--multiline":i,[`lnsTableCell--${S}`]:!0})},Object(x.jsx)(b.EuiLink,{onClick:()=>{null==f||f(r,h,y,l)}},M)):Object(x.jsx)("div",{dangerouslySetInnerHTML:{__html:M},"data-test-subj":"lnsTableCellContent",className:O()({"lnsTableCell--multiline":i,[`lnsTableCell--${S}`]:!0})})})(B,r,F,e.theme,e.args.fitRowToContent)),[B,r,e.theme,e.args.fitRowToContent]),ue=Object(s.useMemo)((()=>({visibleColumns:Y,setVisibleColumns:()=>{}})),[Y]),ce=Object(s.useMemo)((()=>((e,t,a)=>({columns:e&&"none"!==t?[{id:e,direction:t}]:[],onSort:t=>{const n=t.length<=1?t[0]:t[1],i=e!==((null==n?void 0:n.id)||""),s=n?n.direction:"none";return a({action:"sort",columnId:"none"!==s||i?null==n?void 0:n.id:void 0,direction:s})}}))(Q,K,z)),[z,Q,K]),de=Object(s.useMemo)((()=>{const t=r.columns.filter((e=>!!e.columnId&&!e.hidden)).map((t=>({columnId:t.columnId,summaryRowValue:t.summaryRowValue,...Object(S.c)(t.columnId,t,e.data)}))).filter((({summaryRow:e})=>"none"!==e));if(t.length){const e=Object.fromEntries(t.map((({summaryRowValue:e,summaryLabel:t,columnId:a})=>[a,""===t?`${e}`:`${t}: ${e}`])));return({columnId:t})=>{var a,n;const i=`lnsTableCell--${ae&&ae[t]}`,s=(null===(a=le.find((({id:e})=>e===t)))||void 0===a||null===(n=a.displayAsText)||void 0===n?void 0:n.replace(/ /g,"-"))||t;return null!=e[t]?Object(x.jsx)("div",{className:`lnsTableCell ${i}`,"data-test-subj":`lnsDataTable-footer-${s}`},e[t]):null}}}),[r.columns,ae,e.data,le]);if(X)return Object(x.jsx)(I,{className:"lnsDataTableContainer"},Object(x.jsx)(v.EmptyPlaceholder,{icon:y}));const pe=e.args.title||u.i18n.translate("xpack.lens.table.defaultAriaLabel",{defaultMessage:"Data table visualization"});return Object(x.jsx)(I,{className:"lnsDataTableContainer"},Object(x.jsx)(F.Provider,{value:{table:c,rowHasRowClickTriggerActions:e.rowHasRowClickTriggerActions,alignments:ae,minMaxByColumnId:ne,getColorForValue:e.paletteService.get(m.a).getColorForValue,handleFilterClick:H}},Object(x.jsx)(b.EuiDataGrid,{"aria-label":pe,"data-test-subj":"lnsDataTable",rowHeightsOptions:{defaultHeight:e.args.fitRowToContent?"auto":e.args.rowHeightLines&&1!==e.args.rowHeightLines?{lineCount:e.args.rowHeightLines}:void 0},columns:le,columnVisibility:ue,trailingControlColumns:re,rowCount:c.rows.length,renderCellValue:oe,gridStyle:P,sorting:ce,pagination:p&&{...p,pageSizeOptions:A,onChangeItemsPerPage:V,onChangePage:G},onColumnResize:J,toolbarVisibility:!1,renderFooterCellValue:de,ref:i})))};async function D(e,t){if(e.rows.length)return Promise.all(e.columns.map((async(a,n)=>{var i;return Boolean(await(null===(i=t.hasCompatibleActions)||void 0===i?void 0:i.call(t,{name:"filter",data:{data:[{table:e,column:n,row:0}]}})))})))}async function R(e,t){return e.data&&t?Promise.all(e.data.columns.map((({meta:e})=>{try{return t([{columnMeta:e}])}catch{return[]}}))):[]}const B=e=>({name:"lens_datatable_renderer",displayName:u.i18n.translate("xpack.lens.datatable.visualizationName",{defaultMessage:"Datatable"}),help:"",validate:()=>{},reuseDomNode:!0,render:async(t,a,n)=>{n.onDestroy((()=>o.a.unmountComponentAtNode(t)));const s=await e.getType,{hasCompatibleActions:l,isInteractive:r,getCompatibleCellValueActions:u}=n;let m=[];l&&a.data&&(m=await Promise.all(a.data.rows.map((async(e,t)=>{try{return await l({name:"tableRowContextMenuClick",data:{rowIndex:t,table:a.data,columns:a.args.columns.map((e=>e.columnId))}})}catch{return!1}}))));const[g,f]=await Promise.all([R(a,u),D(a.data,n)]);o.a.render(Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(L,i()({},a,{formatFactory:e.formatFactory,dispatchEvent:n.event,renderMode:n.getRenderMode(),paletteService:e.paletteService,getType:s,rowHasRowClickTriggerActions:m,columnCellValueActions:g,columnFilterable:f,interactive:r(),theme:e.theme,renderComplete:()=>{Object(p.d)("table",n.getExecutionContext()),n.done()}})))),t)}});var N=a(5),z=a(31),V=a(36),G=a(143);const q=l.a.lazy((()=>a.e(9).then(a.bind(null,559)))),H=Object(G.c)(q);var U=a(83);a(152);const $=[{text:u.i18n.translate("xpack.lens.collapse.none",{defaultMessage:"None"}),value:""},{text:u.i18n.translate("xpack.lens.collapse.sum",{defaultMessage:"Sum"}),value:"sum"},{text:u.i18n.translate("xpack.lens.collapse.min",{defaultMessage:"Min"}),value:"min"},{text:u.i18n.translate("xpack.lens.collapse.max",{defaultMessage:"Max"}),value:"max"},{text:u.i18n.translate("xpack.lens.collapse.avg",{defaultMessage:"Average"}),value:"avg"}];function W({value:e,onChange:t}){return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{id:"lns-indexPattern-collapse-by",label:Object(x.jsx)(b.EuiToolTip,{delay:"long",position:"top",content:u.i18n.translate("xpack.lens.collapse.infoIcon",{defaultMessage:"Do not show this dimension in the visualization and aggregate all metric values which have the same value for this dimension into a single number."})},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.collapse.label",{defaultMessage:"Collapse by"}),"",Object(x.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"}))),display:"rowCompressed",fullWidth:!0},Object(x.jsx)(b.EuiSelect,{fullWidth:!0,compressed:!0,"data-test-subj":"indexPattern-collapse-by",options:$,value:e,onChange:e=>{t(e.target.value)}})))}const X=Object(b.htmlIdGenerator)()();function Y(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function Q(e){var t,a;const{state:n,setState:i,frame:r,accessor:o,isInlineEditing:c}=e,d=n.columns.find((({columnId:e})=>o===e)),[p,g]=Object(s.useState)(!1);if(!d)return null;if(d.isTransposed)return null;const f=null===(t=r.activeData)||void 0===t?void 0:t[n.layerId],v=Object(U.a)(f,o),h=(null==d?void 0:d.alignment)||(v?"right":"left"),y=(null==d?void 0:d.colorMode)||"none",j="none"!==y,O=r.datasourceLayers[n.layerId],I=Boolean(v&&!(null!=O&&null!==(a=O.getOperationForColumnId(o))&&void 0!==a&&a.isBucketed)),T=n.columns.filter((e=>!e.hidden)).length,M=n.columns.some((({isTransposed:e})=>e))?(null==f?void 0:f.columns.filter((({id:e})=>Object(C.a)(e)===o)).map((({id:e})=>e)))||[]:[o],w=Object(k.p)(M,f,C.a)[o],E=(null==d?void 0:d.palette)||{type:"palette",name:k.n.name},S=Object(k.l)(e.paletteService,E,w);return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.alignment.label",{defaultMessage:"Text alignment"}),"data-test-subj":"lnsDatatable_alignment_groups",name:"alignment",buttonSize:"compressed",options:[{id:`${X}left`,label:u.i18n.translate("xpack.lens.table.alignment.left",{defaultMessage:"Left"}),"data-test-subj":"lnsDatatable_alignment_groups_left"},{id:`${X}center`,label:u.i18n.translate("xpack.lens.table.alignment.center",{defaultMessage:"Center"}),"data-test-subj":"lnsDatatable_alignment_groups_center"},{id:`${X}right`,label:u.i18n.translate("xpack.lens.table.alignment.right",{defaultMessage:"Right"}),"data-test-subj":"lnsDatatable_alignment_groups_right"}],idSelected:`${X}${h}`,onChange:e=>{const t=e.replace(X,"");i({...n,columns:Y(n,o,{alignment:t})})}})),I&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.table.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${X}none`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_none"},{id:`${X}cell`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.cell",{defaultMessage:"Cell"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_cell"},{id:`${X}text`,label:u.i18n.translate("xpack.lens.table.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsDatatable_dynamicColoring_groups_text"}],idSelected:`${X}${y}`,onChange:e=>{const t=e.replace(X,""),a={colorMode:t};null!=d&&d.palette||"none"===t||(a.palette={...E,params:{...E.params,stops:S}}),null!=d&&d.palette&&"none"===t&&(a.palette=void 0),i({...n,columns:Y(n,o,a)})}})),j&&Object(x.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteTableGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsDatatable_dynamicColoring_palette",palette:S.map((({color:e})=>e)),type:m.h,onClick:()=>{g(!p)}})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsDatatable_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:()=>{g(!p)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:p,handleClose:()=>g(!p),title:u.i18n.translate("xpack.lens.table.colorByRangePanelTitle",{defaultMessage:"Color"}),isInlineEditing:c},Object(x.jsx)(H,{palettes:e.paletteService,activePalette:E,dataBounds:w,setPalette:e=>{i({...n,columns:Y(n,o,{palette:e})})}})))))),!d.isTransposed&&Object(x.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),display:"columnCompressedSwitch"},Object(x.jsx)(b.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnVisibilityLabel",{defaultMessage:"Hide column"}),showLabel:!1,"data-test-subj":"lns-table-column-hidden",checked:Boolean(null==d?void 0:d.hidden),disabled:!d.hidden&&T<=1,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===o?{...e,hidden:!d.hidden}:e))};i(e)}})),"rows"===e.groupId&&Object(x.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.columnFilterClickLabel",{defaultMessage:"Directly filter on click"}),display:"columnCompressedSwitch"},Object(x.jsx)(b.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.table.columnFilterClickLabel",{defaultMessage:"Directly filter on click"}),showLabel:!1,"data-test-subj":"lns-table-column-one-click-filter",checked:Boolean(null==d?void 0:d.oneClickFilter),disabled:d.hidden,onChange:()=>{const e={...n,columns:n.columns.map((e=>e.columnId===o?{...e,oneClickFilter:!d.oneClickFilter}:e))};i(e)}})))}function K(e){const{state:t,setState:a,accessor:n}=e,i=t.columns.find((({columnId:e})=>n===e));return i?i.isTransposed?null:Object(x.jsx)(l.a.Fragment,null,"rows"===e.groupId&&Object(x.jsx)(W,{value:i.collapseFn||"",onChange:e=>{a({...t,columns:Y(t,n,{collapseFn:e})})}})):null}var Z=a(119);function J(e,t,a){return e.columns.map((e=>e.columnId===t?{...e,...a}:e))}function ee(e){var t;const{state:a,setState:n,frame:i,accessor:r}=e,o=a.columns.find((({columnId:e})=>r===e)),c=Object(s.useCallback)((e=>{n({...a,columns:J(a,r,{summaryLabel:e})})}),[r,n,a]),{inputValue:d,handleInputChange:p}=Object(Z.a)({onChange:c,value:null==o?void 0:o.summaryLabel},{allowFalsyValue:!0}),{euiTheme:m}=Object(b.useEuiTheme)();if(!o)return null;if(o.isTransposed)return null;const g=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],f=Object(U.a)(g,r),{summaryRow:v,summaryLabel:h}=Object(S.c)(r,o,g);return Object(x.jsx)(l.a.Fragment,null,f&&Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},Object(x.jsx)(b.EuiText,{size:"s",css:Object(x.css)("margin-bottom:",m.size.base,";","")},Object(x.jsx)("h4",null,u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingSummary",{defaultMessage:"Summary"}))),Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.label",{defaultMessage:"Summary Row"}),display:"columnCompressed"},Object(x.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lnsDatatable_summaryrow_function",placeholder:u.i18n.translate("xpack.lens.indexPattern.fieldPlaceholder",{defaultMessage:"Field"}),options:Object(S.d)(),selectedOptions:[{label:Object(S.b)(v),value:v}],singleSelection:{asPlainText:!0},onChange:e=>{const t=e[0].value;n({...a,columns:J(a,r,{summaryRow:t})})}})),"none"!==v&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.table.summaryRow.customlabel",{defaultMessage:"Summary label"})},Object(x.jsx)(b.EuiFieldText,{fullWidth:!0,compressed:!0,"data-test-subj":"lnsDatatable_summaryrow_label",value:null!=d?d:h,onChange:e=>{p(e.target.value)}})))))}const te=Object(b.htmlIdGenerator)()();function ae(e){const{label:t,rowHeight:a,rowHeightLines:n,onChangeRowHeight:i,onChangeRowHeightLines:s,maxRowHeight:r}=e,o=[{id:`${te}single`,label:u.i18n.translate("xpack.lens.table.rowHeight.single",{defaultMessage:"Single"}),"data-test-subj":"lnsDatatable_rowHeight_single"},{id:`${te}auto`,label:u.i18n.translate("xpack.lens.table.rowHeight.auto",{defaultMessage:"Auto fit"}),"data-test-subj":"lnsDatatable_rowHeight_auto"},{id:`${te}custom`,label:u.i18n.translate("xpack.lens.table.rowHeight.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsDatatable_rowHeight_custom"}];return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{label:t,display:"columnCompressed","data-test-subj":e["data-test-subj"]},Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:t,name:"legendLocation",buttonSize:"compressed",options:o,idSelected:`${te}${null!=a?a:"single"}`,onChange:e=>{const t=e.replace(te,"");i(t)}}),"custom"===a?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"xs"}),Object(x.jsx)(b.EuiRange,{compressed:!0,fullWidth:!0,showInput:!0,min:1,max:null!=r?r:20,step:1,value:null!=n?n:2,onChange:e=>{const t=Number(e.currentTarget.value);s(t)},"data-test-subj":"lens-table-row-height-lineCountNumber"})):null)))}function ne(e){var t;const{state:a,setState:n}=e,i=Object(s.useCallback)(((e,t,i)=>{const s="single"===e?1:"auto"!==e?2:void 0;n({...a,[t]:e,[i]:s})}),[n,a]),l=Object(s.useCallback)(((e,t)=>{n({...a,[t]:e})}),[n,a]),r=Object(s.useCallback)((()=>{var e;const t=null!==(e=a.paging)&&void 0!==e?e:{size:_,enabled:!1};n({...a,paging:{...t,enabled:!t.enabled}})}),[n,a]);return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.table.valuesVisualOptions",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(ae,{rowHeight:a.headerRowHeight,rowHeightLines:a.headerRowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsHeaderRowHeightLabel",{defaultMessage:"Header row height"}),onChangeRowHeight:e=>i(e,"headerRowHeight","headerRowHeightLines"),onChangeRowHeightLines:e=>{l(e,"headerRowHeightLines")},"data-test-subj":"lnsHeaderHeightSettings",maxRowHeight:5}),Object(x.jsx)(ae,{rowHeight:a.rowHeight,rowHeightLines:a.rowHeightLines,label:u.i18n.translate("xpack.lens.table.visualOptionsFitRowToContentLabel",{defaultMessage:"Cell row height"}),onChangeRowHeight:e=>i(e,"rowHeight","rowHeightLines"),onChangeRowHeightLines:e=>{l(e,"rowHeightLines")},"data-test-subj":"lnsRowHeightSettings"}),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTable",{defaultMessage:"Paginate table"}),display:"columnCompressedSwitch"},Object(x.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.table.visualOptionsPaginateTableTooltip",{defaultMessage:"Pagination is hidden if there are less than 10 items"}),position:"right"},Object(x.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":"lens-table-pagination-switch",label:"",showLabel:!1,checked:Boolean(null===(t=a.paging)||void 0===t?void 0:t.enabled),onChange:r})))))}const ie=u.i18n.translate("xpack.lens.datatable.label",{defaultMessage:"Table"}),se=({paletteService:e,theme:t})=>({id:"lnsDatatable",visualizationTypes:[{id:"lnsDatatable",icon:y,label:ie,groupLabel:u.i18n.translate("xpack.lens.datatable.groupLabel",{defaultMessage:"Tabular"}),sortPriority:5}],getVisualizationTypeId:()=>"lnsDatatable",getLayerIds:e=>[e.layerId],clearLayer:e=>({...e,columns:[]}),getDescription:()=>({icon:y,label:ie}),switchVisualizationType:(e,t)=>t,triggers:[N.VIS_EVENT_TO_TRIGGER.filter,N.VIS_EVENT_TO_TRIGGER.tableRowContextMenuClick],initialize:(e,t)=>t||{columns:[],layerId:e(),layerType:z.LayerTypes.DATA},getSuggestions({table:e,state:t,keptLayerIds:a}){if(a.length>1||a.length&&e.layerId!==a[0]||t&&"unchanged"===e.changeType||e.columns.some((e=>e.operation.isStaticValue)))return[];const n={};t&&t.columns.forEach((e=>{n[e.columnId]=e}));const i=e.columns.findIndex((e=>{var t;return!(!n[e.columnId]||null!==(t=n[e.columnId])&&void 0!==t&&t.isTransposed)})),s=null==t?void 0:t.columns.some((e=>e.isTransposed)),l="unchanged"===e.changeType?u.i18n.translate("xpack.lens.datatable.suggestionLabel",{defaultMessage:"As table"}):u.i18n.translate("xpack.lens.datatable.visualizationOf",{defaultMessage:"Table {operations}",values:{operations:e.label||e.columns.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.datatable.conjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."}))}}),r=e.changeType,o="reduced"===r||"layers"===r?.3:"unchanged"===r?.5:1;return[{title:l,score:Boolean(null==e?void 0:e.notAssignedMetrics)?1:Math.min(e.columns.length,10)/10*.4*o,state:{...t||{},layerId:e.layerId,layerType:z.LayerTypes.DATA,columns:e.columns.map(((e,t)=>({...n[e.columnId]||{},isTransposed:s&&t<i,columnId:e.columnId})))},previewIcon:y,hide:!0}]},getConfiguration({state:e,frame:t,layerId:a}){const{sortedColumns:n,datasource:i}=le(e,t.datasourceLayers)||{},s={};if(e.columns.forEach((e=>{s[e.columnId]=e})),!n)return{groups:[]};const l=null==i?void 0:i.isTextBasedLanguage();return{groups:[{groupId:"rows",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRows",{defaultMessage:"Rows"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.breakdownRow",{defaultMessage:"Row"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownRows.description",{defaultMessage:"Split table rows by field. This is recommended for high cardinality breakdowns."}),layerId:e.layerId,accessors:n.filter((t=>{var a;const n=e.columns.find((e=>e.columnId===t));var s;return l?!(null!==(s=i.getOperationForColumnId(t))&&void 0!==s&&s.inMetricDimension||null!=n&&n.isMetric||null!=n&&n.isTransposed):(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&!(null!=n&&n.isTransposed)})).map((e=>({columnId:e,triggerIconType:s[e].hidden?"invisible":s[e].collapseFn?"aggregate":void 0}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_rows",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:1},{groupId:"columns",groupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Split metrics by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.breakdownColumn",{defaultMessage:"Split metrics by"}),groupTooltip:u.i18n.translate("xpack.lens.datatable.breakdownColumns.description",{defaultMessage:"Split metric columns by field. It's recommended to keep the number of columns low to avoid horizontal scrolling."}),layerId:e.layerId,accessors:n.filter((t=>{var a,n,s;return l?null===(s=e.columns.find((e=>e.columnId===t)))||void 0===s?void 0:s.isTransposed:(null===(a=i.getOperationForColumnId(t))||void 0===a?void 0:a.isBucketed)&&(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isTransposed)})).map((e=>({columnId:e}))),supportsMoreColumns:!0,filterOperations:e=>e.isBucketed,dataTestSubj:"lnsDatatable_columns",enableDimensionEditor:!0,hideGrouping:!0,nestingOrder:0},{groupId:"metrics",groupLabel:u.i18n.translate("xpack.lens.datatable.metrics",{defaultMessage:"Metrics"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.datatable.metric",{defaultMessage:"Metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.datatable.headingLabel",{defaultMessage:"Value"})},layerId:e.layerId,accessors:n.filter((t=>{const a=i.getOperationForColumnId(t);var n;return l?(null==a?void 0:a.inMetricDimension)||(null===(n=e.columns.find((e=>e.columnId===t)))||void 0===n?void 0:n.isMetric):!(null!=a&&a.isBucketed)})).map((e=>{var t,a;const n=s[e],i=null==n||null===(t=n.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops,l=Boolean("none"!==(null==n?void 0:n.colorMode)&&i);return{columnId:e,triggerIconType:null!=n&&n.hidden?"invisible":l?"colorBy":void 0,palette:l&&i?i.map((({color:e})=>e)):void 0}})),supportsMoreColumns:!0,filterOperations:e=>!e.isBucketed,isMetricDimension:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsDatatable_metrics",enableDimensionEditor:!0}]}},setDimension:({prevState:e,columnId:t,groupId:a,previousColumn:n})=>e.columns.some((e=>e.columnId===t||n&&e.columnId===n))?{...e,columns:e.columns.map((e=>e.columnId===t||e.columnId===n?{...e,columnId:t,isTransposed:"columns"===a,isMetric:"metrics"===a}:e))}:{...e,columns:[...e.columns,{columnId:t,isTransposed:"columns"===a,isMetric:"metrics"===a}]},removeDimension({prevState:e,columnId:t}){var a;return{...e,columns:e.columns.filter((e=>e.columnId!==t)),sorting:(null===(a=e.sorting)||void 0===a?void 0:a.columnId)===t?void 0:e.sorting}},DimensionEditorComponent:t=>Object(x.jsx)(Q,i()({},t,{paletteService:e})),DimensionEditorAdditionalSectionComponent:t=>Object(x.jsx)(ee,i()({},t,{paletteService:e})),DimensionEditorDataExtraComponent:t=>Object(x.jsx)(K,i()({},t,{paletteService:e})),getSupportedLayers:()=>[{type:z.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.datatable.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,{title:n,description:i}={},s={}){var l,r,o,u,c,d,p;const{sortedColumns:g,datasource:f}=le(t,a,t.layerId)||{},b=null==f?void 0:f.isTextBasedLanguage();if(null!=g&&g.length&&!b&&0===g.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e))&&void 0!==t&&t.isBucketed)})).length)return null;if(!s||0===Object.keys(s).length)return null;const v={};t.columns.forEach((e=>{v[e.columnId]=e}));const h=g.filter((e=>f.getOperationForColumnId(e))).map((e=>v[e])),x=s[t.layerId],y=h.filter((e=>e.collapseFn)).map((e=>Object(V.buildExpressionFunction)("lens_collapse",{by:h.filter((t=>{var a;return t.columnId!==e.columnId&&(null===(a=f.getOperationForColumnId(t.columnId))||void 0===a?void 0:a.isBucketed)})).map((e=>e.columnId)),metric:h.filter((e=>{var t;return!(null!==(t=f.getOperationForColumnId(e.columnId))&&void 0!==t&&t.isBucketed)})).map((e=>e.columnId)),fn:[e.collapseFn]}).toAst())),j=Object(V.buildExpressionFunction)("lens_datatable",{title:n||"",description:i||"",columns:h.filter((e=>!e.collapseFn)).map((t=>{var a,n,i,s,l,r,o,u,c,d;const p={...null===(a=t.palette)||void 0===a?void 0:a.params,colors:((null===(n=t.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null===(s=t.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.name)?((null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.stops)||[]).map((({stop:e})=>e)):[],reverse:!1},g=f.getOperationForColumnId(t.columnId).sortingHint,v=null==t.summaryRow||"none"===t.summaryRow,h="number"===(null===(u=f.getOperationForColumnId(t.columnId))||void 0===u?void 0:u.dataType);let x=!(b||null!==(c=f.getOperationForColumnId(t.columnId))&&void 0!==c&&c.isBucketed);if(b){const e=f.getOperationForColumnId(t.columnId);x=Boolean((null==t?void 0:t.isMetric)||(null==e?void 0:e.inMetricDimension))}const y=Object(V.buildExpressionFunction)("lens_datatable_column",{columnId:t.columnId,hidden:t.hidden,oneClickFilter:t.oneClickFilter,width:t.width,isTransposed:t.isTransposed,transposable:x,alignment:t.alignment,colorMode:h&&t.colorMode?t.colorMode:"none",palette:e.get(m.a).toExpression(p),summaryRow:v?void 0:t.summaryRow,summaryLabel:v?void 0:null!==(d=t.summaryLabel)&&void 0!==d?d:Object(S.b)(t.summaryRow),sortingHint:g});return Object(V.buildExpression)([y]).toAst()})),sortingColumnId:(null===(l=t.sorting)||void 0===l?void 0:l.columnId)||"",sortingDirection:(null===(r=t.sorting)||void 0===r?void 0:r.direction)||"none",fitRowToContent:"auto"===t.rowHeight,headerRowHeight:null!==(o=t.headerRowHeight)&&void 0!==o?o:"single",rowHeightLines:t.rowHeight&&"single"!==t.rowHeight?null!==(u=t.rowHeightLines)&&void 0!==u?u:2:1,headerRowHeightLines:t.headerRowHeight&&"single"!==t.headerRowHeight?null!==(c=t.headerRowHeightLines)&&void 0!==c?c:2:1,pageSize:null!==(d=t.paging)&&void 0!==d&&d.enabled?t.paging.size:void 0}).toAst();return{type:"expression",chain:[...null!==(p=null==x?void 0:x.chain)&&void 0!==p?p:[],...y,j]}},getRenderEventCounters(e){const t={color_by_value:!1,summary_row:!1};return e.columns.forEach((e=>{e.summaryRow&&"none"!==e.summaryRow&&(t.summary_row=!0),e.colorMode&&"none"!==e.colorMode&&(t.color_by_value=!0)})),Object.entries(t).reduce(((e,[t,a])=>(a&&e.push(`dimension_${t}`),e)),[])},ToolbarComponent:e=>Object(x.jsx)(ne,e),onEditAction(e,t){var a;switch(t.data.action){case"sort":return{...e,sorting:{columnId:t.data.columnId,direction:t.data.direction}};case"toggle":const n=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===n?{...e,hidden:!e.hidden}:e))};case"resize":const i=t.data.width,s=t.data.columnId;return{...e,columns:e.columns.map((e=>e.columnId===s?{...e,width:i}:e))};case"pagesize":return{...e,paging:{enabled:(null===(a=e.paging)||void 0===a?void 0:a.enabled)||!1,size:t.data.size}};default:return e}},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e){var t,a,n,i;const s=e.columns.filter((e=>!e.hidden&&e.colorMode&&"none"!==e.colorMode));return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"table",...this.getDescription(e),palette:s.length>1||null===(t=s[0])||void 0===t||null===(a=t.palette)||void 0===a||null===(n=a.params)||void 0===n||null===(i=n.stops)||void 0===i?void 0:i.map((({color:e})=>e)),dimensions:e.columns.map((e=>{let t=u.i18n.translate("xpack.lens.datatable.metric",{defaultMessage:"Metric"}),a="Metric";return e.transposable||(e.isTransposed?(t=u.i18n.translate("xpack.lens.datatable.breakdownColumns",{defaultMessage:"Split metrics by"}),a="split_metrics"):(t=u.i18n.translate("xpack.lens.datatable.breakdownRow",{defaultMessage:"Row"}),a="split_rows")),{dimensionType:a,id:e.columnId,name:t}}))}]}}});function le(e,t,a){const n=t[e.layerId],i=null==n?void 0:n.getTableSpec().map((({columnId:e})=>e));return{datasource:n,sortedColumns:Array.from(new Set(null==i?void 0:i.concat(e.columns.map((({columnId:e})=>e)))))}}class DatatableVisualization{setup(e,{expressions:t,formatFactory:n,editorFrame:i,charts:s}){i.registerVisualization((async()=>{const{getDatatableRenderer:i,getDatatableVisualization:l}=await Promise.resolve().then(a.bind(null,558)),r=await s.palettes.getPalettes();return t.registerRenderer((()=>i({formatFactory:n,theme:e.theme,getType:e.getStartServices().then((([e,{data:t}])=>t.search.aggs.types.get)),paletteService:r,uiSettings:e.uiSettings}))),l({paletteService:r,theme:e.theme})}))}}var re=a(29),oe=a(533),ue=a(45);const ce=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M25 0a1 1 0 011 1v14a1 1 0 01-1 1H5a1 1 0 01-1-1V1a1 1 0 011-1h20zm-9.878 3c-1.887 0-3.265 1.107-3.26 2.61-.005 1.054.67 1.938 1.672 2.157v.067l-.155.03a2.453 2.453 0 00-1.879 2.394C11.495 11.84 12.997 13 15.122 13c2.105 0 3.612-1.16 3.617-2.742-.005-1.217-.903-2.234-2.035-2.424v-.067l.162-.042c.896-.275 1.507-1.12 1.511-2.116C18.373 4.112 16.994 3 15.122 3zm0 5.542c1.036 0 1.796.665 1.806 1.592-.01.898-.718 1.507-1.806 1.507-1.103 0-1.816-.609-1.806-1.507-.01-.932.755-1.592 1.806-1.592zm0-4.164c.908 0 1.53.561 1.54 1.398-.01.85-.651 1.43-1.54 1.43-.903 0-1.55-.584-1.54-1.43-.01-.837.618-1.398 1.54-1.398z",className:h.a.accent}),Object(x.jsx)("path",{d:"M1 18h28a1 1 0 011 1v2a1 1 0 01-1 1H1a1 1 0 01-1-1v-2a1 1 0 011-1z",className:h.a.subdued}));function de({table:e,state:t,keptLayerIds:a,datasourceId:n}){return e.isMultiRow||a.length>1||a.length&&e.layerId!==a[0]||1!==e.columns.length||e.columns[0].operation.isBucketed||!Ce.has(e.columns[0].operation.dataType)||e.columns[0].operation.isStaticValue||t&&"unchanged"===e.changeType||"textBased"===n?[]:[pe(e)]}function pe(e){const t=e.columns[0];return{title:e.label||t.operation.label,score:.1,previewIcon:ce,state:{layerId:e.layerId,accessor:t.columnId,layerType:z.LayerTypes.DATA}}}const me={...k.n,maxSteps:5,name:"status",continuity:"all",rangeType:"number",steps:3};a(233);const ge=Object(b.htmlIdGenerator)()();function fe(e){var t;const{state:a,setState:n,frame:i,accessor:r,isInlineEditing:o}=e,[c,d]=Object(s.useState)(!1),p=Object(s.useCallback)((()=>{d(!c)}),[c]),g=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[f]=(null==g?void 0:g.rows)||[];if(null==r||null==f||!Object(U.a)(g,r))return null;const v=(null==a?void 0:a.colorMode)||ue.ColorMode.None,h=v!==ue.ColorMode.None,y={min:Math.min(2*f[r],0===f[r]?-50:0),max:Math.max(2*f[r],0===f[r]?100:0)},j=(null==a?void 0:a.palette)||{type:"palette",name:me.name,params:{...me,stops:void 0,colorStops:void 0,rangeMin:y.min,rangeMax:3*y.max/4}},O=Object(k.l)(e.paletteService,j,y);return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.label",{defaultMessage:"Color by value"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.label",{defaultMessage:"Color by value"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups",name:"dynamicColoring",buttonSize:"compressed",options:[{id:`${ge}None`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.none",{defaultMessage:"None"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_none"},{id:`${ge}Background`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.background",{defaultMessage:"Fill"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_background"},{id:`${ge}Labels`,label:u.i18n.translate("xpack.lens.legacyMetric.dynamicColoring.text",{defaultMessage:"Text"}),"data-test-subj":"lnsLegacyMetric_dynamicColoring_groups_labels"}],idSelected:`${ge}${v}`,onChange:e=>{const t=e.replace(ge,""),i={colorMode:t};null!=a&&a.palette||t===ue.ColorMode.None||(i.palette={...j,params:{...j.params,stops:O.map(((e,t,a)=>({...e,stop:y.min+(0===t?0:a[t-1].stop)})))}}),null!=a&&a.palette&&t===ue.ColorMode.None&&(i.palette=void 0),n({...a,...i})}})),h&&Object(x.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsLegacyMetric_dynamicColoring_palette",palette:O.map((({color:e})=>e)),type:m.h,onClick:p})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsLegacyMetric_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:p,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:c,handleClose:p,title:u.i18n.translate("xpack.lens.table.colorByRangePanelTitle",{defaultMessage:"Color"}),isInlineEditing:o},Object(x.jsx)(H,{palettes:e.paletteService,activePalette:j,dataBounds:y,setPalette:e=>{e.name!==m.a&&e.params&&e.params.rangeMin!==y.min&&(e.params.rangeMin=y.min),n({...a,palette:e})},showRangeTypeSelector:!1}))))))}var be=a(122);const ve=[{id:"top",label:u.i18n.translate("xpack.lens.legacyMetric.titlePositions.top",{defaultMessage:"Top"})},{id:"bottom",label:u.i18n.translate("xpack.lens.legacyMetric.titlePositions.bottom",{defaultMessage:"Bottom"})}],he=({state:e,setState:t})=>{var a;return Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:Object(x.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.legacyMetric.titlePositionLabel",{defaultMessage:"Title position"}))},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,"data-test-subj":"lnsMissingValuesSelect",legend:"This is a basic group",options:ve,idSelected:null!==(a=e.titlePosition)&&void 0!==a?a:"top",onChange:a=>{t({...e,titlePosition:a})},buttonSize:"compressed"}))},xe="m",ye=[{id:"xs",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.extraSmall",{defaultMessage:"XS"})},{id:"s",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.small",{defaultMessage:"S"})},{id:"m",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.medium",{defaultMessage:"M"})},{id:"l",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.large",{defaultMessage:"L"})},{id:"xl",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.extraLarge",{defaultMessage:"XL"})},{id:"xxl",label:u.i18n.translate("xpack.lens.legacyMetric.metricSize.xxl",{defaultMessage:"XXL"})}],je=({state:e,setState:t})=>{var a;const n=ye.findIndex((t=>t.id===(e.size||xe))),i=a=>{t({...e,size:ye[n+a].id})};return Object(x.jsx)(b.EuiSuperSelect,{append:Object(x.jsx)(b.EuiButtonIcon,{iconType:"plus",onClick:()=>i(1),isDisabled:n===ye.length-1}),prepend:Object(x.jsx)(b.EuiButtonIcon,{iconType:"minus",onClick:()=>i(-1),isDisabled:0===n}),"data-test-subj":"lnsLegacyMetricSizeSelect",compressed:!0,options:ye.map((e=>({value:e.id,dropdownDisplay:e.label,inputDisplay:e.label}))),valueOfSelected:null!==(a=e.size)&&void 0!==a?a:xe,onChange:a=>{t({...e,size:a})},itemLayoutAlign:"top",hasDividers:!0,fullWidth:!0})},Oe="left",Ie=[{id:"left",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.left",{defaultMessage:"Align left"}),iconType:"editorAlignLeft"},{id:"center",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.center",{defaultMessage:"Align center"}),iconType:"editorAlignCenter"},{id:"right",label:u.i18n.translate("xpack.lens.legacyMetric.alignLabel.right",{defaultMessage:"Align right"}),iconType:"editorAlignRight"}],ke=({state:e,setState:t})=>{var a;return Object(x.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.legacyMetric.titleAlignLabel",{defaultMessage:"Align"}),options:Ie,idSelected:null!==(a=e.textAlign)&&void 0!==a?a:Oe,onChange:a=>{t({...e,textAlign:a})},isIconOnly:!0,buttonSize:"compressed"})},Te=({state:e,setState:t})=>Object(x.jsx)(b.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:Object(x.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.legacyMetric.textFormattingLabel",{defaultMessage:"Text formatting"}))},Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"s",responsive:!1},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(je,{state:e,setState:t})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(ke,{state:e,setState:t})))),Me=({state:e,setState:t})=>Object(x.jsx)(be.a,{tooltipContent:u.i18n.translate("xpack.lens.shared.AppearanceLabel",{defaultMessage:"Appearance"}),condition:!0},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.shared.metric.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",groupPosition:"none",buttonDataTestSubj:"lnsLegacyMetricAppearanceButton"},Object(x.jsx)(Te,{state:e,setState:t}),Object(x.jsx)(he,{state:e,setState:t}))),we=Object(s.memo)((function(e){const{state:t,setState:a,frame:n}=e;return Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"m",justifyContent:"spaceBetween",responsive:!1},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"none",responsive:!1},Object(x.jsx)(Me,{state:t,setState:a,datasourceLayers:n.datasourceLayers}))))})),Ce=(Object(b.htmlIdGenerator)()(),new Set(["string","boolean","number","ip","date"])),Ee=e=>{const[t,a]=e.split(/(\d+)/).filter(Boolean);return{size:Number(t),sizeUnit:a}},Se=(e,t,a,n,i={})=>{var s,l,r,o,u,c,d,p,g,f;if(!t.accessor)return null;const[b]=Object.values(a),v=i[t.layerId],h=b&&b.getOperationForColumnId(t.accessor),x=(null===(s=t.palette)||void 0===s||null===(l=s.params)||void 0===l?void 0:l.stops)||[],y=(null===(r=t.palette)||void 0===r||null===(o=r.params)||void 0===o?void 0:o.name)===m.a,j="number"===(null==h?void 0:h.dataType),O={...null===(u=t.palette)||void 0===u?void 0:u.params,colors:x.map((({color:e})=>e)),stops:y||null==(null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d?void 0:d.rangeMax)?x.map((({stop:e})=>e)):Object(oe.i)(x,Math.max(null===(p=t.palette)||void 0===p||null===(g=p.params)||void 0===g?void 0:g.rangeMax,...x.map((({stop:e})=>e)))).map((({stop:e})=>e)),reverse:!1},I={xs:Ee(re.euiThemeVars.euiFontSizeXS),s:Ee(re.euiThemeVars.euiFontSizeS),m:Ee(re.euiThemeVars.euiFontSizeM),l:Ee(re.euiThemeVars.euiFontSizeL),xl:Ee(re.euiThemeVars.euiFontSizeXL),xxl:Ee(re.euiThemeVars.euiFontSizeXXL)},k=I[(null==t?void 0:t.size)||xe],T={xs:2*I.xs.size,s:2.5*I.m.size,m:2.5*I.l.size,l:2.5*I.xl.size,xl:2.5*I.xxl.size,xxl:3*I.xxl.size}[(null==t?void 0:t.size)||xe],M=Object(V.buildExpressionFunction)("font",{align:(null==t?void 0:t.textAlign)||Oe,size:T,weight:"600",lHeight:1.5*T,sizeUnit:k.sizeUnit}),w=Object(V.buildExpressionFunction)("font",{align:(null==t?void 0:t.textAlign)||Oe,size:k.size,lHeight:1.5*k.size,sizeUnit:k.sizeUnit}),C=Object(V.buildExpressionFunction)("visdimension",{accessor:t.accessor}),E=Object(V.buildExpressionFunction)("legacyMetricVis",{autoScaleMetricAlignment:null==t?void 0:t.autoScaleMetricAlignment,labelPosition:(null==t?void 0:t.titlePosition)||"top",font:Object(V.buildExpression)([M]),labelFont:Object(V.buildExpression)([w]),metric:Object(V.buildExpression)([C]),showLabels:!(null!=n&&n.mode)||"full"===(null==n?void 0:n.mode),colorMode:j&&(null==t?void 0:t.colorMode)||ue.ColorMode.None,autoScale:!0,colorFullBackground:!0,palette:null!=t&&t.colorMode&&(null==t?void 0:t.colorMode)!==ue.ColorMode.None?e.get(m.a).toExpression(O):void 0,percentageMode:!1});return{type:"expression",chain:[...null!==(f=null==v?void 0:v.chain)&&void 0!==f?f:[],E.toAst()]}},Fe=({paletteService:e,theme:t})=>({id:"lnsLegacyMetric",visualizationTypes:[{id:"lnsLegacyMetric",icon:ce,label:u.i18n.translate("xpack.lens.legacyMetric.label",{defaultMessage:"Legacy Metric"}),groupLabel:u.i18n.translate("xpack.lens.legacyMetric.groupLabel",{defaultMessage:"Goal and single value"})}],getVisualizationTypeId:()=>"lnsLegacyMetric",clearLayer:e=>({...e,accessor:void 0}),getLayerIds:e=>[e.layerId],getDescription:()=>({icon:ce,label:u.i18n.translate("xpack.lens.legacyMetric.label",{defaultMessage:"Legacy Metric"})}),getSuggestions:de,initialize:(e,t)=>t||{layerId:e(),accessor:void 0,layerType:z.LayerTypes.DATA},triggers:[N.VIS_EVENT_TO_TRIGGER.filter],getConfiguration(e){var t,a;const n=null!=e.state.palette,i=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{groups:[{groupId:"metric",dataTestSubj:"lnsLegacyMetric_metricDimensionPanel",paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.metric.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,groupLabel:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),layerId:e.state.layerId,accessors:e.state.accessor?[{columnId:e.state.accessor,triggerIconType:n?"colorBy":void 0,palette:n?i.map((({color:e})=>e)):void 0}]:[],supportsMoreColumns:!e.state.accessor,filterOperations:e=>!e.isBucketed&&Ce.has(e.dataType),enableDimensionEditor:!0,requiredMinDimensionCount:1}]}},getSupportedLayers:()=>[{type:z.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.legacyMetric.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i)=>Se(e,t,a,{...n},i),toPreviewExpression:(t,a,n)=>Se(e,t,a,{mode:"reduced"},n),setDimension:({prevState:e,columnId:t})=>({...e,accessor:t}),removeDimension:({prevState:e})=>({...e,accessor:void 0,colorMode:ue.ColorMode.None,palette:void 0}),ToolbarComponent:e=>Object(x.jsx)(we,{state:e.state,setState:e.setState,frame:e.frame}),DimensionEditorComponent:t=>Object(x.jsx)(fe,i()({},t,{paletteService:e})),getVisualizationInfo(e){var t,a;const n=[];e.accessor&&n.push({id:e.accessor,name:u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),dimensionType:"metric"});const i=null!=e.palette,s=(null===(t=e.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"metric",...this.getDescription(e),dimensions:n,palette:i?s.map((({color:e})=>e)):void 0}]}}});class LegacyMetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getLegacyMetricVisualization:t}=await Promise.resolve().then(a.bind(null,558));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var Pe=a(20);const _e=({table:e,state:t,keptLayerIds:a})=>{var n,i;const s=Boolean(t),l=e.columns.filter((({operation:e})=>ut.has(e.dataType)&&!e.isBucketed)),r=e.columns.filter((({operation:e})=>e.isBucketed)),o=e.columns.filter((({operation:e})=>!ut.has(e.dataType)&&!e.isBucketed)).length||r.length>1||l.length>2;if(!e.columns.length||((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||o||s&&"initial"===e.changeType&&l.length&&r.length||s&&"unchanged"===e.changeType)return[];const u={state:{...t,layerId:e.layerId,layerType:z.LayerTypes.DATA},title:pt,previewIcon:ce,score:.5,hide:!0},c={metricAccessor:null===(n=l[0])||void 0===n?void 0:n.columnId,breakdownByAccessor:null===(i=r[0])||void 0===i?void 0:i.columnId};return u.score+=.01*Object.values(c).filter(Boolean).length,[{...u,state:{...u.state,...c,secondaryMetricAccessor:void 0,maxAccessor:void 0}}]},Ae="lnsMetric",Le="metric",De="secondaryMetric",Re="breakdownBy",Be="trendMetric",Ne="trendSecondaryMetric",ze="trendTime",Ve="trendBreakdownBy";var Ge=a(60),qe=a(52),He=a(238),Ue=a(534);const $e={...k.n,name:"status",rangeType:"percent",steps:3,maxSteps:5,continuity:"all",colorStops:[],stops:[]},We={...k.n,name:"status",rangeType:"number",rangeMin:-1/0,rangeMax:1/0,steps:3,maxSteps:5,continuity:"all",colorStops:[],stops:[]},Xe=[{value:"empty",label:u.i18n.translate("xpack.lens.metric.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"sortUp",label:u.i18n.translate("xpack.lens.metric.iconSelect.sortUpLabel",{defaultMessage:"Sort up"})},{value:"sortDown",label:u.i18n.translate("xpack.lens.metric.iconSelect.sortDownLabel",{defaultMessage:"Sort down"})},{value:"compute",label:u.i18n.translate("xpack.lens.metric.iconSelect.computeLabel",{defaultMessage:"Compute"})},{value:"globe",label:u.i18n.translate("xpack.lens.metric.iconSelect.globeLabel",{defaultMessage:"Globe"})},{value:"temperature",label:u.i18n.translate("xpack.lens.metric.iconSelect.temperatureLabel",{defaultMessage:"Temperature"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.metric.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"alert",label:u.i18n.translate("xpack.lens.metric.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"bell",label:u.i18n.translate("xpack.lens.metric.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.metric.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.metric.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.metric.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"flag",label:u.i18n.translate("xpack.lens.metric.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"heart",label:u.i18n.translate("xpack.lens.metric.iconSelect.heartLabel",{defaultMessage:"Heart"})},{value:"mapMarker",label:u.i18n.translate("xpack.lens.metric.iconSelect.mapMarkerLabel",{defaultMessage:"Map Marker"})},{value:"pin",label:u.i18n.translate("xpack.lens.metric.iconSelect.mapPinLabel",{defaultMessage:"Map Pin"})},{value:"starEmpty",label:u.i18n.translate("xpack.lens.metric.iconSelect.starLabel",{defaultMessage:"Star"})},{value:"tag",label:u.i18n.translate("xpack.lens.metric.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}];function Ye(e){const{state:t,accessor:a}=e,n=Object(b.htmlIdGenerator)()();switch(a){case null==t?void 0:t.metricAccessor:return Object(x.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_primary_metric"},Object(x.jsx)(Je,i()({},e,{idPrefix:n})));case t.secondaryMetricAccessor:return Object(x.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_secondary_metric"},Object(x.jsx)(Ze,i()({},e,{idPrefix:n})));case t.maxAccessor:return Object(x.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_maximum"},Object(x.jsx)(Ke,i()({},e,{idPrefix:n})));case t.breakdownByAccessor:return Object(x.jsx)("div",{"data-test-subj":"lnsMetricDimensionEditor_breakdown"},Object(x.jsx)(Qe,i()({},e,{idPrefix:n})));default:return null}}function Qe({setState:e,state:t}){var a;const n=Object(s.useCallback)((a=>{e({...t,maxCols:parseInt(a,10)})}),[e,t]),{inputValue:i,handleInputChange:r}=Object(Z.a)({onChange:n,value:String(null!==(a=t.maxCols)&&void 0!==a?a:lt)});return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.maxColumns",{defaultMessage:"Layout columns"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(b.EuiFieldNumber,{compressed:!0,min:1,"data-test-subj":"lnsMetric_max_cols",value:i,onChange:({target:{value:e}})=>r(e)})),Object(x.jsx)(W,{value:t.collapseFn||"",onChange:a=>{e({...t,collapseFn:a})}}))}function Ke({setState:e,state:t,idPrefix:a}){return null}function Ze({accessor:e,idPrefix:t,frame:a,layerId:n,setState:i,state:s}){var r,o;const c=(null===(r=Object(qe.getColumnByAccessor)(e,null===(o=a.activeData)||void 0===o?void 0:o[n].columns))||void 0===r?void 0:r.name)||"";return Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.prefixText.label",{defaultMessage:"Prefix"})},Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.prefix.label",{defaultMessage:"Prefix"}),"data-test-subj":"lnsMetric_prefix_buttons",options:[{id:`${t}auto`,label:u.i18n.translate("xpack.lens.metric.prefix.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsMetric_prefix_auto",value:void 0},{id:`${t}custom`,label:u.i18n.translate("xpack.lens.metric.prefix.custom",{defaultMessage:"Custom"}),"data-test-subj":"lnsMetric_prefix_custom",value:c},{id:`${t}none`,label:u.i18n.translate("xpack.lens.metric.prefix.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_prefix_none",value:""}],idSelected:`${t}${void 0===s.secondaryPrefix?"auto":""===s.secondaryPrefix?"none":"custom"}`,onChange:(e,t)=>{i({...s,secondaryPrefix:t})}}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),s.secondaryPrefix&&Object(x.jsx)(He.a,{"data-test-subj":"lnsMetric_prefix_custom_input",compressed:!0,value:s.secondaryPrefix,onChange:e=>{i({...s,secondaryPrefix:e})}})))}function Je(e){var t,a,n,i,r,o;const{state:c,setState:d,frame:p,accessor:g,idPrefix:f,isInlineEditing:v}=e,[h,y]=Object(s.useState)(!1),j=null===(t=p.activeData)||void 0===t?void 0:t[c.layerId],O=Object(U.a)(j,g);if(null==g)return null;const I=Boolean(O&&(null==c?void 0:c.palette)),T=Boolean(c.maxAccessor||c.breakdownByAccessor&&!c.collapseFn||"percent"===(null==c||null===(a=c.palette)||void 0===a||null===(n=a.params)||void 0===n?void 0:n.rangeType)),M=(null==c?void 0:c.palette)||{type:"palette",name:(T?$e:We).name,params:{...T?$e:We}},w=Object(Ge.getDataBoundsForPalette)({metric:c.metricAccessor,max:c.maxAccessor,breakdownBy:c.collapseFn?void 0:c.breakdownByAccessor},null===(i=p.activeData)||void 0===i?void 0:i[c.layerId]),C=Object(k.l)(e.paletteService,M,{min:null!==(r=w.min)&&void 0!==r?r:m.e,max:null!==(o=w.max)&&void 0!==o?o:m.d}),E=()=>y(!h);return Object(x.jsx)(l.a.Fragment,null,O&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.dynamicColoring.label",{defaultMessage:"Color mode"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.colorMode.label",{defaultMessage:"Color mode"}),"data-test-subj":"lnsMetric_color_mode_buttons",options:[{id:`${f}static`,label:u.i18n.translate("xpack.lens.metric.colorMode.static",{defaultMessage:"Static"}),"data-test-subj":"lnsMetric_color_mode_static"},{id:`${f}dynamic`,label:u.i18n.translate("xpack.lens.metric.colorMode.dynamic",{defaultMessage:"Dynamic"}),"data-test-subj":"lnsMetric_color_mode_dynamic"}],idSelected:`${f}${c.palette?"dynamic":"static"}`,onChange:e=>{const t="dynamic"===e.replace(f,"")?{palette:{...M,params:{...M.params,stops:C}},color:void 0}:{palette:void 0,color:void 0};d({...c,...t})}})),!I&&Object(x.jsx)(et,e),I&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsMetric_dynamicColoring_palette",palette:C.map((({color:e})=>e)),type:m.h,onClick:E})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsMetric_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:E,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:h,handleClose:E,title:u.i18n.translate("xpack.lens.table.colorByRangePanelTitle",{defaultMessage:"Color"}),isInlineEditing:v},Object(x.jsx)(H,{palettes:e.paletteService,activePalette:M,dataBounds:w,showRangeTypeSelector:T,setPalette:e=>{d({...c,palette:e})}}))))),Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.icon",{defaultMessage:"Icon decoration"})},Object(x.jsx)(Ue.a,{customIconSet:Xe,value:null==c?void 0:c.icon,onChange:e=>{d({...c,icon:e})}})))}function et({state:e,setState:t,frame:a}){var n;const i=u.i18n.translate("xpack.lens.metric.color",{defaultMessage:"Color"}),l=null===(n=a.activeData)||void 0===n?void 0:n[e.layerId],r=Boolean(e.metricAccessor&&Object(U.a)(l,e.metricAccessor)),o=Object(s.useCallback)((a=>{t({...e,color:""===a?void 0:a})}),[t,e]),{inputValue:c,handleInputChange:d}=Object(Z.a)({onChange:o,value:e.color||ot(e,r)},{allowFalsyValue:!0});return Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:i},Object(x.jsx)(b.EuiColorPicker,{fullWidth:!0,compressed:!0,isClearable:!1,onChange:e=>d(e),color:c,"aria-label":i,showAlpha:!1,swatches:Object(b.euiPaletteColorBlind)()}))}function tt({state:e,datasource:t,setState:a,addLayer:n,removeLayer:i,accessor:s,frame:r}){var o,c,d,p;const{euiTheme:m}=Object(b.useEuiTheme)(),g=null===(o=r.activeData)||void 0===o?void 0:o[e.layerId];if(s!==e.metricAccessor||!Object(U.a)(g,s))return null;const f=Object(b.htmlIdGenerator)()(),v=null==t?void 0:t.hasDefaultTimeField(),h=Boolean(e.metricAccessor&&(null==t||null===(c=t.getOperationForColumnId(e.metricAccessor))||void 0===c?void 0:c.hasReducedTimeRange)),y=Boolean(e.secondaryMetricAccessor&&(null==t||null===(d=t.getOperationForColumnId(e.secondaryMetricAccessor))||void 0===d?void 0:d.hasReducedTimeRange)),j=[],O=v&&!h&&!y;O||j.push(v?h?u.i18n.translate("xpack.lens.metric.supportingVis.metricHasReducedTimeRange",{defaultMessage:"Line visualizations cannot be used when a reduced time range is applied to the primary metric."}):y?u.i18n.translate("xpack.lens.metric.supportingVis.secondaryMetricHasReducedTimeRange",{defaultMessage:"Line visualizations cannot be used when a reduced time range is applied to the secondary metric."}):"":u.i18n.translate("xpack.lens.metric.supportingVis.needDefaultTimeField",{defaultMessage:"Line visualizations require use of a data view with a default time field."})),e.maxAccessor||j.push(u.i18n.translate("xpack.lens.metric.summportingVis.needMaxDimension",{defaultMessage:"Bar visualizations require a maximum value to be defined."}));const I=`${f}--`;return Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},Object(x.jsx)(b.EuiText,{size:"s",css:Object(x.css)("margin-bottom:",m.size.base,";","")},Object(x.jsx)("h4",null,u.i18n.translate("xpack.lens.metric.supportingVis.label",{defaultMessage:"Supporting visualization"}))),Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.metric.supportingVis.type",{defaultMessage:"Type"}),helpText:j.map((e=>Object(x.jsx)("p",null,e)))},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.supportingVis.type",{defaultMessage:"Type"}),"data-test-subj":"lnsMetric_supporting_visualization_buttons",options:[{id:`${I}none`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.none",{defaultMessage:"None"}),"data-test-subj":"lnsMetric_supporting_visualization_none"},{id:`${I}trendline`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.trendline",{defaultMessage:"Line"}),isDisabled:!O,"data-test-subj":"lnsMetric_supporting_visualization_trendline"},{id:`${I}bar`,label:u.i18n.translate("xpack.lens.metric.supportingVisualization.bar",{defaultMessage:"Bar"}),isDisabled:!e.maxAccessor,"data-test-subj":"lnsMetric_supporting_visualization_bar"}],idSelected:`${I}${e.trendlineLayerId?"trendline":rt(e)?"bar":"none"}`,onChange:t=>{switch(t.split("--")[1]){case"trendline":a({...e,showBar:!1}),n("metricTrendline");break;case"bar":a({...e,showBar:!0}),e.trendlineLayerId&&i(e.trendlineLayerId);break;case"none":a({...e,showBar:!1}),e.trendlineLayerId&&i(e.trendlineLayerId)}}})),rt(e)&&Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.progressDirectionLabel",{defaultMessage:"Bar orientation"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,buttonSize:"compressed",legend:u.i18n.translate("xpack.lens.metric.progressDirectionLabel",{defaultMessage:"Bar orientation"}),"data-test-subj":"lnsMetric_progress_direction_buttons",name:"alignment",options:[{id:`${f}vertical`,label:u.i18n.translate("xpack.lens.metric.progressDirection.vertical",{defaultMessage:"Vertical"}),"data-test-subj":"lnsMetric_progress_bar_vertical"},{id:`${f}horizontal`,label:u.i18n.translate("xpack.lens.metric.progressDirection.horizontal",{defaultMessage:"Horizontal"}),"data-test-subj":"lnsMetric_progress_bar_horizontal"}],idSelected:`${f}${null!==(p=e.progressDirection)&&void 0!==p?p:"vertical"}`,onChange:t=>{const n=t.replace(f,"");a({...e,progressDirection:n})}}))))}function at(e){const{state:t,setState:a}=e,n=Object(s.useCallback)((e=>a({...t,subtitle:e})),[a,t]),{inputValue:i,handleInputChange:l}=Object(Z.a)({onChange:n,value:t.subtitle||""},{allowFalsyValue:!0}),r=Boolean(t.breakdownByAccessor);return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},!r&&Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.metric.labels",{defaultMessage:"Labels"}),type:"labels",groupPosition:"none",buttonDataTestSubj:"lnsLabelsButton"},Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.metric.subtitleLabel",{defaultMessage:"Subtitle"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(b.EuiFieldText,{value:i,onChange:({target:{value:e}})=>l(e)}))))}var nt=a(76),it=a(35);var st=a(70);const lt=3,rt=e=>Boolean(e.showBar&&e.maxAccessor),ot=(e,t)=>rt(e)&&t?re.euiLightVars.euiColorPrimary:re.euiThemeVars.euiColorLightestShade,ut=new Set(["string","boolean","number","ip","date"]),ct=e=>!e.isBucketed&&ut.has(e.dataType),dt=e=>!e.isBucketed&&ut.has(e.dataType)&&!e.isStaticValue,pt=u.i18n.translate("xpack.lens.metric.label",{defaultMessage:"Metric"}),mt=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),gt=e=>{delete e.metricAccessor,delete e.palette,delete e.color},ft=e=>{delete e.secondaryMetricAccessor,delete e.secondaryPrefix},bt=e=>{delete e.maxAccessor,delete e.progressDirection,delete e.showBar},vt=e=>{delete e.breakdownByAccessor,delete e.collapseFn,delete e.maxCols},ht=({paletteService:e,theme:t})=>({id:Ae,visualizationTypes:[{id:Ae,icon:ce,label:pt,groupLabel:mt,showExperimentalBadge:!0,sortPriority:3}],getVisualizationTypeId:()=>Ae,clearLayer(e){const t={...e};return delete t.subtitle,gt(t),ft(t),bt(t),vt(t),t},getLayerIds:e=>e.trendlineLayerId?[e.layerId,e.trendlineLayerId]:[e.layerId],getDescription:()=>({icon:ce,label:pt}),getSuggestions:_e,initialize:(e,t,a)=>null!=t?t:{layerId:e(),layerType:Pe.a.DATA,palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0},triggers:[N.VIS_EVENT_TO_TRIGGER.filter],getConfiguration:e=>e.layerId===e.state.layerId?(e=>{var t;const a=null===(t=e.frame.activeData)||void 0===t?void 0:t[e.state.layerId],n=Boolean(e.state.metricAccessor&&Object(U.a)(a,e.state.metricAccessor));return{groups:[{groupId:Le,dataTestSubj:"lnsMetric_primaryMetricDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.metricAccessor?[{columnId:e.state.metricAccessor,...(()=>{var t,a,i;const s=Boolean(n&&e.state.palette),l=(null===(t=e.state.palette)||void 0===t||null===(a=t.params)||void 0===a?void 0:a.stops)||[];return s?{triggerIconType:"colorBy",palette:l.map((({color:e})=>e))}:{triggerIconType:"color",color:null!==(i=e.state.color)&&void 0!==i?i:ot(e.state,n)}})()}]:[],supportsMoreColumns:!e.state.metricAccessor,filterOperations:dt,isMetricDimension:!0,enableDimensionEditor:!0,enableFormatSelector:!0,requiredMinDimensionCount:1},{groupId:De,dataTestSubj:"lnsMetric_secondaryMetricDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.secondaryMetricAccessor?[{columnId:e.state.secondaryMetricAccessor}]:[],supportsMoreColumns:!e.state.secondaryMetricAccessor,filterOperations:dt,isMetricDimension:!0,enableDimensionEditor:!0,enableFormatSelector:!0},{groupId:"max",dataTestSubj:"lnsMetric_maxDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.max",{defaultMessage:"Maximum value"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.primaryMetric.headingLabel",{defaultMessage:"Value"})},accessors:e.state.maxAccessor?[{columnId:e.state.maxAccessor}]:[],isHidden:!e.state.maxAccessor&&!n,supportsMoreColumns:!e.state.maxAccessor,filterOperations:ct,enableDimensionEditor:!0,enableFormatSelector:!1,supportStaticValue:!0,prioritizedOperation:"max",groupTooltip:u.i18n.translate("xpack.lens.metric.maxTooltip",{defaultMessage:"If the maximum value is specified, the minimum value is fixed at zero."})},{groupId:Re,dataTestSubj:"lnsMetric_breakdownByDimensionPanel",groupLabel:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),accessors:e.state.breakdownByAccessor?[{columnId:e.state.breakdownByAccessor,triggerIconType:e.state.collapseFn?"aggregate":void 0}]:[],supportsMoreColumns:!e.state.breakdownByAccessor,filterOperations:e=>e.isBucketed,enableDimensionEditor:!0,enableFormatSelector:!0}]}})(e):(e=>({hidden:!0,groups:[{groupId:Be,groupLabel:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),accessors:e.state.trendlineMetricAccessor?[{columnId:e.state.trendlineMetricAccessor}]:[],supportsMoreColumns:!e.state.trendlineMetricAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:3},{groupId:Ne,groupLabel:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),accessors:e.state.trendlineSecondaryMetricAccessor?[{columnId:e.state.trendlineSecondaryMetricAccessor}]:[],supportsMoreColumns:!e.state.trendlineSecondaryMetricAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:2},{groupId:ze,groupLabel:u.i18n.translate("xpack.lens.metric.timeField",{defaultMessage:"Time field"}),accessors:e.state.trendlineTimeAccessor?[{columnId:e.state.trendlineTimeAccessor}]:[],supportsMoreColumns:!e.state.trendlineTimeAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:1},{groupId:Ve,groupLabel:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),accessors:e.state.trendlineBreakdownByAccessor?[{columnId:e.state.trendlineBreakdownByAccessor}]:[],supportsMoreColumns:!e.state.trendlineBreakdownByAccessor,filterOperations:()=>!1,hideGrouping:!0,nestingOrder:0}]}))(e),getLayerType:(e,t)=>(null==t?void 0:t.layerId)===e?t.layerType:(null==t?void 0:t.trendlineLayerId)===e?t.trendlineLayerType:void 0,getSupportedLayers:e=>[{type:Pe.a.DATA,label:u.i18n.translate("xpack.lens.metric.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"max",columnId:Object(nt.a)(),staticValue:0}]:void 0,disabled:!0},{type:Pe.a.METRIC_TRENDLINE,label:u.i18n.translate("xpack.lens.metric.layerType.trendLine",{defaultMessage:"Trendline"}),initialDimensions:[{groupId:ze,columnId:Object(nt.a)(),autoTimeField:!0}],disabled:Boolean(null==e?void 0:e.trendlineLayerId)}],appendLayer(e,t,a){if(a!==Pe.a.METRIC_TRENDLINE)throw new Error(`Metric vis only supports layers of type ${Pe.a.METRIC_TRENDLINE}!`);return{...e,trendlineLayerId:t,trendlineLayerType:a}},removeLayer:(e,t)=>({...e,...e.layerId===t&&{metricAccessor:void 0},trendlineLayerId:void 0,trendlineLayerType:void 0,trendlineMetricAccessor:void 0,trendlineTimeAccessor:void 0,trendlineBreakdownByAccessor:void 0}),getRemoveOperation:(e,t)=>t===e.trendlineLayerId?"remove":"clear",getLayersToLinkTo:(e,t)=>t===e.trendlineLayerId?[e.layerId]:[],getLinkedDimensions(e){if(!e.trendlineLayerId)return[];const t=[];return e.metricAccessor&&t.push({from:{columnId:e.metricAccessor,groupId:Le,layerId:e.layerId},to:{columnId:e.trendlineMetricAccessor,groupId:Be,layerId:e.trendlineLayerId}}),e.secondaryMetricAccessor&&t.push({from:{columnId:e.secondaryMetricAccessor,groupId:De,layerId:e.layerId},to:{columnId:e.trendlineSecondaryMetricAccessor,groupId:Ne,layerId:e.trendlineLayerId}}),e.breakdownByAccessor&&t.push({from:{columnId:e.breakdownByAccessor,groupId:Re,layerId:e.layerId},to:{columnId:e.trendlineBreakdownByAccessor,groupId:Ve,layerId:e.trendlineLayerId}}),t},getLayersToRemoveOnIndexPatternChange:e=>e.trendlineLayerId?[e.trendlineLayerId]:[],toExpression:(t,a,n,i)=>((e,t,a,n={})=>{var i,s,l,r,o;if(!t.metricAccessor)return null;const u=a[t.layerId],c=n[t.layerId],d=Boolean(t.metricAccessor&&"number"===(null==u||null===(i=u.getOperationForColumnId(t.metricAccessor))||void 0===i?void 0:i.dataType)),p=t.breakdownByAccessor&&!t.collapseFn?null==u?void 0:u.getMaxPossibleNumValues(t.breakdownByAccessor):null,g=t.collapseFn?Object(V.buildExpressionFunction)("lens_collapse",(()=>{const e=[t.metricAccessor,t.secondaryMetricAccessor,t.maxAccessor].filter(Boolean),a=t.collapseFn,n=e.map((e=>{return e!==t.maxAccessor?a:Boolean(null==u||null===(n=u.getOperationForColumnId(t.maxAccessor))||void 0===n?void 0:n.isStaticValue)?"max":a;var n}));return{by:[],metric:e,fn:n}})()).toAst():void 0,f=((e,t)=>{const{trendlineLayerId:a,trendlineMetricAccessor:n,trendlineTimeAccessor:i}=e;if(!a||!n||!i)return;const s=t[a];if(!s)return;const l=Object(V.buildExpressionFunction)("metricTrendline",{metric:n,timeField:i,breakdownBy:e.trendlineBreakdownByAccessor&&!e.collapseFn?e.trendlineBreakdownByAccessor:void 0,inspectorTableId:a,table:[{...s,chain:[...s.chain,...e.collapseFn?[Object(V.buildExpressionFunction)("lens_collapse",{by:[i],metric:[n],fn:[e.collapseFn]}).toAst()]:[]]}]});return Object(V.buildExpression)([l]).toAst()})(t,n),b=Object(V.buildExpressionFunction)("metricVis",{metric:t.metricAccessor,secondaryMetric:t.secondaryMetricAccessor,secondaryPrefix:t.secondaryPrefix,max:t.maxAccessor,breakdownBy:t.breakdownByAccessor&&!t.collapseFn?t.breakdownByAccessor:void 0,trendline:f?[f]:[],subtitle:null!==(s=t.subtitle)&&void 0!==s?s:void 0,progressDirection:rt(t)?t.progressDirection||it.LayoutDirection.Vertical:void 0,color:t.color||ot(t,d),icon:t.icon,palette:d&&null!==(l=t.palette)&&void 0!==l&&l.params?[e.get(m.a).toExpression((v=t.palette.params,{...v,colors:((null==v?void 0:v.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==v?void 0:v.name)?((null==v?void 0:v.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}))]:[],maxCols:null!==(r=t.maxCols)&&void 0!==r?r:lt,minTiles:null!=p?p:void 0,inspectorTableId:t.layerId});var v;return{type:"expression",chain:[...null!==(o=null==c?void 0:c.chain)&&void 0!==o?o:[],...g?[g]:[],b.toAst()]}})(e,t,a,i),setDimension({prevState:e,columnId:t,groupId:a}){const n={...e};switch(a){case Le:n.metricAccessor=t;break;case De:n.secondaryMetricAccessor=t;break;case"max":n.maxAccessor=t,e.trendlineLayerId||(n.showBar=!0);break;case Re:n.breakdownByAccessor=t;break;case ze:n.trendlineTimeAccessor=t;break;case Be:n.trendlineMetricAccessor=t;break;case Ne:n.trendlineSecondaryMetricAccessor=t;break;case Ve:n.trendlineBreakdownByAccessor=t}return n},removeDimension({prevState:e,columnId:t}){const a={...e};return e.metricAccessor===t&&gt(a),e.secondaryMetricAccessor===t&&ft(a),e.maxAccessor===t&&bt(a),e.breakdownByAccessor===t&&vt(a),e.trendlineTimeAccessor===t&&delete a.trendlineTimeAccessor,e.trendlineMetricAccessor===t&&delete a.trendlineMetricAccessor,e.trendlineSecondaryMetricAccessor===t&&delete a.trendlineSecondaryMetricAccessor,e.trendlineBreakdownByAccessor===t&&delete a.trendlineBreakdownByAccessor,a},ToolbarComponent:e=>Object(x.jsx)(at,e),DimensionEditorComponent:t=>Object(x.jsx)(Ye,i()({},t,{paletteService:e})),DimensionEditorAdditionalSectionComponent:e=>Object(x.jsx)(tt,e),getDisplayOptions:()=>({noPanelTitle:!1,noPadding:!0}),getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(e,t){var a,n,i;const s=[];e.metricAccessor&&s.push({id:e.metricAccessor,name:u.i18n.translate("xpack.lens.primaryMetric.label",{defaultMessage:"Primary metric"}),dimensionType:"primary_metric"}),e.secondaryMetricAccessor&&s.push({id:e.secondaryMetricAccessor,name:u.i18n.translate("xpack.lens.metric.secondaryMetric",{defaultMessage:"Secondary metric"}),dimensionType:"secondary_metric"}),e.maxAccessor&&s.push({id:e.maxAccessor,name:u.i18n.translate("xpack.lens.metric.max",{defaultMessage:"Maximum value"}),dimensionType:"max"}),e.breakdownByAccessor&&s.push({id:e.breakdownByAccessor,name:u.i18n.translate("xpack.lens.metric.breakdownBy",{defaultMessage:"Break down by"}),dimensionType:"breakdown"});const l=(null===(a=e.palette)||void 0===a||null===(n=a.params)||void 0===n?void 0:n.stops)||[],r=!!e.color,o=!!e.palette,c=null==t||null===(i=t.activeData)||void 0===i?void 0:i[e.layerId],d=Boolean(e.metricAccessor&&Object(U.a)(c,e.metricAccessor));return{layers:[{layerId:e.layerId,layerType:e.layerType,chartType:"metric",...this.getDescription(e),dimensions:s,palette:(o?l.map((({color:e})=>e)):r?[e.color]:[ot(e,d)]).filter(st.nonNullable)}]}},getUserMessages(e,{frame:t}){var a;const n=null===(a=t.activeData)||void 0===a?void 0:a[e.layerId],i=[];return e.maxAccessor&&Boolean(e.metricAccessor&&!Object(U.a)(n,e.metricAccessor))&&i.push({severity:"error",fixableInEditor:!0,displayLocations:[{id:"dimensionButton",dimensionId:e.maxAccessor}],shortMessage:u.i18n.translate("xpack.lens.lnsMetric_maxDimensionPanel.nonNumericError",{defaultMessage:"Primary metric must be numeric to set a maximum value."}),longMessage:""}),i}});class MetricVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getMetricVisualization:t}=await Promise.resolve().then(a.bind(null,558));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var xt=a(239),yt=a(33);const jt=2;let Ot;!function(e){e[e.SMALL=.3]="SMALL",e[e.MEDIUM=.54]="MEDIUM",e[e.LARGE=.7]="LARGE"}(Ot||(Ot={}));var It=a(3);const kt=u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"}),Tt=[{value:It.CategoryDisplay.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showCategoriesLabel",{defaultMessage:"Inside or outside"})},{value:It.CategoryDisplay.INSIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.fitInsideOnlyLabel",{defaultMessage:"Inside only"})},{value:It.CategoryDisplay.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],Mt=[{value:It.CategoryDisplay.DEFAULT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showTreemapCategoriesLabel",{defaultMessage:"Show labels"})},{value:It.CategoryDisplay.HIDE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.categoriesInLegendLabel",{defaultMessage:"Hide labels"})}],wt=[{value:It.NumberDisplay.HIDDEN,inputDisplay:u.i18n.translate("xpack.lens.pieChart.hiddenNumbersLabel",{defaultMessage:"Hide from chart"})},{value:It.NumberDisplay.PERCENT,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showPercentValuesLabel",{defaultMessage:"Show percent"})},{value:It.NumberDisplay.VALUE,inputDisplay:u.i18n.translate("xpack.lens.pieChart.showFormatterValuesLabel",{defaultMessage:"Show value"})}],Ct=[{id:"emptySizeRatioOption-small",value:Ot.SMALL,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.small",{defaultMessage:"Small"})},{id:"emptySizeRatioOption-medium",value:Ot.MEDIUM,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.medium",{defaultMessage:"Medium"})},{id:"emptySizeRatioOption-large",value:Ot.LARGE,label:u.i18n.translate("xpack.lens.pieChart.emptySizeRatioOptions.large",{defaultMessage:"Large"})}],Et={donut:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M19.21 21.119a11 11 0 006.595-8.1c.11-.577-.355-1.082-.942-1.082H20.75c-.477 0-.878.342-1.046.788a5.028 5.028 0 11-6.474-6.474c.447-.168.788-.569.788-1.046V1.094c0-.588-.505-1.053-1.082-.943a11 11 0 106.272 20.968h.002z",className:h.a.subdued}),Object(x.jsx)("path",{d:"M22.778 3.176A11 11 0 0017.084.154C16.507.042 16 .507 16 1.095v4.116c0 .475.34.875.784 1.044l.14.055A5.026 5.026 0 0119.7 9.17c.168.445.568.784 1.044.784h4.115c.588 0 1.053-.506.942-1.084a11 11 0 00-3.023-5.694z",className:h.a.accent})),label:u.i18n.translate("xpack.lens.pie.donutLabel",{defaultMessage:"Donut"}),groupLabel:kt,maxBuckets:3,toolbarPopover:{categoryOptions:Tt,numberOptions:wt,emptySizeRatioOptions:Ct},legend:{getShowLegendDefault:e=>e.length>1}},pie:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M17.827 21.189a10.001 10.001 0 005.952-7.148c.124-.578-.343-1.091-.935-1.091H14a1 1 0 01-1-1V3.106c0-.592-.513-1.059-1.092-.935a10 10 0 105.919 19.018z",className:h.a.subdued}),Object(x.jsx)("path",{d:"M22.462 3.538A12.29 12.29 0 0016.094.16C15.512.048 15 .514 15 1.106V10a1 1 0 001 1h8.895c.591 0 1.057-.512.945-1.094a12.288 12.288 0 00-3.378-6.368z",className:h.a.accent})),label:u.i18n.translate("xpack.lens.pie.pielabel",{defaultMessage:"Pie"}),groupLabel:kt,maxBuckets:3,toolbarPopover:{categoryOptions:Tt,numberOptions:wt},legend:{getShowLegendDefault:e=>e.length>1}},treemap:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M0 1a1 1 0 011-1h13a1 1 0 011 1v20a1 1 0 01-1 1H1a1 1 0 01-1-1V1z",className:h.a.subdued}),Object(x.jsx)("path",{d:"M17 1a1 1 0 011-1h11a1 1 0 011 1v12a1 1 0 01-1 1H18a1 1 0 01-1-1V1z",className:h.a.accent}),Object(x.jsx)("path",{d:"M29 16H18a1 1 0 00-1 1v4a1 1 0 001 1h11a1 1 0 001-1v-4a1 1 0 00-1-1z",className:h.a.subdued})),label:u.i18n.translate("xpack.lens.pie.treemaplabel",{defaultMessage:"Treemap"}),groupLabel:kt,maxBuckets:2,toolbarPopover:{categoryOptions:Mt,numberOptions:wt},legend:{getShowLegendDefault:()=>!1}},mosaic:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t}):null,Object(x.jsx)("path",{className:h.a.subdued,d:"M2 0a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1H2zM2 14a1 1 0 00-1 1v6a1 1 0 001 1h6a1 1 0 001-1v-6a1 1 0 00-1-1H2zM11 13a1 1 0 011-1h6a1 1 0 011 1v8a1 1 0 01-1 1h-6a1 1 0 01-1-1v-8zM12 0a1 1 0 100 2h6a1 1 0 100-2h-6zM21 15a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1h-6a1 1 0 01-1-1v-6zM22 0a1 1 0 00-1 1v4a1 1 0 001 1h6a1 1 0 001-1V1a1 1 0 00-1-1h-6z"}),Object(x.jsx)("path",{className:h.a.accent,d:"M11 5a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1h-6a1 1 0 01-1-1V5zM1 7a1 1 0 011-1h6a1 1 0 011 1v4a1 1 0 01-1 1H2a1 1 0 01-1-1V7zM22 8a1 1 0 00-1 1v2a1 1 0 001 1h6a1 1 0 001-1V9a1 1 0 00-1-1h-6z"})),label:u.i18n.translate("xpack.lens.pie.mosaiclabel",{defaultMessage:"Mosaic"}),groupLabel:kt,maxBuckets:2,toolbarPopover:{categoryOptions:[],numberOptions:wt},legend:{getShowLegendDefault:()=>!1}},waffle:{icon:({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t}):null,Object(x.jsx)("path",{className:h.a.accent,d:"M16 1a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V1zM4 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM17 6a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V7a1 1 0 00-1-1h-2zM23 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM5 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1H5zM4 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V7zM11 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V1a1 1 0 00-1-1h-2zM10 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7zM11 12a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM22 7a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1V7z"}),Object(x.jsx)("path",{className:h.a.subdued,d:"M22 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM4 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1v-2zM16 19a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2zM11 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM23 18a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2zM16 13a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2z"})),label:u.i18n.translate("xpack.lens.pie.wafflelabel",{defaultMessage:"Waffle"}),groupLabel:kt,maxBuckets:1,toolbarPopover:{isDisabled:!0,categoryOptions:[],numberOptions:[]},legend:{flat:!0,showValues:!0,hideNestedLegendSwitch:!0,getShowLegendDefault:()=>!0}}},St=(e,t)=>{var a,n,i,s,l;return"showValues"in(null===(a=Et[t])||void 0===a?void 0:a.legend)&&(null===(n=null!==(i=e.showValuesInLegend)&&void 0!==i?i:null===(s=Et[t])||void 0===s||null===(l=s.legend)||void 0===l?void 0:l.showValues)||void 0===n||n)},Ft=(e,t,a)=>{const n=e.rows.reduce(((e,a)=>Number(a[t])+e),0);return e.rows.some((e=>e[t]/n*100<a))};function Pt(e,t,a){return 0===a?{...e,...t}:{...t,...e}}function _t(e,t){const a={truncateText:!0};return e?function(e){return"layerId"in e}(e)?Object.values((null===(n=t[e.layerId])||void 0===n?void 0:n.getVisualDefaults())||{}).reduce(Pt,a):e.layers.flatMap((({layerId:e})=>{var a;return Object.values((null===(a=t[e])||void 0===a?void 0:a.getVisualDefaults())||{})})).reduce(Pt,a):a;var n}const At=(e,t)=>{const a={};return e.forEach((e=>{const n=null==t?void 0:t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a},Lt=(e,t,a)=>{var n;const i=null==e?void 0:e.getTableSpec().map((({columnId:e})=>e)).filter((e=>{var n;return null===(n=t[a])||void 0===n?void 0:n.includes(e)}));return Array.from(new Set(null==i?void 0:i.concat(null!==(n=t[a])&&void 0!==n?n:[])))},Dt=e=>Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("visdimension",{accessor:e})]).toAst(),Rt=(e,t,a,n)=>{var i;const s=!t.isPreview&&a.categoryDisplay!==It.CategoryDisplay.HIDE,l=a.categoryDisplay!==It.CategoryDisplay.HIDE?a.categoryDisplay:[],r=a.numberDisplay!==It.NumberDisplay.HIDDEN,o=a.numberDisplay!==It.NumberDisplay.HIDDEN?a.numberDisplay:[],u=null!==(i=a.percentDecimals)&&void 0!==i?i:jt,c=a.allowMultipleMetrics&&!ya(a)?Object.entries(n).reduce(((e,[t,n])=>{var i;const s=null===(i=a.colorsByDimension)||void 0===i?void 0:i[t];return s&&(e[n]=s),e}),{}):{},d=Object(yt.buildExpressionFunction)("partitionLabels",{show:s,position:l,values:r,valuesFormat:o,percentDecimals:u,colorOverrides:JSON.stringify(c)});return[Object(yt.buildExpression)([d]).toAst()]},Bt=(...e)=>{const[t]=Rt(...e),[a]=t.chain;return[{...t,chain:[{...a,percentDecimals:jt}]}]},Nt=(e,t)=>t?[Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("theme",{variable:"palette",default:e.get(t.name).toExpression(t.params)})]).toAst()]:[e.get("default").toExpression()],zt=(e,t,a,n,i,s)=>{var l,r,o,u;const c=i[n.layerId],d=At(n.metrics,c),p=Lt(c,n,"metrics");return{labels:Rt(0,t,n,d),buckets:a.filter((({columnId:e})=>!xa(e,n))).map((({columnId:e})=>e)).map(Dt),metrics:(n.allowMultipleMetrics?p:[p[0]]).map(Dt),metricsToLabels:JSON.stringify(d),legendDisplay:t.isPreview?It.LegendDisplay.HIDE:n.legendDisplay,legendPosition:n.legendPosition||it.Position.Right,maxLegendLines:null!==(l=n.legendMaxLines)&&void 0!==l?l:1,legendSize:n.legendSize,nestedLegend:n.primaryGroups.length+(null!==(r=null===(o=n.secondaryGroups)||void 0===o?void 0:o.length)&&void 0!==r?r:0)>1&&Boolean(n.nestedLegend),truncateLegend:null!==(u=n.truncateLegend)&&void 0!==u?u:_t(e,i).truncateText,palette:Nt(s,e.palette),addTooltip:!0,colorMapping:n.colorMapping?JSON.stringify(n.colorMapping):void 0}},Vt=(e,...t)=>({[It.PieChartTypes.PIE]:()=>((...e)=>Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("pieVis",{...zt(...e),respectSourceOrder:!1,startFromSecondLargestSlice:!0,isDonut:!1})]).toAst())(e,...t),[It.PieChartTypes.DONUT]:()=>((...e)=>{var t;const[,,,a]=e;return Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("pieVis",{...zt(...e),respectSourceOrder:!1,isDonut:!0,startFromSecondLargestSlice:!0,emptySizeRatio:null!==(t=a.emptySizeRatio)&&void 0!==t?t:Ot.SMALL})]).toAst()})(e,...t),[It.PieChartTypes.TREEMAP]:()=>((...e)=>{const[,,,t]=e;return Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("treemapVis",{...zt(...e),nestedLegend:!!t.nestedLegend})]).toAst()})(e,...t),[It.PieChartTypes.MOSAIC]:()=>((...e)=>{const{metrics:t,...a}=zt(...e);return Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("mosaicVis",{...{...a,metricsToLabels:void 0},metric:t,buckets:e[2].filter((({columnId:t})=>!xa(t,e[3]))).reverse().map((e=>e.columnId)).map(Dt)})]).toAst()})(e,...t),[It.PieChartTypes.WAFFLE]:()=>((...e)=>{const{buckets:t,nestedLegend:a,...n}=zt(...e),[i,s,,l,r]=e;return Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("waffleVis",{...n,bucket:t,labels:Bt(i,s,l,At(l.metrics,r[l.layerId])),showValuesInLegend:St(l,i.shape)})]).toAst()})(e,...t)}[e.shape]());function Gt(e,t,a,n={isPreview:!1},i){const s=e.layers[0],l=t[s.layerId],r=Array.from(new Set([Lt(l,s,"primaryGroups"),s.secondaryGroups?Lt(l,s,"secondaryGroups"):[]].flat())),o=r.map((e=>({columnId:e,operation:null==l?void 0:l.getOperationForColumnId(e)}))).filter((e=>!!e.operation));if(!s.metrics.length)return null;const u=Vt(e,n,o,s,t,a),c=i[s.layerId];return{type:"expression",chain:[...c?c.chain:[],...r.filter((e=>{var t;return null===(t=s.collapseFns)||void 0===t?void 0:t[e]})).map((e=>Object(yt.buildExpressionFunction)("lens_collapse",{by:r.filter((t=>t!==e)),metric:s.metrics,fn:[s.collapseFns[e]]}).toAst())),...u?u.chain:[]]}}var qt=a(27);const Ht=e=>["donut","pie","treemap","mosaic","waffle"].includes(e);var Ut=a(24);function $t(e){return e.some((e=>"interval"===e.operation.scale))}function Wt(e){const t=[It.PieChartTypes.TREEMAP,It.PieChartTypes.WAFFLE,It.PieChartTypes.MOSAIC];return!!e&&t.includes(e)}const Xt=Math.max(...Object.values(Et).map((({maxBuckets:e})=>e)));function Yt({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(function({table:e,keptLayerIds:t,state:a}){return t.length>1||t.length&&e.layerId!==t[0]||"reorder"===e.changeType||e.columns.some((e=>e.operation.isStaticValue))}({table:e,state:t,keptLayerIds:a}))return[];const s=Boolean(t),[l,r]=Object(qt.partition)(e.columns.filter((e=>e.operation.isBucketed||"number"===e.operation.dataType)),(e=>e.operation.isBucketed));if(0===l.length&&0===r.length)return[];if(r.length>1&&!s||l.length>Xt)return[];if(r.length>1&&(null==t||!t.layers[0].allowMultipleMetrics))return[];const o=0===r.length||0===l.length;if(o&&t&&!i)return[];const c=r.map((({columnId:e})=>e)),d=[],p=(null==t||!t.shape||!Ht(t.shape))&&$t(e.columns);if(l.length<=Et.pie.maxBuckets&&!Wt(i)){const a=function(e,t){var a;if(t)return t;let n;return 1===e.length||t||(n=It.PieChartTypes.PIE),null!==(a=n)&&void 0!==a?a:It.PieChartTypes.DONUT}(l,i),s={title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"{chartName}",values:{chartName:Et[a].label},description:"chartName is already translated"}),score:t&&!Wt(t.shape)?.6:.4,state:{shape:a,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,layerType:Ut.layerTypes.DATA,colorMapping:n?"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping:Object(st.getColorMappingDefaults)()}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:It.NumberDisplay.PERCENT,categoryDisplay:It.CategoryDisplay.DEFAULT,legendDisplay:It.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:Ut.layerTypes.DATA,colorMapping:n?"colorMapping"===(null==n?void 0:n.type)?n.value:void 0:Object(st.getColorMappingDefaults)()}]},previewIcon:Et[a].icon,hide:"reduced"===e.changeType||$t(l)||t&&!Wt(t.shape)};d.push(s),d.push({...s,title:u.i18n.translate("xpack.lens.pie.suggestionLabel",{defaultMessage:"{chartName}",values:{chartName:Et[a===It.PieChartTypes.PIE?It.PieChartTypes.DONUT:It.PieChartTypes.PIE].label},description:"chartName is already translated"}),score:.1,state:{...s.state,shape:a===It.PieChartTypes.PIE?It.PieChartTypes.DONUT:It.PieChartTypes.PIE},hide:!0})}return l.length<=Et.treemap.maxBuckets&&(!i||i===It.PieChartTypes.TREEMAP)&&d.push({title:u.i18n.translate("xpack.lens.pie.treemapSuggestionLabel",{defaultMessage:"Treemap"}),score:(null==t?void 0:t.shape)===It.PieChartTypes.TREEMAP?.7:.5,state:{shape:It.PieChartTypes.TREEMAP,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,categoryDisplay:t.layers[0].categoryDisplay===It.CategoryDisplay.INSIDE?It.CategoryDisplay.DEFAULT:t.layers[0].categoryDisplay,layerType:Ut.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:It.NumberDisplay.PERCENT,categoryDisplay:It.CategoryDisplay.DEFAULT,legendDisplay:It.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:Ut.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:void 0}]},previewIcon:Et.treemap.icon,hide:"reduced"===e.changeType||!t||$t(l)||t&&t.shape===It.PieChartTypes.TREEMAP}),l.length<=Et.mosaic.maxBuckets&&(!i||i===It.PieChartTypes.MOSAIC)&&d.push({title:u.i18n.translate("xpack.lens.pie.mosaicSuggestionLabel",{defaultMessage:"Mosaic"}),score:(null==t?void 0:t.shape)===It.PieChartTypes.MOSAIC?.7:.5,state:{shape:It.PieChartTypes.MOSAIC,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l[0]?[l[0].columnId]:[],secondaryGroups:l[1]?[l[1].columnId]:[],metrics:c,categoryDisplay:It.CategoryDisplay.DEFAULT,layerType:Ut.layerTypes.DATA,allowMultipleMetrics:!1,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping}:{layerId:e.layerId,primaryGroups:l[0]?[l[0].columnId]:[],secondaryGroups:l[1]?[l[1].columnId]:[],metrics:c,numberDisplay:It.NumberDisplay.PERCENT,categoryDisplay:It.CategoryDisplay.DEFAULT,legendDisplay:It.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:Ut.layerTypes.DATA,allowMultipleMetrics:!1,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:void 0}]},previewIcon:Et.mosaic.icon,hide:2!==l.length||"reduced"===e.changeType||$t(l)||t&&"mosaic"===t.shape}),l.length<=Et.waffle.maxBuckets&&(!i||i===It.PieChartTypes.WAFFLE)&&d.push({title:u.i18n.translate("xpack.lens.pie.waffleSuggestionLabel",{defaultMessage:"Waffle"}),score:(null==t?void 0:t.shape)===It.PieChartTypes.WAFFLE?.7:.4,state:{shape:It.PieChartTypes.WAFFLE,palette:"legacyPalette"===(null==n?void 0:n.type)?n.value:null==t?void 0:t.palette,layers:[null!=t&&t.layers[0]?{...t.layers[0],layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,secondaryGroups:[],categoryDisplay:It.CategoryDisplay.DEFAULT,layerType:Ut.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:t.layers[0].colorMapping}:{layerId:e.layerId,primaryGroups:l.map((e=>e.columnId)),metrics:c,numberDisplay:It.NumberDisplay.PERCENT,categoryDisplay:It.CategoryDisplay.DEFAULT,legendDisplay:It.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:Ut.layerTypes.DATA,colorMapping:"colorMapping"===(null==n?void 0:n.type)?n.value:void 0}]},previewIcon:Et.waffle.icon,hide:1!==l.length||"reduced"===e.changeType||$t(l)||t&&"waffle"===t.shape}),[...d].map((e=>({...e,score:p?0:e.score+.05*l.length+.01*c.length}))).sort(((e,t)=>t.score-e.score)).map((e=>({...e,hide:p||o||e.hide,incomplete:o})))}a(155);const Qt=[{id:"pieLegendDisplay-default",value:It.LegendDisplay.DEFAULT,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"pieLegendDisplay-show",value:It.LegendDisplay.SHOW,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"pieLegendDisplay-hide",value:It.LegendDisplay.HIDE,label:u.i18n.translate("xpack.lens.pieChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Kt=u.i18n.translate("xpack.lens.pieChart.emptySizeRatioLabel",{defaultMessage:"Inner area size"});function Zt(e){var t,a,n,i,l,r,o,c,d;const{state:p,setState:m,frame:g}=e,f=p.layers[0],{categoryOptions:v,numberOptions:h,emptySizeRatioOptions:y,isDisabled:j}=Et[p.shape].toolbarPopover,O=f.legendSize,[I]=Object(s.useState)((()=>O===N.LegendSize.AUTO)),T=Object(s.useCallback)((e=>{m({...p,layers:[{...f,...e}]})}),[f,p,m]),M=Object(s.useCallback)((e=>T({categoryDisplay:e})),[T]),w=Object(s.useCallback)((e=>T({numberDisplay:e})),[T]),C=Object(s.useCallback)((e=>{T({percentDecimals:e})}),[T]),E=Object(s.useCallback)((e=>{T({legendDisplay:Qt.find((({id:t})=>t===e)).value})}),[T]),S=Object(s.useCallback)((e=>T({legendPosition:e})),[T]),F=Object(s.useCallback)((e=>T({nestedLegend:!f.nestedLegend})),[f,T]),P=Object(s.useCallback)((()=>{var e;const t=null===(e=f.truncateLegend)||void 0===e||e;T({truncateLegend:!t})}),[f,T]),_=Object(s.useCallback)((e=>T({legendMaxLines:e})),[T]),A=Object(s.useCallback)((e=>T({legendSize:e})),[T]),L=Object(s.useCallback)((()=>{T({showValuesInLegend:!St(f,p.shape)})}),[f,p.shape,T]),D=Object(s.useCallback)((e=>{var t;const a=null==y||null===(t=y.find((({id:t})=>t===e)))||void 0===t?void 0:t.value;T({emptySizeRatio:a})}),[y,T]);if(!f)return null;const R=_t(p,g.datasourceLayers).truncateText;return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.pieChart.valuesLabel",{defaultMessage:"Labels"}),isDisabled:Boolean(j),type:"labels",groupPosition:"left",buttonDataTestSubj:"lnsLabelsButton"},v.length?Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.labelPositionLabel",{defaultMessage:"Position"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(b.EuiSuperSelect,{compressed:!0,valueOfSelected:f.categoryDisplay,options:v,onChange:M})):null,h.length&&"hide"!==f.categoryDisplay?Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.numberLabels",{defaultMessage:"Values"}),fullWidth:!0,display:"columnCompressed"},Object(x.jsx)(b.EuiSuperSelect,{compressed:!0,valueOfSelected:f.numberDisplay,options:h,onChange:w})):null,h.length+v.length?Object(x.jsx)(b.EuiHorizontalRule,{margin:"s"}):null,Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.pieChart.percentDecimalsLabel",{defaultMessage:"Maximum decimal places for percent"}),fullWidth:!0,display:"rowCompressed"},Object(x.jsx)(Jt,{value:null!==(t=f.percentDecimals)&&void 0!==t?t:jt,setValue:C}))),null!=y&&y.length?Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.pieChart.visualOptionsLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"center",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(b.EuiFormRow,{label:Kt,display:"columnCompressed",fullWidth:!0},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,name:"emptySizeRatio",buttonSize:"compressed",legend:Kt,options:y,idSelected:null!==(a=null===(n=y.find((({value:e})=>e===f.emptySizeRatio)))||void 0===n?void 0:n.id)&&void 0!==a?a:"emptySizeRatioOption-small",onChange:D,"data-test-subj":"lnsEmptySizeRatioButtonGroup"}))):null,Object(x.jsx)(k.e,{legendOptions:Qt,mode:f.legendDisplay,onDisplayChange:E,valueInLegend:St(f,p.shape),renderValueInLegendSwitch:null!==(i="showValues"in(null===(l=Et[p.shape])||void 0===l?void 0:l.legend))&&void 0!==i&&i,onValueInLegendChange:L,position:f.legendPosition,onPositionChange:S,renderNestedLegendSwitch:!(null!==(r=Et[p.shape])&&void 0!==r&&r.legend.hideNestedLegendSwitch)&&f.primaryGroups.length+(null!==(o=null===(c=f.secondaryGroups)||void 0===c?void 0:c.length)&&void 0!==o?o:0)>1,nestedLegend:Boolean(f.nestedLegend),onNestedLegendChange:F,shouldTruncate:null!==(d=f.truncateLegend)&&void 0!==d?d:R,onTruncateLegendChange:P,maxLines:null==f?void 0:f.legendMaxLines,onMaxLinesChange:_,legendSize:O,onLegendSizeChange:A,showAutoLegendSizeOption:I}))}const Jt=({value:e,setValue:t})=>{const{inputValue:a,handleInputChange:n}=Object(Z.a)({value:e,onChange:t},{allowFalsyValue:!0});return Object(x.jsx)(b.EuiRange,{"data-test-subj":"indexPattern-dimension-formatDecimals",value:a,min:0,max:10,showInput:!0,compressed:!0,onChange:e=>{n(Number(e.currentTarget.value))}})};var ea=a(1),ta=a.n(ea),aa=a(34),na=a(39),ia=a(90),sa=a(181),la=a(125);class categorical_color_mapping_CategoricalColorMapping extends l.a.Component{constructor(e){super(e),ta()(this,"store",void 0),ta()(this,"unsubscribe",void 0),this.store=Object(na.configureStore)({preloadedState:{colorMapping:e.model},reducer:{colorMapping:ia.f,ui:la.c}}),this.unsubscribe=this.store.subscribe((()=>{this.props.onModelUpdate(this.store.getState().colorMapping)}))}componentWillUnmount(){this.unsubscribe()}componentDidUpdate(e){Object(qt.isEqual)(e.model,this.props.model)||this.store.dispatch(Object(ia.l)(this.props.model))}render(){const{palettes:e,data:t,isDarkMode:a,specialTokens:n}=this.props;return Object(x.jsx)(aa.Provider,{store:this.store},Object(x.jsx)(sa.a,{palettes:e,data:t,isDarkMode:a,specialTokens:n}))}}var ra=a(145),oa=a(240),ua=a(535),ca=a(10);function da(e,t){return t?e.reduce(((e,a)=>{const n=a[t];if(void 0===n)return e;const i=(Object(ca.isMultiFieldKey)(n)?[...n.keys]:[n]).map(String),s=i.join(",");return e.keys.has(s)||(e.keys.add(s),e.categories.push(1===i.length?i[0]:i)),e}),{keys:new Set,categories:[]}).categories:[]}function pa(e){var t,a,n,r;const{inputValue:o,handleInputChange:c}=Object(Z.a)({value:e.state,onChange:e.setState}),[d,m]=Object(s.useState)(!1),g=o.layers.find((t=>t.layerId===e.layerId)),f=!(!g||!g.colorMapping),[v,h]=Object(s.useState)(f),y=Object(s.useCallback)((({color:t})=>{if(!g)return;const a={...g.colorsByDimension};t?a[e.accessor]=t:delete a[e.accessor],c({...o,layers:o.layers.map((e=>e.layerId===g.layerId?{...e,colorsByDimension:a}:e))})}),[g,o,e.accessor,c]),j=Object(s.useCallback)((e=>{c({...o,layers:o.layers.map((t=>t.layerId===(null==g?void 0:g.layerId)?{...t,colorMapping:e}:t))})}),[o,g,c]);if(!g)return null;const O=g.primaryGroups.find((e=>!xa(e,g))),I=g.metrics.includes(e.accessor)&&g.allowMultipleMetrics,T=ya(g)?["pie","donut"].includes(e.state.shape)?u.i18n.translate("xpack.lens.pieChart.colorPicker.disabledBecauseSliceBy",{defaultMessage:'You are unable to apply custom colors to individual slices when the layer includes one or more "Slice by" dimensions.'}):u.i18n.translate("xpack.lens.pieChart.colorPicker.disabledBecauseGroupBy",{defaultMessage:'You are unable to apply custom colors to individual slices when the layer includes one or more "Group by" dimensions.'}):void 0,M=Object(xt.c)(e.isDarkMode,g.colorMapping),w=null===(t=e.frame.activeData)||void 0===t?void 0:t[g.layerId],C=da(null!==(a=null==w?void 0:w.rows)&&void 0!==a?a:[],e.accessor);return Object(x.jsx)(l.a.Fragment,null,e.accessor===O&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.colorMapping.editColorMappingSectionlabel",{defaultMessage:"Color mapping"}),style:{alignItems:"center"}},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lns_dynamicColoring_edit",palette:M,type:"fixed",onClick:()=>{m(!d)}})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonIcon,{"data-test-subj":"lns_colorEditing_trigger","aria-label":u.i18n.translate("xpack.lens.colorMapping.editColorMappingButton",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{m(!d)},size:"xs"}),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:d,handleClose:()=>m(!d),title:v?u.i18n.translate("xpack.lens.colorMapping.editColorMappingTitle",{defaultMessage:"Edit colors by term mapping"}):u.i18n.translate("xpack.lens.colorMapping.editColorsTitle",{defaultMessage:"Edit colors"}),isInlineEditing:e.isInlineEditing},Object(x.jsx)("div",{className:"lnsPalettePanel__section lnsPalettePanel__section--shaded lnsIndexPatternDimensionEditor--padded"},Object(x.jsx)(b.EuiFlexGroup,{direction:"column",gutterSize:"s",justifyContent:"flexStart"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.colorMapping.tryLabel",{defaultMessage:"Use the new Color Mapping feature"})," ",Object(x.jsx)(b.EuiBadge,{color:"hollow"},u.i18n.translate("xpack.lens.colorMapping.techPreviewLabel",{defaultMessage:"Tech preview"})))),"data-test-subj":"lns_colorMappingOrLegacyPalette_switch",compressed:!0,checked:v,onChange:({target:{checked:e}})=>{Object(p.d)("color_mapping_switch_"+(e?"enabled":"disabled")),j(e?{...xt.a}:void 0),h(e)}})),Object(x.jsx)(b.EuiFlexItem,null,f||v?Object(x.jsx)(categorical_color_mapping_CategoricalColorMapping,{isDarkMode:e.isDarkMode,model:null!==(n=g.colorMapping)&&void 0!==n?n:{...xt.a},onModelUpdate:e=>j(e),palettes:ra.a,data:{type:"categories",categories:C},specialTokens:oa.a}):Object(x.jsx)(k.g,{palettes:e.paletteService,activePalette:e.state.palette,setPalette:t=>{c({...e.state,palette:t})}})))))))),I&&Object(x.jsx)(ua.a,i()({},e,{overwriteColor:null===(r=g.colorsByDimension)||void 0===r?void 0:r[e.accessor],defaultColor:ja({layer:g,columnId:e.accessor,paletteService:e.paletteService,datasource:e.datasource,palette:e.state.palette}),disabledMessage:T,setConfig:y})))}function ma(e){var t,a;const n=e.state.layers.find((t=>t.layerId===e.layerId));return n?Object(x.jsx)(l.a.Fragment,null,[...n.primaryGroups,...null!==(t=n.secondaryGroups)&&void 0!==t?t:[]].includes(e.accessor)&&Object(x.jsx)(W,{value:(null==n||null===(a=n.collapseFns)||void 0===a?void 0:a[e.accessor])||"",onChange:t=>{e.setState({...e.state,layers:e.state.layers.map((a=>a.layerId!==e.layerId?a:{...a,collapseFns:{...a.collapseFns,[e.accessor]:t}}))})}})):null}function ga(e){if("appearance"===e.section)return null;if(e.state.shape===It.PieChartTypes.MOSAIC)return null;const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?Object(x.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.pieChart.multipleMetrics",{defaultMessage:"Multiple metrics"})},Object(x.jsx)(b.EuiSwitch,{label:u.i18n.translate("xpack.lens.pieChart.multipleMetrics",{defaultMessage:"Multiple metrics"}),compressed:!0,showLabel:!1,checked:Boolean(t.allowMultipleMetrics),onChange:()=>{e.setState({...e.state,layers:e.state.layers.map((t=>t.layerId!==e.layerId?t:{...t,allowMultipleMetrics:!t.allowMultipleMetrics}))})}})):null}const fa=u.i18n.translate("xpack.lens.pie.groupMetricLabelSingular",{defaultMessage:"Metric"});function ba(e,t){return{layerId:e,primaryGroups:[],secondaryGroups:void 0,metrics:[],numberDisplay:It.NumberDisplay.PERCENT,categoryDisplay:It.CategoryDisplay.DEFAULT,legendDisplay:It.LegendDisplay.DEFAULT,nestedLegend:!1,layerType:z.LayerTypes.DATA,colorMapping:t}}const va=e=>e.isBucketed,ha=e=>!e.isBucketed&&"number"===e.dataType&&!e.isStaticValue,xa=(e,t)=>{var a;return Boolean(null===(a=t.collapseFns)||void 0===a?void 0:a[e])},ya=e=>{var t;return e.primaryGroups.length-(null!==(t=e.collapseFns&&Object.values(e.collapseFns).filter(Boolean).length)&&void 0!==t?t:0)>0},ja=({layer:e,columnId:t,paletteService:a,datasource:n,palette:i})=>{const s=n?At(e.metrics,n):{},l=Lt(n,e,"metrics");return a.get((null==i?void 0:i.name)||"default").getCategoricalColor([{name:s[t],rankAtDepth:l.indexOf(t),totalSeriesAtDepth:l.length}])},Oa=({paletteService:e,kibanaTheme:t})=>({id:"lnsPie",visualizationTypes:Object.entries(Et).map((([e,t])=>({id:e,icon:t.icon,label:t.label,groupLabel:t.groupLabel,showExperimentalBadge:t.isExperimental}))),getVisualizationTypeId:e=>e.shape,getLayerIds:e=>e.layers.map((e=>e.layerId)),clearLayer:e=>({shape:e.shape,layers:e.layers.map((e=>ba(e.layerId,{...xt.a})))}),getDescription(e){var t;return null!==(t=Et[e.shape])&&void 0!==t?t:Et.pie},switchVisualizationType:(e,t)=>({...t,shape:e}),triggers:[N.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t||{shape:It.PieChartTypes.DONUT,layers:[ba(e(),"colorMapping"===(null==a?void 0:a.type)?a.value:Object(st.getColorMappingDefaults)())],palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0},getMainPalette:e=>{if(e)return e.layers.length>0&&e.layers[0].colorMapping?{type:"colorMapping",value:e.layers[0].colorMapping}:e.palette?{type:"legacyPalette",value:e.palette}:void 0},getSuggestions:Yt,getConfiguration({state:a,frame:n,layerId:i}){const s=a.layers.find((e=>e.layerId===i));if(!s)return{groups:[]};const l=n.datasourceLayers[s.layerId];let r=[];return t.theme$.subscribe({next(t){var n,i,s;r=null!==(n=a.layers[0])&&void 0!==n&&n.colorMapping?Object(xt.c)(t.darkMode,a.layers[0].colorMapping):e.get((null===(i=a.palette)||void 0===i?void 0:i.name)||"default").getCategoricalColors(10,null===(s=a.palette)||void 0===s?void 0:s.params)}}).unsubscribe(),{groups:[(()=>{const e=Lt(l,s,"primaryGroups").map((e=>({columnId:e,triggerIconType:xa(e,s)?"aggregate":void 0}))),t=s.primaryGroups.find((e=>!xa(e,s)));e.forEach((e=>{t===e.columnId&&(e.triggerIconType="colorBy",e.palette=r)}));const n={groupId:"primaryGroups",accessors:e,enableDimensionEditor:!0,filterOperations:va},i=s.metrics.length>1&&a.shape!==It.PieChartTypes.MOSAIC?1:0,o=e.reduce(((e,{columnId:t})=>e+(xa(t,s)?0:1)),0)+i,c=s.metrics.length>1&&s.allowMultipleMetrics?{label:u.i18n.translate("xpack.lens.pie.multiMetricAccessorLabel",{defaultMessage:"{number} metrics",values:{number:s.metrics.length}})}:void 0;switch(a.shape){case It.PieChartTypes.DONUT:case It.PieChartTypes.PIE:return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.sliceDimensionGroupLabel",{defaultMessage:"Slice"}),fakeFinalAccessor:c,supportsMoreColumns:o<Et.pie.maxBuckets,dimensionsTooMany:o-Et.pie.maxBuckets,dataTestSubj:"lnsPie_sliceByDimensionPanel",hideGrouping:!0};case It.PieChartTypes.MOSAIC:return{...n,requiredMinDimensionCount:1,groupLabel:u.i18n.translate("xpack.lens.pie.verticalAxisLabel",{defaultMessage:"Vertical axis"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.verticalAxisDimensionLabel",{defaultMessage:"Vertical axis"}),supportsMoreColumns:0===o,dimensionsTooMany:o-1,dataTestSubj:"lnsPie_verticalAxisDimensionPanel"};default:return{...n,groupLabel:u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.treemapDimensionGroupLabel",{defaultMessage:"Group"}),fakeFinalAccessor:c,supportsMoreColumns:o<Et[a.shape].maxBuckets,dimensionsTooMany:o-Et[a.shape].maxBuckets,dataTestSubj:"lnsPie_groupByDimensionPanel",hideGrouping:a.shape===It.PieChartTypes.TREEMAP}}})(),(()=>{const e=Lt(l,s,"secondaryGroups").map((e=>({columnId:e,triggerIconType:xa(e,s)?"aggregate":void 0}))),t={required:!0,groupId:"secondaryGroups",accessors:e,enableDimensionEditor:!0,filterOperations:va},n=e.reduce(((e,{columnId:t})=>e+(xa(t,s)?0:1)),0);if(a.shape===It.PieChartTypes.MOSAIC)return{...t,groupLabel:u.i18n.translate("xpack.lens.pie.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.pie.horizontalAxisDimensionLabel",{defaultMessage:"Horizontal axis"}),supportsMoreColumns:0===n,dimensionsTooMany:n-1,dataTestSubj:"lnsPie_horizontalAxisDimensionPanel"}})(),(()=>{const t=Lt(l,s,"metrics").map((t=>{var n,i,r;return{columnId:t,...s.allowMultipleMetrics?ya(s)?{triggerIconType:"disabled"}:{triggerIconType:"color",color:null!==(n=null!==(i=null===(r=s.colorsByDimension)||void 0===r?void 0:r[t])&&void 0!==i?i:ja({layer:s,columnId:t,paletteService:e,datasource:l,palette:a.palette}))&&void 0!==n?n:void 0}:{}}})),n=s.allowMultipleMetrics?u.i18n.translate("xpack.lens.pie.groupMetricLabel",{defaultMessage:"Metrics"}):fa;return{groupId:"metric",groupLabel:n,dimensionEditorGroupLabel:n,paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.pie.headingLabel",{defaultMessage:"Value"})},accessors:t,supportsMoreColumns:0===s.metrics.length||Boolean(s.allowMultipleMetrics),filterOperations:ha,isMetricDimension:!0,requiredMinDimensionCount:1,dimensionsTooMany:s.allowMultipleMetrics?0:s.metrics.length-1,dataTestSubj:"lnsPie_sizeByDimensionPanel",enableDimensionEditor:!0}})()].filter(st.nonNullable)}},setDimension:({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>({...e,layers:e.layers.map((e=>{if(e.layerId!==t)return e;if("primaryGroups"===n)return{...e,primaryGroups:[...e.primaryGroups.filter((e=>e!==a)),a]};var i;if("secondaryGroups"===n)return{...e,secondaryGroups:[...(null===(i=e.secondaryGroups)||void 0===i?void 0:i.filter((e=>e!==a)))||[],a]};const s=[...e.metrics.filter((e=>e!==a)),a];return{...e,metrics:s}}))}),removeDimension({prevState:e,layerId:t,columnId:a}){var n,i,s,l;const r={...e},o=e.layers.find((e=>e.layerId===t));if(!o)return e;o.primaryGroups.includes(a)&&1===o.primaryGroups.length&&o.allowMultipleMetrics&&o.metrics.length&&delete r.palette;let u={...o};return null!==(n=o.collapseFns)&&void 0!==n&&n[a]&&(u.collapseFns={...o.collapseFns},delete u.collapseFns[a]),null!==(i=o.colorsByDimension)&&void 0!==i&&i[a]&&(u.colorsByDimension={...o.colorsByDimension},delete u.colorsByDimension[a]),u={...u,primaryGroups:u.primaryGroups.filter((e=>e!==a)),secondaryGroups:null!==(s=null===(l=u.secondaryGroups)||void 0===l?void 0:l.filter((e=>e!==a)))&&void 0!==s?s:void 0,metrics:u.metrics.filter((e=>e!==a))},{...r,layers:r.layers.map((e=>e.layerId===t?u:e))}},DimensionEditorComponent(a){const n=w()(t.theme$,{darkMode:!1}).darkMode;return Object(x.jsx)(pa,i()({},a,{paletteService:e,isDarkMode:n}))},DimensionEditorDataExtraComponent:t=>Object(x.jsx)(ma,i()({},t,{paletteService:e})),getSupportedLayers:()=>[{type:z.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.pie.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},toExpression:(t,a,n,i)=>function(e,t,a,n={},i={}){return Gt(e,t,a,{...n,isPreview:!1},i)}(t,a,e,n,i),toPreviewExpression:(t,a,n)=>function(e,t,a,n={}){return Gt(e,t,a,{isPreview:!0},n)}(t,a,e,n),ToolbarComponent:e=>Object(x.jsx)(Zt,e),hasLayerSettings:e=>({data:e.state.shape!==It.PieChartTypes.MOSAIC,appearance:!1}),LayerSettingsComponent:e=>Object(x.jsx)(ga,e),getSuggestionFromConvertToLensContext(e){const t=e.context;if(!function(e){return"lnsPie"===e.type}(t))return;if(!e.suggestions.length)return;const a=e.suggestions.find((e=>e.visualizationState.shape===t.configuration.shape));return a?{...a,visualizationState:{...a.visualizationState,...t.configuration}}:void 0},getUserMessages(e,{frame:t}){const a=e.layers.map((t=>{var a;return Array.from(new Set([...t.primaryGroups,...null!==(a=t.secondaryGroups)&&void 0!==a?a:[]])).filter((e=>!xa(e,t))).length+(t.metrics.length>1?1:0)>Et[e.shape].maxBuckets})).some(Boolean)?[{severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.pie.tooManyDimensions",{defaultMessage:"Your visualization has too many dimensions."}),longMessage:Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.pie.tooManyDimensionsLong",{defaultMessage:"Your visualization has too many dimensions. Please follow the instructions in the layer panel."}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),u.i18n.translate("xpack.lens.pie.collapsedDimensionsDontCount",{defaultMessage:"(Collapsed dimensions don't count toward this limit.)"}))}]:[],n=[];if((null==e?void 0:e.layers.length)>0&&t.activeData)for(const a of e.layers){var i,s;const{layerId:l,metrics:r}=a,o=null===(i=t.activeData[l])||void 0===i?void 0:i.rows,u=null===(s=t.activeData[l])||void 0===s?void 0:s.columns.find((({meta:e})=>"number"===(null==e?void 0:e.type)));if(!o||!r.length)break;u&&e.shape===It.PieChartTypes.WAFFLE&&a.primaryGroups.length&&Ft(t.activeData[l],u.id,1)&&n.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.pie.smallValuesWarningMessage",defaultMessage:"Waffle charts are unable to effectively display small field values. To display all field values, use the Data table or Treemap."})});const d=r.map((e=>{if(o.some((t=>Array.isArray(t[e]))))return e})).filter(st.nonNullable);if(d.length){const e=d.map((e=>{var a,n;return(null===(a=t.datasourceLayers[l])||void 0===a||null===(n=a.getOperationForColumnId(e))||void 0===n?void 0:n.label)||e}));n.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{key:e.join(","),id:"xpack.lens.pie.arrayValues",defaultMessage:"The following dimensions contain array values: {label}. Your visualization may not render as expected.",values:{label:Object(x.jsx)("strong",null,e.join(", "))}})})}}return[...a,...n]},getVisualizationInfo(t,a){var n,i,s;const l=t.layers[0],r=[],o=null==a?void 0:a.datasourceLayers[l.layerId],c=l.primaryGroups.length+((null===(n=l.secondaryGroups)||void 0===n?void 0:n.length)||0),d=l.allowMultipleMetrics,p=[];if(!c&&o)if(d)p.push(...l.metrics.map((a=>{var n,i;return null!==(n=null===(i=l.colorsByDimension)||void 0===i?void 0:i[a])&&void 0!==n?n:ja({layer:l,columnId:a,paletteService:e,datasource:o,palette:t.palette})})));else if(!ya(l)){var m;p.push(...e.get((null===(m=t.palette)||void 0===m?void 0:m.name)||"default").getCategoricalColors(Math.max(10,l.metrics.length)).slice(0,l.metrics.length))}if(l.metrics.forEach((e=>{r.push({id:e,name:fa,dimensionType:"metric"})})),t.shape===It.PieChartTypes.MOSAIC&&null!==(i=l.secondaryGroups)&&void 0!==i&&i.length&&l.secondaryGroups.forEach((e=>{r.push({name:u.i18n.translate("xpack.lens.pie.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),dimensionType:"horizontal_axis",id:e})})),null!==(s=l.primaryGroups)&&void 0!==s&&s.length){let a=u.i18n.translate("xpack.lens.pie.treemapGroupLabel",{defaultMessage:"Group by"}),n="group_by";var g,f;t.shape===It.PieChartTypes.MOSAIC&&(a=u.i18n.translate("xpack.lens.pie.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n="vertical_axis"),t.shape!==It.PieChartTypes.DONUT&&t.shape!==It.PieChartTypes.PIE||(a=u.i18n.translate("xpack.lens.pie.sliceGroupLabel",{defaultMessage:"Slice by"}),n="slice_by"),l.primaryGroups.forEach((e=>{r.push({name:a,dimensionType:n,id:e})})),ya(l)&&p.push(...e.get((null===(g=t.palette)||void 0===g?void 0:g.name)||"default").getCategoricalColors(10,null===(f=t.palette)||void 0===f?void 0:f.params))}const b=p.filter(st.nonNullable);return{layers:[{layerId:l.layerId,layerType:l.layerType,chartType:t.shape,...this.getDescription(t),dimensions:r,palette:b.length?b:void 0}]}}});class PieVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getPieVisualization:t}=await Promise.resolve().then(a.bind(null,558));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var Ia=a(91);const ka=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 16 12",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("g",null,Object(x.jsx)("path",{className:h.a.subdued,d:"M3.2 4.79997C3.2 4.50542 2.96122 4.26663 2.66667 4.26663H0.533333C0.238784 4.26663 0 4.50542 0 4.79997V6.39997H3.2V4.79997ZM3.2 9.59997H0V13.3333C0 13.6279 0.238784 13.8666 0.533333 13.8666H2.66667C2.96122 13.8666 3.2 13.6279 3.2 13.3333V9.59997ZM8.53333 9.59997H11.7333V13.3333C11.7333 13.6279 11.4946 13.8666 11.2 13.8666H9.06667C8.77211 13.8666 8.53333 13.6279 8.53333 13.3333V9.59997ZM11.7333 6.39997H8.53333V2.66663C8.53333 2.37208 8.77211 2.1333 9.06667 2.1333H11.2C11.4946 2.1333 11.7333 2.37208 11.7333 2.66663V6.39997ZM12.8 9.59997V13.3333C12.8 13.6279 13.0388 13.8666 13.3333 13.8666H15.4667C15.7612 13.8666 16 13.6279 16 13.3333V9.59997H12.8ZM16 6.39997V5.86663C16 5.57208 15.7612 5.3333 15.4667 5.3333H13.3333C13.0388 5.3333 12.8 5.57208 12.8 5.86663V6.39997H16ZM7.46667 11.2C7.46667 10.9054 7.22789 10.6666 6.93333 10.6666H4.8C4.50544 10.6666 4.26667 10.9054 4.26667 11.2V13.3333C4.26667 13.6279 4.50544 13.8666 4.8 13.8666H6.93333C7.22789 13.8666 7.46667 13.6279 7.46667 13.3333V11.2Z"}),Object(x.jsx)("rect",{y:"7.4668",width:"16",height:"1.06667",rx:"0.533334",className:h.a.accent}))),Ta=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("g",null,Object(x.jsx)("path",{className:h.a.subdued,d:"M16 8a1 1 0 011-1h4a1 1 0 011 1v13a1 1 0 01-1 1h-4a1 1 0 01-1-1V8zM1 9a1 1 0 00-1 1v11a1 1 0 001 1h4a1 1 0 001-1V10a1 1 0 00-1-1H1zM9 16a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zM25 11a1 1 0 00-1 1v9a1 1 0 001 1h4a1 1 0 001-1v-9a1 1 0 00-1-1h-4z"}),Object(x.jsx)("path",{className:h.a.accent,d:"M10 1a1 1 0 011-1h3a1 1 0 011 1h3v4h-3a1 1 0 01-1-1h-2v9a1 1 0 11-2 0V1z"})));var Ma=a(82),wa=a(114);const Ca=e=>{var t;const a=Object(Ma.g)(e)?void 0:wa.a.find((t=>t.value===(null==e?void 0:e.icon)))||wa.a.find((e=>"triangle"===e.value)),n=null!==(t=null==a?void 0:a.icon)&&void 0!==t?t:null==a?void 0:a.value;return{columnId:e.id,triggerIconType:e.isHidden?"invisible":n?"custom":"color",customIcon:n,color:(null==e?void 0:e.color)||(Object(Ma.g)(e)?Ma.c:Ma.b)}};var Ea=a(255),Sa=a(93),Fa=a(53),Pa=a(156),_a=a.n(Pa),Aa=a(538),La=a(536);const Da=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({viewBox:"0 0 30 22",width:30,height:22,fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M24 16l.186-.002.345-.02.266-.03.334-.058.193-.043.25-.067.223-.07.215-.074.209-.079.305-.124c.166-.07.34-.148.524-.234l.285-.135 1.202-.588c.428-.203.728-.326.966-.396.146-.044.27-.067.384-.076L30 14v7a1 1 0 01-1 1H1a1 1 0 01-1-1v-2c1 0 3.5-4 6-4s5 3 6 3 3.23-7.994 5.865-7.997L19.032 10l.541 1.205.272.595.29.612c.517 1.069.955 1.842 1.391 2.391.08.1.16.194.241.28.095.101.189.191.283.272l.143.114c.218.164.446.284.69.368.207.071.426.116.662.14l.14.012.154.008L24 16zm6-12v6l-.186.002-.345.02-.266.03-.331.057-.196.044-.25.067-.304.097-.134.047a9.492 9.492 0 00-.386.15l-.128.053c-.166.07-.34.148-.524.234l-.285.135-1.264.618-.352.159-.187.078-.256.095-.178.054a13.872 13.872 0 01-.38-.687l-.16-.311-.233-.47-.016-.472H24c1 0 3-6 6-6z",className:h.a.accent}),Object(x.jsx)("path",{d:"M30 13c-.507 0-.988.146-1.89.571l-1.209.592C25.621 14.78 24.924 15 24 15c-1.384 0-2.003-.865-3.516-4.206l-.637-1.42-.346-.749-.213-.445C18.572 6.698 18.127 6 18 6c-.466 0-.967.252-1.99.997l-.891.659-.458.325C13.576 8.728 12.907 9 12 9c-1.269 0-1.966-.69-3.492-2.939l-.774-1.146-.272-.387-.26-.358C6.581 3.342 6.213 3 6 3c-.294 0-.885.651-2.017 2.33l-.491.731-.326.475C1.859 8.409 1.175 9 0 9V7c.294 0 .885-.651 2.017-2.33l.491-.731.326-.475C4.141 1.591 4.825 1 6 1c1.269 0 1.966.69 3.492 2.939l.774 1.146.272.387.26.358C11.419 6.658 11.788 7 12 7c.466 0 .967-.252 1.99-.997l.891-.659.458-.325C16.424 4.272 17.093 4 18 4c1.384 0 2.003.865 3.516 4.206l.637 1.42.346.749.213.445C23.428 12.302 23.873 13 24 13c.507 0 .988-.146 1.89-.571l1.209-.592C28.379 11.22 29.076 11 30 11v2z",className:h.a.subdued}),Object(x.jsx)("path",{d:"M6 13v7.889C6 21.503 5.552 22 5 22H1c-.552 0-1-.497-1-1.111V13a1 1 0 011-1h4a1 1 0 011 1zm8-1v9a1 1 0 01-1 1H9a1 1 0 01-1-1v-9a1 1 0 011-1h4a1 1 0 011 1zm8 5v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 011-1h4a1 1 0 011 1zm8 2v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2a1 1 0 011-1h4a1 1 0 011 1z",className:h.a.subdued}));var Ra=a(537);function Ba(e,{isHorizontal:t}){const a=u.i18n.translate("xpack.lens.xyChart.verticalAxisLabel",{defaultMessage:"Vertical axis"}),n=u.i18n.translate("xpack.lens.xyChart.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});if("x"===e)return t?a:n;if("y"===e)return t?n:a;const i=u.i18n.translate("xpack.lens.xyChart.verticalLeftAxisLabel",{defaultMessage:"Vertical left axis"}),s=u.i18n.translate("xpack.lens.xyChart.verticalRightAxisLabel",{defaultMessage:"Vertical right axis"}),l=u.i18n.translate("xpack.lens.xyChart.horizontalLeftAxisLabel",{defaultMessage:"Horizontal top axis"}),r=u.i18n.translate("xpack.lens.xyChart.horizontalRightAxisLabel",{defaultMessage:"Horizontal bottom axis"});return"yLeft"===e?t?r:i:t?l:s}function Na(e,t,a){return n=>{const i=a[n.layerId];if(!n.xAccessor)return!1;const s=null==i?void 0:i.getOperationForColumnId(n.xAccessor);return Boolean(s&&(!t||s.dataType===t)&&s.scale===e)}}const za=e=>e.layerType===Ut.layerTypes.DATA||!e.layerType,Va=e=>(e||[]).filter((e=>za(e))),Ga=e=>e.layerType===Ut.layerTypes.REFERENCELINE,qa=e=>(e||[]).filter((e=>Ga(e))),Ha=e=>e.layerType===Ut.layerTypes.ANNOTATIONS&&"indexPatternId"in e,Ua=e=>e.layerType===Ut.layerTypes.ANNOTATIONS&&!("indexPatternId"in e),$a=e=>Ua(e)&&("byValue"===e.persistanceType||!e.persistanceType),Wa=e=>"annotationGroupId"in e&&"__lastSaved"in e,Xa=e=>Ua(e)&&"byReference"===e.persistanceType,Ya=e=>(e||[]).filter((e=>Ha(e))),Qa=e=>{if(e.cachedMetadata)return e.cachedMetadata;if(Wa(e)){const{title:t,description:a,tags:n}=e.__lastSaved;return{title:t,description:a,tags:n}}return{title:"",description:"",tags:[]}},Ka=e=>Qa(e).title;function Za(e){var t;if(!e.layers.length)return null!==(t=Ia.visualizationTypes.find((t=>t.id===e.preferredSeriesType)))&&void 0!==t?t:Ia.visualizationTypes[0];const a=Va(null==e?void 0:e.layers),n=Ia.visualizationTypes.find((e=>e.id===(null==a?void 0:a[0].seriesType))),i=Object(qt.uniq)(a.map((e=>e.seriesType)));return n&&1===i.length?n:"mixed"}function Ja(e){if(!e)return{icon:en,label:u.i18n.translate("xpack.lens.xyVisualization.xyLabel",{defaultMessage:"XY"})};const t=Za(e);return"mixed"===t&&mn(e.layers)?{icon:La.a,label:u.i18n.translate("xpack.lens.xyVisualization.mixedBarHorizontalLabel",{defaultMessage:"Mixed bar horizontal"})}:"mixed"===t?{icon:Da,label:u.i18n.translate("xpack.lens.xyVisualization.mixedLabel",{defaultMessage:"Mixed XY"})}:{icon:t.icon||en,label:t.fullLabel||t.label}}const en=Ra.a,tn="bar_stacked",an={type:Ut.layerTypes.DATA,label:u.i18n.translate("xpack.lens.xyChart.addDataLayerLabel",{defaultMessage:"Visualization"}),icon:Da};function nn(e,t,a){const n=t.map((e=>e+1)).join(", ");switch(e){case"Break down":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitShort",{defaultMessage:"Missing {axis}.",values:{axis:"Break down by axis"}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureSplitLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:"Break down by axis"}})};case"Y":return{shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYShort",{defaultMessage:"Missing {axis}.",values:{axis:Ba("y",{isHorizontal:a})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataFailureYLong",{defaultMessage:"{layers, plural, one {Layer} other {Layers}} {layersList} {layers, plural, one {requires} other {require}} a field for the {axis}.",values:{layers:t.length,layersList:n,axis:Ba("y",{isHorizontal:a})}})}}return{shortMessage:"",longMessage:""}}const sn={[Ut.layerTypes.DATA]:({layerId:e,seriesType:t})=>({layerId:e,layerType:Ut.layerTypes.DATA,accessors:[],seriesType:t}),[Ut.layerTypes.REFERENCELINE]:({layerId:e})=>({layerId:e,layerType:Ut.layerTypes.REFERENCELINE,accessors:[]}),[Ut.layerTypes.ANNOTATIONS]:({layerId:e,indexPatternId:t,extraArg:a})=>{if(a){const{annotationGroupId:t,...n}=a;return{layerId:e,layerType:Ut.layerTypes.ANNOTATIONS,annotationGroupId:t,annotations:Object(qt.cloneDeep)(n.annotations),indexPatternId:n.indexPatternId,ignoreGlobalFilters:n.ignoreGlobalFilters,__lastSaved:n}}return{layerId:e,layerType:Ut.layerTypes.ANNOTATIONS,annotations:[],indexPatternId:t,ignoreGlobalFilters:!0}}};function ln({layerId:e,layerType:t=Ut.layerTypes.DATA,seriesType:a,indexPatternId:n,extraArg:i}){return sn[t]({layerId:e,seriesType:a,indexPatternId:n,extraArg:i})}function rn(e,t){return e.layers.filter((({layerType:e=Ut.layerTypes.DATA})=>!t||e===t))}function on(e,t,a){return t.every(a)||!t.some(a)?{valid:!0}:{valid:!1,payload:nn(e,t.reduce(((e,t,n)=>(a(t)&&e.push(n),e)),[]),mn(t))}}const un=e=>!e.isBucketed&&"number"===e.dataType,cn=e=>un(e)&&!e.isStaticValue,dn=e=>e.isBucketed;function pn(e){return"bar_horizontal"===e||"bar_horizontal_stacked"===e||"bar_horizontal_percentage_stacked"===e}function mn(e){return Va(e).every((e=>pn(e.seriesType)))}function gn(e){const t=Ia.visualizationTypes.find((t=>t.id===e));if(!t)throw new Error(`Unknown series type ${e}`);return t.icon||"empty"}const fn=(e,t)=>{var a,n,i,s;return Ha(e)?(null==e||null===(i=e.annotations)||void 0===i||null===(s=i.find((e=>e.id===t)))||void 0===s?void 0:s.color)||null:za(e)&&e.splitAccessor&&!e.collapseFn?null:(null==e||null===(a=e.yConfig)||void 0===a||null===(n=a.find((e=>e.forAccessor===t)))||void 0===n?void 0:n.color)||null},bn=(e,t)=>{const a={};return e.accessors.concat(za(e)&&e.splitAccessor?[e.splitAccessor]:[]).forEach((e=>{const n=null==t?void 0:t.getOperationForColumnId(e);null!=n&&n.label&&(a[e]=n.label)})),a};function vn(e){return`xy-visualization-layer-${e}`}const hn=e=>{if(!Wa(e))return!1;const t={annotations:e.annotations,ignoreGlobalFilters:e.ignoreGlobalFilters,indexPatternId:e.indexPatternId},a={annotations:e.__lastSaved.annotations,ignoreGlobalFilters:e.__lastSaved.ignoreGlobalFilters,indexPatternId:e.__lastSaved.indexPatternId};return!_a()(t,a)};function xn(e,t,a){if(!a||!a.length)return e;if(!t)throw new Error("xy visualization: injecting references relies on annotation groups but they were not provided");const n=e=>{var t;const n=a.find((({type:e})=>"index-pattern"===e)).id;return(null===(t=a.find((({name:t})=>t===vn(e))))||void 0===t?void 0:t.id)||n};return{...e,layers:e.layers.map((e=>{if(!Ua(e))return e;let i;if($a(e))i={...e,indexPatternId:n(e.layerId)};else{var s;const l=null==a||null===(s=a.find((({name:t})=>t===e.annotationGroupRef)))||void 0===s?void 0:s.id,r=l?t[l]:void 0;if(!l||!r)return;const o={layerId:e.layerId,layerType:e.layerType,annotationGroupId:l,__lastSaved:r};i=Xa(e)?{...o,ignoreGlobalFilters:r.ignoreGlobalFilters,indexPatternId:r.indexPatternId,annotations:Object(qt.cloneDeep)(r.annotations)}:{...o,ignoreGlobalFilters:e.ignoreGlobalFilters,indexPatternId:n(e.layerId),annotations:Object(qt.cloneDeep)(e.annotations),cachedMetadata:e.cachedMetadata}}return i})).filter(st.nonNullable)}}const yn={document:0,date:1,string:2,ip:3,boolean:4,number:5,gauge:6,counter:7,histogram:8,geo_point:9,geo_shape:10,murmur3:11};function jn({table:e,state:t,keptLayerIds:a,subVisualizationId:n,mainPalette:i,isFromContext:s,allowMixed:l}){if((!e.isMultiRow||e.columns.length<=1||e.columns.every((e=>"number"!==e.operation.dataType))||e.columns.some((e=>!yn.hasOwnProperty(e.operation.dataType))))&&t&&!n||e.columns.some((e=>e.operation.isStaticValue&&!s))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];const r=function(e,t,a,n,i,s){const[l,r]=Object(qt.partition)(e.columns,(e=>e.operation.isBucketed));if(1===l.length||2===l.length){const[l,o]=function(e,t){const a=t&&Va(t.layers).find((({layerId:t})=>t===e.layerId)),n=e.columns.filter((e=>e.operation.isBucketed)),i=In([...n].reverse());if(!a||"initial"===e.changeType)return i;if("reorder"===e.changeType)return n;const s=i.findIndex((({columnId:e})=>e===a.xAccessor)),l=s>-1&&i[s].operation.scale;if(l&&("interval"===l||"interval"!==i[0].operation.scale)){const[e]=i.splice(s,1);i.unshift(e)}const r=i.findIndex((({columnId:e})=>e===a.splitAccessor));if(r>-1){const[e]=i.splice(r,1);i.push(e)}return i}(e,a);return kn({layerId:e.layerId,changeType:e.changeType,xValue:l,yValues:r,splitBy:o,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i,allowMixed:s})}if(0===l.length){const[l,[o,u]]=Object(qt.partition)(In(r),(e=>"number"===e.operation.dataType&&!e.operation.isBucketed));return kn({layerId:e.layerId,changeType:e.changeType,xValue:o,yValues:l,splitBy:u,currentState:a,tableLabel:e.label,keptLayerIds:t,requestedSeriesType:n,mainPalette:i,allowMixed:s})}}(e,a,t,n,i,l);return Array.isArray(r)?r:r?[r]:[]}function On(e){switch(e){case"bar_horizontal":return"bar";case"bar_horizontal_stacked":return"bar_stacked";case"bar":default:return"bar_horizontal";case"bar_horizontal_percentage_stacked":return"bar_percentage_stacked";case"bar_percentage_stacked":return"bar_horizontal_percentage_stacked"}}function In(e){return[...e].sort(((e,t)=>yn[e.operation.dataType]-yn[t.operation.dataType]))}function kn({layerId:e,changeType:t,xValue:a,yValues:n,splitBy:i,currentState:s,tableLabel:l,keptLayerIds:r,requestedSeriesType:o,mainPalette:c,allowMixed:d}){const p=function(e,t,a){const n=e.map((e=>e.operation.label)).join(u.i18n.translate("xpack.lens.xySuggestions.yAxixConjunctionSign",{defaultMessage:" & ",description:"A character that can be used for conjunction of multiple enumarated items. Make sure to include spaces around it if needed."})),i=(null==t?void 0:t.operation.label)||u.i18n.translate("xpack.lens.xySuggestions.emptyAxisTitle",{defaultMessage:"(empty)"});return a||("date"===(null==t?void 0:t.operation.dataType)?u.i18n.translate("xpack.lens.xySuggestions.dateSuggestion",{defaultMessage:"{yTitle} over {xTitle}",description:'Chart description for charts over time, like "Transfered bytes over log.timestamp"',values:{xTitle:i,yTitle:n}}):u.i18n.translate("xpack.lens.xySuggestions.nonDateSuggestion",{defaultMessage:"{yTitle} of {xTitle}",description:'Chart description for a value of some groups, like "Top URLs of top 5 countries"',values:{xTitle:i,yTitle:n}}))}(n,a,l),m=o||function(e,t,a){const n="bar_stacked",i=Cn(e,t),s=!(!i||!za(i))&&i.seriesType||e&&e.preferredSeriesType||n;return a&&a.operation.scale&&"ordinal"===a.operation.scale?s.startsWith("bar")?s:n:s}(s,e,a),g={currentState:s,seriesType:m,layerId:e,title:p,yValues:n,splitBy:i,changeType:t,xValue:a,keptLayerIds:r,mainPalette:i?c:void 0,allowMixed:d};if(!s&&"unchanged"===t)return Ia.visualizationTypes.map((e=>({...Mn({...g,seriesType:e.id,hide:"bar_stacked"!==e.id||void 0}),title:e.label}))).sort(((e,t)=>"bar_stacked"===e.state.preferredSeriesType?-1:1));if(!s||"unchanged"!==t)return Mn(g);const f=[];if(!m.includes("bar")||a&&"ordinal"!==a.operation.scale){const e=function(e){switch(e){case"area":case"bar":case"bar_stacked":return"line";default:return"bar_stacked"}}(m);f.push(Mn({...g,seriesType:e,title:Tn(e)}))}else f.push(Mn({...g,title:u.i18n.translate("xpack.lens.xySuggestions.flipTitle",{defaultMessage:"Flip"}),seriesType:On(m)}));if("line"!==m&&i&&!m.includes("percentage")){const e=function(e){switch(e){case"area":return"area_stacked";case"area_stacked":return"area";case"bar":return"bar_stacked";case"bar_stacked":return"bar";default:return e}}(m);f.push(Mn({...g,seriesType:e,title:Tn(e)}))}if("line"!==m&&m.includes("stacked")&&!m.includes("percentage")){var b;const e={...g};"ordinal"!==(null===(b=e.xValue)||void 0===b?void 0:b.operation.scale)||e.splitBy||(e.splitBy=e.xValue,delete e.xValue);const t=function(e){switch(e){case"area_stacked":return"area_percentage_stacked";case"bar_stacked":return"bar_percentage_stacked";case"bar_horizontal_stacked":return"bar_horizontal_percentage_stacked";default:return e}}(m);f.push(Mn({...g,hide:!e.splitBy,seriesType:t,title:Tn(t)}))}return f.concat(Ia.visualizationTypes.filter((e=>!f.find((t=>t.state.preferredSeriesType===e.id)))).map((e=>({...Mn({...g,seriesType:e.id}),hide:!0}))))}function Tn(e){switch(e){case"line":return u.i18n.translate("xpack.lens.xySuggestions.lineChartTitle",{defaultMessage:"Line chart"});case"area":return u.i18n.translate("xpack.lens.xySuggestions.areaChartTitle",{defaultMessage:"Area chart"});case"area_stacked":return u.i18n.translate("xpack.lens.xySuggestions.areaStackedChartTitle",{defaultMessage:"Area stacked"});case"area_percentage_stacked":return u.i18n.translate("xpack.lens.xySuggestions.areaPercentageStackedChartTitle",{defaultMessage:"Area percentage"});case"bar":return u.i18n.translate("xpack.lens.xySuggestions.verticalBarChartTitle",{defaultMessage:"Bar vertical"});case"bar_horizontal":return u.i18n.translate("xpack.lens.xySuggestions.horizontalBarChartTitle",{defaultMessage:"Bar horizontal"});case"bar_stacked":return u.i18n.translate("xpack.lens.xySuggestions.verticalBarStackedChartTitle",{defaultMessage:"Bar vertical stacked"});case"bar_horizontal_stacked":return u.i18n.translate("xpack.lens.xySuggestions.horizontalBarStackedChartTitle",{defaultMessage:"Bar horizontal stacked"});case"bar_percentage_stacked":return u.i18n.translate("xpack.lens.xySuggestions.verticalBarPercentageChartTitle",{defaultMessage:"Bar percentage"});case"bar_horizontal_percentage_stacked":return u.i18n.translate("xpack.lens.xySuggestions.horizontalBarPercentageChartTitle",{defaultMessage:"Bar horizontal percentage"});default:return e}}function Mn({currentState:e,seriesType:t,layerId:a,title:n,yValues:i,splitBy:s,changeType:l,xValue:r,keptLayerIds:o,hide:u,mainPalette:c,allowMixed:d}){var p,m,g,f;t.includes("percentage")&&"ordinal"===(null===(p=r)||void 0===p?void 0:p.operation.scale)&&!s&&(s=r,r=void 0);const b=Cn(e,a)||null,v=i.map((e=>e.columnId)),h={...b||{},palette:"legacyPalette"===(null==c?void 0:c.type)?c.value:b&&"palette"in b?b.palette:void 0,layerId:a,seriesType:t,xAccessor:null===(m=r)||void 0===m?void 0:m.columnId,splitAccessor:null===(g=s)||void 0===g?void 0:g.columnId,accessors:v,yConfig:b&&"yConfig"in b&&b.yConfig?b.yConfig.filter((({forAccessor:e})=>-1!==v.indexOf(e))):void 0,layerType:z.LayerTypes.DATA,colorMapping:c?"colorMapping"===(null==c?void 0:c.type)?c.value:void 0:Object(st.getColorMappingDefaults)()},x="date"===(null===(f=r)||void 0===f?void 0:f.operation.dataType)&&"interval"===r.operation.scale,y=e?e.layers.filter((e=>o.includes(e.layerId)||x&&e.layerType===z.LayerTypes.ANNOTATIONS)).map((e=>e.layerId===a?h:e)).map((e=>d?e:{...e,seriesType:t})):[],j={legend:e?e.legend:{isVisible:!0,position:it.Position.Right},valueLabels:(null==e?void 0:e.valueLabels)||"hide",fittingFunction:(null==e?void 0:e.fittingFunction)||"None",curveType:null==e?void 0:e.curveType,fillOpacity:null==e?void 0:e.fillOpacity,xTitle:null==e?void 0:e.xTitle,yTitle:null==e?void 0:e.yTitle,yRightTitle:null==e?void 0:e.yRightTitle,hideEndzones:null==e?void 0:e.hideEndzones,showCurrentTimeMarker:null==e?void 0:e.showCurrentTimeMarker,valuesInLegend:null==e?void 0:e.valuesInLegend,yLeftExtent:null==e?void 0:e.yLeftExtent,yRightExtent:null==e?void 0:e.yRightExtent,yLeftScale:null==e?void 0:e.yLeftScale,yRightScale:null==e?void 0:e.yRightScale,axisTitlesVisibilitySettings:(null==e?void 0:e.axisTitlesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},tickLabelsVisibilitySettings:(null==e?void 0:e.tickLabelsVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},labelsOrientation:(null==e?void 0:e.labelsOrientation)||{x:0,yLeft:0,yRight:0},gridlinesVisibilitySettings:(null==e?void 0:e.gridlinesVisibilitySettings)||{x:!0,yLeft:!0,yRight:!0},preferredSeriesType:t,layers:b&&Object.keys(b).length?y:[...y,h]},O=0===i.length;return{title:n,score:wn(i,s,l),hide:null!=u?u:!e&&"unchanged"!==l&&"extended"!==l||e&&"reduced"===l||O||!r&&!s,state:j,incomplete:O,previewIcon:gn(t)}}function wn(e,t,a){const n="reduced"===a||"layers"===a?.3:"unchanged"===a?.5:1;return((e.length>1?2:1)+(t?1:0))/3*n}function Cn(e,t){return e&&e.layers.find((e=>e.layerId===t))}const En=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M5 1.5a.5.5 0 111 0v7a.5.5 0 01-1 0v-7zM15.39 11.39a1.5 1.5 0 010 2.12l-2.122 2.122a.5.5 0 11-.707-.707l2.121-2.122a.5.5 0 000-.707l-2.121-2.12a.5.5 0 11.707-.708l2.121 2.121zM3.439 9.269a.5.5 0 010 .707l-2.122 2.121a.5.5 0 000 .707l2.122 2.121a.5.5 0 01-.707.708L.61 13.51a1.5 1.5 0 010-2.121l2.122-2.121a.5.5 0 01.707 0zM8 3a.5.5 0 01.5.5v5a.5.5 0 01-1 0v-5A.5.5 0 018 3zM11 5.5a.5.5 0 00-1 0v3a.5.5 0 001 0v-3z"}),Object(x.jsx)("path",{d:"M3.5 12a.5.5 0 000 1h9a.5.5 0 000-1h-9z"})),Sn=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M7.378 3.585a.5.5 0 00.353-.854L5.61.611a1.5 1.5 0 00-2.121 0L1.367 2.73a.5.5 0 00.708.707l2.12-2.12a.5.5 0 01.708 0l2.121 2.12a.5.5 0 00.354.147z"}),Object(x.jsx)("path",{d:"M5.046 3.088v4.129l.005.04v5.658a.5.5 0 01-.992.09l-.01-.09V8.786l-.004-.04V3.087a.5.5 0 01.992-.09l.01.09z"}),Object(x.jsx)("path",{d:"M4.55 15.829a1.5 1.5 0 001.06-.44l2.122-2.121a.5.5 0 10-.707-.707l-2.121 2.121a.5.5 0 01-.708 0l-2.12-2.121a.5.5 0 00-.708.707l2.121 2.121a1.5 1.5 0 001.061.44zM13.5 4a.5.5 0 01.5.5v7a.5.5 0 11-1 0v-7a.5.5 0 01.5-.5zM10.5 6.5a.5.5 0 011 0v5a.5.5 0 11-1 0v-5zM8.5 8a.5.5 0 00-.5.5v3a.5.5 0 101 0v-3a.5.5 0 00-.5-.5z"})),Fn=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M4.99991 7.49999C4.99991 7.22384 5.22376 6.99999 5.49991 6.99999C5.77605 6.99999 5.99991 7.22384 5.99991 7.49999V14.5C5.99991 14.7761 5.77605 15 5.49991 15C5.22376 15 4.99991 14.7761 4.99991 14.5V7.49999Z"}),Object(x.jsx)("path",{d:"M15.3893 2.38929C15.6706 2.67059 15.8287 3.05212 15.8287 3.44995C15.8287 3.84777 15.6706 4.2293 15.3893 4.51061L13.268 6.63193C13.1742 6.7257 13.0471 6.77838 12.9145 6.77838C12.7818 6.77838 12.6547 6.7257 12.5609 6.63193C12.4671 6.53816 12.4145 6.41098 12.4145 6.27838C12.4145 6.14577 12.4671 6.01859 12.5609 5.92482L14.6822 3.8035C14.776 3.70973 14.8287 3.58256 14.8287 3.44995C14.8287 3.31734 14.776 3.19016 14.6822 3.09639L12.5609 0.975075C12.4671 0.881307 12.4145 0.754129 12.4145 0.621522C12.4145 0.488914 12.4671 0.361736 12.5609 0.267968C12.6547 0.1742 12.7819 0.121521 12.9145 0.121521C13.0471 0.121521 13.1742 0.1742 13.268 0.267968L15.3893 2.38929Z"}),Object(x.jsx)("path",{d:"M3.43867 0.26864C3.53243 0.362408 3.58511 0.489585 3.58511 0.622193C3.58511 0.754801 3.53243 0.881978 3.43867 0.975746L1.31735 3.09707C1.22358 3.19083 1.1709 3.31801 1.1709 3.45062C1.1709 3.58323 1.22358 3.71041 1.31735 3.80417L3.43867 5.92549C3.53243 6.01926 3.58511 6.14644 3.58511 6.27905C3.58511 6.41166 3.53243 6.53883 3.43867 6.6326C3.3449 6.72637 3.21772 6.77905 3.08511 6.77905C2.9525 6.77905 2.82533 6.72637 2.73156 6.6326L0.610239 4.51128C0.328934 4.22998 0.170898 3.84844 0.170898 3.45062C0.170898 3.0528 0.328934 2.67126 0.610238 2.38996L2.73156 0.26864C2.82533 0.174871 2.9525 0.122192 3.08511 0.122192C3.21772 0.122192 3.3449 0.174871 3.43867 0.26864Z"}),Object(x.jsx)("path",{d:"M7.99991 6.99999C8.27605 6.99999 8.49991 7.22384 8.49991 7.49999V12.5C8.49991 12.7761 8.27605 13 7.99991 13C7.72377 13 7.49991 12.7761 7.49991 12.5V7.49999C7.49991 7.22384 7.72377 6.99999 7.99991 6.99999Z"}),Object(x.jsx)("path",{d:"M10.9999 7.49999C10.9999 7.22384 10.776 6.99999 10.4999 6.99999C10.2238 6.99999 9.99991 7.22384 9.99991 7.49999V10.5C9.99991 10.7761 10.2238 11 10.4999 11C10.776 11 10.9999 10.7761 10.9999 10.5V7.49999Z"}),Object(x.jsx)("path",{d:"M3.50015 2.99999C3.22401 2.99999 3.00015 3.22384 3.00015 3.49999C3.00015 3.77613 3.22401 3.99999 3.50015 3.99999H12.5002C12.7763 3.99999 13.0002 3.77613 13.0002 3.49999C13.0002 3.22384 12.7763 2.99999 12.5002 2.99999H3.50015Z"})),Pn=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M8.622 3.585a.5.5 0 01-.353-.854L10.39.611a1.5 1.5 0 012.121 0l2.122 2.12a.5.5 0 11-.707.707l-2.122-2.12a.5.5 0 00-.707 0l-2.121 2.12a.5.5 0 01-.354.147z"}),Object(x.jsx)("path",{d:"M11.95 12.915V8.786l.005-.04V3.087a.5.5 0 00-.992-.09l-.01.09v4.129l-.004.04v5.658a.5.5 0 00.992.09l.01-.09z"}),Object(x.jsx)("path",{d:"M11.45 15.829a1.5 1.5 0 01-1.06-.44l-2.122-2.121a.5.5 0 11.707-.707l2.121 2.121a.5.5 0 00.707 0l2.122-2.121a.5.5 0 01.707.707l-2.121 2.121a1.5 1.5 0 01-1.061.44zM2.5 4a.5.5 0 00-.5.5v7a.5.5 0 101 0v-7a.5.5 0 00-.5-.5zM5.5 6.5a.5.5 0 00-1 0v5a.5.5 0 101 0v-5zM7.5 8a.5.5 0 01.5.5v3a.5.5 0 11-1 0v-3a.5.5 0 01.5-.5z"}));function _n(e,t){return e.id===t.id}function An(e,t){const a={auto:[],left:[],right:[],bottom:[]};return null==e||e.forEach((e=>{const n=null==t?void 0:t[e.layerId];e.accessors.forEach((t=>{var i,s,l,r;const o=(null===(i=e.yConfig)||void 0===i||null===(s=i.find((e=>e.forAccessor===t)))||void 0===s?void 0:s.axisMode)||"auto";let u=(null==n||null===(l=n.columns.find((e=>e.id===t)))||void 0===l||null===(r=l.meta)||void 0===r?void 0:r.params)||{id:"number"};e.seriesType.includes("percentage")&&"percent"!==u.id&&(u={id:"percent",params:{pattern:"0.[00]%"}}),a[o].push({layer:e.layerId,accessor:t,fieldFormat:u})}))})),a.auto.forEach((e=>{0===a.left.length||t&&a.left.every((t=>_n(t.fieldFormat,e.fieldFormat)))?a.left.push(e):0===a.right.length||t&&a.left.every((t=>_n(t.fieldFormat,e.fieldFormat)))?a.right.push(e):a.right.length>=a.left.length?a.left.push(e):a.right.push(e)})),a}a(245);const Ln=[{id:"xy_axis_orientation_horizontal",value:0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.horizontal",{defaultMessage:"Horizontal"})},{id:"xy_axis_orientation_vertical",value:-90,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.vertical",{defaultMessage:"Vertical"})},{id:"xy_axis_orientation_angled",value:-45,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.angled",{defaultMessage:"Angled"})}],Dn=({layers:e,axis:t,axisTitle:a,updateTitleState:n,toggleTickLabelsVisibility:i,toggleGridlinesVisibility:l,isDisabled:r,areTickLabelsVisible:o,areGridlinesVisible:c,isAxisTitleVisible:d,orientation:p,setOrientation:m,setEndzoneVisibility:g,endzonesVisible:f,setCurrentTimeMarkerVisibility:v,currentTimeMarkerVisible:h,extent:y,setExtent:j,hasBarOrAreaOnAxis:O,hasPercentageAxis:I,dataBounds:T,useMultilayerTimeAxis:M,scale:w,setScale:C})=>{const E=!(null==e||!e.length)&&mn(e),S=((e,t)=>{switch(e){case"yLeft":return{icon:t?En:Sn,groupPosition:"left",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}):u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}),buttonDataTestSubj:"lnsLeftAxisButton"};case"yRight":return{icon:t?Fn:Pn,groupPosition:"right",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.topAxisLabel",{defaultMessage:"Top axis"}):u.i18n.translate("xpack.lens.xyChart.rightAxisLabel",{defaultMessage:"Right axis"}),buttonDataTestSubj:"lnsRightAxisButton"};default:return{icon:t?Sn:En,groupPosition:"center",popoverTitle:t?u.i18n.translate("xpack.lens.xyChart.leftAxisLabel",{defaultMessage:"Left axis"}):u.i18n.translate("xpack.lens.xyChart.bottomAxisLabel",{defaultMessage:"Bottom axis"}),buttonDataTestSubj:"lnsBottomAxisButton"}}})(t,E),F=Object(s.useCallback)((e=>{if(j&&e&&!Object(qt.isEqual)(e,y)){const{inclusiveZeroError:a,boundaryError:n}=function(e,t){return{inclusiveZeroError:e&&!Object(k.u)(t),boundaryError:!Object(k.t)(t)}}(O,e);"x"!==t&&"custom"===e.mode&&(n||a)||j(e)}}),[y,t,O,j]),{inputValue:P,handleInputChange:_}=Object(Z.a)({value:y,onChange:F});return Object(x.jsx)(k.i,{title:S.popoverTitle,type:S.icon,groupPosition:S.groupPosition,isDisabled:r,buttonDataTestSubj:S.buttonDataTestSubj,panelClassName:"lnsVisToolbarAxis__popover"},Object(x.jsx)(k.c,{axis:t,axisTitle:a,updateTitleState:n,isAxisTitleVisible:d}),Object(x.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),fullWidth:!0},Object(x.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":`lnsshow${t}AxisGridlines`,label:u.i18n.translate("xpack.lens.xyChart.Gridlines",{defaultMessage:"Gridlines"}),onChange:()=>l(t),checked:c,showLabel:!1})),Object(x.jsx)(k.b,{axis:t,updateTicksVisibilityState:e=>{i(t)},isAxisLabelVisible:o}),!M&&o&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisOrientation.label",{defaultMessage:"Orientation"}),"data-test-subj":"lnsXY_axisOrientation_groups",name:"axisOrientation",buttonSize:"compressed",options:Ln,idSelected:Ln.find((({value:e})=>e===p)).id,onChange:e=>{const a=Ln.find((({id:t})=>t===e)).value;m(t,a)}})),g&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),fullWidth:!0},Object(x.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowEndzones",label:u.i18n.translate("xpack.lens.xyChart.showEnzones",{defaultMessage:"Show partial data markers"}),onChange:()=>g(!Boolean(f)),checked:Boolean(f),showLabel:!1})),v&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.xyChart.showCurrenTimeMarker",{defaultMessage:"Show current time marker"}),fullWidth:!0},Object(x.jsx)(b.EuiSwitch,{compressed:!0,"data-test-subj":"lnsshowCurrentTimeMarker",label:u.i18n.translate("xpack.lens.xyChart.showCurrenTimeMarker",{defaultMessage:"Show current time marker"}),onChange:()=>v(!Boolean(h)),checked:Boolean(h),showLabel:!1})),C&&Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),fullWidth:!0},Object(x.jsx)(b.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"lnsshowEndzones","aria-label":u.i18n.translate("xpack.lens.xyChart.setScale",{defaultMessage:"Axis scale"}),options:[{text:u.i18n.translate("xpack.lens.xyChart.scaleLinear",{defaultMessage:"Linear"}),value:"linear"},{text:u.i18n.translate("xpack.lens.xyChart.scaleLog",{defaultMessage:"Logarithmic"}),value:"log"},{text:u.i18n.translate("xpack.lens.xyChart.scaleSquare",{defaultMessage:"Square root"}),value:"sqrt"}],onChange:e=>C(e.target.value),value:w})),P&&_&&Object(x.jsx)(k.a,{type:"x"!==t?"metric":"bucket",extent:P,setExtent:_,dataBounds:T,shouldIncludeZero:O,disableCustomRange:I,testSubjPrefix:"lnsXY",canHaveNiceValues:"x"!==t||Boolean(y)}))},Rn=[{id:"None",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.none",{defaultMessage:"Do not fill gaps"})},{id:"Zero",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.zero",{defaultMessage:"Fill gaps with zeros"})},{id:"Linear",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.linear",{defaultMessage:"Linear"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.linear",{defaultMessage:"Fill gaps with a line"})},{id:"Carry",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.carry",{defaultMessage:"Last"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.carry",{defaultMessage:"Fill gaps with the last value"})},{id:"Lookahead",title:u.i18n.translate("xpack.lens.fittingFunctionsTitle.lookahead",{defaultMessage:"Next"}),description:u.i18n.translate("xpack.lens.fittingFunctionsDescription.lookahead",{defaultMessage:"Fill gaps with the next value"})}],Bn=[{id:"None",title:u.i18n.translate("xpack.lens.endValue.none",{defaultMessage:"Hide"}),description:u.i18n.translate("xpack.lens.endValueDescription.none",{defaultMessage:"Do not extend series to the edge of the chart"})},{id:"Zero",title:u.i18n.translate("xpack.lens.endValue.zero",{defaultMessage:"Zero"}),description:u.i18n.translate("xpack.lens.endValueDescription.zero",{defaultMessage:"Extend series as zero to the edge of the chart"})},{id:"Nearest",title:u.i18n.translate("xpack.lens.endValue.nearest",{defaultMessage:"Nearest"}),description:u.i18n.translate("xpack.lens.endValueDescription.nearest",{defaultMessage:"Extend series with the first/last value to the edge of the chart"})}],Nn=({onFittingFnChange:e,fittingFunction:t,emphasizeFitting:a,onEmphasizeFittingChange:n,onEndValueChange:i,endValue:s,isFittingEnabled:r=!0})=>Object(x.jsx)(l.a.Fragment,null,r&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:Object(x.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.xyChart.missingValuesLabel",{defaultMessage:"Missing values"})," ",Object(x.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.xyChart.missingValuesLabelHelpText",{defaultMessage:"By default, area and line charts hide the gaps in the data. To fill the gap, make a selection."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"}))},Object(x.jsx)(b.EuiSuperSelect,{"data-test-subj":"lnsMissingValuesSelect",compressed:!0,options:Rn.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("strong",null,t),Object(x.jsx)(b.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t||"None",onChange:t=>e(t),itemLayoutAlign:"top",hasDividers:!0})),t&&"None"!==t&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.endValuesLabel",{defaultMessage:"End values"})},Object(x.jsx)(b.EuiSuperSelect,{"data-test-subj":"lnsEndValuesSelect",compressed:!0,options:Bn.map((({id:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("strong",null,t),Object(x.jsx)(b.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:s||"None",onChange:e=>i(e),itemLayoutAlign:"top",hasDividers:!0})),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),display:"columnCompressedSwitch"},Object(x.jsx)(b.EuiSwitch,{showLabel:!1,label:u.i18n.translate("xpack.lens.xyChart.missingValuesStyle",{defaultMessage:"Show as dotted line"}),checked:!a,onChange:()=>{n(!a)},compressed:!0}))))),zn=[{type:z.XYCurveTypes.LINEAR,title:u.i18n.translate("xpack.lens.lineCurve.straight",{defaultMessage:"Straight"}),description:u.i18n.translate("xpack.lens.lineCurveDescription.straight",{defaultMessage:"Straight line between points"})},{type:z.XYCurveTypes.CURVE_MONOTONE_X,title:u.i18n.translate("xpack.lens.lineCurve.smooth",{defaultMessage:"Smooth"}),description:u.i18n.translate("xpack.lens.lineCurveDescription.smooth",{defaultMessage:"Smoothed line between points"})},{type:z.XYCurveTypes.CURVE_STEP_AFTER,title:u.i18n.translate("xpack.lens.lineCurve.step",{defaultMessage:"Step"}),description:u.i18n.translate("xpack.lens.lineCurveDescription.step",{defaultMessage:"Stepped line between points"})}],Vn=({onChange:e,value:t=z.XYCurveTypes.LINEAR,enabled:a=!0})=>a?Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.lineInterpolationLabel",{defaultMessage:"Line interpolation"})},Object(x.jsx)(b.EuiSuperSelect,{"data-test-subj":"lnsCurveStyleSelect",compressed:!0,options:zn.map((({type:e,title:t,description:a})=>({value:e,dropdownDisplay:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("strong",null,t),Object(x.jsx)(b.EuiText,{size:"xs",color:"subdued"},Object(x.jsx)("p",null,a))),inputDisplay:t}))),valueOfSelected:t,onChange:e,itemLayoutAlign:"top",hasDividers:!0})):null,Gn=({onChange:e,value:t,isFillOpacityEnabled:a=!0})=>{const{inputValue:n,handleInputChange:i}=Object(Z.a)({value:t,onChange:e});return a?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.xyChart.fillOpacityLabel",{defaultMessage:"Fill opacity"}),fullWidth:!0},Object(x.jsx)(b.EuiRange,{"data-test-subj":"lnsFillOpacity",value:n,min:.1,max:1,step:.1,showInput:!0,compressed:!0,fullWidth:!0,onChange:e=>{i(Number(e.currentTarget.value))}}))):null},qn=({state:e,setState:t,datasourceLayers:a})=>{var n,i;const s=Va(e.layers),l=s.some((({seriesType:e})=>"area_percentage_stacked"===e)),r=s.some((({seriesType:e})=>["area_stacked","area","line","area_percentage_stacked"].includes(e))),o=s.some((({seriesType:e})=>["area_stacked","area","area_percentage_stacked"].includes(e))),c=Boolean(function(e=[],t){return!!t&&e.filter((({accessors:e})=>e.length)).some((({layerId:e,xAccessor:a})=>{var n;if(!a)return!1;const i=null===(n=t[e])||void 0===n?void 0:n.getOperationForColumnId(a);return i&&i.isBucketed&&i.scale&&"ordinal"!==i.scale}))}(s,a)),d=!r,p=r&&!l,m=r||l,g=function({isAreaPercentage:e,isHistogramSeries:t}){return t?u.i18n.translate("xpack.lens.xyChart.valuesHistogramDisabledHelpText",{defaultMessage:"This setting cannot be changed on histograms."}):e?u.i18n.translate("xpack.lens.xyChart.valuesPercentageDisabledHelpText",{defaultMessage:"This setting cannot be changed on percentage area charts."}):u.i18n.translate("xpack.lens.xyChart.valuesStackedDisabledHelpText",{defaultMessage:"This setting cannot be changed on stacked or percentage bar charts"})}({isAreaPercentage:l,isHistogramSeries:c}),f=!d&&!p&&!m;return Object(x.jsx)(be.a,{tooltipContent:g,condition:f},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton",isDisabled:f},Object(x.jsx)(Vn,{enabled:m,value:null==e?void 0:e.curveType,onChange:a=>{t({...e,curveType:a})}}),Object(x.jsx)(k.j,{isVisible:d,valueLabels:null!==(n=null==e?void 0:e.valueLabels)&&void 0!==n?n:"hide",onValueLabelChange:a=>{t({...e,valueLabels:a})}}),Object(x.jsx)(Nn,{isFittingEnabled:p,fittingFunction:null==e?void 0:e.fittingFunction,emphasizeFitting:null==e?void 0:e.emphasizeFitting,endValue:null==e?void 0:e.endValue,onFittingFnChange:a=>{t({...e,fittingFunction:a})},onEmphasizeFittingChange:a=>{t({...e,emphasizeFitting:a})},onEndValueChange:a=>{t({...e,endValue:a})}}),Object(x.jsx)(Gn,{isFillOpacityEnabled:o,value:null!==(i=null==e?void 0:e.fillOpacity)&&void 0!==i?i:.3,onChange:a=>{t({...e,fillOpacity:a})}})))};var Hn=a(14),Un=a.n(Hn);const $n=864e13,Wn=-864e13,Xn=u.i18n.translate("xpack.lens.xyChart.defaultAnnotationLabel",{defaultMessage:"Event"}),Yn=(u.i18n.translate("xpack.lens.xyChart.defaultRangeAnnotationLabel",{defaultMessage:"Event range"}),(e,t)=>Boolean(e.length&&e.every((e=>e.xAccessor&&Na("interval","date",(null==t?void 0:t.datasourceLayers)||{})(e)))));function Qn(e,t){const a=e.map((({layerId:e})=>e)),{activeData:n,dateRange:i}=t,s=Un()(i.fromDate).valueOf(),l=Un()(i.toDate).valueOf(),r=Un()((s+l)/2).toISOString();if(!n||Object.entries(n).filter((([e])=>a.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return r;const o=(a.reduce(((t,a)=>{var i,s,l,r;const o=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,u=null===(s=n[a])||void 0===s||null===(l=s.rows)||void 0===l||null===(r=l[0])||void 0===r?void 0:r[o];return u&&u<t?u:t}),$n)+a.reduce(((t,a)=>{var i,s,l,r,o,u;const c=null===(i=e.find((e=>e.layerId===a)))||void 0===i?void 0:i.xAccessor,d=null===(s=n[a])||void 0===s||null===(l=s.rows)||void 0===l||null===(r=l[(null==n||null===(o=n[a])||void 0===o||null===(u=o.rows)||void 0===u?void 0:u.length)-1])||void 0===r?void 0:r[c];return d&&d>t?d:t}),Wn))/2;return s<o&&l>o?Un()(o).toISOString():r}const Kn=(e,t)=>{const a=Va((null==e?void 0:e.layers)||[]),n=Yn(a,t),i=e&&n?[{groupId:"xAnnotations",columnId:Object(nt.a)()}]:void 0;return{type:z.LayerTypes.ANNOTATIONS,label:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabel",{defaultMessage:"Annotations"}),icon:Ta,disabled:!n,toolTipContent:n?void 0:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),initialDimensions:i,noDatasource:!0}},Zn=({prevState:e,frame:t,source:a,target:n,dropType:i})=>{const s=e.layers.find((e=>e.layerId===n.layerId));if(!s||!Ha(s))return e;const l=s.annotations.find((({id:e})=>e===n.columnId)),r=t.dataViews.indexPatterns[s.indexPatternId];if(Object(st.isDraggedDataViewField)(a)){const t=r.timeFieldName;switch(i){case"field_add":return l||!t?e:{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:[...s.annotations,Object(Ma.d)(n.columnId,a.field.name,t)]}:e))};case"field_replace":return l&&t?{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?{...l,...Object(Ma.d)(n.columnId,a.field.name,t)}:e))]}:e))}:e}return e}const o=e.layers.find((e=>e.layerId===a.layerId));if(!o||!Ha(o))return e;const u=o.annotations.find((({id:e})=>e===a.columnId));if(t.dataViews.indexPatterns[o.indexPatternId]!==r&&Object(Ma.f)(u))return e;switch(i){case"reorder":if(!l||!u||a.layerId!==n.layerId)return e;const i=s.annotations.filter((e=>e.id!==u.id)),r=i.findIndex((e=>e.id===l.id)),c=s.annotations.indexOf(u),d=s.annotations.indexOf(l);return i.splice(c<d?r+1:r,0,u),{...e,layers:e.layers.map((e=>e.layerId===n.layerId?{...s,annotations:i}:e))};case"swap_compatible":return l&&u?{...e,layers:e.layers.map((e=>Ha(e)&&Ha(s)?e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?u:e))]}:e.layerId===a.layerId?{...o,annotations:[...o.annotations.map((e=>e===u?l:e))]}:e:e))}:e;case"replace_compatible":return l&&u?{...e,layers:e.layers.map((e=>e.layerId===a.layerId?{...o,annotations:o.annotations.filter((e=>e!==u))}:e.layerId===n.layerId?{...s,annotations:[...s.annotations.map((e=>e===l?u:e))]}:e))}:e;case"duplicate_compatible":return l?e:{...e,layers:e.layers.map((a=>a.layerId===n.layerId?{...s,annotations:[...s.annotations,Object(Ma.a)(n.columnId,Qn(Va(e.layers),t),u)]}:a))};case"replace_duplicate_compatible":return l?{...e,layers:e.layers.map((a=>a.layerId===n.layerId?{...s,annotations:[...s.annotations.map((a=>a===l?Object(Ma.a)(n.columnId,Qn(Va(e.layers),t),u):a))]}:a))}:e;case"move_compatible":return l||!u?e:{...e,layers:e.layers.map((e=>e.layerId===a.layerId?{...o,annotations:o.annotations.filter((e=>e!==u))}:e.layerId===n.layerId?{...s,annotations:[...s.annotations,u]}:e))};default:return e}},Jn=e=>e.annotations.map((e=>Ca(e))),ei=e=>{const t=Ya(e),a={},n=Object(st.getUniqueLabelGenerator)();return t.forEach((e=>{e.annotations&&e.annotations.forEach((e=>{a[e.id]=n(e.label)}))})),a};function ti(e,t,a){const n=e.some(Na("interval","number",t)),{right:i,left:s}=An(e,a);return{x:e.some((({xAccessor:e})=>null!=e))&&n,yLeft:s.length>0,yRight:i.length>0}}function ai(e,t,{activeData:a},n){if(!a)return 100;const{dataLayers:i,untouchedDataLayers:s,accessors:l}=function(e,t,a){switch(e){case"x":{const e=t.filter((({xAccessor:e})=>e));return{dataLayers:e.map((({accessors:e,xAccessor:t,...a})=>({...a,accessors:[t]}))),untouchedDataLayers:e,accessors:e.map((({xAccessor:e})=>e))}}case"yLeft":case"yRight":{const n="yLeft"===e?"left":"right",{[n]:i}=An(t,a),s=new Set(i.map((({layer:e})=>e))),l=t.filter((({layerId:e})=>s.has(e)));return{dataLayers:l,untouchedDataLayers:l,accessors:i.map((({accessor:e})=>e))}}}}(t,e,a);if("x"===t&&i.length&&!s.some(n))return 100;const r=function(e,t,a,n=!0,i=!0){if(e.length&&t.length){if(e.some((({seriesType:e})=>function(e){return"bar_percentage_stacked"===e||"bar_horizontal_percentage_stacked"===e||"area_percentage_stacked"===e}(e))))return.75;const{min:s,max:l}=function(e,t,a,n=!0){const i=new Set(t);let s,l;const[r,o]=Object(qt.partition)(e,(({seriesType:e})=>function(e){return e.includes("stacked")}(e)&&n));for(const{layerId:e,accessors:t}of o){const n=a[e];if(n)for(const e of t)if(i.has(e))for(const t of n.rows){const a=t[e];"number"==typeof a&&(l=null!=l?Math.max(a,l):a,s=null!=s?Math.min(a,s):a)}}const u={};for(const{layerId:e,accessors:t,xAccessor:n}of r){const s=a[e];if(s)for(const e of t)if(i.has(e))for(const t of s.rows){const a=t[e];let i="shared";var c;n&&(i=t[n]),"number"==typeof a&&(u[i]=null!==(c=u[i])&&void 0!==c?c:0,u[i]+=a)}}for(const e of Object.values(u))l=Math.max(e,l||0,0),s=Math.min(e,s||0,0);return{min:s,max:l}}(e,t,a,i);if(null!=s&&null!=l&&isFinite(s)&&isFinite(l)){const e=n?Math.min(0,s):s;return Number((e+.75*(l-e)).toFixed(2))}}}(i,l,a,"x"!==t,"x"!==t);return null!=r?r:100}const ni=(e,t)=>{const a=function(e,t,a,n){if(!t)return[];const i=ti(Va(t.layers),a,n);return[{id:"yReferenceLineLeft",label:"yLeft"},{id:"yReferenceLineRight",label:"yRight"},{id:"xReferenceLine",label:"x"}].filter((({label:e})=>i[e]))}(0,e,(null==t?void 0:t.datasourceLayers)||{},null==t?void 0:t.activeData),n=(null==e?void 0:e.layers)||[],i=Va(n),s=i.filter((({accessors:e,xAccessor:t})=>e.length||t)),l=Na("interval","number",(null==t?void 0:t.datasourceLayers)||{}),r=e?a.map((({id:e,label:a})=>({groupId:e,columnId:Object(nt.a)(),dataType:"number",label:Ba(a,{isHorizontal:mn(n)}),staticValue:ai(i,a,{activeData:null==t?void 0:t.activeData},l)}))):void 0;return{type:z.LayerTypes.REFERENCELINE,label:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabel",{defaultMessage:"Reference lines"}),icon:ka,disabled:!s.length||!i.some(l)&&i.every((({accessors:e})=>!e.length)),toolTipContent:s.length?void 0:u.i18n.translate("xpack.lens.xyChart.addReferenceLineLayerLabelDisabledHelp",{defaultMessage:"Add some data to enable reference layer"}),initialDimensions:r}},ii=(e,t=ri,a)=>({columnId:e,triggerIconType:a&&"empty"!==a?"custom":"color",color:t,customIcon:a}),si=({state:e,frame:t,layer:a,sortedAccessors:n})=>{const i=n.reduce(((e,t,a)=>(e[t]=a,e)),{}),{bottom:s,left:l,right:r}=Object(qt.groupBy)([...a.yConfig||[]].sort((({forAccessor:e},{forAccessor:t})=>i[e]-i[t])),(({axisMode:e})=>e)),o=function(e,t,a,n){if(!t)return[];const i=ti(Va(t.layers),a,n);return e.filter((({label:e,config:t})=>i[e]||(null==t?void 0:t.length))).map((e=>({...e,valid:i[e.label]})))}([{config:l,id:"yReferenceLineLeft",label:"yLeft",dataTestSubj:"lnsXY_yReferenceLineLeftPanel"},{config:r,id:"yReferenceLineRight",label:"yRight",dataTestSubj:"lnsXY_yReferenceLineRightPanel"},{config:s,id:"xReferenceLine",label:"x",dataTestSubj:"lnsXY_xReferenceLinePanel"}],e,t.datasourceLayers,t.activeData),c=mn(e.layers);return{groups:o.map((({config:e=[],id:t,label:a,dataTestSubj:n,valid:i})=>({groupId:t,groupLabel:Ba(a,{isHorizontal:c}),dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.indexPattern.referenceLineDimensionEditorLabel",{defaultMessage:"{groupLabel} reference line",values:{groupLabel:Ba(a,{isHorizontal:c})}}),accessors:e.map((({forAccessor:e,color:t,icon:a})=>ii(e,t,a))),filterOperations:un,supportsMoreColumns:!0,requiredMinDimensionCount:0,enableDimensionEditor:!0,supportStaticValue:!0,paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.indexPattern.staticValue.label",{defaultMessage:"Reference line value"})],headingLabel:u.i18n.translate("xpack.lens.staticValue.headingLabel",{defaultMessage:"Placement"})},supportFieldFormat:!1,dataTestSubj:n,invalid:!i,invalidMessage:"x"===a?u.i18n.translate("xpack.lens.configure.invalidBottomReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists or is no longer valid. You may move this reference line to another available axis or remove it."}):u.i18n.translate("xpack.lens.configure.invalidReferenceLineDimension",{defaultMessage:"This reference line is assigned to an axis that no longer exists. You may move this reference line to another available axis or remove it."}),requiresPreviousColumnOnDuplicate:!0})))}},li=e=>null!=e&&"object"!=typeof e,ri=re.euiLightVars.euiColorDarkShade;function oi(e,t,a){const n={};return e.filter(za).forEach((e=>{var t;const a=(null===(t=e.palette)||void 0===t?void 0:t.name)||"default";n[a]||(n[a]=[]),n[a].push(e)})),Object(qt.mapValues)(n,(e=>{const n=e.map(((e,n)=>{var i;if(e.collapseFn||!e.splitAccessor)return{numberOfSeries:e.accessors.length,splits:[]};const s=e.splitAccessor,l=null===(i=t.tables[e.layerId])||void 0===i?void 0:i.columns.find((({id:e})=>e===s)),r=l&&a(l.meta.params),o=l&&t.tables[e.layerId]?Object(qt.uniq)(t.tables[e.layerId].rows.map((e=>{let t=e[s];var a;return t=t&&!li(t)?null!==(a=null==r?void 0:r.convert(t))&&void 0!==a?a:t:String(t),t}))):[];return{numberOfSeries:(o.length||1)*e.accessors.length,splits:o}}));return{totalSeriesCount:n.reduce(((e,t)=>e+t.numberOfSeries),0),getRank(t,a,i){const s=e.findIndex((e=>t.layerId===e.layerId)),l=n[s].splits.indexOf(a);return(0===s?0:n.slice(0,s).reduce(((e,t)=>e+t.numberOfSeries),0))+(t.splitAccessor&&-1!==l?l*t.accessors.length:0)+t.accessors.indexOf(i)}}}))}function ui(e){return{columnId:e,triggerIconType:"disabled"}}function ci(e,t,a,n,i){var s;if(Ga(e))return ii(t);if(Ha(e)){const a=e.annotations.find((e=>e.id===t));return{columnId:t,triggerIconType:null!=a&&a.isHidden?"invisible":"color",color:Object(Ma.g)(a)?Ma.c:Ma.b}}const l=za(e)&&!e.collapseFn&&e.splitAccessor,r=e.palette||{type:"palette",name:"default"},o=null===(s=a[r.name])||void 0===s?void 0:s.totalSeriesCount;if(l)return ui(t);const u=bn(e,n.datasourceLayers[e.layerId]),c=a[r.name].getRank(e,u[t]||t,t),d=null!=o?i.get(r.name).getCategoricalColor([{name:u[t]||t,rankAtDepth:c,totalSeriesAtDepth:o}],{maxDepth:1,totalSeries:o},r.params):void 0;return{columnId:t,triggerIconType:d?"color":"disabled",color:null!=d?d:void 0}}function di(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const pi=Object(b.htmlIdGenerator)()();function mi(e){var t,a,n,r;const{state:o,layerId:c,accessor:d,darkMode:m,isInlineEditing:g}=e,f=o.layers.findIndex((e=>e.layerId===c)),v=o.layers[f],h=!!v.colorMapping,[y,j]=Object(s.useState)(!1),[O,I]=Object(s.useState)(h),{inputValue:T,handleInputChange:M}=Object(Z.a)({value:e.state,onChange:e.setState}),w=null==v||null===(t=v.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===d)),C=(null==w?void 0:w.axisMode)||"auto",E=Object(s.useCallback)((e=>{if(null==e)return;const t=[...v.yConfig||[]],a=t.findIndex((e=>e.forAccessor===d));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:d,...e}),M(di(T,{...v,yConfig:t},f))}),[d,f,T,v,M]),S=Object(s.useCallback)((e=>{M(di(T,{...v,colorMapping:e},f))}),[f,T,v,M]),F=Object(s.useCallback)((e=>{M(di(T,{...v,palette:e},f))}),[f,T,v,M]),P=fn(v,d),_=Object(s.useMemo)((()=>{var t;const a=Oi(e.frame.datasourceLayers[v.layerId],v),n=oi(Va(o.layers),{tables:null!==(t=e.frame.activeData)&&void 0!==t?t:{}},e.formatFactory);return ci({...v,accessors:a.filter((e=>v.accessors.includes(e)))},d,n,e.frame,e.paletteService).color}),[e.frame,e.paletteService,o.layers,d,e.formatFactory,v]),A=v,L=v.colorMapping?Object(xt.c)(e.darkMode,v.colorMapping):e.paletteService.get((null===(a=v.palette)||void 0===a?void 0:a.name)||"default").getCategoricalColors(10,v.palette),D=null===(n=e.frame.activeData)||void 0===n?void 0:n[v.layerId],{splitAccessor:R}=v,B=da(null!==(r=null==D?void 0:D.rows)&&void 0!==r?r:[],R);var N;if("breakdown"===e.groupId&&!v.collapseFn)return Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.colorMapping.editColorMappingSectionlabel",{defaultMessage:"Color mapping"}),style:{alignItems:"center"}},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lns_dynamicColoring_edit",palette:L,type:"fixed",onClick:()=>{j(!y)}})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonIcon,{"data-test-subj":"lns_colorEditing_trigger","aria-label":u.i18n.translate("xpack.lens.colorMapping.editColorMappingButton",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{j(!y)},size:"xs"}),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:y,handleClose:()=>j(!y),title:O?u.i18n.translate("xpack.lens.colorMapping.editColorMappingTitle",{defaultMessage:"Edit colors by term mapping"}):u.i18n.translate("xpack.lens.colorMapping.editColorsTitle",{defaultMessage:"Edit colors"}),isInlineEditing:g},Object(x.jsx)("div",{className:"lnsPalettePanel__section lnsPalettePanel__section--shaded lnsIndexPatternDimensionEditor--padded"},Object(x.jsx)(b.EuiFlexGroup,{direction:"column",gutterSize:"s",justifyContent:"flexStart"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.colorMapping.tryLabel",{defaultMessage:"Use the new Color Mapping feature"})," ",Object(x.jsx)(b.EuiBadge,{color:"hollow"},u.i18n.translate("xpack.lens.colorMapping.techPreviewLabel",{defaultMessage:"Tech preview"})))),"data-test-subj":"lns_colorMappingOrLegacyPalette_switch",compressed:!0,checked:O,onChange:({target:{checked:e}})=>{Object(p.d)("color_mapping_switch_"+(e?"enabled":"disabled")),S(e?{...xt.a}:void 0),I(e)}}),Object(x.jsx)(b.EuiSpacer,{size:"s"})),Object(x.jsx)(b.EuiFlexItem,null,h||O?Object(x.jsx)(categorical_color_mapping_CategoricalColorMapping,{isDarkMode:m,model:null!==(N=v.colorMapping)&&void 0!==N?N:{...xt.a},onModelUpdate:e=>S(e),palettes:ra.a,data:{type:"categories",categories:B},specialTokens:oa.a}):Object(x.jsx)(k.g,{palettes:e.paletteService,activePalette:null==A?void 0:A.palette,setPalette:e=>{F(e)}}))))))));const z=mn(o.layers),V=Boolean(!A.collapseFn&&A.splitAccessor)?u.i18n.translate("xpack.lens.xyChart.colorPicker.tooltip.disabled",{defaultMessage:'You are unable to apply custom colors to individual series when the layer includes a "Break down by" field.'}):void 0;return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(ua.a,i()({},e,{overwriteColor:P,defaultColor:_,disabledMessage:V,setConfig:E})),Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.axisSide.label",{defaultMessage:"Axis side"}),"data-test-subj":"lnsXY_axisSide_groups",name:"axisSide",buttonSize:"compressed",options:[{id:`${pi}left`,label:z?u.i18n.translate("xpack.lens.xyChart.axisSide.bottom",{defaultMessage:"Bottom"}):u.i18n.translate("xpack.lens.xyChart.axisSide.left",{defaultMessage:"Left"}),"data-test-subj":"lnsXY_axisSide_groups_left"},{id:`${pi}auto`,label:u.i18n.translate("xpack.lens.xyChart.axisSide.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_axisSide_groups_auto"},{id:`${pi}right`,label:z?u.i18n.translate("xpack.lens.xyChart.axisSide.top",{defaultMessage:"Top"}):u.i18n.translate("xpack.lens.xyChart.axisSide.right",{defaultMessage:"Right"}),"data-test-subj":"lnsXY_axisSide_groups_right"}],idSelected:`${pi}${C}`,onChange:e=>{const t=e.replace(pi,"");E({axisMode:t})}})))}function gi(e){const{state:t,layerId:a}=e,n=t.layers.findIndex((e=>e.layerId===a)),i=t.layers[n],{inputValue:s,handleInputChange:r}=Object(Z.a)({value:e.state,onChange:e.setState});return"breakdown"===e.groupId?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(W,{value:i.collapseFn||"",onChange:e=>{r(di(s,{...i,collapseFn:e},n))}})):null}function fi(e){return null!=e&&"empty"!==e}const bi=u.i18n.translate("xpack.lens.xyChart.markerPosition.above",{defaultMessage:"Top"}),vi=u.i18n.translate("xpack.lens.xyChart.markerPosition.below",{defaultMessage:"Bottom"}),hi=u.i18n.translate("xpack.lens.xyChart.markerPosition.left",{defaultMessage:"Left"}),xi=u.i18n.translate("xpack.lens.xyChart.markerPosition.right",{defaultMessage:"Right"});function yi({isHorizontal:e,axisMode:t}){const a={id:`${pi}auto`,label:u.i18n.translate("xpack.lens.xyChart.lineMarker.auto",{defaultMessage:"Auto"}),"data-test-subj":"lnsXY_markerPosition_auto"};return"bottom"===t?[{id:`${pi}below`,label:e?hi:vi,"data-test-subj":"lnsXY_markerPosition_below"},a,{id:`${pi}above`,label:e?xi:bi,"data-test-subj":"lnsXY_markerPosition_above"}]:[{id:`${pi}left`,label:e?vi:hi,"data-test-subj":"lnsXY_markerPosition_left"},a,{id:`${pi}right`,label:e?bi:xi,"data-test-subj":"lnsXY_markerPosition_right"}]}function ji({currentConfig:e,setConfig:t,isHorizontal:a}){return Object(x.jsx)(l.a.Fragment,null,fi(null==e?void 0:e.icon)||null!=e&&e.textVisibility?Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,isDisabled:!(fi(null==e?void 0:e.icon)||null!=e&&e.textVisibility),label:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"})},Object(x.jsx)(be.a,{tooltipContent:u.i18n.translate("xpack.lens.lineMarker.positionRequirementTooltip",{defaultMessage:"You must select an icon or show the name in order to alter its position"}),condition:!(fi(null==e?void 0:e.icon)||null!=e&&e.textVisibility),position:"top",delay:"regular",display:"block"},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.lineMarker.position",{defaultMessage:"Decoration position"}),"data-test-subj":"lnsXY_markerPosition",name:"markerPosition",isDisabled:!(fi(null==e?void 0:e.icon)||null!=e&&e.textVisibility),buttonSize:"compressed",options:yi({isHorizontal:a,axisMode:e.axisMode}),idSelected:`${pi}${(null==e?void 0:e.iconPosition)||"auto"}`,onChange:e=>{const a=e.replace(pi,"");t({iconPosition:a})}}))):null)}const Oi=(e,t)=>{const a=e?e.getTableSpec().map((({columnId:e})=>e)).filter((e=>t.accessors.includes(e))):t.accessors;return Array.from(new Set(a.concat(t.accessors)))},Ii=(e,t,a,n,i)=>{if(!e||!e.layers.length)return null;const s={};return e.layers.forEach((e=>{s[e.layerId]={};const a=t[e.layerId];a&&a.getTableSpec().forEach((a=>{var n,i;const l=null!==(n=null===(i=t[e.layerId])||void 0===i?void 0:i.getOperationForColumnId(a.columnId))&&void 0!==n?n:null;s[e.layerId][a.columnId]=l}))})),Mi(e,s,t,a,n,i)},ki={[z.LayerTypes.DATA]:e=>({...e,simpleView:!0}),[z.LayerTypes.REFERENCELINE]:e=>{var t;return{...e,simpleView:!0,yConfig:null===(t=e.yConfig)||void 0===t?void 0:t.map((({...e})=>({...e,lineWidth:1,icon:void 0,textVisibility:!1})))}},[z.LayerTypes.ANNOTATIONS]:e=>({...e,simpleView:!0})};function Ti(e,t){if(!e)return t;if("ordinal"===e.scale)return it.ScaleType.Ordinal;if("interval"===e.scale||"ratio"===e.scale)return"date"===e.dataType?it.ScaleType.Time:it.ScaleType.Linear;switch(e.dataType){case"boolean":case"string":case"ip":return it.ScaleType.Ordinal;case"date":return it.ScaleType.Time;default:return it.ScaleType.Linear}}const Mi=(e,t,a,n,i,s)=>{var l,r,o,u,c,d,p,m,g,f,b,v,h,x,y,j,O,I,T,M,w,C,E,S,F,P,_,A,L,D,R,B,z,G,q,H,U,$,W,X;const Y=Va(e.layers).filter((e=>Boolean(e.accessors.length))).map((e=>({...e,accessors:Oi(a[e.layerId],e)}))),Q=qa(e.layers).filter((e=>Boolean(e.accessors.length))),K=ei(e.layers),Z=Ya(e.layers).filter((e=>Boolean(e.annotations.length))).map((e=>({...e,ignoreGlobalFilters:e.ignoreGlobalFilters,annotations:e.annotations.map((e=>({...e,label:K[e.id]})))})));if(!Y.length)return null;const J=Y.some((({yConfig:e})=>null==e?void 0:e.some((e=>e.axisMode===it.Position.Left)))),ee=Y.some((({yConfig:e})=>null==e?void 0:e.some((e=>e.axisMode===it.Position.Right)))),te=[{position:it.Position.Left,extent:null==e?void 0:e.yLeftExtent,showTitle:null===(l=null==e||null===(r=e.axisTitlesVisibilitySettings)||void 0===r?void 0:r.yLeft)||void 0===l||l,title:e.yTitle||"",showLabels:null===(o=null==e||null===(u=e.tickLabelsVisibilitySettings)||void 0===u?void 0:u.yLeft)||void 0===o||o,showGridLines:null===(c=null==e||null===(d=e.gridlinesVisibilitySettings)||void 0===d?void 0:d.yLeft)||void 0===c||c,labelsOrientation:null!==(p=null==e||null===(m=e.labelsOrientation)||void 0===m?void 0:m.yLeft)&&void 0!==p?p:0,scaleType:e.yLeftScale||"linear"},{position:it.Position.Right,extent:null==e?void 0:e.yRightExtent,showTitle:null===(g=null==e||null===(f=e.axisTitlesVisibilitySettings)||void 0===f?void 0:f.yRight)||void 0===g||g,title:e.yRightTitle||"",showLabels:null===(b=null==e||null===(v=e.tickLabelsVisibilitySettings)||void 0===v?void 0:v.yRight)||void 0===b||b,showGridLines:null===(h=null==e||null===(x=e.gridlinesVisibilitySettings)||void 0===x?void 0:x.yRight)||void 0===h||h,labelsOrientation:null!==(y=null==e||null===(j=e.labelsOrientation)||void 0===j?void 0:j.yRight)&&void 0!==y?y:0,scaleType:e.yRightScale||"linear"}];J&&te.push({id:it.Position.Left,position:it.Position.Left,...te[0]}),ee&&te.push({id:it.Position.Right,position:it.Position.Right,...te[1]});const ae=e=>{var t;return Object(Ma.e)(e)||Object(Ma.g)(e)||e.filter&&""!==(null===(t=e.filter)||void 0===t?void 0:t.query)},ne=Object(V.buildExpressionFunction)("legendConfig",{isVisible:e.legend.isVisible,showSingleSeries:e.legend.showSingleSeries,position:e.legend.isInside?[]:e.legend.position,isInside:e.legend.isInside?e.legend.isInside:void 0,legendSize:e.legend.isInside?void 0:e.legend.position===it.Position.Top||e.legend.position===it.Position.Bottom?N.LegendSize.AUTO:e.legend.legendSize?e.legend.legendSize:void 0,horizontalAlignment:e.legend.horizontalAlignment&&e.legend.isInside?e.legend.horizontalAlignment:void 0,verticalAlignment:e.legend.verticalAlignment&&e.legend.isInside?e.legend.verticalAlignment:void 0,floatingColumns:e.legend.floatingColumns&&e.legend.isInside?Math.min(5,e.legend.floatingColumns):[],maxLines:e.legend.maxLines,shouldTruncate:null!==(O=e.legend.shouldTruncate)&&void 0!==O?O:_t(e,a).truncateText}),ie=Object(V.buildExpressionFunction)("xAxisConfig",{id:"x",position:"bottom",title:e.xTitle||"",showTitle:null===(I=null==e||null===(T=e.axisTitlesVisibilitySettings)||void 0===T?void 0:T.x)||void 0===I||I,showLabels:null===(M=null==e||null===(w=e.tickLabelsVisibilitySettings)||void 0===w?void 0:w.x)||void 0===M||M,showGridLines:null===(C=null==e||null===(E=e.gridlinesVisibilitySettings)||void 0===E?void 0:E.x)||void 0===C||C,labelsOrientation:null!==(S=null==e||null===(F=e.labelsOrientation)||void 0===F?void 0:F.x)&&void 0!==S?S:0,extent:e.xExtent||Y.some((e=>Object(k.r)(a[e.layerId],e.xAccessor)))?[Object(k.m)(null!==(P=e.xExtent)&&void 0!==P?P:{mode:"dataBounds",niceValues:!0})]:void 0}),se=Object(V.buildExpressionFunction)("layeredXyVis",{legend:Object(V.buildExpression)([ne]).toAst(),fittingFunction:null!==(_=e.fittingFunction)&&void 0!==_?_:"None",endValue:null!==(A=e.endValue)&&void 0!==A?A:"None",emphasizeFitting:null!==(L=e.emphasizeFitting)&&void 0!==L&&L,minBarHeight:null!==(D=e.minBarHeight)&&void 0!==D?D:1,fillOpacity:null!==(R=e.fillOpacity)&&void 0!==R?R:.3,valueLabels:null!==(B=e.valueLabels)&&void 0!==B?B:"hide",hideEndzones:null!==(z=e.hideEndzones)&&void 0!==z&&z,addTimeMarker:null!==(G=e.showCurrentTimeMarker)&&void 0!==G&&G,valuesInLegend:null!==(q=e.valuesInLegend)&&void 0!==q&&q,yAxisConfigs:[...wi(te)],xAxisConfig:Object(V.buildExpression)([ie]).toAst(),showTooltip:[],layers:[...Y.map((s=>Si(s,te,a[s.layerId],t,n,i[s.layerId],e.curveType||"LINEAR"))),...Q.map((e=>Ci(e,a[e.layerId],i[e.layerId])))],annotations:Z.length&&Z.flatMap((e=>e.annotations.filter(ae))).length?[Object(V.buildExpression)([Object(V.buildExpressionFunction)("event_annotations_result",{layers:Z.map((e=>Ei(e,s))),datatable:s.toFetchExpression({interval:(null===(H=Y[0])||void 0===H?void 0:H.xAccessor)&&(null===(U=t[null===(W=Y[0])||void 0===W?void 0:W.layerId])||void 0===U||null===($=U[null===(X=Y[0])||void 0===X?void 0:X.xAccessor])||void 0===$?void 0:$.interval)||"auto",groups:Z.map((e=>({ignoreGlobalFilters:e.ignoreGlobalFilters,indexPatternId:e.indexPatternId,annotations:e.annotations.filter(ae)})))})})]).toAst()]:[]});return Object(V.buildExpression)([se]).toAst()},wi=e=>e.map((e=>{var t,a,n,i;return Object(V.buildExpression)([Object(V.buildExpressionFunction)("yAxisConfig",{id:e.id,position:e.position,extent:Object(k.m)(null!==(t=e.extent)&&void 0!==t?t:{mode:"full",niceValues:!0}),showTitle:null===(a=e.showTitle)||void 0===a||a,title:e.title,showLabels:null===(n=e.showLabels)||void 0===n||n,showGridLines:null===(i=e.showGridLines)||void 0===i||i,labelsOrientation:e.labelsOrientation,scaleType:e.scaleType})]).toAst()})),Ci=(e,t,a)=>{const n=Object(V.buildExpressionFunction)("referenceLineLayer",{layerId:e.layerId,decorations:e.yConfig?e.yConfig.map((e=>Pi(e,ri))):[],accessors:e.accessors,columnToLabel:JSON.stringify(bn(e,t)),...a&&a.chain.length?{table:a}:{}});return Object(V.buildExpression)([n]).toAst()},Ei=(e,t)=>{const a=Object(V.buildExpressionFunction)("extendedAnnotationLayer",{simpleView:Boolean(e.simpleView),layerId:e.layerId,annotations:t.toExpression(e.annotations||[])});return Object(V.buildExpression)([a]).toAst()},Si=(e,t,a,n,i,s,l)=>{const r=bn(e,a),o=null==a?void 0:a.getOperationForColumnId(e.xAccessor),u=Boolean(o&&o.isBucketed&&o.scale&&"ordinal"!==o.scale),c=e.seriesType.split("_"),d=c[0],p=c.includes("percentage"),m=c.includes("stacked"),g=c.includes("horizontal"),f=Object(V.buildExpressionFunction)("lens_collapse",{by:e.xAccessor?[e.xAccessor]:[],metric:e.accessors,fn:[e.collapseFn]}),b=Object(V.buildExpressionFunction)("extendedDataLayer",{layerId:e.layerId,simpleView:Boolean(e.simpleView),xAccessor:e.xAccessor,xScaleType:Ti(n[e.layerId][e.xAccessor],it.ScaleType.Linear),isHistogram:u,isPercentage:p,isStacked:m,isHorizontal:g,splitAccessors:e.collapseFn||!e.splitAccessor?void 0:[e.splitAccessor],decorations:e.yConfig?e.yConfig.map((e=>Fi(e,t))):void 0,curveType:l,seriesType:d,showLines:"line"===d||"area"===d,accessors:e.accessors,columnToLabel:JSON.stringify(r),palette:Object(V.buildExpression)([e.palette?Object(V.buildExpressionFunction)("theme",{variable:"palette",default:[i.get(e.palette.name).toExpression(e.palette.params)]}):Object(V.buildExpressionFunction)("system_palette",{name:"default"})]).toAst(),colorMapping:e.colorMapping?JSON.stringify(e.colorMapping):void 0});return{type:"expression",chain:[...s?[...s.chain,...e.collapseFn?[f.toAst()]:[]]:[],b.toAst()]}},Fi=(e,t,a)=>{var n,i;const s=null===(n=t.find((t=>t.id&&t.position===e.axisMode)))||void 0===n?void 0:n.id,l=Object(V.buildExpressionFunction)("dataDecorationConfig",{axisId:s,forAccessor:e.forAccessor,color:null!==(i=e.color)&&void 0!==i?i:a});return Object(V.buildExpression)([l]).toAst()},Pi=(e,t)=>{var a;const n=Object(V.buildExpressionFunction)("referenceLineDecorationConfig",{forAccessor:e.forAccessor,position:e.axisMode,color:null!==(a=e.color)&&void 0!==a?a:t,lineStyle:e.lineStyle||"solid",lineWidth:e.lineWidth||1,fill:e.fill||"none",icon:fi(e.icon)?e.icon:void 0,iconPosition:(fi(e.icon)||e.textVisibility)&&e.iconPosition||"auto",textVisibility:e.textVisibility||!1});return Object(V.buildExpression)([n]).toAst()};function _i(e,t,a){const n=[...e.layers];return n[a]=t,{...e,layers:n}}const Ai=[{id:"xy_legend_auto",value:"auto",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.auto",{defaultMessage:"Auto"})},{id:"xy_legend_show",value:"show",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"xy_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.xyChart.legendVisibility.hide",{defaultMessage:"Hide"})}];function Li(e,t,a){var n;return Boolean(null===(n=e.find((e=>e.groupId===t)))||void 0===n?void 0:n.series.some((({layer:e})=>Va(null==a?void 0:a.layers).find((t=>t.layerId===e&&t.seriesType.includes("percentage"))))))}const Di={x:"xTitle",yLeft:"yTitle",yRight:"yRightTitle"},Ri=Object(s.memo)((function(e){var t,a,n,i,l,r,o,c,d,p,m,g,f,v,h,y,j,O,I,T,M,w,C,E,S,F;const{state:P,setState:_,frame:A,useLegacyTimeAxis:L}=e,D=Va(null==P?void 0:P.layers),R=!(null==P||!P.layers.length)&&mn(P.layers),B=function(e,t,a,n){const i=An(e,a),s=[];return i.left.length>0&&s.push({groupId:"left",position:t?"bottom":"left",formatter:void 0,series:i.left.map((({fieldFormat:e,...t})=>t))}),i.right.length>0&&s.push({groupId:"right",position:t?"top":"right",formatter:void 0,series:i.right.map((({fieldFormat:e,...t})=>t))}),s}(D,R,A.activeData),z=function(e,t){const a={};return t.forEach((t=>{let n=Number.MAX_VALUE,i=Number.MIN_VALUE;t.series.forEach((t=>{var a;null==e||null===(a=e[t.layer])||void 0===a||a.rows.forEach((e=>{const a=e[t.accessor];Number.isNaN(a)||(a<n&&(n=a),a>i&&(i=a))}))})),n!==Number.MAX_VALUE&&i!==Number.MIN_VALUE&&(a[t.groupId]={min:Math.round(100*(n+Number.EPSILON))/100,max:Math.round(100*(i+Number.EPSILON))/100})})),a}(A.activeData,B),V=function(e=[],t){const a=e.reduce(((e,a)=>{const n=Object(k.q)(a.layerId,t,a.xAccessor);return n?{min:Math.min(e.min,n.min),max:Math.max(e.max,n.max)}:e}),{min:1/0,max:-1/0});if(isFinite(a.min)&&isFinite(a.max))return a}(D,A.activeData),G={x:null===(t=null==P||null===(a=P.tickLabelsVisibilitySettings)||void 0===a?void 0:a.x)||void 0===t||t,yLeft:null===(n=null==P||null===(i=P.tickLabelsVisibilitySettings)||void 0===i?void 0:i.yLeft)||void 0===n||n,yRight:null===(l=null==P||null===(r=P.tickLabelsVisibilitySettings)||void 0===r?void 0:r.yRight)||void 0===l||l},q=e=>{const t={...G,[e]:!G[e]};_({...P,tickLabelsVisibilitySettings:t})},H={x:null===(o=null==P||null===(c=P.gridlinesVisibilitySettings)||void 0===c?void 0:c.x)||void 0===o||o,yLeft:null===(d=null==P||null===(p=P.gridlinesVisibilitySettings)||void 0===p?void 0:p.yLeft)||void 0===d||d,yRight:null===(m=null==P||null===(g=P.gridlinesVisibilitySettings)||void 0===g?void 0:g.yRight)||void 0===m||m},U=e=>{const t={...H,[e]:!H[e]};_({...P,gridlinesVisibilitySettings:t})},$={x:null!==(f=null==P||null===(v=P.labelsOrientation)||void 0===v?void 0:v.x)&&void 0!==f?f:0,yLeft:null!==(h=null==P||null===(y=P.labelsOrientation)||void 0===y?void 0:y.yLeft)&&void 0!==h?h:0,yRight:null!==(j=null==P||null===(O=P.labelsOrientation)||void 0===O?void 0:O.yRight)&&void 0!==j?j:0},W=(e,t)=>{const a={...$,[e]:t};_({...P,labelsOrientation:a})},X=Object(s.useMemo)((()=>{var e,t,a,n,i,s;return{x:null===(e=null==P||null===(t=P.axisTitlesVisibilitySettings)||void 0===t?void 0:t.x)||void 0===e||e,yLeft:null===(a=null==P||null===(n=P.axisTitlesVisibilitySettings)||void 0===n?void 0:n.yLeft)||void 0===a||a,yRight:null===(i=null==P||null===(s=P.axisTitlesVisibilitySettings)||void 0===s?void 0:s.yRight)||void 0===i||i}}),[null==P||null===(I=P.axisTitlesVisibilitySettings)||void 0===I?void 0:I.x,null==P||null===(T=P.axisTitlesVisibilitySettings)||void 0===T?void 0:T.yLeft,null==P||null===(M=P.axisTitlesVisibilitySettings)||void 0===M?void 0:M.yRight]),Y=Object(s.useCallback)((({title:e,visible:t},a)=>_({...P,[Di[a]]:e,axisTitlesVisibilitySettings:{...X,[a]:t}})),[X,_,P]),Q=D.every((t=>{var a,n;return!t.xAccessor||"ordinal"!==Ti(null!==(a=null===(n=e.frame.datasourceLayers[t.layerId])||void 0===n?void 0:n.getOperationForColumnId(t.xAccessor))&&void 0!==a?a:null,it.ScaleType.Linear)})),K=D.every((t=>{var a,n;return t.xAccessor&&Ti(null!==(a=null===(n=e.frame.datasourceLayers[t.layerId])||void 0===n?void 0:n.getOperationForColumnId(t.xAccessor))&&void 0!==a?a:null,it.ScaleType.Linear)===it.ScaleType.Time})),Z=K?e=>{_({...P,hideEndzones:!e})}:void 0,J=K?e=>{_({...P,showCurrentTimeMarker:e})}:void 0,ee=null==P||!P.legend.isVisible||null!=P&&P.legend.showSingleSeries?null!=P&&P.legend.isVisible?"show":"hide":"auto",te=Boolean(null===(w=B.find((e=>"left"===e.groupId)))||void 0===w||null===(C=w.series)||void 0===C?void 0:C.some((e=>{var t;const a=null===(t=D.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),ae=Object(s.useCallback)((e=>{_({...P,yLeftExtent:e})}),[_,P]),ne=Object(s.useCallback)((e=>{_({...P,xExtent:e})}),[_,P]),ie=Boolean(null===(E=B.find((e=>"right"===e.groupId)))||void 0===E||null===(S=E.series)||void 0===S?void 0:S.some((e=>{var t;const a=null===(t=D.find((t=>t.layerId===e.layer)))||void 0===t?void 0:t.seriesType;return(null==a?void 0:a.includes("bar"))||(null==a?void 0:a.includes("area"))}))),se=Object(s.useCallback)((e=>{_({...P,yRightExtent:e})}),[_,P]),le=D.filter((e=>e.seriesType.includes("bar"))),re=le.length>1||le.some((e=>e.accessors.length>1||e.splitAccessor)),oe=D.some((({xAccessor:t,layerId:a,seriesType:n,splitAccessor:i})=>{var s,l;if(!t)return!1;const r=null!==(s=null===(l=e.frame.datasourceLayers[a])||void 0===l?void 0:l.getOperationForColumnId(t))&&void 0!==s?s:null;return Ti(r,it.ScaleType.Linear)===it.ScaleType.Time&&(null==r?void 0:r.isBucketed)&&(n.includes("stacked")||!i)&&(n.includes("stacked")||!n.includes("bar")||!re)})),ue=D.some((({layerId:t,xAccessor:a})=>Object(k.r)(e.frame.datasourceLayers[t],a))),ce=_t(P,e.frame.datasourceLayers).truncateText,de=P.legend.legendSize,[pe]=Object(s.useState)((()=>de===N.LegendSize.AUTO));return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(qn,{state:P,setState:_,datasourceLayers:A.datasourceLayers}),Object(x.jsx)(k.e,{legendOptions:Ai,mode:ee,location:null!=P&&P.legend.isInside?"inside":"outside",onLocationChange:e=>{_({...P,legend:{...P.legend,isInside:"inside"===e}})},onDisplayChange:e=>{const t=Ai.find((({id:t})=>t===e)).value;"auto"===t?_({...P,legend:{...P.legend,isVisible:!0,showSingleSeries:!1}}):"show"===t?_({...P,legend:{...P.legend,isVisible:!0,showSingleSeries:!0}}):"hide"===t&&_({...P,legend:{...P.legend,isVisible:!1,showSingleSeries:!1}})},position:null==P?void 0:P.legend.position,horizontalAlignment:null==P?void 0:P.legend.horizontalAlignment,verticalAlignment:null==P?void 0:P.legend.verticalAlignment,floatingColumns:null==P?void 0:P.legend.floatingColumns,onFloatingColumnsChange:e=>{_({...P,legend:{...P.legend,floatingColumns:e}})},maxLines:null==P?void 0:P.legend.maxLines,onMaxLinesChange:e=>{_({...P,legend:{...P.legend,maxLines:e}})},shouldTruncate:null!==(F=null==P?void 0:P.legend.shouldTruncate)&&void 0!==F?F:ce,onTruncateLegendChange:()=>{var e;const t=null!==(e=null==P?void 0:P.legend.shouldTruncate)&&void 0!==e?e:ce;_({...P,legend:{...P.legend,shouldTruncate:!t}})},onPositionChange:e=>{_({...P,legend:{...P.legend,position:e}})},onAlignmentChange:e=>{const[t,a]=e.split("_"),n=t,i=a;_({...P,legend:{...P.legend,verticalAlignment:n,horizontalAlignment:i}})},renderValueInLegendSwitch:Q,valueInLegend:null==P?void 0:P.valuesInLegend,onValueInLegendChange:()=>{_({...P,valuesInLegend:!P.valuesInLegend})},legendSize:de,onLegendSizeChange:e=>{_({...P,legend:{...P.legend,legendSize:e}})},showAutoLegendSizeOption:pe}))),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(be.a,{tooltipContent:R?u.i18n.translate("xpack.lens.xyChart.bottomAxisDisabledHelpText",{defaultMessage:"This setting only applies when bottom axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.leftAxisDisabledHelpText",{defaultMessage:"This setting only applies when left axis is enabled."}),condition:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length},Object(x.jsx)(Dn,{axis:"yLeft",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.yTitle,updateTitleState:Y,areTickLabelsVisible:G.yLeft,toggleTickLabelsVisibility:q,areGridlinesVisible:H.yLeft,toggleGridlinesVisibility:U,isDisabled:0===Object.keys(B.find((e=>"left"===e.groupId))||{}).length,orientation:$.yLeft,setOrientation:W,isAxisTitleVisible:X.yLeft,extent:(null==P?void 0:P.yLeftExtent)||{mode:"full"},setExtent:ae,hasBarOrAreaOnAxis:te,dataBounds:z.left,hasPercentageAxis:Li(B,"left",P),scale:null==P?void 0:P.yLeftScale,setScale:e=>{_({...P,yLeftScale:e})}})),Object(x.jsx)(Dn,{axis:"x",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.xTitle,updateTitleState:Y,areTickLabelsVisible:G.x,toggleTickLabelsVisibility:q,areGridlinesVisible:H.x,toggleGridlinesVisibility:U,orientation:$.x,setOrientation:W,isAxisTitleVisible:X.x,endzonesVisible:!(null!=P&&P.hideEndzones),setEndzoneVisibility:Z,currentTimeMarkerVisible:null==P?void 0:P.showCurrentTimeMarker,setCurrentTimeMarkerVisibility:J,hasBarOrAreaOnAxis:!1,hasPercentageAxis:!1,useMultilayerTimeAxis:oe&&!L&&!R,extent:ue?(null==P?void 0:P.xExtent)||{mode:"dataBounds"}:void 0,setExtent:ne,dataBounds:V}),Object(x.jsx)(be.a,{tooltipContent:R?u.i18n.translate("xpack.lens.xyChart.topAxisDisabledHelpText",{defaultMessage:"This setting only applies when top axis is enabled."}):u.i18n.translate("xpack.lens.xyChart.rightAxisDisabledHelpText",{defaultMessage:"This setting only applies when right axis is enabled."}),condition:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length},Object(x.jsx)(Dn,{axis:"yRight",layers:null==P?void 0:P.layers,axisTitle:null==P?void 0:P.yRightTitle,updateTitleState:Y,areTickLabelsVisible:G.yRight,toggleTickLabelsVisibility:q,areGridlinesVisible:H.yRight,toggleGridlinesVisibility:U,isDisabled:0===Object.keys(B.find((e=>"right"===e.groupId))||{}).length,orientation:$.yRight,setOrientation:W,hasPercentageAxis:Li(B,"right",P),isAxisTitleVisible:X.yRight,extent:(null==P?void 0:P.yRightExtent)||{mode:"full"},setExtent:se,hasBarOrAreaOnAxis:ie,dataBounds:z.right,scale:null==P?void 0:P.yRightScale,setScale:e=>{_({...P,yRightScale:e})}})))))}));var Bi=a(139),Ni={name:"1gammwy",styles:"margin-top:5px"};const zi=({color:e,dataTestSubj:t})=>({component:Object(x.jsx)(b.EuiIcon,{type:"filterIgnore",color:e,css:Ni}),tooltipValue:u.i18n.translate("xpack.lens.layerPanel.ignoreGlobalFilters",{defaultMessage:"Ignore global filters"}),"data-test-subj":t});function Vi(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t?Ga(t)?Object(x.jsx)(qi,null):Ha(t)?Object(x.jsx)(Ui,{title:Ka(t),hasUnsavedChanges:hn(t)}):Object(x.jsx)(Xi,e):null}function Gi(e){const t=e.state.layers.find((t=>t.layerId===e.layerId));return t&&Ha(t)?Object(x.jsx)($i,e):null}function qi(){return Object(x.jsx)(k.h,{icon:ka,label:u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"})})}var Hi={name:"1hbav5g",styles:"padding-bottom:3px;padding-left:4px"};function Ui({title:e,hasUnsavedChanges:t}){return Object(x.jsx)(k.h,{icon:Ta,label:e||u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"}),indicator:t&&Object(x.jsx)("div",{css:Hi},Object(x.jsx)(b.EuiIconTip,{content:u.i18n.translate("xpack.lens.xyChart.unsavedChanges",{defaultMessage:"Unsaved changes"}),type:"dot",color:re.euiThemeVars.euiColorSuccess}))})}function $i({frame:e,state:t,layerId:a,onChangeIndexPattern:n}){const{euiTheme:i}=Object(b.useEuiTheme)(),s=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"}),l=t.layers.findIndex((e=>e.layerId===a)),r=t.layers[l],o=e.dataViews.indexPatterns[r.indexPatternId];return Object(x.jsx)(k.d,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==o?void 0:o.name)||s,title:(null==o?void 0:o.title)||s,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal",extraIcons:r.ignoreGlobalFilters?[zi({color:i.colors.disabledText,dataTestSubj:"lnsChangeIndexPatternIgnoringFilters"})]:void 0},indexPatternId:r.indexPatternId,indexPatternRefs:e.dataViews.indexPatternRefs,isMissingCurrent:!o,onChangeIndexPattern:n})}var Wi={name:"ddbaxo",styles:"width:320px"};function Xi(e){const[t,a]=Object(s.useState)(!1),{state:n,layerId:i}=e,r=n.layers.filter(za).find((e=>e.layerId===i)),o=n.layers.findIndex((e=>e===r)),c=Ia.visualizationTypes.find((({id:e})=>e===r.seriesType)),d=mn(n.layers);return Object(x.jsx)(b.EuiPopover,{button:Object(x.jsx)(Yi,{onClick:()=>a(!t),currentVisType:c}),isOpen:t,closePopover:()=>a(!1),display:"block",panelPaddingSize:"s",ownFocus:!0},Object(x.jsx)(b.EuiPopoverTitle,null,u.i18n.translate("xpack.lens.layerPanel.layerVisualizationType",{defaultMessage:"Layer visualization type"})),Object(x.jsx)("div",{css:Wi},Object(x.jsx)(b.EuiSelectable,{singleSelection:"always",options:Ia.visualizationTypes.filter((e=>pn(e.id)===d)).map((e=>({value:e.id,key:e.id,checked:e.id===c.id?"on":void 0,prepend:Object(x.jsx)(b.EuiIcon,{type:e.icon}),label:e.fullLabel||e.label,"data-test-subj":`lnsXY_seriesType-${e.id}`}))),onChange:t=>{const i=t.find((({checked:e})=>"on"===e));if(!i)return;const s=i.value;e.setState(_i(n,{...r,seriesType:s},o)),a(!1)}},(e=>Object(x.jsx)(l.a.Fragment,null,e)))))}const Yi=function({currentVisType:e,onClick:t}){return Object(x.jsx)(Bi.a,{"data-test-subj":"lns_layer_settings","aria-label":e.fullLabel||e.label,onClick:t,fullWidth:!0,size:"s",label:Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"none",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiIcon,{type:e.icon})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiText,{size:"s",className:"lnsLayerPanelChartSwitch_title"},e.fullLabel||e.label)))})};var Qi=a(539),Ki=a(540);const Zi=[{value:"empty",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.noIconLabel",{defaultMessage:"None"})},{value:"asterisk",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.asteriskIconLabel",{defaultMessage:"Asterisk"})},{value:"bell",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bellIconLabel",{defaultMessage:"Bell"})},{value:"bolt",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.boltIconLabel",{defaultMessage:"Bolt"})},{value:"bug",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.bugIconLabel",{defaultMessage:"Bug"})},{value:"editorComment",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.commentIconLabel",{defaultMessage:"Comment"})},{value:"alert",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.alertIconLabel",{defaultMessage:"Alert"})},{value:"flag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.flagIconLabel",{defaultMessage:"Flag"})},{value:"tag",label:u.i18n.translate("xpack.lens.xyChart.iconSelect.tagIconLabel",{defaultMessage:"Tag"})}],Ji=e=>{var t;const{state:a,setState:n,layerId:r,accessor:o}=e,c=mn(a.layers),d=a.layers.findIndex((e=>e.layerId===r)),{inputValue:p,handleInputChange:m}=Object(Z.a)({value:a,onChange:n}),g=p.layers.find((e=>e.layerId===r)),f=null==g||null===(t=g.yConfig)||void 0===t?void 0:t.find((e=>e.forAccessor===o)),b=Object(s.useCallback)((e=>{if(null==e)return;const t=[...g.yConfig||[]],a=t.findIndex((e=>e.forAccessor===o));-1!==a?t[a]={...t[a],...e}:t.push({forAccessor:o,...e}),m(_i(p,{...g,yConfig:t},d))}),[o,d,p,g,m]);return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Qi.a,{idPrefix:pi,setConfig:b,currentConfig:f}),Object(x.jsx)(Ue.b,{setIcon:e=>b({icon:e}),currentIcon:null==f?void 0:f.icon,customIconSet:Zi}),Object(x.jsx)(ji,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(x.jsx)(Ki.a,{idPrefix:pi,setConfig:b,currentConfig:f}),Object(x.jsx)(ts,{isHorizontal:c,setConfig:b,currentConfig:f}),Object(x.jsx)(ua.a,i()({},e,{overwriteColor:null==f?void 0:f.color,defaultColor:ri,setConfig:b,disableHelpTooltip:!0,label:u.i18n.translate("xpack.lens.xyChart.lineColor.label",{defaultMessage:"Color"})})))};function es({isHorizontal:e,axisMode:t}){const a=u.i18n.translate("xpack.lens.xyChart.fill.above",{defaultMessage:"Above"}),n=u.i18n.translate("xpack.lens.xyChart.fill.below",{defaultMessage:"Below"}),i=u.i18n.translate("xpack.lens.xyChart.fill.before",{defaultMessage:"Before"}),s=u.i18n.translate("xpack.lens.xyChart.fill.after",{defaultMessage:"After"}),l="bottom"===t||e?s:a,r="bottom"===t||e?i:n;return[{id:`${pi}none`,label:u.i18n.translate("xpack.lens.xyChart.fill.none",{defaultMessage:"None"}),"data-test-subj":"lnsXY_fill_none"},{id:`${pi}above`,label:l,"data-test-subj":"lnsXY_fill_above"},{id:`${pi}below`,label:r,"data-test-subj":"lnsXY_fill_below"}]}const ts=({currentConfig:e,setConfig:t,isHorizontal:a})=>Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"})},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.xyChart.fill.label",{defaultMessage:"Fill"}),"data-test-subj":"lnsXY_fill",name:"fill",buttonSize:"compressed",options:es({isHorizontal:a,axisMode:null==e?void 0:e.axisMode}),idSelected:`${pi}${(null==e?void 0:e.fill)||"none"}`,onChange:e=>{const a=e.replace(pi,"");t({fill:a})}})),as=Object(s.lazy)((()=>a.e(7).then(a.bind(null,560)))),ns=e=>Object(x.jsx)(s.Suspense,{fallback:null},Object(x.jsx)(as,e));var is=a(9);const ss=e=>{var t;const{state:a,setState:n,layerId:i,accessor:l,frame:r}=e,{inputValue:o,handleInputChange:u}=Object(Z.a)({value:a,onChange:n}),c=o.layers.findIndex((e=>e.layerId===i)),p=o.layers.find((e=>e.layerId===i)),m=null===(t=p.annotations)||void 0===t?void 0:t.find((e=>e.id===l)),g=Object(s.useCallback)((e=>{if(null==e)return;const t=[...p.annotations||[]],a=t.findIndex((e=>e.id===l));if(-1===a)throw new Error("should never happen because annotation is created before config panel is opened");t[a]=e,u(_i(o,{...p,annotations:t},c))}),[l,c,o,p,u]),[f,b]=Object(s.useState)();Object(s.useEffect)((()=>{(async()=>{let t;t=(await e.dataViewsService.getIds()).includes(p.indexPatternId)?await e.dataViewsService.get(p.indexPatternId):await e.dataViewsService.create(r.dataViews.indexPatterns[p.indexPatternId].spec),b(t)})()}),[r.dataViews.indexPatterns,p.indexPatternId,e.dataViewsService]);const v=Object(d.useKibana)().services;if(!m)throw new Error("Annotation not found... this should never happen!");return f?Object(x.jsx)(ns,{annotation:m,onAnnotationChange:e=>g(e),dataView:f,getDefaultRangeEnd:t=>ls(e.datatableUtilities,t,r,o.layers.filter(za)),queryInputServices:v,calendarClassName:st.DONT_CLOSE_DIMENSION_CONTAINER_ON_CLICK_CLASS,appName:It.LENS_APP_NAME}):null},ls=(e,t,{activeData:a,dateRange:n},i)=>{var s;const l=Un()(t).valueOf(),r=.1*(Un()(n.toDate).valueOf()-Un()(n.fromDate).valueOf()),o=Un()(l+r).toISOString(),u=i.map((({layerId:e})=>e));if(!u.length||!a||Object.entries(a).filter((([e])=>u.includes(e))).every((([,{rows:e}])=>!e||!e.length)))return o;const c=null==a?void 0:a[u[0]].columns.find((e=>e.id===i[0].xAccessor));if(!c)return o;const d=null===(s=e.getDateHistogramMeta(c))||void 0===s?void 0:s.interval;if(!d)return o;const p=is.search.aggs.parseInterval(d);return p?Un()(l+3*p.as("milliseconds")).toISOString():o};var rs=a(157),os=a(62),us=a(63),cs=a(55);const ds=({domElement:e,savedObjectsTagging:t,onSave:a,title:n,description:i,tags:o,showCopyOnSave:c})=>{const[d,p]=Object(s.useState)(o),m=()=>Object(r.unmountComponentAtNode)(e);return Object(x.jsx)(cs.SavedObjectSaveModal,{onSave:async e=>a({...e,closeModal:m,newTags:d}),onClose:m,title:n,description:i,showCopyOnSave:c,objectType:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.objectType",{defaultMessage:"group"}),customModalTitle:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.modalTitle",{defaultMessage:"Save annotation group to library"}),showDescription:!0,confirmButtonLabel:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("div",null,Object(x.jsx)(b.EuiIcon,{type:"save"})),Object(x.jsx)("div",null,u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.confirmButton",{defaultMessage:"Save group"}))),options:t?Object(x.jsx)(t.ui.components.SavedObjectSaveModalTagSelector,{initialSelection:d,onTagsSelected:p,markOptional:!0}):void 0})},ps=({modalTitle:e,onConfirm:t,onCancel:a})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiModalHeader,null,Object(x.jsx)(b.EuiModalHeaderTitle,null,e)),Object(x.jsx)(b.EuiModalBody,null,Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.layer.revertModal.revertAnnotationGroupDescription",{defaultMessage:"This action will remove all unsaved changes that you've made and restore the most recent saved version of this annotation group to you visualization. Any lost unsaved changes cannot be restored."}))),Object(x.jsx)(b.EuiModalFooter,null,Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",justifyContent:"spaceBetween"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",justifyContent:"flexEnd",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{onClick:a},u.i18n.translate("xpack.lens.layer.cancelDelete",{defaultMessage:"Cancel"}))),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButton,{"data-test-subj":"lnsLayerRevertChangesButton",onClick:t,color:"warning",iconType:"returnKey",fill:!0},u.i18n.translate("xpack.lens.layer.unlinkConfirm",{defaultMessage:"Revert changes"})))))))),ms=({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,core:s,isSaveable:l,eventAnnotationService:o,savedObjectsTagging:p,dataViews:m,kibanaTheme:g})=>{const f=[];return Boolean(s.application.capabilities.visualize.save&&l)&&f.push((({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:s,toasts:l,savedObjectsTagging:o,dataViews:p,goToAnnotationLibrary:m,kibanaTheme:g})=>{const f=!Wa(t);return{displayName:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary",{defaultMessage:"Save to library"}),description:u.i18n.translate("xpack.lens.xyChart.annotations.addAnnotationGroupToLibraryDescription",{defaultMessage:"Saves annotation group as separate saved object"}),execute:async v=>{if(v){const h=Qa(t);Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:g.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(ds,i()({domElement:v,savedObjectsTagging:o,onSave:async i=>{await(async({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:i,toasts:s,modalOnSaveProps:{newTitle:l,newDescription:o,newTags:d,closeModal:p,newCopyOnSave:m,onTitleDuplicate:g,isTitleDuplicateConfirmed:f},dataViews:v,goToAnnotationLibrary:h})=>{const y=await(async(e,t,a,n,i,s)=>!(i||e===t&&!a||!await s.groupExistsWithTitle(e)||(n(),0)))(l,Ka(t),m,g,f,i);if(y)return;let j;try{j=await(async(e,{newTitle:t,newDescription:a,newTags:n,newCopyOnSave:i},s,l)=>{let r;const o=await l.get(e.indexPatternId),u=!Wa(e)||i,c={annotations:e.annotations,indexPatternId:e.indexPatternId,ignoreGlobalFilters:e.ignoreGlobalFilters,title:t,description:a,tags:n,dataViewSpec:o.isPersisted()?void 0:o.toSpec(!1)};if(u){const{id:e}=await s.createAnnotationGroup(c);r=e}else await s.updateAnnotationGroup(c,e.annotationGroupId),r=e.annotationGroupId;return{id:r,config:c}})(t,{newTitle:l,newDescription:o,newTags:d,newCopyOnSave:m},i,v),n({id:j.id,group:j.config})}catch(e){return void s.addError(e,{title:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.errorToastTitle",{defaultMessage:'Failed to save "{title}"',values:{title:l}})})}const O={...t,annotationGroupId:j.id,__lastSaved:j.config};a({...e,layers:e.layers.map((e=>e.layerId===O.layerId?O:e))}),p(),s.addSuccess({title:u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.successToastTitle",{defaultMessage:'Saved "{title}"',values:{title:l}}),text:e=>Object(r.render)(Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.successToastBody",defaultMessage:"View or manage in the {link}.",values:{link:Object(x.jsx)(b.EuiLink,{"data-test-subj":"lnsAnnotationLibraryLink",onClick:()=>h()},u.i18n.translate("xpack.lens.xyChart.annotations.saveAnnotationGroupToLibrary.annotationLibrary",{defaultMessage:"annotation library"}))}})),e)})})({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:s,toasts:l,modalOnSaveProps:i,dataViews:p,goToAnnotationLibrary:m})}},h,{showCopyOnSave:!f})))),v)}},icon:"save",isCompatible:!0,"data-test-subj":"lnsXY_annotationLayer_saveToLibrary",order:100,showOutsideList:!0}})({state:e,layer:t,setState:a,registerLibraryAnnotationGroup:n,eventAnnotationService:o,toasts:s.notifications.toasts,savedObjectsTagging:p,dataViews:m,goToAnnotationLibrary:()=>s.application.navigateToApp(os.VISUALIZE_APP_NAME,{path:`#/${us.ANNOTATIONS_LISTING_VIEW_ID}`}),kibanaTheme:g})),Wa(t)&&(f.push((({state:e,layer:t,setState:a,toasts:n})=>({execute:()=>{const i={layerId:t.layerId,layerType:t.layerType,indexPatternId:t.indexPatternId,ignoreGlobalFilters:t.ignoreGlobalFilters,annotations:t.annotations};a({...e,layers:e.layers.map((e=>e.layerId===t.layerId?i:e))}),n.addSuccess(u.i18n.translate("xpack.lens.xyChart.annotations.notificationUnlinked",{defaultMessage:'Unlinked "{title}"',values:{title:Ka(t)}}))},description:u.i18n.translate("xpack.lens.xyChart.annotations.unlinksFromLibrary",{defaultMessage:"Saves the annotation group as a part of the Lens Saved Object"}),displayName:u.i18n.translate("xpack.lens.xyChart.annotations.unlinkFromLibrary",{defaultMessage:"Unlink from library"}),isCompatible:!0,icon:"unlink","data-test-subj":"lnsXY_annotationLayer_unlinkFromLibrary",order:300}))({state:e,layer:t,setState:a,toasts:s.notifications.toasts})),f.push((({state:e,layer:t,setState:a,core:n})=>({displayName:u.i18n.translate("xpack.lens.xyChart.annotations.revertChanges",{defaultMessage:"Revert changes"}),description:u.i18n.translate("xpack.lens.xyChart.annotations.revertChangesDescription",{defaultMessage:"Restores annotation group to the last saved state."}),execute:async()=>{const i=n.overlays.openModal(Object(d.toMountPoint)(Object(x.jsx)(ps,{modalTitle:u.i18n.translate("xpack.lens.modalTitle.revertAnnotationGroupTitle",{defaultMessage:'Revert "{title}" changes?',values:{title:Ka(t)}}),onCancel:()=>i.close(),onConfirm:()=>{(({setState:e,layer:t,state:a,modal:n,toasts:i})=>{const s={layerId:t.layerId,layerType:t.layerType,annotationGroupId:t.annotationGroupId,indexPatternId:t.__lastSaved.indexPatternId,ignoreGlobalFilters:t.__lastSaved.ignoreGlobalFilters,annotations:Object(qt.cloneDeep)(t.__lastSaved.annotations),__lastSaved:t.__lastSaved};e({...a,layers:a.layers.map((e=>e.layerId===t.layerId?s:e))}),n.close(),i.addSuccess({title:u.i18n.translate("xpack.lens.xyChart.annotations.notificationReverted",{defaultMessage:'Reverted "{title}"',values:{title:Ka(t)}}),text:u.i18n.translate("xpack.lens.xyChart.annotations.notificationRevertedExplanation",{defaultMessage:"The most recently saved version of this annotation group has been restored."})})})({setState:a,layer:t,state:e,modal:i,toasts:n.notifications.toasts})}}),{theme$:n.theme.theme$}),{"data-test-subj":"lnsAnnotationLayerRevertModal",maxWidth:600});await i.onClose},icon:"editorUndo",isCompatible:!0,disabled:!hn(t),"data-test-subj":"lnsXY_annotationLayer_revertChanges",order:200}))({state:e,layer:t,setState:a,core:s}))),f};var gs=a(126);function fs({eventAnnotationService:e,isLoadLibraryVisible:t,setLoadLibraryFlyoutVisible:a,addLayer:n,isInlineEditing:i}){const{renderEventAnnotationGroupSavedObjectFinder:s,loadAnnotationGroup:l}=e||{};return Object(x.jsx)(gs.a,{customFooter:Object(x.jsx)(b.EuiFlyoutFooter,{className:"lnsDimensionContainer__footer"},Object(x.jsx)(b.EuiFlexGroup,{responsive:!1,gutterSize:"s",alignItems:"center",justifyContent:"spaceBetween"},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{flush:"left",size:"s",iconType:"cross",onClick:()=>{a(!1)},"data-test-subj":"lns-indexPattern-loadLibraryCancel"},u.i18n.translate("xpack.lens.loadAnnotationsLibrary.cancel",{defaultMessage:"Cancel"}))))),isOpen:Boolean(t),groupLabel:u.i18n.translate("xpack.lens.editorFrame.loadFromLibrary",{defaultMessage:"Select annotations from library"}),handleClose:()=>(a(!1),!0),isInlineEditing:i},Object(x.jsx)("div",{css:Object(x.css)("padding:",re.euiThemeVars.euiSize,";height:100%;","")},Object(x.jsx)(s,{onChoose:({id:e})=>{l(e).then((t=>{n({...t,annotationGroupId:e}),a(!1)}))},onCreateNew:()=>{n(),a(!1)}})))}function bs({supportedLayers:e,addLayer:t,eventAnnotationService:a,isInlineEditing:n}){const[i,r]=Object(s.useState)(!1),[o,c]=Object(s.useState)(!1);return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiPopover,{display:"block","data-test-subj":"lnsConfigPanel__addLayerPopover",button:Object(x.jsx)(b.EuiButton,{fullWidth:!0,"data-test-subj":"lnsLayerAddButton","aria-label":u.i18n.translate("xpack.lens.configPanel.addLayerButton",{defaultMessage:"Add layer"}),fill:!0,color:"text",onClick:()=>r(!i),iconType:"layers"},u.i18n.translate("xpack.lens.configPanel.addLayerButton",{defaultMessage:"Add layer"})),isOpen:i,closePopover:()=>r(!1),panelPaddingSize:"none"},Object(x.jsx)(b.EuiContextMenu,{initialPanelId:0,panels:[{id:0,title:u.i18n.translate("xpack.lens.configPanel.selectLayerType",{defaultMessage:"Select layer type"}),width:300,items:e.map((e=>{const{type:a,label:n,icon:i,disabled:s,toolTipContent:l}=e;return a===z.LayerTypes.ANNOTATIONS?(({type:e,label:t,icon:a,disabled:n,toolTipContent:i})=>({panel:1,toolTipContent:i,disabled:n,name:Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"m",responsive:!1},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)("span",{className:"lnsLayerAddButton__label"},t)),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiBadge,{className:"lnsLayerAddButton__techBadge",color:"hollow",isDisabled:n},u.i18n.translate("xpack.lens.configPanel.experimentalLabel",{defaultMessage:"Technical preview"})))),className:"lnsLayerAddButton",icon:a&&Object(x.jsx)(b.EuiIcon,{size:"m",type:a}),"data-test-subj":`lnsLayerAddButton-${e}`}))(e):{toolTipContent:l,disabled:s,name:Object(x.jsx)("span",{className:"lnsLayerAddButtonLabel"},n),className:"lnsLayerAddButton",icon:i&&Object(x.jsx)(b.EuiIcon,{size:"m",type:i}),"data-test-subj":`lnsLayerAddButton-${a}`,onClick:()=>{t(a),r(!1)}}}))},{id:1,initialFocusedItemIndex:0,title:u.i18n.translate("xpack.lens.configPanel.selectAnnotationMethod",{defaultMessage:"Select annotation method"}),items:[{name:u.i18n.translate("xpack.lens.configPanel.newAnnotation",{defaultMessage:"New annotation"}),icon:"plusInCircle",onClick:()=>{t(z.LayerTypes.ANNOTATIONS),r(!1)},"data-test-subj":"lnsAnnotationLayer_new"},{name:u.i18n.translate("xpack.lens.configPanel.loadFromLibrary",{defaultMessage:"Load from library"}),icon:"folderOpen",onClick:()=>{c(!0),r(!1)},"data-test-subj":"lnsAnnotationLayer_addFromLibrary"}]}]})),o&&Object(x.jsx)(fs,{isLoadLibraryVisible:o,setLoadLibraryFlyoutVisible:c,eventAnnotationService:a,isInlineEditing:n,addLayer:e=>{t(z.LayerTypes.ANNOTATIONS,e)}}))}function vs({title:e,dataView:t,index:a,palette:n,children:i,"data-test-subj-prefix":s}){const{euiTheme:l}=Object(b.useEuiTheme)(),r=Boolean(n),o=n&&1===n.length,u=n&&n.length>1,c=o?"stopFilled":"color";return Object(x.jsx)("li",{key:`${e}-${t}-${a}`,"data-test-subj":`${s}-${a}`,css:Object(x.css)("margin:",l.size.base," 0 0;","")},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},r?Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiIcon,{color:o?n[0]:void 0,type:c,"data-test-subj":`${s}-${a}-icon`})):null,Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiText,{size:"s","data-test-subj":`${s}-${a}-title`},e)),Object(x.jsx)(b.EuiFlexItem,{grow:!1},i)),u?Object(x.jsx)("div",{css:Object(x.css)("margin-top:",l.size.xs,";overflow-y:hidden;height:",l.size.xs,";margin-left:",l.size.l,";","")},Object(x.jsx)(b.EuiColorPaletteDisplay,{size:"xs",palette:n,"data-test-subj":`${s}-${a}-palette`})):null)}function hs({layers:e,visualizationInfo:t,dataViews:a}){return Object(x.jsx)(l.a.Fragment,null,e.map(((e,n)=>{const i=a.indexPatterns[e.indexPatternId],s=t.layers.find((({layerId:t})=>t===e.layerId)),l=(null==s?void 0:s.label)||u.i18n.translate("xpack.lens.layerTitle.fallbackLabel",{defaultMessage:"Layer"}),r=null==s?void 0:s.palette;return Object(x.jsx)(vs,{title:l,index:n,dataView:i.id,palette:r,"data-test-subj-prefix":"lns-feature-badges-ignoreGlobalFilters"})})))}function xs({checked:e,onChange:t}){return Object(x.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",label:u.i18n.translate("xpack.lens.layerSettings.ignoreGlobalFilters",{defaultMessage:"Use global filters"})},Object(x.jsx)(b.EuiSwitch,{label:u.i18n.translate("xpack.lens.layerSettings.ignoreGlobalFilters",{defaultMessage:"Use global filters"}),showLabel:!1,checked:e,"data-test-subj":"lns-layerSettings-ignoreGlobalFilters",onChange:()=>t(!e),compressed:!0}))}function ys({state:e,setState:t,section:a,layerId:n}){if("appearance"===a)return null;const i=e.layers.find((e=>e.layerId===n));return i&&Ha(i)?Object(x.jsx)(xs,{checked:!i.ignoreGlobalFilters,onChange:()=>{const a=e.layers.findIndex((e=>e===i)),n={...i,ignoreGlobalFilters:!i.ignoreGlobalFilters},s=[...e.layers];s[a]=n,Object(p.d)(n.ignoreGlobalFilters?"ignore_global_filters":"use_global_filters"),t({...e,layers:s})}}):null}const js=({core:e,storage:t,data:a,paletteService:n,fieldFormats:s,useLegacyTimeAxis:l,kibanaTheme:r,eventAnnotationService:o,unifiedSearch:d,dataViewsService:p,savedObjectsTagging:m})=>({id:"lnsXY",visualizationTypes:Ia.visualizationTypes,getVisualizationTypeId(e){const t=Za(e);return"mixed"===t?t:t.id},getLayerIds:e=>rn(e).map((e=>e.layerId)),getRemoveOperation(e,t){const a=rn(e,z.LayerTypes.DATA).map((e=>e.layerId));return a.includes(t)&&1===a.length?"clear":"remove"},removeLayer:(e,t)=>({...e,layers:e.layers.filter((e=>e.layerId!==t))}),cloneLayer(e,t,a,n){const i=e.layers.find((e=>e.layerId===t));if(i){Ha(i)&&i.annotations.forEach((e=>n.set(e.id,Object(nt.a)())));let t=Object(st.renewIDs)(i,[...n.keys()],(e=>n.get(e)));return t.layerId=a,Ha(t)&&Wa(t)&&(t={annotations:t.annotations,ignoreGlobalFilters:t.ignoreGlobalFilters,layerId:t.layerId,layerType:t.layerType,indexPatternId:t.indexPatternId}),{...e,layers:[...e.layers,t]}}return e},appendLayer(e,t,a,n,i){var s,l;if("metricTrendline"===a)return e;const r=null===(s=Va(e.layers))||void 0===s||null===(l=s[0])||void 0===l?void 0:l.seriesType;return{...e,layers:[...e.layers,ln({seriesType:r||e.preferredSeriesType,layerId:t,layerType:a,indexPatternId:n,extraArg:i})]}},clearLayer:(e,t,a)=>({...e,layers:e.layers.map((n=>n.layerId!==t?n:ln({seriesType:e.preferredSeriesType,layerId:t,indexPatternId:a})))}),getPersistableState:e=>function(e){const t=[],a=[];return e.layers.forEach((e=>{if(Ha(e))if(Wa(e)){const n=`ref-${Object(Fa.v4)()}`;if(t.push({type:Sa.a,id:e.annotationGroupId,name:n}),hn(e)){const i={persistanceType:"linked",cachedMetadata:e.cachedMetadata||{title:e.__lastSaved.title,description:e.__lastSaved.description,tags:e.__lastSaved.tags},layerId:e.layerId,layerType:e.layerType,annotationGroupRef:n,annotations:e.annotations,ignoreGlobalFilters:e.ignoreGlobalFilters};a.push(i),t.push({type:"index-pattern",id:e.indexPatternId,name:vn(e.layerId)})}else{const t={persistanceType:"byReference",layerId:e.layerId,layerType:e.layerType,annotationGroupRef:n};a.push(t)}}else{const{indexPatternId:n,...i}=e;t.push({type:"index-pattern",id:n,name:vn(e.layerId)}),a.push({...i,persistanceType:"byValue"})}else a.push(e)})),{savedObjectReferences:t,state:{...e,layers:a}}}(e),getDescription:Ja,switchVisualizationType:(e,t)=>({...t,preferredSeriesType:e,layers:t.layers.map((t=>({...t,seriesType:e})))}),getSuggestions:jn,triggers:[N.VIS_EVENT_TO_TRIGGER.filter,N.VIS_EVENT_TO_TRIGGER.brush],initialize(e,t,a,n,i){const s=t&&function(e){return e.layers.some(Ua)}(t)?xn(t,n,i):t;return s||{title:"Empty XY chart",legend:{isVisible:!0,position:it.Position.Right},valueLabels:"hide",preferredSeriesType:tn,layers:[{layerId:e(),accessors:[],position:it.Position.Top,seriesType:tn,showGridlines:!1,layerType:z.LayerTypes.DATA,palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0,colorMapping:"colorMapping"===(null==a?void 0:a.type)?a.value:Object(st.getColorMappingDefaults)()}]}},getLayerType(e,t){var a;return null==t||null===(a=t.layers.find((({layerId:t})=>t===e)))||void 0===a?void 0:a.layerType},getSupportedLayers:(e,t)=>[an,Kn(e,t),ni(e,t)],getSupportedActionsForLayer(t,n,i,s,l){const u=n.layers.findIndex((e=>e.layerId===t)),c=n.layers[u],d=[];return Ha(c)&&d.push(...ms({state:n,layer:c,setState:i,registerLibraryAnnotationGroup:s,core:e,isSaveable:l,eventAnnotationService:o,savedObjectsTagging:m,dataViews:a.dataViews,kibanaTheme:r})),d},getCustomRemoveLayerText(e,t){const a=t.layers.findIndex((t=>t.layerId===e)),n=t.layers[a];if(n&&Wa(n))return{title:`Delete "${Ka(n)}"`}},hasLayerSettings({state:e,layerId:t}){var a;const n=null===(a=e.layers)||void 0===a?void 0:a.find((({layerId:e})=>e===t));return{data:Boolean(n&&Ha(n)),appearance:!1}},LayerSettingsComponent:e=>Object(x.jsx)(ys,e),onIndexPatternChange(e,t,a){const n=e.layers.findIndex((e=>e.layerId===a)),i=e.layers[n];if(!i||!Ha(i))return e;const s=[...e.layers];return s[n]={...i,indexPatternId:t},{...e,layers:s}},getConfiguration({state:e,frame:t,layerId:a}){const i=e.layers.find((e=>e.layerId===a));if(!i)return{groups:[]};if(Ha(i))return(({state:e,frame:t,layer:a})=>{const n=Ba("x",{isHorizontal:mn(e.layers)});return{groups:[{groupId:"xAnnotations",groupLabel:n,dimensionEditorGroupLabel:u.i18n.translate("xpack.lens.indexPattern.annotationsDimensionEditorLabel",{defaultMessage:"{groupLabel} annotation",values:{groupLabel:n}}),accessors:Jn(a),dataTestSubj:"lnsXY_xAnnotationsPanel",requiredMinDimensionCount:0,supportsMoreColumns:!0,supportFieldFormat:!1,enableDimensionEditor:!0,filterOperations:()=>!1}]}})({state:e,frame:t,layer:i});const l=Oi(t.datasourceLayers[i.layerId],i);if(Ga(i))return si({state:e,frame:t,layer:i,sortedAccessors:l});const o=Os({state:e,frame:t,layer:i,fieldFormats:s,paletteService:n,accessors:l}),c=i,d=Va(e.layers),p=mn(e.layers),{left:m,right:g}=An([i],t.activeData),f=Boolean(c.accessors.length<2||m.length&&m.length<2||g.length&&g.length<2)&&d.filter((e=>{if(za(e)&&e.seriesType===c.seriesType&&Boolean(e.xAccessor)===Boolean(c.xAccessor)&&Boolean(e.splitAccessor)===Boolean(c.splitAccessor)){const{left:a,right:n}=An([e],t.activeData);return e.accessors.length&&(Boolean(a.length)===Boolean(m.length)||Boolean(n.length)===Boolean(g.length))}return!1})).length<2,b=!!i.colorMapping;let v=[];var h,x;return b?r.theme$.subscribe({next(e){v=Object(xt.c)(e.darkMode,i.colorMapping)}}).unsubscribe():v=n.get((null===(h=c.palette)||void 0===h?void 0:h.name)||"default").getCategoricalColors(10,null===(x=c.palette)||void 0===x?void 0:x.params),{groups:[{groupId:"x",groupLabel:Ba("x",{isHorizontal:p}),accessors:c.xAccessor?[{columnId:c.xAccessor}]:[],filterOperations:dn,supportsMoreColumns:!c.xAccessor,dataTestSubj:"lnsXY_xDimensionPanel"},{groupId:"y",groupLabel:Ba("y",{isHorizontal:p}),accessors:o,filterOperations:cn,isMetricDimension:!0,supportsMoreColumns:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsXY_yDimensionPanel",enableDimensionEditor:!0},{groupId:"breakdown",groupLabel:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Breakdown"}),accessors:c.splitAccessor?[{columnId:c.splitAccessor,triggerIconType:c.collapseFn?"aggregate":"colorBy",palette:c.collapseFn?void 0:v}]:[],filterOperations:dn,supportsMoreColumns:!c.splitAccessor,dataTestSubj:"lnsXY_splitDimensionPanel",requiredMinDimensionCount:c.seriesType.includes("percentage")&&f?1:0,enableDimensionEditor:!0,isBreakdownDimension:!0}]}},getMainPalette:e=>{if(!e||0===e.layers.length)return;const t=(e.layers||[]).find((e=>za(e)));return null!=t&&t.colorMapping?{type:"colorMapping",value:t.colorMapping}:null!=t&&t.palette?{type:"legacyPalette",value:t.palette}:void 0},getDropProps(e){if(!e.source)return;const t=e.source.indexPatternId,a=e.target.indexPatternId;if(a&&t===a){if(Object(st.isDraggedDataViewField)(e.source)){if("document"===e.source.field.type)return;return e.target.isNewColumn?{dropTypes:["field_add"]}:{dropTypes:["field_replace"]}}return Object(st.isOperationFromTheSameGroup)(e.source,e.target)?e.target.isNewColumn?{dropTypes:["duplicate_compatible"]}:{dropTypes:["reorder"]}:Object(st.isOperationFromCompatibleGroup)(e.source,e.target)?{dropTypes:e.target.isNewColumn?["move_compatible","duplicate_compatible"]:["replace_compatible","replace_duplicate_compatible","swap_compatible"]}:void 0}},onDrop(e){const t=e.prevState.layers.find((t=>t.layerId===e.target.layerId));if(!t)throw new Error("target layer should exist");return Ha(t)?(null==Zn?void 0:Zn(e))||e.prevState:Object(rs.a)(e,this)},setDimension(e){const{prevState:t,layerId:a,columnId:n,groupId:i}=e,s=t.layers.find((e=>e.layerId===a));if(!s)return t;if(Ga(s))return(({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i})=>{var s,l;const r=e.layers.find((e=>e.layerId===t));if(!r||!Ga(r))return e;const o={...r};o.accessors=[...o.accessors.filter((e=>e!==a)),a];const u=null===(s=o.yConfig)||void 0===s?void 0:s.some((({forAccessor:e})=>e===a)),c=!!i&&(null===(l=qa(e.layers).map((({yConfig:e})=>e)).flat())||void 0===l?void 0:l.find((e=>(null==e?void 0:e.forAccessor)===i)));if(!u){const e="xReferenceLine"===n?"bottom":"yReferenceLineRight"===n?"right":"left";o.yConfig=[...o.yConfig||[],{...c,forAccessor:a,axisMode:e}]}return{...e,layers:e.layers.map((e=>e.layerId===t?o:e))}})(e);if(Ha(s))return(({prevState:e,layerId:t,columnId:a,previousColumn:n,frame:i})=>{var s;const l=e.layers.find((e=>e.layerId===t));if(!l||!Ha(l))return e;const r=n?null===(s=l.annotations)||void 0===s?void 0:s.find((({id:e})=>e===n)):void 0;return{...e,layers:e.layers.map((n=>n.layerId===t?{...l,annotations:[...l.annotations,Object(Ma.a)(a,Qn(Va(e.layers),i),r)]}:n))}})(e);const l=Object.assign({},s);return"x"===i&&(l.xAccessor=n),"y"===i&&(l.accessors=[...l.accessors.filter((e=>e!==n)),n]),"breakdown"===i&&(l.splitAccessor=n),{...t,layers:t.layers.map((e=>e.layerId===a?l:e))}},removeDimension({prevState:e,layerId:t,columnId:a,frame:n}){const i=e.layers.find((e=>e.layerId===t));if(!i)return e;if(Ha(i)){const n={...i,annotations:i.annotations.filter((({id:e})=>e!==a))},s=e.layers.map((e=>e.layerId===t?n:e));return{...e,layers:s}}const s={...i};var l;za(s)&&(s.xAccessor===a?delete s.xAccessor:s.splitAccessor===a&&(delete s.splitAccessor,delete s.palette)),s.accessors.includes(a)&&(s.accessors=s.accessors.filter((e=>e!==a))),"yConfig"in s&&(s.yConfig=null===(l=s.yConfig)||void 0===l?void 0:l.filter((({forAccessor:e})=>e!==a)));let r=e.layers.map((e=>e.layerId===t?s:e));const o=ti(Va(e.layers),n.datasourceLayers,n.activeData);return Object.keys(o).every((e=>!o[e]))&&(r=r.filter((e=>za(e)||"accessors"in e&&e.accessors.length))),{...e,layers:r}},LayerPanelComponent(e){const{onChangeIndexPattern:t,...a}=e;return Object(x.jsx)(Gi,i()({},a,{onChangeIndexPattern:e=>{t(e)}}))},LayerHeaderComponent:e=>Object(x.jsx)(Vi,e),ToolbarComponent:e=>Object(x.jsx)(Ri,i()({},e,{useLegacyTimeAxis:l})),DimensionEditorComponent(e){const t={...e,datatableUtilities:a.datatableUtilities,formatFactory:s.deserialize,paletteService:n},l=w()(r.theme$,{darkMode:!1}).darkMode,o=e.state.layers.find((t=>t.layerId===e.layerId));return Ga(o)?Object(x.jsx)(Ji,t):Ha(o)?Object(x.jsx)(ss,i()({},t,{dataViewsService:p})):Object(x.jsx)(mi,i()({},t,{darkMode:l}))},DimensionEditorDataExtraComponent(e){const t={...e,datatableUtilities:a.datatableUtilities,formatFactory:s.deserialize,paletteService:n},i=e.state.layers.find((t=>t.layerId===e.layerId));return Ga(i)||Ha(i)?null:Object(x.jsx)(gi,t)},getAddLayerButtonComponent:e=>Object(x.jsx)(bs,i()({},e,{eventAnnotationService:o,addLayer:async(t,a)=>{var n;t===z.LayerTypes.ANNOTATIONS&&a&&(await e.ensureIndexPattern(null!==(n=a.dataViewSpec)&&void 0!==n?n:a.indexPatternId),e.registerLibraryAnnotationGroup({id:a.annotationGroupId,group:a})),e.addLayer(t,a,!!a)}})),toExpression:(e,t,a,i={})=>Ii(e,t,n,i,o),toPreviewExpression:(e,t,a={})=>function(e,t,a,n,i){return Ii({...e,layers:e.layers.map((e=>((e,t)=>za(e)?t[Ut.layerTypes.DATA](e):Ga(e)?t[Ut.layerTypes.REFERENCELINE](e):t[Ut.layerTypes.ANNOTATIONS](e))(e,ki))),legend:{...e.legend,isVisible:!1},valueLabels:"hide"},t,a,n,i)}(e,t,n,a,o),getUserMessages(e,{frame:t}){const{datasourceLayers:a,dataViews:i,activeData:l}=t,r=Ya(e.layers),o=[],d=Yn(Va(e.layers),t);r.forEach((e=>{e.annotations.forEach((t=>{d||o.push({severity:"error",fixableInEditor:!0,displayLocations:[{id:"dimensionButton",dimensionId:t.id}],shortMessage:u.i18n.translate("xpack.lens.xyChart.addAnnotationsLayerLabelDisabledHelp",{defaultMessage:"Annotations require a time based chart to work. Add a date histogram."}),longMessage:""});const a=function(e,t,a){var n;if(!e)return[];const i=e.annotations.find((({id:e})=>e===t));if(!i||!Object(Ma.f)(i))return[];const s=a.indexPatterns[e.indexPatternId],l=[];null!=i.timeField&&""!==i.timeField||l.push(u.i18n.translate("xpack.lens.xyChart.annotationError.timeFieldEmpty",{defaultMessage:"Time field is missing"})),i.timeField&&!Boolean(s.getFieldByName(i.timeField))&&l.push(u.i18n.translate("xpack.lens.xyChart.annotationError.timeFieldNotFound",{defaultMessage:"Time field {timeField} not found in data view {dataView}",values:{timeField:i.timeField,dataView:s.title}}));const{isValid:r,error:o}=Object(Aa.b)(null==i?void 0:i.filter,s);if(!r&&o&&l.push(o),i.textField&&!Boolean(s.getFieldByName(i.textField))&&l.push(u.i18n.translate("xpack.lens.xyChart.annotationError.textFieldNotFound",{defaultMessage:"Text field {textField} not found in data view {dataView}",values:{textField:i.textField,dataView:s.title}})),null!==(n=i.extraFields)&&void 0!==n&&n.length){const e=[];for(const t of i.extraFields)Boolean(s.getFieldByName(t))||e.push(t);e.length&&l.push(u.i18n.translate("xpack.lens.xyChart.annotationError.tooltipFieldNotFound",{defaultMessage:"Tooltip {missingFields, plural, one {field} other {fields}} {missingTooltipFields} not found in data view {dataView}",values:{missingTooltipFields:e.join(", "),missingFields:e.length,dataView:s.title}}))}return l}(e,t.id,i);o.push(...a.map((e=>({severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"},{id:"dimensionButton",dimensionId:t.id}],shortMessage:e,longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.xyChart.annotationError",defaultMessage:"Annotation {annotationName} has an error: {errorMessage}",values:{annotationName:t.label,errorMessage:e}})}))))}))}));const p=({accessors:e})=>null==e||0===e.length,m=Va(e.layers),g=({splitAccessor:e,seriesType:t})=>t.includes("percentage")&&null==e;if(e&&e.layers.length>1){const e=[["Y",p],["Break down",g]],t=m.filter((({accessors:e,xAccessor:t,splitAccessor:a,layerType:n})=>e.length>0||null!=t||null!=a));for(const[a,n]of e){const e=on(a,t,n);e.valid||o.push({severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:e.payload.shortMessage,longMessage:e.payload.longMessage})}}o.push(...function(e,t){const a=Va(e.layers),n=[],i=a.findIndex(Na("interval","date",t)),s=a.findIndex(Na("interval","number",t)),l=a.findIndex(Na("ordinal",void 0,t));if(e.layers.length>1){const t=[i,s,l].filter((e=>e>=0)).sort(((e,t)=>e-t));if(t.length>1){const[a,...i]=t,s=Ba("x",{isHorizontal:mn(e.layers)});for(const e of i)n.push({shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:s}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureXLong",{defaultMessage:"The {axis} data in layer {firstLayer} is incompatible with the data in layer {secondLayer}. Select a new function for the {axis}.",values:{axis:s,firstLayer:a+1,secondLayer:e+1}})})}}return n}(e,a).map((({shortMessage:e,longMessage:t})=>({severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:e,longMessage:t}))));for(const t of Va(e.layers)){const n=a[t.layerId];if(n)for(const a of t.accessors){const t=n.getOperationForColumnId(a);t&&"number"!==t.dataType&&o.push({severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYShort",{defaultMessage:"Wrong data type for {axis}.",values:{axis:Ba("y",{isHorizontal:mn(e.layers)})}}),longMessage:u.i18n.translate("xpack.lens.xyVisualization.dataTypeFailureYLong",{defaultMessage:"The dimension {label} provided for the {axis} has the wrong data type. Expected number but have {dataType}",values:{label:t.label,dataType:t.dataType,axis:Ba("y",{isHorizontal:mn(e.layers)})}})})}}const f=[];if((null==e?void 0:e.layers.length)>0&&l){const t=[...Va(e.layers),...qa(e.layers)].filter((({accessors:e})=>e.length>0)),n=[];for(const e of t){const{layerId:t,accessors:i}=e,s=(null==l?void 0:l[t])&&l[t].rows;if(!s)break;const r=bn(e,a[t]);for(const e of i)s.some((t=>Array.isArray(t[e])))&&n.push(r[e])}n.forEach((e=>f.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{key:e,id:"xpack.lens.xyVisualization.arrayValues",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(x.jsx)("strong",null,e)}})})))}const b=function(e,t,a,n){const i=Ya(e.layers).filter((e=>e.ignoreGlobalFilters&&e.annotations.some((e=>"manual"!==e.type))));if(!i.length)return[];const s=Is(e,t,a,n);return[{uniqueId:"ignoring-global-filters-layers",severity:"info",fixableInEditor:!1,shortMessage:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsIgnoreTitle",{defaultMessage:"Layers ignoring global filters"}),longMessage:Object(x.jsx)(hs,{layers:i.map((({layerId:e,indexPatternId:t})=>({layerId:e,indexPatternId:t}))),visualizationInfo:s,dataViews:t.dataViews}),displayLocations:[{id:"embeddableBadge"}]}]}(e,t,n,s);return o.concat(f,b)},getUniqueLabels:e=>ei(e.layers),getUsedDataView(e,t){var a;return null===(a=Ya(e.layers).find((e=>e.layerId===t)))||void 0===a?void 0:a.indexPatternId},getUsedDataViews(e){var t;return null!==(t=null==e?void 0:e.layers.filter(Ha).map((({indexPatternId:e})=>e)))&&void 0!==t?t:[]},DimensionTriggerComponent:({columnId:e,label:t})=>t?Object(x.jsx)(Ea.a,{id:e,label:t||Xn}):null,getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},isEqual(e,t,a,n,i){const s=xn(e,i,t),l=xn(a,i,n);return Object(qt.isEqual)(s,l)},getVisualizationInfo:(e,t)=>Is(e,t,n,s)}),Os=({accessors:e,frame:t,fieldFormats:a,paletteService:n,state:i,layer:s})=>{let l=e.map((e=>({columnId:e})));return t.activeData&&(l=function(e,t,a,n){if(Ga(a))return(e=>e.accessors.map((t=>{var a;const n=null===(a=e.yConfig)||void 0===a?void 0:a.find((e=>e.forAccessor===t));return ii(t,null==n?void 0:n.color)})))(a);if(Ha(a))return Jn(a);const i=!a.collapseFn&&a.splitAccessor;return a.accessors.map((s=>{var l;if(i)return ui(s);const r=null===(l=a.yConfig)||void 0===l?void 0:l.find((e=>e.forAccessor===s));return null!=r&&r.color?{columnId:s,triggerIconType:"color",color:r.color}:ci(a,s,e,t,n)}))}(oi(Va(i.layers),{tables:t.activeData},a.deserialize),t,{...s,accessors:e.filter((e=>s.accessors.includes(e)))},n)),l};function Is(e,t,a,n){const i=mn(e.layers);return{layers:e.layers.map((s=>{const l=[],r=[];let o,c,d;if(za(s)){o=s.seriesType;const g=Ia.visualizationTypes.find((e=>e.id===o));if(c=null==g?void 0:g.icon,d=(null==g?void 0:g.fullLabel)||(null==g?void 0:g.label),s.xAccessor&&r.push({name:Ba("x",{isHorizontal:i}),id:s.xAccessor,dimensionType:"x"}),s.accessors&&s.accessors.length&&(s.accessors.forEach((e=>{r.push({name:Ba("y",{isHorizontal:i}),id:e,dimensionType:"y"})})),null!=t&&t.datasourceLayers&&t.activeData)){const i=Oi(t.datasourceLayers[s.layerId],s),r=Os({state:e,frame:t,layer:s,fieldFormats:n,paletteService:a,accessors:i});l.push(...r.flatMap((({color:e})=>e)))}var p,m;s.splitAccessor&&(r.push({name:u.i18n.translate("xpack.lens.xyChart.splitSeries",{defaultMessage:"Breakdown"}),dimensionType:"breakdown",id:s.splitAccessor}),s.collapseFn||l.push(...a.get((null===(p=s.palette)||void 0===p?void 0:p.name)||"default").getCategoricalColors(10,null===(m=s.palette)||void 0===m?void 0:m.params)))}if(Ga(s)&&s.accessors&&s.accessors.length&&(s.accessors.forEach((e=>{r.push({name:u.i18n.translate("xpack.lens.xyChart.layerReferenceLine",{defaultMessage:"Reference line"}),dimensionType:"reference_line",id:e})})),d=u.i18n.translate("xpack.lens.xyChart.layerReferenceLineLabel",{defaultMessage:"Reference lines"}),c=ka,null!=t&&t.datasourceLayers&&t.activeData)){const a=Oi(t.datasourceLayers[s.layerId],s);l.push(...si({state:e,frame:t,layer:s,sortedAccessors:a}).groups.flatMap((({accessors:e})=>e.map((({color:e})=>e)))))}Ha(s)&&s.annotations&&s.annotations.length&&(s.annotations.forEach((e=>{r.push({name:u.i18n.translate("xpack.lens.xyChart.layerAnnotation",{defaultMessage:"Annotation"}),dimensionType:"annotation",id:e.id})})),d=u.i18n.translate("xpack.lens.xyChart.layerAnnotationsLabel",{defaultMessage:"Annotations"}),c=Ta,l.push(...s.annotations.filter((({isHidden:e})=>!e)).map((e=>Ca(e).color))));const g=null==l?void 0:l.filter(st.nonNullable);return{layerId:s.layerId,layerType:s.layerType,chartType:o,icon:c,label:d,dimensions:r,palette:g.length?g:void 0}}))}}var ks=a(12);class xy_XyVisualization{setup(e,{editorFrame:t}){t.registerVisualization((async()=>{const{getXyVisualization:t}=await Promise.resolve().then(a.bind(null,558)),[n,{charts:i,data:s,fieldFormats:l,eventAnnotation:r,unifiedSearch:o,savedObjectsTagging:u,dataViews:c}]=await e.getStartServices(),[d,p]=await Promise.all([i.palettes.getPalettes(),r.getService()]),m=e.uiSettings.get(ue.LEGACY_TIME_AXIS);return t({core:n,data:s,storage:new ks.Storage(localStorage),paletteService:d,eventAnnotationService:p,fieldFormats:l,useLegacyTimeAxis:m,kibanaTheme:e.theme,unifiedSearch:o,dataViewsService:c,savedObjectsTagging:u})}))}}const Ts=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:30,height:22,viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{className:h.a.subdued,d:"M16 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V1zM0 17a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1v-4zm17-9a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V9a1 1 0 00-1-1h-4zm-1 9a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4zm9-17a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V1a1 1 0 00-1-1h-4z"}),Object(x.jsx)("path",{className:h.a.accent,d:"M0 1a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V1zm0 8a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V9zm9-9a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V1a1 1 0 00-1-1H9zM8 9a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1H9a1 1 0 01-1-1V9zm1 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1H9zm15-7a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1V9zm1 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1v-4a1 1 0 00-1-1h-4z"})),Ms="temperature",ws=u.i18n.translate("xpack.lens.heatmap.groupLabel",{defaultMessage:"Heatmap"}),Cs="heatmap",Es={heatmap:{shapeType:Cs,icon:Ts,label:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:ws}},Ss="x",Fs="y",Ps="cell",_s="heatmap_legend",As="heatmap_grid",Ls=({table:e,state:t,keptLayerIds:a})=>{var n,i,s,l,r,o,c,d,p,m,g,f,b,v,h;if((null==t?void 0:t.shape)===Cs&&(t.xAccessor||t.yAccessor||t.valueAccessor)&&"extended"!==e.changeType||e.columns.some((e=>e.operation.isStaticValue))||e.columns.some((e=>!e.operation.isBucketed&&"number"!==e.operation.dataType)))return[];if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];let x=0;const[y,j]=Object(qt.partition)(e.columns,(e=>e.operation.isBucketed));if(0===y.length&&0===j.length)return[];if(y.length>=3)return[];if(j.length>1)return[];const O=1===y.length&&0===j.length,I=0===y.length&&1===j.length,k=y.length>0&&0===j.length,T=1===j.length&&y.length>0&&y.every((e=>"date"===e.operation.dataType)),M="reduced"===e.changeType||"reorder"===e.changeType||O||T||k||I,w={shape:Cs,layerId:e.layerId,layerType:z.LayerTypes.DATA,legend:{isVisible:null===(n=null==t||null===(i=t.legend)||void 0===i?void 0:i.isVisible)||void 0===n||n,position:null!==(s=null==t||null===(l=t.legend)||void 0===l?void 0:l.position)&&void 0!==s?s:it.Position.Right,type:_s},gridConfig:{type:As,isCellLabelVisible:!1,isYAxisLabelVisible:null===(r=null==t||null===(o=t.gridConfig)||void 0===o?void 0:o.isYAxisLabelVisible)||void 0===r||r,isXAxisLabelVisible:null===(c=null==t||null===(d=t.gridConfig)||void 0===d?void 0:d.isXAxisLabelVisible)||void 0===c||c,isYAxisTitleVisible:null!==(p=null==t||null===(m=t.gridConfig)||void 0===m?void 0:m.isYAxisTitleVisible)&&void 0!==p&&p,isXAxisTitleVisible:null!==(g=null==t||null===(f=t.gridConfig)||void 0===f?void 0:f.isXAxisTitleVisible)&&void 0!==g&&g}},C=j.find((e=>"number"===e.operation.dataType));C&&(x+=.3,w.valueAccessor=C.columnId);const[E,S]=Object(qt.partition)(y,(e=>"interval"===e.operation.scale));return w.xAccessor=(null===(b=E[0])||void 0===b?void 0:b.columnId)||(null===(v=S[0])||void 0===v?void 0:v.columnId),w.yAccessor=null===(h=y.find((e=>e.columnId!==w.xAccessor)))||void 0===h?void 0:h.columnId,y.some((e=>"date"===e.operation.dataType))||(w.xAccessor&&(x+=.3),w.yAccessor&&(x+=.3)),[{state:w,title:u.i18n.translate("xpack.lens.heatmap.heatmapLabel",{defaultMessage:"Heat map"}),hide:M,previewIcon:Ts,score:Number(x.toFixed(1)),incomplete:O||I||k}]};a(256);const Ds=[{id:"heatmap_legend_show",value:"show",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.show",{defaultMessage:"Show"})},{id:"heatmap_legend_hide",value:"hide",label:u.i18n.translate("xpack.lens.heatmapChart.legendVisibility.hide",{defaultMessage:"Hide"})}],Rs=Object(s.memo)((e=>{var t;const{state:a,setState:n,frame:i}=e,l=a.legend.isVisible?"show":"hide",r=_t(a,i.datasourceLayers).truncateText,o=null==a?void 0:a.legend.legendSize,[c]=Object(s.useState)((()=>o===N.LegendSize.AUTO));return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.shared.curveLabel",{defaultMessage:"Visual options"}),type:"visualOptions",groupPosition:"left",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(k.j,{valueLabels:null!=a&&a.gridConfig.isCellLabelVisible?"show":"hide",onValueLabelChange:e=>{n({...a,gridConfig:{...a.gridConfig,isCellLabelVisible:"show"===e}})}})),Object(x.jsx)(k.e,{groupPosition:"right",legendOptions:Ds,mode:l,onDisplayChange:e=>{const t=Ds.find((({id:t})=>t===e)).value;"show"===t?n({...a,legend:{...a.legend,isVisible:!0}}):"hide"===t&&n({...a,legend:{...a.legend,isVisible:!1}})},position:null==a?void 0:a.legend.position,onPositionChange:e=>{n({...a,legend:{...a.legend,position:e}})},maxLines:null==a?void 0:a.legend.maxLines,onMaxLinesChange:e=>{n({...a,legend:{...a.legend,maxLines:e}})},shouldTruncate:null!==(t=null==a?void 0:a.legend.shouldTruncate)&&void 0!==t?t:r,onTruncateLegendChange:()=>{var e;const t=null!==(e=a.legend.shouldTruncate)&&void 0!==e?e:r;n({...a,legend:{...a.legend,shouldTruncate:!t}})},legendSize:o,onLegendSizeChange:e=>{n({...a,legend:{...a.legend,legendSize:e}})},showAutoLegendSizeOption:c}))),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(be.a,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.verticalAxisDisabledHelpText",{defaultMessage:"This setting only applies when vertical axis is enabled."}),condition:!Boolean(null==a?void 0:a.yAccessor)},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),type:Sn,groupPosition:"left",isDisabled:!Boolean(null==a?void 0:a.yAccessor),buttonDataTestSubj:"lnsHeatmapVerticalAxisButton",panelClassName:"lnsVisToolbarAxis__popover"},Object(x.jsx)(k.c,{axis:"yLeft",axisTitle:null==a?void 0:a.gridConfig.yTitle,updateTitleState:({title:e,visible:t})=>{n({...a,gridConfig:{...a.gridConfig,yTitle:e,isYAxisTitleVisible:t}})},isAxisTitleVisible:null==a?void 0:a.gridConfig.isYAxisTitleVisible}),Object(x.jsx)(k.b,{axis:"yLeft",updateTicksVisibilityState:e=>{n({...a,gridConfig:{...a.gridConfig,isYAxisLabelVisible:e}})},isAxisLabelVisible:null==a?void 0:a.gridConfig.isYAxisLabelVisible}))),Object(x.jsx)(be.a,{tooltipContent:u.i18n.translate("xpack.lens.heatmap.horizontalAxisDisabledHelpText",{defaultMessage:"This setting only applies when horizontal axis is enabled."}),condition:!Boolean(null==a?void 0:a.xAccessor)},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"}),type:En,groupPosition:"center",isDisabled:!Boolean(null==a?void 0:a.xAccessor),buttonDataTestSubj:"lnsHeatmapHorizontalAxisButton"},Object(x.jsx)(k.c,{axis:"x",axisTitle:null==a?void 0:a.gridConfig.xTitle,updateTitleState:({title:e,visible:t})=>n({...a,gridConfig:{...a.gridConfig,xTitle:e,isXAxisTitleVisible:t}}),isAxisTitleVisible:null==a?void 0:a.gridConfig.isXAxisTitleVisible}),Object(x.jsx)(k.b,{axis:"x",updateTicksVisibilityState:e=>{n({...a,gridConfig:{...a.gridConfig,isXAxisLabelVisible:e}})},isAxisLabelVisible:null==a?void 0:a.gridConfig.isXAxisLabelVisible}))))))}));function Bs(e,t,a,n){if(null==t||null==a)return{displayStops:[],activePalette:n};const i=null!=n?n:{type:"palette",name:Ms,accessor:a},s=Object(k.p)([a],t)[a];return{displayStops:Object(k.l)(e,i,s),currentMinMax:s,activePalette:i}}function Ns(e){var t;const{state:a,setState:n,frame:i,accessor:r,isInlineEditing:o}=e,[c,d]=Object(s.useState)(!1);if((null==a?void 0:a.valueAccessor)!==r)return null;const p=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],{displayStops:g,activePalette:f,currentMinMax:v}=Bs(e.paletteService,p,r,null!=a&&a.palette&&a.palette.accessor===r?a.palette:void 0);return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteHeatmapGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsHeatmap_dynamicColoring_palette",palette:g.map((({color:e})=>e)),type:m.h,onClick:()=>{d(!c)}})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsHeatmap_dynamicColoring_trigger","aria-label":u.i18n.translate("xpack.lens.paletteHeatmapGradient.customizeLong",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{d(!c)},size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteHeatmapGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:c,handleClose:()=>d(!c),title:u.i18n.translate("xpack.lens.table.colorByRangePanelTitle",{defaultMessage:"Color"}),isInlineEditing:o},f&&Object(x.jsx)(H,{palettes:e.paletteService,activePalette:f,dataBounds:v,setPalette:e=>{e.params&&!e.params.stops&&(e.params.stops=g),e.accessor=r,n({...a,palette:e})}}))))))}a(261);const zs=u.i18n.translate("xpack.lens.heatmapVisualization.heatmapGroupLabel",{defaultMessage:"Magnitude"});function Vs(e){const t=u.i18n.translate("xpack.lens.heatmap.verticalAxisLabel",{defaultMessage:"Vertical axis"}),a=u.i18n.translate("xpack.lens.heatmap.horizontalAxisLabel",{defaultMessage:"Horizontal axis"});return"x"===e?a:t}const Gs=e=>e.isBucketed&&"ordinal"===e.scale,qs=e=>Gs(e)||"interval"===e.scale,Hs=e=>!Gs(e)&&("ordinal"===e.scale||"ratio"===e.scale)&&(e=>"number"===e.dataType&&!e.isStaticValue)(e);function Us(e){return{...e,colors:((null==e?void 0:e.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==e?void 0:e.name)?((null==e?void 0:e.stops)||[]).map((({stop:e})=>e)):[],reverse:!1}}const $s=({paletteService:e,theme:t})=>({id:"lnsHeatmap",visualizationTypes:[{id:"heatmap",icon:Ts,label:u.i18n.translate("xpack.lens.heatmapVisualization.heatmapLabel",{defaultMessage:"Heat map"}),groupLabel:zs,showExperimentalBadge:!1,sortPriority:1}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.valueAccessor,delete t.xAccessor,delete t.yAccessor,t},switchVisualizationType:(e,t)=>({...t,shape:e}),getDescription:e=>Es.heatmap,initialize:(e,t,a)=>t||{layerId:e(),layerType:z.LayerTypes.DATA,title:"Empty Heatmap chart",shape:Cs,legend:{isVisible:!0,position:it.Position.Right,maxLines:1,type:_s},gridConfig:{type:As,isCellLabelVisible:!1,isYAxisLabelVisible:!0,isXAxisLabelVisible:!0,isYAxisTitleVisible:!0,isXAxisTitleVisible:!0}},getSuggestions:Ls,triggers:[N.VIS_EVENT_TO_TRIGGER.filter,N.VIS_EVENT_TO_TRIGGER.brush],getConfiguration({state:t,frame:a,layerId:n}){var i,s;const l=a.datasourceLayers[n];if(!(null==l?void 0:l.getTableSpec().map((({columnId:e})=>e))))return{groups:[]};const{displayStops:r,activePalette:o}=Bs(e,null===(i=a.activeData)||void 0===i?void 0:i[t.layerId],t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{groups:[{layerId:t.layerId,groupId:Ss,groupLabel:Vs(Ss),accessors:t.xAccessor?[{columnId:t.xAccessor}]:[],filterOperations:qs,supportsMoreColumns:!t.xAccessor,requiredMinDimensionCount:1,dataTestSubj:"lnsHeatmap_xDimensionPanel"},{layerId:t.layerId,groupId:Fs,groupLabel:Vs(Fs),accessors:t.yAccessor?[{columnId:t.yAccessor}]:[],filterOperations:qs,supportsMoreColumns:!t.yAccessor,requiredMinDimensionCount:0,isBreakdownDimension:!0,dataTestSubj:"lnsHeatmap_yDimensionPanel"},{layerId:t.layerId,groupId:Ps,groupLabel:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.heatmap.headingLabel",{defaultMessage:"Value"})},accessors:t.valueAccessor?[r.length&&(a.activeData||"number"!==(null==o||null===(s=o.params)||void 0===s?void 0:s.rangeType))?{columnId:t.valueAccessor,triggerIconType:"colorBy",palette:r.map((({color:e})=>e))}:{columnId:t.valueAccessor,triggerIconType:"none"}]:[],filterOperations:Hs,isMetricDimension:!0,supportsMoreColumns:!t.valueAccessor,enableDimensionEditor:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsHeatmap_cellPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const s={};return n===Ss&&(s.xAccessor=a),n===Fs&&(s.yAccessor=a),n===Ps&&(s.valueAccessor=a),{...e,...s}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.valueAccessor===a&&delete n.valueAccessor,e.xAccessor===a&&delete n.xAccessor,e.yAccessor===a&&delete n.yAccessor,n},DimensionEditorComponent:t=>Object(x.jsx)(Ns,i()({},t,{paletteService:e})),ToolbarComponent:e=>Object(x.jsx)(Rs,e),getSupportedLayers:()=>[{type:z.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.heatmap.addLayer",{defaultMessage:"Visualization"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression(t,a,n,i={}){var s,l,r,o,u,c,d,p,g,f;const b=a[t.layerId],v=i[t.layerId];if(!(null==b?void 0:b.getTableSpec().map((({columnId:e})=>e)))||!t.valueAccessor)return null;const h=Object(V.buildExpressionFunction)("heatmap_legend",{isVisible:t.legend.isVisible,position:t.legend.position,legendSize:t.legend.legendSize}),x=Object(V.buildExpressionFunction)("heatmap_grid",{strokeWidth:t.gridConfig.strokeWidth,strokeColor:t.gridConfig.strokeColor,isCellLabelVisible:t.gridConfig.isCellLabelVisible,isYAxisLabelVisible:t.gridConfig.isYAxisLabelVisible,isYAxisTitleVisible:null!==(s=t.gridConfig.isYAxisTitleVisible)&&void 0!==s&&s,yTitle:t.gridConfig.yTitle,isXAxisLabelVisible:t.gridConfig.isXAxisLabelVisible,isXAxisTitleVisible:null!==(l=t.gridConfig.isXAxisTitleVisible)&&void 0!==l&&l,xTitle:t.gridConfig.xTitle}),y=Object(V.buildExpressionFunction)("heatmap",{xAccessor:null!==(r=t.xAccessor)&&void 0!==r?r:"",yAccessor:null!==(o=t.yAccessor)&&void 0!==o?o:"",valueAccessor:null!==(u=t.valueAccessor)&&void 0!==u?u:"",lastRangeIsRightOpen:null===(c=t.palette)||void 0===c||null===(d=c.params)||void 0===d||!d.continuity||["above","all"].includes(t.palette.params.continuity),palette:null!==(p=t.palette)&&void 0!==p&&p.params?e.get(m.a).toExpression(Us(null===(g=t.palette)||void 0===g?void 0:g.params)):e.get(Ms).toExpression(),legend:Object(V.buildExpression)([h]),gridConfig:Object(V.buildExpression)([x])});return{type:"expression",chain:[...null!==(f=null==v?void 0:v.chain)&&void 0!==f?f:[],y.toAst()]}},toPreviewExpression(t,a,n={}){var i,s,l,r,o,u;const c=a[t.layerId],d=n[t.layerId];if(!(null==c?void 0:c.getTableSpec().map((({columnId:e})=>e)))||!t.valueAccessor)return null;const p=Object(V.buildExpressionFunction)("heatmap_legend",{isVisible:!1,position:"right"}),g=Object(V.buildExpressionFunction)("heatmap_grid",{strokeWidth:1,isCellLabelVisible:!1,isYAxisLabelVisible:!1,isYAxisTitleVisible:!1,yTitle:t.gridConfig.yTitle,isXAxisLabelVisible:!1,isXAxisTitleVisible:!1,xTitle:t.gridConfig.xTitle}),f=Object(V.buildExpressionFunction)("heatmap",{xAccessor:null!==(i=t.xAccessor)&&void 0!==i?i:"",yAccessor:null!==(s=t.yAccessor)&&void 0!==s?s:"",valueAccessor:null!==(l=t.valueAccessor)&&void 0!==l?l:"",legend:Object(V.buildExpression)([p]),gridConfig:Object(V.buildExpression)([g]),palette:null!==(r=t.palette)&&void 0!==r&&r.params?e.get(m.a).toExpression(Us(null===(o=t.palette)||void 0===o?void 0:o.params)):e.get(Ms).toExpression()});return{type:"expression",chain:[...null!==(u=null==d?void 0:d.chain)&&void 0!==u?u:[],f.toAst()]}},getUserMessages(e,{frame:t}){if(!e.yAccessor&&!e.xAccessor&&!e.valueAccessor)return[];const a=[];e.xAccessor||a.push({severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorShortMessage",{defaultMessage:"Missing Horizontal axis."}),longMessage:u.i18n.translate("xpack.lens.heatmapVisualization.missingXAccessorLongMessage",{defaultMessage:"Configuration for the horizontal axis is missing."})});let n=[];if(null!=e&&e.layerId&&t.activeData&&e.valueAccessor){const a=t.activeData[e.layerId]&&t.activeData[e.layerId].rows;if(a){const i=a.some((t=>Array.isArray(t[e.valueAccessor]))),s=t.datasourceLayers[e.layerId],l=null==s?void 0:s.getOperationForColumnId(e.valueAccessor);n=i?[{severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.heatmapVisualization.arrayValuesWarningMessage",defaultMessage:"{label} contains array values. Your visualization may not render as expected.",values:{label:Object(x.jsx)("strong",null,null==l?void 0:l.label)}})}]:[]}}return[...a,...n]},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(t,a){var n,i;const s=[];t.xAccessor&&s.push({id:t.xAccessor,name:Vs(Ss),dimensionType:"x"}),t.yAccessor&&s.push({id:t.yAccessor,name:Vs(Fs),dimensionType:"y"}),t.valueAccessor&&s.push({id:t.valueAccessor,name:u.i18n.translate("xpack.lens.heatmap.cellValueLabel",{defaultMessage:"Cell value"}),dimensionType:"value"});const{displayStops:l}=Bs(e,(null==a||null===(n=a.activeData)||void 0===n?void 0:n[t.layerId])||(null==a||null===(i=a.activeData)||void 0===i?void 0:i.default),t.valueAccessor,null!=t&&t.palette&&t.palette.accessor===t.valueAccessor?t.palette:void 0);return{layers:[{layerId:t.layerId,layerType:t.layerType,chartType:t.shape,...this.getDescription(t),dimensions:s,palette:l.length?l.map((({color:e})=>e)):void 0}]}}});class HeatmapVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getHeatmapVisualization:t}=await Promise.resolve().then(a.bind(null,558));return t({paletteService:await n.palettes.getPalettes(),theme:e.theme})}))}}var Ws=a(46),Xs=a(56);const Ys=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{className:h.a.subdued,d:"M1 13a1 1 0 00-1 1v2a1 1 0 102 0v-1h5v1a1 1 0 102 0v-1h5v1a1 1 0 102 0v-1h5v1a1 1 0 102 0v-1h5v1a1 1 0 102 0v-2a1 1 0 00-1-1H1z"}),Object(x.jsx)("path",{className:h.a.accent,d:"M0 6a1 1 0 011-1h24a1 1 0 011 1v4a1 1 0 01-1 1H1a1 1 0 01-1-1V6z"})),Qs=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({width:"30",height:"22",viewBox:"0 0 30 22",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{className:h.a.subdued,d:"M16 22a1 1 0 01-1-1V4a1 1 0 011-1h4a1 1 0 011 1v17a1 1 0 01-1 1h-4z"}),Object(x.jsx)("path",{className:h.a.accent,d:"M10 0h2a1 1 0 011 1v20a1 1 0 01-1 1h-2a1 1 0 110-2h1v-3h-1a1 1 0 110-2h1v-3h-1a1 1 0 110-2h1V7h-1a1 1 0 010-2h1V2h-1a1 1 0 010-2z"})),Ks=({table:e,state:t,keptLayerIds:a,subVisualizationId:n})=>{const i=Boolean(t&&(t.minAccessor||t.maxAccessor||t.goalAccessor||t.metricAccessor)),s=t&&[t.minAccessor,t.maxAccessor,t.goalAccessor,t.metricAccessor].filter(Boolean).length;if(((e,t)=>e.length>1||e.length&&t.layerId!==e[0])(a,e)||(e=>{var t,a;return"number"!==(null===(t=e.columns)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.operation.dataType)||e.columns.some((e=>e.operation.isBucketed))})(e)||t&&!i&&e.columns.length>1||i&&(s!==e.columns.length||"initial"===e.changeType))return[];const l=(null==t?void 0:t.shape)===Ws.GaugeShapes.VERTICAL_BULLET?Ws.GaugeShapes.VERTICAL_BULLET:Ws.GaugeShapes.HORIZONTAL_BULLET,r={state:{...t,shape:l,layerId:e.layerId,layerType:z.LayerTypes.DATA,ticksPosition:Ws.GaugeTicksPositions.AUTO,labelMajorMode:Ws.GaugeLabelMajorModes.AUTO},title:u.i18n.translate("xpack.lens.gauge.gaugeLabel",{defaultMessage:"Gauge"}),previewIcon:l===Ws.GaugeShapes.VERTICAL_BULLET?Qs:Ys,score:.5,hide:!i||void 0===(null==t?void 0:t.metricAccessor),incomplete:void 0===(null==t?void 0:t.metricAccessor)};return i?[{...r,previewIcon:(null==t?void 0:t.shape)===Ws.GaugeShapes.VERTICAL_BULLET?Ys:Qs,state:{...r.state,...t,shape:(null==t?void 0:t.shape)===Ws.GaugeShapes.VERTICAL_BULLET?Ws.GaugeShapes.HORIZONTAL_BULLET:Ws.GaugeShapes.VERTICAL_BULLET}}]:[{...r,state:{...r.state,metricAccessor:e.columns[0].columnId}},{...r,previewIcon:(null==t?void 0:t.shape)===Ws.GaugeShapes.VERTICAL_BULLET?Ys:Qs,state:{...r.state,metricAccessor:e.columns[0].columnId,shape:(null==t?void 0:t.shape)===Ws.GaugeShapes.VERTICAL_BULLET?Ws.GaugeShapes.HORIZONTAL_BULLET:Ws.GaugeShapes.VERTICAL_BULLET}}]},Zs="metric",Js="goal";a(266);const el=Object(s.memo)((e=>{var t,a,n;const{state:i,setState:l,frame:r}=e,o=i.layerId&&(null===(t=r.activeData)||void 0===t||null===(a=t[i.layerId])||void 0===a||null===(n=a.columns.find((e=>e.id===i.metricAccessor)))||void 0===n?void 0:n.name),[c,d]=Object(s.useState)((()=>i.labelMinor?"custom":"none")),{inputValue:p,handleInputChange:m}=Object(Z.a)({onChange:l,value:i});return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(k.i,{handleClose:()=>{d(p.labelMinor?"custom":"none")},title:u.i18n.translate("xpack.lens.gauge.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton",panelClassName:"lnsGaugeToolbar__popover"},Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),fullWidth:!0},Object(x.jsx)(k.k,{header:u.i18n.translate("xpack.lens.label.gauge.labelMajor.header",{defaultMessage:"Title"}),dataTestSubj:"lnsToolbarGaugeLabelMajor",label:p.labelMajor||"",mode:p.labelMajorMode,placeholder:o||"",hasAutoOption:!0,handleChange:e=>{m({...p,labelMajor:e.label,labelMajorMode:e.mode})}})),Object(x.jsx)(b.EuiFormRow,{fullWidth:!0,display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"})},Object(x.jsx)(k.k,{header:u.i18n.translate("xpack.lens.label.gauge.labelMinor.header",{defaultMessage:"Subtitle"}),dataTestSubj:"lnsToolbarGaugeLabelMinor",label:p.labelMinor||"",mode:c,handleChange:e=>{m({...p,labelMinor:e.label}),d(e.mode)}}))))))}));var tl=a(92),al=a.n(tl);const nl={...k.n,rangeMin:0,rangeMax:100,name:"gray",steps:3,maxSteps:5},il=e=>{const{minAccessor:t,maxAccessor:a,goalAccessor:n,metricAccessor:i}=null!=e?e:{};if(i||a||n||i)return{min:t,max:a,goal:n,metric:i}};function sl(e){var t;const{state:a,setState:n,frame:i,accessor:r,isInlineEditing:o}=e,[c,d]=Object(s.useState)(!1);if((null==a?void 0:a.metricAccessor)!==r)return null;const p=null===(t=i.activeData)||void 0===t?void 0:t[a.layerId],[g]=(null==p?void 0:p.rows)||[];if(null==r||null==g||!Object(U.a)(p,r))return null;const f=il(a),v="palette"===(null==a?void 0:a.colorMode),h={min:Object(Xs.getMinValue)(g,f),max:Object(Xs.getMaxValue)(g,f)},y=(null==a?void 0:a.palette)||{type:"palette",name:nl.name,params:{...nl,continuity:"all",colorStops:void 0,stops:void 0,rangeMin:h.min,rangeMax:3*h.max/4}},j=Object(k.l)(e.paletteService,y,h),O=()=>d(!c);return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.gauge.dynamicColoring.label",{defaultMessage:"Band colors"}),className:"lnsDynamicColoringRow"},Object(x.jsx)(b.EuiSwitch,{"data-test-subj":"lnsDynamicColoringGaugeSwitch",compressed:!0,label:"",showLabel:!1,checked:v,onChange:e=>{const{checked:t}=e.target,i=t?{palette:{...y,params:{...y.params,stops:j}},ticksPosition:Ws.GaugeTicksPositions.BANDS,colorMode:Ws.GaugeColorModes.PALETTE}:{ticksPosition:Ws.GaugeTicksPositions.AUTO,colorMode:Ws.GaugeColorModes.NONE};n({...a,...i})}})),v&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{className:"lnsDynamicColoringRow",display:"columnCompressed",fullWidth:!0,label:u.i18n.translate("xpack.lens.paletteMetricGradient.label",{defaultMessage:"Color"})},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lnsGauge_dynamicColoring_palette",palette:j.map((({color:e})=>e)),type:m.h,onClick:O})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lnsGauge_dynamicColoring_trigger",iconType:"controlsHorizontal",onClick:O,size:"xs",flush:"both"},u.i18n.translate("xpack.lens.paletteTableGradient.customize",{defaultMessage:"Edit"})),Object(x.jsx)(k.f,{siblingRef:e.panelRef,isOpen:c,handleClose:O,title:u.i18n.translate("xpack.lens.table.colorByRangePanelTitle",{defaultMessage:"Color"}),isInlineEditing:o},Object(x.jsx)(H,{palettes:e.paletteService,activePalette:y,dataBounds:h,setPalette:e=>{e.name!==m.a&&e.params&&e.params.rangeMin!==h.min&&(e.params.rangeMin=h.min),n({...a,palette:e})}}))))),Object(x.jsx)(b.EuiFormRow,{display:"columnCompressedSwitch",fullWidth:!0,label:Object(x.jsx)(be.a,{position:"top",tooltipContent:u.i18n.translate("xpack.lens.shared.ticksPositionOptionsTooltip",{defaultMessage:"Places ticks on each band border instead of distributing them evenly"}),condition:!0,delay:"regular"},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),Object(x.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(x.jsx)(b.EuiSwitch,{compressed:!0,label:u.i18n.translate("xpack.lens.shared.ticksPositionOptions",{defaultMessage:"Ticks on bands"}),"data-test-subj":"lens-toolbar-gauge-ticks-position-switch",showLabel:!1,checked:a.ticksPosition===Ws.GaugeTicksPositions.BANDS,onChange:()=>{n({...a,ticksPosition:a.ticksPosition===Ws.GaugeTicksPositions.BANDS?Ws.GaugeTicksPositions.AUTO:Ws.GaugeTicksPositions.BANDS})}}))))}a(271);const ll=u.i18n.translate("xpack.lens.metric.groupLabel",{defaultMessage:"Goal and single value"}),rl=e=>!e.isBucketed&&"number"===e.dataType,ol=e=>rl(e)&&!e.isStaticValue,ul={horizontalBullet:{icon:Ys,label:u.i18n.translate("xpack.lens.gaugeHorizontal.gaugeLabel",{defaultMessage:"Gauge horizontal"}),groupLabel:ll},verticalBullet:{icon:Qs,label:u.i18n.translate("xpack.lens.gaugeVertical.gaugeLabel",{defaultMessage:"Gauge vertical"}),groupLabel:ll}},cl=(e,t,a,n,i={})=>{var s,l,r,o,u,c;const d=a[t.layerId],p=i[t.layerId];if(!(null==d?void 0:d.getTableSpec().map((({columnId:e})=>e)))||!t.metricAccessor)return null;const g=Object(V.buildExpressionFunction)("gauge",{metric:t.metricAccessor,min:t.minAccessor,max:t.maxAccessor,goal:t.goalAccessor,shape:null!==(s=t.shape)&&void 0!==s?s:Ws.GaugeShapes.HORIZONTAL_BULLET,colorMode:null!==(l=null==t?void 0:t.colorMode)&&void 0!==l?l:"none",palette:null!==(r=t.palette)&&void 0!==r&&r.params?e.get(m.a).toExpression((f=t.palette.params,{...f,colors:((null==f?void 0:f.stops)||[]).map((({color:e})=>e)),stops:"custom"===(null==f?void 0:f.name)?((null==f?void 0:f.stops)||[]).map((({stop:e})=>e)):[],reverse:!1})):void 0,ticksPosition:null!==(o=t.ticksPosition)&&void 0!==o?o:"auto",labelMinor:t.labelMinor,labelMajor:t.labelMajor,labelMajorMode:null!==(u=t.labelMajorMode)&&void 0!==u?u:"auto"});var f;return{type:"expression",chain:[...null!==(c=null==p?void 0:p.chain)&&void 0!==c?c:[],g.toAst()]}},dl=({paletteService:e,theme:t})=>({id:"lnsGauge",visualizationTypes:[{...ul.horizontalBullet,id:Ws.GaugeShapes.HORIZONTAL_BULLET,showExperimentalBadge:!0},{...ul.verticalBullet,id:Ws.GaugeShapes.VERTICAL_BULLET,showExperimentalBadge:!0}],getVisualizationTypeId:e=>e.shape,getLayerIds:e=>[e.layerId],clearLayer(e){const t={...e};return delete t.metricAccessor,delete t.minAccessor,delete t.maxAccessor,delete t.goalAccessor,delete t.palette,delete t.colorMode,t},getDescription:e=>e.shape===Ws.GaugeShapes.HORIZONTAL_BULLET?ul.horizontalBullet:ul.verticalBullet,switchVisualizationType:(e,t)=>({...t,shape:e===Ws.GaugeShapes.HORIZONTAL_BULLET?Ws.GaugeShapes.HORIZONTAL_BULLET:Ws.GaugeShapes.VERTICAL_BULLET}),initialize:(e,t,a)=>t||{layerId:e(),layerType:z.LayerTypes.DATA,shape:Ws.GaugeShapes.HORIZONTAL_BULLET,palette:"legacyPalette"===(null==a?void 0:a.type)?a.value:void 0,ticksPosition:"auto",labelMajorMode:"auto"},getSuggestions:Ks,getConfiguration({state:t,frame:a}){var n,i,s;const l=null!=t&&t.layerId?null==a||null===(n=a.activeData)||void 0===n||null===(i=n[null==t?void 0:t.layerId])||void 0===i||null===(s=i.rows)||void 0===s?void 0:s[0]:void 0,{palette:r,metricAccessor:o,accessors:c}=pl(t,e,a.activeData);return{groups:[{enableFormatSelector:!0,layerId:t.layerId,groupId:Zs,groupLabel:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),paramEditorCustomProps:{headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:o?[r?{columnId:o,triggerIconType:"colorBy",palette:r}:{columnId:o,triggerIconType:"none"}]:[],filterOperations:ol,supportsMoreColumns:!o,requiredMinDimensionCount:1,dataTestSubj:"lnsGauge_metricDimensionPanel",enableDimensionEditor:!0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:"min",groupLabel:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.minAccessor?[{columnId:t.minAccessor}]:[],filterOperations:rl,supportsMoreColumns:!t.minAccessor,dataTestSubj:"lnsGauge_minDimensionPanel",prioritizedOperation:"min",suggestedValue:()=>t.metricAccessor?Object(Xs.getMinValue)(l,c):void 0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:"max",groupLabel:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.maxAccessor?[{columnId:t.maxAccessor}]:[],filterOperations:rl,supportsMoreColumns:!t.maxAccessor,dataTestSubj:"lnsGauge_maxDimensionPanel",prioritizedOperation:"max",suggestedValue:()=>t.metricAccessor?Object(Xs.getMaxValue)(l,c):void 0},{supportStaticValue:!0,enableFormatSelector:!1,layerId:t.layerId,groupId:Js,groupLabel:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),paramEditorCustomProps:{labels:[u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"})],headingLabel:u.i18n.translate("xpack.lens.gauge.headingLabel",{defaultMessage:"Value"})},isMetricDimension:!0,accessors:t.goalAccessor?[{columnId:t.goalAccessor}]:[],filterOperations:rl,supportsMoreColumns:!t.goalAccessor,requiredMinDimensionCount:0,dataTestSubj:"lnsGauge_goalDimensionPanel"}]}},setDimension({prevState:e,layerId:t,columnId:a,groupId:n,previousColumn:i}){const s={};return"min"===n&&(s.minAccessor=a),"max"===n&&(s.maxAccessor=a),n===Js&&(s.goalAccessor=a),n===Zs&&(s.metricAccessor=a),{...e,...s}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.goalAccessor===a&&delete n.goalAccessor,e.minAccessor===a&&delete n.minAccessor,e.maxAccessor===a&&delete n.maxAccessor,e.metricAccessor===a&&(delete n.metricAccessor,delete n.palette,delete n.colorMode,n.ticksPosition="auto"),n},DimensionEditorComponent:t=>Object(x.jsx)(sl,i()({},t,{paletteService:e})),ToolbarComponent:e=>Object(x.jsx)(el,e),getSupportedLayers(e,t){var a,n,i;const s=null!=e&&e.layerId?null==t||null===(a=t.activeData)||void 0===a||null===(n=a[null==e?void 0:e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0]:void 0,l=il(e),r=Object(Xs.getMinValue)(s,l),o=Object(Xs.getMaxValue)(s,l),c=Object(Xs.getGoalValue)(s,l);return[{type:z.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.gauge.addLayer",{defaultMessage:"Visualization"}),initialDimensions:e?[{groupId:"min",columnId:Object(nt.a)(),staticValue:r},{groupId:"max",columnId:Object(nt.a)(),staticValue:o},{groupId:"goal",columnId:Object(nt.a)(),staticValue:c}]:void 0}]},getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return t.layerType},toExpression:(t,a,n,i={})=>cl(e,t,a,0,i),toPreviewExpression:(t,a,n={})=>cl(e,t,a,0,n),getUserMessages(e,{frame:t}){var a,n,i;const{maxAccessor:s,minAccessor:l,goalAccessor:r,metricAccessor:o}=e;if(!(s||l||r||o))return[];if(!o)return[];const d=null===(a=t.activeData)||void 0===a||null===(n=a[e.layerId])||void 0===n||null===(i=n.rows)||void 0===i?void 0:i[0];if(!d)return[];const p=((e,t)=>{if(!e||!t)return[];const a=[],n=null==t?void 0:t.minAccessor,i=null==t?void 0:t.maxAccessor,s=n?Object(Xs.getValueFromAccessor)(n,e):void 0,l=i?Object(Xs.getValueFromAccessor)(i,e):void 0;return null!=l&&null!=s&&void 0!==s&&(l<s&&a.push({severity:"error",displayLocations:[{id:"dimensionButton",dimensionId:n},{id:"dimensionButton",dimensionId:i}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderMinGreaterMax",{defaultMessage:"Minimum value may not be greater than maximum value"}),longMessage:""}),l===s&&a.push({severity:"error",displayLocations:[{id:"dimensionButton",dimensionId:n},{id:"dimensionButton",dimensionId:i}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.guageVisualization.chartCannotRenderEqual",{defaultMessage:"Minimum and maximum values may not be equal"}),longMessage:""})),a})(d,e);if(p.length)return p;const m=d[o],g=s&&d[s],f=l&&d[l],b=r&&d[r],v=[];return"number"==typeof f&&(f>m&&v.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minValueGreaterMetricShortMessage",defaultMessage:"Minimum value is greater than metric value."})}),f>b&&v.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.minimumValueGreaterGoalShortMessage",defaultMessage:"Minimum value is greater than goal value."})})),"number"==typeof g&&(m>g&&v.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.metricValueGreaterMaximumShortMessage",defaultMessage:"Metric value is greater than maximum value."})}),"number"==typeof b&&b>g&&v.push({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.gaugeVisualization.goalValueGreaterMaximumShortMessage",defaultMessage:"Goal value is greater than maximum value."})})),v},getSuggestionFromConvertToLensContext({suggestions:e,context:t}){const a=e;return{...a[0],datasourceState:{...a[0].datasourceState,layers:a.reduce(((e,t)=>{var a;return{...e,...null===(a=t.datasourceState)||void 0===a?void 0:a.layers}}),{})},visualizationState:{...a[0].visualizationState,...t.configuration}}},getVisualizationInfo(t,a){const{palette:n,accessors:i}=pl(t,e,null==a?void 0:a.activeData),s=[];return null!=i&&i.metric&&s.push({id:i.metric,name:u.i18n.translate("xpack.lens.gauge.metricLabel",{defaultMessage:"Metric"}),dimensionType:"metric"}),null!=i&&i.max&&s.push({id:i.max,name:u.i18n.translate("xpack.lens.gauge.maxValueLabel",{defaultMessage:"Maximum value"}),dimensionType:"max"}),null!=i&&i.min&&s.push({id:i.min,name:u.i18n.translate("xpack.lens.gauge.minValueLabel",{defaultMessage:"Minimum value"}),dimensionType:"min"}),null!=i&&i.goal&&s.push({id:i.goal,name:u.i18n.translate("xpack.lens.gauge.goalValueLabel",{defaultMessage:"Goal value"}),dimensionType:"goal"}),{layers:[{layerId:t.layerId,layerType:t.layerType,chartType:t.shape,...this.getDescription(t),dimensions:s,palette:n}]}}});function pl(e,t,a){var n,i,s,l;const r=Boolean("none"!==e.colorMode&&(null===(n=e.palette)||void 0===n||null===(i=n.params)||void 0===i?void 0:i.stops)),o=null===(s=function(e,t){if(t&&e)return t[e]||t.default}(null==e?void 0:e.layerId,a))||void 0===s||null===(l=s.rows)||void 0===l?void 0:l[0],{metricAccessor:u}=null!=e?e:{},c=il(e);let d;if(null!=o&&null!=u&&null!=(null==e?void 0:e.palette)&&r){const a={min:Object(Xs.getMinValue)(o,c),max:Object(Xs.getMaxValue)(o,c)};d=Object(k.l)(t,null==e?void 0:e.palette,a).map((({color:e})=>e))}return{metricAccessor:u,accessors:c,palette:d}}class gauge_GaugeVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getGaugeVisualization:t}=await Promise.resolve().then(a.bind(null,558));return t({paletteService:(e=>{const t=e=>(e?al()(e).hex()+"80":"000000").toUpperCase(),a=e=>({...e,getCategoricalColor:(a,n,i)=>t(e.getCategoricalColor(a,n,i)),getCategoricalColors:(a,n)=>e.getCategoricalColors(a,n).map(t)});return{...e,get:t=>a(e.get(t)),getAll:()=>e.getAll().map((e=>a(e)))}})(await n.palettes.getPalettes()),theme:e.theme})}))}}const ml=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",i()({xmlns:"http://www.w3.org/2000/svg",width:"30",height:"22",viewBox:"0 0 30 22"},a),e?Object(x.jsx)("title",{id:t}):null,Object(x.jsx)("path",{d:"M19 5a2 2 0 0 1 2-2h4a2 2 0 1 1 0 4h-4a2 2 0 0 1-2-2ZM2 11a2 2 0 0 1 2-2h8a2 2 0 1 1 0 4H4a2 2 0 0 1-2-2Zm15 4a2 2 0 1 0 0 4h6a2 2 0 1 0 0-4h-6Z",className:h.a.accent}),Object(x.jsx)("path",{d:"M6 4a1 1 0 0 0 0 2h4a1 1 0 1 0 0-2H6Zm8 0a1 1 0 1 0 0 2h2a1 1 0 1 0 0-2h-2Zm2 7a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H17a1 1 0 0 1-1-1Zm-8 5a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2H8Z",className:h.a.subdued}));var gl=a(57);const fl=u.i18n.translate("xpack.lens.tagcloud.label",{defaultMessage:"Tag cloud"}),bl={maxFontSize:72,minFontSize:18,orientation:gl.Orientation.SINGLE,showLabel:!0};function vl({table:e,state:t,keptLayerIds:a,mainPalette:n,subVisualizationId:i}){if(t&&"unchanged"===e.changeType||a.length>1||a.length&&e.layerId!==a[0])return[];const[s,l]=Object(qt.partition)(e.columns,(e=>e.operation.isBucketed));return 1!==s.length||1!==l.length?[]:s.filter((e=>"date"!==e.operation.dataType)).map((t=>({previewIcon:ml,title:fl,score:"string"===t.operation.dataType?.4:.2,state:{layerId:e.layerId,tagAccessor:t.columnId,valueAccessor:l[0].columnId,...bl,colorMapping:n?"colorMapping"===(null==n?void 0:n.type)?n.value:void 0:Object(st.getColorMappingDefaults)()}})))}var hl=a(107),xl=a.n(hl);function yl(e){const[t,a]=Object(s.useState)([e.minFontSize,e.maxFontSize]),[,n]=xl()((()=>{e.onChange(t[0],t[1])}),150,[t]);return Object(s.useEffect)((()=>()=>{n()}),[n]),Object(x.jsx)(b.EuiDualRange,{id:"tagCloudFontSizeSlider",min:1,max:120,step:1,value:t,onChange:e=>{a(e)},showLabels:!0,compressed:!0,"aria-label":u.i18n.translate("xpack.lens.label.tagcloud.fontSizeLabel",{defaultMessage:"Font size"})})}const jl=[{value:gl.Orientation.SINGLE,text:u.i18n.translate("xpack.lens.label.tagcloud.orientation.single",{defaultMessage:"Single"})},{value:gl.Orientation.RIGHT_ANGLED,text:u.i18n.translate("xpack.lens.label.tagcloud.orientation.rightAngled",{defaultMessage:"Right angled"})},{value:gl.Orientation.MULTIPLE,text:u.i18n.translate("xpack.lens.label.tagcloud.orientation.multiple",{defaultMessage:"Multiple"})}];function Ol(e){return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"none",responsive:!1},Object(x.jsx)(k.i,{title:u.i18n.translate("xpack.lens.tagcloud.appearanceLabel",{defaultMessage:"Appearance"}),type:"visualOptions",buttonDataTestSubj:"lnsVisualOptionsButton"},Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.tagcloud.fontSizeLabel",{defaultMessage:"Font size"})},Object(x.jsx)(yl,{minFontSize:e.state.minFontSize,maxFontSize:e.state.maxFontSize,onChange:(t,a)=>{e.setState({...e.state,minFontSize:t,maxFontSize:a})}})),Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.tagcloud.orientationLabel",{defaultMessage:"Orientation"})},Object(x.jsx)(b.EuiSelect,{options:jl,value:e.state.orientation,onChange:t=>{e.setState({...e.state,orientation:t.target.value})},compressed:!0})),Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.label.tagcloud.showLabel",{defaultMessage:"Show label"})},Object(x.jsx)(b.EuiSwitch,{label:u.i18n.translate("xpack.lens.label.tagcloud.showLabel",{defaultMessage:"Show label"}),showLabel:!1,checked:e.state.showLabel,onChange:t=>{e.setState({...e.state,showLabel:t.target.checked})},compressed:!0}))))))}function Il({state:e,frame:t,setState:a,panelRef:n,isDarkMode:i,paletteService:l,isInlineEditing:r}){var o,c,d;const{inputValue:m,handleInputChange:g}=Object(Z.a)({value:e,onChange:a}),[f,v]=Object(s.useState)(!1),[h,y]=Object(s.useState)(!!e.colorMapping),j=Object(xt.c)(i,e.colorMapping),O=null===(o=t.activeData)||void 0===o?void 0:o[e.layerId],I=da(null!==(c=null==O?void 0:O.rows)&&void 0!==c?c:[],e.tagAccessor),T=Object(s.useCallback)((e=>{g({...m,colorMapping:e})}),[m,g]),M=Object(s.useCallback)((e=>{g({...m,palette:e,colorMapping:void 0})}),[m,g]),w=e.colorMapping;return Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",label:u.i18n.translate("xpack.lens.colorMapping.editColorMappingSectionlabel",{defaultMessage:"Color mapping"}),style:{alignItems:"center"}},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1,className:"lnsDynamicColoringClickable"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiColorPaletteDisplay,{"data-test-subj":"lns_dynamicColoring_edit",palette:j,type:"fixed",onClick:()=>{v(!f)}})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonIcon,{"data-test-subj":"lns_colorEditing_trigger","aria-label":u.i18n.translate("xpack.lens.colorMapping.editColorMappingButton",{defaultMessage:"Edit palette"}),iconType:"controlsHorizontal",onClick:()=>{v(!f)},size:"xs"}),Object(x.jsx)(k.f,{siblingRef:n,isOpen:f,handleClose:()=>v(!f),title:h?u.i18n.translate("xpack.lens.colorMapping.editColorMappingTitle",{defaultMessage:"Edit colors by term mapping"}):u.i18n.translate("xpack.lens.colorMapping.editColorsTitle",{defaultMessage:"Edit colors"}),isInlineEditing:r},Object(x.jsx)("div",{className:"lnsPalettePanel__section lnsPalettePanel__section--shaded lnsIndexPatternDimensionEditor--padded"},Object(x.jsx)(b.EuiFlexGroup,{direction:"column",gutterSize:"s",justifyContent:"flexStart"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.colorMapping.tryLabel",{defaultMessage:"Use the new Color Mapping feature"})," ",Object(x.jsx)(b.EuiBadge,{color:"hollow"},u.i18n.translate("xpack.lens.colorMapping.techPreviewLabel",{defaultMessage:"Tech preview"})))),"data-test-subj":"lns_colorMappingOrLegacyPalette_switch",compressed:!0,checked:h,onChange:({target:{checked:e}})=>{Object(p.d)("color_mapping_switch_"+(e?"enabled":"disabled")),T(e?{...xt.a}:void 0),y(e)}})),Object(x.jsx)(b.EuiFlexItem,null,w||h?Object(x.jsx)(categorical_color_mapping_CategoricalColorMapping,{isDarkMode:i,model:null!==(d=e.colorMapping)&&void 0!==d?d:{...xt.a},onModelUpdate:e=>T(e),palettes:ra.a,data:{type:"categories",categories:I},specialTokens:oa.a}):Object(x.jsx)(k.g,{palettes:l,activePalette:e.palette,setPalette:e=>{M(e)}}))))))))}const kl="tags",Tl="metric",Ml=({paletteService:e,kibanaTheme:t})=>({id:"lnsTagcloud",visualizationTypes:[{id:"lnsTagcloud",icon:ml,label:fl,groupLabel:u.i18n.translate("xpack.lens.pie.groupLabel",{defaultMessage:"Proportion"})}],getVisualizationTypeId:()=>"lnsTagcloud",clearLayer(e){const t={...e,...bl};return delete t.tagAccessor,delete t.valueAccessor,delete t.palette,t},getLayerIds:e=>[e.layerId],getDescription:()=>({icon:ml,label:fl}),getSuggestions:vl,getSuggestionFromConvertToLensContext:({suggestions:e,context:t})=>e.length?{...e[0],visualizationState:{...e[0].visualizationState,...t.configuration}}:void 0,getMainPalette:e=>{if(e)return e.colorMapping?{type:"colorMapping",value:e.colorMapping}:e.palette?{type:"legacyPalette",value:e.palette}:void 0},triggers:[N.VIS_EVENT_TO_TRIGGER.filter],initialize:(e,t,a)=>t||{layerId:e(),layerType:z.LayerTypes.DATA,...bl,colorMapping:"colorMapping"===(null==a?void 0:a.type)?a.value:Object(st.getColorMappingDefaults)()},getConfiguration({state:a}){const n=!!a.colorMapping;let i=[];var s,l;return n?t.theme$.subscribe({next(e){i=Object(xt.c)(e.darkMode,a.colorMapping)}}).unsubscribe():i=e.get((null===(s=a.palette)||void 0===s?void 0:s.name)||"default").getCategoricalColors(10,null===(l=a.palette)||void 0===l?void 0:l.params),{groups:[{groupId:kl,groupLabel:u.i18n.translate("xpack.lens.tagcloud.tagLabel",{defaultMessage:"Tags"}),layerId:a.layerId,accessors:a.tagAccessor?[{columnId:a.tagAccessor,triggerIconType:"colorBy",palette:i}]:[],supportsMoreColumns:!a.tagAccessor,filterOperations:e=>e.isBucketed,enableDimensionEditor:!0,required:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsTagcloud_tagDimensionPanel"},{groupId:Tl,groupLabel:u.i18n.translate("xpack.lens.tagcloud.metricValueLabel",{defaultMessage:"Metric"}),isMetricDimension:!0,layerId:a.layerId,accessors:a.valueAccessor?[{columnId:a.valueAccessor}]:[],supportsMoreColumns:!a.valueAccessor,filterOperations:e=>!e.isBucketed&&"number"===e.dataType,enableDimensionEditor:!0,required:!0,requiredMinDimensionCount:1,dataTestSubj:"lnsTagcloud_valueDimensionPanel"}]}},getSupportedLayers:()=>[{type:z.LayerTypes.DATA,label:u.i18n.translate("xpack.lens.tagcloud.addLayer",{defaultMessage:"Add visualization layer"})}],getLayerType(e,t){if((null==t?void 0:t.layerId)===e)return z.LayerTypes.DATA},toExpression:(t,a,n,i={})=>{if(!t.tagAccessor||!t.valueAccessor)return null;const s=i[t.layerId];return{type:"expression",chain:[...s?s.chain:[],Object(V.buildExpressionFunction)("tagcloud",{bucket:t.tagAccessor,metric:t.valueAccessor,maxFontSize:t.maxFontSize,minFontSize:t.minFontSize,orientation:t.orientation,palette:Object(V.buildExpression)([t.palette?Object(V.buildExpressionFunction)("theme",{variable:"palette",default:[e.get(t.palette.name).toExpression(t.palette.params)]}):Object(V.buildExpressionFunction)("system_palette",{name:"default"})]).toAst(),showLabel:t.showLabel,colorMapping:t.colorMapping?JSON.stringify(t.colorMapping):void 0}).toAst()]}},toPreviewExpression:(t,a,n={})=>{if(!t.tagAccessor||!t.valueAccessor)return null;const i=n[t.layerId];return{type:"expression",chain:[...i?i.chain:[],Object(V.buildExpressionFunction)("tagcloud",{bucket:t.tagAccessor,isPreview:!0,metric:t.valueAccessor,maxFontSize:18,minFontSize:4,orientation:t.orientation,palette:Object(V.buildExpression)([t.palette?Object(V.buildExpressionFunction)("theme",{variable:"palette",default:[e.get(t.palette.name).toExpression(t.palette.params)]}):Object(V.buildExpressionFunction)("system_palette",{name:"default"})]).toAst(),showLabel:!1,colorMapping:t.colorMapping?JSON.stringify(t.colorMapping):void 0}).toAst()]}},setDimension({columnId:e,groupId:t,prevState:a}){const n={};return t===kl?n.tagAccessor=e:t===Tl&&(n.valueAccessor=e),{...a,...n}},removeDimension({prevState:e,layerId:t,columnId:a}){const n={...e};return e.tagAccessor===a?delete n.tagAccessor:e.valueAccessor===a&&delete n.valueAccessor,n},DimensionEditorComponent(a){const n=w()(t.theme$,{darkMode:!1}).darkMode;return a.groupId===kl?Object(x.jsx)(Il,{isDarkMode:n,paletteService:e,state:a.state,setState:a.setState,frame:a.frame,panelRef:a.panelRef,isInlineEditing:a.isInlineEditing}):null},ToolbarComponent:e=>Object(x.jsx)(Ol,e)});class TagcloudVisualization{setup(e,{editorFrame:t,charts:n}){t.registerVisualization((async()=>{const{getTagcloudVisualization:t}=await Promise.resolve().then(a.bind(null,558));return t({paletteService:await n.palettes.getPalettes(),kibanaTheme:e.theme})}))}}var wl=a(87),Cl=a(75),El=a(23),Sl=a(65),Fl=a(183),Pl=a(138),_l=a(40),Al=a(130);const Ll=({core:e,dataViews:t,updateIndexPatterns:a,replaceIndexPattern:n,uiActions:i,contextDataViewSpec:s})=>{const l=t=>e.notifications.toasts.addError(t,{title:u.i18n.translate("xpack.lens.indexPattern.dataViewLoadError",{defaultMessage:"Error loading data view"})});return{updateDataViewsState:a,loadIndexPatterns:e=>Object(Al.d)({dataViews:t,...e}),replaceDataViewId:async e=>{const a=await t.create({...e.toSpec(),id:Object(nt.a)()});s&&s.id!==e.id&&t.clearInstanceCache(e.id);const l=await Object(Al.d)({dataViews:t,patterns:[a.id],cache:{}});n(l[a.id],e.id,{applyImmediately:!0});const r=i.getTrigger(_l.UPDATE_FILTER_REFERENCES_TRIGGER),o=i.getAction(_l.UPDATE_FILTER_REFERENCES_ACTION);null==o||o.execute({trigger:r,fromDataView:e.id,toDataView:a.id,usedDataViews:[]})},ensureIndexPattern:e=>Object(Al.b)({onError:l,dataViews:t,...e}),getDefaultIndex:()=>e.uiSettings.get("defaultIndex")}};var Dl=a(79);function Rl({attributes:e,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:l,framePublicAPI:r,hasPadding:o,setIsInlineFlyoutVisible:u,getUserMessages:c}){var d;const p=Object(Cl.V)(),{euiTheme:m}=Object(b.useEuiTheme)(),{visualization:g}=Object(Cl.W)((e=>e.lens)),f=n[null!==(d=g.activeId)&&void 0!==d?d:e.visualizationType],v=Object(s.useMemo)((()=>Ll({dataViews:a.dataViews,uiActions:a.uiActions,core:t,updateIndexPatterns:(e,t)=>{p(Object(Cl.T)(e))},replaceIndexPattern:(e,t,a)=>{p(Object(Dl.i)({newIndexPattern:e,oldId:t}))}})),[t,p,a.dataViews,a.uiActions]),h={framePublicAPI:r,datasourceMap:i,visualizationMap:n,core:t,dataViews:a.dataViews,uiActions:a.uiActions,hideLayerHeader:"textBased"===l,indexPatternService:v,setIsInlineFlyoutVisible:u,getUserMessages:c};return Object(x.jsx)("div",{css:Object(x.css)("padding:",o?m.size.s:0,";","")},Object(x.jsx)(Fl.a,{activeVisualization:f,framePublicAPI:r}),Object(x.jsx)(b.EuiSpacer,{size:"m"}),Object(x.jsx)(Pl.a,h))}const Bl=({children:e,isInlineFlyoutVisible:t,isScrollable:a,displayFlyoutHeader:n,language:i,attributesChanged:s,onCancel:r,navigateToLensEditor:o,onApply:d})=>Object(x.jsx)(l.a.Fragment,null,t&&n&&Object(x.jsx)(b.EuiFlyoutHeader,{hasBorder:!0,css:Object(x.css)("pointer-events:auto;background-color:",re.euiThemeVars.euiColorEmptyShade,";",""),"data-test-subj":"editFlyoutHeader"},Object(x.jsx)(b.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiTitle,{size:"xs"},Object(x.jsx)("h2",null,u.i18n.translate("xpack.lens.config.editVisualizationLabel",{defaultMessage:"Edit {lang} visualization",values:{lang:i}}),Object(x.jsx)(b.EuiToolTip,{content:i?u.i18n.translate("xpack.lens.config.experimentalLabelTextBased",{defaultMessage:"Technical preview, {lang} currently offers limited configuration options",values:{lang:i}}):u.i18n.translate("xpack.lens.config.experimentalLabelDataview",{defaultMessage:"Technical preview, inline editing currently offers limited configuration options"})},Object(x.jsx)(b.EuiBetaBadge,{label:"Lab",iconType:"beaker",size:"s",css:Object(x.css)("margin-left:",re.euiThemeVars.euiSizeXS,";","")}))))),o&&Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiLink,{onClick:o,"data-test-subj":"navigateToLensEditorLink"},u.i18n.translate("xpack.lens.config.editLinkLabel",{defaultMessage:"Edit in Lens"}))))),Object(x.jsx)(b.EuiFlyoutBody,{className:"lnsEditFlyoutBody",css:Object(x.css)("overflow-y:auto;padding-left:",re.euiThemeVars.euiFormMaxWidth,";margin-left:-",re.euiThemeVars.euiFormMaxWidth,";pointer-events:none;.euiFlyoutBody__overflow{-webkit-mask-image:none;padding-left:inherit;margin-left:inherit;",!a&&"\n                overflow-y: hidden;\n              ",">*{pointer-events:auto;}}.euiFlyoutBody__overflowContent{padding:0;block-size:100%;}","")},e),t&&Object(x.jsx)(b.EuiFlyoutFooter,null,Object(x.jsx)(b.EuiFlexGroup,{justifyContent:"spaceBetween"},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{onClick:r,flush:"left","aria-label":u.i18n.translate("xpack.lens.config.cancelFlyoutAriaLabel",{defaultMessage:"Cancel applied changes"}),"data-test-subj":"cancelFlyoutButton"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.config.cancelFlyoutLabel",defaultMessage:"Cancel"}))),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiButton,{onClick:d,fill:!0,"aria-label":u.i18n.translate("xpack.lens.config.applyFlyoutAriaLabel",{defaultMessage:"Apply changes"}),disabled:!s,iconType:"check","data-test-subj":"applyFlyoutButton"},Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.config.applyFlyoutLabel",defaultMessage:"Apply and close"}))))));var Nl=a(47),zl=a(15);function Vl(e,t,a,n,i,s){const l=a.query.timefilter.timefilter.getTime();return Object(ca.textBasedQueryStateToAstWithValidation)({filters:i,query:e,time:l,dataView:t,inputQuery:s}).then((e=>{if(e){const t=n.run(e,null);let a,i;return t.pipe(Object(Nl.pluck)("result")).subscribe((e=>{const t=e;"error"===t.type?i=t.error.message:a=t})),Object(zl.lastValueFrom)(t).then((()=>{if(i)throw new Error(i);return a}))}})).catch((e=>{throw new Error(e.message)}))}var Gl=a(94);const ql=({context:e,dataView:t,datasourceMap:a,visualizationMap:n,excludedVisualizations:i})=>{if(!a||!n||!t.id)return;const s={formBased:{isLoading:!1,state:{layers:{}}},textBased:{isLoading:!1,state:{layers:{},fieldList:[],indexPatternRefs:[],initialContext:e}}},l={indexPatterns:{[t.id]:t},indexPatternRefs:[]},r=(null==n?void 0:n[Object.keys(n)[0]])||null,o=Object(Gl.a)({datasourceMap:a,datasourceStates:s,visualizationMap:n,activeVisualization:r,visualizationState:void 0,visualizeTriggerFieldContext:e,dataViews:l});if(!o.length)return[];const u=o[0];return u.incomplete||null!=i&&i.includes(u.visualizationId)?[]:[u,...Object(Gl.a)({datasourceMap:a,datasourceStates:{textBased:{isLoading:!1,state:u.datasourceState}},visualizationMap:n,activeVisualization:n[u.visualizationId],visualizationState:u.visualizationState,dataViews:l}).filter((e=>!e.hide&&"lnsLegacyMetric"!==e.visualizationId))].sort(((e,t)=>"lnsXY"===e.visualizationId?-1:1))},Hl=async(e,t,a,n,i,s)=>{try{var l,r;let s="";"sql"in e&&(s=Object(El.getIndexPatternFromSQLQuery)(e.sql)),"esql"in e&&(s=Object(El.getIndexPatternFromESQLQuery)(e.esql));const o=i.find((e=>e.name===s)),u=await t.dataViews.create(null!=o?o:{title:s});"date"!==(null===(l=u.fields.getByName("@timestamp"))||void 0===l?void 0:l.type)||o||(u.timeFieldName="@timestamp");const c=await(async(e,t,a)=>{const n={...e};"esql"in n&&n.esql&&(n.esql=`${n.esql} | limit 0`);const i=await Vl(n,t,a.data,a.expressions);return null==i?void 0:i.columns})(e,u,t),d={dataViewSpec:null==u?void 0:u.toSpec(),fieldName:"",textBasedColumns:c,query:e},p=null!==(r=ql({context:d,dataView:u,datasourceMap:a,visualizationMap:n}))&&void 0!==r?r:[];if(!p.length)return;const m=p[0];return Ul({filters:[],query:e,suggestion:m,dataView:u})}catch(e){s([e])}},Ul=({filters:e,query:t,suggestion:a,dataView:n})=>{var i;const s=Object.assign({},null==a?void 0:a.datasourceState),l=Object.assign({},null==a?void 0:a.visualizationState),r=a&&a.datasourceState?{[a.datasourceId]:{...s}}:{formBased:{}},o=l;return{title:a?a.title:u.i18n.translate("xpack.lens.config.suggestion.title",{defaultMessage:"New suggestion"}),references:[{id:null!==(i=null==n?void 0:n.id)&&void 0!==i?i:"",name:"textBasedLanguages-datasource-layer-suggestion",type:"index-pattern"}],state:{datasourceStates:r,filters:e,query:t,visualization:o,...n&&n.id&&!n.isPersisted()&&{adHocDataViews:{[n.id]:n.toSpec(!1)}}},visualizationType:a?a.visualizationId:"lnsXY"}};var $l=a(159),Wl=a(104),Xl={name:"eeu0j5",styles:"padding:2px"};function Yl({attributes:e,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:r,updatePanelState:o,updateSuggestion:c,setCurrentAttributes:d,closeFlyout:p,saveByRef:m,savedObjectId:g,updateByRefInput:f,output$:v,lensAdapters:h,navigateToLensEditor:y,displayFlyoutHeader:j,canEditTextBasedQuery:O}){var I,k,T,M;const w=Object(b.useEuiTheme)(),C=Object(s.useRef)(e),E=Object(s.useRef)(h),S=Object(s.useRef)(e.state.query),[F,P]=Object(s.useState)(e.state.query),[_,A]=Object(s.useState)(),[L,D]=Object(s.useState)(!0),[R,B]=Object(s.useState)(!0),[N,z]=Object(s.useState)(!1),V=e.state.datasourceStates[r],G=i[r],{datasourceStates:q,visualization:H,isLoading:U,annotationGroups:$}=Object(Cl.W)((e=>e.lens)),W=n[null!==(I=H.activeId)&&void 0!==I?I:e.visualizationType],X=Object(Cl.W)((e=>Object(Cl.B)(e,i))),Y=null==G||null===(k=G.suggestsLimitedColumns)||void 0===k?void 0:k.call(G,V),Q=Object(s.useMemo)((()=>G.getLayers(V)),[G,V]),K=Object(Cl.V)();Object(s.useEffect)((()=>{const e=null==v?void 0:v.subscribe((()=>{var e,t;const a={},n=null===(e=E.current)||void 0===e||null===(t=e.tables)||void 0===t?void 0:t.tables,[i]=Object.values(n||{});i&&(Q.forEach((e=>{a[e]=i})),K(Object(Cl.m)({activeData:a})))}));return()=>null==e?void 0:e.unsubscribe()}),[K,v,Q]);const Z=Object(s.useMemo)((()=>{var t;const a=C.current,s=!(!q[r].state||!a.state.datasourceStates[r])&&i[r].isEqual(a.state.datasourceStates[r],a.references,q[r].state,e.references),l=H.state,o=null===(t=n[a.visualizationType])||void 0===t?void 0:t.isEqual;return!(o?(()=>{try{return o(a.state.visualization,a.references,l,e.references,$)}catch(e){return!1}})():Object(qt.isEqual)(l,a.state.visualization))||!s}),[e.references,r,i,q,n,$,H.state]),J=Object(s.useCallback)((()=>{const e=C.current;if(Z){if(e.visualizationType===H.activeId){var t,a;const n=i[r].injectReferencesToLayers?null===(t=i[r])||void 0===t||null===(a=t.injectReferencesToLayers)||void 0===a?void 0:a.call(t,e.state.datasourceStates[r],e.references):e.state.datasourceStates[r];null==o||o(n,e.state.visualization)}else null==c||c(e);g&&(null==f||f(g))}null==p||p()}),[C,Z,p,i,r,o,c,g,f,H]),ee=Object(s.useCallback)((()=>{if(g){const t=Object.fromEntries(Object.entries(q).map((([e,t])=>[e,t.state]))),a=Object(st.extractReferencesFromState)({activeDatasources:Object.keys(q).reduce(((e,t)=>({...e,[t]:i[t]})),{}),datasourceStates:q,visualizationState:H.state,activeVisualization:W}),n={...e,state:{...e.state,visualization:H.state,datasourceStates:t},references:a};null==m||m(n),null==f||f(g)}null==p||p()}),[g,p,q,H.state,W,e,m,f,i]),{getUserMessages:te}=Object(Wl.c)({coreStart:t,framePublicAPI:X,activeDatasourceId:r,datasourceState:q[r],datasource:i[r],dispatch:K,visualization:W,visualizationType:H.activeId,visualizationState:H}),ae=Object.values(null!==(T=e.state.adHocDataViews)&&void 0!==T?T:{}),ne=Object(s.useCallback)((async e=>{const t=await Hl(e,a,i,n,ae,A);t&&(null==d||d(t),A([]),null==c||c(t))}),[a,i,n,ae,d,c]),ie=Object(El.isOfAggregateQueryType)(F)?Object(El.getAggregateQueryMode)(F):void 0;return U?null:O?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Bl,{isInlineFlyoutVisible:L,displayFlyoutHeader:j,onCancel:J,navigateToLensEditor:y,onApply:ee,attributesChanged:Z,language:Object(El.getLanguageDisplayName)(ie),isScrollable:!1},Object(x.jsx)(b.EuiFlexGroup,{css:Object(x.css)("block-size:100%;.euiFlexItem,.euiAccordion,.euiAccordion__triggerWrapper,.euiAccordion__childWrapper{min-block-size:0;}.euiAccordion{display:flex;flex:1;flex-direction:column;}.euiAccordion__childWrapper{overflow-y:auto!important;",Object(b.euiScrollBarStyles)(w)," padding-left:",re.euiThemeVars.euiFormMaxWidth,";margin-left:-",re.euiThemeVars.euiFormMaxWidth,";.euiAccordion-isOpen &{block-size:auto!important;flex:1;}}",""),direction:"column",gutterSize:"none"},Object(El.isOfAggregateQueryType)(F)&&Object(x.jsx)(b.EuiFlexItem,{grow:!1,"data-test-subj":"InlineEditingESQLEditor"},Object(x.jsx)(Sl.TextBasedLangEditor,{query:F,onTextLangQueryChange:e=>{P(e),S.current=e},expandCodeEditor:e=>{},isCodeEditorExpanded:!0,detectTimestamp:Boolean(null==ae||null===(M=ae[0])||void 0===M?void 0:M.timeFieldName),errors:_,warning:Y?u.i18n.translate("xpack.lens.config.configFlyoutCallout",{defaultMessage:"Displaying a limited portion of the available fields. Add more from the configuration panel."}):void 0,hideMinimizeButton:!0,editorIsInline:!0,hideRunQueryText:!0,disableSubmitAction:Object(qt.isEqual)(F,S.current),onTextLangQuerySubmit:e=>{e&&ne(e)},isDisabled:!1})),Object(x.jsx)(b.EuiFlexItem,{grow:!!R&&1,css:Object(x.css)("padding-left:",re.euiThemeVars.euiSize,";padding-right:",re.euiThemeVars.euiSize,";.euiAccordion__childWrapper{flex:",R?1:"none",";}","")},Object(x.jsx)(b.EuiAccordion,{id:"layer-configuration",buttonContent:Object(x.jsx)(b.EuiTitle,{size:"xxs",css:Xl},Object(x.jsx)("h5",null,u.i18n.translate("xpack.lens.config.layerConfigurationLabel",{defaultMessage:"Layer configuration"}))),buttonProps:{paddingSize:"m"},initialIsOpen:R,forceState:R?"open":"closed",onToggle:e=>{e&&N&&z(!e),B(!R)}},Object(x.jsx)(Rl,{attributes:e,getUserMessages:te,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:r,framePublicAPI:X,setIsInlineFlyoutVisible:D}))),Object(x.jsx)(b.EuiFlexItem,{grow:!!N&&1,"data-test-subj":"InlineEditingSuggestions",css:Object(x.css)("border-top:",re.euiThemeVars.euiBorderThin,";border-bottom:",re.euiThemeVars.euiBorderThin,";padding-left:",re.euiThemeVars.euiSize,";padding-right:",re.euiThemeVars.euiSize,";.euiAccordion__childWrapper{flex:",N?1:"none",";}","")},Object(x.jsx)($l.a,{ExpressionRenderer:a.expressions.ReactExpressionRenderer,datasourceMap:i,visualizationMap:n,frame:X,core:t,nowProvider:a.data.nowProvider,showOnlyIcons:!0,wrapSuggestions:!0,isAccordionOpen:N,toggleAccordionCb:e=>{!e&&R&&B(e),z(!N)}}))))):Object(x.jsx)(Bl,{isInlineFlyoutVisible:L,displayFlyoutHeader:j,onCancel:J,navigateToLensEditor:y,onApply:ee,isScrollable:!0,attributesChanged:Z},Object(x.jsx)(Rl,{getUserMessages:te,attributes:e,coreStart:t,startDependencies:a,visualizationMap:n,datasourceMap:i,datasourceId:r,hasPadding:!0,framePublicAPI:X,setIsInlineFlyoutVisible:D}))}var Ql=a(112);function Kl(){return Object(x.jsx)(b.EuiOverlayMask,null,Object(x.jsx)(b.EuiLoadingSpinner,null))}const Zl=e=>t=>a=>n=>{const{datasourceStates:i,visualization:s,activeDatasourceId:l}=t.getState().lens;a(n);const{datasourceStates:r,visualization:o,activeDatasourceId:u}=t.getState().lens;if(l!==u||!Object(qt.isEqual)(i[l].state,r[u].state)||!Object(qt.isEqual)(s,o)){if(Cl.h.match(n)||Cl.g.match(n))return;e(r[u].state,o.state,o.activeId)}};var Jl={name:"1hi3csz",styles:"clip-path:polygon(-100% 0, 100% 0, 100% 100%, -100% 100%)"};async function er(e,t,n,i){const{getLensServices:l,getLensAttributeService:r}=await Promise.resolve().then(a.bind(null,558)),o=await l(e,t,r(e,t));return({attributes:a,updatePanelState:l,updateSuggestion:r,closeFlyout:c,wrapInFlyout:p,datasourceId:m,panelId:g,savedObjectId:f,output$:v,lensAdapters:h,updateByRefInput:y,navigateToLensEditor:j,displayFlyoutHeader:O,canEditTextBasedQuery:I})=>{if(!o||!i||!n)return Object(x.jsx)(Kl,null);const[k,T]=Object(s.useState)(a),M=Object(s.useCallback)((async e=>{const t=new Ql.a(o.contentManagement);await t.save({...e,savedObjectId:f,type:It.DOC_TYPE})}),[f]),w=k.state.datasourceStates[m],C={lensServices:o,datasourceMap:i,visualizationMap:n,initialContext:w&&"initialContext"in w?w.initialContext:void 0},E=Object(Cl.k)(C,void 0,Zl(l));E.dispatch(Object(Cl.j)({initialInput:{attributes:k,id:null!=g?g:Object(nt.a)()},inlineEditing:!0}));const S={attributes:k,updatePanelState:l,updateSuggestion:r,closeFlyout:c,datasourceId:m,coreStart:e,startDependencies:t,visualizationMap:n,output$:v,lensAdapters:h,datasourceMap:i,saveByRef:M,savedObjectId:f,updateByRefInput:y,navigateToLensEditor:j,displayFlyoutHeader:O,canEditTextBasedQuery:I,setCurrentAttributes:T};return F=Object(x.jsx)(aa.Provider,{store:E},Object(x.jsx)(d.KibanaContextProvider,{services:o},Object(x.jsx)(wl.d,null,Object(x.jsx)(Yl,S)))),p?Object(x.jsx)(b.EuiFlyout,{type:"push",ownFocus:!0,paddingSize:"m",onClose:()=>{null==c||c()},"aria-labelledby":u.i18n.translate("xpack.lens.config.editLabel",{defaultMessage:"Edit configuration"}),size:"s",hideCloseButton:!0,css:Jl},F):F;var F}}var tr=a(86),ar=a.n(tr),nr=a(163);const ir=/[^0-9A-Za-z._@\[\]/]/;function sr(e){const{namedArgument:t,variable:a,function:n}=Object(qt.groupBy)(e,(e=>Object(qt.isObject)(e)?e.type:"variable"));return{namedArguments:t||[],variables:a||[],functions:n||[]}}function lr(e){return Object(qt.isObject)(e)?"function"!==e.type?e.value:e.name:e}function rr(e,t,a,n){if(a&&e.filterable){const e="kql"in t?"kql":"lucene";t[e]?a.query&&(t[e]=`(${a.query}) AND (${t[e]})`):t["kuery"===a.language?"kql":a.language]=a.query}return n&&e.canReduceTimeRange&&!t.reducedTimeRange&&(t.reducedTimeRange=n),t}function or(e,t=[]){const a=(e.operationParams||[]).reduce(((e,{name:t,type:a})=>(e[t]=a,e)),{});return t.reduce(((t,{name:n,value:i})=>(a[n]&&(t[n]=i),!e.filterable||"kql"!==n&&"lucene"!==n||(t[n]=i),e.shiftable&&"shift"===n&&(t[n]=i),e.canReduceTimeRange&&"reducedTimeRange"===n&&(t.reducedTimeRange=i),t)),{})}function ur(e){return"number"===e?u.i18n.translate("xpack.lens.formula.number",{defaultMessage:"number"}):"string"===e?u.i18n.translate("xpack.lens.formula.string",{defaultMessage:"string"}):"boolean"===e?u.i18n.translate("xpack.lens.formula.boolean",{defaultMessage:"boolean"}):""}const cr={add:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.addFunction.markdown",{defaultMessage:"\nAdds up two numbers.\nAlso works with `+` symbol.\n\nExample: Calculate the sum of two fields\n\n`sum(price) + sum(tax)`\n\nExample: Offset count by a static value\n\n`add(count(), 5)`\n    "})},subtract:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.subtractFunction.markdown",{defaultMessage:"\nSubtracts the first number from the second number.\nAlso works with `-` symbol.\n\nExample: Calculate the range of a field\n`subtract(max(bytes), min(bytes))`\n    "})},multiply:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.multiplyFunction.markdown",{defaultMessage:"\nMultiplies two numbers.\nAlso works with `*` symbol.\n\nExample: Calculate price after current tax rate\n`sum(bytes) * last_value(tax_rate)`\n\nExample: Calculate price after constant tax rate\n`multiply(sum(price), 1.2)`\n    "})},divide:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.divideFunction.markdown",{defaultMessage:"\nDivides the first number by the second number.\nAlso works with `/` symbol\n\nExample: Calculate profit margin\n`sum(profit) / sum(revenue)`\n\nExample: `divide(sum(bytes), 2)`\n    "})},abs:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.absFunction.markdown",{defaultMessage:"\nCalculates absolute value. A negative value is multiplied by -1, a positive value stays the same.\n\nExample: Calculate average distance to sea level `abs(average(altitude))`\n    "})},cbrt:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.cbrtFunction.markdown",{defaultMessage:"\nCube root of value.\n\nExample: Calculate side length from volume\n`cbrt(last_value(volume))`\n    "})},ceil:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.ceilFunction.markdown",{defaultMessage:"\nCeiling of value, rounds up.\n\nExample: Round up price to the next dollar\n`ceil(sum(price))`\n    "})},clamp:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.min",{defaultMessage:"min"}),type:ur("number"),alternativeWhenMissing:"pick_max"},{name:u.i18n.translate("xpack.lens.formula.max",{defaultMessage:"max"}),type:ur("number"),alternativeWhenMissing:"pick_min"}],help:u.i18n.translate("xpack.lens.formula.clampFunction.markdown",{defaultMessage:"\nLimits the value from a minimum to maximum.\n\nExample: Make sure to catch outliers\n```\nclamp(\n  average(bytes),\n  percentile(bytes, percentile=5),\n  percentile(bytes, percentile=95)\n)\n```\n"})},cube:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.cubeFunction.markdown",{defaultMessage:"\nCalculates the cube of a number.\n\nExample: Calculate volume from side length\n`cube(last_value(length))`\n    "})},exp:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.expFunction.markdown",{defaultMessage:"\nRaises *e* to the nth power.\n\nExample: Calculate the natural exponential function\n\n`exp(last_value(duration))`\n    "})},fix:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.fixFunction.markdown",{defaultMessage:"\nFor positive values, takes the floor. For negative values, takes the ceiling.\n\nExample: Rounding towards zero\n`fix(sum(profit))`\n    "})},floor:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.floorFunction.markdown",{defaultMessage:"\nRound down to nearest integer value\n\nExample: Round down a price\n`floor(sum(price))`\n    "})},log:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),optional:!0,defaultValue:"e",type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.logFunction.markdown",{defaultMessage:"\nLogarithm with optional base. The natural base *e* is used as default.\n\nExample: Calculate number of bits required to store values\n```\nlog(sum(bytes))\nlog(sum(bytes), 2)\n```\n    "})},mod:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.modFunction.markdown",{defaultMessage:"\nRemainder after dividing the function by a number\n\nExample: Calculate last three digits of a value\n`mod(sum(price), 1000)`\n    "})},pow:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.base",{defaultMessage:"base"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.powFunction.markdown",{defaultMessage:"\nRaises the value to a certain power. The second argument is required\n\nExample: Calculate volume based on side length\n`pow(last_value(length), 3)`\n    "})},round:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.decimals",{defaultMessage:"decimals"}),optional:!0,defaultValue:0,type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.roundFunction.markdown",{defaultMessage:"\nRounds to a specific number of decimal places, default of 0\n\nExamples: Round to the cent\n```\nround(sum(bytes))\nround(sum(bytes), 2)\n```\n    "})},sqrt:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.sqrtFunction.markdown",{defaultMessage:"\nSquare root of a positive value only\n\nExample: Calculate side length based on area\n`sqrt(last_value(area))`\n    "})},square:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.squareFunction.markdown",{defaultMessage:"\nRaise the value to the 2nd power\n\nExample: Calculate area based on side length\n`square(last_value(length))`\n    "})},pick_max:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.maxFunction.markdown",{defaultMessage:"\nFinds the maximum value between two numbers.\n\nExample: Find the maximum between two fields averages\n`pick_max(average(bytes), average(memory))`\n        "})},pick_min:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.minFunction.markdown",{defaultMessage:"\nFinds the minimum value between two numbers.\n\nExample: Find the minimum between two fields averages\n`pick_min(average(bytes), average(memory))`\n    "})},defaults:{section:"math",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.value",{defaultMessage:"value"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.defaultValue",{defaultMessage:"default"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.defaultFunction.markdown",{defaultMessage:"\nReturns a default numeric value when value is null.\n\nExample: Return -1 when a field has no data\n`defaults(average(bytes), -1)`\n"})},lt:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],outputType:ur("boolean"),help:u.i18n.translate("xpack.lens.formula.ltFunction.markdown",{defaultMessage:"\nPerforms a lower than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `<` symbol.\n\nExample: Returns true if the average of bytes is lower than the average amount of memory\n`average(bytes) <= average(memory)`\n\nExample: `lt(average(bytes), 1000)`\n    "})},gt:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],outputType:ur("boolean"),help:u.i18n.translate("xpack.lens.formula.gtFunction.markdown",{defaultMessage:"\nPerforms a greater than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `>` symbol.\n\nExample: Returns true if the average of bytes is greater than the average amount of memory\n`average(bytes) > average(memory)`\n\nExample: `gt(average(bytes), 1000)`\n    "})},eq:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],outputType:ur("boolean"),help:u.i18n.translate("xpack.lens.formula.eqFunction.markdown",{defaultMessage:"\nPerforms an equality comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `==` symbol.\n\nExample: Returns true if the average of bytes is exactly the same amount of average memory\n`average(bytes) == average(memory)`\n\nExample: `eq(sum(bytes), 1000000)`\n    "})},lte:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],outputType:ur("boolean"),help:u.i18n.translate("xpack.lens.formula.lteFunction.markdown",{defaultMessage:"\nPerforms a lower than or equal comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `<=` symbol.\n\nExample: Returns true if the average of bytes is lower than or equal to the average amount of memory\n`average(bytes) <= average(memory)`\n\nExample: `lte(average(bytes), 1000)`\n    "})},gte:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],outputType:ur("boolean"),help:u.i18n.translate("xpack.lens.formula.gteFunction.markdown",{defaultMessage:"\nPerforms a greater than comparison between two values.\nTo be used as condition for `ifelse` comparison function.\nAlso works with `>=` symbol.\n\nExample: Returns true if the average of bytes is greater than or equal to the average amount of memory\n`average(bytes) >= average(memory)`\n\nExample: `gte(average(bytes), 1000)`\n    "})},ifelse:{section:"comparison",positionalArguments:[{name:u.i18n.translate("xpack.lens.formula.condition",{defaultMessage:"condition"}),type:ur("boolean")},{name:u.i18n.translate("xpack.lens.formula.left",{defaultMessage:"left"}),type:ur("number")},{name:u.i18n.translate("xpack.lens.formula.right",{defaultMessage:"right"}),type:ur("number")}],help:u.i18n.translate("xpack.lens.formula.ifElseFunction.markdown",{defaultMessage:"\nReturns a value depending on whether the element of condition is true or false.\n\nExample: Average revenue per customer but in some cases customer id is not provided which counts as additional customer\n`sum(total)/(unique_count(customer_id) + ifelse( count() > count(kql='customer_id:*'), 1, 0))`\n    "})}};function dr(e){return Object(qt.isObject)(e)&&"function"===e.type&&cr[e.name]}function pr(e){return"string"==typeof e?[{type:"variable",value:e,text:e,location:{min:0,max:0}}]:null==e||"number"==typeof e||"namedArgument"===e.type?[]:"variable"===e.type?[e]:e.args.flatMap(pr)}function mr(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>!e.hidden)))}const gr=ur("number");function fr(e){return[e.location].filter(st.nonNullable)}function br(e,t){if(!Object(qt.isObject)(e))return ur(typeof e);if("function"===e.type){var a;if(cr[e.name])return null!==(a=cr[e.name].outputType)&&void 0!==a?a:gr;if(t[e.name])return gr}}const vr=(e,t)=>{const a=e.split("\n").join(""),n=/(kql|lucene)/,i=a.split(",").filter((e=>n.test(e))),s=Object.keys(t).some((e=>a.includes(e)));if(0===i.length||!s)return;const l=i.flatMap((e=>e.split("count").filter((e=>n.test(e))))),[r,o]=Object(qt.partition)(l,(e=>/kql/.test(e))),u=[];for(const e of r){const t=hr(e,"kql");t&&u.push(t)}for(const e of o){const t=hr(e,"lucene");t&&u.push(t)}return u.length?u:void 0},hr=(e,t)=>{const[,...a]=e.split("="),n=(a||[""]).join(""),i=n.trim();if(i.length&&("'"!==i[0]||!/'\s*([^']+?)\s*'/.test(n))&&"''"!==i)return u.i18n.translate("xpack.lens.indexPattern.formulaOperationQueryError",{defaultMessage:"Single quotes are required for {language}='' at {rawQuery}",values:{language:t,rawQuery:e}})},xr=({value:e,name:t,text:a},n)=>{const i=hr(a,t);if(i)return i;try{return void("kql"===t?Object(El.toElasticsearchQuery)(Object(El.fromKueryExpression)(e),n):Object(El.luceneStringToDsl)(e))}catch(e){return e.message}};function yr({messageId:e,values:t,locations:a}){let n;const i=t;switch(e){case"wrongFirstArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongFirstArgument",{defaultMessage:"The first argument for {operation} should be a {type} name. Found {argument}",values:{operation:i.operation,type:i.type,argument:i.argument}});break;case"shouldNotHaveField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotRequired",{defaultMessage:"The operation {operation} does not accept any field as argument",values:{operation:i.operation}});break;case"cannotAcceptParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaParameterNotRequired",{defaultMessage:"The operation {operation} does not accept any parameter",values:{operation:i.operation}});break;case"missingParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionNotHandled",{defaultMessage:"The operation {operation} in the Formula is missing the following parameters: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeParameter":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongType",{defaultMessage:"The parameters for the operation {operation} in the Formula are of the wrong type: {params}",values:{operation:i.operation,params:i.params}});break;case"wrongTypeArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionWrongTypeArgument",{defaultMessage:"The {name} argument for the operation {operation} in the Formula is of the wrong type: {type} instead of {expectedType}",values:{operation:i.operation,name:i.name,type:i.type,expectedType:i.expectedType}});break;case"duplicateArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDuplicateParams",{defaultMessage:"The parameters for the operation {operation} have been declared multiple times: {params}",values:{operation:i.operation,params:i.params}});break;case"missingField":n=u.i18n.translate("xpack.lens.indexPattern.formulaFieldNotFound",{defaultMessage:"{variablesLength, plural, one {Field} other {Fields}} {variablesList} not found",values:{variablesLength:i.variablesLength,variablesList:i.variablesList}});break;case"missingOperation":n=u.i18n.translate("xpack.lens.indexPattern.operationsNotFound",{defaultMessage:"{operationLength, plural, one {Operation} other {Operations}} {operationsList} not found",values:{operationLength:i.operationLength,operationsList:i.operationsList}});break;case"fieldWithNoOperation":n=u.i18n.translate("xpack.lens.indexPattern.fieldNoOperation",{defaultMessage:"The field {field} cannot be used without operation",values:{field:i.field}});break;case"failedParsing":n=u.i18n.translate("xpack.lens.indexPattern.formulaExpressionParseError",{defaultMessage:"The Formula {expression} cannot be parsed",values:{expression:i.expression}});break;case"tooManyArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaWithTooManyArguments",{defaultMessage:"The operation {operation} has too many arguments",values:{operation:i.operation}});break;case"missingMathArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaMathMissingArgument",{defaultMessage:"The operation {operation} in the Formula is missing {count} arguments: {params}",values:{operation:i.operation,count:i.count,params:i.params}});break;case"tooManyQueries":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationDoubleQueryError",{defaultMessage:"Use only one of kql= or lucene=, not both"});break;case"tooManyFirstArguments":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationTooManyFirstArguments",{defaultMessage:"The operation {operation} in the Formula requires a {supported, plural, one {single} other {supported}} {type}, found: {text}",values:{operation:i.operation,text:i.text,type:i.type,supported:i.supported||1}});break;case"wrongArgument":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationwrongArgument",{defaultMessage:"The operation {operation} in the Formula does not support {type} parameters, found: {text}",values:{operation:i.operation,text:i.text,type:i.type}});break;case"wrongReturnedType":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationWrongReturnedType",{defaultMessage:"The return value type of the operation {text} is not supported in Formula",values:{text:i.text}});break;case"filtersTypeConflict":n=u.i18n.translate("xpack.lens.indexPattern.formulaOperationFiltersTypeConflicts",{defaultMessage:'The Formula filter of type "{outerType}" is not compatible with the inner filter of type "{innerType}" from the {operation} operation',values:{operation:i.operation,outerType:i.outerType,innerType:i.innerType}});break;case"useAlternativeFunction":n=u.i18n.translate("xpack.lens.indexPattern.formulaUseAlternative",{defaultMessage:"The operation {operation} in the Formula is missing the {params} argument: use the {alternativeFn} operation instead",values:{operation:i.operation,params:i.params,alternativeFn:i.alternativeFn}});break;default:n="no Error found"}return{type:e,message:n,locations:a}}function jr(e,t){let a;try{a=Object(nr.parse)(e)}catch(a){const n=vr(e,t);return n?{root:null,error:{message:n[0],locations:[]}}:{root:null,error:yr({messageId:"failedParsing",values:{expression:e},locations:[]})}}return{root:a,error:null}}function Or(e,t,a,n,i,s){return[...Ir(e,t,a,n),...wr(e),...Cr(e,t,a,n,s,i)]}function Ir(e,t,a,n){const i=[],s=function(e,t){const a=(n=e,function e(t){return Object(qt.isObject)(t)&&"function"===t.type?[t,...t.args.flatMap(e)].filter(st.nonNullable):[]}(n)).filter((e=>!dr(e)&&!t[e.name]));var n;return{names:Array.from(new Set(a.map((({name:e})=>e)))),locations:a.map((({location:e})=>e)).filter(st.nonNullable)}}(e,n);s.names.length&&i.push(yr({messageId:"missingOperation",values:{operationLength:s.names.length,operationsList:s.names.join(", ")},locations:s.locations}));const l=pr(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e]));l.length&&i.push({...yr({messageId:"missingField",values:{variablesLength:l.length,variablesList:l.map((({value:e})=>e)).join(", ")},locations:l.map((({location:e})=>e))}),extraInfo:{missingFields:[...new Set(l.map((({value:e})=>e)))]}});const r=function(e,t){const a=[];return Object(qt.isObject)(e)&&"variable"===e.type&&!t.has(e.value)&&a.push(yr({messageId:"fieldWithNoOperation",values:{field:e.value},locations:[e.location]})),a}(e,new Set(l.map((({value:e})=>e))));return[...i,...r]}function kr(e){switch(e){case ca.REASON_IDS.missingTimerange:return u.i18n.translate("xpack.lens.indexPattern.absoluteMissingTimeRange",{defaultMessage:"Invalid time shift. No time range found as reference"});case ca.REASON_IDS.invalidDate:return u.i18n.translate("xpack.lens.indexPattern.absoluteInvalidDate",{defaultMessage:"Invalid time shift. The date is not of the correct format"});case ca.REASON_IDS.shiftAfterTimeRange:return u.i18n.translate("xpack.lens.indexPattern.absoluteAfterTimeRange",{defaultMessage:"Invalid time shift. The provided date is after the current time range"});case ca.REASON_IDS.notAbsoluteTimeShift:return u.i18n.translate("xpack.lens.indexPattern.notAbsoluteTimeShift",{defaultMessage:"Invalid time shift."})}}function Tr(e,t,a,n){const i=[],{conflicts:s,innerType:l,outerType:r}=function(e,t=[],a){const n=or(e,t);if(!e.filterable||!a||!n.kql&&!n.lucene)return{conflicts:!1};const i="kuery"===a.language?"kql":a.language;return{conflicts:!(i in n),innerType:n.lucene?"lucene":"kql",outerType:i}}(t,a,n);return s&&l&&r&&i.push(yr({messageId:"filtersTypeConflict",values:{operation:e.name,innerType:l,outerType:r},locations:fr(e)})),i}function Mr(e,t,a,n,i){const s=[],l=function(e,t=[]){return Fr(e,t).filter((({isMissing:e,isRequired:t})=>e&&t))}(t,a);l.length&&s.push(yr({messageId:"missingParameter",values:{operation:e.name,params:l.map((({name:e})=>e)).join(", ")},locations:fr(e)}));const r=function(e,t=[]){return Fr(e,t).filter((({isCorrectType:e,isMissing:t})=>!e&&!t))}(t,a);r.length&&s.push(yr({messageId:"wrongTypeParameter",values:{operation:e.name,params:r.map((({name:e})=>e)).join(", ")},locations:fr(e)}));const o=function(e=[]){const t=Object.create(null);for(const{name:a}of e){const e=t[a]||0;t[a]=e+1}const a=Object.keys(t);return e.length>a.length?a.filter((e=>t[e]>1)):[]}(a);o.length&&s.push(yr({messageId:"duplicateArgument",values:{operation:e.name,params:o.join(", ")},locations:fr(e)}));const c=function(e,t,a){const n=[];return(null!=e?e:[]).forEach((e=>{if("kql"===e.name||"lucene"===e.name){const a=xr(e,t);a&&n.push({message:a,locations:[e.location]})}if("shift"===e.name&&"invalid"===Object(ca.parseTimeShift)(e.value))if(Object(ca.isAbsoluteTimeShift)(e.value)){const t=Object(ca.validateAbsoluteTimeShift)(e.value,a?{from:a.fromDate,to:a.toDate}:void 0);t&&n.push({message:kr(t),locations:[e.location]})}else n.push({message:u.i18n.translate("xpack.lens.indexPattern.invalidTimeShift",{defaultMessage:"Invalid time shift. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]});if("reducedTimeRange"===e.name){const t=Object(ca.parseTimeShift)(e.value||"");"invalid"!==t&&"previous"!==t||n.push({message:u.i18n.translate("xpack.lens.indexPattern.invalidReducedTimeRange",{defaultMessage:"Invalid reduced time range. Enter positive integer amount followed by one of the units s, m, h, d, w, M, y. For example 3h for 3 hours"}),locations:[e.location]})}})),n}(a,n,i);c.length&&s.push(...c);const d=function(e){return e?e.filter((e=>"kql"===e.name||"lucene"===e.name)).length>1:void 0}(a);return d&&s.push(yr({messageId:"tooManyQueries",values:{},locations:fr(e)})),s}function wr(e){var t;return Object(qt.isObject)(e)&&"function"===e.type&&e.text&&((null===(t=cr[e.name])||void 0===t?void 0:t.outputType)||gr)!==gr?[yr({messageId:"wrongReturnedType",values:{text:e.text},locations:fr(e)})]:[]}function Cr(e,t,a,n,i,s){const l=pr(e).filter((({value:e})=>!a.getFieldByName(e)&&!t.columns[e])),r=new Set(l.map((({value:e})=>e))),o=null==s?void 0:s.filter;return function e(t){if(!Object(qt.isObject)(t)||"function"!==t.type)return[];const s=n[t.name],l=[],{namedArguments:c,functions:d,variables:p}=sr(t.args),[m]=(null==t?void 0:t.args)||[];if(s){if("field"===s.input){if(Ar(m,"variable")){const e=Dr(t,p,{isFieldOperation:!0,firstArg:m,returnedType:Sr(s,a,m)});e.length&&l.push(...e)}else dr(m)?l.push(yr({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:"math operation"},locations:fr(t)})):Pr(t)&&l.push(yr({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),argument:lr(m)||u.i18n.translate("xpack.lens.indexPattern.formulaNoFieldForOperation",{defaultMessage:"no field"})},locations:fr(t)}));const e=Rr(t,d,0,{isFieldOperation:!0,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),firstArgValidation:!1});if(e.length&&l.push(...e),!Er(s)&&c.length)l.push(yr({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:fr(t)}));else{const e=Mr(t,s,c,a,i),n=Tr(t,s,c,o);l.push(...e,...n)}return l}if("fullReference"===s.input){const e=Boolean(!Ar(m,"function")||dr(m)&&Lr(m,r,n).length);e&&l.push(yr({messageId:"wrongFirstArgument",values:{operation:t.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaOperationValue",{defaultMessage:"operation"}),argument:lr(m)||u.i18n.translate("xpack.lens.indexPattern.formulaNoOperation",{defaultMessage:"no operation"})},locations:fr(t)}));const g=Rr(t,d,s.requiredReferences?s.requiredReferences.length:1,{isFieldOperation:!1,firstArgValidation:e,type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})});if(g.length&&l.push(...g),!Er(s)&&c.length)l.push(yr({messageId:"cannotAcceptParameter",values:{operation:t.name},locations:fr(t)}));else{const e=Dr(t,p,{isFieldOperation:!1,firstArg:m,returnedType:void 0}),n=Mr(t,s,c,a,i),r=Tr(t,s,c,o);l.push(...e,...n,...r)}}return l.concat(e(d[0]))}return l.push(...Lr(t,r,n)),null!=d&&d.length?l.concat(d.flatMap((t=>e(t)))):l}(e)}function Er(e){return Boolean((e.operationParams||[]).length)||e.filterable}function Sr(e,t,a){var n;const i=pr(a);if(1!==i.length)return;const s=t.getFieldByName(lr(i[0]));return s?null===(n=e.getPossibleOperationForField(s))||void 0===n?void 0:n.scale:void 0}function Fr(e,t=[]){var a;const n=or(e,t),i=[...null!==(a=e.operationParams)&&void 0!==a?a:[]];return e.filterable&&i.push({name:"kql",type:"string",required:!1},{name:"lucene",type:"string",required:!1}),i.map((({name:e,type:t,required:a})=>({name:e,isMissing:!(e in n),isCorrectType:typeof n[e]===t,isRequired:a})))}function Pr(e){return _r(e.name)}function _r(e){return!["count"].includes(e)}function Ar(e,t){return Object(qt.isObject)(e)&&e.type===t}function Lr(e,t,a){const n=function(e){return function e(t){return Object(qt.isObject)(t)&&"function"===t.type&&dr(t)?[t,...t.args.flatMap(e)].filter(st.nonNullable):[]}(e)}(e),i=[];return n.forEach((e=>{const{positionalArguments:n}=cr[e.name],s=n.filter((({optional:e})=>!e));if(!e.args.length)return i.push(yr({messageId:"missingMathArgument",values:{operation:e.name,count:s.length,params:s.map((({name:e})=>e)).join(", ")},locations:fr(e)}));if(e.args.length>n.length&&i.push(yr({messageId:"tooManyArguments",values:{operation:e.name},locations:fr(e)})),n.some(((a,n)=>{const i=e.args[n];if(null!=i&&"number"!=typeof i)return"variable"===i.type&&!t.has(i.value)}))&&i.push(yr({messageId:"shouldNotHaveField",values:{operation:e.name},locations:fr(e)})),s.length>1&&e.args.length<s.length){const t=s.filter(((t,a)=>null==e.args[a])),[a,n]=Object(qt.partition)(t,(e=>null!=e.alternativeWhenMissing));if(n.length&&i.push(yr({messageId:"missingMathArgument",values:{operation:e.name,count:s.length-e.args.length,params:n.map((({name:e})=>e)).join(", ")},locations:fr(e)})),a.length){const[t]=a;i.push(yr({messageId:"useAlternativeFunction",values:{operation:e.name,params:t.name,alternativeFn:t.alternativeWhenMissing},locations:fr(e)}))}}const l=n.map((({type:t},n)=>{const i=e.args[n];if(null!=i){const e=br(i,a);if(e&&e!==t)return n}})).filter(st.nonNullable);for(const t of l){const s=e.args[t];i.push(yr({messageId:"wrongTypeArgument",values:{operation:e.name,name:n[t].name,type:br(s,a)||gr,expectedType:n[t].type||""},locations:fr(e)}))}})),i}function Dr(e,t,{isFieldOperation:a,firstArg:n,returnedType:i}){const s=t.filter((e=>Ar(e,"variable")&&!dr(e))),l=[];var r;return a&&(s.length>1||1===s.length&&s[0]!==n)&&l.push(yr({messageId:"tooManyFirstArguments",values:{operation:e.name,type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"}),supported:1,text:s.map((({text:e})=>e)).join(", ")},locations:fr(e)})),a&&1===s.length&&s[0]===n&&"ordinal"===i&&l.push(yr({messageId:"wrongReturnedType",values:{text:null!==(r=e.text)&&void 0!==r?r:`${e.name}(${lr(n)})`},locations:fr(e)})),!a&&s.length&&l.push(yr({messageId:"wrongArgument",values:{operation:e.name,text:s.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaFieldValue",{defaultMessage:"field"})},locations:fr(e)})),l}function Rr(e,t,a=0,{isFieldOperation:n,firstArgValidation:i,type:s}){const l=[],[r,o]=Object(qt.partition)(t,(e=>!dr(e)));return r.length>a&&(n?l.push(yr({messageId:"wrongArgument",values:{operation:e.name,text:r.map((({text:e})=>e)).join(", "),type:u.i18n.translate("xpack.lens.indexPattern.formulaMetricValue",{defaultMessage:"metric"})},locations:fr(e)})):l.push(yr({messageId:"tooManyFirstArguments",values:{operation:e.name,type:s,supported:a,text:r.map((({text:e})=>e)).join(", ")},locations:fr(e)}))),n&&(!i&&o.length||o.length>1)&&l.push(yr({messageId:"wrongArgument",values:{operation:e.name,type:s,text:o.map((({text:e})=>e)).join(", ")},locations:fr(e)})),l}function Br(e){return null!=e}function Nr(e){if(!e)return"";const t=e.props;return t&&"markdown"in t?String(t.markdown):t&&"children"in t&&Array.isArray(t.children)?t.children.reduce(((e,t)=>{const a=l.a.Children.toArray(t).filter(Br);return Object(s.isValidElement)(t)&&a.length>0?e.concat(Nr(t)):e}),""):""}function zr({language:e,sections:t,searchInDescription:a}){const[n,i]=Object(s.useState)(),r=Object(s.useRef)({});Object(s.useEffect)((()=>{n&&r.current[n]&&r.current[n].scrollIntoView()}),[n]);const[o,c]=Object(s.useState)(""),d=o.trim().toLocaleLowerCase(),p=null==t?void 0:t.groups.map((e=>{const t=e.items.filter((e=>{var t;return!d||e.label.toLocaleLowerCase().includes(d)||a&&(null===(t=Nr(e.description))||void 0===t?void 0:t.toLocaleLowerCase().includes(d))}));return{...e,items:t}})).filter((e=>e.items.length>0||!d||e.label.toLocaleLowerCase().includes(d)));return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiPopoverTitle,{className:"documentation__docsHeader",paddingSize:"m","data-test-subj":"language-documentation-title"},u.i18n.translate("languageDocumentationPopover.header",{defaultMessage:"{language} reference",values:{language:e}})),Object(x.jsx)(b.EuiFlexGroup,{className:"documentation__docsContent",gutterSize:"none",responsive:!1,alignItems:"stretch"},Object(x.jsx)(b.EuiFlexItem,{className:"documentation__docsSidebar",grow:1},Object(x.jsx)(b.EuiFlexGroup,{className:"documentation__docsSidebarInner",direction:"column",gutterSize:"none",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{className:"documentation__docsSearch",grow:!1},Object(x.jsx)(b.EuiFieldSearch,{value:o,onChange:e=>{c(e.target.value)},"data-test-subj":"language-documentation-navigation-search",placeholder:u.i18n.translate("languageDocumentationPopover.searchPlaceholder",{defaultMessage:"Search"})})),Object(x.jsx)(b.EuiFlexItem,{className:"documentation__docsNav"},null==p?void 0:p.map(((e,t)=>Object(x.jsx)("nav",{className:"documentation__docsNavGroup",key:e.label},Object(x.jsx)(b.EuiTitle,{size:"xxs","data-test-subj":"language-documentation-navigation-title"},Object(x.jsx)("h6",null,Object(x.jsx)(b.EuiLink,{className:"documentation__docsNavGroupLink",color:"text",onClick:()=>{i(e.label)}},Object(x.jsx)(b.EuiHighlight,{search:o},e.label)))),e.items.length?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiListGroup,{gutterSize:"none"},e.items.map((e=>Object(x.jsx)(b.EuiListGroupItem,{key:e.label,label:Object(x.jsx)(b.EuiHighlight,{search:o},e.label),size:"s",onClick:()=>{i(e.label)}}))))):null)))))),Object(x.jsx)(b.EuiFlexItem,{className:"documentation__docsText",grow:2},Object(x.jsx)(b.EuiText,{size:"s"},Object(x.jsx)("section",{className:"documentation__docsTextIntro",ref:e=>{var a;e&&null!=t&&null!==(a=t.groups)&&void 0!==a&&a.length&&(r.current[t.groups[0].label]=e)}},null==t?void 0:t.initialSection),null==t?void 0:t.groups.slice(1).map(((e,a)=>Object(x.jsx)("section",{className:"documentation__docsTextGroup",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},Object(x.jsx)("h2",null,e.label),Object(x.jsx)("p",null,e.description),null==t?void 0:t.groups[a+1].items.map((e=>Object(x.jsx)("article",{className:"documentation__docsTextItem",key:e.label,ref:t=>{t&&(r.current[e.label]=t)}},e.description))))))))))}a(364);const Vr=l.a.memo(zr);function Gr({language:e,sections:t,buttonProps:a,searchInDescription:n}){const[l,r]=Object(s.useState)(!1),o=Object(s.useCallback)((()=>{r(!l)}),[l]);return Object(x.jsx)(b.EuiPopover,{panelClassName:"documentation__docs--overlay",panelPaddingSize:"none",isOpen:l,closePopover:()=>r(!1),button:Object(x.jsx)(b.EuiToolTip,{position:"top",content:u.i18n.translate("languageDocumentationPopover.tooltip",{defaultMessage:"{lang} reference",values:{lang:e}})},Object(x.jsx)(b.EuiButtonIcon,i()({iconType:"documentation",onClick:o},a)))},Object(x.jsx)(Vr,{language:e,sections:t,searchInDescription:n}))}const qr=l.a.memo(Gr);var Hr=a(374),Ur=a.n(Hr),$r=a(48);function Wr(e,t,a,n){return{label:e,description:t,items:a.sort().map((e=>{const t=function(e,t){var a;if(cr[e]){const[t,a]=cr[e].help.split("```");return`${t.replace(/\n/g,"\n\n")}${a?`\`\`\`${a}\`\`\``:""}`}return null===(a=t[e].documentation)||void 0===a?void 0:a.description}(e,n);return{label:e,description:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("h3",null,Xr(e,n,!1)),t?Object(x.jsx)(d.Markdown,{markdown:t}):null)}}))}}function Xr(e,t,a=!0){if(cr[e])return`${e}(${cr[e].positionalArguments.map((({name:e,optional:t,type:a})=>`[${e}]${t?"?":""}: ${a}`)).join(", ")})`;if(t[e]){var n;const i=t[e],s=[];a&&(i.filterable&&s.push(u.i18n.translate("xpack.lens.formula.kqlExtraArguments",{defaultMessage:"[kql]?: string, [lucene]?: string"})),i.shiftable&&s.push(u.i18n.translate("xpack.lens.formula.shiftExtraArguments",{defaultMessage:"[shift]?: string"})),i.canReduceTimeRange&&s.push(u.i18n.translate("xpack.lens.formula.reducedTimeRangeExtraArguments",{defaultMessage:"[reducedTimeRange]?: string"})));const l=s.length?", ":"";return`${e}(${null===(n=i.documentation)||void 0===n?void 0:n.signature}${l}${s.join(", ")})`}return""}function Yr(e){return e.map((({name:e,type:t,defaultValue:a=5})=>`${e}=${"string"===t?`"${a}"`:a}`)).join(", ")}const Qr=[{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.none",{defaultMessage:"None"}),value:""},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.hour",{defaultMessage:"1 hour ago (1h)"}),value:"1h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3hours",{defaultMessage:"3 hours ago (3h)"}),value:"3h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6hours",{defaultMessage:"6 hours ago (6h)"}),value:"6h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.12hours",{defaultMessage:"12 hours ago (12h)"}),value:"12h"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.day",{defaultMessage:"1 day ago (1d)"}),value:"1d"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.week",{defaultMessage:"1 week ago (1w)"}),value:"1w"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.month",{defaultMessage:"1 month ago (1M)"}),value:"1M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.3months",{defaultMessage:"3 months ago (3M)"}),value:"3M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.6months",{defaultMessage:"6 months ago (6M)"}),value:"6M"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.year",{defaultMessage:"1 year ago (1y)"}),value:"1y"},{label:u.i18n.translate("xpack.lens.indexPattern.timeShift.previous",{defaultMessage:"Previous time range"}),value:"previous"}],Kr=Qr.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function Zr(e,t,a,n,i){const s=t.columnOrder.find((e=>"date_histogram"===t.columns[e].operationType));if(!s&&!a.timeFieldName)return{canShift:!1,hasDateHistogram:!1};if(s&&n&&n[i]&&n[i]){const t=n[i].columns.find((e=>e.id===s));if(t){var l;const a=(null===(l=e.getDateHistogramMeta(t))||void 0===l?void 0:l.interval)||"";return{interval:is.search.aggs.parseInterval(a),expression:a,canShift:!0,hasDateHistogram:!0}}}return{canShift:!0,hasDateHistogram:Boolean(s)}}function Jr({interval:e,canShift:t}){return{canShift:t,isValueTooSmall:t=>e&&t&&"object"==typeof t&&t.asMilliseconds()<e.asMilliseconds(),isValueNotMultiple:t=>e&&t&&"object"==typeof t&&!Number.isInteger(t.asMilliseconds()/e.asMilliseconds()),isInvalid:e=>Boolean("invalid"===e)}}function eo(e,t,{activeData:a,dataViews:n}){if(!t)return;const i=[];return Object.entries(t.layers).forEach((([t,s])=>{const l=n.indexPatterns[s.indexPatternId];if(!l)return;const r=Zr(e,s,l,a,t);if(!r.interval)return;const o=r.expression,u=r.interval.asMilliseconds(),d=new Set,p={};Object.entries(s.columns).forEach((([e,t])=>{if(t.isBucketed)return;let a=0;if(t.timeShift&&!Object(ca.isAbsoluteTimeShift)(t.timeShift)){const e=Object(ca.parseTimeShift)(t.timeShift);if("previous"===e||"invalid"===e)return;a=e.asMilliseconds()}d.add(a),p[a]||(p[a]=[]),p[a].push(e)})),d.size<2||d.forEach((e=>{0!==e&&(e<u?p[e].forEach((e=>{i.push(Object(x.jsx)(c.FormattedMessage,{key:`small-${e}`,id:"xpack.lens.indexPattern.timeShiftSmallWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is smaller than the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(x.jsx)("strong",null,s.columns[e].label),interval:Object(x.jsx)("strong",null,o),columnTimeShift:Object(x.jsx)("strong",null,s.columns[e].timeShift)}}))})):Number.isInteger(e/u)||p[e].forEach((e=>{i.push(Object(x.jsx)(c.FormattedMessage,{key:`multiple-${e}`,id:"xpack.lens.indexPattern.timeShiftMultipleWarning",defaultMessage:"{label} uses a time shift of {columnTimeShift} which is not a multiple of the date histogram interval of {interval}. To prevent mismatched data, use a multiple of {interval} as time shift.",values:{label:Object(x.jsx)("strong",null,s.columns[e].label),interval:Object(x.jsx)("strong",null,o),columnTimeShift:Object(x.jsx)("strong",null,s.columns[e].timeShift)}}))})))}))})),i}function to(e,t){const{isValueTooSmall:a,isValueNotMultiple:n}=Jr(e),i=[];if(Object(ca.isAbsoluteTimeShift)(t))return i;const s=t&&Object(ca.parseTimeShift)(t),l=s&&a(s),r=s&&n(s);return l?i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.tooSmallHelp",{defaultMessage:"Time shift should to be larger than the date histogram interval. Either increase time shift or specify smaller interval in date histogram"})):r&&i.push(u.i18n.translate("xpack.lens.indexPattern.timeShift.noMultipleHelp",{defaultMessage:"Time shift should be a multiple of the date histogram interval. Either adjust time shift or date histogram interval"})),i}function ao(e,t,a){const n=Object(ca.calcAutoIntervalNear)(a,Un()(t.toDate).diff(Un()(t.fromDate))),i=function(e,t){return Object(ca.isAbsoluteTimeShift)(e.trim())?Object(ca.parseAbsoluteTimeShift)(e,{from:t.fromDate,to:t.toDate}).value:Object(ca.parseTimeShift)(e)}(e,t);if("string"!=typeof i){const t=e.startsWith("end")?n.asMilliseconds():0;return(function(e,t){return e%t==0?e:Math.ceil(e/t)*t}(i.asMilliseconds(),n.asMilliseconds())-t)/1e3+"s"}}function no(e,t,a,n=!1){return e&&Object(ca.isAbsoluteTimeShift)(e)?ao(e,t,a):e&&n&&"previous"===e?ao(`endAt(${t.fromDate})`,t,a):e}const io=[{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.30s",{defaultMessage:"30 seconds (30s)"}),value:"30s"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.1m",{defaultMessage:"1 minute (1m)"}),value:"1m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.5m",{defaultMessage:"5 minutes (5m)"}),value:"5m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.15m",{defaultMessage:"15 minutes (15m)"}),value:"15m"},{label:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.1h",{defaultMessage:"1 hour (1h)"}),value:"1h"}],so=io.reduce(((e,{value:t},a)=>({...e,[t]:a})),{});function lo(e,t,a){const n=e.columns[t];if(!n.reducedTimeRange)return;const i=Object.values(e.columns).some((e=>"date_histogram"===e.operationType)),s=Boolean(a.timeFieldName);return[i&&u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangeWithDateHistogram",{defaultMessage:"Reduced time range can only be used without a date histogram. Either remove the date histogram dimension or remove the reduced time range from {column}.",values:{column:n.label}}),!s&&u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangeWithoutTimefield",{defaultMessage:"Reduced time range can only be used with a specified default time field on the data view. Either use a different data view with default time field or remove the reduced time range from {column}.",values:{column:n.label}})].filter(Boolean)}let ro;!function(e){e.FIELD="field",e.NAMED_ARGUMENT="named_argument",e.FUNCTIONS="functions",e.KQL="kql",e.SHIFTS="shifts",e.REDUCED_TIME_RANGES="reducedTimeRanges"}(ro||(ro={}));const oo="LENS_MATH_MARKER";function uo(e,t,a){if("number"!=typeof e&&(!e.location||(n=t)>=(i=e.location).min&&n<i.max)){var n,i;if("function"===e.type){const[a]=e.args.map((a=>uo(a,t,e))).filter(st.nonNullable);return a||(e.location?{ast:e}:void 0)}return{ast:e,parent:a}}}function co(e,t,a=0,n=1){return{range:{...t,startColumn:t.startColumn+a,endColumn:t.startColumn+n},text:e}}function po(e,t){const a=e.split(/\n/);let n=t,i=1;for(const e of a){if(e.length>=n)return new $r.monaco.Position(i,n+1);n-=e.length+1,i++}throw new Error("Algorithm failure")}function mo(e,t){return e.split(/\n/).slice(0,t.lineNumber).reduce(((e,a,n)=>e+(n===t.lineNumber-1?t.column-1:a.length+1)),0)}async function go({expression:e,zeroIndexedOffset:t,context:a,indexPattern:n,operationDefinitionMap:i,dataViews:s,unifiedSearch:l,dateHistogramInterval:r,dateRange:o}){const u=e.substr(0,t)+oo+e.substr(t);try{const e=uo(Object(nr.parse)(u),t),c=null==e?void 0:e.ast,d=(null==e?void 0:e.parent)&&"number"!=typeof c&&c&&"type"in c&&"namedArgument"===c.type;if(null!=e&&e.parent&&("="===a.triggerCharacter||d))return await async function({ast:e,unifiedSearch:t,dataViews:a,indexPattern:n,dateHistogramInterval:i,dateRange:s}){if("shift"===e.name){const t=Qr.filter((({value:e})=>{if(null==i)return!0;const t=Object(ca.parseTimeShift)(e);return"previous"===t||"invalid"===t||Number.isInteger(t.asMilliseconds()/i)})).map((({value:e})=>e)),a=e.value.split(oo)[0];if(bo.test(a))return{list:t.map((e=>`${vo(s,a,e)})`)),type:ro.SHIFTS};const n=["startAt","endAt"].map((e=>`${e}(${vo(s,e,t[0])})`));return{list:t.concat(n),type:ro.SHIFTS}}if("reducedTimeRange"===e.name)return{list:io.map((({value:e})=>e)),type:ro.REDUCED_TIME_RANGES};if("kql"!==e.name&&"lucene"!==e.name)return{list:[],type:ro.KQL};if(!t.autocomplete.hasQuerySuggestions("kql"===e.name?"kuery":"lucene"))return{list:[],type:ro.KQL};const l=e.value.split(oo)[0],r=e.value.indexOf(oo)+1,o=await t.autocomplete.getQuerySuggestions({language:"kql"===e.name?"kuery":"lucene",query:l,selectionStart:r,selectionEnd:r,indexPatterns:[await a.get(n.id)],boolFilter:[]});return{list:null!=o?o:[],type:ro.KQL}}({ast:c,unifiedSearch:l,dataViews:s,indexPattern:n,dateHistogramInterval:r,dateRange:o});if(null!=e&&e.parent)return function(e,t,a,n,i){const{name:s}=e,l=i[s];if(!l&&!cr[s])return{list:[],type:ro.FIELD};const r=cr[s];if(r)return r.positionalArguments[t]?{list:fo(n,i).map((e=>({type:"math",label:e}))),type:ro.FUNCTIONS}:{list:[],type:ro.FIELD};if(t>0||!_r(l.type)){const{namedArguments:t}=sr(e.args),a=[];return l.filterable&&(t.find((e=>"kql"===e.name||"lucene"===e.name))||(a.push("kql"),a.push("lucene"))),l.shiftable&&(t.find((e=>"shift"===e.name))||a.push("shift")),l.canReduceTimeRange&&(t.find((e=>"reducedTimeRange"===e.name))||a.push("reducedTimeRange")),"operationParams"in l&&a.push(...l.operationParams.filter((e=>!t.find((t=>t.name===e.name)))).map((e=>e.name))),{list:a,type:ro.NAMED_ARGUMENT}}if("field"===l.input&&0===t){const t=_p(n,i).filter((({operationMetaData:e})=>("number"===e.dataType||"date"===e.dataType)&&!e.isBucketed));if(t.length){const n=t.flatMap((e=>e.operations)).filter((e=>e.operationType===l.type)).map((e=>"field"in e?e.field:void 0)).filter(st.nonNullable),i=e.args[0],s="string"!=typeof i&&i.location;let r;if(s){const e=po(a,s.min),t=po(a,s.max-oo.length);r=$r.monaco.Range.fromPositions(e,t)}return{list:n,type:ro.FIELD,range:r}}return{list:[],type:ro.FIELD}}if("fullReference"===l.input){const e=_p(n,i),t=[];return e.forEach((e=>{l.requiredReferences.some((t=>t.validateMetadata(e.operationMetaData)))&&t.push(...e.operations.filter((e=>l.requiredReferences.some((t=>t.input.includes(e.type))))).map((e=>e.operationType)))})),{list:Object(qt.uniq)(t).map((e=>({label:e,type:"operation"}))),type:ro.FUNCTIONS}}return{list:[],type:ro.FIELD}}(e.parent,e.parent.args.findIndex((e=>e===c)),u,n,i);if("object"==typeof c&&Boolean("variable"===c.type||"function"===c.type))return function(e,t,a){return{list:Object(qt.uniq)(fo(t,a).filter((t=>Object(qt.startsWith)(t,e)))).map((e=>({label:e,type:"operation"}))),type:ro.FUNCTIONS}}(("function"===c.type?c.name:c.value).split(oo)[0],n,i)}catch(e){}return{list:[],type:ro.FIELD}}function fo(e,t){const a=_p(e,t),n=new Set;for(const e of a)if("number"===e.operationMetaData.dataType&&!e.operationMetaData.isBucketed)for(const t of e.operations)("managedReference"!==t.type||t.usedInMath)&&n.add(t.operationType);return Array.from(n.keys()).concat(Object.keys(cr))}const bo=/^(start|end)At\(/;function vo(e,t,a){const n=t.startsWith("s")?e.fromDate:e.toDate;return Un()(n).subtract(Object(ca.parseTimeShift)(a),"ms").toISOString()}const ho={title:"Trigger Suggestion Dialog",id:"editor.action.triggerSuggest"};function xo(e,t){if(cr[e])return[{label:Xr(e,t),documentation:{value:cr[e].help.replace(/\n/g,"\n\n")},parameters:cr[e].positionalArguments.map((e=>({label:e.name,documentation:e.optional?u.i18n.translate("xpack.lens.formula.optionalArgument",{defaultMessage:"Optional. Default value is {defaultValue}",values:{defaultValue:e.defaultValue}}):""})))}];if(t[e]){const a=t[e],n=_r(e)?{label:"field"===a.input?"field":"fullReference"===a.input?"function":""}:null,i=Xr(e,t),s=function(e,t){const{description:a,examples:n}=function(e,t){var a,n;const i=t[e],s=null!==(a=null===(n=i.documentation)||void 0===n?void 0:n.description)&&void 0!==a?a:"",l=[];if(!/Example/.test(s)){if(!_r(e))return l.push(`${e}()`),{description:s,examples:l};if("field"===i.input){var r;const t=(null===(r=i.operationParams)||void 0===r?void 0:r.filter((({required:e})=>e)))||[];if(0===t.length&&l.push(`${e}(bytes)`),t.length){const a=Yr(t);l.push(`${e}(bytes, ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=Yr(i.operationParams);l.push(`${e}(bytes, ${t})`)}}if("fullReference"===i.input){var o;const t=(null===(o=i.operationParams)||void 0===o?void 0:o.filter((({required:e})=>e)))||[];if(0===t.length&&l.push(`${e}(sum(bytes))`),t.length){const a=Yr(t);l.push(`${e}(sum(bytes), ${a})`)}if(i.operationParams&&t.length!==i.operationParams.length){const t=Yr(i.operationParams);l.push(`${e}(sum(bytes), ${t})`)}}}return{description:s,examples:l}}(e,t);return{value:`${a}${n.length?`\n\n**${u.i18n.translate("xpack.lens.formulaExampleMarkdown",{defaultMessage:"Examples"})}**\n\n  ${n.map((e=>`\`${e}\``)).join("\n\n")}`:""}`}}(e,t);return"operationParams"in a&&a.operationParams?[{label:i,parameters:[...n?[n]:[],...a.operationParams.map((e=>({label:`${e.name}=${e.type}`,documentation:e.required?u.i18n.translate("xpack.lens.formula.requiredArgument",{defaultMessage:"Required"}):""})))],documentation:s}]:[{label:i,parameters:n?[n]:[],documentation:s}]}return[]}function yo(e,t){const a=e.substr(0,t)+oo+e.substr(t);try{return uo(Object(nr.parse)(a),t)}catch(e){return}}const jo="lens_math";$r.monaco.languages.register({id:jo});const Oo={wordPattern:/[^()'"\s]+/g,brackets:[["(",")"]],autoClosingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}],surroundingPairs:[{open:"(",close:")"},{open:"'",close:"'"},{open:'"',close:'"'}]},Io={defaultToken:"invalid",tokenPostfix:"",ignoreCase:!0,brackets:[{open:"(",close:")",token:"delimiter.parenthesis"}],escapes:/\\(?:[\\"'])/,tokenizer:{root:[[/\s+/,"whitespace"],[/-?(\d*\.)?\d+([eE][+\-]?\d+)?/,"number"],[/[a-zA-Z0-9][a-zA-Z0-9_\-\.]*/,"keyword"],[/[,=:]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,"string","@string_dq"],[/'([^'\\]|\\.)*$/,"string.invalid"],[/'/,"string","@string_sq"],[/\+|\-|\*|\//,"keyword.operator"],[/[\(]/,"delimiter"],[/[\)]/,"delimiter"]],string_dq:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,"string","@pop"]],string_sq:[[/[^\\']+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/'/,"string","@pop"]]}};$r.monaco.languages.onLanguage(jo,(()=>{$r.monaco.languages.setMonarchTokensProvider(jo,Io),$r.monaco.languages.setLanguageConfiguration(jo,Oo)})),a(369);const ko={type:"math",displayName:"Math",hidden:!0,getDefaultLabel:(e,t,a)=>"Math",input:"managedReference",getDisabledStatus(e){},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{const a=e.columns[t];return[{type:"function",function:"mathColumn",arguments:{id:[t],name:[a.label],expression:[Mo(a.params.tinymathAst)],onError:["null"],castColumns:a.references}}]},buildColumn:()=>({label:"Math",dataType:"number",operationType:"math",isBucketed:!1,scale:"ratio",params:{tinymathAst:""},references:[]}),isTransferable:(e,t)=>!0,createCopy:e=>({...e})},To={add:"+",subtract:"-",multiply:"*",divide:"/",lt:"<",gt:">",eq:"==",lte:"<=",gte:">="};function Mo(e){return"number"==typeof e?e:"string"==typeof e?`"${e}"`:"variable"===e.type?e.value:"namedArgument"===e.type?"kql"===e.name||"lucene"===e.name?`${e.name}='${e.value}'`:`${e.name}=${e.value}`:To[e.name]?`(${e.args.map(Mo).join(` ${To[e.name]} `)})`:`${t=e.name,wo.reduce(((e,t)=>e.replace(t,"")),t)}(${e.args.map(Mo).join(",")})`;var t}const wo=["pick_"];var Co=a(95);function Eo(e,t){return`${e}X${t}`}const So=()=>({columns:{},meta:{locations:{}}});function Fo(e,t,a,n){const i={...a,columns:{...a.columns,[e]:{...t}}},{columns:s,meta:l}=Object.entries(i.columns).reduce(((t,[a,s])=>{if(a.startsWith(e)){if(a===e&&function(e){return"params"in e&&"formula"in e.params}(s)){const e=function(e,t,a,{indexPattern:n,operations:i=Tp,dateRange:s}){const{columns:l,meta:r}=So(),o=t.params.formula||"",{extracted:c,isValid:d}=function(e,t,a,n,i,s,l){const{root:r,error:o}=jr(e,i);if(o||null==r)return{extracted:[],isValid:!1};if(Or(r,t,n,i,t.columns[a],s).length)return{extracted:[],isValid:!1};const c=function(e,t,a,n,i,s,l){const r=[],{filter:o,reducedTimeRange:u}=n.columns[e],c=function a(l){if("number"==typeof l||"function"!==l.type)return l;const c=t[l.name];if(!c){const e=l.args.map(a).filter(st.nonNullable);return{...l,args:e}}const{namedArguments:d,variables:p,functions:m}=sr(l.args);if("field"===c.input){const[t]=p.filter((e=>Object(qt.isObject)(e)));let a=t?i.getFieldByName(t.value):void 0;Pr(l)||a||(a=Co.a);const m={...rr(c,or(c,d||[]),o,u),usedInMath:!0},g=c.buildColumn({layer:n,indexPattern:i,field:a},m),f=Eo(e,r.length);return g.customLabel=!0,g.label=s,r.push({column:g,location:l.location}),f}if("fullReference"===c.input){const[t]=m,p=a(t),g="string"!=typeof p;if(g){const e=p?pr(p):[],t=ko.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=p,r.push({column:t}),t.customLabel=!0,t.label=s}const f=rr(c,or(c,d||[]),o,u),b=c.buildColumn({layer:n,indexPattern:i,referenceIds:[g?Eo(e,r.length-1):p]},f),v=Eo(e,r.length);return b.customLabel=!0,b.label=s,r.push({column:b,location:l.location}),v}if("managedReference"===c.input&&c.usedInMath){const t=c.buildColumn({layer:n,indexPattern:i}),a=Eo(e,r.length);return t.customLabel=!0,t.label=s,r.push({column:t,location:l.location}),a}}(a);if(void 0===c)return[];if("string"!=typeof c){const e=pr(c),t=ko.buildColumn({layer:n,indexPattern:i});t.references=e.map((({value:e})=>e)),t.params.tinymathAst=c,t.customLabel=!0,t.label=s,r.push({column:t})}return r}(a,i,r,t,n,u.i18n.translate("xpack.lens.indexPattern.formulaPartLabel",{defaultMessage:"Part of {label}",values:{label:l||e}}));return{extracted:c,isValid:!0}}(o,a,e,n,mr(i),s,t.customLabel?t.label:void 0);return c.forEach((({column:t,location:a},n)=>{const i=Eo(e,n);l[i]=t,a&&(r.locations[i]=a)})),l[e]={...t,label:t.customLabel?t.label:null!=o?o:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),references:d?[Eo(e,c.length-1)]:[],params:{...t.params,formula:o,isFormulaBroken:!d}},{columns:l,meta:r}}(a,s,i,n);t.columns={...t.columns,...e.columns},t.meta={...t.meta,...e.meta}}}else t.columns[a]={...s};return t}),So());return{layer:{...i,columns:s,columnOrder:ku({...i,columns:s})},meta:l}}function Po(e,t,a){const n=null==e?void 0:e[t];return!(!n||0===n.rows.length)&&n.rows.some((e=>null!=e[a]))}const _o=l.a.memo(Do),Ao=new Set(["kql","lucene","shift","reducedTimeRange"]);var Lo={name:"1y0ex1",styles:"max-width:400px"};function Do({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,unifiedSearch:c,dataViews:p,toggleFullscreen:m,isFullscreen:g,dateHistogramInterval:f,hasData:v,dateRange:h,uiSettings:y}){var j;const[I,T]=Object(s.useState)(a.params.formula),[M,w]=Object(s.useState)([]),[C,E]=Object(s.useState)(g),[S,F]=Object(s.useState)(!1),[P,_]=Object(s.useState)(!0),A=l.a.useRef(),L=l.a.useRef(),D=l.a.useRef([]),R=l.a.useRef(),{euiTheme:B}=Object(b.useEuiTheme)(),N=Object(s.useMemo)((()=>mr(o)),[o]),z=Object(s.useMemo)((()=>function({indexPattern:e,operationDefinitionMap:t}){const a=[];a.push({label:u.i18n.translate("xpack.lens.formulaDocumentationHeading",{defaultMessage:"How it works"}),items:[]}),a.push({label:u.i18n.translate("xpack.lens.formulaFrequentlyUsedHeading",{defaultMessage:"Common formulas"}),description:u.i18n.translate("xpack.lens.formulaCommonFormulaDocumentation",{defaultMessage:'The most common formulas are dividing two values to produce a percent. To display accurately, set "value format" to "percent".'}),items:[{label:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatio",{defaultMessage:"Filter ratio"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.filterRatioDescription.markdown",{defaultMessage:"### Filter ratio:\n\nUse `kql=''` to filter one set of documents and compare it to other documents within the same grouping.\nFor example, to see how the error rate changes over time:\n\n```\ncount(kql='response.status_code > 400') / count()\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeek",{defaultMessage:"Week over week"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.weekOverWeekDescription.markdown",{defaultMessage:"### Week over week:\n\nUse `shift='1w'` to get the value of each grouping from\nthe previous week. Time shift should not be used with the *Top values* function.\n\n```\npercentile(system.network.in.bytes, percentile=99) /\npercentile(system.network.in.bytes, percentile=99, shift='1w')\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotal",{defaultMessage:"Percent of total"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.percentOfTotalDescription.markdown",{defaultMessage:"### Percent of total\n\nFormulas can calculate `overall_sum` for all the groupings,\nwhich lets you convert each grouping into a percent of total:\n\n```\nsum(products.base_price) / overall_sum(sum(products.base_price))\n```\n        ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})},{label:u.i18n.translate("xpack.lens.formulaDocumentation.recentChange",{defaultMessage:"Recent change"}),description:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.recentChangeDescription.markdown",{defaultMessage:'### Recent change\n\nUse `reducedTimeRange=\'30m\'` to add an additional filter on the time range of a metric aligned with the end of the global time range. This can be used to calculate how much a value changed recently.\n\n```\nmax(system.network.in.bytes, reducedTimeRange="30m")\n - min(system.network.in.bytes, reducedTimeRange="30m")\n```\n        ',description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}]});const{elasticsearch:n,calculation:i,math:s,comparison:l,constants:r}=Object(qt.groupBy)(fo(e),(e=>{var a;return e in t?null===(a=t[e].documentation)||void 0===a?void 0:a.section:e in cr?cr[e].section:void 0}));return a.push(Wr(u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSection",{defaultMessage:"Elasticsearch"}),u.i18n.translate("xpack.lens.formulaDocumentation.elasticsearchSectionDescription",{defaultMessage:"These functions will be executed on the raw documents for each row of the resulting table, aggregating all documents matching the break down dimensions into a single value."}),n,t)),a.push(Wr(u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSection",{defaultMessage:"Column calculations"}),u.i18n.translate("xpack.lens.formulaDocumentation.columnCalculationSectionDescription",{defaultMessage:"These functions are executed for each row, but are provided with the whole column as context. This is also known as a window function."}),i,t)),a.push(Wr(u.i18n.translate("xpack.lens.formulaDocumentation.mathSection",{defaultMessage:"Math"}),u.i18n.translate("xpack.lens.formulaDocumentation.mathSectionDescription",{defaultMessage:"These functions will be executed for reach row of the resulting table using single values from the same row calculated using other functions."}),s,t)),a.push(Wr(u.i18n.translate("xpack.lens.formulaDocumentation.comparisonSection",{defaultMessage:"Comparison"}),u.i18n.translate("xpack.lens.formulaDocumentation.comparisonSectionDescription",{defaultMessage:"These functions are used to perform value comparison."}),l,t)),a.push(Wr(u.i18n.translate("xpack.lens.formulaDocumentation.constantsSection",{defaultMessage:"Kibana context"}),u.i18n.translate("xpack.lens.formulaDocumentation.constantsSectionDescription",{defaultMessage:"These functions are used to retrieve Kibana context variables, which are the date histogram `interval`, the current `now` and the selected `time_range` and help you to compute date math operations."}),r,t)),{groups:a,initialSection:Object(x.jsx)(d.Markdown,{markdown:u.i18n.translate("xpack.lens.formulaDocumentation.markdown",{defaultMessage:"## How it works\n\nLens formulas let you do math using a combination of Elasticsearch aggregations and\nmath functions. There are three main types of functions:\n\n* Elasticsearch metrics, like `sum(bytes)`\n* Time series functions use Elasticsearch metrics as input, like `cumulative_sum()`\n* Math functions like `round()`\n\nAn example formula that uses all of these:\n\n```\nround(100 * moving_average(\naverage(cpu.load.pct),\nwindow=10,\nkql='datacenter.name: east*'\n))\n```\n\nElasticsearch functions take a field name, which can be in quotes. `sum(bytes)` is the same\nas `sum('bytes')`.\n\nSome functions take named arguments, like `moving_average(count(), window=5)`.\n\nElasticsearch metrics can be filtered using KQL or Lucene syntax. To add a filter, use the named\nparameter `kql='field: value'` or `lucene=''`. Always use single quotes when writing KQL or Lucene\nqueries. If your search has a single quote in it, use a backslash to escape, like: `kql='Women's''\n\nMath functions can take positional arguments, like pow(count(), 3) is the same as count() * count() * count()\n\nUse the symbols +, -, /, and * to perform basic math.\n      ",description:"Text is in markdown. Do not translate function names, special characters, or field names like sum(bytes)"})})}}({indexPattern:r,operationDefinitionMap:N})),[r,N]),V="interval"in f?null===(j=f.interval)||void 0===j?void 0:j.asMilliseconds():void 0,G=Object(s.useRef)(V);if(G.current=V,null==L||!L.current){const e=L.current=document.createElement("div");e.setAttribute("data-test-subj","lnsFormulaWidget"),e.classList.add("lnsFormulaOverflow","monaco-editor"),document.body.appendChild(e)}Object(s.useEffect)((()=>{const e=A,t=D,a=R;return()=>{var n,i,s,l,r;null===(n=e.current)||void 0===n||n.dispose(),null===(i=L.current)||void 0===i||null===(s=i.parentNode)||void 0===s||s.removeChild(L.current),null===(l=a.current)||void 0===l||l.dispose(),null===(r=t.current)||void 0===r||r.forEach((e=>e.dispose()))}}),[]),Ur()((()=>{I!==a.params.formula&&t((e=>Fo(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h}).layer))})),Object(k.s)((()=>{if(!A.current)return;if(!I)return w([]),$r.monaco.editor.setModelMarkers(A.current,"LENS",[]),void(a.params.formula&&t(Fo(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h}).layer));let i=[];const{root:s,error:l}=jr(I,N);if(l)i=[l];else if(s){const t=Or(s,e,r,N,a,h);t.length&&(i=t)}if(i.length){const s=a.params.isFormulaBroken,l=!a.params.isFormulaBroken&&!v;(s||l)&&a.params.formula!==I&&t(Fo(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h}).layer);const u=i.flatMap((e=>{if(e.locations.length)return e.locations.map((t=>{const a=po(I,t.min),n=po(I,t.max);return{message:e.message,startColumn:a.column+1,startLineNumber:a.lineNumber,endColumn:n.column+1,endLineNumber:n.lineNumber,severity:"warning"===e.severity?$r.monaco.MarkerSeverity.Warning:$r.monaco.MarkerSeverity.Error}}));{const t=po(I,0),a=po(I,I.length-1);return[{message:e.message,startColumn:t.column+1,startLineNumber:t.lineNumber,endColumn:a.column+1,endLineNumber:a.lineNumber,severity:"warning"===e.severity?$r.monaco.MarkerSeverity.Warning:$r.monaco.MarkerSeverity.Error}]}}));$r.monaco.editor.setModelMarkers(A.current,"LENS",u),w(u.map((({severity:e,message:t})=>({severity:e,message:t}))))}else{$r.monaco.editor.setModelMarkers(A.current,"LENS",[]);const{layer:i,meta:{locations:s}}=Fo(n,{...a,params:{...a.params,formula:I||""}},e,{indexPattern:r,operations:o,dateRange:h});t(i);const l=Ru(n,i.columns).flatMap((([e,t])=>{const a=[];if(s[e]){const n=N[t.operationType];if(n.getErrorMessage){const t=n.getErrorMessage(i,e,r,h,N,y.get(is.UI_SETTINGS.HISTOGRAM_BAR_TARGET));if(t){const n=po(I,s[e].min),i=po(I,s[e].max);a.push({message:t.join(", "),startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:$r.monaco.MarkerSeverity.Warning})}}if(n.shiftable&&t.timeShift){const n=po(I,s[e].min),i=po(I,s[e].max);a.push(...to(f,t.timeShift).map((e=>({message:e,startColumn:n.column+1,startLineNumber:n.lineNumber,endColumn:i.column+1,endLineNumber:i.lineNumber,severity:$r.monaco.MarkerSeverity.Warning}))))}}return a})).filter(st.nonNullable);w(l.map((({severity:e,message:t})=>({severity:e,message:t})))),$r.monaco.editor.setModelMarkers(A.current,"LENS",l)}}),{skipFirstRender:!1},256,[I,a.filter]);const q=M.filter((e=>e.severity===$r.monaco.MarkerSeverity.Error)).length,H=M.filter((e=>e.severity===$r.monaco.MarkerSeverity.Warning)).length,U=Object(s.useCallback)((async(e,t,a)=>{const n=e.getValue();let i={list:[],type:ro.FIELD};const s=mo(n,t);return"("===a.triggerCharacter?("()"===n.slice(s-1,s+1)&&(t=t.delta(0,-1)),e.getWordAtPosition(t.delta(0,-3))&&(i=await go({expression:n,zeroIndexedOffset:s,context:a,indexPattern:r,operationDefinitionMap:N,unifiedSearch:c,dataViews:p,dateHistogramInterval:G.current,dateRange:h}))):i=await go({expression:n,zeroIndexedOffset:s,context:a,indexPattern:r,operationDefinitionMap:N,unifiedSearch:c,dataViews:p,dateHistogramInterval:G.current,dateRange:h}),{suggestions:i.list.map((e=>function(e,t,a,n,i){var s;let l,r,o,u=$r.monaco.languages.CompletionItemKind.Method,c="string"==typeof e?e:"label"in e?e.label:e.text,d="",p="";const m=c;switch(t){case ro.SHIFTS:p=String(Kr[c]).padStart(4,"0");break;case ro.REDUCED_TIME_RANGES:p=String(so[c]).padStart(4,"0");break;case ro.FIELD:u=$r.monaco.languages.CompletionItemKind.Value,ir.test(c)&&(l=`'${c.replaceAll("'","\\'")}'`);break;case ro.FUNCTIONS:if(l=`${c}($0)`,r=$r.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,"string"!=typeof e){if("text"in e)break;c=Xr(e.label,a),cr[e.label]?(d="TinyMath",u=$r.monaco.languages.CompletionItemKind.Method):(u=$r.monaco.languages.CompletionItemKind.Constant,d="Elasticsearch",p=`0${c}`,o=ho)}break;case ro.NAMED_ARGUMENT:u=$r.monaco.languages.CompletionItemKind.Keyword,"kql"!==c&&"lucene"!==c&&"shift"!==c&&"reducedTimeRange"!==c||(o=ho,l=`${c}='$0'`,r=$r.monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,p=`zzz${c}`),c=`${c}=`,d="";break;case ro.KQL:":"===n?l=`${n} ${c}`:o=ho,c.includes("'")&&(l=(l||c).replaceAll("'","\\'"))}return{detail:d,kind:u,label:c,insertText:null!==(s=l)&&void 0!==s?s:c,insertTextRules:r,command:o,additionalTextEdits:[],range:i,sortText:p,filterText:m}}(e,i.type,N,a.triggerCharacter,i.range)))}}),[r,N,c,p,G,h]),$=Object(s.useCallback)((async(e,t,a,n)=>{const i=e.getValue(),s=e.getFullModelRange(),l=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:s.endLineNumber,endColumn:s.endColumn});return function(e,t,a){const n=e.substr(0,t)+oo+e.substr(t);try{const e=uo(Object(nr.parse)(n),t);let i=[],s=0;if(null!=e&&e.parent){const t=e.parent.name;s=e.parent.args.findIndex((t=>t===e.ast)),i=xo(t,a)}else"object"==typeof(null==e?void 0:e.ast)&&"function"===e.ast.type&&(i=xo(e.ast.name,a));if(i.length)return{value:{signatures:i.map((({documentation:e,...t})=>({...t,documentation:{value:e.value.split("\n\n")[0]}}))),activeParameter:s,activeSignature:0},dispose:()=>{}}}catch(e){}return{value:{signatures:[],activeParameter:0,activeSignature:0},dispose:()=>{}}}(e.getValue(),i.length-l,N)}),[N]),W=Object(s.useCallback)((async(e,t,a)=>{const n=e.getValue(),i=e.getFullModelRange(),s=e.getValueLengthInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:i.endLineNumber,endColumn:i.endColumn});return function(e,t,a){try{const n=uo(Object(nr.parse)(e),t);if(!n||"number"==typeof n.ast||!("name"in n.ast))return{contents:[]};const i=xo(n.ast.name,a);if(i.length){const{label:e}=i[0];return{contents:[{value:e}]}}}catch(e){}return{contents:[]}}(e.getValue(),n.length-s,N)}),[N]),X=Object(s.useCallback)(((e,t)=>{if(!(e.isFlush||e.isRedoing||e.isUndoing)&&1===e.changes.length){const n=e.changes[0].text;if("="!==n&&"'"!==n)return;const i=e.changes[0].range;if(i){var a;const e=t.getValue(),s=mo(e,new $r.monaco.Position(i.startLineNumber,i.startColumn));let l=yo(e,s+1);if(!l&&"'"===n){const t=e;l=yo(t.substring(0,s)+"\\'"+t.substring(s+1),s+2)}const r=/'LENS_MATH_MARKER/;if(l&&("number"==typeof l.ast||"namedArgument"!==l.ast.type||!Ao.has(l.ast.name)||l.ast.value!==oo&&!r.test(l.ast.value)))return;let o=null;const u=2;if("="===n&&(l||"="===e.charAt(s-1)||(o=co("=",i,1)),l&&(o=co("''",i,1))),!l&&!o)return;"'"===n&&null!==(a=l)&&void 0!==a&&a.ast&&"number"!=typeof l.ast&&"name"in l.ast&&"shift"!==l.ast.name&&"reducedTimeRange"!==l.ast.name&&(o=co("\\'",i)),o&&setTimeout((()=>{var e;t.executeEdits("LENS",[o],[new $r.monaco.Selection(i.startLineNumber,i.startColumn+u,i.startLineNumber,i.startColumn+u)]),t.setPosition({column:i.startColumn+u,lineNumber:i.startLineNumber}),"="!==(null===(e=o)||void 0===e?void 0:e.text)&&t.trigger("lens","editor.action.triggerSuggest",{})}),0)}}}),[]),Y={languageId:jo,value:null!=I?I:"",onChange:T,options:{automaticLayout:!0,fontSize:14,folding:!1,lineNumbers:"off",scrollBeyondLastLine:!1,minimap:{enabled:!1},wordWrap:P?"on":"off",wordBasedSuggestions:!1,autoIndent:"brackets",wrappingIndent:"none",dimension:{width:320,height:200},fixedOverflowWidgets:!0,matchBrackets:"always",lineDecorationsWidth:16}};return Object(s.useEffect)((()=>{const{dispose:e}=$r.monaco.languages.registerCompletionItemProvider(jo,{triggerCharacters:[".","(","="," ",":","'"],provideCompletionItems:U}),{dispose:t}=$r.monaco.languages.registerSignatureHelpProvider(jo,{signatureHelpTriggerCharacters:["(","="],provideSignatureHelp:$}),{dispose:a}=$r.monaco.languages.registerHoverProvider(jo,{provideHover:W});return()=>{e(),t(),a()}}),[U,$,W]),Object(x.jsx)("div",{className:O()({lnsIndexPatternDimensionEditor:!0,"lnsIndexPatternDimensionEditor-isFullscreen":g})},!g&&Object(x.jsx)(b.EuiFormLabel,{css:Object(x.css)("margin-top:",B.size.base,";margin-bottom:",B.size.xs,";","")},u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingFormula",{defaultMessage:"Formula"})),Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor--shaded",css:Object(x.css)("border:",g?"none":B.border.thin,";border-radius:",g?0:B.border.radius.medium,";height:",g?"100%":"auto",";","")},Object(x.jsx)("div",{className:"lnsFormula"},Object(x.jsx)("div",{className:"lnsFormula__editor"},Object(x.jsx)("div",{className:"lnsFormula__editorHeader"},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup"},Object(x.jsx)(b.EuiToolTip,{content:P?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),position:"top"},Object(x.jsx)(b.EuiButtonIcon,{iconType:P?"wordWrap":"wordWrapDisabled",display:P?void 0:"fill",color:"text","aria-label":P?u.i18n.translate("xpack.lens.formula.disableWordWrapLabel",{defaultMessage:"Disable word wrap"}):u.i18n.translate("xpack.lens.formulaEnableWordWrapLabel",{defaultMessage:"Enable word wrap"}),isSelected:!P,onClick:()=>{var e;null===(e=R.current)||void 0===e||e.updateOptions({wordWrap:P?"off":"on"}),_(!P)}}))),Object(x.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorHeaderGroup",grow:!1},Object(x.jsx)(b.EuiButtonEmpty,{onClick:()=>{m(),E(!g)},iconType:g?"fullScreenExit":"fullScreen",size:"xs",color:"text",flush:"right","data-test-subj":"lnsFormula-fullscreen"},g?u.i18n.translate("xpack.lens.formula.fullScreenExitLabel",{defaultMessage:"Collapse"}):u.i18n.translate("xpack.lens.formula.fullScreenEnterLabel",{defaultMessage:"Expand"}))))),Object(x.jsx)("div",{className:"lnsFormula__editorContent"},Object(x.jsx)(d.CodeEditor,i()({},Y,{options:{...Y.options,overflowWidgetsDomNode:L.current},editorDidMount:e=>{R.current=e;const t=e.getModel();t&&(A.current=t),D.current.push(e.onDidChangeModelContent((t=>{X(t,e)})))}})),I?null:Object(x.jsx)("div",{className:"lnsFormula__editorPlaceholder"},Object(x.jsx)(b.EuiText,{color:"subdued",size:"s"},u.i18n.translate("xpack.lens.formulaPlaceholderText",{defaultMessage:"Type a formula by combining functions with math, like:"})),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)("pre",null,"count() + 1"))),Object(x.jsx)("div",{className:"lnsFormula__editorFooter"},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"m",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorFooterGroup"},g?Object(x.jsx)(b.EuiToolTip,{content:C?u.i18n.translate("xpack.lens.formula.editorHelpInlineHideToolTip",{defaultMessage:"Hide function reference"}):u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"}),delay:"long",position:"top"},Object(x.jsx)(b.EuiLink,{"aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineHideLabel",{defaultMessage:"Hide function reference"}),className:"lnsFormula__editorHelp lnsFormula__editorHelp--inline",color:"text",onClick:()=>E(!C)},Object(x.jsx)(b.EuiIcon,{type:"documentation"}),Object(x.jsx)(b.EuiIcon,{type:C?"arrowDown":"arrowUp"}))):Object(x.jsx)(qr,{language:"Formula",sections:z,buttonProps:{color:"text",className:"lnsFormula__editorHelp lnsFormula__editorHelp--overlay","data-test-subj":"TextBasedLangEditor-documentation","aria-label":u.i18n.translate("xpack.lens.formula.editorHelpInlineShowToolTip",{defaultMessage:"Show function reference"})}})),q||H?Object(x.jsx)(b.EuiFlexItem,{className:"lnsFormula__editorFooterGroup",grow:!1},Object(x.jsx)(b.EuiPopover,{ownFocus:!1,isOpen:S,closePopover:()=>F(!1),button:Object(x.jsx)(b.EuiButtonEmpty,{color:q?"danger":"warning",className:"lnsFormula__editorError",iconType:"warning",size:"xs",flush:"right",onClick:()=>{F(!S)}},q?u.i18n.translate("xpack.lens.formulaErrorCount",{defaultMessage:"{count} {count, plural, one {error} other {errors}}",values:{count:q}}):null,H?u.i18n.translate("xpack.lens.formulaWarningCount",{defaultMessage:"{count} {count, plural, one {warning} other {warnings}}",values:{count:H}}):null)},Object(x.jsx)("div",{css:Lo},M.map((({message:e,severity:t},a)=>Object(x.jsx)("div",{key:a,className:"lnsFormula__warningText"},Object(x.jsx)(b.EuiText,{size:"s",color:t===$r.monaco.MarkerSeverity.Warning?"warning":"danger"},e))))))):null))),g&&C?Object(x.jsx)("div",{className:"lnsFormula__docs documentation__docs--inline"},Object(x.jsx)(Vr,{language:"Formula",sections:z})):null)))}function Ro(e){return"sourceField"in e}function Bo(e,t,a,n){var i;return Boolean((null===(i=n.find((({groupId:e})=>a===e)))||void 0===i?void 0:i.isBreakdownDimension)&&function(e,t){return Object.values(e.columns).some((e=>{var a;return Ro(e)&&(null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.timeSeriesMetric)}))}(e,t))}function No(e,t,a){var n,i;if(!a)return;const s=e.columns[t],{operationType:l}=s,r=l?Tp[l]:void 0,o=Ro(s)&&r?null!==(n=null==r||null===(i=r.getCurrentFields)||void 0===i?void 0:i.call(r,s))&&void 0!==n?n:[s.sourceField]:[],c=o.map((e=>a.getFieldByName(e))),d=c.filter(Boolean),p=Boolean(c.length>d.length||!("field"===(null==r?void 0:r.input)&&d.every((e=>null!=r.getPossibleOperationForField(e))))),m=Boolean(d.length&&!(null!=r&&r.isTransferable(s,a,Tp)));if(p){const e=c.map(((e,t)=>e?null:o[t])).filter(Boolean);if(e.length)return[zo(e,t)];if(m){var g,f;const e=null!==(g=null==r||null===(f=r.getNonTransferableFields)||void 0===f?void 0:f.call(r,s,a))&&void 0!==g?g:o;return[u.i18n.translate("xpack.lens.indexPattern.fieldsWrongType",{defaultMessage:"{count, plural, one {Field} other {Fields}} {invalidFields} {count, plural, one {is} other {are}} of the wrong type",values:{count:e.length,invalidFields:e.join(", ")}})]}}}const zo=(e,t)=>({message:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.fieldsNotFound",defaultMessage:"{count, plural, one {Field} other {Fields}} {missingFields} {count, plural, one {was} other {were}} not found.",values:{count:e.length,missingFields:Object(x.jsx)(l.a.Fragment,null,e.map(((t,a)=>Object(x.jsx)(s.Fragment,{key:t},Object(x.jsx)("strong",null,t),a+1===e.length?"":", "))))}}),displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t},{id:"embeddableBadge"}]});function Vo(e){const t=e.filter(Boolean).flat();return t.length?t:void 0}function Go(e,t){const a=null==t?void 0:t.getFieldByName(e);return a?a.displayName:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})}function qo(e,t,a,n,i=2){const s=Number(e);return""!==e&&null!=e&&!Number.isNaN(s)&&Number.isFinite(s)&&(!t||Number.isInteger(s))&&(void 0===a||s<=a)&&(void 0===n||s>=n)&&function(e,t){const[,a=""]=`${e}`.split(".");return a.length<=t}(e,t?0:i)}function Ho(e,t){return t.operationType===e}const Uo=e=>"operationType"in e;function $o(e){return Boolean("params"in e&&e.params&&"format"in e.params)}function Wo(e){return"number"===(null==e?void 0:e.dataType)&&$o(e)&&e.params?{format:e.params.format}:void 0}function Xo(e,t=!0){return{query:t?`"${e}": *`:`${e}: *`,language:"kuery"}}function Yo(e,t){return Object(qt.isEqual)(e,Xo(t))||Object(qt.isEqual)(e,Xo(t,!1))}function Qo(e,t){let a=null==e?void 0:e.filter;if(!(e&&Ho("last_value",e)&&Yo(a,e.sourceField))){var n;if(t)if("kql"in t)a={query:null!==(n=t.kql)&&void 0!==n?n:"",language:"kuery"};else if("lucene"in t){var i;a={query:null!==(i=t.lucene)&&void 0!==i?i:"",language:"lucene"}}return a}}function Ko({sourceField:e,operationType:t}){return!e||"count"===t&&e===It.DOCUMENT_FIELD_NAME?"":ir.test(e)?`'${e.replaceAll("'","\\'")}'`:e}const Zo=u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"}),Jo={type:"formula",displayName:Zo,getDefaultLabel:e=>{var t;return null!==(t=e.params.formula)&&void 0!==t?t:Zo},input:"managedReference",hidden:!0,filterable:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaFilterableHelpText",{defaultMessage:"The provided filter will be applied to the entire formula."})},canReduceTimeRange:{helpMessage:u.i18n.translate("xpack.lens.indexPattern.formulaCanReduceTimeRangeHelpText",{defaultMessage:"Applies to the entire formula."})},getDisabledStatus(e){},getErrorMessage(e,t,a,n,i,s){const l=e.columns[t];if(!l.params.formula||!i)return;const r=mr(i),{root:o,error:c}=jr(l.params.formula,r);if(c||null==o)return null!=c&&c.message?[c.message]:[];const d=Or(o,e,a,r,l,n);if(d.length)return Object(qt.uniqBy)(d,(({message:e})=>e)).map((({type:e,message:a,extraInfo:n})=>"missingField"===e&&null!=n&&n.missingFields?zo(n.missingFields,t):a));const p=Ru(t,e.columns),m=[...p.flatMap((([t,i])=>{const l=r[i.operationType];return null!=l&&l.getErrorMessage&&l.getErrorMessage(e,t,a,n,r,s)||[]})).filter(st.nonNullable).reduce(((e,t)=>(e.add(t),e)),new Set)],g=e.columnOrder.some((t=>e.columns[t].isBucketed)),f=e.columnOrder.some((t=>{const a=e.columns[t];return!a.isBucketed&&!a.isStaticValue&&"math"!==a.operationType&&"formula"!==a.operationType})),b=!d.length&&p.length;return g&&!f&&b&&m.push({message:u.i18n.translate("xpack.lens.indexPattern.noRealMetricError",{defaultMessage:"A layer with only static values will not show results, use at least one dynamic metric"})}),m.length?m:void 0},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,s=n.label!==Zo,l=null!=i&&i.isFormulaBroken?Zo:s?n.label:null!==(a=null==i?void 0:i.formula)&&void 0!==a?a:Zo;return[{type:"function",function:n.references.length?"mathColumn":"mapColumn",arguments:{id:[t],name:[l||Zo],...n.references.length?{castColumns:[n.references[0]]}:{},expression:[n.references.length?`"${n.references[0]}"`:""]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){let s="";e&&(s=function(e,t,a,n){if(Ho("static_value",e)&&e.params&&"value"in e.params)return String(e.params.value);if("references"in e){const n=t.columns[e.references[0]];if(n&&"sourceField"in n&&"number"===n.dataType){const t=Ko(n);a+=`${e.operationType}(${n.operationType}(${t})`}}else{if(!e||!("sourceField"in e)||"number"!==e.dataType&&"date"!==e.dataType)return"";a+=`${e.operationType}(${Ko(e)}`}const i=function(e,t){if(!t)return[];const a=t[e.operationType];return"operationParams"in a&&(n=e,Boolean("params"in n&&n.params))?(a.operationParams||[]).flatMap((({name:t,required:a})=>{const n=e.params[t];return Object(qt.isObject)(n)?Object.keys(n).map((e=>({name:`${t}-${e}`,value:n[e],required:a}))):{name:t,value:n,required:a}})):[];var n}(e,n);return i.length&&(a+=", "+i.map((({name:e,value:t})=>`${e}=${t}`)).join(", ")),e.filter&&(("count"!==e.operationType||"sourceField"in e&&e.sourceField!==It.DOCUMENT_FIELD_NAME)&&(a+=", "),a+=("kuery"===e.filter.language?"kql=":"lucene=")+`'${e.filter.query.replace(/'/g,"\\'")}'`),e.timeShift&&(("count"!==e.operationType||"sourceField"in e&&e.sourceField!==It.DOCUMENT_FIELD_NAME||e.filter)&&(a+=", "),a+=`shift='${e.timeShift}'`),e.reducedTimeRange&&(("count"!==e.operationType||e.filter||e.timeShift)&&(a+=", "),a+=`reducedTimeRange='${e.reducedTimeRange}'`),a&&(a+=")"),a}(e,t,s,i));let l={};var r;e&&$o(e)&&(l={format:null===(r=e.params)||void 0===r?void 0:r.format}),null!=n&&n.format&&(l={format:n.format});const o="formula"===(null==e?void 0:e.operationType);return{label:s||Zo,dataType:"number",operationType:"formula",isBucketed:!1,scale:"ratio",params:s?{formula:s,isFormulaBroken:!1,...l,...null!=n&&n.formula?{formula:null==n?void 0:n.formula}:{}}:{...l,...null!=n&&n.formula?{formula:null==n?void 0:n.formula}:{}},references:[],filter:o?Qo(e,n):void 0,reducedTimeRange:o?e.reducedTimeRange:void 0,timeScale:null==e?void 0:e.timeScale}},isTransferable:()=>!0,createCopy(e,t,a,n){const i=e[t.layerId].columns[t.columnId],s=Fo(a.columnId,i,e[a.layerId],{indexPattern:a.dataView,operations:n});return{...e,[a.layerId]:s.layer}},timeScalingMode:"optional",paramEditor:({activeData:e,...t})=>{const a=Zr(t.data.datatableUtilities,t.layer,t.indexPattern,e,t.layerId);return Object(x.jsx)(_o,i()({},t,{dateHistogramInterval:a,hasData:Po(e,t.layerId,t.columnId)}))}};function eu(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(qt.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}const tu=iu({type:"time_range",label:"Time range",description:u.i18n.translate("xpack.lens.formula.timeRange.help",{defaultMessage:"The specified time range, in milliseconds (ms)."}),getExpressionFunction:e=>Object(V.buildExpressionFunction)("formula_time_range",{}),getErrorMessage:function(e,t,a,n){const i=[];return a.timeFieldName||i.push(u.i18n.translate("xpack.lens.indexPattern.dateRange.dataViewNoTimeBased",{defaultMessage:"The current dataView is not time based"})),n||i.push(u.i18n.translate("xpack.lens.indexPattern.dateRange.noTimeRange",{defaultMessage:"The current time range interval is not available"})),i.length?i:void 0}}),au=iu({type:"now",label:"Current now",description:u.i18n.translate("xpack.lens.formula.now.help",{defaultMessage:"The current now moment used in Kibana expressed in milliseconds (ms)."}),getExpressionFunction:e=>Object(V.buildExpressionFunction)("formula_now",{}),getErrorMessage:function(){}}),nu=iu({type:"interval",label:"Date histogram interval",description:u.i18n.translate("xpack.lens.formula.interval.help",{defaultMessage:"The specified minimum interval for the date histogram, in milliseconds (ms)."}),getExpressionFunction:({targetBars:e})=>Object(V.buildExpressionFunction)("formula_interval",{targetBars:e}),getErrorMessage:function(e,t,a,n,i,s){const l=[];return s||l.push(u.i18n.translate("xpack.lens.indexPattern.interval.noTargetBars",{defaultMessage:'Missing "{uiSettingVar}" value',values:{uiSettingVar:ca.UI_SETTINGS.HISTOGRAM_BAR_TARGET}})),n||l.push(u.i18n.translate("xpack.lens.indexPattern.interval.noTimeRange",{defaultMessage:"The current time range interval is not available"})),Object.values(e.columns).some((e=>function(e,t){return"date_histogram"===t.operationType}(0,e)))||l.push(u.i18n.translate("xpack.lens.indexPattern.interval.noDateHistogramColumn",{defaultMessage:"Cannot compute an interval without a date histogram column configured"})),l.length?l:void 0}});function iu({label:e,type:t,getExpressionFunction:a,getErrorMessage:n,description:i}){return{type:t,displayName:e,input:"managedReference",selectionStyle:"hidden",usedInMath:!0,getDefaultLabel:()=>e,isTransferable:()=>!0,getDisabledStatus(){},getErrorMessage:n,getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),buildColumn:()=>({label:e,dataType:"number",operationType:t,isBucketed:!1,scale:"ratio",references:[]}),toExpression:(e,t,n,i={})=>{const s=e.columns[t];return[Object(V.buildExpressionFunction)("mathColumn",{id:t,name:s.label,expression:Object(V.buildExpression)([a(i)])}).toAst()]},createCopy(e,t,a){const n=e[t.layerId].columns[t.columnId],i=e[a.layerId],s={...i.columns,[a.columnId]:{...n}};return{...e,[a.layerId]:{...i,columns:s,columnOrder:eu({...i,columns:s})}}},documentation:{section:"constants",signature:"",description:i}}}function su({layers:e,source:t,target:a}){return function(e,t,a){const n=e[a.layerId],i=n.columns[a.columnId],s=e[t.layerId];let l={...s.columns};if("references"in i){const s=Tp[i.operationType];if("createCopy"in s)return s.createCopy(e,a,t,Tp);const r=i.references.reduce(((e,t)=>({...e,[Object(nt.a)()]:{...n.columns[t]}})),{});l={...l,...r,[t.columnId]:{...i,references:Object.keys(r)}}}else l={...l,[t.columnId]:{...i}};return{...e,[t.layerId]:ju({...s,columns:l,columnOrder:ku({...s,columns:l})})}}(e,a,t)}function lu(e){return e.layer.columns[e.columnId]?pu(e):cu(e)}function ru(e,t,a){const n={...e};return t.filterable&&(n.filter=a.filter),t.shiftable&&(n.timeShift=a.timeShift),"disabled"!==t.timeScalingMode&&(n.timeScale=a.timeScale),n}const ou=({layer:e,references:t,requiredReferences:a,indexPattern:n,visualizationGroups:i,targetGroup:s})=>{t.forEach((e=>{if(!a.filter((t=>_u({validation:t,operationType:e.op,indexPattern:n}))).length)throw new Error(`Can't create reference, ${e.op} has a validation function which doesn't allow any operations`)}));const l=[];return t.forEach((t=>{const a=Tp[t.op];if("none"===a.input)return e=cu({layer:e,columnId:t.columnId,op:a.type,indexPattern:n,columnParams:{...t.columnParams},incompleteParams:t.incompleteParams,initialParams:t.initialParams,...t.references?{references:t.references}:{},visualizationGroups:i,targetGroup:s}),void l.push(t.columnId);const r="field"===a.input&&t.field&&a.getPossibleOperationForField(t.field)?t.field:void 0;return r?(e=cu({layer:e,columnId:t.columnId,op:a.type,indexPattern:n,field:r,incompleteParams:t.incompleteParams,initialParams:t.initialParams,columnParams:{...t.columnParams},visualizationGroups:i,targetGroup:s}),void l.push(t.columnId)):void 0})),{layer:e,referenceIds:l}},uu=({op:e,incompleteFieldOperation:t,incompleteFieldName:a,columnParams:n,layer:i,requiredReferences:s,indexPattern:l,visualizationGroups:r,targetGroup:o})=>{const u=s.map((s=>{const u=Object.values(Tp).filter((({type:e})=>_u({validation:s,operationType:e,indexPattern:l})));if(!u.length)throw new Error(`Can't create reference, ${e} has a validation function which doesn't allow any operations`);const c=Object(nt.a)();if(t&&a){var d;const e=l.fields.filter((e=>e.name===a));i=cu({layer:i,columnId:c,op:t,indexPattern:l,field:null!==(d=e[0])&&void 0!==d?d:Co.a,visualizationGroups:r,columnParams:n,targetGroup:o})}if(1===u.length){const e=u[0];let t="field"===e.input?l.fields.filter(e.getPossibleOperationForField):[];a&&(t=t.filter((e=>e.name===a))),i="none"===e.input?cu({layer:i,columnId:c,op:e.type,indexPattern:l,visualizationGroups:r,targetGroup:o}):1===t.length?cu({layer:i,columnId:c,op:e.type,indexPattern:l,field:t[0],visualizationGroups:r,targetGroup:o}):{...i,incompleteColumns:{...i.incompleteColumns,[c]:{operationType:e.type}}}}return c}));return{layer:i,referenceIds:u}};function cu({op:e,layer:t,columnId:a,field:n,indexPattern:i,visualizationGroups:s,targetGroup:l,incompleteParams:r,incompleteFieldName:o,incompleteFieldOperation:u,columnParams:c,initialParams:d,references:p,respectOrder:m}){var g,f;const b=Tp[e];if(!b)throw new Error("No suitable operation found for given parameters");if(t.columns[a])throw new Error("Can't insert a column with an ID that is already in use");const v={indexPattern:i,previousColumn:{...r,...d,...t.columns[a]}};if("none"===b.input||"managedReference"===b.input){if(n)throw new Error(`Can't create operation ${e} with the provided field ${n.name}`);b.input;const r=b.getPossibleOperation(i);return Au((Boolean(null==r?void 0:r.isBucketed)?bu:hu)(t,c?b.buildColumn({...v,layer:t},c):b.buildColumn({...v,layer:t}),a,s,l,m),i)}if("fullReference"===b.input){if(n)throw new Error("Reference-based operations can't take a field as input when creating");let r={...t},d=[];if(p){const e=ou({layer:r,references:p,requiredReferences:b.requiredReferences,indexPattern:i,visualizationGroups:s,targetGroup:l});[r,d]=[e.layer,e.referenceIds]}else{const t=uu({op:e,incompleteFieldName:o,incompleteFieldOperation:u,columnParams:c,layer:r,requiredReferences:b.requiredReferences,indexPattern:i,visualizationGroups:s,targetGroup:l});[r,d]=[t.layer,t.referenceIds]}const g=b.getPossibleOperation(i);if(!g)throw new Error(`Can't create operation ${e} because it's incompatible with the data view`);return Au((Boolean(g.isBucketed)?bu:hu)(r,c?b.buildColumn({...v,layer:r,referenceIds:d},c):b.buildColumn({...v,layer:r,referenceIds:d}),a,s,l,m),i)}const h=null===(g=(null!==(f=t.incompleteColumns)&&void 0!==f?f:{})[a])||void 0===g?void 0:g.sourceField,x=h?i.getFieldByName(h):void 0;if(!n&&x){const e=b.getPossibleOperationForField(x);if(!e)throw new Error(`Tried to create an invalid operation ${b.type} using previously selected field ${x.name}`);return Au(Boolean(e.isBucketed)?bu(t,b.buildColumn({...v,layer:t,field:x}),a,s,l,m):hu(t,b.buildColumn({...v,layer:t,field:x}),a),i)}var y;if(!n)return{...t,incompleteColumns:{...null!==(y=t.incompleteColumns)&&void 0!==y?y:{},[a]:{operationType:e}}};const j=b.getPossibleOperationForField(n);var O;if(!j)return{...t,incompleteColumns:{...null!==(O=t.incompleteColumns)&&void 0!==O?O:{},[a]:{operationType:e,sourceField:n.name}}};const I=b.buildColumn({...v,layer:t,field:n},c);return Au((Boolean(j.isBucketed)?bu:hu)(t,I,a,s,l,m),i)}function du({operationDefinition:e,layer:t,previousColumn:a,indexPattern:n,previousDefinition:i,columnId:s},{shouldResetLabel:l}){const r={columns:t.columns,previousColumn:a,indexPattern:n};let o=t;const u=e.buildColumn({...r,layer:o},"params"in a?a.params:void 0,Tp);"fullReference"===i.input&&a.references.forEach((e=>{o=Iu({layer:o,columnId:e,indexPattern:n})}));const c={...o,columns:{...o.columns,[s]:u}};let d;try{d=u.params.formula?Fo(s,u,c,{indexPattern:n}).layer:c}catch(e){d=c}const p=d.columns[s];return!l&&a.customLabel&&(p.customLabel=!0,p.label=a.label),Au(Ou({...o,columnOrder:ku(d),columns:d.columns},s),n)}function pu({layer:e,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:s,initialParams:l,shouldResetLabel:r,shouldCombineField:o}){const u=e.columns[t];if(!u)throw new Error("Can't replace column because there is no prior column");const c=n!==u.operationType,d=Tp[n],p=Tp[u.operationType];if(!d)throw new Error("No suitable operation found for given parameters");const m={columns:e.columns,indexPattern:a,previousColumn:u};if(c){let l={...e};if(l=Lu(l,t),"managedReference"===p.input&&d.input!==p.input){l=mu(p,u,l,a);const o=cu({layer:l,columnId:t,indexPattern:a,op:n,field:i,visualizationGroups:s,incompleteParams:u});return!r&&u.customLabel&&o.columns[t]&&u.label!==p.getDefaultLabel(u,l.columns,a)&&(o.columns[t].customLabel=!0,o.columns[t].label=u.label),o.incompleteColumns&&o.incompleteColumns[t]?{...e,incompleteColumns:o.incompleteColumns}:o}if("fullReference"===d.input)return function({layer:e,columnId:t,previousColumn:a,op:n,indexPattern:i,visualizationGroups:s}){const l=Tp[n];if("fullReference"!==l.input)throw new Error("Requirements for transitioning are not met");let r=!1,o=!1;const u="references"in a?[...a.references]:[],c=l.requiredReferences.map((t=>{const n=Object(nt.a)();if(u.length){const a=e.columns[u[0]];if(Du({validation:t,column:a}))return u.shift()}if(!r&&Du({validation:t,column:a})){r=!0;const t={...e,columns:{...e.columns,[n]:{...a,filter:l.filterable?void 0:a.filter,timeShift:l.shiftable?void 0:a.timeShift}}};return e=Au(Ou({...t,columnOrder:ku(t)},n),i),n}if(t.input.includes("none")){const a=kp.filter((e=>{if("none"===e.input)return _u({validation:t,operationType:e.type,indexPattern:i})}));if(1===a.length)return e=cu({layer:e,columnId:n,op:a[0].type,indexPattern:i,visualizationGroups:s}),n}if(!o&&"sourceField"in a&&t.input.includes("field")){const l=i.getFieldByName(a.sourceField),r=kp.filter((e=>"field"===e.input&&_u({validation:t,operationType:e.type,indexPattern:i}))).sort(Cp(l)),u=r.filter((e=>{if(l)return _u({validation:t,operationType:e.type,field:l,indexPattern:i})}));if(u.length>0)return o=!0,e=cu({layer:e,columnId:n,op:u[0].type,indexPattern:i,field:i.getFieldByName(a.sourceField),visualizationGroups:s}),n;if(1===r.length)return o=!0,e={...e,incompleteColumns:{...e.incompleteColumns,[n]:{operationType:r[0].type}}},n}if(u.length){const a=e.columns[u[0]];if(a&&"sourceField"in a&&t.input.includes("field")){const l=i.getFieldByName(a.sourceField);if(l){const a=kp.filter((e=>"field"===e.input&&_u({validation:t,operationType:e.type,field:l,indexPattern:i}))).sort(Cp(l));if(a.length>0)return e=cu({layer:e,columnId:n,op:a[0].type,indexPattern:i,field:l,visualizationGroups:s}),n}}}return n}));return u.length&&u.forEach((t=>{e=Iu({layer:e,columnId:t,indexPattern:i})})),e={...e,columns:{...e.columns,[t]:l.buildColumn({indexPattern:i,layer:e,referenceIds:c,previousColumn:a})}},Au(Ou({...e,columnOrder:ku(e)},t),i)}({layer:l,columnId:t,previousColumn:u,op:n,indexPattern:a,visualizationGroups:s});if("fullReference"===p.input&&1===u.references.length){const s=u.references[0],r=e.columns[s];if(r){const e=Tp[r.operationType];if(e.type===n){l=Iu({layer:l,columnId:s,indexPattern:a});const n=ru(fu({...r},u),e,u);return l={...l,columnOrder:ku(l),columns:{...l.columns,[t]:n}},Au(Ou(l,t),a)}if(!i&&"sourceField"in r&&"field"===e.input&&"field"===d.input){const e=a.getFieldByName(r.sourceField);e&&d.getPossibleOperationForField(e)&&(i=e)}}}if("managedReference"===d.input)return du({operationDefinition:d,layer:l,previousColumn:u,indexPattern:a,previousDefinition:p,columnId:t},{shouldResetLabel:r});if("none"===d.input){let e=d.buildColumn({...m,layer:l});e=fu(e,u),l=mu(p,u,l,a);const n={...l,columns:{...l.columns,[t]:e}};return Au(Ou({...n,columnOrder:ku(n)},t),a)}if(!i){var g;let a={operationType:n};if("fullReference"===p.input){const t=u.references[0],n=e.columns[t];n&&(a=ru(a,Tp[n.operationType],u))}return{...l,incompleteColumns:{...null!==(g=l.incompleteColumns)&&void 0!==g?g:{},[t]:a}}}var f;if(!d.getPossibleOperationForField(i))return{...l,incompleteColumns:{...null!==(f=l.incompleteColumns)&&void 0!==f?f:{},[t]:{operationType:n}}};l=mu(p,u,l,a);let o=d.buildColumn({...m,layer:l,field:i});r||(o=fu(o,u));const c={...l,columns:{...l.columns,[t]:o}};return Au(Ou({...c,columnOrder:ku(c)},t),a)}if("field"===d.input&&i&&"sourceField"in u&&(u.sourceField!==i.name||null!=d&&d.getParamsForMultipleFields)){let n=d.onFieldChange(u,i,o?null==l?void 0:l.params:void 0);r||(n=fu(n,u));const s=Lu({...e,columns:{...e.columns,[t]:n}},t);return Au(Ou({...s,columnOrder:ku(s)},t),a)}if("managedReference"===d.input)return du({operationDefinition:d,layer:e,previousColumn:u,indexPattern:a,previousDefinition:p,columnId:t},{shouldResetLabel:r});throw new Error("nothing changed")}function mu(e,t,a,n){let i=a;if("managedReference"===e.input){const[e]=Object.entries(a.columns).find((([e,a])=>a===t))||[];null!=e&&(i=Iu({layer:a,columnId:e,indexPattern:n}))}return"fullReference"===e.input&&t.references.forEach((e=>{i=Iu({layer:a,columnId:e,indexPattern:n})})),i}function gu({layer:e,columnId:t,op:a,field:n,indexPattern:i,filterOperations:s,visualizationGroups:l,dateRange:r}){const o=e.columns[t];if(!o)return!0;if(o.operationType===a)return!0;try{var u,c,d;const o=pu({layer:e,columnId:t,op:a,field:n,indexPattern:i,visualizationGroups:l}),p=Tp[a],m=o.columns[t];return Boolean(m)&&!(null!==(u=o.incompleteColumns)&&void 0!==u&&u[t])&&s(m)&&!(null!==(c=p.getErrorMessage)&&void 0!==c&&null!==(d=c.call(p,o,t,i,r))&&void 0!==d&&d.length)}catch(e){return!1}}function fu(e,t){const a={...e},n=e.operationType!==t.operationType,i=("sourceField"in e&&e.sourceField)!==("sourceField"in t&&t.sourceField);return!t.customLabel||n&&i||(a.customLabel=!0,a.label=t.label),a}function bu(e,t,a,n,i,s){const[l,r]=Object(qt.partition)(e.columnOrder,(t=>e.columns[t].isBucketed)),o=e.columnOrder.findIndex((t=>"date_histogram"===e.columns[t].operationType));let u=[];u=o>-1&&"terms"===t.operationType&&!s?[...l.slice(0,o),a,...l.slice(o,l.length),...r]:[...l,a,...r],u=vu(n,u,i,a);const c={...Lu(e,a),columns:{...e.columns,[a]:t},columnOrder:u};return Ou({...c,columnOrder:ku(c)},a)}function vu(e,t,a,n){var i;if(a&&(null===(i=e.find((e=>e.groupId===a)))||void 0===i?void 0:i.hideGrouping)){const i=[...e];i.sort(((e,t)=>void 0===typeof e.nestingOrder?-1:void 0===typeof t.nestingOrder?1:e.nestingOrder-t.nestingOrder));const s={};return t.forEach((e=>{const l=i.findIndex((t=>e===n&&t.groupId===a||t.accessors.some((t=>t.columnId===e))));s[e]=-1!==l?l:t.length})),[...t].sort(((e,t)=>s[e]-s[t]))}return t}function hu(e,t,a){const n={...Lu(e,a),columns:{...e.columns,[a]:t}};return Ou({...n,columnOrder:ku(n)},a)}function xu(e){return kp.sort(Cp(e)).filter((t=>{if("field"!==t.input)return;const a=t.getPossibleOperationForField(e);return a&&!a.isBucketed&&"number"===a.dataType}))}function yu({layer:e,columnId:t,paramName:a,value:n}){const i=e.columns[t];return{...e,columns:{...e.columns,[t]:{...i,params:{..."params"in i?i.params:{},[a]:n}}}}}function ju(e){const t={...e.columns};return Object.keys(t).forEach((a=>{const n=t[a];if(null!=n&&n.operationType){const i=Tp[n.operationType];t[a]=i.onOtherColumnChanged?i.onOtherColumnChanged({...e,columns:t},a):n}})),{...e,columns:t}}function Ou(e,t){const a={...e.columns};return Object.keys(a).forEach((n=>{if(n!==t){const t=a[n],i=Tp[t.operationType];a[n]=i.onOtherColumnChanged?i.onOtherColumnChanged({...e,columns:a},n):t}})),{...e,columns:a}}function Iu({layer:e,columnId:t,indexPattern:a}){const n=e.columns[t];if(!n){const a={...e.incompleteColumns||{}};return delete a[t],{...e,columnOrder:e.columnOrder.filter((e=>e!==t)),incompleteColumns:a}}const i="references"in n?n.references:[],s={...e.columns};delete s[t];let l=Ou({...e,columns:s},t);i.forEach((e=>{l=Iu({layer:l,columnId:e,indexPattern:a})}));const r={...l.incompleteColumns||{}};return delete r[t],Au({...l,columnOrder:ku(l),incompleteColumns:r},a)}function ku(e){const t=Object.entries(e.columns);t.sort((([t],[a])=>{const n=e.columnOrder.indexOf(t),i=e.columnOrder.indexOf(a);return n>-1&&i>-1?n-i:n>-1?-1:1}));const[a,n]=Object(qt.partition)(t,(([,e])=>e.isBucketed));return a.map((([e])=>e)).concat(n.map((([e])=>e)))}function Tu(e){const[t,a]=Object(qt.partition)(e.columnOrder,(t=>e.columns[t]&&!("references"in e.columns[t])));return[...Object(qt.partition)(t,(t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.isBucketed})),a]}function Mu(e,t,a){return Tp[e.operationType].isTransferable(e,t,Tp)&&(!("references"in e)||e.references.every((e=>Mu(a.columns[e],t,a))))}function wu(e,t){const a=Object(qt.pickBy)(e.columns,(a=>Mu(a,t,e))),n=Object(qt.mapValues)(a,(e=>{const a=Tp[e.operationType];return a.transfer?a.transfer(e,t):e})),i=e.columnOrder.filter((e=>n[e]));return{...e,indexPatternId:t.id,columns:n,columnOrder:i}}function Cu(e,t){return Object.values(e.columns).flatMap((e=>"references"in e?e.references:[])).includes(t)}const Eu=ar()((e=>{const t={};for(const[a,n]of Object.entries(e.columns))if("references"in n)for(const e of n.references)t[e]=a;return t}));function Su(e,t){const a=Eu(e);let n=t;for(;Cu(e,n);)n=a[n];return n}function Fu(e,t){const a=[];return function t(n){const i=e.columns[n];if(i&&"references"in i){const n=i.references.filter((t=>Boolean(e.columns[t])));a.push(...n),n.forEach(t)}}(t),a}function Pu(e){return e.columnOrder.some((t=>{const a=e.columns[t];if(a)return Ho("terms",a)&&a.params.size>5}))}function _u({operationType:e,validation:t,field:a,indexPattern:n}){const i=Tp[e];let s=!0;if(a&&"field"===i.input){const n=i.getPossibleOperationForField(a);s=Boolean(n)&&t.validateMetadata(n,e,a.name)}else if("none"===i.input){const a=i.getPossibleOperation(n);s=Boolean(a)&&t.validateMetadata(a,e)}else if("fullReference"===i.input){const a=i.getPossibleOperation(n);s=Boolean(a)&&t.validateMetadata(a,e)}return t.input.includes(i.input)&&(!t.specificOperations||t.specificOperations.includes(e))&&s}function Au(e,t){const a={...e.columns};return e.columnOrder.forEach((e=>{const n=a[e];n.customLabel||(a[e]={...n,label:Tp[n.operationType].getDefaultLabel(n,a,t)})})),{...e,columns:a}}function Lu(e,t){var a;const n={...null!==(a=e.incompleteColumns)&&void 0!==a?a:{}};return delete n[t],{...e,incompleteColumns:n}}function Du({column:e,validation:t}){if(!e)return!1;const a=e.operationType,n=Tp[a];if(!n)throw new Error("No suitable operation definition found for "+a);return t.input.includes(n.input)&&function({column:e,validation:t}){return!t.specificOperations||"managedReference"===Tp[e.operationType].input||t.specificOperations.includes(e.operationType)}({column:e,validation:t})&&t.validateMetadata(e,a,"sourceField"in e?e.sourceField:void 0)}function Ru(e,t){const a={};Object.entries(t).forEach((([e,t])=>{a[e]="references"in t?[...t.references]:[]}));const n=a[e],i=[];for(;n.length>0;){const e=n.shift();i.push([e,t[e]]),n.push(...a[e])}return i.filter((([,e])=>e))}const Bu=({value:e,onChange:t,minValue:a=1,maxValue:n=1e4,label:i=u.i18n.translate("xpack.lens.indexPattern.terms.size",{defaultMessage:"Number of values"}),disabled:l})=>{const[r,o]=Object(s.useState)(String(e));Object(k.s)((()=>{if(""===r)return;const e=Number(r);t(Math.min(n,Math.max(e,a)))}),{skipFirstRender:!0},256,[r]);const c=""===r,d=!c&&Number(r)>n,p=!c&&Number(r)<a;return Object(x.jsx)(b.EuiFormRow,{label:i,display:"rowCompressed",fullWidth:!0,isInvalid:d||p,error:d?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMax",{defaultMessage:"Value is higher than the maximum {max}, the maximum value is used instead.",values:{max:n}})]:p?[u.i18n.translate("xpack.lens.indexPattern.terms.sizeLimitMin",{defaultMessage:"Value is lower than the minimum {min}, the minimum value is used instead.",values:{min:a}})]:null},Object(x.jsx)(b.EuiFieldNumber,{fullWidth:!0,min:a,max:n,step:1,value:r,compressed:!0,isInvalid:d||p,disabled:l,onChange:({currentTarget:e})=>o(e.value),"aria-label":i,onBlur:()=>{if(""===r)return o(String(e));const t=Number(r);o(String(Math.min(n,Math.max(t,a))))},"data-test-subj":"indexPattern-terms-values"}))};var Nu=a(565),zu=a(544),Vu=a(545),Gu=(a(376),a(115)),qu=a(543),Hu=a(528);function Uu({currentIndexPattern:e,incompleteOperation:t,selectedOperationType:a,selectedField:n,operationByField:i,onChoose:l,onDeleteColumn:r,fieldIsInvalid:o,markAllFieldsCompatible:c,"data-test-subj":d,showTimeSeriesDimensions:p}){var m,g;const{hasFieldData:f}=Object(Gu.b)(),b=Object(s.useMemo)((()=>{const n=[...i.keys()].sort(),s=null!=t?t:a;function l(e){return!s||i.get(e).has(s)}const[r,o]=Object(qt.partition)(n,(t=>{var a;return"document"===(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.type)}));function d(t){return Object(k.o)(t,e,f)}function m(t){return t.filter((t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.displayName})).map((t=>{var a,n;const r=c||l(t)?1:0,o=d(t),u=e.getFieldByName(t);return{label:null!==(a=null===(n=e.getFieldByName(t))||void 0===n?void 0:n.displayName)&&void 0!==a?a:t,value:{type:"field",field:t,dataType:u?Object(Hu.a)(u):void 0,operationType:s&&l(t)?s:i.get(t).values().next().value},exists:o,compatible:r,"data-test-subj":`lns-fieldOption${r?"":"Incompatible"}-${t}`}})).sort(((e,t)=>t.compatible-e.compatible))}const[g,b]=Object(qt.partition)(o,(t=>{var a;return null===(a=e.getFieldByName(t))||void 0===a?void 0:a.meta})),[v,h]=Object(qt.partition)(b,d),x=(e,t)=>e.length>0&&{label:t,options:m(e)},y=t=>{var a;return p&&(null===(a=e.getFieldByName(t))||void 0===a?void 0:a.timeSeriesDimension)},[j,O]=Object(qt.partition)(v,y),[I,T]=Object(qt.partition)(h,y),M=x(j.concat(I),u.i18n.translate("xpack.lens.indexPattern.timeSeriesFieldsLabel",{defaultMessage:"Time series dimensions"})),w=x(O,u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"})),C=x(T,u.i18n.translate("xpack.lens.indexPattern.emptyFieldsLabel",{defaultMessage:"Empty fields"})),E=x(g,u.i18n.translate("xpack.lens.indexPattern.metaFieldsLabel",{defaultMessage:"Meta fields"}));return[...m(r),M,w,C,E].filter(Boolean)}),[i,t,a,e,f,c,p]);return Object(x.jsx)(qu.a,{selectedOptions:a&&n?[{label:null!==(m=a&&n&&(null===(g=e.getFieldByName(n))||void 0===g?void 0:g.displayName))&&void 0!==m?m:n,value:{type:"field",field:n}}]:[],options:b,onChoose:e=>{e&&e.field!==n&&l(e)},onDelete:r,fieldIsInvalid:Boolean(t||o),"data-test-subj":null!=d?d:"indexPattern-dimension-field"})}const $u=1,Wu=new Set(["string","boolean","number","ip"]),Xu=1e3,Yu=Object(b.htmlIdGenerator)(),Qu=3;function Ku(e){return null!=e.value}function Zu({column:e,onChange:t,indexPattern:a,operationSupportMatrix:n,invalidFields:i,showTimeSeriesDimensions:r}){const o=Object(s.useCallback)((e=>t(e.filter(Ku).map((({value:e})=>e)))),[t]),{wrappedValues:c,rawValuesLookup:d}=Object(s.useMemo)((()=>{var t;const a=e?[e.sourceField,...(null===(t=e.params)||void 0===t?void 0:t.secondaryFields)||[]]:[];return{wrappedValues:a.map((e=>({id:Yu(),value:e}))),rawValuesLookup:new Set(a)}}),[e]),{inputValue:p,handleInputChange:m}=Object(Z.a)({onChange:o,value:c}),g=Object(s.useCallback)(((e,t=0)=>{const n=[...p];a.getFieldByName(e.field)&&(n[t]={id:Yu(),value:e.field},m(n))}),[p,a,m]),f=1===p.length||p.filter((({isNew:e})=>!e)).length<2,b=p.filter((({isNew:e})=>!e));return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Nu.a,{onDragEnd:e=>{m(e)},droppableId:"TOP_TERMS_DROPPABLE_AREA",items:p,bgColor:"subdued"},p.map((({id:t,value:s,isNew:l},o,c)=>{var v;const h=[...n.operationByField.keys()].filter((e=>{if(e===s)return!0;const t=a.getFieldByName(e);return 0===o?!d.has(e)&&t&&Wu.has(t.type):!d.has(e)&&t&&!t.scripted&&Wu.has(t.type)})).reduce(((e,t)=>{const a=n.operationByField.get(t);return a&&e.set(t,a),e}),new Map),y=Boolean(s&&((null===(v=a.getFieldByName(s))||void 0===v?void 0:v.scripted)&&b.length>1||(null==i?void 0:i.includes(s)))),j=(null!=s?s:"newField")+t;return Object(x.jsx)(Nu.b,{id:j,key:j,idx:o,onRemoveClick:()=>{m(c.filter(((e,t)=>t!==o)))},removeTitle:u.i18n.translate("xpack.lens.indexPattern.terms.deleteButtonLabel",{defaultMessage:"Delete"}),isNotRemovable:f&&!l,isNotDraggable:c.length<2,"data-test-subj":"indexPattern-terms",Container:zu.a,isInsidePanel:!0},Object(x.jsx)(Uu,{fieldIsInvalid:y,currentIndexPattern:a,operationByField:h,selectedOperationType:e.operationType,selectedField:s,autoFocus:l,onChoose:e=>{g(e,o)},isInvalid:y,"data-test-subj":1!==p.length?`indexPattern-dimension-field-${o}`:void 0,showTimeSeriesDimensions:p.length<2&&r}))}))),Object(x.jsx)(Vu.a,{onClick:()=>{m([...p,{id:Yu(),value:void 0,isNew:!0}])},"data-test-subj":"indexPattern-terms-add-field",label:u.i18n.translate("xpack.lens.indexPattern.terms.addaFilter",{defaultMessage:"Add field"}),isDisabled:"rare"===e.params.orderBy.type||"significant"===e.params.orderBy.type||p.length>Qu}))}function Ju(e,t){return e?u.i18n.translate("xpack.lens.indexPattern.terms.scriptedFieldErrorShort",{defaultMessage:"Scripted fields are not supported when using multiple fields"}):t.length?u.i18n.translate("xpack.lens.indexPattern.terms.invalidFieldsErrorShort",{defaultMessage:"Invalid {invalidFieldsCount, plural, one {field} other {fields}}: {invalidFields}. Check your data view or pick another field.",values:{invalidFieldsCount:t.length,invalidFields:t.map((e=>`"${e}"`)).join(", ")}}):void 0}function ec({layer:e,selectedColumn:t,columnId:a,indexPattern:n,operationSupportMatrix:i,updateLayer:s,onDeleteColumn:l,incompleteField:r,incompleteOperation:o,incompleteParams:c,currentFieldIsInvalid:d,helpMessage:p,groupId:m,dimensionGroups:g,operationDefinitionMap:f}){const v=t&&f[t.operationType],h=("fullReference"!==(null==v?void 0:v.input)&&"managedReference"!==(null==v?void 0:v.input)||o&&"field"===f[o].input)&&tc(t,Boolean(o),null==v?void 0:v.input,d);return Object(x.jsx)(b.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:Boolean(o||d),error:h,labelAppend:!h&&p},Object(x.jsx)(Uu,{fieldIsInvalid:d,currentIndexPattern:n,operationByField:i.operationByField,selectedOperationType:t?t.operationType:o,selectedField:null!=r?r:null==t?void 0:t.sourceField,incompleteOperation:o,onDeleteColumn:l,onChoose:t=>s(lu({layer:e,columnId:a,indexPattern:n,op:t.operationType,field:n.getFieldByName(t.field),visualizationGroups:g,targetGroup:m,incompleteParams:c})),showTimeSeriesDimensions:Bo(e,n,m,g)}))}function tc(e,t,a,n){return e&&t?"field"===a?u.i18n.translate("xpack.lens.indexPattern.invalidOperationLabel",{defaultMessage:"This field does not work with the selected function."}):u.i18n.translate("xpack.lens.indexPattern.chooseFieldLabel",{defaultMessage:"To use this function, select a field."}):n?u.i18n.translate("xpack.lens.indexPattern.invalidFieldLabel",{defaultMessage:"Invalid field. Check your data view or pick another field."}):void 0}var ac=a(174),nc=(a(387),a(392),a(546));const ic=({value:e,onChange:t,placeholder:a,inputRef:n,onSubmit:i,dataTestSubj:l,compressed:r})=>{const{inputValue:o,handleInputChange:c}=Object(Z.a)({value:e,onChange:t},{allowFalsyValue:!0}),d=Object(s.useRef)(!1);return Object(x.jsx)(b.EuiFieldText,{"data-test-subj":l||"lens-labelInput",value:o,onChange:e=>c(e.target.value),fullWidth:!0,placeholder:a||"",inputRef:e=>{n&&e&&(n.current=e)},onKeyDown:()=>{d.current=!0},onKeyUp:({key:e})=>{d.current&&b.keys.ENTER===e&&i&&i(),d.current=!1},prepend:u.i18n.translate("xpack.lens.labelInput.label",{defaultMessage:"Label"}),compressed:r})};a(397);const sc=({children:e,label:t,isInline:a,...n})=>a?Object(x.jsx)("div",{"data-test-subj":n["data-test-subj"]},l.a.cloneElement(e,{prepend:Object(x.jsx)(b.EuiFormLabel,{className:"lnsIndexPatternDimensionEditor__labelCustomRank"},t)})):Object(x.jsx)(b.EuiFormRow,i()({},n,{label:t}),e),lc=({filter:e,setFilter:t,indexPattern:a,button:n,isOpen:i,triggerClose:s})=>{const r=l.a.useRef();return Object(x.jsx)(b.EuiPopover,{"data-test-subj":"indexPattern-filters-existingFilterContainer",anchorClassName:"eui-fullWidth",panelClassName:"lnsIndexPatternDimensionEditor__filtersEditor",isOpen:i,ownFocus:!0,closePopover:s,button:n},Object(x.jsx)(nc.a,{isInvalid:!Object(Aa.a)(e.input,a),value:e.input,dataView:a.id?{type:"id",value:a.id}:{type:"title",value:a.title},disableAutoFocus:!0,onChange:a=>t({...e,input:a}),onSubmit:()=>{r.current&&r.current.focus()},appName:It.LENS_APP_NAME,services:Object(d.useKibana)().services}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(ic,{value:e.label||"",onChange:a=>t({...e,label:a}),placeholder:(o=e.input.query,""===o?cc:"object"===o?JSON.stringify(o):String(o)),inputRef:r,onSubmit:s,dataTestSubj:"indexPattern-filters-label"}));var o},rc=Object(b.htmlIdGenerator)(),oc="filters",uc=u.i18n.translate("xpack.lens.indexPattern.filters",{defaultMessage:"Filters"}),cc=u.i18n.translate("xpack.lens.indexPattern.filters.label.placeholder",{defaultMessage:"All records"}),dc={input:{query:"",language:"kuery"},label:""},pc={type:oc,displayName:uc,priority:3,input:"none",isTransferable:()=>!0,getDefaultLabel:()=>uc,buildColumn({previousColumn:e},t){var a;let n={filters:null!==(a=null==t?void 0:t.filters)&&void 0!==a?a:[dc]};var i,s,l,r;return e&&Ho("terms",e)&&(n={filters:null!==(i=null==t?void 0:t.filters)&&void 0!==i?i:[{label:"",input:{query:`"${e.sourceField}" : *`,language:"kuery"}},...null!==(s=null===(l=e.params)||void 0===l||null===(r=l.secondaryFields)||void 0===r?void 0:r.map((e=>({label:"",input:{query:`"${e}" : *`,language:"kuery"}}))))&&void 0!==s?s:[]]}),{label:uc,dataType:"string",operationType:oc,scale:"ordinal",isBucketed:!0,params:n}},getPossibleOperation:()=>({dataType:"string",isBucketed:!0,scale:"ordinal"}),toEsAggsFn:(e,t,a)=>{var n;const i=null===(n=e.params.filters)||void 0===n?void 0:n.filter((e=>Object(Aa.a)(e.input,a)));return Object(yt.buildExpressionFunction)("aggFilters",{id:t,enabled:!0,schema:"segment",filters:((null==i?void 0:i.length)>0?i:[dc]).map(ca.queryFilterToAst)}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,indexPattern:n,paramEditorUpdater:i})=>{const s=a.params.filters;return Object(x.jsx)(b.EuiFormRow,{fullWidth:!0},Object(x.jsx)(mc,{filters:s,setFilters:a=>i(yu({layer:e,columnId:t,paramName:oc,value:a})),indexPattern:n,defaultQuery:dc}))},getMaxPossibleNumValues:e=>e.params.filters.length,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.filters.documentation.quick",{defaultMessage:"\n    Divides values into predefined subsets.\n      "})},mc=({filters:e,setFilters:t,indexPattern:a,defaultQuery:n})=>{const[i,r]=Object(s.useState)(""),[o,c]=Object(s.useState)((()=>e.map((e=>({...e,id:rc()}))))),d=e=>{t(e.map((e=>Object(qt.omit)(e,"id")))),c(e)},p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Nu.a,{onDragEnd:d,onDragStart:()=>{},droppableId:"FILTERS_DROPPABLE_AREA",items:o},null==o?void 0:o.map(((e,t,n)=>{const s=!Object(Aa.a)(e.input,a),l=e.id;return Object(x.jsx)(Nu.b,{id:l,key:l,idx:t,isInvalid:s,invalidMessage:u.i18n.translate("xpack.lens.indexPattern.filters.isInvalid",{defaultMessage:"This query is invalid"}),onRemoveClick:()=>(e=>d(o.filter((t=>t.id!==e))))(e.id),removeTitle:u.i18n.translate("xpack.lens.indexPattern.filters.removeFilter",{defaultMessage:"Remove a filter"}),isNotRemovable:1===n.length,isNotDraggable:1===n.length},Object(x.jsx)(lc,{"data-test-subj":"indexPattern-filters-existingFilterContainer",isOpen:e.id===i,triggerClose:()=>p(""),indexPattern:a,filter:e,setFilter:e=>{((e,t,a)=>{d(o.map((n=>n.id===e?{...n,input:t,label:a}:n)))})(e.id,e.input,e.label)},button:Object(x.jsx)(b.EuiLink,{className:"lnsFiltersOperation__popoverButton","data-test-subj":"indexPattern-filters-existingFilterTrigger",onClick:()=>p(e.id),color:s?"danger":"text",title:u.i18n.translate("xpack.lens.indexPattern.filters.clickToEdit",{defaultMessage:"Click to edit"})},e.label||e.input.query||cc)}))}))),Object(x.jsx)(Vu.a,{onClick:()=>{(()=>{const e=rc();d([...o,{...n,id:e}]),r(e)})()},label:u.i18n.translate("xpack.lens.indexPattern.filters.addaFilter",{defaultMessage:"Add a filter"})}))},gc=" › ";function fc(e,t,a){var n;const i=e.columns[t],s=[i.sourceField,...null!==(n=i.params.secondaryFields)&&void 0!==n?n:[]],l=s.filter((e=>{var t;return null===(t=a.getFieldByName(e))||void 0===t?void 0:t.scripted}));if(!(s.length<2)&&l.length)return u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleTermsAndScriptedFields",{defaultMessage:"Scripted fields are not supported when using multiple fields, found {fields}",values:{fields:l.join(", ")}})}function bc(e,t){const a=t.split(gc);return e.map(((e,t)=>`${e}: ${"*"!==a[t]?`"${a[t]}"`:a[t]}`)).join(" AND ")}function vc(e,t){return 1===e.length?t:t.split(gc).map(((t,a)=>null==t?u.i18n.translate("xpack.lens.indexPattern.filterBy.emptyFilterQuery",{defaultMessage:"(empty)"}):`${e[a]}: ${t}`)).join(gc)}function hc(e){return"object"==typeof e&&null!=e&&"keys"in e&&Array.isArray(e.keys)}function xc(e,t,a){const n=new Set;if(Object.entries(e.columns).forEach((([e,t])=>{"references"in t&&t.references.forEach((e=>{n.add(e)}))})),Object(qt.uniq)(Object.entries(e.columns).filter((([t,a])=>Tp[a.operationType].shiftable&&(!Cu(e,t)||a.timeShift))).map((([e,t])=>t.timeShift||""))).length>1)return{message:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShifts",{defaultMessage:"In a single layer, you are unable to combine metrics with different time shifts and dynamic top values. Use the same time shift value for all metrics, or use filters instead of top values."}),fixAction:{label:u.i18n.translate("xpack.lens.indexPattern.termsWithMultipleShiftsFixActionLabel",{defaultMessage:"Use filters"}),newState:async(n,i,s,l)=>{var r,o,c,d,p;const m=e.columns[t],g=[m.sourceField,...null!==(r=null===(o=m.params)||void 0===o?void 0:o.secondaryFields)&&void 0!==r?r:[]],f=(null===(c=s.activeData)||void 0===c||null===(d=c[l].columns.find((({id:e})=>e===t)))||void 0===d?void 0:d.meta.field)===g[0];let b=Object(qt.uniq)((null===(p=s.activeData)||void 0===p?void 0:p[l].rows.map((e=>e[t])).filter((e=>g.length>1?hc(e)&&"__other__"!==e.keys[0]:"string"==typeof e&&"__other__"!==e)).map((e=>hc(e)?e.keys.join(gc):e)))||[]);if((!f||0===b.length)&&1===g.length){var v;const e=await n.dataViews.get(a.id);b=(null===(v=(await Object(ac.a)({services:{data:n},dataView:e,field:a.getFieldByName(g[0]),dslQuery:Object(El.buildEsQuery)(a,s.query,s.filters,Object(is.getEsQueryConfig)(i.uiSettings)),fromDate:s.dateRange.fromDate,toDate:s.dateRange.toDate,size:m.params.size})).topValues)||void 0===v?void 0:v.buckets.map((({key:e})=>String(e))))||[]}return g.length>1&&0===b.length&&(b=[Array(g.length).fill("*").join(gc)]),{...e,columns:{...e.columns,[t]:{label:u.i18n.translate("xpack.lens.indexPattern.pinnedTopValuesLabel",{defaultMessage:"Filters of {field}",values:{field:g.length>1?g.join(gc):g[0]}}),customLabel:!0,isBucketed:e.columns[t].isBucketed,dataType:"string",operationType:"filters",params:{filters:b.length>0?b.map((e=>({input:{query:1===g.length?`${g[0]}: "${e}"`:bc(g,e),language:"kuery"},label:vc(g,e)}))):[{input:{query:"*",language:"kuery"},label:cc}]}}}}}}}}function yc(e){const t=Ho("percentile",e);return!t||t&&Number.isInteger(e.params.percentile)}function jc(e){const t=Ho("percentile_rank",e);return!t||t&&Number.isInteger(e.params.value)}function Oc(e,t){const a=e.columns[t];return a&&!a.isBucketed&&function(e){return"last_value"!==e.operationType||["number","date"].includes(e.dataType)&&!e.params.showArrayValues}(a)&&jc(a)&&yc(a)&&!("references"in a)&&!Cu(e,t)}function Ic(e,t){if("string"==typeof e){const a=null==t?void 0:t.getFieldByName(e);return a&&a.scripted}return e.scripted}function kc(e,t,a){const n=[];var i,s;t&&"sourceField"in t&&(t.sourceField&&n.push(t.sourceField),Ho("terms",t)&&n.push(...null!==(i=null===(s=t.params)||void 0===s?void 0:s.secondaryFields)&&void 0!==i?i:[])),a&&n.push("string"==typeof a?a:a.name||a.displayName);const l=n.map((t=>e.getFieldByName(t))),r=[],o=[],u=Boolean(t&&1===l.length);return n.forEach(((e,t)=>{const a=l[t];(!(a&&Wu.has(a.type)&&a.aggregatable&&"counter"!==a.timeSeriesMetric)||a.aggregationRestrictions&&!a.aggregationRestrictions.terms||!u&&Ic(a)?o:r).push(e)})),{allFields:l,validFields:r,invalidFields:o}}function Tc(e,t){const a=e.params.otherBucket;return(a||void 0===a)&&t<Xu}const Mc=(e,t)=>{const a=null==e?void 0:e.map((e=>({label:String(e)}))),n=null==t?void 0:t.map((e=>({label:String(e)})));return{...(null==a?void 0:a.length)&&{include:a},...(null==n?void 0:n.length)&&{exclude:n}}},wc=({include:e,exclude:t,tableRows:a,columnId:n,isNumberField:i,includeIsRegex:r,excludeIsRegex:o,updateParams:c})=>{const[d,p]=Object(s.useState)(Mc(e,t)),[m,g]=Object(s.useState)(void 0),[f,v]=Object(s.useState)({include:r,exclude:o}),[h,y]=Object(s.useState)({include:r?null==e?void 0:e[0]:"",exclude:o?null==t?void 0:t[0]:""});Object(s.useEffect)((()=>{i&&v({include:!1,exclude:!1})}),[i]),Object(s.useEffect)((()=>{var e;if(null!=d&&null!==(e=d.include)&&void 0!==e&&e.length)return;const t=Object(qt.uniq)(null==a?void 0:a.map((e=>e[n]))).filter((e=>"__other__"!==e)),i=null==t?void 0:t.map((e=>({label:String(e)})));g(i)}),[a]);const j=(e,t)=>{const a={...d,[t]:e};p(a);const n=e.map((e=>Number.isNaN(Number(e.label))?e.label:Number(e.label)));c(t,n,`${t}IsRegex`,!1)},O=(e,t=[],a)=>{var n;const i={label:e};let s=[];s=[...null!==(n=d[a])&&void 0!==n?n:[],i];const l={...d,[a]:s};p(l);const r=s.map((e=>Number.isNaN(Number(e.label))?e.label:Number(e.label)));c(a,r,`${a}IsRegex`,!1)},I=Object(s.useCallback)((e=>{y({...h,include:e}),c("include",[null!=e?e:""],"includeIsRegex",!0)}),[h,c]),k=Object(s.useCallback)((e=>{y({...h,exclude:e}),c("exclude",[null!=e?e:""],"excludeIsRegex",!0)}),[h,c]),{inputValue:T,handleInputChange:M}=Object(Z.a)({onChange:I,value:h.include}),{inputValue:w,handleInputChange:C}=Object(Z.a)({onChange:k,value:h.exclude});return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"m"}),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.include",{defaultMessage:"Include values"}),display:"rowCompressed",fullWidth:!0,labelAppend:i?null:Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.addRegex",{defaultMessage:"Use regular expression"})),"data-test-subj":"lens-include-terms-regex-switch",compressed:!0,checked:f.include,onChange:e=>{const a=e.target.checked;v({...f,include:a}),y({...h,include:""}),p(Mc([],t)),c("include",[],"includeIsRegex",a)}})},f.include?Object(x.jsx)(b.EuiFieldText,{placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"}),"data-test-subj":"lens-include-terms-regex-input",value:T,onChange:e=>{M(e.target.value)},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"})}):Object(x.jsx)(b.EuiComboBox,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.include",{defaultMessage:"Include values"}),placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePlaceholder",{defaultMessage:"Select values or create a new one"}),options:m,selectedOptions:d.include,onChange:e=>j(e,"include"),onCreateOption:(e,t)=>O(e,t,"include"),isClearable:!0,"data-test-subj":"lens-include-terms-combobox",autoFocus:!0})),Object(x.jsx)(b.EuiSpacer,{size:"m"}),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.exclude",{defaultMessage:"Exclude values"}),display:"rowCompressed",fullWidth:!0,labelAppend:i?null:Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.addRegex",{defaultMessage:"Use regular expression"})),compressed:!0,checked:f.exclude,onChange:t=>{const a=t.target.checked;v({...f,exclude:a}),y({...h,exclude:""}),p(Mc(e,[])),c("exclude",[],"excludeIsRegex",a)}})},f.exclude?Object(x.jsx)(b.EuiFieldText,{placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"}),value:w,onChange:e=>{C(e.target.value)},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePatternPlaceholder",{defaultMessage:"Enter a regex to filter values"})}):Object(x.jsx)(b.EuiComboBox,{"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.exclude",{defaultMessage:"Exclude values"}),placeholder:u.i18n.translate("xpack.lens.indexPattern.terms.includeExcludePlaceholder",{defaultMessage:"Select values or create a new one"}),options:m,selectedOptions:d.exclude,onChange:e=>j(e,"exclude"),onCreateOption:(e,t)=>O(e,t,"exclude"),isClearable:!0,"data-test-subj":"lens-exclude-terms-combobox",autoFocus:!0})))};function Cc(e){var t;return!(null!=e&&null!==(t=e.esTypes)&&void 0!==t&&t.some((e=>["double","float","half_float","scaled_float"].includes(e))))}function Ec(e){var t;return null==e||null===(t=e.esTypes)||void 0===t?void 0:t.some((e=>"keyword"===e))}function Sc(e){return"rare"===e.type||"significant"===e.type}const Fc=u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"});function Pc(e,t=0,a=!1,n=!1,i=0){return a?u.i18n.translate("xpack.lens.indexPattern.rareTermsOf",{defaultMessage:"Rare values of {name}",values:{name:null!=e?e:Fc}}):n?u.i18n.translate("xpack.lens.indexPattern.significantTermsOf",{defaultMessage:"Significant values of {name}",values:{name:null!=e?e:Fc}}):t?u.i18n.translate("xpack.lens.indexPattern.multipleTermsOf",{defaultMessage:"Top values of {name} + {count} {count, plural, one {other} other {others}}",values:{name:null!=e?e:Fc,count:t}}):u.i18n.translate("xpack.lens.indexPattern.termsOf",{defaultMessage:"Top {numberOfTermsLabel}{termsCount, plural, one {value} other {values}} of {name}",values:{name:null!=e?e:Fc,termsCount:i,numberOfTermsLabel:i>1?`${i} `:""}})}function _c(e){var t;return{id:null!==(t=e.secondaryFields)&&void 0!==t&&t.length?"multi_terms":"terms"}}const Ac=Object(b.htmlIdGenerator)()(),Lc={type:"terms",displayName:u.i18n.translate("xpack.lens.indexPattern.terms",{defaultMessage:"Top values"}),priority:3,input:"field",getCurrentFields:e=>{var t,a;return[e.sourceField,...null!==(t=null==e||null===(a=e.params)||void 0===a?void 0:a.secondaryFields)&&void 0!==t?t:[]]},getParamsForMultipleFields:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{const i=new Set(kc(n,e).validFields),s=kc(n,t,a).validFields;for(const e of s)i.add(e);i.delete(e.sourceField);const l=[...i];return{secondaryFields:l,parentFormat:_c({...e.params,secondaryFields:l})}},canAddNewField:({targetColumn:e,sourceColumn:t,field:a,indexPattern:n})=>{var i,s,l;if(Sc(e.params.orderBy))return!1;const r=new Set(kc(n,e).validFields),{validFields:o}=kc(n,t,a),u=o.filter((e=>!r.has(e))).length;return!!u&&u+(null!==(i=null===(s=e.params)||void 0===s||null===(l=s.secondaryFields)||void 0===l?void 0:l.length)&&void 0!==i?i:0)<=Qu},getDefaultVisualSettings:e=>{var t,a;return{truncateText:Boolean(!(null!==(t=e.params)&&void 0!==t&&null!==(a=t.secondaryFields)&&void 0!==a&&a.length))}},getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(Wu.has(a)&&t&&"counter"!==n&&(!e||e.terms))return{dataType:a,isBucketed:!0,scale:"ordinal"}},getErrorMessage:(e,t,a)=>{const n=[...No(e,t,a)||[],xc(e,t,a)||"",fc(e,t,a)||""].filter(Boolean);return n.length?n:void 0},getNonTransferableFields:(e,t)=>kc(t,e).invalidFields,isTransferable:(e,t)=>{const{allFields:a,invalidFields:n}=kc(t,e);return Boolean(a.length&&0===n.length&&(!e.params.otherBucket||!t.hasRestrictions))},buildColumn({layer:e,field:t,indexPattern:a},n){var i,s,l,r,o,u,c,d,p,m;const g=Object.entries(e.columns).filter((([t])=>Oc(e,t))).map((([e])=>e))[0],f=Object.values(e.columns).filter((e=>e&&e.isBucketed)).length;return{label:Pc(t.displayName),dataType:t.type,operationType:"terms",scale:"ordinal",sourceField:t.name,isBucketed:!0,params:{size:null!==(i=null==n?void 0:n.size)&&void 0!==i?i:0===f?5:3,orderBy:null!==(s=null==n?void 0:n.orderBy)&&void 0!==s?s:g?{type:"column",columnId:g}:{type:"alphabetical",fallback:!0},orderAgg:"custom"===(null==n?void 0:n.orderBy.type)?null==n?void 0:n.orderAgg:void 0,orderDirection:null!==(l=null==n?void 0:n.orderDirection)&&void 0!==l?l:g?"desc":"asc",otherBucket:(null===(r=null==n?void 0:n.otherBucket)||void 0===r||r)&&!a.hasRestrictions,missingBucket:null!==(o=null==n?void 0:n.missingBucket)&&void 0!==o&&o,parentFormat:null!==(u=null==n?void 0:n.parentFormat)&&void 0!==u?u:{id:"terms"},include:null!==(c=null==n?void 0:n.include)&&void 0!==c?c:[],exclude:null!==(d=null==n?void 0:n.exclude)&&void 0!==d?d:[],includeIsRegex:null!==(p=null==n?void 0:n.includeIsRegex)&&void 0!==p&&p,excludeIsRegex:null!==(m=null==n?void 0:n.excludeIsRegex)&&void 0!==m&&m,secondaryFields:null==n?void 0:n.secondaryFields}}},toEsAggsFn:(e,t,a,n,i,s,l)=>{var r,o,c,d,p,m,g;if("rare"===(null===(r=e.params)||void 0===r?void 0:r.orderBy.type))return Object(yt.buildExpressionFunction)("aggRareTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,max_doc_count:e.params.orderBy.maxDocCount}).toAst();const f=e.params.accuracyMode?Math.max(1e3,1.5*e.params.size+10):void 0;var b,v;if("significant"===(null===(o=e.params)||void 0===o?void 0:o.orderBy.type))return Object(yt.buildExpressionFunction)("aggSignificantTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,size:e.params.size,shardSize:f,...(null===(b=e.params.include)||void 0===b?void 0:b.length)&&{include:e.params.include},...(null===(v=e.params.exclude)||void 0===v?void 0:v.length)&&{exclude:e.params.exclude}}).toAst();let h="_key";if("column"===(null===(c=e.params)||void 0===c?void 0:c.orderBy.type)){const t=n.columns[e.params.orderBy.columnId];h=String(s.indexOf(e.params.orderBy.columnId)),t&&jc(t)&&yc(t)||(h="_key")}const x=e.params.orderAgg;let y;if(x){h="custom";const e=null==l?void 0:l[null==x?void 0:x.operationType];e&&"toEsAggsFn"in e&&(y=[{type:"expression",chain:[e.toEsAggsFn(x,`${t}-orderAgg`,a,n,i,s)]}])}return null!==(d=e.params)&&void 0!==d&&null!==(p=d.secondaryFields)&&void 0!==p&&p.length?Object(yt.buildExpressionFunction)("aggMultiTerms",{id:t,enabled:!0,schema:"segment",fields:[e.sourceField,...e.params.secondaryFields],orderBy:h,order:e.params.orderDirection,orderAgg:y,size:e.params.size,shardSize:f,otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"})}).toAst():Object(yt.buildExpressionFunction)("aggTerms",{id:t,enabled:!0,schema:"segment",field:e.sourceField,orderBy:h,order:e.params.orderDirection,orderAgg:y,size:e.params.size,shardSize:f,...(null===(m=e.params.include)||void 0===m?void 0:m.length)&&{include:e.params.include},...(null===(g=e.params.exclude)||void 0===g?void 0:g.length)&&{exclude:e.params.exclude},includeIsRegex:Boolean(e.params.includeIsRegex),excludeIsRegex:Boolean(e.params.excludeIsRegex),otherBucket:Boolean(e.params.otherBucket),otherBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.otherLabel",{defaultMessage:"Other"}),missingBucket:e.params.otherBucket&&e.params.missingBucket,missingBucketLabel:u.i18n.translate("xpack.lens.indexPattern.terms.missingLabel",{defaultMessage:"(missing value)"})}).toAst()},getDefaultLabel:(e,t,a)=>{var n,i;return Pc(null==a||null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.displayName,null===(i=e.params.secondaryFields)||void 0===i?void 0:i.length,"rare"===e.params.orderBy.type,"significant"===e.params.orderBy.type,e.params.size)},onFieldChange:(e,t,a)=>{var n;const i={...e.params,secondaryFields:void 0,...a};return"format"in i&&"number"!==t.type&&delete i.format,i.parentFormat=_c(i),(!Cc(t)&&"rare"===i.orderBy.type||!Ec(t)&&"significant"===i.orderBy.type)&&(i.orderBy={type:"alphabetical"}),{...e,dataType:t.type,label:e.customLabel?e.label:Pc(t.displayName,null===(n=i.secondaryFields)||void 0===n?void 0:n.length,"rare"===i.orderBy.type,"significant"===i.orderBy.type,i.size),sourceField:t.name,params:i}},onOtherColumnChanged:(e,t)=>{const a=e.columns,n=a[t];if(("column"===n.params.orderBy.type||"alphabetical"===n.params.orderBy.type&&n.params.orderBy.fallback)&&(!("column"===n.params.orderBy.type?a[n.params.orderBy.columnId]:void 0)||"column"===n.params.orderBy.type&&!Oc(e,n.params.orderBy.columnId))){const t=Object.entries(e.columns).filter((([t])=>Oc(e,t))).map((([e])=>e))[0];return{...n,params:{...n.params,orderBy:t?{type:"column",columnId:t}:{type:"alphabetical",fallback:!0},orderDirection:t?"desc":"asc"}}}return n},renderFieldInput:function(e){var t,a,n,i;const{layer:l,selectedColumn:r,columnId:o,indexPattern:c,operationSupportMatrix:d,updateLayer:p,dimensionGroups:m,groupId:g,incompleteParams:f}=e,v=Object(s.useCallback)((e=>{const t=l.columns[o],[a,...n]=e,i=Object(qt.uniq)(e.map((e=>{var t;return null===(t=c.getFieldByName(e))||void 0===t?void 0:t.type}))),s=(1===i.length?i[0]:"string")||t.dataType,r={...t.params};"format"in r&&"number"!==s&&delete r.format;const u=c.getFieldByName(a);if((!Cc(u)&&"rare"===r.orderBy.type||!Ec(u)&&"significant"===r.orderBy.type)&&(r.orderBy={type:"alphabetical"}),1===e.length){const e=d.operationByField.get(a);if(!(null==e?void 0:e.has("terms"))){const t=null==e?void 0:e.values().next().value;return p(lu({layer:l,columnId:o,indexPattern:c,op:t,field:u,visualizationGroups:m,targetGroup:g,incompleteParams:f}))}}p({...l,columns:{...l.columns,[o]:{...t,dataType:s,sourceField:a,label:t.customLabel?t.label:Pc(null==u?void 0:u.displayName,e.length-1,"rare"===r.orderBy.type,"significant"===r.orderBy.type,r.size),params:{...r,secondaryFields:n,parentFormat:_c({...r,secondaryFields:n})}}}})}),[o,m,g,f,c,l,d.operationByField,p]),h=l.columns[o],y=tc(r,Boolean(e.incompleteOperation),"field",e.currentFieldIsInvalid);if(!h||!r||e.incompleteOperation||y&&(null===(t=r.params)||void 0===t||null===(a=t.secondaryFields)||void 0===a||!a.length))return Object(x.jsx)(ec,e);const j=Boolean(fc(l,o,c)),{invalidFields:O}=kc(c,r);return Object(x.jsx)(b.EuiFormRow,{"data-test-subj":"indexPattern-field-selection-row",label:u.i18n.translate("xpack.lens.indexPattern.terms.chooseFields",{defaultMessage:"{count, plural, zero {Field} other {Fields}}",values:{count:(null===(n=r.params)||void 0===n||null===(i=n.secondaryFields)||void 0===i?void 0:i.length)||0}}),fullWidth:!0,isInvalid:Boolean(j||O.length),error:Ju(j,O)},Object(x.jsx)(Zu,{column:r,indexPattern:c,operationSupportMatrix:d,onChange:v,invalidFields:O,showTimeSeriesDimensions:Bo(l,c,g,m)}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.terms.documentation.quick",{defaultMessage:"\nThe top values of a specified field ranked by the chosen metric.\n      "}),handleDataSectionExtra:!0,paramEditor:function({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n,indexPattern:r,operationDefinitionMap:o,ReferenceEditor:c,paramEditorCustomProps:d,activeData:p,dataSectionExtra:m,...g}){var f,v,h,y,j;const[O,I]=Object(s.useState)(void 0),k=r.hasRestrictions,T="$$$";function M(e){return"column"!==e.type?e.type:`${e.type}${T}${e.columnId}`}const w=Object.entries(e.columns).filter((([t])=>Oc(e,t))).map((([e,t])=>({value:M({type:"column",columnId:e}),text:t.label})));w.push({value:M({type:"alphabetical"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderAlphabetical",{defaultMessage:"Alphabetical"})}),null!==(f=a.params.secondaryFields)&&void 0!==f&&f.length||!Cc(r.getFieldByName(a.sourceField))||w.push({value:M({type:"rare",maxDocCount:$u}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderRare",{defaultMessage:"Rarity"})}),null!==(v=a.params.secondaryFields)&&void 0!==v&&v.length||!Ec(r.getFieldByName(a.sourceField))||w.push({value:M({type:"significant"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderSignificant",{defaultMessage:"Significance"})}),w.push({value:M({type:"custom"}),text:u.i18n.translate("xpack.lens.indexPattern.terms.orderCustomMetric",{defaultMessage:"Custom"})});const C=a.params.secondaryFields?a.params.secondaryFields.length:0,{euiTheme:E}=Object(b.useEuiTheme)();return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Bu,{value:a.params.size,disabled:"rare"===a.params.orderBy.type,onChange:i=>{var s;t({...e,columns:{...e.columns,[n]:{...a,label:a.customLabel?a.label:Pc(null===(s=r.getFieldByName(a.sourceField))||void 0===s?void 0:s.displayName,C,"rare"===a.params.orderBy.type,"significant"===a.params.orderBy.type,i),params:{...a.params,size:i,otherBucket:Tc(a,i)}}}})}}),"rare"===a.params.orderBy.type&&Object(x.jsx)(Bu,{value:a.params.orderBy.maxDocCount,label:u.i18n.translate("xpack.lens.indexPattern.terms.maxDocCount",{defaultMessage:"Max doc count per term"}),maxValue:100,onChange:i=>{t(yu({layer:e,columnId:n,paramName:"orderBy",value:{...a.params.orderBy,maxDocCount:i}}))}}),Object(x.jsx)(b.EuiFormRow,{label:Object(x.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})," ",Object(x.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.orderByHelp",{defaultMessage:"Specifies the dimension the top values are ranked by."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),display:"rowCompressed",fullWidth:!0},Object(x.jsx)(b.EuiSelect,{compressed:!0,fullWidth:!0,"data-test-subj":"indexPattern-terms-orderBy",options:w,value:M(a.params.orderBy),onChange:a=>{const i="alphabetical"===(s=a.target.value)?{type:"alphabetical",fallback:!1}:"rare"===s?{type:"rare",maxDocCount:$u}:"significant"===s?{type:"significant"}:"custom"===s?{type:"custom"}:{type:"column",columnId:s.split(T)[1]};var s;let l=Au(yu({layer:e,columnId:n,paramName:"orderBy",value:i}),r);if("custom"===i.type){const t=o.count.buildColumn({layer:e,indexPattern:r,field:r.getFieldByName(It.DOCUMENT_FIELD_NAME)});l=yu({layer:l,columnId:n,paramName:"orderAgg",value:t})}else l=yu({layer:l,columnId:n,paramName:"orderAgg",value:void 0});I(void 0),t(yu({layer:l,columnId:n,paramName:"orderDirection",value:"alphabetical"===i.type?"asc":"desc"}))},"aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderBy",{defaultMessage:"Rank by"})})),a.params.orderAgg&&c&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(c,i()({operationDefinitionMap:o,functionLabel:u.i18n.translate("xpack.lens.indexPattern.terms.orderAgg.rankFunction",{defaultMessage:"Rank function"}),fieldLabel:u.i18n.translate("xpack.lens.indexPattern.terms.orderAgg.rankField",{defaultMessage:"Rank field"}),isInline:!0,paramEditorCustomProps:{...d,isInline:!0,labels:Dc(a.params.orderAgg.operationType)},layer:e,selectionStyle:"full",columnId:`${n}-orderAgg`,currentIndexPattern:r,paramEditorUpdater:a=>{if(!Uo(a))throw new Error("Setter should always be a column when ran here.");t(yu({layer:e,columnId:n,paramName:"orderAgg",value:a}))},column:a.params.orderAgg,incompleteColumn:O,onResetIncomplete:()=>I(void 0),onDeleteColumn:()=>{throw new Error("Should not be called")},onChooseField:i=>{const s=i.field&&r.getFieldByName(i.field);if(s){const l=o[i.operationType].buildColumn({previousColumn:a.params.orderAgg,layer:e,indexPattern:r,field:s});I(void 0),t(yu({layer:e,columnId:n,paramName:"orderAgg",value:l}))}else I({sourceField:i.field,operationType:i.operationType})},onChooseFunction:(i,s)=>{if(s){const l=o[i].buildColumn({previousColumn:a.params.orderAgg,layer:e,indexPattern:r,field:s});I(void 0),t(yu({layer:e,columnId:n,paramName:"orderAgg",value:l}))}else I({operationType:i})},validation:{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}},g)),Object(x.jsx)(b.EuiSpacer,{size:"m"})),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),display:"rowCompressed",fullWidth:!0},Object(x.jsx)(b.EuiButtonGroup,{isFullWidth:!0,legend:u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),"data-test-subj":"indexPattern-terms-orderDirection-groups",name:"orderDirection",buttonSize:"compressed","aria-label":u.i18n.translate("xpack.lens.indexPattern.terms.orderDirection",{defaultMessage:"Rank direction"}),isDisabled:Sc(a.params.orderBy),options:[{id:`${Ac}asc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-asc",value:"asc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderAscending",{defaultMessage:"Ascending"})},{id:`${Ac}desc`,"data-test-subj":"indexPattern-terms-orderDirection-groups-desc",value:"desc",label:u.i18n.translate("xpack.lens.indexPattern.terms.orderDescending",{defaultMessage:"Descending"})}],idSelected:`${Ac}${a.params.orderDirection}`,onChange:a=>{const i=a.replace(Ac,"");t(yu({layer:e,columnId:n,paramName:"orderDirection",value:i}))}})),m&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"m"}),m),!k&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"m"}),Object(x.jsx)(b.EuiAccordion,{id:"lnsTermsAdvanced",arrowProps:{color:"primary"},buttonContent:Object(x.jsx)(b.EuiTitle,{size:"xxs"},Object(x.jsx)("h5",null,Object(x.jsx)(b.EuiTextColor,{color:E.colors.primary},u.i18n.translate("xpack.lens.indexPattern.terms.advancedSettings",{defaultMessage:"Advanced"})))),"data-test-subj":"indexPattern-terms-advanced",className:"lnsIndexPatternDimensionEditor-advancedOptions"},Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.missingBucketDescription",{defaultMessage:"Include documents without the selected field"})),compressed:!0,disabled:!a.params.otherBucket||"string"!==(null===(h=r.getFieldByName(a.sourceField))||void 0===h?void 0:h.type)||Sc(a.params.orderBy),"data-test-subj":"indexPattern-terms-missing-bucket",checked:Boolean(a.params.missingBucket),onChange:a=>t(yu({layer:e,columnId:n,paramName:"missingBucket",value:a.target.checked}))}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.otherBucketDescription",{defaultMessage:'Group remaining values as "Other"'})),compressed:!0,"data-test-subj":"indexPattern-terms-other-bucket",checked:Boolean(a.params.otherBucket),disabled:Sc(a.params.orderBy),onChange:a=>t(yu({layer:e,columnId:n,paramName:"otherBucket",value:a.target.checked}))}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeDescription",{defaultMessage:"Enable accuracy mode"})," ",Object(x.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.terms.accuracyModeHelp",{defaultMessage:"Improves results for high-cardinality data, but increases the load on the Elasticsearch cluster."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),compressed:!0,disabled:"rare"===a.params.orderBy.type,"data-test-subj":"indexPattern-accuracy-mode",checked:Boolean(a.params.accuracyMode&&"rare"!==a.params.orderBy.type),onChange:a=>t(yu({layer:e,columnId:n,paramName:"accuracyMode",value:a.target.checked}))}),("number"===a.dataType||"string"===a.dataType)&&!(null!==(y=a.params.secondaryFields)&&void 0!==y&&y.length)&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(wc,{include:a.params.include,exclude:a.params.exclude,includeIsRegex:Boolean(a.params.includeIsRegex),excludeIsRegex:Boolean(a.params.excludeIsRegex),tableRows:null==p||null===(j=p[g.layerId])||void 0===j?void 0:j.rows,columnId:n,isNumberField:Boolean("number"===a.dataType),updateParams:(i,s,l,r)=>t({...e,columns:{...e.columns,[n]:{...a,params:{...a.params,[i]:s,[l]:r}}}})})))))},getMaxPossibleNumValues:e=>e.params.size+(e.params.otherBucket?1:0)};function Dc(e){switch(e){case"last_value":return[u.i18n.translate("xpack.lens.indexPattern.terms.lastValue.sortRankBy",{defaultMessage:"Sort rank by"})];case"percentile_rank":return[u.i18n.translate("xpack.lens.indexPattern.terms.percentile.",{defaultMessage:"Percentile ranks"})];default:return}}var Rc=a(98),Bc=a(41);const Nc={s:u.i18n.translate("xpack.lens.fieldFormats.suffix.s",{defaultMessage:"/s"}),m:u.i18n.translate("xpack.lens.fieldFormats.suffix.m",{defaultMessage:"/m"}),h:u.i18n.translate("xpack.lens.fieldFormats.suffix.h",{defaultMessage:"/h"}),d:u.i18n.translate("xpack.lens.fieldFormats.suffix.d",{defaultMessage:"/d"})},zc={s:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.s",{defaultMessage:"per second"}),m:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.m",{defaultMessage:"per minute"}),h:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.h",{defaultMessage:"per hour"}),d:u.i18n.translate("xpack.lens.fieldFormats.longSuffix.d",{defaultMessage:"per day"})},Vc="suffix";function Gc(e){var t;return t=class SuffixFormatter extends Bc.FieldFormat{constructor(...t){super(...t),ta()(this,"allowsNumericalAggregations",!0),ta()(this,"textConvert",(t=>{const a=this.param("unit"),n=a?Nc[a]:this.param("suffixString"),i=this.param("id"),s=this.param("params"),l=e()({id:i,params:s}).convert(t);return""===l?"":n?`${l}${n}`:l}))}getParamDefaults(){return{unit:void 0,nestedParams:{}}}},ta()(t,"id",Vc),ta()(t,"hidden",!0),ta()(t,"title",u.i18n.translate("xpack.lens.fieldFormats.suffix.title",{defaultMessage:"Suffix"})),ta()(t,"fieldType",Rc.b.NUMBER),t}function qc(e,t,a){return(t||e?" ":"")+(e?zc[e]:"")+(t&&e?" ":"")+(t?`-${t}`:"")+(a?" ":"")+(a?u.i18n.translate("xpack.lens.reducedTimeRangeSuffix",{defaultMessage:"last {reducedTimeRange}",values:{reducedTimeRange:a}}):"")}function Hc(e,t,a,n,i,s,l){let r=e;if(t||n||s){const a=qc(t,n,s),i=e.lastIndexOf(a);-1!==i&&(r=e.substring(0,i))}return a||i||l?`${r}${qc(a,i,l)}`:r}function Uc(e,t){const a={};return e.forEach((e=>{const n=t(e);n&&(n in a||(a[n]=[]),a[n].push(e))})),a}const $c=(e,t,a)=>{const{functions:[n]}=e,i=[];var s;if(t.includes(n.name)&&(i.push(n.name),a.forEach((({name:e,transformer:t})=>{var a;const s=null===(a=n.getArgument(e))||void 0===a?void 0:a[0];i.push(t?t(s):s)})),i.push(null===(s=n.getArgument("timeShift"))||void 0===s?void 0:s[0])),"aggFilteredMetric"===n.name){var l;const e=null===(l=n.getArgument("customMetric"))||void 0===l?void 0:l[0].functions[0];if(e&&t.includes(e.name)){var r,o;i.push(e.name),i.push("filtered");const t=(null===(r=n.getArgument("customBucket"))||void 0===r?void 0:r[0]).functions[0];a.forEach((({name:t,transformer:a})=>{var n;const s=null===(n=e.getArgument(t))||void 0===n?void 0:n[0];i.push(a?a(s):s)})),i.push(t.getArgument("timeWindow")),i.push(n.getArgument("timeShift"));const s=null===(o=t.getArgument("filter"))||void 0===o?void 0:o[0];if(s){var u;const e=s.functions[0];i.push(null==e?void 0:e.name,null==e||null===(u=e.getArgument("q"))||void 0===u?void 0:u[0])}}}return i.length?i.map(String).join("-"):void 0},Wc=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]),Xc="ratio",Yc="unique_count";function Qc(e,t,a){return Hc(u.i18n.translate("xpack.lens.indexPattern.cardinalityOf",{defaultMessage:"Unique count of {name}",values:{name:e}}),void 0,void 0,void 0,t,void 0,a)}const Kc={type:Yc,displayName:u.i18n.translate("xpack.lens.indexPattern.cardinality",{defaultMessage:"Unique count"}),allowAsReference:!0,input:"field",getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(Wc.has(a)&&t&&"counter"!==n&&(!e||e.cardinality))return{dataType:"number",isBucketed:!1,scale:Xc}},getErrorMessage:(e,t,a)=>Vo([No(e,t,a),lo(e,t,a)]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&Wc.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality))},filterable:!0,shiftable:!0,canReduceTimeRange:!0,getDefaultLabel:(e,t,a)=>Qc(Go(e.sourceField,a),e.timeShift,e.reducedTimeRange),buildColumn({field:e,previousColumn:t},a){var n;return{label:Qc(e.displayName,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:Yc,scale:Xc,sourceField:e.name,isBucketed:!1,filter:Qo(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==a?void 0:a.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{...Wo(t),emptyAsNull:t&&Ho("unique_count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return[{dataTestSubj:"hide-zero-values",inlineElement:Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:re.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(yu({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]},toEsAggsFn:(e,t)=>{var a;return Object(yt.buildExpressionFunction)("aggCardinality",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter?void 0:e.timeShift,emptyAsNull:null===(a=e.params)||void 0===a?void 0:a.emptyAsNull}).toAst()},getGroupByKey:e=>$c(e,["aggCardinality"],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),onFieldChange:(e,t)=>({...e,label:Qc(t.displayName,e.timeShift,e.reducedTimeRange),sourceField:t.name}),documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.cardinality.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.markdown",{defaultMessage:"\nCalculates the number of unique values of a specified field. Works for number, string, date and boolean values.\n\nExample: Calculate the number of different products:\n`unique_count(product.name)`\n\nExample: Calculate the number of different products from the \"clothes\" group:\n`unique_count(product.name, kql='product.group=clothes')`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.cardinality.documentation.quick",{defaultMessage:"\nThe number of unique values for a specified number, string, date, or boolean field.\n      "})};function Zc(e,t,a,n){return Hc(u.i18n.translate("xpack.lens.indexPattern.percentileOf",{defaultMessage:"{percentile, selectordinal, one {#st} two {#nd} few {#rd} other {#th}} percentile of {name}",values:{name:e,percentile:t}}),void 0,void 0,void 0,a,void 0,n)}const Jc=4;function ed(e,t,a,n){return!t&&qo(e,!1,a,n,15)?u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessageTooManyDigits",{defaultMessage:"Only {digits} numbers allowed after the decimal point.",values:{digits:Jc}}):u.i18n.translate("xpack.lens.indexPattern.percentile.errorMessage",{defaultMessage:"Percentile has to be an integer between {min} and {max}",values:{min:n,max:a}})}const td=["number","histogram"],ad={type:"percentile",allowAsReference:!0,displayName:u.i18n.translate("xpack.lens.indexPattern.percentile",{defaultMessage:"Percentile"}),input:"field",operationParams:[{name:"percentile",type:"number",required:!1,defaultValue:95}],filterable:!0,shiftable:!0,canReduceTimeRange:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(td.includes(a)&&t&&"counter"!==n&&(!e||e.percentiles))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&td.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||!a.aggregationRestrictions.percentiles))},getDefaultLabel:(e,t,a)=>Zc(Go(e.sourceField,a),e.params.percentile,e.timeShift,e.reducedTimeRange),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const s=t&&Ho("percentile",t)&&t.params.percentile,l=null!==(i=null==n?void 0:n.percentile)&&void 0!==i?i:s||95;return{label:Zc(Go(e.name,a),l,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"percentile",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:Qo(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{percentile:l,...Wo(t)}}},onFieldChange:(e,t)=>({...e,label:Zc(t.displayName,e.params.percentile,e.timeShift,e.reducedTimeRange),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(yt.buildExpressionFunction)("aggSinglePercentile",{id:t,enabled:!0,schema:"metric",field:e.sourceField,percentile:e.params.percentile,timeShift:e.filter?void 0:e.timeShift}).toAst(),getGroupByKey:e=>$c(e,["aggSinglePercentile"],[{name:"field"},{name:"percentile"}]),optimizeEsAggs:(e,t,a)=>{let n=[...e];const i={...t},s=Uc(n,(e=>$c(e,["aggSinglePercentile"],[{name:"field"}]))),l=n.map((e=>e.functions[0])).filter((e=>"aggTerms"===e.name));return Object.values(s).forEach((e=>{var t,s,r,o;if(e.length<=1)return;const{functions:[u]}=e[0];if("aggFilteredMetric"===u.name)return;n=n.filter((t=>!e.includes(t)));const{functions:[c]}=e[0],d=c.getArgument("id")[0],p={id:d,enabled:null===(t=c.getArgument("enabled"))||void 0===t?void 0:t[0],schema:null===(s=c.getArgument("schema"))||void 0===s?void 0:s[0],field:null===(r=c.getArgument("field"))||void 0===r?void 0:r[0],percents:[],timeShift:null===(o=c.getArgument("timeShift"))||void 0===o?void 0:o[0]};for(const t of e){const e=t.functions[0].getArgument("percentile")[0];p.percents.push(e),l.forEach((a=>{var n,i;(null===(n=a.getArgument("orderBy"))||void 0===n?void 0:n[0])===(null===(i=t.functions[0].getArgument("id"))||void 0===i?void 0:i[0])&&a.replaceArgument("orderBy",[`${d}.${e}`])}))}const m=Object(yt.buildExpressionFunction)("aggPercentiles",p).toAst();n.push(Object(yt.buildExpression)({type:"expression",chain:[m]})),e.forEach((e=>{const t=a.get(e);if(void 0===t)throw new Error("Could not find current column ID for percentile agg expression builder");const n=`col-?-${d}.${e.functions[0].getArgument("percentile")[0]}`;i[n]=i[t],delete i[t]}))})),{esAggsIdMap:i,aggs:n}},getErrorMessage:(e,t,a)=>Vo([No(e,t,a),lo(e,t,a)]),paramEditor:function({paramEditorUpdater:e,currentColumn:t,indexPattern:a,paramEditorCustomProps:n}){const{labels:i,isInline:l}=n||{},r=(null==i?void 0:i[0])||u.i18n.translate("xpack.lens.indexPattern.percentile.percentileValue",{defaultMessage:"Percentile"}),o=l?1:1e-4,c=l?99:99.9999,d=Object(s.useCallback)((n=>{var i;qo(n,l,c,o,Jc)&&Number(n)!==t.params.percentile&&e({...t,label:t.customLabel?t.label:Zc((null===(i=a.getFieldByName(t.sourceField))||void 0===i?void 0:i.displayName)||t.sourceField,Number(n),t.timeShift,t.reducedTimeRange),params:{...t.params,percentile:Number(n)}})}),[l,c,o,t,e,a]),{inputValue:p,handleInputChange:m}=Object(Z.a)({onChange:d,value:String(t.params.percentile)}),g=qo(p,l,c,o,Jc),f=Object(s.useCallback)((e=>m(String(e.currentTarget.value))),[m]);return Object(x.jsx)(sc,{isInline:l,label:r,"data-test-subj":"lns-indexPattern-percentile-form",display:"rowCompressed",fullWidth:!0,isInvalid:!g,error:!g&&ed(p,l,c,o)},l?Object(x.jsx)(b.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=p?p:"",min:o,max:c,step:o,onChange:f,"aria-label":r}):Object(x.jsx)(b.EuiRange,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile-input",compressed:!0,value:null!=p?p:"",min:o,max:c,step:o,onChange:f,showInput:!0,"aria-label":r}))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.percentile.signature",{defaultMessage:"field: string, [percentile]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.markdown",{defaultMessage:"\nReturns the specified percentile of the values of a field. This is the value n percent of the values occuring in documents are smaller.\n\nExample: Get the number of bytes larger than 95 % of values:\n`percentile(bytes, percentile=95)`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.percentile.documentation.quick",{defaultMessage:"\n      The largest value that is smaller than n percent of the values that occur in all documents.\n      "})};function nd(e,t,a,n){return Hc(u.i18n.translate("xpack.lens.indexPattern.percentileRanksOf",{defaultMessage:"Percentile rank ({value}) of {name}",values:{name:e,value:t}}),void 0,void 0,void 0,a,void 0,n)}const id=["number","histogram"],sd={type:"percentile_rank",allowAsReference:!0,displayName:u.i18n.translate("xpack.lens.indexPattern.percentileRank",{defaultMessage:"Percentile rank"}),input:"field",operationParams:[{name:"value",type:"number",required:!1,defaultValue:0}],filterable:!0,shiftable:!0,canReduceTimeRange:!0,getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if(id.includes(a)&&t&&"counter"!==n&&(!e||!e.percentile_ranks))return{dataType:"number",isBucketed:!1,scale:"ratio"}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&id.includes(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||!a.aggregationRestrictions.percentile_ranks))},getDefaultLabel:(e,t,a)=>nd(Go(e.sourceField,a),e.params.value,e.timeShift,e.reducedTimeRange),buildColumn:({field:e,previousColumn:t,indexPattern:a},n)=>{var i;const s=t&&Ho("percentile_rank",t)&&t.params.value,l=null!==(i=null==n?void 0:n.value)&&void 0!==i?i:s||0;return{label:nd(Go(e.name,a),l,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"percentile_rank",sourceField:e.name,isBucketed:!1,scale:"ratio",filter:Qo(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{value:l,...Wo(t)}}},onFieldChange:(e,t)=>({...e,label:nd(t.displayName,e.params.value,e.timeShift,e.reducedTimeRange),sourceField:t.name}),toEsAggsFn:(e,t,a)=>Object(yt.buildExpressionFunction)("aggSinglePercentileRank",{id:t,enabled:!0,schema:"metric",field:e.sourceField,value:e.params.value,timeShift:e.filter?void 0:e.timeShift}).toAst(),getErrorMessage:(e,t,a)=>Vo([No(e,t,a),lo(e,t,a)]),paramEditor:function({paramEditorUpdater:e,currentColumn:t,indexPattern:a,paramEditorCustomProps:n}){const{labels:i,isInline:l}=n||{},r=(null==i?void 0:i[0])||u.i18n.translate("xpack.lens.indexPattern.percentile.percentileRanksValue",{defaultMessage:"Percentile ranks value"}),o=Object(s.useCallback)((n=>{var i;qo(n,l)&&Number(n)!==t.params.value&&e({...t,label:t.customLabel?t.label:nd((null===(i=a.getFieldByName(t.sourceField))||void 0===i?void 0:i.displayName)||t.sourceField,Number(n),t.timeShift,t.reducedTimeRange),params:{...t.params,value:Number(n)}})}),[l,t,e,a]),{inputValue:c,handleInputChange:d}=Object(Z.a)({onChange:o,value:String(t.params.value)},{allowFalsyValue:!0}),p=qo(c,l),m=Object(s.useCallback)((e=>{d(e.currentTarget.value)}),[d]);return Object(x.jsx)(sc,{isInline:l,label:r,"data-test-subj":"lns-indexPattern-percentile_ranks-form",display:"rowCompressed",fullWidth:!0,isInvalid:!p,error:!p&&u.i18n.translate("xpack.lens.indexPattern.percentileRanks.errorMessage",{defaultMessage:"Percentile ranks value must be a number"})},Object(x.jsx)(b.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-percentile_ranks-input",compressed:!0,value:null!=c?c:"",onChange:m,step:l?1:"any","aria-label":r}))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.signature",{defaultMessage:"field: string, [value]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.documentation.markdown",{defaultMessage:"\nReturns the percentage of values which are below a certain value. For example, if a value is greater than or equal to 95% of the observed values it is said to be at the 95th percentile rank\n\nExample: Get the percentage of values which are below of 100:\n`percentile_rank(bytes, value=100)`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.percentileRanks.documentation.quick",{defaultMessage:"\nThe percentage of values that are below a specific value. For example, when a value is greater than or equal to 95% of the calculated values, the value is the 95th percentile rank.\n      "})},ld={min:"aggMin",max:"aggMax",average:"aggAvg",sum:"aggSum",median:"aggMedian",standard_deviation:"aggStdDeviation"},rd=["number","histogram"];function od({type:e,displayName:t,description:a,ofName:n,priority:i,optionalTimeScaling:s,supportsDate:l,hideZeroOption:r,aggConfigParams:o,documentationDescription:c,quickFunctionDocumentation:d,unsupportedSettings:p}){const m=(e,t)=>Hc(n(e),void 0,s?null==t?void 0:t.timeScale:void 0,void 0,null==t?void 0:t.timeShift,void 0,null==t?void 0:t.reducedTimeRange);return{type:e,allowAsReference:!0,priority:i,displayName:t,description:a,input:"field",timeScalingMode:s?"optional":void 0,getUnsupportedSettings:()=>p,getPossibleOperationForField:({aggregationRestrictions:t,aggregatable:a,type:n,timeSeriesMetric:i})=>{if((rd.includes(n)||l&&"date"===n)&&a&&function(e,t){return"counter"!==t||["min","max"].includes(e)}(e,i)&&(!t||t[e]))return{dataType:"date"===n?"date":"number",isBucketed:!1,scale:"ratio"}},isTransferable:(t,a)=>{const n=a.getFieldByName(t.sourceField);return Boolean(n&&rd.includes(n.type)&&n.aggregatable&&(!n.aggregationRestrictions||n.aggregationRestrictions[e]))},getDefaultLabel:(e,t,a)=>m(Go(e.sourceField,a),e),buildColumn:({field:t,previousColumn:a},n)=>{var i;return{label:m(t.displayName,a),dataType:l&&"date"===t.type?"date":"number",operationType:e,sourceField:t.name,isBucketed:!1,scale:"ratio",timeScale:s?null==a?void 0:a.timeScale:void 0,filter:Qo(a,n),timeShift:(null==n?void 0:n.shift)||(null==a?void 0:a.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==a?void 0:a.reducedTimeRange),params:{...Wo(a),emptyAsNull:r&&a&&Ho(e,a)?null===(i=a.params)||void 0===i?void 0:i.emptyAsNull:!(null!=n&&n.usedInMath)}}},onFieldChange:(e,t)=>({...e,label:m(t.displayName,e),dataType:t.type,sourceField:t.name}),getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return r?[{dataTestSubj:"hide-zero-values",inlineElement:Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:re.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(yu({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]:[]},toEsAggsFn:(t,a,n)=>{var i;return Object(yt.buildExpressionFunction)(ld[e],{id:a,enabled:!0,schema:"metric",field:t.sourceField,timeShift:t.filter?void 0:t.timeShift,emptyAsNull:r?null===(i=t.params)||void 0===i?void 0:i.emptyAsNull:void 0,...o}).toAst()},getGroupByKey:t=>$c(t,[ld[e]],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),getErrorMessage:(e,t,a)=>Vo([No(e,t,a),lo(e,t,a)]),filterable:!0,canReduceTimeRange:!0,documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.metric.signature",{defaultMessage:"field: string"}),description:c||u.i18n.translate("xpack.lens.indexPattern.metric.documentation.markdown",{defaultMessage:"\nReturns the {metric} of a field. This function only works for number fields.\n\nExample: Get the {metric} of price:\n`{metric}(price)`\n\nExample: Get the {metric} of price for orders from the UK:\n`{metric}(price, kql='location:UK')`\n      ",values:{metric:e}})},quickFunctionDocumentation:d,shiftable:!0}}const ud=od({type:"min",displayName:u.i18n.translate("xpack.lens.indexPattern.min",{defaultMessage:"Minimum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.minOf",{defaultMessage:"Minimum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.min.description",{defaultMessage:"A single-value metrics aggregation that returns the minimum value among the numeric values extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.min.quickFunctionDescription",{defaultMessage:"The minimum value of a number field."}),supportsDate:!0,unsupportedSettings:{sampling:!1}}),cd=od({type:"max",displayName:u.i18n.translate("xpack.lens.indexPattern.max",{defaultMessage:"Maximum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.maxOf",{defaultMessage:"Maximum of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.max.description",{defaultMessage:"A single-value metrics aggregation that returns the maximum value among the numeric values extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.max.quickFunctionDescription",{defaultMessage:"The maximum value of a number field."}),supportsDate:!0,unsupportedSettings:{sampling:!1}}),dd=od({type:"average",priority:2,displayName:u.i18n.translate("xpack.lens.indexPattern.avg",{defaultMessage:"Average"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.avgOf",{defaultMessage:"Average of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.avg.description",{defaultMessage:"A single-value metric aggregation that computes the average of numeric values that are extracted from the aggregated documents"}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.avg.quickFunctionDescription",{defaultMessage:"The mean value of a set of number fields."})}),pd=od({type:"standard_deviation",displayName:u.i18n.translate("xpack.lens.indexPattern.standardDeviation",{defaultMessage:"Standard deviation"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.standardDeviationOf",{defaultMessage:"Standard deviation of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.description",{defaultMessage:"A single-value metric aggregation that computes the standard deviation of numeric values that are extracted from the aggregated documents"}),aggConfigParams:{showBounds:!1},documentationDescription:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.documentation.markdown",{defaultMessage:"\nReturns the amount of variation or dispersion of the field. The function works only for number fields.\n\n#### Examples\n\nTo get the standard deviation of price, use `standard_deviation(price)`.\n\nTo get the variance of price for orders from the UK, use `square(standard_deviation(price, kql='location:UK'))`.\n      "}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.standardDeviation.quickFunctionDescription",{defaultMessage:"The standard deviation of the values of a number field which is the amount of variation of the fields values."})}),md=od({type:"sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.sum",{defaultMessage:"Sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.sumOf",{defaultMessage:"Sum of {name}",values:{name:e}}),optionalTimeScaling:!0,description:u.i18n.translate("xpack.lens.indexPattern.sum.description",{defaultMessage:"A single-value metrics aggregation that sums up numeric values that are extracted from the aggregated documents."}),hideZeroOption:!0,quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.sum.quickFunctionDescription",{defaultMessage:"The total amount of the values of a number field."})}),gd=od({type:"median",priority:3,displayName:u.i18n.translate("xpack.lens.indexPattern.median",{defaultMessage:"Median"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.medianOf",{defaultMessage:"Median of {name}",values:{name:e}}),description:u.i18n.translate("xpack.lens.indexPattern.median.description",{defaultMessage:"A single-value metrics aggregation that computes the median value that are extracted from the aggregated documents."}),quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.median.quickFunctionDescription",{defaultMessage:"The median value of a number field."})}),{isValidInterval:fd}=is.search.aggs,bd="auto",vd=new Set(["w","M","q","y"]);function hd(e,t){if(Object.values(e.columns).some((e=>e.timeShift&&""!==e.timeShift)))return e.columnOrder.filter((t=>"date_histogram"===e.columns[t].operationType)).length<2?void 0:u.i18n.translate("xpack.lens.indexPattern.multipleDateHistogramsError",{defaultMessage:'"{dimensionLabel}" is not the only date histogram. When using time shifts, make sure to only use one date histogram.',values:{dimensionLabel:e.columns[t].label}})}const xd={type:"date_histogram",displayName:u.i18n.translate("xpack.lens.indexPattern.dateHistogram",{defaultMessage:"Date histogram"}),input:"field",priority:5,operationParams:[{name:"interval",type:"string",required:!1}],getErrorMessage:(e,t,a)=>[...No(e,t,a)||[],hd(e,t)||""].filter(Boolean),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if(("date"===a||"date_range"===a)&&t&&(!e||e.date_histogram))return{dataType:"date",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t,a)=>Go(e.sourceField,a),buildColumn({field:e},t){var a,n;return{label:e.displayName,dataType:"date",operationType:"date_histogram",sourceField:e.name,isBucketed:!0,scale:"interval",params:{interval:null!==(a=null==t?void 0:t.interval)&&void 0!==a?a:bd,includeEmptyRows:null===(n=null==t?void 0:t.includeEmptyRows)||void 0===n||n,dropPartials:Boolean(null==t?void 0:t.dropPartials)}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"date"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.date_histogram))},onFieldChange:(e,t)=>({...e,label:t.displayName,sourceField:t.name}),toEsAggsFn:(e,t,a)=>{var n,i,s,l,r,o,u;const c=a.getFieldByName(e.sourceField);let d,p=null!==(n=null===(i=e.params)||void 0===i?void 0:i.interval)&&void 0!==n?n:bd;const m=Boolean((null===(s=e.params)||void 0===s?void 0:s.dropPartials)&&(a.timeFieldName===(null==c?void 0:c.name)||!(null!==(l=e.params)&&void 0!==l&&l.ignoreTimeRange)));return c&&c.aggregationRestrictions&&c.aggregationRestrictions.date_histogram&&(p=jd(c.aggregationRestrictions),d=c.aggregationRestrictions.date_histogram.time_zone),Object(yt.buildExpressionFunction)("aggDateHistogram",{id:t,enabled:!0,schema:"segment",field:e.sourceField,time_zone:d,useNormalizedEsInterval:!(null!=c&&null!==(r=c.aggregationRestrictions)&&void 0!==r&&r.date_histogram),interval:p,drop_partials:m,min_doc_count:null!==(o=e.params)&&void 0!==o&&o.includeEmptyRows?0:1,extended_bounds:Object(ca.extendedBoundsToAst)({}),extendToTimeRange:null===(u=e.params)||void 0===u?void 0:u.includeEmptyRows}).toAst()},paramEditor:function({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n,dateRange:i,data:r,indexPattern:o}){const d=a&&o.getFieldByName(a.sourceField),p=d.aggregationRestrictions&&d.aggregationRestrictions.date_histogram,[m,g]=Object(s.useState)(a.params.interval),f=m===bd?bd:yd(m),v=!a.params.ignoreTimeRange&&m===bd||f!==bd&&""!==m&&fd(`${""===f.value?"1":f.value}${f.unit}`,jd(d.aggregationRestrictions)),h=Object(s.useCallback)((e=>{const a=e.target.checked;n((e=>yu({layer:e,columnId:t,paramName:"dropPartials",value:a})))}),[t,n]),y=Object(s.useCallback)((e=>{const a=e!==bd&&vd.has(e.unit),i=e===bd?bd:`${a?"1":e.value}${e.unit||"d"}`;n((e=>yu({layer:e,columnId:t,paramName:"interval",value:i})))}),[t,n]),j=(ca.intervalOptions||[]).filter((e=>e.val!==bd)).map((e=>({label:e.display,key:e.val})),[]);j.unshift({label:u.i18n.translate("xpack.lens.indexPattern.autoIntervalLabel",{defaultMessage:"Auto ({interval})",values:{interval:r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h"}}),key:bd});const O=j.find((e=>e.key===m)),I=O?[O]:[{label:m,key:m}];Object(s.useEffect)((()=>{v&&m!==a.params.interval&&y(yd(m))}),[m,v,a.params.interval,y]);const k=o.timeFieldName===(null==d?void 0:d.name)||!a.params.ignoreTimeRange;return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.includeEmptyRows",{defaultMessage:"Include empty rows"})),checked:Boolean(a.params.includeEmptyRows),"data-test-subj":"indexPattern-include-empty-rows",onChange:()=>{n(yu({layer:e,columnId:t,paramName:"includeEmptyRows",value:!a.params.includeEmptyRows}))},compressed:!0})),o.timeFieldName!==(null==d?void 0:d.name)&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.bindToGlobalTimePicker",{defaultMessage:"Bind to global time picker"})," ",Object(x.jsx)(b.EuiIconTip,{color:"subdued",content:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.globalTimePickerHelp",{defaultMessage:"Filter the selected field by the global time picker in the top right. This setting can't be turned off for the default time field of the current data view."}),iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})),disabled:o.timeFieldName===(null==d?void 0:d.name),checked:k,onChange:()=>{let s=yu({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!a.params.ignoreTimeRange});if(!a.params.ignoreTimeRange&&a.params.interval===bd){const e=r.search.aggs.calculateAutoTimeExpression({from:i.fromDate,to:i.toDate})||"1h";s=yu({layer:s,columnId:t,paramName:"interval",value:e}),g(e)}n(s)},compressed:!0}))),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.minimumInterval",{defaultMessage:"Minimum interval"}),fullWidth:!0,display:"rowCompressed",helpText:Object(x.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionHelpText",{defaultMessage:"Select an option or create a custom value."}),Object(x.jsx)("br",null),u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectOptionExamplesHelpText",{defaultMessage:"Examples: 30s, 20m, 24h, 2d, 1w, 1M"})),isInvalid:!v,error:!v&&u.i18n.translate("xpack.lens.indexPattern.dateHistogram.invalidInterval",{defaultMessage:"Please pick a valid interval. It's not possible to use multiple weeks, months or years as interval."})},p?Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.restrictedInterval",defaultMessage:"Interval fixed to {intervalValue} due to aggregation restrictions.",values:{intervalValue:jd(d.aggregationRestrictions)}}):Object(x.jsx)(b.EuiComboBox,{compressed:!0,fullWidth:!0,"data-test-subj":"lensDateHistogramInterval",isInvalid:!v,onChange:i=>{const s=i.length?i[0].key:"";g(s),s===bd&&a.params.ignoreTimeRange&&n(yu({layer:e,columnId:t,paramName:"ignoreTimeRange",value:!1}))},onCreateOption:e=>g(e.trim()),options:j,selectedOptions:I,singleSelection:{asPlainText:!0},placeholder:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.selectIntervalPlaceholder",{defaultMessage:"Select an interval"})})),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(be.a,{tooltipContent:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBucketsHelp",{defaultMessage:"Drop partial intervals is disabled as these can be computed only for a time field bound to global time picker in the top right."}),condition:!k},Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.dateHistogram.dropPartialBuckets",{defaultMessage:"Drop partial intervals"})),"data-test-subj":"lensDropPartialIntervals",checked:Boolean(a.params.dropPartials),onChange:h,compressed:!0,disabled:!k}))))},helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.titleHelp",{defaultMessage:"How Date histogram works"}),helpComponent(){const e=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.moreThanYear",{defaultMessage:"More than a year"}),t=u.i18n.translate("xpack.lens.indexPattern.dateHistogram.upTo",{defaultMessage:"Up to"});return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBasicExplanation",{defaultMessage:"Date histogram splits data into time intervals."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.dateHistogram.autoLongerExplanation",defaultMessage:"To choose the interval, Lens divides the specified time range by the {targetBarSetting} Advanced Setting and calculates the best interval for your data. For example, when the time range is 4 days, the data is divided into hourly buckets. To configure the maximum number of bars, use the {maxBarSetting} Advanced Setting.",values:{maxBarSetting:Object(x.jsx)(b.EuiCode,null,is.UI_SETTINGS.HISTOGRAM_MAX_BARS),targetBarSetting:Object(x.jsx)(b.EuiCode,null,is.UI_SETTINGS.HISTOGRAM_BAR_TARGET)}})),Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoAdvancedExplanation",{defaultMessage:"The interval follows this logic:"})),Object(x.jsx)(b.EuiBasicTable,{items:is.search.aggs.boundsDescendingRaw.map((({bound:a,boundLabel:n,intervalLabel:i})=>({bound:"number"==typeof a?e:`${t} ${n}`,interval:i}))),columns:[{field:"bound",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoBoundHeader",{defaultMessage:"Target interval measured"})},{field:"interval",name:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.autoIntervalHeader",{defaultMessage:"Interval used"})}]}))},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.dateHistogram.documentation.quick",{defaultMessage:"\nThe date or date range values distributed into intervals.\n      "})};function yd(e){const t=e||"",a=t.match(/[\d]+/)||[],n=t.match(/[\D]+/)||[],i=parseInt(a[0]||"",10);return{value:isNaN(i)?"":i,unit:n[0]||"h"}}function jd(e){if(e&&e.date_histogram)return e.date_histogram.calendar_interval||e.date_histogram.fixed_interval}const Od=e=>(t,a,n)=>Hc(e(t),void 0,a,void 0,n,void 0,void 0);function Id(e,t){if(e===z.LayerTypes.REFERENCELINE)return[u.i18n.translate("xpack.lens.indexPattern.calculations.layerDataType",{defaultMessage:"{name} is disabled for this type of layer.",values:{name:t}})]}function kd(e,t){if(!e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>"date_histogram"===e.columns[t].operationType)))return[u.i18n.translate("xpack.lens.indexPattern.calculations.dateHistogramErrorMessage",{defaultMessage:"{name} requires a date histogram to work. Add a date histogram or select a different function.",values:{name:t}})]}const Td=ar()((e=>{const t=new Set;return Object.entries(e.columns).forEach((([a,n])=>{"references"in n&&"managedReference"===Tp[n.operationType].input&&(t.add(a),Ru(a,e.columns).map((([e])=>{t.add(e)})))})),t}));function Md(e,t,a){var n,i;const s=null!==(n=kd(e,a))&&void 0!==n?n:[],l=null!==(i=function(e,t){const a=e.columns[t],n=[];return a.references.forEach(((i,s)=>{if(e.columns[i]){const l=e.columns[i],r=Tp[a.operationType];if("fullReference"!==r.input)throw new Error("inconsistent state - column is not a reference operation");Du({validation:r.requiredReferences[s],column:l})||Td(e).has(t)||n.push(u.i18n.translate("xpack.lens.indexPattern.invalidReferenceConfiguration",{defaultMessage:'Dimension "{dimensionLabel}" is configured incorrectly',values:{dimensionLabel:a.label}}))}else n.push(u.i18n.translate("xpack.lens.indexPattern.missingReferenceError",{defaultMessage:'"{dimensionLabel}" is not fully configured',values:{dimensionLabel:a.label}}))})),n.length?n:void 0}(e,t))&&void 0!==i?i:[];if(s.length||l.length)return[...s,...l]}function wd(e){return e.fields.some((e=>"date"===e.type))}function Cd(e,t,a,n={}){const i=e.columns[t],s=e.columnOrder.filter((t=>e.columns[t].isBucketed)),l=s.findIndex((t=>"date_histogram"===e.columns[t].operationType));return s.splice(l,1),[{type:"function",function:a,arguments:{by:s,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}const Ed=Od((e=>u.i18n.translate("xpack.lens.indexPattern.CounterRateOf",{defaultMessage:"Counter rate of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Sd={type:"counter_rate",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["max"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getUnsupportedSettings:()=>({sampling:!1}),getPossibleOperation:e=>{if(wd(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=t[e.references[0]];return Ed(i&&"sourceField"in i?null==a||null===(n=a.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,e.timeScale,e.timeShift)},toExpression:(e,t)=>Cd(e,t,"lens_counter_rate"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var s;const l=a.columns[e[0]],r=i,o=(null==t?void 0:t.timeScale)||(null==r?void 0:r.timeScale)||"s";return{label:Ed(l&&"sourceField"in l?null===(s=n.getFieldByName(l.sourceField))||void 0===s?void 0:s.displayName:void 0,o,null==t?void 0:t.timeShift),dataType:"number",operationType:"counter_rate",isBucketed:!1,scale:"ratio",references:e,timeScale:o,timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:Qo(t,i),params:Wo(t)}},isTransferable:(e,t)=>wd(t),getErrorMessage:(e,t)=>Md(e,t,u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"})),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.counterRate",{defaultMessage:"Counter rate"});if(a){const e=Id(a,i);if(e)return e.join(", ")}return null===(n=kd(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"mandatory",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.counterRate.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.markdown",{defaultMessage:"\nCalculates the rate of an ever increasing counter. This function will only yield helpful results on counter metric fields which contain a measurement of some kind monotonically growing over time.\nIf the value does get smaller, it will interpret this as a counter reset. To get most precise results, `counter_rate` should be calculated on the `max` of a field.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\nIt uses the current interval when used in Formula.\n\nExample: Visualize the rate of bytes received over time by a memcached server:\n`counter_rate(max(memcached.stats.read.bytes))`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.counterRate.documentation.quick",{defaultMessage:"\n      The rate of change over time for an ever growing time series metric.\n      "}),shiftable:!0},Fd=Od((e=>u.i18n.translate("xpack.lens.indexPattern.cumulativeSumOf",{defaultMessage:"Cumulative sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Pd={type:"cumulative_sum",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"}),input:"fullReference",selectionStyle:"field",requiredReferences:[{input:["field","managedReference"],specificOperations:["count","sum"],validateMetadata:(e,t,a)=>!("number"!==e.dataType||e.isBucketed||"count"===t&&a!==It.DOCUMENT_FIELD_NAME)}],getPossibleOperation:e=>{if(wd(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;const i=t[e.references[0]];return Fd(i&&"sourceField"in i?null==a||null===(n=a.getFieldByName(i.sourceField))||void 0===n?void 0:n.displayName:void 0,void 0,e.timeShift)},toExpression:(e,t)=>Cd(e,t,"cumulative_sum"),buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>{var s;const l=a.columns[e[0]];return{label:Fd(l&&"sourceField"in l?null===(s=n.getFieldByName(l.sourceField))||void 0===s?void 0:s.displayName:void 0,void 0,null==t?void 0:t.timeShift),dataType:"number",operationType:"cumulative_sum",isBucketed:!1,scale:"ratio",timeShift:(null==i?void 0:i.shift)||(null==t?void 0:t.timeShift),filter:Qo(t,i),references:e,params:Wo(t)}},isTransferable:()=>!0,getErrorMessage:(e,t)=>Md(e,t,u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"})),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.cumulativeSum",{defaultMessage:"Cumulative sum"});if(a){const e=Id(a,i);if(e)return e.join(", ")}return null===(n=kd(t,i))||void 0===n?void 0:n.join(", ")},filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.cumulative_sum.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.markdown",{defaultMessage:"\nCalculates the cumulative sum of a metric over time, adding all previous values of a series to each value. To use this function, you need to configure a date histogram dimension as well.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the received bytes accumulated over time:\n`cumulative_sum(sum(bytes))`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.cumulativeSum.documentation.quick",{defaultMessage:"\n      The sum of all values as they grow over time.\n      "}),shiftable:!0},_d="differences",Ad=Od((e=>u.i18n.translate("xpack.lens.indexPattern.derivativeOf",{defaultMessage:"Differences of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Ld={type:_d,priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:e=>{if(wd(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return Ad(null===(n=t[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>Cd(e,t,"derivative"),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const s=a.columns[e[0]],l=null!==(i=null==n?void 0:n.timeScale)&&void 0!==i?i:null==t?void 0:t.timeScale;return{label:Ad(null==s?void 0:s.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:_d,isBucketed:!1,scale:"ratio",references:e,timeScale:l,filter:Qo(t,n),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),params:Wo(t)}},isTransferable:(e,t)=>wd(t),getErrorMessage:(e,t)=>Md(e,t,u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"})),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.derivative",{defaultMessage:"Differences"});if(a){const e=Id(a,i);if(e)return e.join(", ")}return null===(n=kd(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.differences.signature",{defaultMessage:"metric: number"}),description:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.markdown",{defaultMessage:"\nCalculates the difference to the last value of a metric over time. To use this function, you need to configure a date histogram dimension as well.\nDifferences requires the data to be sequential. If your data is empty when using differences, try increasing the date histogram interval.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nExample: Visualize the change in bytes received over time:\n`differences(sum(bytes))`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.differences.documentation.quick",{defaultMessage:"\n      The change between the values in subsequent intervals.\n      "}),shiftable:!0},Dd=Od((e=>u.i18n.translate("xpack.lens.indexPattern.movingAverageOf",{defaultMessage:"Moving average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}))),Rd={type:"moving_average",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"}),input:"fullReference",selectionStyle:"full",requiredReferences:[{input:["field","managedReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"window",type:"number",required:!1,defaultValue:5}],getPossibleOperation:e=>{if(wd(e))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>{var n;return Dd(null===(n=t[e.references[0]])||void 0===n?void 0:n.label,e.timeScale,e.timeShift)},toExpression:(e,t)=>Cd(e,t,"moving_average",{window:[e.columns[t].params.window]}),buildColumn:({referenceIds:e,previousColumn:t,layer:a},n)=>{var i;const s=a.columns[e[0]],l=null!==(i=null==n?void 0:n.window)&&void 0!==i?i:5;return{label:Dd(null==s?void 0:s.label,null==t?void 0:t.timeScale,null==t?void 0:t.timeShift),dataType:"number",operationType:"moving_average",isBucketed:!1,scale:"ratio",references:e,timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),filter:Qo(t,n),timeScale:null==t?void 0:t.timeScale,params:{window:l,...Wo(t)}}},paramEditor:function({layer:e,paramEditorUpdater:t,currentColumn:a,columnId:n}){const[i,l]=Object(s.useState)(String(a.params.window));return Object(k.s)((()=>{if(!qo(i,!0,void 0,1))return;const a=parseInt(i,10);t(yu({layer:e,columnId:n,paramName:"window",value:a}))}),{skipFirstRender:!0},256,[i]),Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.movingAverage.window",{defaultMessage:"Window size"}),display:"rowCompressed",fullWidth:!0,isInvalid:!qo(i)},Object(x.jsx)(b.EuiFieldNumber,{fullWidth:!0,compressed:!0,value:i,onChange:e=>l(e.target.value),min:1,step:1,isInvalid:!qo(i)}))},isTransferable:(e,t)=>wd(t),getErrorMessage:(e,t)=>Md(e,t,u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"})),helpComponent:()=>Object(x.jsx)(Bd,null),helpComponentTitle:u.i18n.translate("xpack.lens.indexPattern.movingAverage.titleHelp",{defaultMessage:"How moving average works"}),getDisabledStatus(e,t,a){var n;const i=u.i18n.translate("xpack.lens.indexPattern.movingAverage",{defaultMessage:"Moving average"});if(a){const e=Id(a,i);if(e)return e.join(", ")}return null===(n=kd(t,i))||void 0===n?void 0:n.join(", ")},timeScalingMode:"optional",filterable:!0,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.moving_average.signature",{defaultMessage:"metric: number, [window]: number"}),description:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.markdown",{defaultMessage:"\nCalculates the moving average of a metric over time, averaging the last n-th values to calculate the current value. To use this function, you need to configure a date histogram dimension as well.\nThe default window value is {defaultValue}.\n\nThis calculation will be done separately for separate series defined by filters or top values dimensions.\n\nTakes a named parameter `window` which specifies how many last values to include in the average calculation for the current value.\n\nExample: Smooth a line of measurements:\n`moving_average(sum(bytes), window=5)`\n      ",values:{defaultValue:5}})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.movingAverage.documentation.quick",{defaultMessage:"\n      The average of a moving window of values over time.\n      "}),shiftable:!0},Bd=()=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.basicExplanation",defaultMessage:"Moving average slides a window across the data and displays the average value. Moving average is supported only by date histograms."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.longerExplanation",defaultMessage:"To calculate the moving average, Lens uses the mean of the window and applies a skip policy for gaps.  For missing values, the bucket is skipped, and the calculation is performed on the next value."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.tableExplanation",defaultMessage:"For example, given the data [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], you can calculate a simple moving average with a window size of 5:"})),Object(x.jsx)("ul",null,Object(x.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3"),Object(x.jsx)("li",null,"(2 + 3 + 4 + 5 + 6) / 5 = 4"),Object(x.jsx)("li",null,"..."),Object(x.jsx)("li",null,"(5 + 6 + 7 + 8 + 9) / 5 = 7")),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowLimitations",defaultMessage:"The window does not include the current value."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.windowInitialPartial",defaultMessage:"The window is partial until it reaches the requested number of items.  For example, with a window size of 5:"})),Object(x.jsx)("ul",null,Object(x.jsx)("li",null,"(1 + 2) / 2 = 1.5"),Object(x.jsx)("li",null,"(1 + 2 + 3) / 3 = 2"),Object(x.jsx)("li",null,"(1 + 2 + 3 + 4) / 4 = 2.5"),Object(x.jsx)("li",null,"(1 + 2 + 3 + 4 + 5) / 5 = 3")),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.movingAverage.limitations",defaultMessage:"The first moving average value starts at the second item."})));function Nd({type:e,displayName:t,ofName:a,description:n,metric:i}){return{type:e,priority:1,displayName:t,input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,n)=>{var i;const s=t[e.references[0]];return a(s&&"sourceField"in s?null==n||null===(i=n.getFieldByName(s.sourceField))||void 0===i?void 0:i.displayName:void 0)},toExpression:(e,t)=>function(e,t,a,n={}){const i=e.columns[t],s=e.columnOrder.filter((t=>e.columns[t].isBucketed)),l=s.filter((t=>"date_histogram"!==e.columns[t].operationType&&"range"!==e.columns[t].operationType));return[{type:"function",function:a,arguments:{by:l.length===s.length?[]:l,inputColumnId:[i.references[0]],outputColumnId:[t],outputColumnName:[i.label],...n}}]}(e,t,"overall_metric",{metric:[i]}),buildColumn:({referenceIds:e,previousColumn:t,layer:n,indexPattern:s},l)=>{var r;const o=n.columns[e[0]];return{label:a(o&&"sourceField"in o?null===(r=s.getFieldByName(o.sourceField))||void 0===r?void 0:r.displayName:void 0),dataType:"number",operationType:`overall_${i}`,isBucketed:!1,scale:"ratio",references:e,params:Wo(t)}},isTransferable:()=>!0,filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.overall_metric",{defaultMessage:"metric: number"}),description:n}}}const zd=Nd({type:"overall_sum",displayName:u.i18n.translate("xpack.lens.indexPattern.overallSum",{defaultMessage:"Overall sum"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallSumOf",{defaultMessage:"Overall sum of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"sum",description:u.i18n.translate("xpack.lens.indexPattern.overall_sum.documentation.markdown",{defaultMessage:"\nCalculates the sum of a metric of all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_sum` is calculating the sum over all dimensions no matter the used function.\n\nExample: Percentage of total\n`sum(bytes) / overall_sum(sum(bytes))`\n      "})}),Vd=Nd({type:"overall_min",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMin",{defaultMessage:"Overall min"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMinOf",{defaultMessage:"Overall min of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"min",description:u.i18n.translate("xpack.lens.indexPattern.overall_min.documentation.markdown",{defaultMessage:"\nCalculates the minimum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_min` is calculating the minimum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes)) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),Gd=Nd({type:"overall_max",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallMaxOf",{defaultMessage:"Overall max of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"max",description:u.i18n.translate("xpack.lens.indexPattern.overall_max.documentation.markdown",{defaultMessage:"\nCalculates the maximum of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_max` is calculating the maximum over all dimensions no matter the used function\n\nExample: Percentage of range\n`(sum(bytes) - overall_min(sum(bytes))) / (overall_max(sum(bytes)) - overall_min(sum(bytes)))`\n      "})}),qd=Nd({type:"overall_average",displayName:u.i18n.translate("xpack.lens.indexPattern.overallMax",{defaultMessage:"Overall max"}),ofName:e=>u.i18n.translate("xpack.lens.indexPattern.overallAverageOf",{defaultMessage:"Overall average of {name}",values:{name:null!=e?e:u.i18n.translate("xpack.lens.indexPattern.incompleteOperation",{defaultMessage:"(incomplete)"})}}),metric:"average",description:u.i18n.translate("xpack.lens.indexPattern.overall_average.documentation.markdown",{defaultMessage:"\nCalculates the average of a metric for all data points of a series in the current chart. A series is defined by a dimension using a date histogram or interval function.\nOther dimensions breaking down the data like top values or filter are treated as separate series.\n\nIf no date histograms or interval functions are used in the current chart, `overall_average` is calculating the average over all dimensions no matter the used function\n\nExample: Divergence from the mean:\n`sum(bytes) - overall_average(sum(bytes))`\n      "})}),Hd={type:"normalize_by_unit",priority:1,displayName:u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"}),input:"fullReference",selectionStyle:"hidden",requiredReferences:[{input:["field","managedReference","fullReference"],validateMetadata:e=>"number"===e.dataType&&!e.isBucketed}],operationParams:[{name:"unit",type:"string",required:!0}],getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio"}),getDefaultLabel:(e,t,a)=>"normalize_by_unit",toExpression:(e,t)=>{const a=e.columns[t],n=e.columnOrder.filter((t=>e.columns[t].isBucketed)).find((t=>"date_histogram"===e.columns[t].operationType));return[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:n?[n]:[],inputColumnId:[a.references[0]],outputColumnId:[t],outputColumnName:[a.label],targetUnit:[a.params.unit],reducedTimeRange:a.reducedTimeRange?[a.reducedTimeRange]:[]}}]},buildColumn:({referenceIds:e,previousColumn:t,layer:a,indexPattern:n},i)=>({label:"Normalize by unit",dataType:"number",operationType:"normalize_by_unit",isBucketed:!1,scale:"ratio",references:e,params:{...Wo(t),unit:null==i?void 0:i.unit}}),isTransferable:()=>!0,getErrorMessage:(e,t)=>Vo([Md(e,t,u.i18n.translate("xpack.lens.indexPattern.timeScale",{defaultMessage:"Normalize by unit"})),e.columns[t].params.unit?[]:[u.i18n.translate("xpack.lens.indexPattern.timeScale.missingUnit",{defaultMessage:"No unit specified for normalize by unit."})],-1===["s","m","h","d"].indexOf(e.columns[t].params.unit||"s")?[u.i18n.translate("xpack.lens.indexPattern.timeScale.wrongUnit",{defaultMessage:"Unknown unit specified: use s, m, h or d."})]:[]]),filterable:!1,shiftable:!1,documentation:{section:"calculation",signature:u.i18n.translate("xpack.lens.indexPattern.time_scale",{defaultMessage:"metric: number, unit: s|m|h|d|w|M|y"}),description:u.i18n.translate("xpack.lens.indexPattern.time_scale.documentation.markdown",{defaultMessage:"\n\nThis advanced function is useful for normalizing counts and sums to a specific time interval. It allows for integration with metrics that are stored already normalized to a specific time interval.\n\nThis function can only be used if there's a date histogram function used in the current chart.\n\nExample: A ratio comparing an already normalized metric to another metric that needs to be normalized.\n`normalize_by_unit(counter_rate(max(system.diskio.write.bytes)), unit='s') / last_value(apache.status.bytes_per_second)`\n      "})}},Ud=u.i18n.translate("xpack.lens.indexPattern.countOf",{defaultMessage:"Count of records"}),$d=new Set(["string","boolean","number","number_range","ip","ip_range","date","date_range","murmur3"]);function Wd(e,t,a,n){return null!=e&&e.customLabel&&"document"!==(null==e?void 0:e.type)?e.customLabel:Hc("document"!==(null==e?void 0:e.type)?u.i18n.translate("xpack.lens.indexPattern.valueCountOf",{defaultMessage:"Count of {name}",values:{name:(null==e?void 0:e.displayName)||"-"}}):Ud,void 0,a,void 0,t,void 0,n)}const Xd={type:"count",displayName:u.i18n.translate("xpack.lens.indexPattern.count",{defaultMessage:"Count"}),input:"field",getErrorMessage:(e,t,a)=>Vo([No(e,t,a),lo(e,t,a)]),allowAsReference:!0,onFieldChange:(e,t)=>({...e,label:Wd(t,e.timeShift,e.timeShift,e.reducedTimeRange),sourceField:t.name}),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a,timeSeriesMetric:n})=>{if("document"===a||t&&"counter"!==n&&(!e||e.value_count)&&$d.has(a))return{dataType:"number",isBucketed:!1,scale:"ratio"}},getDefaultLabel:(e,t,a)=>Wd(null==a?void 0:a.getFieldByName(e.sourceField),e.timeShift,e.timeScale,e.reducedTimeRange),buildColumn({field:e,previousColumn:t},a){var n;return{label:Wd(e,null==t?void 0:t.timeShift,null==t?void 0:t.timeScale,null==t?void 0:t.reducedTimeRange),dataType:"number",operationType:"count",isBucketed:!1,scale:"ratio",sourceField:e.name,timeScale:null==t?void 0:t.timeScale,filter:Qo(t,a),timeShift:(null==a?void 0:a.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==a?void 0:a.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{...Wo(t),emptyAsNull:t&&Ho("count",t)?null===(n=t.params)||void 0===n?void 0:n.emptyAsNull:!(null!=a&&a.usedInMath)}}},getAdvancedOptions:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n})=>{var i;return[{dataTestSubj:"hide-zero-values",inlineElement:Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.hideZero",{defaultMessage:"Hide zero values"})),labelProps:{style:{fontWeight:re.euiThemeVars.euiFontWeightMedium}},checked:Boolean(null===(i=a.params)||void 0===i?void 0:i.emptyAsNull),onChange:()=>{var i;n(yu({layer:e,columnId:t,paramName:"emptyAsNull",value:!(null!==(i=a.params)&&void 0!==i&&i.emptyAsNull)}))},compressed:!0})}]},toEsAggsFn:(e,t,a)=>{const n=a.getFieldByName(e.sourceField);var i,s;return"document"===(null==n?void 0:n.type)?Object(yt.buildExpressionFunction)("aggCount",{id:t,enabled:!0,schema:"metric",timeShift:e.filter||e.reducedTimeRange?void 0:e.timeShift,emptyAsNull:null===(i=e.params)||void 0===i?void 0:i.emptyAsNull}).toAst():Object(yt.buildExpressionFunction)("aggValueCount",{id:t,enabled:!0,schema:"metric",field:e.sourceField,timeShift:e.filter||e.reducedTimeRange?void 0:e.timeShift,emptyAsNull:null===(s=e.params)||void 0===s?void 0:s.emptyAsNull}).toAst()},getGroupByKey:e=>$c(e,["aggCount","aggValueCount"],[{name:"field"},{name:"emptyAsNull",transformer:e=>String(Boolean(e))}]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&("document"===a.type||$d.has(a.type)&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.cardinality)))},timeScalingMode:"optional",filterable:!0,canReduceTimeRange:!0,documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.count.signature",{defaultMessage:"[field: string]"}),description:u.i18n.translate("xpack.lens.indexPattern.count.documentation.markdown",{defaultMessage:"\nThe total number of documents. When you provide a field, the total number of field values is counted. When you use the Count function for fields that have multiple values in a single document, all values are counted.\n\n#### Examples\n\nTo calculate the total number of documents, use `count()`.\n\nTo calculate the number of products in all orders, use `count(products.id)`.\n\nTo calculate the number of documents that match a specific filter, use `count(kql='price > 500')`.\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.count.documentation.quick",{defaultMessage:"\nThe total number of documents. When you provide a field, the total number of field values is counted. When you use the Count function for fields that have multiple values in a single document, all values are counted.\n      "}),shiftable:!0},Yd=u.i18n.translate("xpack.lens.indexPattern.staticValueLabelDefault",{defaultMessage:"Static value"});function Qd(e){return function(e){return null==e||""===e}(e)?Yd:u.i18n.translate("xpack.lens.indexPattern.staticValueLabelWithValue",{defaultMessage:"Static value: {value}",values:{value:e}})}const Kd={type:"static_value",displayName:Yd,getDefaultLabel:e=>Qd(e.params.value),input:"managedReference",hidden:!0,getDisabledStatus(e){},getErrorMessage(e,t){const a=e.columns[t],n=qo(a.params.value,!1,void 0,void 0,15);return null==a.params.value||n?void 0:[u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:a.params.value}})]},getPossibleOperation:()=>({dataType:"number",isBucketed:!1,scale:"ratio",isStaticValue:!0}),toExpression:(e,t)=>{var a;const n=e.columns[t],i=n.params,s=n.label!==Yd,l=qo(i.value,!1,void 0,void 0,15);return[{type:"function",function:l?"mathColumn":"mapColumn",arguments:{id:[t],name:[(l?s?n.label:null!==(a=null==i?void 0:i.value)&&void 0!==a?a:Yd:Yd)||Yd],expression:[String(l?i.value:100)]}}]},buildColumn({previousColumn:e,layer:t,indexPattern:a},n,i){var s,l;const r={value:e&&(l=e,Boolean("params"in l&&l.params&&"value"in l.params))&&qo(e.params.value)?e.params.value:void 0,...Wo(e),...n};return{label:Qd(r.value),dataType:"number",operationType:"static_value",isStaticValue:!0,isBucketed:!1,scale:"ratio",params:{...r,value:String(null!==(s=r.value)&&void 0!==s?s:100)},references:[]}},isTransferable:e=>!0,createCopy(e,t,a){const n=e[t.layerId].columns[t.columnId],i=e[a.layerId],s={...i.columns,[a.columnId]:{...n}};return{...e,[a.layerId]:{...i,columns:s,columnOrder:ku({...i,columns:s})}}},paramEditor:function({paramEditorUpdater:e,currentColumn:t,columnId:a,activeData:n,layerId:i,paramEditorCustomProps:l}){var r,o,c,d,p;const m=Object(s.useCallback)((n=>{t.params.value!==n&&qo(n,!1,void 0,void 0,15)&&e((e=>{const t=e.columns[a];return{...e,columns:{...e.columns,[a]:{...t,label:null!=t&&t.customLabel?t.label:Qd(n),params:{...t.params,value:n}}}}}))}),[a,e,null==t||null===(r=t.params)||void 0===r?void 0:r.value]),g=1===(null==n||null===(o=n[i])||void 0===o||null===(c=o.rows)||void 0===c?void 0:c.length)&&n[i].rows[0][a],f="static_value"!==(null==t?void 0:t.operationType)&&null!=g?g:String(100),{inputValue:v,handleInputChange:h}=Object(Z.a)({value:(null==t||null===(d=t.params)||void 0===d?void 0:d.value)||f,onChange:m},{allowFalsyValue:!0}),y=Object(s.useCallback)((e=>{const t=e.currentTarget.value;h(t)}),[h]),j=qo(v,!1,void 0,void 0,15);return Object(x.jsx)(b.EuiFormRow,{label:(null==l||null===(p=l.labels)||void 0===p?void 0:p[0])||Yd,fullWidth:!0,isInvalid:!j,error:!j&&u.i18n.translate("xpack.lens.indexPattern.staticValueError",{defaultMessage:"The static value of {value} is not a valid number",values:{value:null!=v?v:"''"}})},Object(x.jsx)(b.EuiFieldNumber,{fullWidth:!0,"data-test-subj":"lns-indexPattern-static_value-input",compressed:!0,value:null!=v?v:"",onChange:y,step:"any"}))}};function Zd(e,t,a){return Hc(u.i18n.translate("xpack.lens.indexPattern.lastValueOf",{defaultMessage:"Last value of {name}",values:{name:e}}),void 0,void 0,void 0,t,void 0,a)}const Jd=new Set(["string","boolean","number","ip","date","ip_range","number_range","date_range"]);function ep(e,t,a){if(!a)return;const n=a.getFieldByName(e);return n?"date"!==n.type?u.i18n.translate("xpack.lens.indexPattern.lastValue.invalidTypeSortField",{defaultMessage:"Field {invalidField} is not a date field and cannot be used for sorting",values:{invalidField:e}}):void 0:{message:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.lastValue.sortFieldNotFound",defaultMessage:"Sort field {sortField} was not found.",values:{sortField:Object(x.jsx)("strong",null,e)}}),displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t},{id:"embeddableBadge"}]}}function tp(e){return e.timeFieldName&&e.fields.find((t=>t.name===e.timeFieldName&&"date"===t.type))}function ap(e){const t=e.fields.filter((e=>"date"===e.type));return tp(e)&&t.sort((({name:t},{name:a})=>t===e.timeFieldName?-1:a===e.timeFieldName?1:0)),t}function np(e,t){return Ic(e)||function(e){return Boolean(e.runtime)}(e)&&"number"!==e.type||(null==t?void 0:t.showArrayValues)}function ip(e){return"string"===e||"ip"===e||"ip_range"===e||"date_range"===e||"number_range"===e?"ordinal":"ratio"}const sp={type:"last_value",displayName:u.i18n.translate("xpack.lens.indexPattern.lastValue",{defaultMessage:"Last value"}),getDefaultLabel:(e,t,a)=>Zd(Go(e.sourceField,a),e.timeShift,e.reducedTimeRange),input:"field",onFieldChange:(e,t)=>{const a={...e.params};return a.showArrayValues=np(t,e.params),"format"in a&&"number"!==t.type&&delete a.format,{...e,dataType:t.type,label:Zd(t.displayName,e.timeShift,e.reducedTimeRange),sourceField:t.name,params:a,scale:ip(t.type),filter:e.filter&&Yo(e.filter,e.sourceField)?Xo(t.name):e.filter}},getPossibleOperationForField:({aggregationRestrictions:e,type:t})=>{if(Jd.has(t)&&!e)return{dataType:t,isBucketed:!1,scale:ip(t)}},getDisabledStatus(e){if(!e||!ap(e).length)return u.i18n.translate("xpack.lens.indexPattern.lastValue.disabled",{defaultMessage:"This function requires the presence of a date field in your data view"})},getErrorMessage(e,t,a){const n=e.columns[t],i=[],s=No(e,t,a);s&&i.push(...s);const l=ep(n.params.sortField,t,a);return l&&i.push(l),i.push(...lo(e,t,a)||[]),i.length?i:void 0},buildColumn({field:e,previousColumn:t,indexPattern:a},n){var i;const s=n,l=tp(a)?a.timeFieldName:null===(i=a.fields.find((e=>"date"===e.type)))||void 0===i?void 0:i.name;if(!l)throw new Error(u.i18n.translate("xpack.lens.functions.lastValue.missingSortField",{defaultMessage:"This data view does not contain any date fields"}));const r=np(e,s);return{label:Zd(e.displayName,null==t?void 0:t.timeShift,null==t?void 0:t.reducedTimeRange),dataType:e.type,operationType:"last_value",isBucketed:!1,scale:ip(e.type),sourceField:e.name,filter:Qo(t,n)||Xo(e.name),timeShift:(null==n?void 0:n.shift)||(null==t?void 0:t.timeShift),reducedTimeRange:(null==n?void 0:n.reducedTimeRange)||(null==t?void 0:t.reducedTimeRange),params:{showArrayValues:r,sortField:(null==s?void 0:s.sortField)||l,...Wo(t)}}},filterable:!0,canReduceTimeRange:!0,shiftable:!0,toEsAggsFn:(e,t,a)=>{var n;const i={id:t,enabled:!0,schema:"metric",field:e.sourceField,size:1,sortOrder:"desc",sortField:e.params.sortField,timeShift:e.filter?void 0:e.timeShift},s="counter"===(null===(n=a.getFieldByName(e.sourceField))||void 0===n?void 0:n.timeSeriesMetric);return(e.params.showArrayValues&&!s?Object(yt.buildExpressionFunction)("aggTopHit",{...i,aggregate:"concat"}):Object(yt.buildExpressionFunction)("aggTopMetrics",i)).toAst()},getGroupByKey:e=>$c(e,["aggTopHit","aggTopMetrics"],[{name:"field"},{name:"sortField"}]),isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField),n=t.getFieldByName(e.params.sortField);return Boolean(a&&a.type===e.dataType&&!a.aggregationRestrictions&&"date"===(null==n?void 0:n.type)&&Jd.has(a.type))},allowAsReference:!0,paramEditor:({layer:e,paramEditorUpdater:t,currentColumn:a,indexPattern:n,isReferenced:i,paramEditorCustomProps:s})=>{var r,o;const{labels:c,isInline:d}=s||{},p=(null==c?void 0:c[0])||u.i18n.translate("xpack.lens.indexPattern.lastValue.sortField",{defaultMessage:"Sort by date field"}),m=ap(n),g=!!ep(a.params.sortField,"",n),f=Object.keys(e.columns).some((t=>"terms"===e.columns[t].operationType));return Object(x.jsx)(l.a.Fragment,null,!i&&Object(x.jsx)(b.EuiFormRow,{error:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesWithTopValuesWarning",{defaultMessage:"When you show array values, you are unable to use this field to rank top values."}),isInvalid:a.params.showArrayValues&&f,display:"rowCompressed",fullWidth:!0,"data-test-subj":"lns-indexPattern-lastValue-showArrayValues"},Object(x.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValuesExplanation",{defaultMessage:"Displays all values associated with this field in each last document."}),position:"left"},Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.lastValue.showArrayValues",{defaultMessage:"Show array values"})),compressed:!0,checked:Boolean(a.params.showArrayValues),disabled:Ic(a.sourceField,n),onChange:()=>{return e=!a.params.showArrayValues,t({...a,params:{...a.params,showArrayValues:e}});var e}}))),Object(x.jsx)(sc,{isInline:d,label:p,display:"rowCompressed",fullWidth:!0,error:u.i18n.translate("xpack.lens.indexPattern.sortField.invalid",{defaultMessage:"Invalid field. Check your data view or pick another field."}),isInvalid:g},Object(x.jsx)(b.EuiComboBox,{placeholder:u.i18n.translate("xpack.lens.indexPattern.lastValue.sortFieldPlaceholder",{defaultMessage:"Sort field"}),fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"lns-indexPattern-lastValue-sortField",isInvalid:g,singleSelection:{asPlainText:!0},"aria-label":p,options:null==m?void 0:m.map((e=>({value:e.name,label:e.displayName}))),onChange:e=>{if(0!==e.length)return t({...a,params:{...a.params,sortField:e[0].value}})},selectedOptions:null!==(r=a.params)&&void 0!==r&&r.sortField?[{label:(null===(o=n.getFieldByName(a.params.sortField))||void 0===o?void 0:o.displayName)||a.params.sortField,value:a.params.sortField}]:[]})))},documentation:{section:"elasticsearch",signature:u.i18n.translate("xpack.lens.indexPattern.lastValue.signature",{defaultMessage:"field: string"}),description:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.markdown",{defaultMessage:"\nReturns the value of a field from the last document, ordered by the default time field of the data view.\n\nThis function is usefull the retrieve the latest state of an entity.\n\nExample: Get the current status of server A:\n`last_value(server.status, kql='server.name=\"A\"')`\n      "})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.lastValue.documentation.quick",{defaultMessage:"\nThe value of a field from the last document, ordered by the default time field of the data view.\n      "})};a(402);const lp="auto",rp="range",op="histogram",up=Object(b.htmlIdGenerator)(),cp=(e,t)=>e.label||t.convert({gte:qo(e.from)?e.from:-1/0,lt:qo(e.to)?e.to:1/0}),dp=({range:e,setRange:t,button:a,triggerClose:n,isOpen:i})=>{const[r,o]=Object(s.useState)(e),c=l.a.useRef(),d=l.a.useRef(),p=(a,n=!1)=>{n&&o(e),t(a)},{from:m,to:g,label:f}=r,v=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualAppend",{defaultMessage:"≤"}),h=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanOrEqualTooltip",{defaultMessage:"Less than or equal to"}),y=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanPrepend",{defaultMessage:"<"}),j=u.i18n.translate("xpack.lens.indexPattern.ranges.lessThanTooltip",{defaultMessage:"Less than"});return Object(x.jsx)(b.EuiPopover,{display:"block",ownFocus:!0,isOpen:i,closePopover:()=>n(),button:a,"data-test-subj":"indexPattern-ranges-popover"},Object(x.jsx)(b.EuiFormRow,null,Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"s",responsive:!1,alignItems:"center"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:qo(m)?Number(m):"",onChange:({target:e})=>{const t={...r,from:""!==e.value?Number(e.value):-1/0};o(t),p(t)},append:Object(x.jsx)(b.EuiToolTip,{content:h},Object(x.jsx)(b.EuiText,{size:"s"},v)),onKeyDown:({key:e})=>{b.keys.ENTER===e&&d.current&&d.current.focus()},compressed:!0,placeholder:"−∞",isInvalid:!jp(r),step:1})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiIcon,{type:"sortRight",color:"subdued"})),Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiFieldNumber,{className:"lnsRangesOperation__popoverNumberField",value:qo(g)?Number(g):"",inputRef:e=>{d&&e&&(d.current=e)},onChange:({target:e})=>{const t={...r,to:""!==e.value?Number(e.value):1/0};o(t),p(t)},prepend:Object(x.jsx)(b.EuiToolTip,{content:j},Object(x.jsx)(b.EuiText,{size:"s"},y)),compressed:!0,placeholder:"+∞",isInvalid:!jp(r),onKeyDown:({key:e})=>{b.keys.ENTER===e&&c.current&&c.current.focus()},step:1})))),Object(x.jsx)(b.EuiFormRow,null,Object(x.jsx)(ic,{inputRef:c,value:f||"",onChange:e=>{const t={...r,label:e};o(t),p(t)},placeholder:u.i18n.translate("xpack.lens.indexPattern.ranges.customRangeLabelPlaceholder",{defaultMessage:"Custom label"}),onSubmit:()=>{n()},compressed:!0,dataTestSubj:"indexPattern-ranges-label"})))},pp=({ranges:e,setRanges:t,onToggleEditor:a,formatter:n})=>{const[i,r]=Object(s.useState)(""),[o,c]=Object(s.useState)((()=>e.map((e=>({...e,id:up()})))));Object(k.s)((()=>{t(o.map((({id:e,...t})=>({...t}))))}),{skipFirstRender:!0},256,[o]);const d=Object(s.useCallback)((()=>{const e=up();c([...o,{id:e,from:o[o.length-1].to,to:Number.POSITIVE_INFINITY,label:""}]),r(e)}),[o]),p=e=>{let t=e;i===e&&(t=""),r(t)};return Object(x.jsx)(b.EuiFormRow,{fullWidth:!0,label:u.i18n.translate("xpack.lens.indexPattern.ranges.customRanges",{defaultMessage:"Ranges"}),labelAppend:Object(x.jsx)(b.EuiText,{size:"xs"},Object(x.jsx)(b.EuiLink,{color:"danger",onClick:a},Object(x.jsx)(b.EuiIcon,{size:"s",type:"cross",color:"danger"})," ",u.i18n.translate("xpack.lens.indexPattern.ranges.customRangesRemoval",{defaultMessage:"Remove custom ranges"})))},Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Nu.a,{onDragEnd:c,droppableId:"RANGES_DROPPABLE_AREA",items:o},o.map(((e,t,a)=>Object(x.jsx)(Nu.b,{key:e.id,idx:t,id:e.id,isInvalid:!jp(e),invalidMessage:u.i18n.translate("xpack.lens.indexPattern.range.isInvalid",{defaultMessage:"This range is invalid"}),onRemoveClick:()=>{const e=a.filter(((e,a)=>a!==t));c(e)},removeTitle:u.i18n.translate("xpack.lens.indexPattern.ranges.deleteRange",{defaultMessage:"Delete range"}),isNotRemovable:1===a.length,isNotDraggable:a.length<2},Object(x.jsx)(dp,{range:e,isOpen:e.id===i,triggerClose:()=>p(""),setRange:e=>{const n=[...a];e.id===n[t].id?n[t]=e:n.push(e),c(n)},button:Object(x.jsx)(b.EuiLink,{color:"text",onClick:()=>p(e.id),className:"lnsRangesOperation__popoverButton","data-test-subj":"indexPattern-ranges-popover-trigger"},Object(x.jsx)(b.EuiText,{size:"s",textAlign:"left",color:jp(e)?"default":"danger"},cp(e,n)))}))))),Object(x.jsx)(Vu.a,{onClick:d,label:u.i18n.translate("xpack.lens.indexPattern.ranges.addRange",{defaultMessage:"Add range"})})))};a(407);const mp=({children:e,onClick:t})=>Object(x.jsx)(b.EuiText,{size:"xs"},Object(x.jsx)(b.EuiLink,{onClick:t},Object(x.jsx)(b.EuiIcon,{className:"lnsHelpPopover__buttonIcon",size:"s",type:"help"}),e)),gp=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s})=>Object(x.jsx)(b.EuiPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(x.jsx)(b.EuiPopoverTitle,{paddingSize:"m"},s),Object(x.jsx)(b.EuiText,{className:"lnsHelpPopover__content",size:"s"},a)),fp=({anchorPosition:e,button:t,children:a,closePopover:n,isOpen:i,title:s,theme:l})=>Object(x.jsx)(d.KibanaThemeProvider,{theme$:l.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(b.EuiWrappingPopover,{anchorPosition:e,button:t,className:"lnsHelpPopover",closePopover:n,isOpen:i,ownFocus:!0,panelClassName:"lnsHelpPopover__panel",panelPaddingSize:"none"},s&&Object(x.jsx)(b.EuiPopoverTitle,{paddingSize:"m"},s),Object(x.jsx)(b.EuiText,{className:"lnsHelpPopover__content",size:"s"},a)))),bp=()=>{const[e,t]=Object(s.useState)(!1);return Object(x.jsx)(gp,{anchorPosition:"upCenter",button:Object(x.jsx)(mp,{onClick:()=>{t(!e)}},u.i18n.translate("xpack.lens.indexPattern.ranges.granularityHelpText",{defaultMessage:"How it works"})),closePopover:()=>t(!1),isOpen:e,title:u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverTitle",{defaultMessage:"How granularity interval works"})},Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverBasicExplanation",{defaultMessage:"Interval granularity divides the field into evenly spaced intervals based on the minimum and maximum values for the field."})),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ranges.granularityPopoverExplanation",defaultMessage:'The size of the interval is a "nice" value. When the granularity of the slider changes, the interval stays the same when the “nice” interval is the same. The minimum granularity is 1, and the maximum value is {setting}. To change the maximum granularity, go to Advanced settings.',values:{setting:Object(x.jsx)(b.EuiCode,null,is.UI_SETTINGS.HISTOGRAM_MAX_BARS)}})),Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.ranges.granularityPopoverAdvancedExplanation",{defaultMessage:"Intervals are incremented by 10, 5 or 2. For example, an interval can be 100 or 0.2 ."})))},vp=({maxBars:e,step:t,maxHistogramBars:a,onToggleEditor:n,onMaxBarsChange:i,includeEmptyRows:r,onChangeIncludeEmptyRows:o})=>{const[c,d]=Object(s.useState)(String(e));Object(k.s)((()=>{i(Number(c))}),{skipFirstRender:!0},256,[c]);const p=u.i18n.translate("xpack.lens.indexPattern.ranges.granularity",{defaultMessage:"Intervals granularity"}),m=u.i18n.translate("xpack.lens.indexPattern.ranges.decreaseButtonLabel",{defaultMessage:"Decrease granularity"}),g=u.i18n.translate("xpack.lens.indexPattern.ranges.increaseButtonLabel",{defaultMessage:"Increase granularity"});return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},u.i18n.translate("xpack.lens.indexPattern.ranges.includeEmptyRows",{defaultMessage:"Include empty rows"})),checked:Boolean(r),onChange:()=>{o(!r)},compressed:!0})),Object(x.jsx)(b.EuiFormRow,{label:p,"data-test-subj":"indexPattern-ranges-section-label",labelType:"legend",fullWidth:!0,display:"rowCompressed",labelAppend:Object(x.jsx)(bp,null)},Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"xs",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiToolTip,{content:m,delay:"long"},Object(x.jsx)(b.EuiButtonIcon,{iconType:"minusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-minus",onClick:()=>d(""+Math.max(Number(c)-t,1)),"aria-label":m}))),Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiRange,{compressed:!0,fullWidth:!0,"aria-label":p,"data-test-subj":"lns-indexPattern-range-maxBars-field",min:1,max:a,step:t,value:c,onChange:({currentTarget:e})=>d(e.value)})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiToolTip,{content:g,delay:"long"},Object(x.jsx)(b.EuiButtonIcon,{iconType:"plusInCircle",color:"text","data-test-subj":"lns-indexPattern-range-maxBars-plus",onClick:()=>d(""+Math.min(Number(c)+t,a)),"aria-label":g}))))),Object(x.jsx)(b.EuiButtonEmpty,{size:"xs",iconType:"controlsHorizontal",onClick:()=>n()},u.i18n.translate("xpack.lens.indexPattern.ranges.customIntervalsToggle",{defaultMessage:"Create custom ranges"})))},hp=({setParam:e,params:t,maxHistogramBars:a,maxBars:n,granularityStep:i,onChangeMode:l,rangeFormatter:r})=>{const[o,u]=Object(s.useState)(t.type===rp);return o?Object(x.jsx)(pp,{ranges:t.ranges,setRanges:t=>{e("ranges",t)},onToggleEditor:()=>{l(op),u(!1)},formatter:r}):Object(x.jsx)(vp,{includeEmptyRows:t.includeEmptyRows,maxBars:n,step:i,maxHistogramBars:a,onMaxBarsChange:t=>{e("maxBars",t)},onChangeIncludeEmptyRows:t=>{e("includeEmptyRows",t)},onToggleEditor:()=>{l(rp),u(!0)}})};var xp=a(135);const yp=e=>qo(e.from)&&qo(e.to),jp=e=>!yp(e)||(e=>e.from<=e.to)(e);function Op(e,t){if(t&&e.fieldFormatMap&&e.fieldFormatMap[t.name])return e.fieldFormatMap[t.name]}const Ip=[pc,Lc,xd,ud,cd,dd,Kc,md,pd,gd,ad,sd,sp,Xd,{type:"range",displayName:u.i18n.translate("xpack.lens.indexPattern.intervals",{defaultMessage:"Intervals"}),priority:4,input:"field",getErrorMessage:(e,t,a)=>No(e,t,a),getPossibleOperationForField:({aggregationRestrictions:e,aggregatable:t,type:a})=>{if("number"===a&&t&&(!e||e.range))return{dataType:"number",isBucketed:!0,scale:"interval"}},getDefaultLabel:(e,t,a)=>{var n,i;return null!==(n=null==a||null===(i=a.getFieldByName(e.sourceField))||void 0===i?void 0:i.displayName)&&void 0!==n?n:u.i18n.translate("xpack.lens.indexPattern.missingFieldLabel",{defaultMessage:"Missing field"})},buildColumn({field:e},t){var a,n,i,s,l;const r=null!==(a=null==t?void 0:t.type)&&void 0!==a?a:op;return{label:e.displayName,dataType:r===op?"number":"string",operationType:"range",sourceField:e.name,isBucketed:!0,scale:r===op?"interval":"ordinal",params:{includeEmptyRows:null===(n=null==t?void 0:t.includeEmptyRows)||void 0===n||n,type:null!==(i=null==t?void 0:t.type)&&void 0!==i?i:op,ranges:null!==(s=null==t?void 0:t.ranges)&&void 0!==s?s:[{from:0,to:1e3,label:""}],maxBars:null!==(l=null==t?void 0:t.maxBars)&&void 0!==l?l:lp,format:null==t?void 0:t.format,parentFormat:null==t?void 0:t.parentFormat}}},isTransferable:(e,t)=>{const a=t.getFieldByName(e.sourceField);return Boolean(a&&"number"===a.type&&a.aggregatable&&(!a.aggregationRestrictions||a.aggregationRestrictions.range))},onFieldChange:(e,t)=>({...e,label:t.name,sourceField:t.name}),toEsAggsFn:(e,t,a,n,i)=>{const{sourceField:s,params:l}=e;if(l.type===rp)return Object(yt.buildExpressionFunction)("aggRange",{id:t,enabled:!0,schema:"segment",field:s,ranges:l.ranges.filter(jp).map((e=>{if(yp(e))return e;const t={label:e.label};return qo(e.from)&&(t.from=Number(e.from)),qo(e.to)&&(t.to=Number(e.to)),t})).map(ca.numericalRangeToAst)}).toAst();const r=(i.get(is.UI_SETTINGS.HISTOGRAM_MAX_BARS)-1)/2;return Object(yt.buildExpressionFunction)("aggHistogram",{id:t,enabled:!0,schema:"segment",field:s,maxBars:l.maxBars===lp?r:l.maxBars,interval:"auto",has_extended_bounds:!1,min_doc_count:Boolean(l.includeEmptyRows),autoExtendBounds:Boolean(l.includeEmptyRows),extended_bounds:Object(ca.extendedBoundsToAst)({})}).toAst()},paramEditor:({layer:e,columnId:t,currentColumn:a,paramEditorUpdater:n,indexPattern:i,uiSettings:s,fieldFormats:l})=>{var r,o;const u=i.getFieldByName(a.sourceField),c=a.params.format,d=c&&xp.a[c.id]&&xp.a[c.id].decimalsToPattern((null===(r=c.params)||void 0===r?void 0:r.decimals)||0),p=c&&xp.a[c.id].formatId,m=l.deserialize({...a.params.parentFormat||{id:"range"},params:{...null===(o=a.params.parentFormat)||void 0===o?void 0:o.params,...c?{id:p,params:{pattern:d}}:Op(i,u)}}),g=s.get(is.UI_SETTINGS.HISTOGRAM_MAX_BARS),f=(g-1)/6,b=(g-1)/2;return Object(x.jsx)(hp,{setParam:(a,i)=>{n(yu({layer:e,columnId:t,paramName:a,value:i}))},maxBars:a.params.maxBars===lp?b:a.params.maxBars,granularityStep:f,params:a.params,onChangeMode:i=>{const s=i===rp?"ordinal":"interval",l=i===rp?"string":"number",r=i===rp?{id:"range",params:{template:"arrow_right",replaceInfinity:!0}}:void 0;n({...e,columns:{...e.columns,[t]:{...a,scale:s,dataType:l,params:{type:i,ranges:[{from:0,to:1e3,label:""}],maxBars:b,format:a.params.format,parentFormat:r}}}})},maxHistogramBars:s.get(is.UI_SETTINGS.HISTOGRAM_MAX_BARS),rangeFormatter:m})},quickFunctionDocumentation:u.i18n.translate("xpack.lens.indexPattern.ranges.documentation.quick",{defaultMessage:"\n    Buckets values along defined numeric ranges.\n      "})},Pd,Sd,Ld,Rd,ko,Jo,zd,Vd,Gd,qd,Kd,Hd,tu,au,nu],kp=Ip,Tp=Ip.reduce(((e,t)=>({...e,[t.type]:t})),{}),Mp=Object(qt.memoize)((()=>{const e={};return kp.forEach((({type:t,displayName:a})=>{e[t]={type:t,displayName:a}})),e}));function wp(e,t){return(t.priority||Number.NEGATIVE_INFINITY)-(e.priority||Number.NEGATIVE_INFINITY)}const Cp=e=>(t,a)=>{var n,i,s;return(null==e||null===(n=e.partiallyApplicableFunctions)||void 0===n?void 0:n[t.type])!==(null==e||null===(i=e.partiallyApplicableFunctions)||void 0===i?void 0:i[a.type])?null!=e&&null!==(s=e.partiallyApplicableFunctions)&&void 0!==s&&s[t.type]?1:-1:(a.priority||Number.NEGATIVE_INFINITY)-(t.priority||Number.NEGATIVE_INFINITY)};function Ep(e){var t,a,n;return Ro(e)?null!==(t=null===(a=Tp[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))&&void 0!==t?t:[e.sourceField]:[]}function Sp(e){var t;return null===(t=Tp[e])||void 0===t?void 0:t.getParamsForMultipleFields}function Fp(e,t,a,n){var i,s;return Boolean(null===(i=Tp[t.operationType])||void 0===i||null===(s=i.canAddNewField)||void 0===s?void 0:s.call(i,{targetColumn:t,sourceColumn:a,field:n,indexPattern:e}))}function Pp(e,t,a){return kp.filter((a=>{if("field"!==a.input)return!1;const n=a.getPossibleOperationForField(e);return t?n&&t(n):n})).sort(Cp(e)).sort(((e,t)=>{if(!a)return 0;const n=a.has(e.type);return n===a.has(t.type)?0:n?1:-1})).map((({type:e})=>e))}const _p=Object(qt.memoize)((function(e,t){const a={},n=(e,t)=>{if(!t)return;const n=JSON.stringify(t);a[n]?a[n].operations.push(e):a[n]={operationMetaData:t,operations:[e]}};return(t?Object.values(t):kp).sort(wp).forEach((t=>{if("field"===t.input)e.fields.forEach((e=>{n({type:"field",operationType:t.type,field:e.name},t.getPossibleOperationForField(e))}));else if("none"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"none",operationType:t.type},a)}else if("fullReference"===t.input){const a=t.getPossibleOperation(e);a&&n({type:"fullReference",operationType:t.type},a)}else if("managedReference"===t.input){const e=t.getPossibleOperation();e&&n({type:"managedReference",operationType:t.type,usedInMath:t.usedInMath},e)}})),Object.values(a)}));var Ap=a(103);function Lp(){_p.cache.clear&&_p.cache.clear()}const Dp=(e,t)=>{var a;const n=Object(Ap.b)(e,"indexPatternId");return n&&(null===(a=t.find((e=>e.id===n)))||void 0===a?void 0:a.id)},Rp=(e,t)=>{Object(Ap.c)(e,"indexPatternId",t)};function Bp(e){return`indexpattern-datasource-layer-${e}`}function Np(e,t){const a={};return Object.entries(e.layers).forEach((([e,n])=>{var i;const s=null===(i=t.find((({name:t})=>t===Bp(e))))||void 0===i?void 0:i.id;s&&(a[e]={...n,indexPatternId:s})})),{layers:a}}function zp(e){const t=Object.values(e);return 1===t.length&&0===t[0].columnOrder.length}var Vp=a(412),Gp=a.n(Vp);const qp=u.i18n.translate("searchResponseWarnings.viewDetailsButtonLabel",{defaultMessage:"View details",description:"View warning details button label"});function Hp(e){const t=new Set;return e.forEach((e=>{Object.keys(e.clusters).forEach((a=>{"successful"!==e.clusters[a].status&&t.add(a)}))})),t}function Up(e){const t=Hp(e),a=u.i18n.translate("searchResponseWarnings.title.clustersClause",{defaultMessage:"Problem with {nonSuccessfulClustersCount} {nonSuccessfulClustersCount, plural, one {cluster} other {clusters}}",values:{nonSuccessfulClustersCount:t.size}});return e.length<=1?a:u.i18n.translate("searchResponseWarnings.title.clustersClauseAndRequestsClause",{defaultMessage:"{clustersClause} in {requestsCount} requests",values:{clustersClause:a,requestsCount:e.length}})}const $p=e=>{const[t,a]=Object(s.useState)(0),n=new Map;return Object(x.jsx)("div",{className:"euiContextMenu"},1===t?Object(x.jsx)(b.EuiContextMenuPanel,{items:e.warnings.map((t=>{const a=n.has(t.requestName)?n.get(t.requestName)+1:1,i=a>1?`${t.requestName} (${a})`:t.requestName;return n.set(t.requestName,a),Object(x.jsx)(b.EuiContextMenuItem,{key:i,onClick:()=>{var a;null===(a=e.onViewDetailsClick)||void 0===a||a.call(e),t.openInInspector()}},i)})),onClose:()=>{a(0)},title:qp}):Object(x.jsx)(b.EuiContextMenuPanel,{title:Up(e.warnings)},Object(x.jsx)(b.EuiPanel,{color:"transparent",paddingSize:"s"},Object(x.jsx)(b.EuiText,{size:"s"},Hp(e.warnings).size<=1?u.i18n.translate("searchResponseWarnings.description.singleCluster",{defaultMessage:"This cluster had issues returning data and results might be incomplete."}):u.i18n.translate("searchResponseWarnings.description.multipleClusters",{defaultMessage:"These clusters had issues returning data and results might be incomplete."})),Object(x.jsx)(b.EuiButtonEmpty,{color:"primary",flush:"left",iconSide:e.warnings.length>1?"right":void 0,iconType:e.warnings.length>1?"arrowRight":void 0,onClick:()=>{var t;e.warnings.length>1?a(1):(null===(t=e.onViewDetailsClick)||void 0===t||t.call(e),e.warnings[0].openInInspector())}},qp))))};var Wp=a(44),Xp=a.n(Wp);let Yp;!function(e){e.preboot="preboot",e.standard="standard"}(Yp||(Yp={}));const Qp="eui-global",Kp="eui-utilities",Zp=[b.euiStylisPrefixer],Jp=Xp()({key:"css",stylisPlugins:Zp,container:document.querySelector('meta[name="emotion"]')}),em=Xp()({key:Qp,stylisPlugins:Zp,container:document.querySelector(`meta[name="${Qp}"]`)}),tm=Xp()({key:Kp,stylisPlugins:Zp,container:document.querySelector(`meta[name="${Kp}"]`)});Jp.compat=!0,em.compat=!0,tm.compat=!0,a(51);class mount_point_portal_MountPointPortalErrorBoundary extends s.Component{constructor(...e){super(...e),ta()(this,"state",{error:void 0})}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(){}render(){return this.state.error?Object(x.jsx)("p",null,u.i18n.translate("reactPackages.mountPointPortal.errorMessage",{defaultMessage:"Error rendering portal content"})):this.props.children}}function am({state:e,layerId:t,newLayer:a}){return{...e,layers:{...e.layers,[t]:{...e.layers[t],...a}}}}function nm({state:e,newLayers:t}){return{...e,layers:{...e.layers,...t}}}function im({layers:e,visualizationInfo:t,dataViews:a}){return Object(x.jsx)(l.a.Fragment,null,e.map((([e,n],i)=>{const s=a.indexPatterns[n.indexPatternId],l=t.layers.find((({layerId:t,label:a})=>t===e)),r=(null==l?void 0:l.label)||u.i18n.translate("xpack.lens.indexPattern.samplingPerLayer.fallbackLayerName",{defaultMessage:"Data layer"}),o=null==l?void 0:l.palette;return Object(x.jsx)(vs,{title:r,index:i,dataView:s.id,palette:o,"data-test-subj-prefix":"lns-feature-badges-reducedSampling"},Object(x.jsx)(b.EuiText,{size:"s"},100*Number(rm(n))+"%"))})))}function sm(e){return!!e&&(Ho("max",e)||Ho("min",e))}function lm(e){return!Object.values(e.columns).some((t=>sm(t)||function(e){return"references"in e}(t)&&sm(e.columns[t.references[0]])))}function rm(e){var t;return lm(e)&&null!==(t=e.sampling)&&void 0!==t?t:1}const om=(e,t,a)=>({severity:"warning",displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.indexPattern.precisionErrorWarning.accuracyDisabled.shortMessage",{defaultMessage:"This might be an approximation. For more precise results, you can enable accuracy mode, but it increases the load on the Elasticsearch cluster."}),longMessage:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyDisabled",defaultMessage:"{name} might be an approximation. You can enable accuracy mode for more precise results, but note that it increases the load on the Elasticsearch cluster.",values:{name:Object(x.jsx)("strong",null,e)}}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiLink,{"data-test-subj":"lnsPrecisionWarningEnableAccuracy",onClick:a},u.i18n.translate("xpack.lens.indexPattern.enableAccuracyMode",{defaultMessage:"Enable accuracy mode"})))}),um=(e,t,a)=>({severity:"warning",displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:t}],fixableInEditor:!0,shortMessage:u.i18n.translate("xpack.lens.indexPattern.precisionErrorWarning.accuracyEnabled.shortMessage",{defaultMessage:"This might be an approximation. For more precise results, use Filters or increase the number of Top Values."}),longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.accuracyEnabled",defaultMessage:"{name} might be an approximation. For more precise results, try increasing the number of {topValues} or using {filters} instead. {learnMoreLink}",values:{name:Object(x.jsx)("strong",null,e),topValues:Object(x.jsx)("strong",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.topValues",defaultMessage:"Top Values"})),filters:Object(x.jsx)("strong",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.precisionErrorWarning.filters",defaultMessage:"Filters"})),learnMoreLink:Object(x.jsx)(b.EuiLink,{href:a,target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{defaultMessage:"Learn more.",id:"xpack.lens.indexPattern.precisionErrorWarning.link"}))}})});function cm(e,t,a,n,i){return e&&"incomplete"===t.type?function(e){return"incomplete"===e.type&&Object.values(e.clusters).some((e=>!!e.failures&&e.failures.some((e=>{var t;return"unsupported_aggregation_on_downsampled_index"===(null===(t=e.reason)||void 0===t?void 0:t.type)}))))}(t)?Object.values(e.layers).flatMap((e=>Object(qt.uniq)(Object.values(e.columns).filter((e=>["median","percentile","percentile_rank","last_value","unique_count","standard_deviation"].includes(e.operationType))).map((e=>e.label))).map((e=>({uniqueId:`unsupported_aggregation_on_downsampled_index--${e}`,severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"},{id:"embeddableBadge"}],shortMessage:"",longMessage:u.i18n.translate("xpack.lens.indexPattern.tsdbRollupWarning",{defaultMessage:"{label} uses a function that is unsupported by rolled up data. Select a different function or change the time range.",values:{label:e}})}))))):[{uniqueId:"incomplete",severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"},{id:"embeddableBadge"}],shortMessage:"",longMessage:e=>Object(x.jsx)($p,{onViewDetailsClick:e,warnings:[t]})}]:[]}function dm(e,{dataViews:t},a){const n=[],i=Object.values(e.layers).filter((({indexPatternId:e})=>t.indexPatterns[e])).flatMap((e=>{const a=t.indexPatterns[e.indexPatternId];return Object.entries(e.columns).filter((([e,t])=>{var n;const i=Tp[t.operationType];if(!i.getPossibleOperationForField||!Ro(t))return!1;const s=a.getFieldByName(t.sourceField);return!(!s||null!==(n=i.getPossibleOperationForField)&&void 0!==n&&n.call(i,s)||"counter"!==(null==s?void 0:s.timeSeriesMetric))})).map((([t,a])=>[a,e.columns[Su(e,t)]]))}));if(i.length){const e=Object.values(Object(qt.groupBy)(i,(([e])=>e.sourceField))).map((e=>Object(qt.uniqBy)(e,(([e,t])=>null!=t?t:e))));for(const t of e){const e=t[0][0].sourceField;n.push({severity:"warning",fixableInEditor:!1,displayLocations:[{id:"toolbar"},{id:"embeddableBadge"}],shortMessage:u.i18n.translate("xpack.lens.indexPattern.tsdbErrorWarning.unsupportedCounterOperationErrorWarning.shortMessage",{defaultMessage:"The result of {count} {count, plural, one {operation} other {operations}} might be meaningless for {field}: {operations}",values:{count:t.length,operations:t.map((([e,t])=>(null!=t?t:e).label)).join(", "),field:e}}),longMessage:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.unsupportedCounterOperationErrorWarning",defaultMessage:"While {count} {count, plural, one {operation} other {operations}} for {field} {count, plural, one {is} other {are}} allowed the result might be meaningless: {operations}. To learn more about this, {link}.",values:{count:t.length,operations:Object(x.jsx)(l.a.Fragment,null,t.map((([e,a],n)=>Object(x.jsx)(l.a.Fragment,{key:(null!=a?a:e).label},Object(x.jsx)("strong",null,(null!=a?a:e).label),n<t.length-1?", ":"")))),field:e,link:Object(x.jsx)(b.EuiLink,{href:a.links.fleet.datastreamsTSDSMetrics,target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{defaultMessage:"visit the Time series documentation",id:"xpack.lens.indexPattern.unsupportedCounterOperationErrorWarning.link"}))}}))})}}return n}function pm(e,t,{activeData:a,dataViews:n},i,s){const r=[];return t&&a&&Object.entries(a).reduce(((e,[t,{columns:a}])=>(e.push(...a.map((e=>({layerId:t,column:e})))),e)),[]).forEach((({layerId:a,column:o})=>{const d=t.layers[a],p=null==d?void 0:d.columns[o.id];if(d&&p&&e.hasPrecisionError(o)){const e=n.indexPatterns[d.indexPatternId];if(!e)return;const t=Ho("terms",p),m=t&&"column"===p.params.orderBy.type&&"asc"===p.params.orderDirection&&Ho("count",d.columns[p.params.orderBy.columnId]),g=t&&!Cc(e.getFieldByName(p.sourceField)),f=t&&(p.params.secondaryFields||[]).length>0;t&&(!m||g||f)?r.push(p.params.accuracyMode?um(o.name,o.id,i.links.aggs.terms_doc_count_error):om(o.name,o.id,(()=>{s((t=>am({state:t,layerId:a,newLayer:Au(yu({layer:d,columnId:o.id,paramName:"accuracyMode",value:!0}),e)})))}))):r.push({severity:"warning",displayLocations:[{id:"toolbar"},{id:"dimensionButton",dimensionId:o.id}],shortMessage:u.i18n.translate("xpack.lens.indexPattern.precisionErrorWarning.ascendingCountPrecisionErrorWarning.shortMessage",{defaultMessage:"This may be approximate depending on how the data is indexed. For more precise results, sort by rarity."}),longMessage:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning",defaultMessage:"{name} for this visualization may be approximate due to how the data is indexed. Try sorting by rarity instead of ascending count of records. To learn more about this limit, {link}.",values:{name:Object(x.jsx)("strong",null,o.name),link:Object(x.jsx)(b.EuiLink,{href:i.links.aggs.rare_terms,target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{defaultMessage:"visit the documentation",id:"xpack.lens.indexPattern.ascendingCountPrecisionErrorWarning.link"}))}}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiLink,{onClick:()=>{s((t=>am({state:t,layerId:a,newLayer:Au(yu({layer:d,columnId:o.id,paramName:"orderBy",value:{type:"rare",maxDocCount:$u}}),e)})))}},u.i18n.translate("xpack.lens.indexPattern.switchToRare",{defaultMessage:"Rank by rarity"}))),fixableInEditor:!0})}})),r}function mm(e){return null==e?void 0:e.map((({input:e})=>e)).filter((({query:e})=>(null==e?void 0:e.trim())&&"*"!==e))}function gm(e){return e.params.ranges.map((({from:t,to:a})=>{let n="";return null!=t&&isFinite(t)&&(n+=`${e.sourceField} >= ${t}`),null!=a&&isFinite(a)&&(n.length&&(n+=" AND "),n+=`${e.sourceField} <= ${a}`),{query:n,language:"kuery"}})).filter((({query:e})=>null==e?void 0:e.trim()))}function fm(e,t){return[{language:"kuery",query:`"${e.sourceField}" >= "${t.from}" AND "${e.sourceField}" <= "${t.to}"`}]}function bm(e,t,a){const n=[e.sourceField].concat(e.params.secondaryFields||[]).filter(Boolean),i=a.rows.map((({[t]:a})=>{if(null!=a)return"string"!=typeof a&&Array.isArray(a.keys)?a.keys.map(((e,t)=>`${n[t]}: "${""===e?Object(qt.escape)(e):e}"`)).join(" AND "):`${e.sourceField}: "${""===a?Object(qt.escape)(a):a}"`})).filter(Boolean);return[...new Set(i)].map((e=>({language:"kuery",query:e})))}function vm(e,t,a){return[e[a],...t.map((({[a]:e})=>e))].filter((e=>null==e?void 0:e.length))}const hm=(e,t,a,n)=>{var i,s;return e[t]?{...e,[a]:Object(st.renewIDs)(e[t],Object.keys(null!==(i=null===(s=e[t])||void 0===s?void 0:s.columns)&&void 0!==i?i:{}),n)}:e},xm=e=>e.split(".")[0].split("-")[2],ym=(e,t)=>{const[a,n,i]=e.split("."),s=a.split("-");return s[1]=String(t),s.join("-")+function(e,t){return e||t?t?`['${e}.${t}']`:`.${e}`:""}(n,i)};function jm(e){const t={};e.forEach((([e,a])=>{t[e]="references"in a?a.references:[]})),e.forEach((([e])=>{t[e]=t[e].filter((e=>!!t[e]))}));const a=[];for(;a.length<e.length;)Object.keys(t).forEach((e=>{0===t[e].length&&(a.push(e),delete t[e],Object.keys(t).forEach((a=>{t[a]=t[a].filter((t=>t!==e))})))}));return a}a(136);var Om=a(548);function Im(e,t,a){const n=e.filter((e=>e!==a)),i=n.indexOf(t);return n.splice(i+1,0,a),n}function km(e,t){var a;return Ro(e)?(null===(a=t(e.sourceField))||void 0===a?void 0:a.displayName)||e.sourceField:""}function Tm({columnId:e,layer:t,setColumns:a,getFieldByName:n}){const i=t.columns[e],s=Object.entries(t.columns).filter((([t,a])=>t!==e&&a.isBucketed)).map((([e,t])=>({value:e,text:t.label,fieldName:km(t,n),operationType:t.operationType})));if(!i||!i.isBucketed||!s.length)return null;const r=t.columnOrder[t.columnOrder.indexOf(e)-1];if(1===s.length){const[n]=s,i=u.i18n.translate("xpack.lens.indexPattern.useAsTopLevelAgg",{defaultMessage:"Aggregate by this dimension first"});return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",hasChildLabel:!1},Object(x.jsx)(b.EuiSwitch,{label:Object(x.jsx)(b.EuiText,{size:"xs"},i),"data-test-subj":"indexPattern-nesting-switch",name:"nestingSwitch",checked:!r,onChange:()=>{a(r?Im(t.columnOrder,e,n.value):Im(t.columnOrder,n.value,e))},compressed:!0})))}return Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.groupByDropdown",{defaultMessage:"Group by"}),display:"columnCompressed",fullWidth:!0},Object(x.jsx)(b.EuiSelect,{compressed:!0,"data-test-subj":"indexPattern-nesting-select",options:[{value:"",text:u.i18n.translate("xpack.lens.xyChart.nestUnderRoot",{defaultMessage:"Entire data set"})},...s.map((({value:e,text:t})=>({value:e,text:t})))],value:r,onChange:n=>a(Im(t.columnOrder,n.target.value,e))}))}const Mm=Object(s.createContext)({minWidth:0,onResize:()=>{}}),wm=({children:e})=>{const[t,a]=Object(s.useState)(0);return Object(x.jsx)(Mm.Provider,{value:{minWidth:t,onResize:({width:e})=>{e>t&&a(e)}}},e)},Cm=({children:e})=>{const{minWidth:t,onResize:a}=Object(s.useContext)(Mm),{euiTheme:n}=Object(b.useEuiTheme)(),i=2*parseInt(n.size.m,10);return Object(x.jsx)(b.EuiFormLabel,{css:Object(x.css)({minWidth:Math.round(t)+i},"","")},Object(x.jsx)(b.EuiResizeObserver,{onResize:a},(t=>Object(x.jsx)("span",{ref:t},e))))},Em=Bc.DURATION_OUTPUT_FORMATS.map((function({text:e,method:t}){return"humanize"===t?{label:u.i18n.translate("xpack.lens.indexPattern.duration.humanizeLabel",{defaultMessage:"Friendly (approximate)"}),value:t}:"humanizePrecise"===t?{label:u.i18n.translate("xpack.lens.indexPattern.duration.humanizePreciseLabel",{defaultMessage:"Friendly (precise)"}),value:t}:{label:e,value:t}})),Sm=Bc.DURATION_INPUT_FORMATS.map((({text:e,kind:t})=>({label:e,value:t})));function Fm(e,t){const a=t.find((({value:t})=>e===t));return a?[a]:[]}const Pm=({testSubjLayout:e,testSubjStart:t,testSubjEnd:a,startValue:n="milliseconds",endValue:i="seconds",onStartChange:s,onEndChange:r})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiComboBox,{prepend:Object(x.jsx)(Cm,null,u.i18n.translate("xpack.lens.indexPattern.duration.fromLabel",{defaultMessage:"Convert"})),isClearable:!1,options:Sm,selectedOptions:Fm(n,Sm),onChange:([e])=>s(e.value),singleSelection:{asPlainText:!0},"data-test-subj":t,compressed:!0}),Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiComboBox,{prepend:Object(x.jsx)(Cm,null,u.i18n.translate("xpack.lens.indexPattern.custom.toLabel",{defaultMessage:"To"})),isClearable:!1,options:Em,selectedOptions:Fm(i,Em),onChange:([e])=>r(e.value),singleSelection:{asPlainText:!0},"data-test-subj":a,compressed:!0})),_m={number:{title:u.i18n.translate("xpack.lens.indexPattern.numberFormatLabel",{defaultMessage:"Number"}),supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!0},percent:{title:u.i18n.translate("xpack.lens.indexPattern.percentFormatLabel",{defaultMessage:"Percent"}),supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!0},bytes:{title:u.i18n.translate("xpack.lens.indexPattern.bytesFormatLabel",{defaultMessage:"Bytes (1024)"}),supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!1},bits:{title:u.i18n.translate("xpack.lens.indexPattern.bitsFormatLabel",{defaultMessage:"Bits (1000)"}),defaultDecimals:0,supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!1},duration:{title:u.i18n.translate("xpack.lens.indexPattern.durationLabel",{defaultMessage:"Duration"}),defaultDecimals:0,supportsDecimals:!0,supportsSuffix:!0,supportsCompact:!0},custom:{title:u.i18n.translate("xpack.lens.indexPattern.customFormatLabel",{defaultMessage:"Custom format"}),defaultDecimals:0,supportsDecimals:!1,supportsSuffix:!1,supportsCompact:!1}},Am={value:"",label:u.i18n.translate("xpack.lens.indexPattern.defaultFormatLabel",{defaultMessage:"Default"})},Lm={asPlainText:!0},Dm=u.i18n.translate("xpack.lens.indexPattern.columnFormatLabel",{defaultMessage:"Value format"}),Rm=u.i18n.translate("xpack.lens.indexPattern.decimalPlacesLabel",{defaultMessage:"Decimals"}),Bm=u.i18n.translate("xpack.lens.indexPattern.suffixLabel",{defaultMessage:"Suffix"}),Nm=u.i18n.translate("xpack.lens.indexPattern.compactLabel",{defaultMessage:"Compact values"}),zm=0,Vm=15;function Gm(e,t,a,n){var i;const l=Object(s.useCallback)((t=>{a&&n({id:a.id,params:{...a.params,[e]:t}})}),[a,e,n]),{handleInputChange:r,inputValue:o}=Object(Z.a)({onChange:l,value:(null==a||null===(i=a.params)||void 0===i?void 0:i[e])||t},{allowFalsyValue:!0});return{setter:r,value:o}}function qm(e){var t,a,n;const{uiSettings:i}=Object(d.useKibana)().services,{euiTheme:r}=Object(b.useEuiTheme)(),{selectedColumn:o,onChange:c,docLinks:p}=e,m=$o(o)?null===(t=o.params)||void 0===t?void 0:t.format:void 0,[g,f]=Object(s.useState)(null!==(a=null==m||null===(n=m.params)||void 0===n?void 0:n.decimals)&&void 0!==a?a:2),{setter:v,value:h}=Gm("suffix","",m,c),{setter:y,value:j}=Gm("compact",!1,m,c),O=i.get(Bc.FORMATS_UI_SETTINGS.FORMAT_NUMBER_DEFAULT_PATTERN),{setter:I,value:k}=Gm("pattern",O,m,c),{setter:T,value:M}=Gm("fromUnit",Bc.DEFAULT_DURATION_INPUT_FORMAT.kind,m,c),{setter:w,value:C}=Gm("toUnit",Bc.DEFAULT_DURATION_OUTPUT_FORMAT.method,m,c),E=null!=m&&m.id?_m[m.id]:void 0,S=Object(s.useMemo)((()=>[Am,...Object.entries(_m).map((([e,t])=>{var a;return{value:e,label:null!==(a=t.title)&&void 0!==a?a:e}}))]),[]),F=Object(s.useCallback)((e=>{if(0===e.length)return;if(!e[0].value)return void c();const t=e[0].value,a=_m[t].defaultDecimals;c({id:e[0].value,params:{decimals:null!=a?a:g}}),f(null!=a?a:g)}),[c,g]),P=Object(s.useMemo)((()=>{var e;return m?[{value:m.id,label:null!==(e=null==E?void 0:E.title)&&void 0!==e?e:m.id}]:[Am]}),[m,null==E?void 0:E.title]),_="duration"===(null==m?void 0:m.id)&&"humanize"===C;return Object(x.jsx)(wm,null,Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{label:Dm,display:"columnCompressed",fullWidth:!0},Object(x.jsx)("div",null,Object(x.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-dimension-format","aria-label":Dm,singleSelection:Lm,options:S,selectedOptions:P,onChange:F}),m&&E?Object(x.jsx)(l.a.Fragment,null,"duration"===(null==m?void 0:m.id)?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(Pm,{onStartChange:T,onEndChange:w,startValue:M,endValue:C,testSubjEnd:"indexPattern-dimension-duration-end",testSubjStart:"indexPattern-dimension-duration-start"})):null,E.supportsDecimals&&!_?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiRange,{showInput:"inputWithPopover",value:g,min:zm,max:Vm,onChange:e=>{const t=Number(e.currentTarget.value);f(t);const a=Math.min(Vm,Math.max(zm,t));c({id:m.id,params:{...m.params,decimals:a}})},"data-test-subj":"indexPattern-dimension-formatDecimals",compressed:!0,fullWidth:!0,prepend:Object(x.jsx)(Cm,null,Rm),"aria-label":Rm,disabled:_})):null,E.supportsSuffix?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiFieldText,{value:h,onChange:e=>{v(e.currentTarget.value)},"data-test-subj":"indexPattern-dimension-formatSuffix",compressed:!0,fullWidth:!0,prepend:Object(x.jsx)(Cm,null,Bm),"aria-label":Bm})):null,E.supportsCompact&&!_?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(b.EuiSwitch,{compressed:!0,label:Object(x.jsx)(b.EuiFormLabel,{css:Object(x.css)("font-weight:",r.font.weight.regular,";","")},Nm),checked:Boolean(j),onChange:()=>y(!j),"data-test-subj":"lns-indexpattern-dimension-formatCompact"})):null):null)),"custom"===(null==m?void 0:m.id)?Object(x.jsx)(b.EuiFormRow,{display:"columnCompressed",hasEmptyLabelSpace:!0,label:" ",helpText:Object(x.jsx)(b.EuiLink,{href:p.links.indexPatterns.fieldFormattersNumber,target:"_blank",external:!0},u.i18n.translate("xpack.lens.indexPattern.custom.externalDoc",{defaultMessage:"Numeral formatting syntax"}))},Object(x.jsx)(b.EuiFieldText,{"data-test-subj":"numberEditorFormatPattern",compressed:!0,prepend:Object(x.jsx)(Cm,null,u.i18n.translate("xpack.lens.indexPattern.custom.patternLabel",{defaultMessage:"Format"})),value:k,placeholder:O,onChange:e=>{I(e.target.value)}})):null))}const Hm=Mp(),Um=e=>{var t;const{currentIndexPattern:a,validation:n,selectionStyle:r,labelAppend:o,column:c,incompleteColumn:d,functionLabel:p,onChooseField:m,onDeleteColumn:g,onResetIncomplete:f,onChooseFunction:v,fieldLabel:h,operationDefinitionMap:y,isInline:j}=e,O=c&&y[c.operationType],I=Object(s.useMemo)((()=>{const e=new Set,t=new Set,i=new Map,s=new Map;return Object.values(y).filter((({hidden:e,allowAsReference:t})=>!e&&t)).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).forEach((l=>{if("field"===l.input){const t=a.fields.filter((e=>_u({operationType:l.type,validation:n,field:e,indexPattern:a})));t.length&&(e.add(l.type),s.set(l.type,new Set(t.map((({name:e})=>e)))),t.forEach((e=>{var t;const a=null!==(t=i.get(e.name))&&void 0!==t?t:new Set;a.add(l.type),i.set(e.name,a)})))}else _u({operationType:l.type,validation:n,indexPattern:a})&&(e.add(l.type),t.add(l.type))})),{operationTypes:e,operationWithoutField:t,operationByField:i,fieldByOperation:s}}),[a,n,y]);if("hidden"===r)return null;const k=null==d?void 0:d.operationType,T=null!==(t=null==d?void 0:d.sourceField)&&void 0!==t?t:null,M=((e,t,a)=>Array.from(e.operationTypes).map((n=>{var i;const s=t[n];return{label:Hm[n].displayName,value:n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${n}${!a||a&&Ro(a)&&"field"===s.input&&(null===(i=e.fieldByOperation.get(n))||void 0===i?void 0:i.has(a.sourceField))||a&&!Ro(a)&&"field"!==s.input?"":" incompatible"}`}})))(I,y,c),w=k?[null==M?void 0:M.find((({value:e})=>e===k))]:c?[null==M?void 0:M.find((({value:e})=>e===c.operationType))]:[],C=Boolean(w.length&&null==w[0]);if(C){const e=k||(null==c?void 0:c.operationType),t={label:e&&Hm[e].displayName,value:e,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${e} incompatible`};null==M||M.push(t),w[0]=t}const E=!c&&!Boolean(k),S=Boolean(k)||"field"===r&&!c,F=!a.getFieldByName(null!=T?T:null==c?void 0:c.sourceField),P=null==O?void 0:O.paramEditor;return Object(x.jsx)("div",null,"field"!==r?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(sc,{isInline:j,"data-test-subj":"indexPattern-subFunction-selection-row",label:p||u.i18n.translate("xpack.lens.indexPattern.chooseSubFunction",{defaultMessage:"Choose a sub-function"}),fullWidth:!0,isInvalid:E||C},Object(x.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!1,"data-test-subj":"indexPattern-reference-function",placeholder:p||u.i18n.translate("xpack.lens.indexPattern.referenceFunctionPlaceholder",{defaultMessage:"Sub-function"}),options:M,isInvalid:E||C,selectedOptions:w,singleSelection:{asPlainText:!0},onChange:e=>{if(0===e.length)return g();const t=e[0].value;if(d&&f(),(null==c?void 0:c.operationType)===t)return;const n=I.fieldByOperation.get(t),i=c&&"sourceField"in c&&null!=n&&n.has(c.sourceField)?a.getFieldByName(c.sourceField):1===(null==n?void 0:n.size)?a.getFieldByName(n.values().next().value):void 0;v(t,i)}})),Object(x.jsx)(b.EuiSpacer,{size:"s"})):null,c&&"field"!==(null==O?void 0:O.input)?null:Object(x.jsx)(sc,{isInline:j,"data-test-subj":"indexPattern-reference-field-selection-row",label:h||u.i18n.translate("xpack.lens.indexPattern.chooseField",{defaultMessage:"Field"}),fullWidth:!0,isInvalid:S||F,labelAppend:o},Object(x.jsx)(Uu,{fieldIsInvalid:S||F,currentIndexPattern:a,operationByField:I.operationByField,selectedOperationType:c?c.operationType:k,selectedField:null!=T?T:null==c?void 0:c.sourceField,incompleteOperation:k,markAllFieldsCompatible:"field"===r,onDeleteColumn:g,onChoose:m,showTimeSeriesDimensions:!1})),c&&!d&&P&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)(P,i()({},e,{isReferenced:!0,operationDefinitionMap:y,currentColumn:c,indexPattern:e.currentIndexPattern}))))};function $m({selectedColumn:e,columnId:t,layer:a,updateLayer:n}){var i;const s=Tp[e.operationType];return s.timeScalingMode&&"disabled"!==s.timeScalingMode?Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,label:Object(x.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.timeScale.tooltip",{defaultMessage:"Normalize values to be always shown as rate per specified time unit, regardless of the underlying date interval."})},Object(x.jsx)("span",null,u.i18n.translate("xpack.lens.indexPattern.timeScale.label",{defaultMessage:"Normalize by unit"})," ",Object(x.jsx)(b.EuiIcon,{type:"questionInCircle",color:"subdued",size:"s",className:"eui-alignTop"})))},Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiSelect,{fullWidth:!0,compressed:!0,options:[{value:"",text:u.i18n.translate("xpack.lens.timeScale.normalizeNone",{defaultMessage:"None"})},...Object.entries(zc).map((([e,t])=>({value:e,text:t})))],"data-test-subj":"indexPattern-time-scaling-unit",value:null!==(i=e.timeScale)&&void 0!==i?i:"",onChange:e=>{const i=e.target.value||void 0;n(function(e,t,a){const n=t.columns[e],i=n.customLabel?n.label:Hc(n.label,n.timeScale,a,n.timeShift,n.timeShift,n.reducedTimeRange,n.reducedTimeRange);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:i,timeScale:a}}}}(t,a,i))}})))):null}var Wm=a(547);function Xm({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,helpMessage:l}){const r=e.filter,o=Object(s.useCallback)((e=>{const{isValid:s}=Object(Aa.b)(e,i);s&&!Object(qt.isEqual)(r,e)&&n(function(e,t,a){return{...t,columns:{...t.columns,[e]:{...t.columns[e],filter:a}}}}(t,a,e))}),[t,i,r,a,n]),u=Object(d.useKibana)().services;return Tp[e.operationType].filterable?Object(x.jsx)(Wm.a,{helpMessage:l,onChange:o,dataView:i,inputFilter:r,queryInputServices:u,appName:It.LENS_APP_NAME}):null}function Ym(e,t,a,n){const i=null==a?void 0:a.trim(),s=t.columns[e],l=s.customLabel||n?s.label:Hc(s.label,s.timeScale,s.timeScale,s.timeShift,s.timeShift,s.reducedTimeRange,i);return{...t,columns:{...t.columns,[e]:{...t.columns[e],reducedTimeRange:i,label:l}}}}function Qm(e){return"previous"===e||"invalid"===e}function Km({selectedColumn:e,columnId:t,layer:a,updateLayer:n,indexPattern:i,helpMessage:r,skipLabelUpdate:o}){const[c,d]=Object(s.useState)(e.reducedTimeRange);Object(s.useEffect)((()=>{d(e.reducedTimeRange)}),[e.reducedTimeRange]);const p=Tp[e.operationType],m=Object.values(a.columns).some((e=>"date_histogram"===e.operationType));if(!p.canReduceTimeRange||!e.reducedTimeRange&&(m||!i.timeFieldName))return null;const g=c&&Object(ca.parseTimeShift)(c),f=Boolean(g&&Qm(g)),v=Boolean(m||!i.timeFieldName),h=u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.label",{defaultMessage:"Reduced time range"});return Object(x.jsx)("div",null,Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-reducedTimeRange-row",label:r?Object(x.jsx)(l.a.Fragment,null,h," ",Object(x.jsx)(b.EuiIconTip,{color:"subdued",content:r,iconProps:{className:"eui-alignTop"},position:"top",size:"s",type:"questionInCircle"})):h,helpText:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.help",{defaultMessage:"Reduces the time range specified in the global time filter from the end of the global time filter."}),error:v?u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.notApplicableHelp",{defaultMessage:"Additional time range filter can not be used together with date histogram or without a default time field specified on the data view"}):f?u.i18n.translate("xpack.lens.indexPattern.reducedTimeRange.genericInvalidHelp",{defaultMessage:"Time range value is not valid."}):void 0,isInvalid:f||v},Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!0,"data-test-subj":"indexPattern-dimension-reducedTimeRange",placeholder:u.i18n.translate("xpack.lens.indexPattern.reducedTimeRangePlaceholder",{defaultMessage:"Type custom values (e.g. 12m)"}),options:io,selectedOptions:function(){if(!c)return[];const e=io.filter((({value:e})=>e===c));return e.length>0?e:[{value:c,label:c}]}(),singleSelection:{asPlainText:!0},isInvalid:f,onCreateOption:e=>{Qm(Object(ca.parseTimeShift)(e))?d(e):n(Ym(t,a,e,o))},onChange:e=>{if(0===e.length)return n(Ym(t,a,"",o)),void d("");const i=e[0].value;Qm(Object(ca.parseTimeShift)(i))?d(i):n(Ym(t,a,i,o))}})))))}function Zm(e){const{euiTheme:t}=Object(b.useEuiTheme)();return Object(x.jsx)(b.EuiAccordion,{id:"advancedOptionsAccordion",arrowProps:{color:"primary"},"data-test-subj":"indexPattern-advanced-accordion",className:"lnsIndexPatternDimensionEditor-advancedOptions",buttonContent:Object(x.jsx)(b.EuiTitle,{size:"xxs"},Object(x.jsx)("h5",null,Object(x.jsx)(b.EuiTextColor,{color:t.colors.primary},u.i18n.translate("xpack.lens.indexPattern.advancedSettings",{defaultMessage:"Advanced"})))),css:Object(x.css)("padding:0 ",t.size.base," ",t.size.base,";","")},e.options.map((({dataTestSubj:e,inlineElement:t})=>Object(x.jsx)("div",{key:e,"data-test-subj":e},Object(x.jsx)(b.EuiSpacer,{size:"s"}),t))))}function Jm(e,t,a){const n=null==a?void 0:a.trim(),i=t.columns[e],s=i.customLabel?i.label:Hc(i.label,i.timeScale,i.timeScale,i.timeShift,n,i.reducedTimeRange,i.reducedTimeRange);return{...t,columns:{...t.columns,[e]:{...t.columns[e],label:s,timeShift:n}}}}function eg({datatableUtilities:e,selectedColumn:t,columnId:a,layer:n,updateLayer:i,indexPattern:l,activeData:r,layerId:o}){const[c,d]=Object(s.useState)(t.timeShift);if(Object(s.useEffect)((()=>{d(t.timeShift)}),[t.timeShift]),!Tp[t.operationType].shiftable)return null;const p=Zr(e,n,l,r,o),{canShift:m,isValueTooSmall:g,isValueNotMultiple:f,isInvalid:v}=Jr(p);if(!m)return null;const h=c&&Object(ca.parseTimeShift)(c),y=Boolean(h&&v(h)),j=to(p,c);return Object(x.jsx)("div",null,Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed",fullWidth:!0,"data-test-subj":"indexPattern-dimension-time-shift-row",label:u.i18n.translate("xpack.lens.indexPattern.timeShift.label",{defaultMessage:"Time shift"}),helpText:u.i18n.translate("xpack.lens.indexPattern.timeShift.help",{defaultMessage:"Enter the time shift number and unit"}),error:j[0]||y&&u.i18n.translate("xpack.lens.indexPattern.timeShift.genericInvalidHelp",{defaultMessage:"Time shift value is not valid."}),isInvalid:Boolean(y||j.length)},Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiComboBox,{fullWidth:!0,compressed:!0,isClearable:!0,"data-test-subj":"indexPattern-dimension-time-shift",placeholder:u.i18n.translate("xpack.lens.indexPattern.timeShiftPlaceholder",{defaultMessage:"Type custom values (e.g. 8w)"}),options:Qr.filter((({value:e})=>{const t=Object(ca.parseTimeShift)(e);return t&&!g(t)&&!f(t)})),selectedOptions:function(){const e=Qr.filter((({value:e})=>e===c));return e.length>0?e:[{value:null!=c?c:"",label:null!=c?c:u.i18n.translate("xpack.lens.timeShift.none",{defaultMessage:"None"})}]}(),singleSelection:{asPlainText:!0},isInvalid:y,onCreateOption:e=>{const t=Object(ca.parseTimeShift)(e);v(t)?d(e):i(Jm(a,n,e))},onChange:e=>{if(0===e.length||e.length&&""===e[0].value)return i(Jm(a,n,"")),void d("");const t=e[0].value,s=Object(ca.parseTimeShift)(t);v(s)?d(t):i(Jm(a,n,t))}})))))}const tg="formula",ag="static_value",ng="quickFunctions",ig=new Set([tg,ag]);function sg(e){return!ig.has(e)}const lg=({currentOperationType:e,temporaryStateType:t})=>"none"===t||null!=e&&sg(e)?null:e===ag&&"quickFunctions"===t?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.staticValueWarning",{defaultMessage:"Static value currently applied"}),iconType:"warning",color:"warning"},Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.staticValueWarningText",{defaultMessage:"To overwrite your static value, select a quick function"})))):Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiCallOut,{className:"lnsIndexPatternDimensionEditor__warning",size:"s",title:u.i18n.translate("xpack.lens.indexPattern.formulaWarning",{defaultMessage:"Formula currently applied"}),iconType:"warning",color:"warning"},"quickFunctions"!==t?Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningStaticValueText",{defaultMessage:"To overwrite your formula, change the value in the input field"})):Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.indexPattern.formulaWarningText",{defaultMessage:"To overwrite your formula, select a quick function"})))),rg=({options:e,onMethodChange:t,selectedMethod:a})=>{const n=e.filter((({enabled:e})=>e)).map((({id:e,label:t})=>({id:e,label:t,"data-test-subj":`lens-dimensionTabs-${e}`})));return Object(x.jsx)(b.EuiFormRow,{label:u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingMethod",{defaultMessage:"Method"}),fullWidth:!0},Object(x.jsx)(b.EuiButtonGroup,{legend:u.i18n.translate("xpack.lens.indexPattern.dimensionEditorModes",{defaultMessage:"Dimension editor configuration modes"}),buttonSize:"compressed",isFullWidth:!0,options:n,idSelected:a,onChange:a=>(a=>{t(a);const n=e.find((({id:e})=>e===a));null==n||n.onClick()})(a)}))},og=Mp();function ug(e){return e&&"boolean"!=typeof e?e.helpMessage:null}var cg={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};function dg(e){var t,a,n,r,c,d;const{selectedColumn:p,operationSupportMatrix:m,state:g,columnId:f,setState:v,layerId:h,currentIndexPattern:y,hideGrouping:j,dateRange:O,dimensionGroups:I,toggleFullscreen:k,isFullscreen:T,supportStaticValue:M,enableFormatSelector:w=!0,layerType:C,paramEditorCustomProps:E}=e,S={data:e.data,fieldFormats:e.fieldFormats,uiSettings:e.uiSettings,http:e.http,storage:e.storage,unifiedSearch:e.unifiedSearch,dataViews:e.dataViews},{fieldByOperation:F,operationWithoutField:P}=m,_=p&&Tp[p.operationType],[A,L]=Object(s.useState)("none"),[D,R]=Object(s.useState)(!1),[B,N]=Object(s.useState)(!lm(g.layers[h])),[z,V]=Object(s.useState)(!1),[G,q]=Object(s.useState)(!1),H=Boolean(A===ng),U=Boolean(A===ag),{euiTheme:$}=Object(b.useEuiTheme)(),W=Object(s.useCallback)((e=>v((t=>am({state:t,layerId:h,newLayer:e})))),[h,v]),X=Object(s.useCallback)((t=>{(function(e,t){return Object.entries(e.columns).map((([e,t])=>{if(Ho("terms",t))return{id:e,otherBucket:t.params.otherBucket,termsSize:t.params.size}})).filter(st.nonNullable).some((({id:e,otherBucket:a,termsSize:n})=>{const i=t.columns[e];return!!Ho("terms",i)&&i.params.otherBucket!==a&&!i.params.otherBucket&&i.params.size>=Xu&&n<Xu}))})(g.layers[h],t)&&e.notifications.toasts.add({title:u.i18n.translate("xpack.lens.uiInfo.otherBucketChangeTitle",{defaultMessage:"“Group remaining values as Other” disabled"}),text:u.i18n.translate("xpack.lens.uiInfo.otherBucketDisabled",{defaultMessage:"Values >= 1000 may slow performance. Re-enable the setting in “Advanced” options."})}),q(!G)}),[h,e.notifications.toasts,g.layers,G]),Y=Object(s.useCallback)((t=>{lm(g.layers[h])&&!lm(t)&&null!=t.sampling&&t.sampling<1&&e.notifications.toasts.add({title:u.i18n.translate("xpack.lens.uiInfo.samplingDisabledTitle",{defaultMessage:"Layer sampling changed to 100%"}),text:u.i18n.translate("xpack.lens.uiInfo.samplingDisabledMessage",{defaultMessage:"The use of a maximum or minimum function on a layer requires all documents to be sampled in order to function properly."})}),N(!B)}),[B,h,e.notifications.toasts,g.layers]),Q=Object(s.useCallback)((t=>{(function(e,t){return Object.entries(e.columns).map((([t,a])=>{var n;if(Ho("terms",a)&&"column"===(null===(n=a.params)||void 0===n?void 0:n.orderBy.type)&&null!=a.params.orderBy.columnId){const n=e.columns[a.params.orderBy.columnId];if(Ho("percentile",n)&&Number.isInteger(n.params.percentile))return{id:t,rankId:a.params.orderBy.columnId};if(Ho("percentile_rank",n)&&Number.isInteger(n.params.value))return{id:t,rankId:a.params.orderBy.columnId}}})).filter(st.nonNullable).some((({id:e,rankId:a})=>{const n=t.columns[e];if(!Ho("terms",n))return!1;if("alphabetical"===n.params.orderBy.type){const e=t.columns[a];if(Ho("percentile",e))return!Number.isInteger(e.params.percentile);if(Ho("percentile_rank",e))return!Number.isInteger(e.params.value)}}))})(g.layers[h],t)&&e.notifications.toasts.add({title:u.i18n.translate("xpack.lens.uiInfo.rankingResetTitle",{defaultMessage:"Ranking changed to alphabetical"}),text:u.i18n.translate("xpack.lens.uiInfo.rankingResetToAlphabetical",{defaultMessage:"To rank by percentile, use whole numbers only."})}),V(!z)}),[z,h,e.notifications.toasts,g.layers]),K=Object(s.useCallback)((e=>{Y(e),Q(e),X(e)}),[Y,Q,X]),Z=Object(s.useCallback)(((e,t={})=>{const a=g.layers[h];let n;n=Uo(e)?{...a,columns:{...a.columns,[f]:e}}:"function"==typeof e?e(g.layers[h]):e;const i=Boolean(n.columns[f]);v((t=>{let a;const n=t.layers[h];a=Uo(e)?{...n,columns:{...n.columns,[f]:e}}:"function"==typeof e?e(t.layers[h]):e;const i=Ou(a,f);return K(i),am({state:t,layerId:h,newLayer:i})}),{isDimensionComplete:i,...t})}),[f,K,h,v,g.layers]),J=(null!==(t=g.layers[h].incompleteColumns)&&void 0!==t?t:{})[f],{operationType:ee,sourceField:te=null,...ae}=J||{},ne=Boolean(M?_&&sg(_.type):!_||sg(_.type)),ie=H||ne,se=U||"none"===A&&M&&(!p||(null==p?void 0:p.operationType)===ag),le=(t=e.state.layers[e.layerId])=>{if((null==p?void 0:p.operationType)!==ag){var a,n,i;const o=lu({layer:t,indexPattern:y,columnId:f,op:ag,visualizationGroups:I});var s,l,r;return null!=(null===(a=e.activeData)||void 0===a||null===(n=a[h])||void 0===n||null===(i=n.rows[0])||void 0===i?void 0:i[f])?Au(yu({layer:o,columnId:f,paramName:"value",value:null===(s=e.activeData)||void 0===s||null===(l=s[h])||void 0===l||null===(r=l.rows[0])||void 0===r?void 0:r[f]}),y):o}return t},re=function(e,t,a){return e?Tp[ag].paramEditor:null!=t&&t.paramEditor?t.paramEditor:a?Tp[ag].paramEditor:null}(U,_,M&&!ie),oe=Object(s.useMemo)((()=>Object.values(Tp).filter((({hidden:e})=>!e)).filter((e=>!("selectionStyle"in e)||"hidden"!==e.selectionStyle)).filter((({type:e})=>{var t;return(null===(t=F.get(e))||void 0===t?void 0:t.size)||P.has(e)})).sort(((e,t)=>e.displayName.localeCompare(t.displayName))).map((e=>e.type))),[F,P]),ue=Object(s.useRef)(null);Object(s.useEffect)((()=>()=>{ue.current&&(o.a.unmountComponentAtNode(ue.current),document.body.removeChild(ue.current))}),[]);const ce=p&&Ro(p)&&y.getFieldByName(p.sourceField),de=ce||function(e,t,a){if(!e)return;if(!("references"in e))return;const n=a.columns[e.references[0]];return n&&Ro(n)?t.getFieldByName(n.sourceField):void 0}(p,y,g.layers[h]),pe=oe.map((t=>{var a,n,i;const s=Tp[t];return{operationType:t,compatibleWithCurrentField:gu({layer:g.layers[h],columnId:f,op:t,indexPattern:y,field:ce||void 0,filterOperations:e.filterOperations,visualizationGroups:I,dateRange:O}),disabledStatus:s.getDisabledStatus&&s.getDisabledStatus(e.indexPatterns[g.currentIndexPatternId],g.layers[h],C),compatibleWithSampling:1===rm(g.layers[h])||null===(a=null===(n=s.getUnsupportedSettings)||void 0===n||null===(i=n.call(s))||void 0===i?void 0:i.sampling)||void 0===a||a}})),me=Object(s.useMemo)((()=>function(e,t,a){var n;const i=e.columns[t];return!(!i||!Ro(i)||null===(n=No(e,t,a))||void 0===n||!n.length)}(g.layers[h],f,y)),[g.layers,h,f,y]),ge="none"===A||null!=(null==p?void 0:p.operationType)&&sg(null==p?void 0:p.operationType),fe=pe.map((({operationType:t,compatibleWithCurrentField:a,disabledStatus:n,compatibleWithSampling:i})=>{var s;const r=Boolean(ee===t||!ee&&p&&p.operationType===t),c=a&&(null==de||null===(s=de.partiallyApplicableFunctions)||void 0===s?void 0:s[t])&&Object(x.jsx)("span",{"data-test-subj":`${t}-partial-warning`}," ",Object(x.jsx)(b.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.helpPartiallyApplicableFunctionLabel",{defaultMessage:"This function may only return partial results, as it is unable to support the full time range of rolled-up historical data."}),position:"left",size:"s",type:"partial",color:"warning"}));let d=Object(x.jsx)(l.a.Fragment,null,og[t].displayName,c);return r&&n?d=Object(x.jsx)(b.EuiToolTip,{content:n,display:"block",position:"left"},Object(x.jsx)(b.EuiText,{color:"danger",size:"s"},Object(x.jsx)("strong",null,d))):n?d=Object(x.jsx)(b.EuiToolTip,{content:n,display:"block",position:"left"},Object(x.jsx)("span",null,og[t].displayName)):a?i||(d=Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"none",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1,style:{marginRight:$.size.xs}},d),ge&&Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.settingsSamplingUnsupported",{defaultMessage:"Selecting this function will change this layer's sampling to 100% in order to function properly."}),size:"s",type:"dot",color:"warning"})))):d=Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"none",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1,style:{marginRight:$.size.xs,minWidth:0}},Object(x.jsx)("span",{css:cg},d)),ge&&Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiIconTip,{content:u.i18n.translate("xpack.lens.indexPattern.helpIncompatibleFieldDotLabel",{defaultMessage:"This function is not compatible with the current selected field"}),position:"left",size:"s",type:"dot",color:"warning"}))),{id:t,label:d,isActive:r,size:"s",isDisabled:!!n,className:"lnsIndexPatternDimensionEditor__operation","data-test-subj":`lns-indexPatternDimension-${t}${a?"":" incompatible"}`,"aria-pressed":r,extraAction:Tp[t].helpComponent?{color:"primary",onClick:a=>{if(ue.current)o.a.unmountComponentAtNode(ue.current),document.body.removeChild(ue.current),ue.current=null;else{const n=document.createElement("div");ue.current=n,document.body.appendChild(n);const i=Tp[t].helpComponent,s=Object(x.jsx)(fp,{button:a.target,isOpen:!0,title:Tp[t].helpComponentTitle,closePopover:()=>{ue.current&&(o.a.unmountComponentAtNode(ue.current),document.body.removeChild(ue.current),ue.current=null)},theme:e.core.theme},Object(x.jsx)(i,null));o.a.render(s,ue.current)}},iconType:"documentation",iconSize:"s","aria-label":u.i18n.translate("xpack.lens.indexPattern.helpLabel",{defaultMessage:"Function help"})}:void 0,onClick(){if(["none","fullReference","managedReference"].includes(Tp[t].input)){if((null==p?void 0:p.operationType)===t)return void(J&&Z(Lu(g.layers[h],f)));const a=lu({layer:e.state.layers[e.layerId],indexPattern:y,columnId:f,op:t,visualizationGroups:I,targetGroup:e.groupId});return H&&sg(a.columns[f].operationType)&&L("none"),void Z(a)}if(!p||!a){var n;const a=null!==(n=F.get(t))&&void 0!==n?n:new Set;let i;return i=1===a.size?lu({layer:e.state.layers[e.layerId],indexPattern:y,columnId:f,op:t,field:y.getFieldByName(a.values().next().value),visualizationGroups:I,targetGroup:e.groupId}):lu({layer:e.state.layers[e.layerId],indexPattern:y,columnId:f,op:t,field:a.has(It.DOCUMENT_FIELD_NAME)?Co.a:void 0,visualizationGroups:I,targetGroup:e.groupId}),H&&sg(i.columns[f].operationType)&&L("none"),void Z(i)}if(p.operationType===t)return void(J&&Z(Lu(g.layers[h],f)));H&&L("none");const i=pu({layer:e.state.layers[e.layerId],indexPattern:y,columnId:f,op:t,field:Ro(p)?y.getFieldByName(p.sourceField):void 0,visualizationGroups:I});Z(i)}}})),be=!me&&!J&&p&&sg(p.operationType)&&re,ve=!J&&p&&"references"in p&&"fullReference"===(null==_?void 0:_.input),he=!p||"field"===(null==_?void 0:_.input)||ee&&"field"===(null===(a=Tp[ee])||void 0===a?void 0:a.input)||H,xe=(null==_?void 0:_.renderFieldInput)||ec,ye={layer:g.layers[h],layerId:h,activeData:e.activeData,paramEditorUpdater:e=>{H&&L("none"),Z(e,{forceRender:H})},columnId:f,currentColumn:g.layers[h].columns[f],dateRange:O,indexPattern:y,operationDefinitionMap:Tp,toggleFullscreen:k,isFullscreen:T,paramEditorCustomProps:E,ReferenceEditor:Um,dataSectionExtra:e.dataSectionExtra,...S},je=Object(x.jsx)(b.EuiButtonIcon,{onClick:()=>R((e=>!e)),iconType:"documentation","aria-label":u.i18n.translate("xpack.lens.indexPattern.quickFunctions.tableTitle",{defaultMessage:"Description of functions"})}),Oe=[{field:"function",name:u.i18n.translate("xpack.lens.indexPattern.functionTable.functionHeader",{defaultMessage:"Function"}),width:"150px"},{field:"description",name:u.i18n.translate("xpack.lens.indexPattern.functionTable.descriptionHeader",{defaultMessage:"Description"})}],Ie=fe.filter((e=>Tp[e.id].quickFunctionDocumentation)).map((e=>{const t=Tp[e.id];return{id:e.id,function:t.displayName,description:t.quickFunctionDocumentation}})),ke=Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{label:Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!1},u.i18n.translate("xpack.lens.indexPattern.functionsLabel",{defaultMessage:"Functions"})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiPopover,{anchorPosition:"rightUp",button:je,isOpen:D,display:"inlineBlock",panelPaddingSize:"none",closePopover:()=>R(!1),initialFocus:"#functionsHelpBasicTableId"},Object(x.jsx)(b.EuiPopoverTitle,{paddingSize:"s"},u.i18n.translate("xpack.lens.indexPattern.quickFunctions.popoverTitle",{defaultMessage:"Quick functions"})),Object(x.jsx)(b.EuiPanel,{className:"eui-yScroll",style:{maxHeight:"40vh"},color:"transparent",paddingSize:"s"},Object(x.jsx)(b.EuiBasicTable,{id:"functionsHelpBasicTableId",style:{width:350},tableCaption:u.i18n.translate("xpack.lens.indexPattern.quickFunctions.tableTitle",{defaultMessage:"Description of functions"}),items:Ie,compressed:!0,rowHeader:"firstName",columns:Oe,responsive:!1}))))),fullWidth:!0},Object(x.jsx)(b.EuiListGroup,{className:fe.length>3?"lnsIndexPatternDimensionEditor__columns":"",gutterSize:"none",color:"primary",listItems:fe.length%2==1?[...fe,{label:" "}]:fe,maxWidth:!1})),ve?Object(x.jsx)(l.a.Fragment,null,p.references.map(((t,a)=>{var n;const s=_.requiredReferences[a],l=g.layers[h];return Object(x.jsx)(Um,i()({operationDefinitionMap:Tp,key:a,layer:l,layerId:h,activeData:e.activeData,columnId:t,column:l.columns[t],incompleteColumn:l.incompleteColumns?l.incompleteColumns[t]:void 0,onResetIncomplete:()=>{W({...l,incompleteColumns:{...l.incompleteColumns,[t]:null}})},onDeleteColumn:()=>{W(Iu({layer:l,columnId:t,indexPattern:y}))},onChooseFunction:(e,a)=>{const n=lu({layer:l,columnId:t,op:e,indexPattern:y,field:a,visualizationGroups:I});K(n),W(n)},onChooseField:e=>{W(lu({layer:l,columnId:t,indexPattern:y,op:e.operationType,field:y.getFieldByName(e.field),visualizationGroups:I}))},paramEditorUpdater:e=>{let a;return a="function"==typeof e?e(l):Uo(e)?{...l,columns:{...l.columns,[t]:e}}:e,K(a),W(Ou(a,t))},validation:s,currentIndexPattern:y,selectionStyle:_.selectionStyle,dateRange:O,labelAppend:null==_||null===(n=_.getHelpMessage)||void 0===n?void 0:n.call(_,{data:e.data,uiSettings:e.uiSettings,currentColumn:l.columns[f]}),isFullscreen:T,toggleFullscreen:k,paramEditorCustomProps:E},S))})),"field"!==_.selectionStyle?Object(x.jsx)(b.EuiSpacer,{size:"s"}):null):null,he?Object(x.jsx)(xe,{layer:g.layers[h],selectedColumn:p,columnId:f,indexPattern:y,operationSupportMatrix:m,updateLayer:e=>{H&&L("none"),Z(e,{forceRender:H})},incompleteField:te,incompleteOperation:ee,incompleteParams:ae,currentFieldIsInvalid:me,helpMessage:null==_||null===(n=_.getHelpMessage)||void 0===n?void 0:n.call(_,{data:e.data,uiSettings:e.uiSettings,currentColumn:g.layers[h].columns[f]}),dimensionGroups:I,groupId:e.groupId,operationDefinitionMap:Tp}):null,!T&&!J&&!j&&"none"===A&&Object(x.jsx)(Tm,{layer:g.layers[e.layerId],columnId:e.columnId,setColumns:e=>W({columnOrder:e}),getFieldByName:y.getFieldByName}),be&&Object(x.jsx)(re,ye),!(null!=_&&_.handleDataSectionExtra)&&Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"m"}),e.dataSectionExtra)),Te=re?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(re,i()({layer:g.layers[h],activeData:e.activeData,paramEditorUpdater:U?e=>{if(U&&L("none"),"function"==typeof e)return v((t=>{const a=e(le(t.layers[h]));return am({state:t,layerId:h,newLayer:a})}),{isDimensionComplete:!0,forceRender:!0});if(Uo(e))throw new Error("static value should only be updated by the whole layer")}:Z,columnId:f,currentColumn:g.layers[h].columns[f],operationDefinitionMap:Tp,layerId:h,paramEditorCustomProps:E,dateRange:O,isFullscreen:T,indexPattern:y,toggleFullscreen:k,ReferenceEditor:Um},S))):null,Me=ie?ke:Te,we=Object(s.useCallback)((e=>{W(yu({layer:g.layers[h],columnId:f,paramName:"format",value:e}))}),[f,h,g.layers,W]),Ce=!T&&m.operationWithoutField.has(tg),Ee=!T&&(Ce||M),Se=Object(s.useMemo)((()=>{let e="";return se?e=ag:ie?e=ng:"none"===A&&(null==p?void 0:p.operationType)===tg&&(e=tg),e}),[null==p?void 0:p.operationType,ie,se,A]),[Fe,Pe]=Object(s.useState)(Se),_e=[{id:ag,enabled:Boolean(M),state:se,onClick:()=>{if((null==p?void 0:p.operationType)===tg)return L(ag);L("none"),Z(le())},label:u.i18n.translate("xpack.lens.indexPattern.staticValueLabel",{defaultMessage:"Static value"})},{id:ng,enabled:!0,state:ie,onClick:()=>{!p||sg(p.operationType)||L(ng)},label:u.i18n.translate("xpack.lens.indexPattern.quickFunctionsLabel",{defaultMessage:"Quick function"})},{id:tg,enabled:Ce,state:"none"===A&&(null==p?void 0:p.operationType)===tg,onClick:()=>{if(L("none"),(null==p?void 0:p.operationType)!==tg){const t=lu({layer:e.state.layers[e.layerId],indexPattern:y,columnId:f,op:tg,visualizationGroups:I});Z(t)}},label:u.i18n.translate("xpack.lens.indexPattern.formulaLabel",{defaultMessage:"Formula"})}],Ae=Object(s.useMemo)((()=>String(p&&Tp[p.operationType].getDefaultLabel(p,g.layers[h].columns,e.indexPatterns[g.layers[h].indexPatternId]))),[h,p,e.indexPatterns,g.layers]),Le=Object(s.useCallback)((e=>{p&&Z(p.operationType===tg?lu({op:p.operationType,layer:e,columnId:f,indexPattern:y,visualizationGroups:I}):e)}),[f,y,I,p,Z]),De=!T&&!me&&!J&&p&&"none"===A&&_&&(_.timeScalingMode||_.filterable||_.shiftable);return Object(x.jsx)("div",{id:f},Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded"},Object(x.jsx)(b.EuiText,{size:"s",css:Object(x.css)("margin-bottom:",$.size.base,";","")},Object(x.jsx)("h4",null,null!==(r=null==E?void 0:E.headingLabel)&&void 0!==r?r:u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingData",{defaultMessage:"Data"}))),Object(x.jsx)(l.a.Fragment,null,Ee?Object(x.jsx)(rg,{options:_e,onMethodChange:e=>{Pe(e)},selectedMethod:Fe}):null,Object(x.jsx)(lg,{currentOperationType:null==p?void 0:p.operationType,temporaryStateType:A}),Me)),De&&Object(x.jsx)(Zm,{options:[{dataTestSubj:"indexPattern-time-scaling-enable",inlineElement:_.timeScalingMode?Object(x.jsx)($m,{selectedColumn:p,columnId:f,layer:g.layers[h],updateLayer:Le}):null},{dataTestSubj:"indexPattern-filter-by-enable",inlineElement:_.filterable?Object(x.jsx)(Xm,{indexPattern:y,selectedColumn:p,columnId:f,layer:g.layers[h],updateLayer:Le,helpMessage:ug(_.filterable)}):null},{dataTestSubj:"indexPattern-reducedTimeRange-enable",inlineElement:_.canReduceTimeRange?Object(x.jsx)(Km,{selectedColumn:p,columnId:f,indexPattern:y,layer:g.layers[h],updateLayer:Le,skipLabelUpdate:Ce,helpMessage:ug(_.canReduceTimeRange)}):null},{dataTestSubj:"indexPattern-time-shift-enable",inlineElement:Boolean(_.shiftable&&(y.timeFieldName||Object.values(g.layers[h].columns).some((e=>"date_histogram"===e.operationType))))?Object(x.jsx)(eg,{datatableUtilities:S.data.datatableUtilities,indexPattern:y,selectedColumn:p,columnId:f,layer:g.layers[h],updateLayer:Le,activeData:e.activeData,layerId:h}):null},...(null===(c=(d=Tp[p.operationType]).getAdvancedOptions)||void 0===c?void 0:c.call(d,ye))||[]]}),!T&&!me&&Object(x.jsx)("div",{className:"lnsIndexPatternDimensionEditor--padded lnsIndexPatternDimensionEditor--collapseNext"},!J&&"none"===A&&p&&Object(x.jsx)(b.EuiText,{size:"s",css:Object(x.css)("margin-bottom:",$.size.base,";","")},Object(x.jsx)("h4",null,u.i18n.translate("xpack.lens.indexPattern.dimensionEditor.headingAppearance",{defaultMessage:"Appearance"}))),Object(x.jsx)(l.a.Fragment,null,!J&&p&&"none"===A&&Object(x.jsx)(Om.a,{value:p.label,defaultValue:Ae,onChange:t=>{W({columns:{...g.layers[h].columns,[f]:{...p,label:t,customLabel:Tp[p.operationType].getDefaultLabel(p,g.layers[h].columns,e.indexPatterns[g.layers[h].indexPatternId])!==t}}})}}),!w||T||!p||"number"!==p.dataType&&"range"!==p.operationType?null:Object(x.jsx)(qm,{selectedColumn:p,onChange:we,docLinks:e.core.docLinks}))))}const pg=ar()((function(e,t){return e.reduce(((e,{operationMetaData:a,operations:n})=>t(a)?[...e,...n]:e),[]).reduce(((e,t)=>{if("field"===t.type){var a,n;const i=null!==(a=e.operationByField.get(t.field))&&void 0!==a?a:new Set;i.add(t.operationType),e.operationByField.set(t.field,i);const s=null!==(n=e.fieldByOperation.get(t.operationType))&&void 0!==n?n:new Set;s.add(t.field),e.fieldByOperation.set(t.operationType,s)}else e.operationWithoutField.add(t.operationType);return e}),{operationByField:new Map,operationWithoutField:new Set,fieldByOperation:new Map})})),mg=function(e){var t;const a=e.layerId,n=e.indexPatterns[null===(t=e.state.layers[a])||void 0===t?void 0:t.indexPatternId];if(!n)return null;const s=(e=>{const t=e.layerId,a=e.indexPatterns[e.state.layers[t].indexPatternId],n=_p(a);return pg(n,e.filterOperations)})(e),l=e.state.layers[a].columns[e.columnId]||null;return Object(x.jsx)(dg,i()({},e,{layerType:e.layerType||z.LayerTypes.DATA,currentIndexPattern:n,selectedColumn:l,operationSupportMatrix:s}))},gg=Object(s.memo)(mg);var fg=a(81);const bg=Mp();function vg(e,t,a,n,i){if(!e)return;const s=Pp(e,t,i);return s.length?a&&s.includes(a.operationType)?a.operationType:n&&s.includes(n)?n:s[0]:void 0}function hg(e,t){if(e)return Ro(e)&&t.getFieldByName(e.sourceField)||void 0}function xg(e){const{state:t,source:a,target:n,indexPatterns:i}=e;if(!a)return;const s={...n,column:t.layers[n.layerId].columns[n.columnId],dataView:i[t.layers[n.layerId].indexPatternId]};if(Object(st.isDraggedDataViewField)(a))return function({state:e,source:t,target:a,indexPatterns:n}){const i=e.layers[a.layerId].columns[a.columnId],s=e.layers[a.layerId].indexPatternId===t.indexPatternId,l=vg(t.field,a.filterOperations,i);if(s&&l){const s=bg[l].displayName;if(!i)return{dropTypes:["field_add"],nextLabel:s};if(Ro(i)&&i.sourceField!==t.field.name||!Ro(i)){const l=n[e.layers[a.layerId].indexPatternId];return Ro(i)&&l&&Fp(l,i,void 0,t.field)?{dropTypes:["field_replace","field_combine"]}:{dropTypes:["field_replace"],nextLabel:s}}}}({...e,source:a,target:s});if(Object(fg.g)(a)){var l,r;const e={...a,column:null===(l=t.layers[a.layerId])||void 0===l?void 0:l.columns[a.columnId],dataView:i[null===(r=t.layers[a.layerId])||void 0===r?void 0:r.indexPatternId]};if(!e.column)return;var o;if(n.columnId!==a.columnId&&s.dataView===e.dataView)return Object(st.isOperationFromTheSameGroup)(a,n)?s.column?{dropTypes:["reorder"]}:{dropTypes:["duplicate_compatible"]}:null!==(o=s.filterOperations)&&void 0!==o&&o.call(s,null==e?void 0:e.column)?function(e,t){var a;if(!t.column)return{dropTypes:["move_compatible","duplicate_compatible"]};const n=["replace_compatible","replace_duplicate_compatible",...(null===(a=e.filterOperations)||void 0===a?void 0:a.call(e,t.column))?["swap_compatible"]:[]];return t.dataView&&Ro(t.column)?(Fp(t.dataView,t.column,e.column)&&n.push("combine_compatible"),{dropTypes:n}):{dropTypes:n}}(e,s):function(e,t){const a=t?Ep(t):[],n=new Set(Ep(e));return a.length===n.size&&a.every((e=>n.has(e)))}(e.column,s.column)?void 0:function(e,t){if(!t.dataView||!e.column)return;const a=vg(hg(e.column,e.dataView),t.filterOperations,t.column);if(a){const n=hg(t.column,t.dataView),i=Boolean(vg(n,e.filterOperations,e.column)),s=[];return t.column?(s.push("replace_incompatible","replace_duplicate_incompatible"),i&&s.push("swap_incompatible"),Fp(t.dataView,t.column,e.column)&&s.push("combine_incompatible")):s.push("move_incompatible","duplicate_incompatible"),{dropTypes:s,nextLabel:bg[a].displayName}}}(e,s)}}function yg(e){const{target:t,source:a,dropType:n,state:i,indexPatterns:s}=e;if(Object(st.isDraggedDataViewField)(a)&&jg(n))return function(e,t){var a,n;const{state:i,source:s,target:l,targetLayerDimensionGroups:r,indexPatterns:o}=e,u=null===(a=r.find((e=>e.groupId===l.groupId)))||void 0===a?void 0:a.prioritizedOperation,c=i.layers[l.layerId],d=o[c.indexPatternId],p=c.columns[l.columnId],m=new Set(Object.values(c.columns).filter((e=>"sourceField"in e&&e.sourceField===s.field.name)).map((e=>e.operationType))),g=t?p.operationType:vg(s.field,l.filterOperations,p,u,m);if(!Object(st.isDraggedDataViewField)(s)||!g||t&&!Fp(d,p,void 0,s.field))return;const f=t?hg(p,d):s.field,b=t?{params:(null===(n=Sp(p.operationType))||void 0===n?void 0:n({targetColumn:p,field:s.field,indexPattern:d}))||{}}:void 0,v=lu({layer:c,columnId:l.columnId,indexPattern:d,op:g,field:f,visualizationGroups:r,targetGroup:l.groupId,shouldCombineField:t,initialParams:b});return am({state:i,layerId:l.layerId,newLayer:v})}({...e,target:{...t,dataView:s[i.layers[t.layerId].indexPatternId]},source:a,indexPatterns:s},"field_combine"===n);if(!Object(fg.g)(a))return;const l=s[i.layers[a.layerId].indexPatternId],r=s[i.layers[t.layerId].indexPatternId];if(l!==r)return;const o={...e,target:{...t,dataView:r},source:{...a,dataView:l},indexPatterns:s};return"reorder"===n?function({state:e,source:t,target:a}){return am({state:e,layerId:a.layerId,newLayer:{columnOrder:Object(st.reorderElements)(e.layers[a.layerId].columnOrder,a.columnId,t.columnId)}})}(o):["duplicate_compatible","replace_duplicate_compatible","move_compatible","replace_compatible"].includes(n)?function({state:e,source:t,target:a,targetLayerDimensionGroups:n,indexPatterns:i},s){let l=su({layers:e.layers,target:a,source:t});const r=vu(n,ku(l[a.layerId]),a.groupId,a.columnId);l={...l,[a.layerId]:{...l[a.layerId],columnOrder:r,columns:l[a.layerId].columns}};const o=nm({state:e,newLayers:l});return s?nb({layerId:t.layerId,columnId:t.columnId,prevState:o,indexPatterns:i}):o}(o,Object(st.shouldRemoveSource)(a,n)):["duplicate_incompatible","replace_duplicate_incompatible","move_incompatible","replace_incompatible"].includes(n)?function({state:e,source:t,targetLayerDimensionGroups:a,target:n,indexPatterns:i},s){const l=e.layers[n.layerId],r=l.columns[n.columnId]||null,o=e.layers[t.layerId],u=i[o.indexPatternId],c=hg(o.columns[t.columnId],u),d=vg(c,n.filterOperations,r);if(!d)return;let p;if(n.layerId===t.layerId){const t=lu({layer:o,columnId:n.columnId,indexPattern:u,op:d,field:c,visualizationGroups:a,targetGroup:n.groupId,shouldResetLabel:!0});p=am({state:e,layerId:n.layerId,newLayer:t})}else{const i=lu({layer:l,columnId:n.columnId,indexPattern:u,op:d,field:c,visualizationGroups:a,targetGroup:n.groupId,shouldResetLabel:!0});p=nm({state:e,newLayers:{[t.layerId]:o,[n.layerId]:i}})}return s?nb({layerId:t.layerId,columnId:t.columnId,prevState:p,indexPatterns:i}):p}(o,Object(st.shouldRemoveSource)(a,n)):"swap_compatible"===n?function({state:e,source:t,targetLayerDimensionGroups:a,target:n}){if(n.layerId===t.layerId){const i=e.layers[n.layerId],s={...i.columns,[n.columnId]:{...i.columns[t.columnId]},[t.columnId]:{...i.columns[n.columnId]}};let l=Og(i.columnOrder,t.columnId,n.columnId);return l=vu(a,l,n.groupId,n.columnId),am({state:e,layerId:n.layerId,newLayer:{columnOrder:l,columns:s}})}{const a=su({layers:e.layers,target:n,source:t,shouldDeleteSource:!0})[n.layerId],i=su({layers:e.layers,target:t,source:n,shouldDeleteSource:!0})[t.layerId];return nm({state:e,newLayers:{[t.layerId]:i,[n.layerId]:a}})}}(o):"swap_incompatible"===n?function({state:e,source:t,targetLayerDimensionGroups:a,target:n,indexPatterns:i}){const s=e.layers[n.layerId],l=e.layers[t.layerId],r=i[s.indexPatternId],o=l.columns[t.columnId],u=s.columns[n.columnId],c=hg(o,r),d=hg(u,r),p=vg(c,n.filterOperations,u),m=vg(d,t.filterOperations,o);if(!p||!m)return;const g=lu({layer:s,columnId:n.columnId,targetGroup:n.groupId,indexPattern:r,op:p,field:c,visualizationGroups:a,shouldResetLabel:!0});if(t.layerId===n.layerId){const i=lu({layer:g,columnId:t.columnId,indexPattern:r,op:m,field:d,visualizationGroups:a,targetGroup:t.groupId,shouldResetLabel:!0});return am({state:e,layerId:n.layerId,newLayer:i})}{const i=lu({layer:l,columnId:t.columnId,indexPattern:r,op:m,field:d,visualizationGroups:a,targetGroup:t.groupId,shouldResetLabel:!0});return nm({state:e,newLayers:{[t.layerId]:i,[n.layerId]:g}})}}(o):["combine_incompatible","combine_compatible"].includes(n)?function({state:e,source:t,target:a,targetLayerDimensionGroups:n,indexPatterns:i},s){var l,r;const o=e.layers[a.layerId],u=o.columns[a.columnId],c=hg(u,a.dataView),d=i[o.indexPatternId],p=e.layers[t.layerId].columns[t.columnId];if(!hg(p,d)||!c)return;const m={params:null!==(l=null===(r=Sp(u.operationType))||void 0===r?void 0:r({targetColumn:u,sourceColumn:p,indexPattern:d}))&&void 0!==l?l:{}},g=pu({layer:o,columnId:a.columnId,indexPattern:d,op:u.operationType,field:c,visualizationGroups:n,targetGroup:a.groupId,initialParams:m,shouldCombineField:!0}),f=nm({state:e,newLayers:{...e.layers,[a.layerId]:g}});return s?nb({layerId:t.layerId,columnId:t.columnId,prevState:f,indexPatterns:i}):f}(o,Object(st.shouldRemoveSource)(a,n)):void 0}const jg=e=>["field_add","field_replace","field_combine"].includes(e),Og=(e,t,a)=>{const n=e.findIndex((e=>e===t)),i=e.findIndex((e=>e===a)),s=[...e];return s[n]=a,s[i]=t,s};a(430);var Ig=a(6),kg=a(134);const Tg=Object(qt.memoize)((function(e){const t=e.trim();let a=t.split(/[* ]+/).map(qt.escapeRegExp).join(".*");return t.includes(" ")&&(a=".*"+a+".*"),new RegExp(a.includes("*")?`^${a}$`:a,"i")})),Mg=(e,t)=>{if(null==t||!t.trim())return!1;const a=Tg(t);return!!e.displayName&&a.test(e.displayName)||a.test(e.name)};function wg(e,t){const a=(t||"").trim();return(a.includes("*")||a.includes(" "))&&Mg({name:e},a)?e:a}const Cg=Object(b.htmlIdGenerator)("fieldList");function Eg({dataViewId:e,allFields:t,services:a,isAffectedByGlobalFilter:n=!1,popularFieldsLimit:i,sortedSelectedFields:l,getCustomFieldType:r,onOverrideFieldGroupDetails:o,onSupportedFieldFilter:c,onSelectedFieldFilter:d}){const p=Object(Gu.b)(),m=function({allFields:e,getCustomFieldType:t,onSupportedFieldFilter:a,services:n}){const[i,l]=Object(s.useState)([]),[r,o]=Object(s.useState)(""),u=Object(s.useMemo)((()=>Cg()),[]),c=n.core.docLinks;return Object(s.useMemo)((()=>{const n=r.trim().toLowerCase();return{fieldSearchHighlight:n,fieldListFiltersProps:{docLinks:c,selectedFieldTypes:i,allFields:e,getCustomFieldType:t,onSupportedFieldFilter:a,onChangeFieldTypes:l,nameFilter:r,onChangeNameFilter:o,screenReaderDescriptionId:u},onFilterField:null!=n&&n.length||i.length>0?e=>!(n&&!Mg(e,n))&&(!(i.length>0)||i.includes(Object(Hu.a)(e,t))):void 0}}),[c,i,e,t,a,l,r,o,u])}({allFields:t,services:a,getCustomFieldType:r,onSupportedFieldFilter:c}),g=m.onFilterField,[f,b]=Object(s.useState)(null),v=Boolean(null==f?void 0:f.timeFieldName),h=!e||p.isFieldsExistenceInfoUnavailable(e),x=e?p.hasFieldData:Pg;Object(s.useEffect)((()=>{(async()=>{if(e){let t=null;try{t=await a.dataViews.get(e,!1)}catch(e){}b(t||null)}else b(null)})()}),[e,a.dataViews,b,x]),Object(s.useEffect)((()=>{f&&!e&&b(null)}),[f,b,e]);const y=Object(s.useMemo)((()=>Date.now()),[e,g]),j=Object(s.useMemo)((()=>{const a=l||[],s=[...t||[]].sort(Fg),r={specialFields:[],availableFields:[],emptyFields:[],metaFields:[],unmappedFields:[],skippedFields:[],...Object(qt.groupBy)(s,(t=>{var n;return!l&&d&&d(t)&&a.push(t),c&&!c(t)?"skippedFields":"document"===t.type?"specialFields":null!=f&&null!==(n=f.metaFields)&&void 0!==n&&n.includes(t.name)?"metaFields":"nested"===t.type?"availableFields":null!=f&&f.getFieldByName&&!f.getFieldByName(t.name)?"unmappedFields":(t=>!e||x(e,t.name))(t)||h?"availableFields":"emptyFields"}))},p=i?s.filter((e=>e.count&&"_source"!==e.type&&(!c||c(e)))).sort(((e,t)=>(t.count||0)-(e.count||0))).slice(0,i):[];let m={SpecialFields:{fields:r.specialFields,fieldCount:r.specialFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!1,title:"",hideDetails:!0},SelectedFields:{fields:a,fieldCount:a.length,isInitiallyOpen:!0,showInAccordion:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.selectedFieldsLabel",{defaultMessage:"Selected fields"}),isAffectedByGlobalFilter:n,isAffectedByTimeFilter:v,hideDetails:!1,hideIfEmpty:!0},PopularFields:{fields:p,fieldCount:p.length,isInitiallyOpen:!0,showInAccordion:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.popularFieldsLabel",{defaultMessage:"Popular fields"}),helpText:u.i18n.translate("unifiedFieldList.useGroupedFields.popularFieldsLabelHelp",{defaultMessage:"Fields that your organization frequently uses, from most to least popular."}),isAffectedByGlobalFilter:n,isAffectedByTimeFilter:v,hideDetails:!1,hideIfEmpty:!0},AvailableFields:{fields:r.availableFields,fieldCount:r.availableFields.length,isInitiallyOpen:!0,showInAccordion:!0,title:e&&h?u.i18n.translate("unifiedFieldList.useGroupedFields.allFieldsLabel",{defaultMessage:"All fields"}):u.i18n.translate("unifiedFieldList.useGroupedFields.availableFieldsLabel",{defaultMessage:"Available fields"}),isAffectedByGlobalFilter:n,isAffectedByTimeFilter:v,hideDetails:h,defaultNoFieldsMessage:u.i18n.translate("unifiedFieldList.useGroupedFields.noAvailableDataLabel",{defaultMessage:"There are no available fields that contain data."})},UnmappedFields:{fields:r.unmappedFields,fieldCount:r.unmappedFields.length,isAffectedByGlobalFilter:n,isAffectedByTimeFilter:v,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!0,title:u.i18n.translate("unifiedFieldList.useGroupedFields.unmappedFieldsLabel",{defaultMessage:"Unmapped fields"}),helpText:u.i18n.translate("unifiedFieldList.useGroupedFields.unmappedFieldsLabelHelp",{defaultMessage:"Fields that aren't explicitly mapped to a field data type."})},EmptyFields:{fields:r.emptyFields,fieldCount:r.emptyFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!e,title:u.i18n.translate("unifiedFieldList.useGroupedFields.emptyFieldsLabel",{defaultMessage:"Empty fields"}),helpText:u.i18n.translate("unifiedFieldList.useGroupedFields.emptyFieldsLabelHelp",{defaultMessage:"Fields that don't have any values based on your filters."}),defaultNoFieldsMessage:u.i18n.translate("unifiedFieldList.useGroupedFields.noEmptyDataLabel",{defaultMessage:"There are no empty fields."})},MetaFields:{fields:r.metaFields,fieldCount:r.metaFields.length,isAffectedByGlobalFilter:!1,isAffectedByTimeFilter:!1,isInitiallyOpen:!1,showInAccordion:!0,hideDetails:!1,hideIfEmpty:!e,title:u.i18n.translate("unifiedFieldList.useGroupedFields.metaFieldsLabel",{defaultMessage:"Meta fields"}),defaultNoFieldsMessage:u.i18n.translate("unifiedFieldList.useGroupedFields.noMetaDataLabel",{defaultMessage:"There are no meta fields."})}};return h&&delete m.EmptyFields,o&&(m=Object.keys(m).reduce(((e,t)=>{const a=t,n=m[a];return n&&(e[a]={...n,...o(a)||{}}),e}),{})),m}),[t,c,d,o,f,e,x,h,n,v,i,l]),O=Object(s.useMemo)((()=>g?Object.fromEntries(Object.entries(j).map((([e,t])=>[e,{...t,fieldSearchHighlight:m.fieldSearchHighlight,fields:t.fields.filter(g)}]))):j),[j,g,m.fieldSearchHighlight]),I=Boolean(t),k=null==t?void 0:t.length,T=Object(s.useMemo)((()=>!e||Boolean(k)),[e,k]),M=Object(s.useMemo)((()=>I?e&&p?p.getFieldsExistenceStatus(e):kg.a.succeeded:kg.a.unknown),[e,I,p]),w=m.fieldListFiltersProps.screenReaderDescriptionId;return{fieldListGroupedProps:Object(s.useMemo)((()=>({fieldGroups:O,scrollToTopResetCounter:y,fieldsExistInIndex:T,fieldsExistenceStatus:M,screenReaderDescriptionId:w})),[O,y,T,M,w]),fieldListFiltersProps:m.fieldListFiltersProps}}const Sg=new Intl.Collator(void 0,{sensitivity:"base"});function Fg(e,t){return Sg.compare(e.displayName||e.name,t.displayName||t.name)}function Pg(){return!0}const _g={name:"zxsb69",styles:"position:relative;width:100%;height:100%"},Ag=({"data-test-subj":e="fieldList",isProcessing:t,prepend:a,append:n,className:i,children:s})=>Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"none",direction:"column",responsive:!1,"data-test-subj":e,css:_g,className:i},t&&Object(x.jsx)(b.EuiProgress,{size:"xs",color:"accent",position:"absolute","data-test-subj":`${e}Loading`}),!!a&&Object(x.jsx)(b.EuiFlexItem,{grow:!1},a),Object(x.jsx)(b.EuiFlexItem,{grow:!0},s),!!n&&Object(x.jsx)(b.EuiFlexItem,{grow:!1},n)),Lg=()=>Object(x.jsx)(s.Fragment,null),Dg=l.a.lazy((()=>a.e(13).then(a.bind(null,562)))),Rg=function(e){return Object(x.jsx)(l.a.Suspense,{fallback:Object(x.jsx)(Lg,null)},Object(x.jsx)(Dg,e))},Bg=()=>Object(x.jsx)(s.Fragment,null),Ng=l.a.lazy((()=>a.e(8).then(a.bind(null,563)))),zg=function(e){return Object(x.jsx)(l.a.Suspense,{fallback:Object(x.jsx)(Bg,null)},Object(x.jsx)(Ng,e))};a(435);var Vg=a(42);a(440);const Gg=({isOpen:e,closePopover:t,renderHeader:a,renderContent:n,...s})=>{let r=null,o=null;if(e){try{r=(null==a?void 0:a())||null}catch(e){console.error(e)}try{o=(null==n?void 0:n())||null}catch(e){console.error(e)}}return Object(x.jsx)(b.EuiPopover,i()({ownFocus:!0,isOpen:e,closePopover:t,display:"block",anchorPosition:"rightUp","data-test-subj":"fieldPopover",panelClassName:"unifiedFieldList__fieldPopover__fieldPopoverPanel"},s),e&&Object(x.jsx)(l.a.Fragment,null,o&&r?Object(x.jsx)(b.EuiPopoverTitle,null,r):r,o))};var qg=a(182),Hg=a(175),Ug=a(386);function $g({field:e,fieldSearchHighlight:t,isSelected:a,isActive:n,isEmpty:s,infoIcon:l,className:r,getCustomFieldType:o,dataTestSubj:c,size:d,onClick:p,shouldAlwaysShowAction:m,buttonAddFieldToWorkspaceProps:g,buttonRemoveFieldFromWorkspaceProps:f,onAddFieldToWorkspace:v,onRemoveFieldFromWorkspace:h,...y}){var j,I;const k=e.displayName||e.name,T=k!==e.name&&"___records___"!==e.name?u.i18n.translate("unifiedFieldList.fieldItemButton.fieldTitle",{defaultMessage:"{fieldDisplayName} ({fieldName})",values:{fieldName:e.name,fieldDisplayName:k}}):k,M=o?{type:o(e)}:Object(Hg.a)(e),w=M.type,C=O()("unifiedFieldListItemButton",{[`unifiedFieldListItemButton--${w}`]:w,"unifiedFieldListItemButton--exists":!s,"unifiedFieldListItemButton--missing":s,"unifiedFieldListItemButton--withDragHandle":Boolean(y.dragHandle)},r),E=null!==(j=null==g?void 0:g["aria-label"])&&void 0!==j?j:u.i18n.translate("unifiedFieldList.fieldItemButton.addFieldToWorkspaceLabel",{defaultMessage:'Add "{field}" field',values:{field:e.displayName}}),S=null!==(I=null==f?void 0:f["aria-label"])&&void 0!==I?I:u.i18n.translate("unifiedFieldList.fieldItemButton.removeFieldToWorkspaceLabel",{defaultMessage:'Remove "{field}" field',values:{field:e.displayName}}),F=O()("unifiedFieldListItemButton__action",{"unifiedFieldListItemButton__action--always":m}),P=a?h&&Object(x.jsx)(b.EuiToolTip,{key:`selected-to-remove-${e.name}-${S}`,content:S},Object(x.jsx)(b.EuiButtonIcon,i()({"data-test-subj":`fieldToggle-${e.name}`,"aria-label":S},f||{},{className:O()(F,null==f?void 0:f.className),color:"danger",iconType:"cross",onClick:t=>{t.preventDefault(),t.stopPropagation(),h(e)}}))):v&&Object(x.jsx)(b.EuiToolTip,{key:`deselected-to-add-${e.name}-${E}`,content:E},Object(x.jsx)(b.EuiButtonIcon,i()({"data-test-subj":`fieldToggle-${e.name}`,"aria-label":E},g||{},{className:O()(F,null==g?void 0:g.className),color:"text",iconType:"plusInCircle",onClick:t=>{t.preventDefault(),t.stopPropagation(),v(e)}}))),_="conflict"===e.type?Object(x.jsx)(Wg,{conflictDescriptions:e.conflictDescriptions}):null;return Object(x.jsx)(qg.a,i()({key:`field-item-button-${e.name}`,dataTestSubj:c||`field-${e.name}-showDetails`,size:d||"s",className:C,isActive:n,buttonProps:{"aria-label":u.i18n.translate("unifiedFieldList.fieldItemButton.ariaLabel",{defaultMessage:"Preview {fieldDisplayName}: {fieldType}",values:{fieldDisplayName:k,fieldType:o?o(e):e.type}})},fieldIcon:Object(x.jsx)(Ug.a,M),fieldName:Object(x.jsx)(b.EuiHighlight,{search:wg(k,t),title:T,"data-test-subj":`field-${e.name}`},k),fieldAction:P,fieldInfoIcon:_||l,onClick:p},y))}function Wg({conflictDescriptions:e}){const t=e?Object.keys(e):[];return Object(x.jsx)(b.EuiToolTip,{position:"bottom",title:u.i18n.translate("unifiedFieldList.fieldItemButton.mappingConflictTitle",{defaultMessage:"Mapping Conflict"}),content:t.length?u.i18n.translate("unifiedFieldList.fieldItemButton.mappingConflictWithTypesDescription",{defaultMessage:"This field is defined as several types ({types}) across the indices that match this pattern. You may still be able to use this conflicting field, but it will be unavailable for functions that require Kibana to know their type. Correcting this issue will require reindexing your data.",values:{types:t.join(", ")}}):u.i18n.translate("unifiedFieldList.fieldItemButton.mappingConflictDescription",{defaultMessage:"This field is defined as several types (string, integer, etc) across the indices that match this pattern.You may still be able to use this conflicting field, but it will be unavailable for functions that require Kibana to know their type. Correcting this issue will require reindexing your data."})},Object(x.jsx)(b.EuiIcon,{tabIndex:0,type:"warning",size:"s"}))}a(450);const Xg=({field:e,closePopover:t,buttonAddFieldToWorkspaceProps:a,buttonAddFilterProps:n,buttonEditFieldProps:s,buttonDeleteFieldProps:l,onAddFieldToWorkspace:r,onAddFilter:o,onEditField:c,onDeleteField:d})=>{var p,m,g,f;if(!e)return null;const v=u.i18n.translate("unifiedFieldList.fieldPopover.addFieldToWorkspaceLabel",{defaultMessage:'Add "{field}" field',values:{field:e.displayName}}),h=u.i18n.translate("unifiedFieldList.fieldPopover.addExistsFilterLabel",{defaultMessage:"Filter for field present"}),y=u.i18n.translate("unifiedFieldList.fieldPopover.editFieldLabel",{defaultMessage:"Edit data view field"}),j=u.i18n.translate("unifiedFieldList.fieldPopover.deleteFieldLabel",{defaultMessage:"Delete data view field"});return Object(x.jsx)(b.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:!0},Object(x.jsx)(b.EuiTitle,{size:"xxs"},Object(x.jsx)("h5",{className:"eui-textBreakWord"},e.displayName))),r&&Object(x.jsx)(b.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_addField"},Object(x.jsx)(b.EuiToolTip,{content:null!==(p=null==a?void 0:a["aria-label"])&&void 0!==p?p:v},Object(x.jsx)(b.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_addField-${e.name}`,"aria-label":v},a||{},{iconType:"plusInCircle",onClick:()=>{t(),r(e)}})))),o&&e.filterable&&!e.scripted&&Object(x.jsx)(b.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_addExistsFilter"},Object(x.jsx)(b.EuiToolTip,{content:null!==(m=null==n?void 0:n["aria-label"])&&void 0!==m?m:h},Object(x.jsx)(b.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_addExistsFilter-${e.name}`,"aria-label":h},n||{},{iconType:"filter",onClick:()=>{t(),o("_exists_",e.name,"+")}})))),c&&(e.isRuntimeField||!["unknown","unknown_selected"].includes(e.type))&&Object(x.jsx)(b.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_editField"},Object(x.jsx)(b.EuiToolTip,{content:null!==(g=null==s?void 0:s["aria-label"])&&void 0!==g?g:y},Object(x.jsx)(b.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_editField-${e.name}`,"aria-label":y},s||{},{iconType:"pencil",onClick:()=>{t(),c(e.name)}})))),d&&e.isRuntimeField&&Object(x.jsx)(b.EuiFlexItem,{grow:!1,"data-test-subj":"fieldPopoverHeader_deleteField"},Object(x.jsx)(b.EuiToolTip,{content:null!==(f=null==l?void 0:l["aria-label"])&&void 0!==f?f:j},Object(x.jsx)(b.EuiButtonIcon,i()({"data-test-subj":`fieldPopoverHeader_deleteField-${e.name}`,"aria-label":j},l||{},{color:"danger",iconType:"trash",onClick:()=>{t(),d(e.name)}})))))},Yg=()=>Object(x.jsx)(s.Fragment,null),Qg=l.a.lazy((()=>Promise.all([a.e(4),a.e(10)]).then(a.bind(null,561)))),Kg=e=>Object(x.jsx)(l.a.Suspense,{fallback:Object(x.jsx)(Yg,null)},Object(x.jsx)(Qg,e));var Zg=a(43);const Jg=({field:e,visualizeInfo:t,handleVisualizeLinkClick:a,buttonProps:n})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiButton,i()({fullWidth:!0,size:"s","data-test-subj":`fieldVisualize-${e.name}`},n||{},{href:t.href,onClick:a}),Object(x.jsx)(c.FormattedMessage,{id:"unifiedFieldList.fieldVisualizeButton.label",defaultMessage:"Visualize"}))),ef=(u.i18n.translate("uiActions.triggers.rowClickTitle",{defaultMessage:"Table row click"}),u.i18n.translate("uiActions.triggers.rowClickkDescription",{defaultMessage:"A click on a table row"}),"VISUALIZE_FIELD_TRIGGER"),tf={id:ef,title:"Visualize field",description:"Triggered when user wants to visualize a field."},af="VISUALIZE_GEO_FIELD_TRIGGER",nf={id:af,title:"Visualize Geo field",description:"Triggered when user wants to visualize a geo field."};function sf(e){return e===Rc.b.GEO_POINT||e===Rc.b.GEO_SHAPE?af:ef}async function lf(e,t,a,n=[],i){return await e.getTriggerCompatibleActions(i,{dataViewSpec:a.toSpec(!1),fieldName:t,contextualFields:n})}const rf=l.a.memo((({field:e,dataView:t,contextualFields:a,trackUiMetric:n,multiFields:i,originatingApp:s,uiActions:l,buttonProps:r,visualizeInfo:o})=>o?Object(x.jsx)(Jg,{field:e,visualizeInfo:o,handleVisualizeLinkClick:async e=>{var i;e.preventDefault(),i=t,null==n||n(Zg.METRIC_TYPE.CLICK,"visualize_link_click"),function(e,t,a=[],n,i){if(!i)return;const s=sf(t.type),l={dataViewSpec:i.toSpec(!1),fieldName:t.name,contextualFields:a,originatingApp:n};e.getTrigger(s).exec(l)}(l,o.field,a,s,i)},buttonProps:r}):null));const of=({fieldName:e,handleVisualizeLinkClick:t,buttonProps:a})=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiButton,i()({fullWidth:!0,size:"s","data-test-subj":`fieldCategorize-${e}`},a||{},{onClick:t,iconSide:"left",iconType:"machineLearningApp"}),Object(x.jsx)(c.FormattedMessage,{id:"unifiedFieldList.fieldCategorizeButton.label",defaultMessage:"Run pattern analysis"}))),uf="CATEGORIZE_FIELD_TRIGGER";u.i18n.translate("xpack.ml.actions.runPatternAnalysis.title",{defaultMessage:"Run pattern analysis"}),u.i18n.translate("xpack.ml.actions.runPatternAnalysis.description",{defaultMessage:"Triggered when user wants to run pattern analysis on a field."});const cf=l.a.memo((({field:e,dataView:t,trackUiMetric:a,originatingApp:n,uiActions:i,buttonProps:s,closePopover:l})=>Object(x.jsx)(of,{fieldName:e.name,handleVisualizeLinkClick:async s=>{var r;s.preventDefault(),r=t,null==a||a(Zg.METRIC_TYPE.CLICK,"categorize_link_click"),function(e,t,a,n){if(!n)return;const i={dataView:n,field:t,originatingApp:a};e.getTrigger(uf).exec(i)}(i,e,n,r),l&&l()},buttonProps:s})));var df=a(549);const pf=e=>{const[t,a]=Object(s.useState)(null),[n,l]=Object(s.useState)(null);return Object(s.useEffect)((()=>{(async function(e){const t=await async function(e,t,a,n=[],i=[]){var s;if("_id"!==t.name&&null!=a&&a.id)for(const o of[t,...i]){if(!o.visualizable)continue;const t=await lf(e,o.name,a,n,sf(o.type));if(t.length>0){var l,r;const e={dataViewSpec:null==a?void 0:a.toSpec(!1),fieldName:o.name,contextualFields:n,trigger:(s=o.type,s===Rc.b.GEO_POINT||s===Rc.b.GEO_SHAPE?nf:tf)};return{field:o,href:await(null===(l=(r=t[0]).getHref)||void 0===l?void 0:l.call(r,e))}}}}(e.uiActions,e.field,e.dataView,e.contextualFields,e.multiFields);return t?Object(x.jsx)(rf,i()({},e,{visualizeInfo:t})):null})(e).then(a).catch((e=>{console.error(e)})),async function(e){return await async function(e,t,a){var n;return!!("_id"!==t.name&&null!=a&&a.id&&a.isTimeBased()&&null!==(n=t.esTypes)&&void 0!==n&&n.includes("text"))&&(await async function(e,t,a,n){return await e.getTriggerCompatibleActions(n,{dataView:a,field:t})}(e,t,a,uf)).length>0}(e.uiActions,e.field,e.dataView)?Object(x.jsx)(cf,e):null}(e).then(l).catch((e=>{console.error(e)}))}),[e]),t||n?Object(x.jsx)(b.EuiPopoverFooter,null,t,t&&n?Object(x.jsx)(b.EuiSpacer,{size:"s"}):null,n):null},mf=e=>Object(x.jsx)(df.a,null,Object(x.jsx)(pf,e));var gf=a(99);function ff(e){if(1===e.length&&1===e[0].length)return e[0][0].query;const t=e.filter((e=>e.length)).map((e=>e.length>1?`( ${e.map((({query:e})=>`( ${e} )`)).join(" OR ")} )`:`( ${e[0].query} )`)).join(" AND ");return e.length>1?`( ${t} )`:t}const bf=(e,t,a)=>{const n=e.getSourceId();if(n)return t.reduce(((e,t)=>{var i;const s=null===(i=a[n])||void 0===i?void 0:i.getFieldByName(t);return"date"===(null==s?void 0:s.type)?[t,...e]:[...e,t]}),[])};function vf(e,t,a,n,i,s,l,r){var o,c;const d=Boolean((null===(o=r.navLinks)||void 0===o?void 0:o.discover)&&(null===(c=r.discover)||void 0===c?void 0:c.show));if(!(Object.values(i||{}).length&&e&&t&&a&&Object.keys(s).length))return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataNoData",{defaultMessage:"Visualization has no data available to show"}),isVisible:d};let p;try{const i=e.getLayers(t).filter((e=>function(e,t,a){return e.getLayerType(a,t)||z.LayerTypes.DATA}(a,n,e)===z.LayerTypes.DATA));if(i.length>1)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataMultipleLayers",{defaultMessage:"Cannot show underlying data for visualizations with multiple layers"}),isVisible:d};p=e.getPublicAPI({layerId:i[0],state:t,indexPatterns:s})}catch(e){return Object(gf.c)(e),{meta:void 0,error:e.message,isVisible:d}}const m=p.getTableSpec(),g=m.filter((({columnId:e})=>{var t;return!(null!==(t=p.getOperationForColumnId(e))&&void 0!==t&&t.hasTimeShift)}));if(g.length<m.length)return{meta:void 0,error:u.i18n.translate("xpack.lens.app.showUnderlyingDataTimeShifts",{defaultMessage:"Cannot show underlying data when there's a time shift configured"}),isVisible:d};const f=p.getFilters(i,l);if("error"in f)return{meta:void 0,error:f.error,isVisible:d};const b=[...new Set(g.map((({fields:e})=>e)).flat())],v=bf(p,b,s);return{meta:{id:p.getSourceId(),columns:null!=v?v:b,filters:f},error:void 0,isVisible:d}}function hf(e,t,a,n,i){var s,l;const r={kuery:[],lucene:[]},o=(Array.isArray(e)?e:e&&Object(El.isOfQueryType)(e)?[e]:[]).filter((e=>Boolean("string"==typeof e.query?e.query.trim():e.query)));[r.lucene,r.kuery]=Object(qt.partition)(o,(e=>"lucene"===e.language));const c=(null===(s=o[0])||void 0===s?void 0:s.language)||"kuery",d={language:c,query:ff([...r[c].map((e=>[e])),...a.filters.enabled[c]||[]])},p="lucene"===c?"kuery":"lucene",m=[...t],g=null==n?void 0:n.find((({id:e})=>e===a.id));if(Boolean((null===(l=a.filters.enabled[p])||void 0===l?void 0:l.length)||r[p].length)){const e=ff([...r[p].map((e=>[e])),...a.filters.enabled[p]||[]]);m.push(Object(El.buildCustomFilter)(a.id,Object(El.buildEsQuery)(g,{language:p,query:e},[],i),!1,!1,u.i18n.translate("xpack.lens.app.lensContext",{defaultMessage:"Lens context ({language})",values:{language:p}}),El.FilterStateStore.APP_STATE))}for(const e of["lucene","kuery"]){const[t]=a.filters.disabled[e]||[];for(const n of t||[]){let t=n.query;"lucene"===e&&(t+=` (${e})`),m.push(Object(El.buildCustomFilter)(a.id,Object(El.buildEsQuery)(g,n,[],i),!0,!1,t,El.FilterStateStore.APP_STATE))}}return{filters:m,query:d}}function xf(e){return!("type"in e)&&Boolean(null==e?void 0:e.meta.type)}function yf(e){var t,a;const{field:n,indexPattern:l,highlight:r,exists:o,hideDetails:c,itemIndex:p,groupIndex:m,dropOntoWorkspace:g,hasSuggestionForField:f,editField:b,removeField:v,getCustomFieldType:h}=e,y=Object(s.useMemo)((()=>{var e,t;return xf(n)?new Vg.DataViewField({name:n.name,type:null!==(e=null===(t=n.meta)||void 0===t?void 0:t.type)&&void 0!==e?e:"unknown",searchable:!0,aggregatable:!0}):new Vg.DataViewField(n)}),[n]),j=Object(d.useKibana)().services,O=null==j||null===(t=j.data)||void 0===t||null===(a=t.query)||void 0===a?void 0:a.filterManager,[I,k]=Object(s.useState)(!1),T=Object(s.useCallback)((()=>{k((e=>!e))}),[k]),M=Object(s.useCallback)((()=>{k(!1)}),[k]),w=Object(s.useMemo)((()=>O&&l?(e,t,a)=>{M();const n=Object(is.generateFilters)(O,e,t,a,l);O.addFilters(n)}:void 0),[l,O,M]),C=Object(s.useMemo)((()=>b&&y.name!==It.DOCUMENT_FIELD_NAME?e=>{M(),b(e)}:void 0),[b,M,y.name]),E=Object(s.useMemo)((()=>v?e=>{M(),v(e)}:void 0),[v,M]),S=null==l?void 0:l.id,F=Object(s.useMemo)((()=>xf(n)?{field:n.name,id:n.id,humanData:{label:n.name}}:{field:n,indexPatternId:S,id:n.name,humanData:{label:n.displayName,position:p+1}}),[n,S,p]),P=Object(s.useMemo)((()=>[0,m,p]),[m,p]),{buttonAddFieldToWorkspaceProps:_,onAddFieldToWorkspace:A}=function({value:e,hasSuggestionForField:t,dropOntoWorkspace:a,closeFieldPopover:n}){const i=t(e);return{buttonAddFieldToWorkspaceProps:{isDisabled:!i,"aria-label":i?u.i18n.translate("xpack.lens.indexPattern.moveToWorkspace",{defaultMessage:"Add {field} to workspace",values:{field:e.humanData.label}}):u.i18n.translate("xpack.lens.indexPattern.moveToWorkspaceNotAvailable",{defaultMessage:"To visualize this field, please add it directly to the desired layer. Adding this field to the workspace is not supported based on your current configuration."})},onAddFieldToWorkspace:()=>{null==n||n(),a(e)}}}({value:F,hasSuggestionForField:f,dropOntoWorkspace:g,closeFieldPopover:M}),L={isSelected:!1,isEmpty:!o,isActive:I,fieldSearchHighlight:r,onClick:T,buttonAddFieldToWorkspaceProps:_,onAddFieldToWorkspace:A};return Object(x.jsx)("li",null,Object(x.jsx)(Gg,{isOpen:I,closePopover:M,panelClassName:"lnsFieldItem__fieldPanel",initialFocus:".lnsFieldItem__fieldPanel",className:"lnsFieldItem__popoverAnchor","data-test-subj":"lnsFieldListPanelField",panelProps:{"data-test-subj":"lnsFieldListPanelFieldContent"},container:document.querySelector(".application")||void 0,button:Object(x.jsx)(wl.a,{draggable:!0,order:P,value:F,dataTestSubj:`lnsFieldListPanelField-${n.name}`,onDragStart:M},xf(n)?Object(x.jsx)($g,i()({field:n,getCustomFieldType:h},L)):Object(x.jsx)($g,i()({field:n},L))),renderHeader:()=>Object(x.jsx)(Xg,{field:y,closePopover:M,buttonAddFieldToWorkspaceProps:_,onAddFieldToWorkspace:A,onAddFilter:w,onEditField:C,onDeleteField:E}),renderContent:c?void 0:()=>Object(x.jsx)(Of,i()({},e,{dataViewField:y,onAddFilter:w}))}))}const jf=l.a.memo(yf);function Of(e){const{query:t,filters:a,indexPattern:n,dataViewField:i,dateRange:r,onAddFilter:o}=e,c=Object(d.useKibana)().services,p=Object(s.useMemo)((()=>{var e;if(!n)return null;const s={id:n.id,columns:[i.name],filters:{enabled:{lucene:[],kuery:[]},disabled:{lucene:[],kuery:[]}}},{filters:l,query:r}=hf(t,a,s,[n],Object(is.getEsQueryConfig)(c.uiSettings)),o=null===(e=c.share)||void 0===e?void 0:e.url.locators.get("DISCOVER_APP_LOCATOR");return o&&c.application.capabilities.discover.show?o.getRedirectUrl({dataViewSpec:null==n?void 0:n.spec,timeRange:c.data.query.timefilter.timefilter.getTime(),filters:l,query:r,columns:s.columns}):void 0}),[i.name,a,n,t,c]);return n?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Kg,{services:c,query:t,filters:a,fromDate:r.fromDate,toDate:r.toDate,dataViewOrDataViewId:n.id,onAddFilter:o,field:i,"data-test-subj":"lnsFieldListPanel",overrideMissingContent:e=>"no-data"===e.reason?Object(x.jsx)(b.EuiText,{size:"s","data-test-subj":"lnsFieldListPanel-missingFieldStats"},u.i18n.translate("xpack.lens.indexPattern.fieldStatsNoData",{defaultMessage:"Lens is unable to create visualizations with this field because it does not contain data. To create a visualization, drag and drop a different field."})):"unsupported"===e.reason?Object(x.jsx)(b.EuiText,{"data-test-subj":"lnsFieldListPanel-missingFieldStats"},e.element):e.element}),"geo_point"===i.type||"geo_shape"===i.type?Object(x.jsx)(mf,{field:i,dataView:{...n,toSpec:()=>n.spec},originatingApp:It.APP_ID,uiActions:c.uiActions,buttonProps:{"data-test-subj":`lensVisualize-GeoField-${i.name}`}}):p?Object(x.jsx)(b.EuiPopoverFooter,null,Object(x.jsx)(b.EuiButton,{fullWidth:!0,size:"s",href:p,target:"_blank","data-test-subj":`lnsFieldListPanel-exploreInDiscover-${i.name}`},u.i18n.translate("xpack.lens.indexPattern.fieldExploreInDiscover",{defaultMessage:"Explore in Discover"}))):null):null}const If=new Set(["string","number","boolean","date","ip","number_range","date_range","ip_range","histogram","document","geo_point","geo_shape","murmur3"]);function kf(e){return If.has(e.type)}function Tf({state:e,core:t,data:a,dataViews:n,fieldFormats:i,query:r,filters:o,dateRange:d,charts:p,indexPatternFieldEditor:m,showNoDataPopover:g,dropOntoWorkspace:f,hasSuggestionForField:v,uiActions:h,indexPatternService:y,frame:j,onIndexPatternRefresh:O,usedIndexPatterns:I,layerFields:k}){const{indexPatterns:T,indexPatternRefs:M}=j.dataViews,{currentIndexPatternId:w}=e,C=Object(s.useMemo)((()=>Object(qt.uniq)((null!=I?I:Object.values(e.layers).map((({indexPatternId:e})=>e))).concat(w)).filter((e=>!!T[e])).sort().map((e=>T[e]))),[I,T,e.layers,w]);return Object(x.jsx)(l.a.Fragment,null,0===Object.keys(T).length&&0===M.length?Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"m",className:"lnsInnerIndexPatternDataPanel",direction:"column",responsive:!1},Object(x.jsx)(b.EuiFlexItem,{grow:null},Object(x.jsx)(b.EuiCallOut,{"data-test-subj":"indexPattern-no-indexpatterns",title:u.i18n.translate("xpack.lens.indexPattern.noDataViewsLabel",{defaultMessage:"No data views"}),color:"warning",iconType:"warning"},Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.noDataViewDescription",defaultMessage:"Please create a data view or switch to another data source"}))))):Object(x.jsx)(wf,{currentIndexPatternId:w,query:r,dateRange:d,filters:o,core:t,data:a,dataViews:n,fieldFormats:i,charts:p,indexPatternFieldEditor:m,dropOntoWorkspace:f,hasSuggestionForField:v,uiActions:h,indexPatternService:y,onIndexPatternRefresh:O,frame:j,layerFields:k,showNoDataPopover:g,activeIndexPatterns:C}))}const Mf=function({currentIndexPatternId:e,query:t,dateRange:a,filters:n,core:l,data:r,dataViews:o,indexPatternFieldEditor:c,dropOntoWorkspace:d,hasSuggestionForField:p,uiActions:m,indexPatternService:g,frame:f,onIndexPatternRefresh:b,layerFields:v,showNoDataPopover:h,activeIndexPatterns:y}){const{indexPatterns:j}=f.dataViews,O=j[e],{refetchFieldsExistenceInfo:I,isProcessing:k}=Object(Gu.a)({dataViews:y,query:t,filters:n,fromDate:a.fromDate,toDate:a.toDate,services:{data:r,dataViews:o,core:l},onNoData:t=>{t===e&&h()}}),T=m.getTrigger(Ig.VISUALIZE_GEO_FIELD_TRIGGER),M=Object(s.useMemo)((()=>O?T?O.fields:O.fields.filter((({type:e})=>"geo_point"!==e&&"geo_shape"!==e)):[]),[O,T]),w=c.userPermissions.editIndexPattern()||!O.isPersisted,C=Object(s.useCallback)((e=>Boolean(null==v?void 0:v.includes(e.name))),[v]),E=Object(s.useCallback)((e=>{if(e===kg.b.AvailableFields)return{helpText:u.i18n.translate("xpack.lens.indexPattern.allFieldsLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, select a different data view, edit your queries, or use a different time range. Some field types cannot be visualized in Lens, including full text and geographic fields."})}}),[]),{fieldListFiltersProps:S,fieldListGroupedProps:F}=Eg({dataViewId:e,allFields:M,services:{dataViews:o,core:l},isAffectedByGlobalFilter:Boolean(n.length),onSupportedFieldFilter:kf,onSelectedFieldFilter:C,onOverrideFieldGroupDetails:E}),P=Object(s.useRef)();Object(s.useEffect)((()=>()=>{P.current&&P.current()}),[]);const _=Object(s.useCallback)((async()=>{if(O){const e=await g.loadIndexPatterns({patterns:[O.id],cache:{},onIndexPatternRefresh:b});g.updateDataViewsState({indexPatterns:{...f.dataViews.indexPatterns,[O.id]:e[O.id]}})}r.search.session.start()}),[g,O,b,f.dataViews.indexPatterns,r.search.session]),A=Object(s.useMemo)((()=>w?async(e,t="edit")=>{const a=await o.get(null==O?void 0:O.id);P.current=c.openEditor({ctx:{dataView:a},fieldName:e,onSave:()=>{a.isPersisted()?(_(),I(a.id)):g.replaceDataViewId(a)}})}:void 0),[w,o,null==O?void 0:O.id,c,_,g,I]),L=Object(s.useMemo)((()=>w?async e=>{const t=await o.get(null==O?void 0:O.id);P.current=c.openDeleteModal({ctx:{dataView:t},fieldName:e,onDelete:()=>{t.isPersisted()?(_(),I(t.id)):g.replaceDataViewId(t)}})}:void 0),[null==O?void 0:O.id,o,w,c,g,_,I]),D=Object(s.useCallback)((({field:e,itemIndex:i,groupIndex:s,groupName:l,hideDetails:r,fieldSearchHighlight:o})=>Object(x.jsx)(jf,{field:e,exists:l!==kg.b.EmptyFields,hideDetails:r||"document"===e.type,itemIndex:i,groupIndex:s,dropOntoWorkspace:d,hasSuggestionForField:p,editField:A,removeField:L,indexPattern:O,highlight:o,dateRange:a,query:t,filters:n})),[O,a,t,n,d,p,A,L]);return Object(x.jsx)(Ag,{className:"lnsInnerIndexPatternDataPanel",isProcessing:k,prepend:Object(x.jsx)(Rg,i()({},S,{"data-test-subj":"lnsIndexPattern"}))},Object(x.jsx)(zg,i()({},F,{renderFieldItem:D,"data-test-subj":"lnsIndexPattern",localStorageKeyPrefix:"lens"})))},wf=Object(s.memo)(Mf);function Cf({state:e,updatedLayer:t,layerId:a,label:n,changeType:i}){const s=t?{...e,layers:{...e.layers,[a]:t}}:e,l=Object(qt.mapValues)(s.layers,(e=>({...e,columns:Object(qt.pick)(e.columns,e.columnOrder)}))),r=l[a].columnOrder,o=l[a].columns,u=Object.values(o).some((e=>e.isBucketed));return{state:{...s,layers:l},table:{columns:r.filter((e=>!Cu(l[a],e))).map((e=>({columnId:e,operation:ib(o[e])}))),isMultiRow:u,layerId:a,changeType:i,label:n},keptLayerIds:Object.keys(e.layers)}}function Ef(e,t,a){return function(e,t,a){const n=[];return t.forEach((t=>{const i=a[t.indexPatternId];if(!i)return[];const s=function(e,t){const a=function(e,t){return e.reduce(((a,n)=>{if(!e.some((e=>Sf(e)&&n.columnId===e.references[0]))){const s=Af(n,t);if(Sf(n)){const a=e.find((e=>e.columnId===n.references[0]));s.references=[Af(a,t)]}if(function(e){return"terms"===e.operationType}(n)&&n.params.orderAgg&&s.columnParams&&!e.some((e=>{var t;return e.columnId===(null===(t=n.params.orderAgg)||void 0===t?void 0:t.columnId)}))){var i;const e=n.params.orderAgg,a=Tp[e.operationType],l={indexPatternId:t.id,columns:{},columnOrder:[]};s.columnParams.orderAgg=a.buildColumn({previousColumn:{...n.params.orderAgg,label:(null===(i=n.params.orderAgg)||void 0===i?void 0:i.label)||""},indexPattern:t,layer:l,referenceIds:[],field:_f(n.params.orderAgg,t)},n.params)}a.push(s)}return a}),[])}(t.columns,e);let n={ignoreGlobalFilters:t.ignoreGlobalFilters,indexPatternId:e.id,columns:{},columnOrder:[]};a.forEach((a=>{if("formula"===a.op){var i;const s=Tp.formula,l=t.columns.find((e=>e.columnId===a.columnId)),r=s.buildColumn({previousColumn:{...l,label:(null==l?void 0:l.label)||(null===(i=a.columnParams)||void 0===i?void 0:i.formula)||""},indexPattern:e,layer:n},a.columnParams);n=Fo(a.columnId,r,n,{indexPattern:e}).layer}else n=cu({...a,layer:n,respectOrder:!0})}));let i=n;return t.columns.forEach((({columnId:e,label:t})=>{t&&(i=function({layer:e,columnId:t,customLabel:a}){const n=e.columns[t];return{...e,columns:{...e.columns,[t]:{...n,label:void 0!==a?a:n.label,customLabel:Boolean(a)}}}}({layer:i,columnId:e,customLabel:Cu(i,e)?"":t}))})),i}(i,t),l=Cf({state:e,updatedLayer:s,layerId:t.layerId,changeType:"initial"});n.push(l)})),n}(e,t,a)}function Sf(e){return"references"in e&&e.references.length>0}function Ff(e){return{...e.params}}function Pf(e){return{filter:e.filter,timeShift:e.timeShift,timeScale:e.timeScale,dataType:e.dataType,...e.reducedTimeRange&&{reducedTimeRange:e.reducedTimeRange}}}function _f(e,t){const a=function(e,t){return function(e){return"sourceField"in e}(e)?"document"===e.sourceField?Co.a:t.getFieldByName(e.sourceField):void 0}(e,t);return a&&e.label?{...a,customLabel:e.label}:a}function Af(e,t){return{op:e.operationType,columnId:e.columnId,field:_f(e,t),indexPattern:t,visualizationGroups:[],incompleteParams:Pf(e),initialParams:{params:Ff(e)},columnParams:Ff(e)}}function Lf(e,t,a,n){const i=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t)),s=n[t],l=null==s?void 0:s.getFieldByName(a);if(0!==i.length||!l)return[];const r=Object(nt.a)();return Rf(e,r,t,l,n).concat(Rf({...e,layers:{}},r,t,l,n))}function Df(e){if("number"!==e.type)return Pp(e).find((e=>"date_histogram"===e||"terms"===e))}function Rf(e,t,a,n,i){const s=i[a];let l;const r=Df(n);var o,u;r?l=function(e,t,a){return cu({op:a,layer:cu({op:"count",layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(nt.a)(),field:Co.a,indexPattern:e,visualizationGroups:[]}),columnId:Object(nt.a)(),field:t,indexPattern:e,visualizationGroups:[]})}(s,n,r):s.timeFieldName&&Pp(n).length>0&&(l=function(e,t){const a=e.getFieldByName(e.timeFieldName),[n]=xu(t);if(n)return cu({op:"date_histogram",layer:cu({op:n.type,layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(nt.a)(),field:t,indexPattern:e,visualizationGroups:[]}),columnId:Object(nt.a)(),field:a,indexPattern:e,visualizationGroups:[]})}(s,n)),l&&(l.sampling=null!==(o=null===(u=e.layers[t])||void 0===u?void 0:u.sampling)&&void 0!==o?o:1);const c=l?[Cf({state:e,updatedLayer:l,layerId:t,changeType:"initial"})]:[],d=Nf(s,t,e,n);return d?c.concat(d):c}function Bf(e,t,a=(()=>!0)){const n=Object.entries(e.layers||{}).filter((([e])=>a(e)));return n.length>1?n.map((([a,i],s)=>{const l=n.some((([e,t])=>e!==a&&t.indexPatternId===i.indexPatternId))?u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerPositionLabel",{defaultMessage:"Show only layer {layerNumber}",values:{layerNumber:s+1}}):u.i18n.translate("xpack.lens.indexPatternSuggestion.removeLayerLabel",{defaultMessage:"Show only {indexPatternTitle}",values:{indexPatternTitle:t[i.indexPatternId].title}});return Cf({state:{...e,layers:{[a]:i}},layerId:a,changeType:"layers",label:l})})).concat([Cf({state:e,layerId:n[0][0],changeType:"unchanged"})]):Object(qt.flatten)(n.filter((([e,t])=>t.columnOrder.length&&t.indexPatternId)).map((([a,n])=>{const i=t[n.indexPatternId],[s,l,r]=Tu(n),o=n.columnOrder.find((e=>n.columns[e].isBucketed&&"date"===n.columns[e].dataType)),u=(null==i?void 0:i.timeFieldName)&&i.getFieldByName(i.timeFieldName),c=1===s.length&&s.some((e=>"number"===n.columns[e].dataType)),d=[];return d.push(Cf({state:e,layerId:a,changeType:"unchanged"})),!r.length&&l.length&&0===s.length?(u&&s.length<1&&!Pu(n)&&d.push(Vf(e,a,u,t)),i&&d.push(...function(e,t,a){const n=a.layers[t],i=[];return n.columnOrder.filter((e=>!Cu(n,e))).forEach((s=>{const l=n.columns[s];if(!Ro(l))return;const r=e.getFieldByName(l.sourceField);if(!r)return;const o=xu(r).filter((({type:e})=>e!==l.operationType));if(o.length){const l=pu({layer:n,indexPattern:e,field:r,columnId:s,op:o[0].type,visualizationGroups:[]});l&&i.push(Cf({state:a,layerId:t,updatedLayer:l,changeType:"initial"}))}})),i}(i,a,e))):(d.push(...function(e,t){const a=e.layers[t],[n,i]=Object(qt.partition)(a.columnOrder,(e=>a.columns[e].isBucketed)),s=i.filter((e=>!Cu(a,e)));return Object(qt.flatten)(n.map(((e,t)=>{const l=n.slice(0,t+1),r={...a,columnOrder:[...l,...i],noBuckets:!1};return l.length>0&&s.length>1?[{...a,columnOrder:[...l,s[0],...Fu(a,s[0])],noBuckets:!1}]:n.length>1?r:[]}))).concat(n.length>0||s.length>1?s.map((e=>({...a,columnOrder:[e,...Fu(a,e)],noBuckets:!0}))):[]).map((({noBuckets:a,...n})=>Cf({state:e,layerId:t,updatedLayer:n,changeType:"reduced",label:a?Gf(n,1===i.length):void 0})))}(e,a)),!o&&u&&s.length<2&&!c&&!Pu(n)&&d.push(Vf(e,a,u,t)),2===s.length&&d.push(function(e,t,a){var n,i;const s=e.layers[t],[l,r,...o]=s.columnOrder,u={...s,columnOrder:[r,l,...o]},c=a[e.currentIndexPatternId],d=s.columns[l],p=Ro(d)&&(null===(n=c.getFieldByName(d.sourceField))||void 0===n?void 0:n.displayName)||"",m=s.columns[r];return Cf({state:e,layerId:t,updatedLayer:u,label:zf([Ro(m)&&(null===(i=c.getFieldByName(m.sourceField))||void 0===i?void 0:i.displayName)||"",p]),changeType:"reorder"})}(e,a,t))),d})))}function Nf(e,t,a,n){const[i]=xu(n);if(i)return Cf({layerId:t,state:a,changeType:"initial",updatedLayer:cu({layer:{indexPatternId:e.id,columns:{},columnOrder:[]},columnId:Object(nt.a)(),op:i.type,field:"count"===i.type?Co.a:n,indexPattern:e,visualizationGroups:[]})})}function zf([e,t]){return u.i18n.translate("xpack.lens.indexpattern.suggestions.nestingChangeLabel",{defaultMessage:"{innerOperation} for each {outerOperation}",values:{innerOperation:t,outerOperation:e}})}function Vf(e,t,a,n){const i=e.layers[t];return Cf({state:e,layerId:t,updatedLayer:cu({layer:i,indexPattern:n[i.indexPatternId],field:a,op:"date_histogram",columnId:Object(nt.a)(),visualizationGroups:[]}),label:u.i18n.translate("xpack.lens.indexpattern.suggestions.overTimeLabel",{defaultMessage:"Over time"}),changeType:"extended"})}function Gf(e,t){const{operationType:a,label:n}=e.columns[e.columnOrder[0]];return u.i18n.translate("xpack.lens.indexpattern.suggestions.overallLabel",{defaultMessage:"{operation} overall",values:{operation:t?Tp[a].displayName:n},description:"Title of a suggested chart containing only a single numerical metric calculated over all available data"})}function qf({title:e,titleId:t,...a}){return Object(x.jsx)("svg",i()({width:"15",height:"16",viewBox:"0 0 15 16",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":t},a),e?Object(x.jsx)("title",{id:t},e):null,Object(x.jsx)("path",{d:"M1 0C0.447715 0 0 0.447715 0 1V14C0 14.5523 0.447715 15 1 15H7.67099C7.54918 14.9013 7.43133 14.7953 7.31802 14.682C7.10539 14.4693 6.91848 14.2407 6.75731 14H1V1H8V4.5C8 4.77614 8.22386 5 8.5 5H12V7.25625C12.3483 7.3791 12.6846 7.54612 13 7.75731V4C13 3.73478 12.8946 3.48043 12.7071 3.29289L9.70711 0.292893C9.51957 0.105357 9.26522 0 9 0H1Z"}),Object(x.jsx)("path",{d:"M10.5 13C11.3284 13 12 12.3284 12 11.5C12 10.6716 11.3284 10 10.5 10C9.67157 10 9 10.6716 9 11.5C9 12.3284 9.67157 13 10.5 13Z"}),Object(x.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.1465 15.8536L12.5962 14.3033C11.9771 14.7674 11.2393 14.9997 10.5013 15H10.4987C9.61445 14.9997 8.7303 14.6663 8.05051 14L8.02517 13.9749C6.65833 12.608 6.65833 10.392 8.02517 9.02513C9.392 7.65829 11.6081 7.65829 12.9749 9.02513C14.2217 10.2719 14.3312 12.2253 13.3034 13.5963L14.8536 15.1464C15.0489 15.3417 15.0489 15.6583 14.8536 15.8535C14.6584 16.0488 14.3418 16.0488 14.1465 15.8536ZM12.2678 13.9749L12.5962 14.3033C11.9805 14.7648 11.2474 14.997 10.5135 14.9998C10.7834 14.9927 11.0001 14.7716 11.0001 14.5C11.0001 14.2239 10.7762 14 10.5001 14C9.85948 14 9.22053 13.756 8.73227 13.2678C7.75596 12.2915 7.75596 10.7085 8.73227 9.73223C9.70858 8.75592 11.2915 8.75592 12.2678 9.73223C13.2441 10.7085 13.2441 12.2915 12.2678 13.2678C12.174 13.3615 12.1214 13.4887 12.1214 13.6213C12.1214 13.7539 12.174 13.8811 12.2678 13.9749Z"}),Object(x.jsx)("path",{d:"M3 2.5C3 2.77614 2.77614 3 2.5 3C2.22386 3 2 2.77614 2 2.5C2 2.22386 2.22386 2 2.5 2C2.77614 2 3 2.22386 3 2.5Z"}),Object(x.jsx)("path",{d:"M2.5 5C2.77614 5 3 4.77614 3 4.5C3 4.22386 2.77614 4 2.5 4C2.22386 4 2 4.22386 2 4.5C2 4.77614 2.22386 5 2.5 5Z"}),Object(x.jsx)("path",{d:"M3 6.5C3 6.77614 2.77614 7 2.5 7C2.22386 7 2 6.77614 2 6.5C2 6.22386 2.22386 6 2.5 6C2.77614 6 3 6.22386 3 6.5Z"}),Object(x.jsx)("path",{d:"M2.5 9C2.77614 9 3 8.77614 3 8.5C3 8.22386 2.77614 8 2.5 8C2.22386 8 2 8.22386 2 8.5C2 8.77614 2.22386 9 2.5 9Z"}),Object(x.jsx)("path",{d:"M3 10.5C3 10.7761 2.77614 11 2.5 11C2.22386 11 2 10.7761 2 10.5C2 10.2239 2.22386 10 2.5 10C2.77614 10 3 10.2239 3 10.5Z"}),Object(x.jsx)("path",{d:"M3 12.5C3 12.7761 2.77614 13 2.5 13C2.22386 13 2 12.7761 2 12.5C2 12.2239 2.22386 12 2.5 12C2.77614 12 3 12.2239 3 12.5Z"}),Object(x.jsx)("path",{d:"M4.5 9C4.77614 9 5 8.77614 5 8.5C5 8.22386 4.77614 8 4.5 8C4.22386 8 4 8.22386 4 8.5C4 8.77614 4.22386 9 4.5 9Z"}),Object(x.jsx)("path",{d:"M5 6.5C5 6.77614 4.77614 7 4.5 7C4.22386 7 4 6.77614 4 6.5C4 6.22386 4.22386 6 4.5 6C4.77614 6 5 6.22386 5 6.5Z"}),Object(x.jsx)("path",{d:"M4.5 5C4.77614 5 5 4.77614 5 4.5C5 4.22386 4.77614 4 4.5 4C4.22386 4 4 4.22386 4 4.5C4 4.77614 4.22386 5 4.5 5Z"}),Object(x.jsx)("path",{d:"M5 2.5C5 2.77614 4.77614 3 4.5 3C4.22386 3 4 2.77614 4 2.5C4 2.22386 4.22386 2 4.5 2C4.77614 2 5 2.22386 5 2.5Z"}),Object(x.jsx)("path",{d:"M6.5 5C6.77614 5 7 4.77614 7 4.5C7 4.22386 6.77614 4 6.5 4C6.22386 4 6 4.22386 6 4.5C6 4.77614 6.22386 5 6.5 5Z"}),Object(x.jsx)("path",{d:"M7 2.5C7 2.77614 6.77614 3 6.5 3C6.22386 3 6 2.77614 6 2.5C6 2.22386 6.22386 2 6.5 2C6.77614 2 7 2.22386 7 2.5Z"}),Object(x.jsx)("path",{d:"M6.5 7C6.77614 7 7 6.77614 7 6.5C7 6.22386 6.77614 6 6.5 6C6.22386 6 6 6.22386 6 6.5C6 6.77614 6.22386 7 6.5 7Z"}),Object(x.jsx)("path",{d:"M9 6.5C9 6.77614 8.77614 7 8.5 7C8.22386 7 8 6.77614 8 6.5C8 6.22386 8.22386 6 8.5 6C8.77614 6 9 6.22386 9 6.5Z"}),Object(x.jsx)("path",{d:"M10.5 7C10.7761 7 11 6.77614 11 6.5C11 6.22386 10.7761 6 10.5 6C10.2239 6 10 6.22386 10 6.5C10 6.77614 10.2239 7 10.5 7Z"}),Object(x.jsx)("path",{d:"M7 8.5C7 8.77614 6.77614 9 6.5 9C6.22386 9 6 8.77614 6 8.5C6 8.22386 6.22386 8 6.5 8C6.77614 8 7 8.22386 7 8.5Z"}),Object(x.jsx)("path",{d:"M4.5 11C4.77614 11 5 10.7761 5 10.5C5 10.2239 4.77614 10 4.5 10C4.22386 10 4 10.2239 4 10.5C4 10.7761 4.22386 11 4.5 11Z"}),Object(x.jsx)("path",{d:"M5 12.5C5 12.7761 4.77614 13 4.5 13C4.22386 13 4 12.7761 4 12.5C4 12.2239 4.22386 12 4.5 12C4.77614 12 5 12.2239 5 12.5Z"}))}const Hf=({children:e,condition:t,tooltipContent:a,...n})=>Object(x.jsx)(l.a.Fragment,null,t?Object(x.jsx)(b.EuiToolTip,i()({content:a,delay:"long"},n),Object(x.jsx)(l.a.Fragment,null,e)):e);function Uf({values:e,currentValue:t,disabled:a=!1,disabledReason:n="",onChange:i,"data-test-subj":s}){const{euiTheme:l}=Object(b.useEuiTheme)(),r=e.findIndex((e=>e===t)),o=r>-1?r:e.length-1;return Object(x.jsx)(Hf,{tooltipContent:n,condition:a,delay:"regular",display:"block"},Object(x.jsx)(b.EuiFlexGroup,{gutterSize:"none"},Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiText,{color:a?l.colors.disabledText:l.colors.subduedText,size:"xs"},Object(x.jsx)(c.FormattedMessage,{id:"randomSampling.ui.sliderControl.performanceLabel",defaultMessage:"Performance"}))),Object(x.jsx)(b.EuiFlexItem,null,Object(x.jsx)(b.EuiRange,{"data-test-subj":s,value:o,disabled:a,fullWidth:!0,onChange:t=>{i(e[Number(t.currentTarget.value)])},showInput:!1,showRange:!1,showTicks:!0,step:1,min:0,max:e.length-1,ticks:e.map(((e,t)=>({label:(100*e+"%").slice(Number.isInteger(100*e)?0:1),value:t})))})),Object(x.jsx)(b.EuiFlexItem,{grow:!1},Object(x.jsx)(b.EuiText,{color:a?l.colors.disabledText:l.colors.subduedText,size:"xs"},Object(x.jsx)(c.FormattedMessage,{id:"randomSampling.ui.sliderControl.accuracyLabel",defaultMessage:"Accuracy"})))))}var $f=a(142);function Wf({state:e,layerId:t,onChangeIndexPattern:a,dataViews:n}){const i=e.layers[t],{euiTheme:s}=Object(b.useEuiTheme)(),l=n.indexPatterns[i.indexPatternId],r=u.i18n.translate("xpack.lens.layerPanel.missingDataView",{defaultMessage:"Data view not found"}),o=n.indexPatternRefs.map((e=>{var t,a;const i=null===(t=null===(a=n.indexPatterns[e.id])||void 0===a?void 0:a.isPersisted)||void 0===t||t;return{...e,isAdhoc:!i}})),c=rm(i),d=[];return i.ignoreGlobalFilters&&d.push(zi({color:s.colors.disabledText,dataTestSubj:"lnsChangeIndexPatternIgnoringFilters"})),1!==c&&d.push({component:Object(x.jsx)(qf,{color:s.colors.disabledText,fill:"currentColor"}),value:100*c+"%",tooltipValue:u.i18n.translate("xpack.lens.indexPattern.randomSamplingInfo",{defaultMessage:"{value}% sampling",values:{value:100*c}}),"data-test-subj":"lnsChangeIndexPatternSamplingInfo"}),Object(x.jsx)($f.a,{"data-test-subj":"indexPattern-switcher",trigger:{label:(null==l?void 0:l.name)||r,title:(null==l?void 0:l.title)||r,"data-test-subj":"lns_layerIndexPatternLabel",size:"s",fontWeight:"normal",extraIcons:d},indexPatternId:i.indexPatternId,indexPatternRefs:o,isMissingCurrent:!l,onChangeIndexPattern:a})}const Xf=({title:e,titleId:t,...a})=>Object(x.jsx)("svg",{width:"176",height:"176",viewBox:"0 0 176 176",xmlns:"http://www.w3.org/2000/svg"},Object(x.jsx)("path",{d:"M88 152c35.346 0 64-28.654 64-64 0-13.35-4.087-25.745-11.079-36.002L51.998 140.92C62.255 147.913 74.65 152 88 152zm-58.277-.083l-5.64-5.64 15.93-15.929C30.047 119.064 24 104.238 24 88c0-35.346 28.654-64 64-64 16.238 0 31.064 6.047 42.348 16.013l15.929-15.93 5.64 5.64L29.723 151.917z",fill:"#F9B110"}),Object(x.jsx)("path",{d:"M87.992 151.961h-2.248a76.025 76.025 0 01-.679-.027v-36.978h-7.102l5.87-5.869h1.232v-1.233L90.92 102v7.087h28.52a121.923 121.923 0 001.806-21.048 122.722 122.722 0 00-.951-15.414l10.102-10.102H146.7a67.977 67.977 0 012.211 5.869h-23.228a132.499 132.499 0 011.432 19.647 132.001 132.001 0 01-1.65 21.048h22.963a64.832 64.832 0 01-2.366 5.838h-21.687c-2.957 13.793-8.126 25.36-14.758 33.315a63.132 63.132 0 01-4.943 1.567 63.66 63.66 0 01-7.399 1.526c9.248-5.54 16.955-19.087 20.982-36.377H90.919v36.979c-.22.01-.442.018-.663.026h-2.264zm35.642-93.956l-10.387 10.387 10.387-10.386zM90.919 90.721l-5.854 5.853 5.854-5.854zm0-11.28l-5.854 5.854V68.392h-28.77a122.988 122.988 0 00.25 40.695h4.728l-8.941 8.941a111.251 111.251 0 01-.707-3.072H29.94l-.22-.509c-.755-1.75-1.523-3.529-2.162-5.36H50.52a132.014 132.014 0 01-1.65-21.017 134.648 134.648 0 011.432-19.647H27.09a67.9 67.9 0 012.21-5.869h21.967c2.88-14.4 8.173-26.497 15.039-34.732a64.165 64.165 0 0112.454-3.114c-9.527 5.683-17.42 19.834-21.344 37.815h27.68V24.117c.966-.078 1.93-.078 2.912-.078.492 0 .98.02 1.467.039.483.02.963.039 1.444.039v38.375h16.949l-5.9 5.9h-11.05v11.049zm25.363-25.363l4.804-4.804c-2.947-8.592-6.862-15.903-11.486-21.483a64.417 64.417 0 00-12.454-3.114c7.985 4.762 14.822 15.473 19.136 29.401zM54.881 126.76l4.74-4.74-4.74 4.74zm11.802-11.803l5.87-5.869-5.87 5.869zm-4.036 15.316l-4.551 4.551c2.385 5.173 5.168 9.702 8.271 13.429a63.532 63.532 0 0012.27 3.068c-6.257-3.801-11.806-11.256-15.99-21.048z",fill:"#FEC514"}),Object(x.jsx)("path",{d:"M115.909 138.807c.444-.825.878-1.669 1.299-2.534a1.56 1.56 0 011.223.823c.156.498-.732 1.868-1.401 2.055a1.381 1.381 0 01-1.121-.344zm-5.488-2.505c-.226.416-.455.826-.687 1.23a5.47 5.47 0 01-1.048.171 1.03 1.03 0 01-.826-.342 1.284 1.284 0 010-1.043c.172-.249.701-.514.919-.421.439.311.975.454 1.51.405h.132zm3.41-7.241l-.084.207c-.191.429-.39.896-.578 1.352a.959.959 0 01-.293-.295.958.958 0 01-.143-.39.764.764 0 01.623-.872c.156-.038.319-.039.475-.002zm-28.766 20.867v2.004c-.352-.013-.705-.044-1.057-.074-.464-.04-.928-.08-1.392-.081l-.02-.002c.377-.244.81-.388 1.259-.419a1.83 1.83 0 01.902.125.99.99 0 01-.124-.296 1.715 1.715 0 01.432-1.257zm0-4.223v3.069a1.278 1.278 0 01-.12-.578v-.654a2.033 2.033 0 01-2.149.28 8.458 8.458 0 01-1.697-1.463 1.323 1.323 0 01.39-2.179 2.57 2.57 0 01-1.075-.779 2.03 2.03 0 01-.234.67c-.128.235-.31.437-.529.591-.273.225-.6.376-.95.436.078.027.15.064.219.109a1.402 1.402 0 01.155 1.884 1.438 1.438 0 01-.94.79 1.424 1.424 0 01-1.208-.23 1.415 1.415 0 01-.639-1.79 2.202 2.202 0 011.557-.825l-.249-.109a2.45 2.45 0 01-1.183-1.464c-.327-.327-.576-.685-.483-.856.183-.217.42-.383.685-.482.67-1.075 1.293-1.23 2.647-.576.431.189.79.511 1.028.918a2.477 2.477 0 011.043-1.728 14.152 14.152 0 011.946-.483c-.032-.669.373-1.058 1.198-1.058h.094a.682.682 0 01.494-.11v1.56a.449.449 0 01-.541-.002c-.348.373-.329.766-.307 1.21.005.112.011.227.011.346a2.085 2.085 0 01-1.043 2.024c.717.367 1.355.87 1.88 1.479zm0-3.296v.909a1.091 1.091 0 01-.136-.259.718.718 0 01.136-.65zm0-7.629v2.477a1.282 1.282 0 01-.875.557 1.276 1.276 0 01-1.005-.282 1.247 1.247 0 01-.545-1.759 2.208 2.208 0 012.289-.856l.136-.137zM65.94 147.731c.142.176.284.349.427.521a67.88 67.88 0 01-.447-.163v-.22c0-.037.011-.096.02-.138zm-5.292-7.889c.449.801.908 1.582 1.378 2.341a1.427 1.427 0 01-.325-.105 1.154 1.154 0 01-.81-.42.86.86 0 010-.296 1.87 1.87 0 01-.243-1.52zm-1.22-2.279c.247.485.5.963.755 1.435a.851.851 0 01-.413.569.85.85 0 01-.746.051 5.625 5.625 0 00-.7-.171 2.195 2.195 0 01-1.309 2.335 2.055 2.055 0 01-2.382-1.074v-.234a1.551 1.551 0 01-.778-.155 1.871 1.871 0 01-.716 1.323 62.51 62.51 0 01-1.112-.75l4.416-4.417a1.727 1.727 0 011.18.294 1.786 1.786 0 001.804.794zm-1.184-2.421c.125.269.251.535.379.8a1.056 1.056 0 01-.379-.8zm-13.376-9.65l-.904.904a.94.94 0 01.255-.54.76.76 0 01.65-.364zm2.423-2.423l-.1.099a.38.38 0 00-.077-.099h.177zm-16.669-8.113h4.681a.946.946 0 01-.005.127c-.23.447-.597.517-.97.588a5.091 5.091 0 00-.244.05l-.436.109h.109a2.026 2.026 0 011.557 1.464h.187a1.076 1.076 0 011.276.794 1.119 1.119 0 01-.685 1.354.981.981 0 01-1.152-.56 2.466 2.466 0 01-1.946.934 1.738 1.738 0 01-.723-.324 62.044 62.044 0 01-.78-1.42 3.119 3.119 0 01.009-.701 1.56 1.56 0 01.56-1.152 1.992 1.992 0 01-1.438-1.263zm48.905 35.918c.048.187.048.383.001.57a15.906 15.906 0 01-.217-.029l-.656-.105c-.292-.175-.584-.377-.876-.578l-.107-.074-.185-.127c.129-.249.323-.459.56-.607a1.017 1.017 0 010-.763 1.424 1.424 0 011.044-.716 1.082 1.082 0 011.122.95 1.09 1.09 0 01-.064.529 1.23 1.23 0 01-.653.561c.031.127.042.258.03.389zm-17.312-4.437c.01.053.014.108.012.162a63.978 63.978 0 01-6.015-3.039c.159-.192.366-.339.601-.423a3.55 3.55 0 011.059-.576c.421-.141.763.021 1.118.188.275.13.557.263.89.263a2.281 2.281 0 011.76.841c.309.4.468.895.45 1.401a4.07 4.07 0 010 .747c.055.141.097.287.125.436zm29.171 5.475a64.518 64.518 0 003.223-.249 1.388 1.388 0 00-1.133-.618 5.86 5.86 0 00-1.277.016c.228-.447.294-.959.187-1.448a1.852 1.852 0 00-1.463-1.355v3.659c.154 0 .309-.002.463-.005zm25.699-6.887c.331-.17.661-.342.989-.517l.139-.079c.074-.174.121-.358.14-.545a1.67 1.67 0 00-.576-1.479 4.637 4.637 0 01-.44-.319h-.001c-.337-.265-.656-.516-1.007-.428a1.035 1.035 0 00-.747.544c-.041.066-.09.127-.141.19-.143.177-.299.369-.31.713a2.223 2.223 0 00.747 1.806c.229.17.496.282.778.327l.228-.113.201-.1zm-72.85-92.93a1.65 1.65 0 00-1.558-2.896 1.697 1.697 0 00-.654 2.304 1.76 1.76 0 002.211.592zM38.77 55.8a2.07 2.07 0 00.98-2.522 1.977 1.977 0 00-2.428-1.12 2.008 2.008 0 00-1.417 2.303 2.6 2.6 0 002.865 1.34zm4.24-2.034c.115-.084.245-.144.383-.176a1.557 1.557 0 011.915.716 1.23 1.23 0 01-.7 1.556 1.774 1.774 0 01-1.993-.965 1.06 1.06 0 01.395-1.13zm-5.813 4.39a1.09 1.09 0 01.747-.13c.883.073.878.723.873 1.377v.149c1.82.14 2.226.42 2.226 1.323a2.322 2.322 0 01-1.106 1.635h-1.292a2.429 2.429 0 01-.7-2.008 13.872 13.872 0 00-.46-.39c-.275-.23-.539-.449-.77-.7a.825.825 0 010-.67 1.09 1.09 0 01.482-.586zm-6.4 13.32a.903.903 0 01.31-.311.951.951 0 011.292.685.638.638 0 010 .265c.087-.11.186-.21.296-.296a.606.606 0 01.856.171c.438.015.864.15 1.23.39a1.246 1.246 0 01.374 1.556 1.853 1.853 0 01-1.868.654 1.853 1.853 0 01-.748-1.37 1.168 1.168 0 01-.498-.607.778.778 0 01-.84.109 1.12 1.12 0 01-.53-.825.904.904 0 01.127-.42zm9.3 11.502c.233 0 .529-.265.575-.498.047-.234-.155-.608-.435-.623a.544.544 0 00-.577.39.81.81 0 00.436.73zm-.05 14.544c.186-.389.824-.436 1.65-.124a.795.795 0 01.576 1.105c-.28.483-1.168.919-1.557.732a1.774 1.774 0 01-.67-1.713zm2.163 8.672c.42-.281.903.015 1.043.529.11.374.14.732-.327.919a1.057 1.057 0 01-1.166-.312 1.073 1.073 0 01-.204-.373 3.21 3.21 0 01.654-.763zm31.225 18.686a1.095 1.095 0 01-.494.073.751.751 0 01-.434-.522.765.765 0 01.154-.661c.218-.187.888-.576 1.183-.358.296.218.156.965 0 1.183a1.093 1.093 0 01-.409.285zm.705 8.106a1.695 1.695 0 00-.514-2.024.948.948 0 00-1.338.343 1.462 1.462 0 00.218 1.915 1.18 1.18 0 001.634-.234zm.39-1.93a1.425 1.425 0 001.147.149 1.417 1.417 0 00.876-.756 1.714 1.714 0 00-.296-2.18 2.056 2.056 0 00-2.241.638 1.419 1.419 0 00.513 2.149zm-34.748-25.407c-.094.031-.327.062-.42-.125a.31.31 0 01.077-.42c.09-.045.164.015.245.082a.93.93 0 00.098.074c.124.077.093.358 0 .389zm.794-3.425c-.748-.561-1.261-.436-1.869.42-.607.856-.529 1.557 0 1.868a2.453 2.453 0 002.335-.342 1.387 1.387 0 00-.466-1.946zm26.805 26.793a2 2 0 01-.028 1.229c-.312.561-1.417.576-2.382-.062a1.353 1.353 0 01-.28-1.557 1.871 1.871 0 011.992-.623c.334.256.578.61.698 1.013zm4.33-2.196a1.56 1.56 0 00-.856-.171c.14-.257.183-.555.125-.841a1.886 1.886 0 00-2.024-1.183c-.592.14-1.043 1.214-.856 2.024a1.381 1.381 0 001.074 1.074 1.56 1.56 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.165 1.165 0 00-.186-1.728zm2.602 8.123c-.066.169-.134.346-.235.346-.203.031-.732.031-.794-.233-.062-.265.327-.592.451-.592.234.059.456.159.654.296-.026.052-.05.117-.076.183zM37.789 94.876c.156-.607.498-1.121 1.23-.934.733.198.657.846.58 1.502l-.004.039c-.27.135-.572.19-.872.156.031.31-.047 1.074-.374 1.183-.326.109-.871-.436-.965-.685a1.058 1.058 0 01.218-.934.56.56 0 01.327-.125c-.054-.062-.1-.13-.14-.202zm.47-5.461a.902.902 0 00.171 1.354 1.106 1.106 0 001.557-.124 1.043 1.043 0 00-.327-1.464.935.935 0 00-1.4.234zm45.032 41.572a.693.693 0 01.252-.258.628.628 0 01.607.264c.041.124-.026.281-.108.472a3.526 3.526 0 00-.125.322c-.106-.06-.219-.111-.322-.158-.216-.097-.394-.177-.394-.293a.698.698 0 01.09-.349zm.377-5.24a.704.704 0 00-.847-.192.704.704 0 00-.243.192c-.327.405-.311 1.199.125 1.339.435.14 1.23.327 1.556-.14.29-.414-.204-.853-.493-1.11l-.064-.058a.704.704 0 01-.034-.031zm9.512 1.51c.607-.202 1.666.218 1.448 1.074a2.55 2.55 0 01-3.083 1.51 2.92 2.92 0 01-.623-.467v-2.802a1.265 1.265 0 011.34.311c.148.115.234.214.3.29.15.17.198.224.618.084zm.218 5.075c-.218-.887-1.168-1.556-1.853-1.385a1.735 1.735 0 00-.623.389v2.273c.423.231.911.313 1.386.233a1.266 1.266 0 001.084-.992c.037-.17.04-.346.006-.518zm-1.775 2.6c.483.125.607.67.327 1.137-.265.404-.514.591-.965.404v-1.541c.21-.039.427-.039.638 0zm-11.645.841a1.559 1.559 0 001.915 0c-.202-1.043-.53-1.557-1.074-1.401-.545.155-.903.716-.84 1.401zm-2.989-2.491a2.33 2.33 0 01.343-1.09 2.006 2.006 0 012.475-.607 1.434 1.434 0 011.417-.95 1.798 1.798 0 011.385 1.37 1.417 1.417 0 01-1.09 1.542.947.947 0 01-.716-.281 2.64 2.64 0 01-.358.857 1.82 1.82 0 01-1.759 1.043v.109a2.008 2.008 0 010 2.101.378.378 0 01.171.094 1.066 1.066 0 01.49.713 1.072 1.072 0 01-.194.844 1.137 1.137 0 01-1.463.404.963.963 0 01-.374-1.214 2.446 2.446 0 01-2.008-.716.844.844 0 01-.078-.125.606.606 0 01-.498.234 1.058 1.058 0 01-.794-.529c-.078-.234.156-1.059.342-1.137.187-.078.514.125.763.358a2.649 2.649 0 01.996-1.557 1.552 1.552 0 011.215-.373 1.822 1.822 0 01-.267-1.047c-.028.248-.425.595-.605.595a.727.727 0 01-.623-.358c-.046-.202.25-.56.42-.607.172-.047.81.078.81.327zm3.503-15.615a.343.343 0 00-.14-.404c-.094 0-.327 0-.374.14a.652.652 0 00-.008.29c.004.033.008.061.008.083a.311.311 0 00.514-.109zm2.11 5.675a1.57 1.57 0 01-1.176-.241c-.716-.374-1.12-1.37-.763-1.9a2.105 2.105 0 012.522-.7 1.569 1.569 0 01-.582 2.841zm22.332 14.688a.82.82 0 00.593-.312.816.816 0 00.154-.653c0-.887-.405-1.432-.825-1.432a1.787 1.787 0 00-1.246 1.354c0 .467.794 1.043 1.324 1.043zm2.257-5.262c.234.919-.124 1.868-.763 2.009-.467.14-1.416-.592-1.557-1.153-.14-.56.483-1.307 1.246-1.463a.786.786 0 01.682.048.788.788 0 01.392.559zm.576-5.635c.134-.208-.076-.645-.263-1.034a9.273 9.273 0 01-.142-.305c0-.082-.128-.124-.295-.178a2.951 2.951 0 01-.281-.102c-.063.15-.176.308-.292.47-.256.357-.524.733-.299 1.086a.963.963 0 001.572.063zm-6.679.965c.032.218.016.809-.249.809-.264.047-.576-.358-.576-.482a2.01 2.01 0 01.312-.639c.062.037.137.059.21.081.145.044.283.086.303.231zm-4.763 11.489c.035.209.109.41.218.592a.947.947 0 00-.53.264c-.22.272-.325.618-.296.965.11.623.576.794 1.744.717a5.12 5.12 0 00.327-.888c.332.146.7.195 1.059.14a2.426 2.426 0 001.556-2.537 1.552 1.552 0 00-.513-.81 2.41 2.41 0 00.186-1.261 1.372 1.372 0 001.697.81 1.717 1.717 0 001.436-1.507 1.713 1.713 0 00-.081-.735 1.807 1.807 0 00-1.993-1.401c-.809.14-1.37 1.292-1.214 2.366a1.401 1.401 0 00-.607-.778 2.99 2.99 0 00-3.114.731 1.964 1.964 0 00.311 2.242 1.838 1.838 0 00-.186 1.09zm-.623-6.414c-.203.389-.452.607-.903.389a1.06 1.06 0 01-.579-1.111c.023-.148.077-.289.159-.414.33-.049.665-.049.996 0a.708.708 0 01.463.481.718.718 0 01-.136.655zm2.942.483a2.199 2.199 0 001.339-2.367 1.602 1.602 0 00-2.962-.028 1.605 1.605 0 00-.011 1.227c.249.872 1.027 1.37 1.634 1.168zm1.03-7.534a.744.744 0 01-.267.263c-.202.047-.545-.264-.592-.436-.046-.171.094-.809.343-.809.249 0 .623.436.623.623a.745.745 0 01-.106.359zm-21.61 14.197c0 .638 1.245 1.245 1.68.918.437-.327 0-1.759-.606-1.806a1.077 1.077 0 00-1.075.888zm-41.707-35.246c-.153.45-.455.835-.856 1.09a.983.983 0 01-.841-.234 1.794 1.794 0 01-1.464-.202 1.557 1.557 0 01-.186-1.822c.12-.376.162-.774.124-1.167a2.348 2.348 0 010-.327h-.109a2.043 2.043 0 01-.87-2.218c.07-.275.197-.533.372-.756.178-.24.421-.424.7-.53a1.338 1.338 0 011.168-1.867c.191-.029.385-.029.576 0 .507.177.722.483.928.777.281.401.546.78 1.516.78a.935.935 0 01.53.731c.342-.373 1.152-.638 1.556 0a2.553 2.553 0 01-.996 3.269 2.575 2.575 0 01-1.806 0 1.787 1.787 0 01-1.448 0l-.186-.155a.67.67 0 010 .171c.082.157.154.318.218.483a1.169 1.169 0 011.058.591c.163.447.169.936.016 1.386zm-2.74 2.382a1.748 1.748 0 00-1.977.06 1.742 1.742 0 00-.468.516 1.401 1.401 0 00-.155 1.043h3.69c.046-.623-.359-.981-1.09-1.619zm5.65-.218c.179.195.307.43.374.685.08.379.122.765.125 1.152h-2.942a1.448 1.448 0 01-.312-.981 1.556 1.556 0 01.748-1.105.952.952 0 01.825-.934 1.01 1.01 0 011.183.731c.03.149.03.303 0 .452zm29.206 25.749a2.209 2.209 0 002.413 1.277 1.595 1.595 0 10-1.198-2.958c.123-.109.224-.241.296-.389a.873.873 0 00-.405-1.277 1.152 1.152 0 00-1.463.405 1.12 1.12 0 00.466 1.432.93.93 0 00.576 0 1.323 1.323 0 00-.685 1.51zm7.771 8.671c-.383.198-.808.418-1.014.296a.976.976 0 01-.382-.806.978.978 0 01.429-.782c.323-.229.687.016 1.043.254.175.118.349.235.513.291-.043.098-.075.2-.104.291-.053.169-.095.301-.176.301-.096.044-.2.098-.308.154v.001zm29.141-.887c-.171-.405.218-.903 1.012-1.308a.793.793 0 011.168.39 1.56 1.56 0 01-.452 1.556 1.769 1.769 0 01-1.728-.638zm-22.48 7.146c-.98-.592-1.868-.576-2.258 0a1.932 1.932 0 00.436 2.039 1.988 1.988 0 002.087-.763.877.877 0 00.147-.696.885.885 0 00-.412-.58zm-12.75-7.566c.133.054.266.095.382.13.184.056.327.099.365.166.017.03-.025.139-.086.302-.163.429-.465 1.227-.194 1.893a2.384 2.384 0 003.118.885c.354-.181.658-.448.883-.776a1.963 1.963 0 00-.172-2.164c-.286-.286-.75-.45-1.13-.584-.323-.113-.586-.206-.629-.335-.031-.094.045-.269.143-.494.192-.444.468-1.081.169-1.67a1.555 1.555 0 00-1.247-.869c.15.013.302.012.453-.003a1 1 0 00.812-.909.996.996 0 00-.065-.429 1.37 1.37 0 00-1.557-1.028 1.356 1.356 0 00-.98 1.557 1.229 1.229 0 001.151.841c-.27.001-.539.048-.793.14a2.951 2.951 0 00-1.308 2.444.959.959 0 00-.779-.218c-.38.15-.698.424-.903.778a24.62 24.62 0 001.09 1.557c.237.037.479.037.716 0a.824.824 0 00.592-1.09.125.125 0 01-.031-.124zm-2.058-3.606a1.82 1.82 0 01-1.056.757 2.143 2.143 0 01-.591.062 65.347 65.347 0 01-3.379-6.772 1.744 1.744 0 011.557 1.355c.1.446.1.908 0 1.354a2.224 2.224 0 012.74-.498 2.1 2.1 0 01.872 2.133.73.73 0 01.14.342 1.82 1.82 0 01-.283 1.267zm25.659 7.513a1.135 1.135 0 00-.436-.918 1.292 1.292 0 001.276-1.199c0-.682-.381-1.081-.606-1.316-.11-.114-.182-.19-.156-.241l.014-.027c.113-.222.594-1.159-.014-1.529a1.558 1.558 0 00-1.043-.25 1.716 1.716 0 00-.857-1.307 1.273 1.273 0 00-.871-.249v3.923c.196.214.216.417.236.627.032.322.065.661.744 1.085.194.117.404.206.623.265-.278.067-.518.24-.67.483a1.098 1.098 0 00-.215.823 1.098 1.098 0 00.433.733h.187c-.16.307-.204.66-.124.997a.58.58 0 00.14.218 1.32 1.32 0 00-.576 1.432 1.108 1.108 0 001.36.57c.17-.059.323-.158.446-.29a1.463 1.463 0 00.233-1.23h.203a1.37 1.37 0 001.183-1.479 1.82 1.82 0 00-1.51-1.121zm-21.375 1.744a2.711 2.711 0 011.557-1.339 1.571 1.571 0 011.219.229 1.564 1.564 0 01.665 1.048 1.929 1.929 0 01-.654 2.039 1.284 1.284 0 01-.094.327c-.047.066-.1.129-.156.187a34.636 34.636 0 01-2.537-2.491zm39.807-.887a.573.573 0 000 .7.79.79 0 00.825.156c.218-.125.141-.561 0-.763a.608.608 0 00-.825-.093zm14.121-10.309a.99.99 0 01.404.516c.203.545-.373 1.293-1.261 1.744a4.745 4.745 0 01-.08.425c-.046.213-.091.421-.091.618-.552.444-1.17.398-1.759.353-.175-.013-.347-.026-.514-.026a.717.717 0 01-.389-1.261 20.077 20.077 0 011.697-1.152c.202-1.043.467-1.37 1.354-1.37a.994.994 0 01.639.153zm-5.558-1.57s-.327.389-.28.514c.046.125.389.576.653.529.265-.046.312-.622.249-.716a1.055 1.055 0 00-.622-.327zm-25.084 18.02c0-.097.029-.191.082-.272.186-.312.731-.14.794-.031a.873.873 0 01.217.451l-1.011.125a.5.5 0 01-.081-.273zm28.244-19.374c.374-.498-.592-1.557-1.277-1.557-.685 0-1.276.887-1.058 1.386.218.498 1.977.669 2.335.171zm-14.163.217c.122-.254.339-.449.603-.544a1.556 1.556 0 011.604.856c.124.389-.483 1.246-.981 1.37a1.202 1.202 0 01-1.277-.872 1.074 1.074 0 01.051-.81zm-10.434 12.159a1.806 1.806 0 00-2.367.639 2.116 2.116 0 00-.296 1.074 1.674 1.674 0 00-1.005.805 1.664 1.664 0 00-.131 1.281 2.102 2.102 0 002.366 1.557 2.225 2.225 0 001.557-1.9 1.29 1.29 0 00.358-.358 2.46 2.46 0 00-.483-3.098zm-1.448 6.663c-.25-.28-.405-.622-.25-.825a2.573 2.573 0 011.806-.28c-.499.396-1.018.765-1.556 1.105zm2.475-8.936a.964.964 0 00-.607.432.946.946 0 00-.11.736.899.899 0 00.738.792.905.905 0 00.384-.014 1.087 1.087 0 00.903-1.229 1.035 1.035 0 00-.504-.633 1.058 1.058 0 00-.804-.084zm1.885 4.474c.233-.382.582-.678.995-.846a2.119 2.119 0 011.588-1.65c.19-.04.386-.04.576 0a36.783 36.783 0 01-3.456 3.767c-.039-.445.065-.89.297-1.271zm1.275-6.669c-.404-.529-.84-1.043-1.556-.591-.717.451-.468 1.012-.125 1.557a1.204 1.204 0 001.681-.966zm-1.276 3.441c-.031-.218.233-.95.623-.856a.882.882 0 01.591.762.842.842 0 01-.576.592.789.789 0 01-.638-.498zM48.469 56.236c.124.078.093.39 0 .39a.358.358 0 01-.514-.11.311.311 0 01.171-.42c.093-.047.17.011.254.076.028.022.057.045.089.064zm-5.154 5.511c-.34.133-.617.389-.778.716h3.27a2.382 2.382 0 00-2.492-.716zm5.574.467c-.42.125-.7-.311-.7-.467a.794.794 0 01.342-.607c.062-.062.467.031.514.233.006.028.015.06.026.098.067.237.181.635-.182.743zm-14.89 57.962c.329-.39.793-.641 1.299-.703a1.933 1.933 0 011.557 1.915 3.114 3.114 0 01-.965 1.728c.28.244.494.554.622.903.12.557.03 1.138-.249 1.635a60.352 60.352 0 01-2.74-4.079 2.025 2.025 0 01.476-1.399zm-6.5-19.898c-.016-.218.015-.81.295-.81.327-.062.607.405.607.561a.748.748 0 01-.436.56c-.202.062-.451-.093-.466-.311zM39.5 126.759a1.12 1.12 0 00.56 2.148 1.337 1.337 0 00.701-1.556 1.045 1.045 0 00-1.261-.592zm-9.496-65.806c.294.122.576.274.84.452a1.417 1.417 0 01.608 1.105h-2.117l.15-.354c.168-.401.339-.807.519-1.203zm1.728-1.277c.623.265 1.059-.077 1.37-.7l-.066-.126c-.24-.465-.49-.947-1.133-.761a1.169 1.169 0 00-.576.84.872.872 0 00.405.747zm8.593 62.907a1.703 1.703 0 01-.218-.592 1.838 1.838 0 01.187-1.09 1.963 1.963 0 01-.311-2.242 2.995 2.995 0 013.114-.731c.29.177.505.454.607.778-.156-1.074.404-2.226 1.214-2.366a1.804 1.804 0 011.993 1.401 1.71 1.71 0 01-.666 1.971 1.718 1.718 0 01-.689.271 1.372 1.372 0 01-1.697-.81c.052.43-.012.865-.186 1.261.252.209.431.493.513.81a2.428 2.428 0 01-1.556 2.537 1.913 1.913 0 01-1.06-.14 5.15 5.15 0 01-.326.888c-1.168.077-1.635-.094-1.744-.717-.03-.347.077-.693.296-.965a.947.947 0 01.53-.264zM32.784 83.58a1.698 1.698 0 00-.514-2.024.951.951 0 00-1.339.343 1.464 1.464 0 00.218 1.914 1.183 1.183 0 001.635-.233zm.947-1.733a1.418 1.418 0 01-.558-.198 1.416 1.416 0 01-.514-2.148 2.055 2.055 0 012.242-.638 1.712 1.712 0 01.296 2.18 1.418 1.418 0 01-1.466.804zm-3.376-4.432a1.556 1.556 0 00-.856-.171c.139-.257.183-.555.125-.841A1.884 1.884 0 0027.6 75.22c-.592.14-1.043 1.214-.856 2.024a1.386 1.386 0 001.074 1.074 1.556 1.556 0 00.856 1.557c.654.389 1.355.109 1.868-.732a1.168 1.168 0 00-.187-1.728zm.537 10.57c.022-.385.14-.76.343-1.09a2.008 2.008 0 012.475-.606 1.432 1.432 0 011.417-.95 1.79 1.79 0 011.385 1.37 1.416 1.416 0 01-1.09 1.541.949.949 0 01-.716-.28 2.644 2.644 0 01-.358.856 1.821 1.821 0 01-1.759 1.043v.11a2.008 2.008 0 010 2.101.373.373 0 01.171.093 1.072 1.072 0 01.296 1.557 1.137 1.137 0 01-1.463.405.965.965 0 01-.374-1.214 2.444 2.444 0 01-2.008-.717.871.871 0 01-.078-.124.607.607 0 01-.498.234 1.06 1.06 0 01-.794-.53c-.078-.233.156-1.058.342-1.136.187-.078.514.124.763.358a2.646 2.646 0 01.997-1.557 1.554 1.554 0 011.214-.374 1.82 1.82 0 01-.266-1.046c-.03.248-.426.595-.606.595a.732.732 0 01-.623-.358c-.046-.203.25-.56.42-.607.172-.047.81.078.81.327zm9.178-14.29a1.57 1.57 0 001.759-2.6 2.102 2.102 0 00-2.522.7c-.358.53.047 1.526.763 1.9z",fill:"#EA9600"}));a(455);const Yf={id:"lnsGeoFieldWorkspace",humanData:{label:u.i18n.translate("xpack.lens.geoFieldWorkspace.dropZoneLabel",{defaultMessage:"drop zone to open in maps"})}},Qf=[1,0,0,0];function Kf(e){return Object(x.jsx)("div",{className:"lnsWorkspacePanelWrapper__pageContentBody"},Object(x.jsx)(b.EuiText,{className:"lnsWorkspacePanel__emptyContent",textAlign:"center",size:"s"},Object(x.jsx)("div",null,Object(x.jsx)("h2",null,Object(x.jsx)("strong",null,Object(st.getVisualizeGeoFieldMessage)(e.fieldType))),Object(x.jsx)(Xf,{"aria-hidden":!0,className:"lnsWorkspacePanel__promptIllustration"}),Object(x.jsx)(wl.a,{className:"lnsVisualizeGeoFieldWorkspacePanel__dragDrop",dataTestSubj:"lnsGeoFieldWorkspace",draggable:!1,dropTypes:["field_add"],order:Qf,value:Yf,onDrop:function(){e.uiActions.getTrigger(Ig.VISUALIZE_GEO_FIELD_TRIGGER).exec({dataViewSpec:e.indexPattern.spec,fieldName:e.fieldName,originatingApp:It.APP_ID})}},Object(x.jsx)("p",null,Object(x.jsx)("strong",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.geoFieldWorkspace.dropMessage",defaultMessage:"Drop field here to open in Maps"})))))))}const Zf=[1e-5,1e-4,.001,.01,.1,1];var Jf={name:"1989ovb",styles:"vertical-align:middle"};function eb({state:e,setState:t,layerId:a}){const n=!lm(e.layers[a]),i=n?Zf[Zf.length-1]:e.layers[a].sampling;return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{display:"rowCompressed","data-test-subj":"lns-indexPattern-random-sampling-row",fullWidth:!0,helpText:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiSpacer,{size:"s"}),Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.randomSampling.help",defaultMessage:"Lower sampling percentages increases the performance, but lowers the accuracy. Lower sampling percentages are best for large datasets. {link}",values:{link:Object(x.jsx)(b.EuiLink,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/master/search-aggregations-random-sampler-aggregation.html",target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.randomSampling.learnMore",defaultMessage:"View documentation"}))}}))),label:Object(x.jsx)(l.a.Fragment,null,u.i18n.translate("xpack.lens.indexPattern.randomSampling.label",{defaultMessage:"Sampling"})," ",Object(x.jsx)(b.EuiToolTip,{content:u.i18n.translate("xpack.lens.indexPattern.randomSampling.experimentalLabel",{defaultMessage:"Technical preview"})},Object(x.jsx)(b.EuiBetaBadge,{css:Jf,iconType:"beaker",label:u.i18n.translate("xpack.lens.indexPattern.randomSampling.experimentalLabel",{defaultMessage:"Technical preview"}),size:"s"})))},Object(x.jsx)(Uf,{disabled:n,disabledReason:u.i18n.translate("xpack.lens.indexPattern.randomSampling.disabledMessage",{defaultMessage:"In order to select a reduced sampling percentage, you must remove any maximum or minimum functions applied on this layer."}),values:Zf,currentValue:i,"data-test-subj":"lns-indexPattern-random-sampling-slider",onChange:n=>{n<1&&Object(p.d)("apply_random_sampling"),t({...e,layers:{...e.layers,[a]:{...e.layers[a],sampling:n}}})}})),Object(x.jsx)(xs,{checked:!e.layers[a].ignoreGlobalFilters,onChange:()=>{const n={...e.layers[a],ignoreGlobalFilters:!e.layers[a].ignoreGlobalFilters},i={...e.layers};i[a]=n,Object(p.d)(n.ignoreGlobalFilters?"ignore_global_filters":"use_global_filters"),t({...e,layers:i})}}))}const tb=ar()((e=>e.flatMap((e=>{var t,a,n;return null!==(t=Tp[e.operationType])&&void 0!==t&&t.getCurrentFields?(null===(a=Tp[e.operationType])||void 0===a||null===(n=a.getCurrentFields)||void 0===n?void 0:n.call(a,e))||[]:"sourceField"in e?e.sourceField:void 0})).filter(st.nonNullable)),qt.isEqual);function ab(e,t){if("string"===e.dataType){var a;const n="sourceField"in e?null==t||null===(a=t.getFieldByName(e.sourceField))||void 0===a?void 0:a.esTypes:void 0;return(null==n?void 0:n[0])||void 0}if(Ho("last_value",e))return e.dataType}const nb=({prevState:e,layerId:t,columnId:a,indexPatterns:n})=>{var i;const s=null==n?void 0:n[null===(i=e.layers[t])||void 0===i?void 0:i.indexPatternId];if(!s)throw new Error("indexPatterns is not passed to the function");return am({state:e,layerId:t,newLayer:Iu({layer:e.layers[t],columnId:a,indexPattern:s})})};function ib(e,t,a){const{dataType:n,label:i,isBucketed:s,scale:l,operationType:r,timeShift:o,reducedTimeRange:u}=e;return{dataType:(c=n,"histogram"===c||"document"===c?"number":c),isBucketed:s,scale:l,label:t||i,isStaticValue:"static_value"===r,sortingHint:ab(e,a),hasTimeShift:Boolean(o),hasReducedTimeRange:Boolean(u),interval:Ho("date_histogram",e)?e.params.interval:void 0};var c}function sb({core:e,storage:t,data:a,unifiedSearch:n,share:s,dataViews:r,fieldFormats:o,charts:d,dataViewFieldEditor:p,uiActions:m}){const{uiSettings:g}=e,f="formBased",v=["indexpattern"],h={id:f,alias:v,initialize:(e,a,n,i,s)=>function({persistedState:e,references:t,defaultIndexPatternId:a,storage:n,initialContext:i,indexPatternRefs:s=[],indexPatterns:l={}}){const r=function({persistedState:e,references:t}){return e&&t?Np(e,t):void 0}({persistedState:e,references:t}),{usedPatterns:o,allIndexPatternIds:u}=function({state:e,indexPatternRefs:t,storage:a,initialContext:n,defaultIndexPatternId:i}){var s;const l=Dp(a,t)||i||(null===(s=t[0])||void 0===s?void 0:s.id),r=[];return n&&("isVisualizeAction"in n?r.push(...n.indexPatternIds):r.push(n.dataViewSpec.id)),{usedPatterns:(n?r:Object(qt.uniq)(e?Object.values(e.layers).map((e=>e.indexPatternId)):[l])).filter(Boolean),allIndexPatternIds:r}}({state:r,defaultIndexPatternId:a,storage:n,initialContext:i,indexPatternRefs:s}),c=new Set(s.map((({id:e})=>e))),d=Object(qt.difference)([...c],o),p=[...u,...o,...d].find((e=>null!=e&&c.has(e)&&l[e]));return p&&Rp(n,p),{layers:{},...r,currentIndexPatternId:p}}({persistedState:e,references:a,defaultIndexPatternId:g.get("defaultIndex"),storage:t,initialContext:n,indexPatternRefs:i,indexPatterns:s}),getPersistableState:e=>function({layers:e}){const t=[],a={layers:{}};return Object.entries(e).forEach((([e,{indexPatternId:n,...i}])=>{a.layers[e]=i,t.push({type:"index-pattern",id:n,name:Bp(e)})})),{savedObjectReferences:t,state:a}}(e),insertLayer:(e,t,a)=>({...e,layers:{...e.layers,[t]:lb(e.currentIndexPatternId,a)}}),createEmptyLayer:e=>({currentIndexPatternId:e,layers:{}}),cloneLayer:(e,t,a,n)=>({...e,layers:hm(e.layers,t,a,n)}),removeLayer(e,t){const a={...e.layers};delete a[t];const n=[t];return Object.keys(a).forEach((e=>{var i;const s=null===(i=a[e])||void 0===i?void 0:i.linkToLayers;s&&s.includes(t)&&(delete a[e],n.push(e))})),{removedLayerIds:n,newState:{...e,layers:a}}},clearLayer(e,t){var a;const n={...e.layers},i=[];return Object.keys(n).forEach((e=>{var a;const s=null===(a=n[e])||void 0===a?void 0:a.linkToLayers;s&&s.includes(t)&&(delete n[e],i.push(e))})),{removedLayerIds:i,newState:{...e,layers:{...n,[t]:lb(e.currentIndexPatternId,null===(a=e.layers[t])||void 0===a?void 0:a.linkToLayers)}}}},getLayers:e=>Object.keys(null==e?void 0:e.layers),removeColumn:nb,initializeDimension(e,t,a,{columnId:n,groupId:i,staticValue:s,autoTimeField:l,visualizationGroups:r}){var o;const u=a[null===(o=e.layers[t])||void 0===o?void 0:o.indexPatternId];let c=e;return null!=s&&(c=am({state:e,layerId:t,newLayer:cu({layer:e.layers[t],op:"static_value",columnId:n,field:void 0,indexPattern:u,visualizationGroups:r,initialParams:{params:{value:s}},targetGroup:i})})),l&&u.timeFieldName&&(c=am({state:e,layerId:t,newLayer:cu({layer:e.layers[t],op:"date_histogram",columnId:n,field:u.fields.find((e=>e.name===u.timeFieldName)),indexPattern:u,visualizationGroups:r,targetGroup:i})})),c},syncColumns({state:e,links:t,indexPatterns:a,getDimensionGroups:n}){let i=e.layers;t.forEach((e=>{var t,s;const l={...e.from,dataView:a[null===(t=i[e.from.layerId])||void 0===t?void 0:t.indexPatternId],filterOperations:()=>!0},r={...e.to,dataView:a[null===(s=i[e.to.layerId])||void 0===s?void 0:s.indexPatternId],filterOperations:()=>!0};i=su({layers:i,target:r,source:l});const o=vu(n(r.layerId),ku(i[r.layerId]),r.groupId,r.columnId);i={...i,[r.layerId]:{...i[r.layerId],columnOrder:o,columns:i[r.layerId].columns}}}));const s=nm({state:e,newLayers:i});return t.filter((e=>Ho("terms",s.layers[e.from.layerId].columns[e.from.columnId]))).forEach((({from:e,to:a})=>{const n=s.layers[e.layerId].columns[e.columnId];if("column"===n.params.orderBy.type){const e=n.params.orderBy.columnId,i=t.find((({from:{columnId:t}})=>t===e));i&&(s.layers[a.layerId].columns[a.columnId].params.orderBy={type:"column",columnId:i.to.columnId})}})),s},getSelectedFields(e){var t;return tb(null===(t=Object.values(null==e?void 0:e.layers))||void 0===t?void 0:t.flatMap((e=>Object.values(e.columns))))},toExpression:(e,t,a,n,i,s)=>function(e,t,a,n,i,s,l){return e.layers[t]?function(e,t,a,n,i,s){const{columnOrder:l}=e;if(0===l.length||!t)return null;const r={...e.columns};jm(l.map((e=>[e,r[e]]))).forEach((e=>{const t=r[e],a=Tp[t.operationType];if("references"in t&&a.filterable&&t.filter){function n(e){"references"in e&&e.references.forEach((e=>{let a=r[e];const i=a.filter;Tp[t.operationType].filterable&&!i&&(a={...a,filter:t.filter},r[e]=a),i||n(a)}))}n(t)}if("references"in t&&a.shiftable&&t.timeShift){function i(e){"references"in e&&e.references.forEach((e=>{let a=r[e];const n=a.timeShift;Tp[t.operationType].shiftable&&!n&&(a={...a,timeShift:t.timeShift},r[e]=a),n||i(a)}))}i(t)}}));const o=l.map((e=>[e,r[e]])),[u,c]=Object(qt.partition)(o,(([,e])=>{var t,a;return"fullReference"===(null===(t=Tp[e.operationType])||void 0===t?void 0:t.input)||"managedReference"===(null===(a=Tp[e.operationType])||void 0===a?void 0:a.input)})),d=o.find((([,e])=>"date_histogram"===e.operationType)),p=Boolean(d);if(u.length||c.length){let l=[];const m=[],g=a.get(is.UI_SETTINGS.HISTOGRAM_BAR_TARGET);jm(u).forEach((a=>{const s=r[a],l=Tp[s.operationType];"fullReference"!==l.input&&"managedReference"!==l.input||m.push(...l.toExpression(e,a,t,{dateRange:n,now:i,targetBars:g}))}));const f=c.map((([e])=>e));let b={};const v=new Map;c.forEach((([i,s],r)=>{const o=Tp[s.operationType];if("fullReference"!==o.input&&"managedReference"!==o.input){var u;const c=String(r),d=Boolean(o.filterable&&(null===(u=s.filter)||void 0===u?void 0:u.query)),m=o.canReduceTimeRange&&!p&&s.reducedTimeRange&&t.timeFieldName;let h=o.toEsAggsFn({...s,timeShift:no(s.timeShift,n,g,p)},d||m?`${c}-metric`:c,t,e,a,f,Tp);(d||m)&&(h=Object(yt.buildExpressionFunction)("aggFilteredMetric",{id:String(r),enabled:!0,schema:"metric",customBucket:Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("aggFilter",{id:`${r}-filter`,enabled:!0,schema:"bucket",filter:s.filter&&Object(ca.queryToAst)(s.filter),timeWindow:m?s.reducedTimeRange:void 0,timeShift:no(s.timeShift,n,g,p)})]),customMetric:Object(yt.buildExpression)({type:"expression",chain:[h]}),timeShift:no(s.timeShift,n,g,p)}).toAst());const x=Object(yt.buildExpression)({type:"expression",chain:[h]});l.push(x);const y=window.ELASTIC_LENS_DELAY_SECONDS?`col-${r+(s.isBucketed?0:1)}-${c}`:`col-${r}-${c}`;b[y]=[{...s,id:i,label:s.customLabel?s.label:Tp[s.operationType].getDefaultLabel(s,e.columns,t)}],v.set(x,y)}})),window.ELASTIC_LENS_DELAY_SECONDS&&l.push(Object(yt.buildExpression)({type:"expression",chain:[Object(yt.buildExpressionFunction)("aggShardDelay",{id:"the-delay",enabled:!0,schema:"metric",delay:`${window.ELASTIC_LENS_DELAY_SECONDS}s`}).toAst()]}));const h=Object(qt.uniq)(c.map((([e,t])=>Tp[t.operationType]))),x=function(e,t,a,n){let i=[...e];const s={...t},l=Uc(i,(e=>{for(const a of n){var t;const n=null===(t=a.getGroupByKey)||void 0===t?void 0:t.call(a,e);if(n)return`${a.type}-${n}`}})),r=i.map((e=>e.functions[0])).filter((e=>"aggTerms"===e.name));return Object.values(l).forEach((e=>{if(e.length<=1)return;const[t,...n]=e;i=i.filter((e=>!n.includes(e)));const l=a.get(t);if(void 0===l)throw new Error("Could not find current column ID for expression builder");n.forEach((e=>{const t=a.get(e);if(void 0===t)throw new Error("Could not find current column ID for expression builder");s[l].push(...s[t]),delete s[t],r.forEach((e=>{var a;(null===(a=e.getArgument("orderBy"))||void 0===a?void 0:a[0])===xm(t)&&e.replaceArgument("orderBy",[xm(l)])}))}))})),{aggs:i,esAggsIdMap:s}}(l,b,v,h);l=x.aggs,b=x.esAggsIdMap,h.forEach((e=>{var t;const a=null===(t=e.optimizeEsAggs)||void 0===t?void 0:t.bind(e);if(a){const{aggs:e,esAggsIdMap:t}=a(l,b,v);l=e,b=t}}));const y={};let j=0;const O=Object.keys(b);l.forEach((e=>{var t;const a=null===(t=e.functions[0].getArgument("id"))||void 0===t?void 0:t[0];O.filter((e=>xm(e)===a)).forEach((e=>{const t=b[e][0],a=window.ELASTIC_LENS_DELAY_SECONDS?j+(t.isBucketed?0:1):j,n=ym(e,a);y[n]=b[e],j++}))}));const I=o.filter((([,e])=>{var t,a;return Ho("range",e)&&(null===(t=e.params)||void 0===t?void 0:t.parentFormat)||$o(e)&&(null===(a=e.params)||void 0===a?void 0:a.format)})).map((([e,t])=>{var a;const n="parentFormat"in t.params?t.params.parentFormat:void 0,i=t.params.format;return{type:"function",function:"lens_format_column",arguments:{format:i?[i.id]:[""],columnId:[e],decimals:"number"==typeof(null==i||null===(a=i.params)||void 0===a?void 0:a.decimals)?[i.params.decimals]:[],suffix:null!=i&&i.params&&"suffix"in i.params&&i.params.suffix?[i.params.suffix]:[],compact:null!=i&&i.params&&"compact"in i.params&&i.params.compact?[i.params.compact]:[],pattern:null!=i&&i.params&&"pattern"in i.params&&i.params.pattern?[i.params.pattern]:[],fromUnit:null!=i&&i.params&&"fromUnit"in i.params&&i.params.fromUnit?[i.params.fromUnit]:[],toUnit:null!=i&&i.params&&"toUnit"in i.params&&i.params.toUnit?[i.params.toUnit]:[],parentFormat:n?[JSON.stringify(n)]:[]}}})),k=o.filter((([,e])=>e.timeScale&&Tp[e.operationType].timeScalingMode&&"disabled"!==Tp[e.operationType].timeScalingMode)).flatMap((([a,n])=>[{type:"function",function:"lens_time_scale",arguments:{dateColumnId:null!=d&&d.length?[d[0]]:[],inputColumnId:[a],outputColumnId:[a],outputColumnName:[n.customLabel?n.label:Tp[n.operationType].getDefaultLabel(n,e.columns,t)],targetUnit:[n.timeScale],reducedTimeRange:n.reducedTimeRange?[n.reducedTimeRange]:[]}},{type:"function",function:"lens_format_column",arguments:{format:[""],columnId:[a],parentFormat:[JSON.stringify({id:"suffix",params:{unit:n.timeScale}})]}}]));if(0===c.length)return{type:"expression",chain:[{type:"function",function:"createTable",arguments:{ids:[],names:[],rowCount:[1]}},...m,...I,...k]};const T=Object.values(r).map((e=>Ho("date_histogram",e)&&!e.params.ignoreTimeRange?e.sourceField:null)).filter((e=>Boolean(e)));return{type:"expression",chain:[{type:"function",function:"kibana",arguments:{}},Object(yt.buildExpressionFunction)("esaggs",{index:Object(yt.buildExpression)([Object(yt.buildExpressionFunction)("indexPatternLoad",{id:t.id})]),aggs:l,metricsAtAllLevels:!1,partialRows:!1,timeFields:T,probability:rm(e),samplerSeed:Gp()(s).int32(),ignoreGlobalFilters:Boolean(e.ignoreGlobalFilters)}).toAst(),{type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(y)]}},...m,...I,...k]}}return null}(e.layers[t],a[e.layers[t].indexPatternId],n,i,s,l):null}(e,t,a,g,n,i,s),LayerSettingsComponent:e=>Object(x.jsx)(eb,e),DataPanelComponent(t){var n;const{onChangeIndexPattern:s,...l}=t,u=null==h||null===(n=h.getSelectedFields)||void 0===n?void 0:n.call(h,t.state);return Object(x.jsx)(Tf,i()({data:a,dataViews:r,fieldFormats:o,charts:d,indexPatternFieldEditor:p},l,{core:e,uiActions:m,onIndexPatternRefresh:Lp,layerFields:u}))},uniqueLabels(e,t){const a=e.layers,n={},i=Object(st.getUniqueLabelGenerator)();return Object.values(a).forEach((e=>{e.columns&&Object.entries(e.columns).forEach((([a,s])=>{n[a]=i(s.customLabel?s.label:Tp[s.operationType].getDefaultLabel(s,e.columns,t[e.indexPatternId]))}))})),n},DimensionTriggerComponent:e=>{const t=(a=h.uniqueLabels(e.state,e.indexPatterns)[e.columnId])?a.replace(/\./g,".​"):"";var a;return Object(x.jsx)(Ea.a,{id:e.columnId,label:t})},DimensionEditorComponent:s=>{const l=h.uniqueLabels(s.state,s.indexPatterns);return Object(x.jsx)(gg,i()({uiSettings:g,storage:t,fieldFormats:o,http:e.http,data:a,unifiedSearch:n,dataViews:r,uniqueLabel:l[s.columnId],notifications:e.notifications},s))},LayerPanelComponent:e=>{const{onChangeIndexPattern:t,...a}=e;return Object(x.jsx)(Wf,i()({onChangeIndexPattern:a=>{!function({state:e,layerId:t,uiActions:a,indexPatternId:n}){var i;const s=null===(i=e.layers[t])||void 0===i?void 0:i.indexPatternId;if(!s)return;const l=n,r=a.getTrigger(_l.UPDATE_FILTER_REFERENCES_TRIGGER),o=a.getAction(_l.UPDATE_FILTER_REFERENCES_ACTION);null==o||o.execute({trigger:r,fromDataView:s,toDataView:l,defaultDataView:l,usedDataViews:Object.values(Object.values(e.layers).map((e=>e.indexPatternId)))})}({indexPatternId:a,state:e.state,layerId:e.layerId,uiActions:m}),t(a,f,e.layerId)}},a))},getDropProps:xg,onDrop:yg,getCustomWorkspaceRenderer:(e,t,a)=>{if(void 0===t.field||void 0===t.indexPatternId)return;const n=a[t.indexPatternId],i=t,s=i.field.esTypes&&i.field.esTypes.find((e=>["geo_point","geo_shape"].includes(e)));return s?()=>Object(x.jsx)(Kf,{uiActions:m,fieldType:s,indexPattern:n,fieldName:i.field.name}):void 0},updateCurrentIndexPatternId:({state:e,indexPatternId:t,setState:a})=>{a({...e,currentIndexPatternId:t})},onRefreshIndexPattern:Lp,onIndexPatternChange:(e,a,n,i)=>i?function({indexPatternId:e,indexPatterns:t,layerIds:a,state:n,replaceIfPossible:i,storage:s}){Rp(s,e);const l={...n.layers};return a.forEach((a=>{l[a]=wu(n.layers[a],t[e])})),{...n,layers:l,currentIndexPatternId:i?e:n.currentIndexPatternId}}({indexPatternId:n,layerIds:[i,...Object.entries(e.layers).map((([e,t])=>{var a;return null!==(a=t.linkToLayers)&&void 0!==a&&a.includes(i)?e:""})).filter(Boolean)],state:e,replaceIfPossible:!0,storage:t,indexPatterns:a}):function({indexPatternId:e,state:t,storage:a,indexPatterns:n}){return Rp(a,e),{...t,layers:zp(t.layers)?Object(qt.mapValues)(t.layers,(t=>wu(t,n[e]))):t.layers,currentIndexPatternId:e}}({indexPatternId:n,state:e,storage:t,indexPatterns:a}),onIndexPatternRename:(e,t,a)=>function({oldIndexPatternId:e,newIndexPatternId:t,state:a}){return{...a,layers:Object(qt.mapValues)(a.layers,(a=>a.indexPatternId===e?{...a,indexPatternId:t}:a)),currentIndexPatternId:a.currentIndexPatternId===e?t:e}}({state:e,oldIndexPatternId:t,newIndexPatternId:a}),getRenderEventCounters(e){var t;const a={time_shift:!1,filter:!1};return[...Object(qt.flatten)(Object.values(null!==(t=null==e?void 0:e.layers)&&void 0!==t?t:{}).map((e=>Object.values(e.columns).map((e=>(e.timeShift&&(a.time_shift=!0),e.filter&&(a.filter=!0),e.operationType)))))),...Object.entries(a).reduce(((e,[t,a])=>(a&&e.push(t),e)),[])].map((e=>`dimension_${e}`))},updateStateOnCloseDimension:({state:e,layerId:t})=>{const a=e.layers[t];if(Object.values(a.incompleteColumns||{}).length)return am({state:e,layerId:t,newLayer:{...a,incompleteColumns:void 0}})},getPublicAPI({state:e,layerId:t,indexPatterns:a}){const n=h.uniqueLabels(e,a),i=e.layers[t],s=i.columnOrder.filter((e=>!Cu(i,e)));return{datasourceId:f,datasourceAliasIds:v,getTableSpec:()=>{const e={};return Object.keys(i.columns).forEach((t=>{const a=Su(i,t);e[a]=e[a]||[];const n=i.columns[t];var s;Ho("terms",n)&&e[a].push(...[n.sourceField].concat(null!==(s=n.params.secondaryFields)&&void 0!==s?s:[])),"sourceField"in n&&n.sourceField!==It.DOCUMENT_FIELD_NAME&&e[a].push(n.sourceField)})),s.map(((t,a)=>({columnId:t,fields:[...new Set(e[t]||[])]})))},isTextBasedLanguage:()=>!1,getOperationForColumnId:e=>i&&i.columns[e]&&!Cu(i,e)?ib(i.columns[e],n[e],a[i.indexPatternId]):null,getSourceId:()=>i.indexPatternId,getFilters:(e,n)=>function(e,t,a,n,i){const s=function(e,t){const a=Object.keys(e.columns).filter((t=>{const a=e.columns[t],n=Tp[null==a?void 0:a.operationType];return!(null!=a&&a.isBucketed)&&!Ho("formula",a)&&(null==n?void 0:n.filterable)})),{filtered:n=[],unfiltered:i=[]}=Object(qt.groupBy)(a,(t=>{var a;return null!==(a=e.columns[t])&&void 0!==a&&a.filter?"filtered":"unfiltered"})),s=n.map((t=>{var a;return null===(a=e.columns[t])||void 0===a?void 0:a.filter})).filter((e=>{var t;return null==e||null===(t=e.query)||void 0===t?void 0:t.trim()}));return{enabled:i.length?[]:s,disabled:i.length?s:[]}}(e),[l,r]=["enabled","disabled"].map((e=>Object(qt.groupBy)(s[e],"language"))),o=t.map((t=>{const s=e.columns[t];if(Ho("filters",s)){const e=Object(qt.groupBy)(s.params.filters,(({input:e})=>e.language));return{kuery:mm(e.kuery),lucene:mm(e.lucene)}}return Ho("range",s)&&s.sourceField?{kuery:gm(s)}:Ho("date_histogram",s)&&i&&s.sourceField&&!s.params.ignoreTimeRange&&n.timeFieldName!==s.sourceField?n.timeFieldName?{error:u.i18n.translate("xpack.lens.indexPattern.nonDefaultTimeFieldError",{defaultMessage:'"Explore data in Discover" does not support date histograms on non-default time fields if time field is set on the data view'})}:{kuery:fm(s,i)}:!Ho("terms",s)||s.params.otherBucket||s.params.missingBucket?void 0:!a||function(e,t){var a;const n=null==e||null===(a=e.columns.find((({id:e})=>Object(C.a)(e)===t)))||void 0===a?void 0:a.id;return!n||n!==t}(a,t)?{kuery:Tp[s.operationType].getCurrentFields(s).map((e=>({query:`"${e}": *`,language:"kuery"})))}:{kuery:bm(s,t,a)}})).filter(Boolean),c=o.filter((e=>e&&"error"in e));if(c.length)return{error:c.map((({error:e})=>e)).join(", ")};const d=o;return{enabled:{kuery:vm(l,d,"kuery"),lucene:vm(l,d,"lucene")},disabled:{kuery:[r.kuery||[]].filter((e=>e.length)),lucene:[r.lucene||[]].filter((e=>e.length))}}}(i,s,null==e?void 0:e[t],a[i.indexPatternId],n),getVisualDefaults:()=>function(e){return Object.keys(e.columns).reduce(((t,a)=>{const n=e.columns[a];if(null!=n&&n.operationType){var i;const e=Tp[n.operationType],s=null===(i=e.getDefaultVisualSettings)||void 0===i?void 0:i.call(e,n);s&&(t[a]=s)}return t}),{})}(i),getMaxPossibleNumValues:e=>{if(i&&i.columns[e]){var t,a,n;const s=i.columns[e];return null!==(t=null===(a=(n=Tp[s.operationType]).getMaxPossibleNumValues)||void 0===a?void 0:a.call(n,s))&&void 0!==t?t:null}return null},hasDefaultTimeField:()=>Boolean(a[i.indexPatternId].timeFieldName)}},getDatasourceSuggestionsForField:(e,t,a,n)=>Object(st.isDraggedDataViewField)(t)?function(e,t,a,n,i){let s=Object.keys(e.layers).filter((a=>e.layers[a].indexPatternId===t));if(i&&(s=s.filter(i)),0===s.length){const i=Object(nt.a)();return Rf(e,i,t,a,n).concat(Rf({...e,layers:{}},i,t,a,n))}{const i=Object(qt.minBy)(s,(t=>e.layers[t].columnOrder.length));return 0===e.layers[i].columnOrder.length?Rf(e,i,t,a,n):function(e,t,a,n){const i=e.layers[t],s=n[i.indexPatternId],l=Pp(a),r=Df(a),o=Object.values(i.columns).some((e=>Ro(e)&&e.sourceField===a.name)),u=[];if(r&&!o)if("date_histogram"===r&&i.columnOrder.some((e=>"date_histogram"===i.columns[e].operationType))){const n=i.columnOrder.find((e=>"date_histogram"===i.columns[e].operationType));u.push(Cf({state:e,updatedLayer:pu({layer:i,indexPattern:s,field:a,op:r,columnId:n,visualizationGroups:[]}),layerId:t,changeType:"initial"}))}else u.push(Cf({state:e,updatedLayer:cu({layer:i,indexPattern:s,field:a,op:r,columnId:Object(nt.a)(),visualizationGroups:[]}),layerId:t,changeType:"extended"}));if(!r&&l.length>0&&!o){const[n]=xu(a);if(n){const l=cu({layer:i,indexPattern:s,field:a,columnId:Object(nt.a)(),op:n.type,visualizationGroups:[]});l&&u.push(Cf({state:e,layerId:t,updatedLayer:l,changeType:"extended"}));const[,r,o]=Tu(i);if(1===r.length&&0===o.length){const l=pu({layer:i,indexPattern:s,field:a,columnId:r[0],op:n.type,visualizationGroups:[]});l&&u.push(Cf({state:e,layerId:t,updatedLayer:l,changeType:"extended"}))}}}if(!o){const n=Nf(s,t,e,a);n&&u.push(n)}return u}(e,i,a,n)}}(e,t.indexPatternId,t.field,n,a):[],getDatasourceSuggestionsFromCurrentState:Bf,getDatasourceSuggestionsForVisualizeField:Lf,getDatasourceSuggestionsForVisualizeCharts:Ef,getUserMessages(t,{frame:n,setState:i,visualizationInfo:s}){if(!t)return[];const r=function(e,t,a,n,i){const s=t.dataViews.indexPatterns,r=Object.entries(e.layers).filter((([e,t])=>!!s[t.indexPatternId])).map((([r,o])=>{var u;return(null!==(u=function(e,t,a,n,i,s){const l=Object.entries(e.columns),r=l.filter((([t,a])=>!Cu(e,t)&&"managedReference"===Tp[a.operationType].input)).flatMap((([t])=>Ru(t,e.columns).map((([e])=>e)))),o=l.flatMap((([a,n])=>{if(r.includes(a))return;const l=Tp[n.operationType];if(l.getErrorMessage){const n=s.query.timefilter.timefilter.getAbsoluteTime();return l.getErrorMessage(e,a,t,{fromDate:n.from,toDate:n.to},Tp,i.uiSettings.get(is.UI_SETTINGS.HISTOGRAM_BAR_TARGET))}})).map((e=>"object"!=typeof e?e:{...e,fixAction:e.fixAction?{...e.fixAction,newState:async t=>({...a,layers:{...a.layers,[n]:await e.fixAction.newState(s,i,t,n)}})}:void 0})).filter((e=>null!=e));return o.length?o:void 0}(o,s[o.indexPatternId],e,r,n,i))&&void 0!==u?u:[]).map((e=>{var n;return{severity:"error",fixableInEditor:!0,displayLocations:"string"!=typeof e&&e.displayLocations?e.displayLocations:[{id:"visualization"}],shortMessage:"",longMessage:"string"==typeof e?e:Object(x.jsx)(l.a.Fragment,null,e.message,e.fixAction&&Object(x.jsx)(b.EuiButton,{"data-test-subj":"errorFixAction",onClick:async()=>{var n;const i=await(null===(n=e.fixAction)||void 0===n?void 0:n.newState(t));i&&a(i)}},null===(n=e.fixAction)||void 0===n?void 0:n.label))}}))}));let o;var d;return o=r.length<=1?null!==(d=r[0])&&void 0!==d&&d.length?r[0]:[]:r.flatMap(((e,t)=>e.map((e=>e.displayLocations.find((e=>"visualization"===e.id))?{...e,shortMessage:u.i18n.translate("xpack.lens.indexPattern.layerErrorWrapper",{defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:e.shortMessage}}),longMessage:Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.indexPattern.layerErrorWrapper",defaultMessage:"Layer {position} error: {wrappedMessage}",values:{position:t+1,wrappedMessage:Object(x.jsx)(l.a.Fragment,null,e.longMessage)}})}:e)))),o}(t,n,i,e,a),o=function(e,t,a){return Object.keys(e.layers).map((n=>{const i=[];for(const s of Object.keys(e.layers[n].columns))Object(Wl.a)(t,"dimensionButton",{dimensionId:s}).length>0||a(n,s)||i.push({severity:"error",displayLocations:[{id:"dimensionButton",dimensionId:s}],fixableInEditor:!0,shortMessage:"",longMessage:Object(x.jsx)("p",null,u.i18n.translate("xpack.lens.configure.invalidConfigTooltip",{defaultMessage:"Invalid configuration."}),Object(x.jsx)("br",null),u.i18n.translate("xpack.lens.configure.invalidConfigTooltipClick",{defaultMessage:"Click for more details."}))});return i})).flat()}(t,r,((e,a)=>{const i=t.layers[e];return!function(e,t,a,n,i){var s;const l=e.columns[t];if(!l||!a)return;const r=l.operationType&&Tp[l.operationType],o="references"in l&&Boolean(function(e,t,a,n,i){var s;return null===(s=t.references)||void 0===s?void 0:s.map((t=>{var s,l;const r=null===(s=e.columns[t])||void 0===s?void 0:s.operationType,o=Tp[r];return null==o||null===(l=o.getErrorMessage)||void 0===l?void 0:l.call(o,e,t,a,n,Tp,i)}))}(e,l,a,n,i).filter(Boolean).length),u=r&&(null===(s=r.getErrorMessage)||void 0===s?void 0:s.call(r,e,t,a,n,Tp,i)),c=!!l.filter&&!Object(Aa.a)(l.filter,a);return u&&u.length>0||o||c}(i,a,n.dataViews.indexPatterns[i.indexPatternId],n.dateRange,g.get(is.UI_SETTINGS.HISTOGRAM_BAR_TARGET))})),d=[...[...eo(a.datatableUtilities,t,n)||[]].map((e=>({severity:"warning",fixableInEditor:!0,displayLocations:[{id:"toolbar"}],shortMessage:"",longMessage:e}))),...pm(a.datatableUtilities,t,n,e.docLinks,i),...dm(t,n,e.docLinks)],p=function(e,t,a){if(!a)return[];const n=[],i=Object.entries(e.layers),s=i.filter((([,e])=>1!==rm(e)));s.length&&n.push({uniqueId:"random_sampling_info",severity:"info",fixableInEditor:!1,shortMessage:u.i18n.translate("xpack.lens.indexPattern.samplingPerLayer",{defaultMessage:"Sampling probability by layer"}),longMessage:Object(x.jsx)(im,{layers:s,dataViews:t.dataViews,visualizationInfo:a}),displayLocations:[{id:"embeddableBadge"}]});const l=i.filter((([,e])=>e.ignoreGlobalFilters));return l.length&&n.push({uniqueId:"ignoring-global-filters-layers",severity:"info",fixableInEditor:!1,shortMessage:u.i18n.translate("xpack.lens.xyChart.layerAnnotationsIgnoreTitle",{defaultMessage:"Layers ignoring global filters"}),longMessage:Object(x.jsx)(hs,{layers:l.map((([e,{indexPatternId:t}])=>({layerId:e,indexPatternId:t}))),visualizationInfo:a,dataViews:t.dataViews}),displayLocations:[{id:"embeddableBadge"}]}),n}(t,n,s);return r.concat(o,d,p)},getSearchWarningMessages:(t,a,n,i)=>[...cm(t,a,0,0,e.theme)],checkIntegrity:(e,t)=>Object.values(e.layers||{}).map((({indexPatternId:e})=>e)).filter((e=>!t[e])),isTimeBased:(e,t)=>{if(!e)return!1;const{layers:a}=e;return Boolean(a)&&Object.values(a).some((e=>{var a;return Boolean(null===(a=t[e.indexPatternId])||void 0===a?void 0:a.timeFieldName)||e.columnOrder.filter((t=>e.columns[t].isBucketed)).some((t=>{const a=e.columns[t];return Ho("date_histogram",a)&&!a.params.ignoreTimeRange}))}))},isEqual:(e,t,a,n)=>Object(qt.isEqual)(Np(e,t),Np(a,n)),getUsedDataView:(e,t)=>t?e.layers[t].indexPatternId:e.currentIndexPatternId,getUsedDataViews:e=>Object.values(e.layers).map((({indexPatternId:e})=>e)),injectReferencesToLayers:(e,t)=>{const a=t&&e?Np(e,t).layers:null==e?void 0:e.layers;return{...e,layers:a}},getDatasourceInfo:async(e,t,a)=>{const n=t?Np(e,t).layers:e.layers,i=[];for(const{indexPatternId:e}of Object.values(n)){const t=await(null==a?void 0:a.get(e));t&&i.push(t)}return Object.entries(n).reduce(((e,[t,a])=>{const n=null==i?void 0:i.find((e=>e.id===a.indexPatternId)),s=Object.entries(a.columns).map((([e,t])=>{const a=Ro(t)?Ep(t):void 0;return{id:e,role:t.isBucketed?"split":"metric",operation:{...ib(t,void 0,n),type:t.operationType,fields:a,filter:t.filter}}}));return e.push({layerId:t,columns:s,dataView:n}),e}),[])}};return h}function lb(e,t){return{indexPatternId:e,linkToLayers:t,columns:{},columnOrder:[],sampling:1,ignoreGlobalFilters:!1}}var rb=a(460),ob=a.n(rb);const ub=5,cb=(e,t)=>{const a=[...e.filter((e=>{if(null==t?void 0:t.some((t=>t.name===(null==e?void 0:e.fieldName))))return e})),...t.map((e=>({columnId:e.id,fieldName:e.id,meta:e.meta})))],n=[];return a.filter((e=>!n.includes(e.columnId)&&(n.push(e.columnId),!0)))};function db(e,t){const a=null==e?void 0:e.some((e=>{var t;return"number"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)}));return!a||a&&"number"===t}function pb(e,t){const a=null==e?void 0:e.some((e=>{var t;return"number"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)}));return!a||e.length>=ub||a&&"number"===t}const mb=e=>null==e?void 0:e.meta.type;function gb({setState:e,state:t,core:a,data:n,query:r,frame:o,filters:c,dateRange:p,expressions:m,dataViews:g,layerFields:f,hasSuggestionForField:b,dropOntoWorkspace:v}){const h=ob()(r),[y,j]=Object(s.useState)(!1);Object(s.useEffect)((()=>{!async function(){if(r&&Object(El.isOfAggregateQueryType)(r)&&!Object(qt.isEqual)(r,h)){const a=o.dataViews,i=await async function(e,t,a,n,i,s){var l,r,o,u;let c=null!=s&&s.indexPatternRefs.length?s.indexPatternRefs:await async function(e){const t=await e.getIdsWithTitle(),a=await Promise.all(t.map((t=>e.get(t.id).then((e=>e.timeFieldName)))));return t.map(((e,t)=>({...e,timeField:a[t]}))).sort(((e,t)=>e.title.localeCompare(t.title)))}(a);const d=[],p=Object.keys(e.layers),m=e.initialContext,g=p.length>0?p[0]:Object(nt.a)(),f=function(e){let t="";return"sql"in e&&(t=Object(El.getIndexPatternFromSQLQuery)(e.sql)),"esql"in e&&(t=Object(El.getIndexPatternFromESQLQuery)(e.esql)),t}(t);let b,v=null!==(l=null===(r=c.find((e=>e.title===f)))||void 0===r?void 0:r.id)&&void 0!==l?l:"",h=[],x=[];try{var y;const s=await a.create({title:f});var j,O;s&&s.id&&("date"===(null==s||null===(j=s.fields)||void 0===j||null===(O=j.getByName("@timestamp"))||void 0===O?void 0:O.type)&&(s.timeFieldName="@timestamp"),v=null==s?void 0:s.id,c=[...c,{id:s.id,title:s.name,timeField:s.timeFieldName}]),b=s.timeFieldName;const l=await Vl(t,s,n,i);h=null!==(y=null==l?void 0:l.columns)&&void 0!==y?y:[],x=cb(e.layers[g].allColumns,h)}catch(e){d.push(e)}return{layers:{[g]:{index:v,query:t,columns:null!==(o=e.layers[g].columns)&&void 0!==o?o:[],allColumns:x,timeField:b,errors:d}},fieldList:null!==(u=h)&&void 0!==u?u:[],indexPatternRefs:c,initialContext:m}}(t,r,g,n,m,a);j(!0),e(i)}}()}),[n,g,m,h,r,e,t,o.dataViews]);const{fieldList:O}=t,I=Object(s.useCallback)((e=>Boolean(null==f?void 0:f.includes(e.name))),[f]),k=Object(s.useCallback)((e=>{if(e===kg.b.AvailableFields)return{helpText:u.i18n.translate("xpack.lens.indexPattern.allFieldsForTextBasedLabelHelp",{defaultMessage:"Drag and drop available fields to the workspace and create visualizations. To change the available fields, edit your query."})}}),[]),{fieldListFiltersProps:T,fieldListGroupedProps:M}=Eg({dataViewId:null,allFields:y?null!=O?O:[]:null,services:{dataViews:g,core:a},getCustomFieldType:mb,onSelectedFieldFilter:I,onOverrideFieldGroupDetails:k}),w=Object(s.useCallback)((({field:e,groupIndex:t,itemIndex:a,fieldSearchHighlight:n,groupName:i})=>e?Object(x.jsx)(jf,{field:e,exists:!0,hideDetails:!0,itemIndex:a,groupIndex:t,dropOntoWorkspace:v,hasSuggestionForField:b,highlight:n,getCustomFieldType:mb}):Object(x.jsx)(l.a.Fragment,null)),[b,v]);return Object(x.jsx)(d.KibanaContextProvider,{services:{...a}},Object(x.jsx)(Ag,{className:"lnsInnerIndexPatternDataPanel",isProcessing:!y,prepend:Object(x.jsx)(Rg,i()({},T,{"data-test-subj":"lnsTextBasedLanguages"}))},Object(x.jsx)(zg,i()({},M,{renderFieldItem:w,"data-test-subj":"lnsTextBasedLanguages",localStorageKeyPrefix:"lens"}))))}function fb({selectedField:e,onChoose:t,existingFields:a,"data-test-subj":n}){var i;const l=Object(s.useMemo)((()=>{const e=a.map((e=>{var t;const a=null==e||null===(t=e.meta)||void 0===t?void 0:t.type;return{compatible:e.compatible?1:0,exists:!0,label:e.name,value:{type:"field",field:e.name,dataType:a}}})).sort(((e,t)=>t.compatible-e.compatible));return[{label:u.i18n.translate("xpack.lens.indexPattern.availableFieldsLabel",{defaultMessage:"Available fields"}),options:e}]}),[a]);return Object(x.jsx)(qu.a,{selectedOptions:e?[{label:e.fieldName,value:{type:"field",field:e.fieldName,dataType:null==e||null===(i=e.meta)||void 0===i?void 0:i.type}}]:[],options:l,onChoose:a=>{a&&a.field!==(null==e?void 0:e.fieldName)&&t(a)},fieldIsInvalid:!1,"data-test-subj":null!=n?n:"text-based-dimension-field"})}const bb=e=>{const{source:t,target:a,state:n}=e;if(!t||t.id===a.columnId)return;const i=n.layers[a.layerId],s=i.columns.find((e=>e.columnId===a.columnId)),l=i.allColumns.find((e=>e.columnId===a.columnId)),r=i.allColumns.find((e=>e.columnId===t.id));if(Object(st.isDraggedField)(t)){var o;const e=t.humanData.label;if(null!=a&&a.isMetricDimension&&"number"!==(null==r||null===(o=r.meta)||void 0===o?void 0:o.type))return;return{dropTypes:[s?"field_replace":"field_add"],nextLabel:e}}if(Object(fg.g)(t)){var u,c;if(t.layerId!==a.layerId)return;const e=t.humanData.label;if(Object(st.isOperationFromTheSameGroup)(t,a))return s?{dropTypes:["reorder"],nextLabel:e}:{dropTypes:["duplicate_compatible"],nextLabel:e};const n=db(i.allColumns,null==r||null===(u=r.meta)||void 0===u?void 0:u.type),o=db(i.allColumns,null==l||null===(c=l.meta)||void 0===c?void 0:c.type),d=!(null!=a&&a.isMetricDimension)||a.isMetricDimension&&n;if(s){const a=d&&!(null!=t&&t.isMetricDimension)||t.isMetricDimension&&o;if(d)return a?{dropTypes:["replace_compatible","replace_duplicate_compatible","swap_compatible"],nextLabel:e}:{dropTypes:["replace_compatible","replace_duplicate_compatible"],nextLabel:e}}else if(d)return{dropTypes:["move_compatible","duplicate_compatible"],nextLabel:e}}},vb=({prevState:e,layerId:t,columnId:a})=>({...e,layers:{...e.layers,[t]:{...e.layers[t],columns:e.layers[t].columns.filter((e=>e.columnId!==a)),allColumns:e.layers[t].allColumns.filter((e=>e.columnId!==a))}}}),hb=e=>{var t;const{dropType:a,state:n,source:i,target:s}=e;if(!["field_add","field_replace","duplicate_compatible","replace_duplicate_compatible","replace_compatible","move_compatible","swap_compatible","reorder"].includes(a))return;const l=n.layers[s.layerId],r=l.allColumns.find((e=>e.columnId===i.id)),o=l.allColumns.find((e=>e.columnId===s.columnId)),u={columnId:s.columnId,fieldName:null!==(t=null==r?void 0:r.fieldName)&&void 0!==t?t:"",meta:null==r?void 0:r.meta};let c,d;switch(a){case"field_add":case"duplicate_compatible":case"replace_duplicate_compatible":c=[...l.columns.filter((e=>e.columnId!==s.columnId)),u],d=[...l.allColumns.filter((e=>e.columnId!==s.columnId)),u];break;case"field_replace":case"replace_compatible":c=l.columns.map((e=>e.columnId===s.columnId?u:e)),d=l.allColumns.map((e=>e.columnId===s.columnId?u:e));break;case"move_compatible":c=[...l.columns,u],d=[...l.allColumns,u];break;case"swap_compatible":const e=e=>{var t;return e.columnId===s.columnId?u:e.columnId===i.columnId?{columnId:i.columnId,fieldName:null!==(t=null==o?void 0:o.fieldName)&&void 0!==t?t:"",meta:null==o?void 0:o.meta}:e};c=l.columns.map(e),d=l.allColumns.map(e);break;case"reorder":const t=l.columns.find((e=>e.columnId===s.columnId)),a=l.columns.find((e=>e.columnId===i.id));if(!t||!a)return;c=Object(st.reorderElements)(l.columns,t,a),d=Object(st.reorderElements)(l.allColumns,t,a)}if(!c||!d)return;const p={...e.state,layers:{...e.state.layers,[s.layerId]:{...l,columns:c,allColumns:d}}};return Object(fg.g)(i)&&["replace_compatible","move_compatible"].includes(a)?vb({prevState:p,columnId:i.columnId,layerId:i.layerId}):p};function xb(e){return`textBasedLanguages-datasource-layer-${e}`}const yb=ar()((e=>e.map((e=>{if("fieldName"in e)return e.fieldName})).filter(st.nonNullable)),qt.isEqual);function jb({core:e,storage:t,data:a,expressions:n,dataViews:s}){const r=e=>{var t;return null===(t=Object.entries(e.layers))||void 0===t?void 0:t.map((([t,a])=>{var n,i;return{state:{...e},table:{changeType:"unchanged",isMultiRow:!1,layerId:t,columns:null!==(n=null===(i=a.columns)||void 0===i?void 0:i.map((e=>{var t,n,i;const s=pb(a.allColumns,null==e||null===(t=e.meta)||void 0===t?void 0:t.type);return{columnId:e.columnId,operation:{dataType:null==e||null===(n=e.meta)||void 0===n?void 0:n.type,label:e.fieldName,isBucketed:Boolean("number"!==(null==e||null===(i=e.meta)||void 0===i?void 0:i.type)),...s&&{inMetricDimension:s}}}})))&&void 0!==n?n:[]},keptLayerIds:[t]}}))},o={id:"textBased",checkIntegrity:()=>[],getUserMessages:e=>{const t=[];return Object.values(e.layers).forEach((e=>{e.errors&&e.errors.length>0&&t.push(...e.errors)})),t.map((e=>({severity:"error",fixableInEditor:!0,displayLocations:[{id:"visualization"},{id:"textBasedLanguagesQueryInput"}],shortMessage:e.message,longMessage:e.message})))},initialize:(e,t,a,n,i)=>({...e||{layers:{}},indexPatternRefs:(i?Object.values(i):[]).map((e=>({id:e.id,title:e.title,timeField:e.timeFieldName}))),initialContext:a}),syncColumns:({state:e})=>e,onRefreshIndexPattern(){},getUsedDataViews:e=>Object.values(e.layers).map((({index:e})=>e)),getPersistableState({layers:e}){const t=[];return Object.entries(e).forEach((([e,{index:a,...n}])=>{a&&t.push({type:"index-pattern",id:a,name:xb(e)})})),{state:{layers:e},savedObjectReferences:t}},insertLayer(e,t){var a,n,i;const s=null===(a=Object.values(null==e?void 0:e.layers))||void 0===a?void 0:a[0],l=null==s?void 0:s.query,r=null!==(n=null==s?void 0:s.allColumns)&&void 0!==n?n:[],o=null!==(i=null==s?void 0:s.index)&&void 0!==i?i:JSON.parse(localStorage.getItem("lens-settings")||"{}").indexPatternId||e.indexPatternRefs[0].id;return{...e,layers:{...e.layers,[t]:Ob(o,l,r)}}},createEmptyLayer:()=>({indexPatternRefs:[],layers:{},fieldList:[]}),cloneLayer:(e,t,a,n)=>({...e}),removeLayer(e,t){const a={...e.layers,[t]:{...e.layers[t],columns:[]}};return{removedLayerIds:[t],newState:{...e,layers:a,fieldList:e.fieldList}}},clearLayer:(e,t)=>({removedLayerIds:[],newState:{...e,layers:{...e.layers,[t]:{...e.layers[t],columns:[]}}}}),getLayers:e=>e&&e.layers?Object.keys(null==e?void 0:e.layers):[],suggestsLimitedColumns(e){var t;return(null!==(t=null==e?void 0:e.fieldList)&&void 0!==t?t:[]).length>=ub},isTimeBased:(e,t)=>{if(!e)return!1;const{layers:a}=e;return Boolean(a)&&Object.values(a).some((e=>{var a;return Boolean(null===(a=t[e.index])||void 0===a?void 0:a.timeFieldName)}))},getUsedDataView:(e,t)=>{if(!t){var a;const t=Object.values(e.layers);return null==t||null===(a=t[0])||void 0===a?void 0:a.index}return e.layers[t].index},removeColumn:vb,toExpression:(e,t,a,n,i)=>function(e,t){return e.layers[t]?function(e,t){var a,n;if(!e.columns||0===(null===(a=e.columns)||void 0===a?void 0:a.length))return null;let i={};e.columns.forEach((e=>{i[e.fieldName]?i[e.fieldName].push({id:e.columnId,label:e.fieldName}):i={...i,[e.fieldName]:[{id:e.columnId,label:e.fieldName}]}}));const s=null!==(n=e.timeField)&&void 0!==n?n:void 0,l=Object(ca.textBasedQueryStateToExpressionAst)({query:e.query,timeFieldName:s});return l.chain.push({type:"function",function:"lens_map_to_columns",arguments:{idMap:[JSON.stringify(i)]}}),l}(e.layers[t],e.indexPatternRefs):null}(e,t),getSelectedFields(e){var t;return yb(null===(t=Object.values(null==e?void 0:e.layers))||void 0===t?void 0:t.flatMap((e=>Object.values(e.columns))))},DataPanelComponent(e){var t;const l=null==o||null===(t=o.getSelectedFields)||void 0===t?void 0:t.call(o,e.state);return Object(x.jsx)(gb,i()({data:a,dataViews:s,expressions:n,layerFields:l},e))},DimensionTriggerComponent:e=>{var t,a;const n=o.uniqueLabels(e.state,e.indexPatterns),i=e.state.layers[e.layerId],s=null==i||null===(t=i.allColumns)||void 0===t?void 0:t.find((t=>t.columnId===e.columnId));let l=n[e.columnId];return l||(l=null==s?void 0:s.fieldName),Object(x.jsx)(Ea.a,{id:e.columnId,color:l&&s?"primary":"danger",dataTestSubj:"lns-dimensionTrigger-textBased",label:null!==(a=l)&&void 0!==a?a:u.i18n.translate("xpack.lens.textBasedLanguages.missingField",{defaultMessage:"Missing field"})})},getRenderEventCounters(e){const t=null==e?void 0:e.initialContext;return t&&"query"in t&&t.query&&Object(El.isOfAggregateQueryType)(t.query)?[`${Object(El.getAggregateQueryMode)(t.query)}_chart`]:[]},DimensionEditorComponent:e=>{var t;const a=e.state.fieldList,n=null===(t=e.state.layers[e.layerId])||void 0===t?void 0:t.allColumns,i=null==n?void 0:n.find((t=>t.columnId===e.columnId)),s=null==n?void 0:n.some((e=>{var t;return"number"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)})),r=null==a?void 0:a.map((t=>{var a;return{...t,compatible:!e.isMetricDimension||!s||e.filterOperations({dataType:t.meta.type,isBucketed:Boolean("number"!==(null==t||null===(a=t.meta)||void 0===a?void 0:a.type)),scale:"ordinal"})}}));return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(b.EuiFormRow,{"data-test-subj":"text-based-languages-field-selection-row",label:u.i18n.translate("xpack.lens.textBasedLanguages.chooseField",{defaultMessage:"Field"}),fullWidth:!0,className:"lnsIndexPatternDimensionEditor--padded"},Object(x.jsx)(fb,{existingFields:null!=r?r:[],selectedField:i,onChoose:t=>{var n;const s=null==a||null===(n=a.find((e=>e.name===t.field)))||void 0===n?void 0:n.meta,l={columnId:e.columnId,fieldName:t.field,meta:s};return e.setState(i?{...e.state,layers:{...e.state.layers,[e.layerId]:{...e.state.layers[e.layerId],columns:e.state.layers[e.layerId].columns.map((a=>a.columnId!==e.columnId?a:{...a,fieldName:t.field,meta:s})),allColumns:e.state.layers[e.layerId].allColumns.map((a=>a.columnId!==e.columnId?a:{...a,fieldName:t.field,meta:s}))}}}:{...e.state,layers:{...e.state.layers,[e.layerId]:{...e.state.layers[e.layerId],columns:[...e.state.layers[e.layerId].columns,l],allColumns:[...e.state.layers[e.layerId].allColumns,l]}}})}})),e.dataSectionExtra&&Object(x.jsx)("div",{style:{paddingLeft:re.euiThemeVars.euiSize,paddingRight:re.euiThemeVars.euiSize}},e.dataSectionExtra))},LayerPanelComponent:e=>null,uniqueLabels(e){const t=e.layers,a={},n=Object(st.getUniqueLabelGenerator)();return Object.values(t).forEach((e=>{e.columns&&Object.values(e.columns).forEach((e=>{a[e.columnId]=n(e.fieldName)}))})),a},getDropProps:bb,onDrop:hb,getPublicAPI:({state:e,layerId:t,indexPatterns:a})=>({datasourceId:"textBased",getTableSpec:()=>{var a;return(null===(a=e.layers[t])||void 0===a?void 0:a.columns.filter((t=>{var a;if(null==e||null===(a=e.fieldList)||void 0===a?void 0:a.some((e=>e.name===(null==t?void 0:t.fieldName))))return t}))).map((e=>({columnId:e.columnId,fields:[e.fieldName]})))||[]},getOperationForColumnId:n=>{var i;const s=e.layers[t],l=null==s||null===(i=s.allColumns)||void 0===i?void 0:i.find((e=>e.columnId===n)),r=o.uniqueLabels(e,a);var u,c,d;return l?{dataType:null==l||null===(u=l.meta)||void 0===u?void 0:u.type,label:null!==(c=r[n])&&void 0!==c?c:null==l?void 0:l.fieldName,isBucketed:Boolean("number"!==(null==l||null===(d=l.meta)||void 0===d?void 0:d.type)),inMetricDimension:l.inMetricDimension,hasTimeShift:!1,hasReducedTimeRange:!1}:null},getVisualDefaults:()=>({}),isTextBasedLanguage:()=>!0,getMaxPossibleNumValues:e=>null,getSourceId:()=>e.layers[t].index,getFilters:()=>({enabled:{kuery:[],lucene:[]},disabled:{kuery:[],lucene:[]}}),hasDefaultTimeField:()=>!1}),getDatasourceSuggestionsForField(e,t){var a,n;const i=null===(a=e.fieldList)||void 0===a?void 0:a.find((e=>e.id===t.id));return i?null===(n=Object.entries(e.layers))||void 0===n?void 0:n.map((([t,a])=>{var n,s,l,r,o;const u=Object(nt.a)(),c={columnId:u,fieldName:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:"",meta:null==i?void 0:i.meta};return{state:{...e,layers:{...e.layers,[t]:{...e.layers[t],columns:[...a.columns,c],allColumns:[...a.allColumns,c]}}},table:{changeType:"initial",isMultiRow:!1,layerId:t,columns:[...null===(s=a.columns)||void 0===s?void 0:s.map((e=>{var t,a;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean("number"!==(null==e||null===(a=e.meta)||void 0===a?void 0:a.type))}}})),{columnId:u,operation:{dataType:null==i||null===(l=i.meta)||void 0===l?void 0:l.type,label:null!==(r=null==i?void 0:i.name)&&void 0!==r?r:"",isBucketed:Boolean("number"!==(null==i||null===(o=i.meta)||void 0===o?void 0:o.type))}}]},keptLayerIds:[t]}})):[]},getDatasourceSuggestionsForVisualizeField:(e,t,a)=>{const n=e.initialContext;if(a)return[];if(n&&"dataViewSpec"in n&&n.dataViewSpec.title&&n.query){var i,s,l,r,o;const t=Object(nt.a)(),a=null!==(i=n.textBasedColumns)&&void 0!==i?i:[],u=null==a?void 0:a.some((e=>{var t;return"number"===(null==e||null===(t=e.meta)||void 0===t?void 0:t.type)})),c=a.map((e=>{var t;const n=pb(a,null==e||null===(t=e.meta)||void 0===t?void 0:t.type);return{columnId:e.id,fieldName:e.name,meta:e.meta,...n&&{inMetricDimension:n}}})),d=null!==(s=n.dataViewSpec.id)&&void 0!==s?s:n.dataViewSpec.title,p=n.query;return[{state:{...{...e,initialContext:void 0,fieldList:a,...n.dataViewSpec.id?{indexPatternRefs:[{id:n.dataViewSpec.id,title:n.dataViewSpec.title,timeField:n.dataViewSpec.timeFieldName}]}:{},layers:{...e.layers,[t]:{index:d,query:p,columns:null!==(l=c.slice(0,ub))&&void 0!==l?l:[],allColumns:null!=c?c:[],timeField:n.dataViewSpec.timeFieldName}}}},table:{changeType:"initial",isMultiRow:!1,notAssignedMetrics:!u,layerId:t,columns:null!==(r=null==c||null===(o=c.slice(0,ub))||void 0===o?void 0:o.map((e=>{var t,a;return{columnId:e.columnId,operation:{dataType:null==e||null===(t=e.meta)||void 0===t?void 0:t.type,label:e.fieldName,isBucketed:Boolean("number"!==(null==e||null===(a=e.meta)||void 0===a?void 0:a.type))}}})))&&void 0!==r?r:[]},keptLayerIds:[t]}]}return[]},getDatasourceSuggestionsFromCurrentState:r,getDatasourceSuggestionsForVisualizeCharts:r,isEqual:(e,t,a,n)=>Object(qt.isEqual)(e,a),getDatasourceInfo:async(e,t,a)=>{const n=[];for(const{index:t}of Object.values(e.layers)){const e=await(null==a?void 0:a.get(t));e&&n.push(e)}return Object.entries(e.layers).reduce(((e,[t,a])=>{const i=Object.entries(a.columns).map((([e,t])=>{var a,n,i,s;return{id:e,role:"number"!==(null===(a=t.meta)||void 0===a?void 0:a.type)?"split":"metric",operation:{dataType:null==t||null===(n=t.meta)||void 0===n?void 0:n.type,label:t.fieldName,isBucketed:Boolean("number"!==(null==t||null===(i=t.meta)||void 0===i?void 0:i.type)),hasTimeShift:!1,hasReducedTimeRange:!1,fields:[t.fieldName],type:(null===(s=t.meta)||void 0===s?void 0:s.type)||"unknown",filter:void 0}}}));return e.push({layerId:t,columns:i,dataView:null==n?void 0:n.find((e=>e.id===a.index))}),e}),[])}};return o}function Ob(e,t,a){return{index:e,query:t,columns:[],allColumns:null!=a?a:[]}}const Ib=()=>{const e=new WeakMap;return{insertOrReplaceFormulaColumn:(t,{formula:a,label:n,format:i,filter:s,reducedTimeRange:l,timeScale:r},o,u,c)=>{const d=(t=>{const a=e.get(t);if(a)return a;const n=Object(Al.a)(t);return e.set(t,n),n})(u);return Fo(t,{label:null!=n?n:a,customLabel:Boolean(n),operationType:"formula",dataType:"number",references:[],isBucketed:!1,filter:s,reducedTimeRange:l,timeScale:r,params:{formula:a,format:i}},{...o,indexPatternId:d.id},{indexPattern:d,dateRange:c}).layer}}};class text_based_TextBasedDatasource{constructor(){}setup(e,{editorFrame:t}){t.registerDatasource((async()=>{const{getTextBasedDatasource:t}=await Promise.resolve().then(a.bind(null,558)),[n,{data:i,dataViews:s,expressions:l}]=await e.getStartServices();return t({core:n,storage:new ks.Storage(localStorage),data:i,dataViews:s,expressions:l})}))}}class form_based_FormBasedDatasource{setup(e,{fieldFormats:t,expressions:n,editorFrame:i,charts:s}){i.registerDatasource((async()=>{const{getFormBasedDatasource:n,getSuffixFormatter:i,suffixFormatterId:l}=await Promise.resolve().then(a.bind(null,558));if(!t.has(l)){const a=Object(ks.createStartServicesGetter)(e.getStartServices),n=i((()=>a().plugins.fieldFormats.deserialize));t.register([n])}const[r,{dataViewFieldEditor:o,uiActions:u,data:c,fieldFormats:d,dataViews:p,unifiedSearch:m,share:g}]=await e.getStartServices();return n({core:r,fieldFormats:d,storage:new ks.Storage(localStorage),data:c,unifiedSearch:m,share:g,dataViews:p,charts:s,dataViewFieldEditor:o,uiActions:u})}))}}var kb=a(140);async function Tb(e){const t=await Promise.all(e.map((e=>"function"==typeof e?e():e))),a={};return t.forEach((e=>{if(a[e.id]=e,e.alias)for(const t of e.alias)a[t]=e})),a}class service_EditorFrameService{constructor(){ta()(this,"datasources",[]),ta()(this,"visualizations",[]),ta()(this,"loadDatasources",(()=>Tb(this.datasources))),ta()(this,"loadVisualizations",(()=>Tb(this.visualizations))),ta()(this,"documentToExpression",(async(e,t)=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{persistedStateToExpression:s}=await Promise.resolve().then(a.bind(null,558));return s(n,i,e,t)}))}setup(){return{registerDatasource:e=>{this.datasources.push(e)},registerVisualization:e=>{this.visualizations.push(e)}}}start(e,t){return{createInstance:async()=>{const[n,i]=await Promise.all([this.loadDatasources(),this.loadVisualizations()]),{EditorFrame:s}=await Promise.resolve().then(a.bind(null,558));return{EditorFrameContainer:({showNoDataPopover:a,lensInspector:l,indexPatternService:r,getUserMessages:o,addUserMessages:u})=>Object(x.jsx)("div",{className:"lnsApp__frame"},Object(x.jsx)(s,{"data-test-subj":"lnsEditorFrame",core:e,plugins:t,lensInspector:l,showNoDataPopover:a,getUserMessages:o,addUserMessages:u,indexPatternService:r,datasourceMap:n,visualizationMap:i,ExpressionRenderer:t.expressions.ReactExpressionRenderer})),datasourceMap:n,visualizationMap:i}}}}}var Mb=a(111),wb=a(8),Cb=a(162);function Eb({ExpressionRenderer:e,expression:t,searchContext:a,variables:n,handleEvent:i,interactive:s,searchSessionId:r,onData$:o,onRender$:u,renderMode:d,syncColors:p,syncTooltips:m,syncCursor:g,hasCompatibleActions:f,getCompatibleCellValueActions:b,style:v,className:h,onRuntimeError:y,addUserMessages:j,executionContext:I,lensInspector:k,noPadding:T,docLinks:M}){return t?Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)("div",{className:O()("lnsExpressionRenderer",h),style:v},Object(x.jsx)(e,{className:"lnsExpressionRenderer__component",padding:T?void 0:"s",variables:n,expression:t,interactive:s,searchContext:a,searchSessionId:r,onData$:o,onRender$:u,inspectorAdapters:k.adapters,renderMode:d,syncColors:p,syncTooltips:m,syncCursor:g,executionContext:I,renderError:(e,t)=>{var a;const n=Object(Cb.a)(t||null,M);return j(n),y(null!==(a=n[0].shortMessage)&&void 0!==a?a:e||""),Object(x.jsx)(l.a.Fragment,null)},onEvent:i,hasCompatibleActions:f,getCompatibleCellValueActions:b}))):null}const Sb=e=>{const t=Object(yt.createDefaultInspectorAdapters)();let a;return{adapters:t,inspect:n=>(a=e.open(t,n),a.onClose.then((()=>{a&&(a=void 0)})),a),close:()=>{var e;return null===(e=a)||void 0===e?void 0:e.close()}}};var Fb=a(161);a(461);var Pb={name:"upo3sz",styles:"max-width:280px"};const _b=({messages:e})=>{const{euiTheme:t}=Object(b.useEuiTheme)(),a=Object(b.useEuiFontSize)("xs").fontSize,[n,i]=Object(s.useState)(!1);if(!e.length)return null;const l=u.i18n.translate("xpack.lens.embeddable.featureBadge.iconDescription",{defaultMessage:"{count} visualization {count, plural, one {modifier} other {modifiers}}",values:{count:e.length}}),r=e.filter((({uniqueId:e})=>!e)),o={};for(const t of e)t.uniqueId&&(o[t.uniqueId]||(o[t.uniqueId]=[]),o[t.uniqueId].push(t));const c=r.length+Object.keys(o).length;return Object(x.jsx)(b.EuiPopover,{panelPaddingSize:"none",button:Object(x.jsx)(b.EuiToolTip,{content:l},Object(x.jsx)(b.EuiButtonEmpty,{"data-test-subj":"lns-feature-badges-trigger",className:"lnsEmbeddablePanelFeatureList_button",color:"text",onClick:()=>i((e=>!e)),title:l,size:"s",css:Object(x.css)("color:transparent;font-size:",a,";height:",t.size.l,"!important;padding-inline:",t.size.xs,";.euiButtonEmpty__content{gap:",t.size.xs,";}",""),iconType:"wrench"},c)),isOpen:n,closePopover:()=>i(!1)},Object(x.jsx)("div",{css:Pb,"data-test-subj":"lns-feature-badges-panel"},r.map((({shortMessage:e,longMessage:a},n)=>Object(x.jsx)(s.Fragment,{key:`${e}-${n}`},n?Object(x.jsx)(b.EuiHorizontalRule,{margin:"none","data-test-subj":"lns-feature-badges-horizontal-rule"}):null,Object(x.jsx)("aside",{css:Object(x.css)("padding:",t.size.base,";","")},Object(x.jsx)(b.EuiTitle,{size:"xxs",css:Object(x.css)("color=",t.colors.title,";","")},Object(x.jsx)("h3",null,e)),Object(x.jsx)("ul",{className:"lnsEmbeddablePanelFeatureList"},a))))),Object.entries(o).map((([e,a],n)=>{const i=r.length||n,[{shortMessage:l}]=a;return Object(x.jsx)(s.Fragment,{key:e},i?Object(x.jsx)(b.EuiHorizontalRule,{margin:"none","data-test-subj":"lns-feature-badges-horizontal-rule"}):null,Object(x.jsx)("aside",{css:Object(x.css)("padding:",t.size.base,";","")},Object(x.jsx)(b.EuiTitle,{size:"xxs",css:Object(x.css)("color=",t.colors.title,";","")},Object(x.jsx)("h3",null,l)),Object(x.jsx)("ul",{className:"lnsEmbeddablePanelFeatureList"},a.map((({longMessage:t},a)=>Object(x.jsx)(s.Fragment,{key:`${e}-${a}`},t))))))}))))};var Ab=a(128);function Lb({errors:e,canEdit:t}){const a=e.length>1,n=t&&e.some((({fixableInEditor:e})=>e));return Object(x.jsx)("div",{className:"lnsEmbeddedError"},Object(x.jsx)(b.EuiEmptyPrompt,{iconType:"warning",iconColor:"danger","data-test-subj":"embeddable-lens-failure",body:Object(x.jsx)(l.a.Fragment,null,e.length?Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("p",null,e[0].longMessage),a&&!n?Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.moreErrors",defaultMessage:"Edit in Lens editor to see more errors"})):null,n?Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.fixErrors",defaultMessage:"Edit in Lens editor to fix the error"})):null):Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.embeddable.failure",defaultMessage:"Visualization couldn't be displayed"})))}))}const Db=async(e,t)=>{const{ast:a,indexPatterns:n,indexPatternRefs:i,activeVisualizationState:s}=await t(e);return{ast:a?Object(Mb.b)(a):null,indexPatterns:n,indexPatternRefs:i,activeVisualizationState:s}},Rb=({messages:e})=>{const{euiTheme:t}=Object(b.useEuiTheme)(),a=Object(b.useEuiFontSize)("xs").fontSize;return e.length?Object(x.jsx)(Fb.a,{messages:e,customButtonStyles:Object(x.css)("block-size:",t.size.l,";font-size:",a,";padding:0 ",t.size.xs,";&>*{gap:",t.size.xs,";}","")}):null},Bb=["visualization","visualizationOnEmbeddable"];var Nb={name:"1n2yqb3",styles:"position:absolute;z-index:2;left:0;bottom:0"};const zb=({onMount:e})=>Object(x.jsx)("div",{css:Nb,ref:t=>{t&&e(t)}});class embeddable_Embeddable extends wb.Embeddable{logError(e){Object(p.d)("runtime"===e?"embeddable_runtime_error":"embeddable_validation_error",this.getExecutionContext())}constructor(e,t,a){super(t,{editApp:"lens"},a),ta()(this,"type",It.DOC_TYPE),ta()(this,"deferEmbeddableLoad",!0),ta()(this,"expressionRenderer",void 0),ta()(this,"savedVis",void 0),ta()(this,"expression",void 0),ta()(this,"domNode",void 0),ta()(this,"isInitialized",!1),ta()(this,"inputReloadSubscriptions",void 0),ta()(this,"isDestroyed",void 0),ta()(this,"lensInspector",void 0),ta()(this,"activeData",void 0),ta()(this,"dataViews",[]),ta()(this,"viewUnderlyingDataArgs",void 0),ta()(this,"activeVisualizationState",void 0),ta()(this,"indexPatterns",{}),ta()(this,"indexPatternRefs",[]),ta()(this,"fullAttributes",void 0),ta()(this,"getUserMessages",((e,t)=>{var a,n,i,s,l,r,o,u,c,d,p,m,g;const f=[];if(f.push(...Object(Wl.b)({visualizationType:null===(a=this.savedVis)||void 0===a?void 0:a.visualizationType,visualizationState:{state:this.activeVisualizationState,activeId:this.activeVisualizationId},visualization:this.activeVisualizationId&&this.deps.visualizationMap[this.activeVisualizationId]?this.deps.visualizationMap[this.activeVisualizationId]:void 0,activeDatasource:this.activeDatasource,activeDatasourceState:{isLoading:!this.activeDatasourceState,state:this.activeDatasourceState},dataViews:{indexPatterns:this.indexPatterns,indexPatternRefs:this.indexPatternRefs},core:this.deps.coreStart})),!this.savedVis)return f;const b=this.getMergedSearchContext(),v={dataViews:{indexPatterns:this.indexPatterns,indexPatternRefs:this.indexPatternRefs},datasourceLayers:Object(Ab.a)({[this.activeDatasourceId]:{isLoading:!this.activeDatasourceState,state:this.activeDatasourceState}},this.deps.datasourceMap,this.indexPatterns),query:this.savedVis.state.query,filters:null!==(n=b.filters)&&void 0!==n?n:[],dateRange:{fromDate:null!==(i=null===(s=b.timeRange)||void 0===s?void 0:s.from)&&void 0!==i?i:"",toDate:null!==(l=null===(r=b.timeRange)||void 0===r?void 0:r.to)&&void 0!==l?l:""},activeData:this.activeData};return f.push(...null!==(o=null===(u=this.activeDatasource)||void 0===u?void 0:u.getUserMessages(this.activeDatasourceState,{setState:()=>{},frame:v,visualizationInfo:null===(c=this.activeVisualization)||void 0===c||null===(d=c.getVisualizationInfo)||void 0===d?void 0:d.call(c,this.activeVisualizationState,v)}))&&void 0!==o?o:[],...null!==(p=null===(m=this.activeVisualization)||void 0===m||null===(g=m.getUserMessages)||void 0===g?void 0:g.call(m,this.activeVisualizationState,{frame:v}))&&void 0!==p?p:[]),Object(Wl.a)([...f,...Object.values(this.additionalUserMessages)],e,null!=t?t:{})})),ta()(this,"additionalUserMessages",{}),ta()(this,"addUserMessages",(e=>{const t={...this.additionalUserMessages},a=[];return e.forEach((e=>{t[e.uniqueId]||(a.push(e.uniqueId),t[e.uniqueId]=e)})),a.length&&(this.additionalUserMessages=t,this.renderUserMessages()),()=>{e.forEach((({uniqueId:e})=>{delete this.additionalUserMessages[e]}))}})),ta()(this,"removeActiveDataWarningMessages",(()=>{})),ta()(this,"updateActiveData",((e,t)=>{var a;this.input.onLoad&&this.input.onLoad(!1,t,this.getOutput$());const{type:n,error:i}=e;this.updateOutput({loading:!1,error:"error"===n?i:void 0});const s=null==t||null===(a=t.tables)||void 0===a?void 0:a.tables;this.removeActiveDataWarningMessages();const l=this.getSearchWarningMessages(t);this.removeActiveDataWarningMessages=this.addUserMessages(l.filter(fg.f)),this.activeData=s,this.renderUserMessages()})),ta()(this,"onRender",(()=>{var e;let t=[],a=[];var n,i,s;this.savedVis&&(t=Object.values(this.deps.datasourceMap).reduce(((e,t)=>{var a,n;return[...e,...null!==(a=null===(n=t.getRenderEventCounters)||void 0===n?void 0:n.call(t,this.savedVis.state.datasourceStates[t.id]))&&void 0!==a?a:[]]}),[]),this.savedVis.visualizationType&&(a=null!==(n=null===(i=(s=this.deps.visualizationMap[this.savedVis.visualizationType]).getRenderEventCounters)||void 0===i?void 0:i.call(s,this.savedVis.state.visualization))&&void 0!==n?n:[]));const l=this.getExecutionContext(),r=[...t,...a,...Object(p.a)(l)];Object.values((null===(e=this.savedVis)||void 0===e?void 0:e.state.adHocDataViews)||{}).forEach((()=>{r.push("ad_hoc_data_view")})),Object(p.d)(r,l),this.renderComplete.dispatchComplete(),this.updateOutput({...this.getOutput(),rendered:!0})})),ta()(this,"badgeDomNode",void 0),ta()(this,"renderBadgeMessages",(()=>{const e=this.getUserMessages("embeddableBadge"),[t,a]=Object(qt.partition)(e,(({severity:e})=>"info"!==e));this.badgeDomNode&&Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(x.jsx)(Rb,{messages:t}),Object(x.jsx)(_b,{messages:a})),this.badgeDomNode)})),ta()(this,"hasCompatibleActions",(async e=>{if(Object(fg.e)(e)||Object(fg.d)(e)||Object(fg.c)(e)){const{getTriggerCompatibleActions:t}=this.deps;return!!t&&(await t(N.VIS_EVENT_TO_TRIGGER[e.name],{data:e.data,embeddable:this})).length>0}return!1})),ta()(this,"getCompatibleCellValueActions",(async e=>{const{getTriggerCompatibleActions:t}=this.deps;if(t){const a=this;return(await t(wb.CELL_VALUE_TRIGGER,{data:e,embeddable:a})).sort(((e,t)=>{var a,n;return(null!==(a=e.order)&&void 0!==a?a:1/0)-(null!==(n=t.order)&&void 0!==n?n:1/0)})).map((t=>({id:t.id,type:t.type,iconType:t.getIconType({embeddable:a,data:e,trigger:wb.cellValueTrigger}),displayName:t.getDisplayName({embeddable:a,data:e,trigger:wb.cellValueTrigger}),execute:e=>t.execute({embeddable:a,data:e,trigger:wb.cellValueTrigger})})))}return[]})),ta()(this,"handleEvent",(async e=>{var t;if(!this.deps.getTrigger||this.input.disableTriggers)return;let a,n=!0;if(Object(fg.a)(e)?a=this.input.onBrushEnd:Object(fg.c)(e)||Object(fg.d)(e)?a=this.input.onFilter:Object(fg.e)(e)&&(a=this.input.onTableRowClick),null===(t=a)||void 0===t||t({...e.data,preventDefault:()=>{n=!1}}),(Object(fg.c)(e)||Object(fg.d)(e)||Object(fg.a)(e))&&n&&this.deps.getTrigger(N.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:{...e.data,timeFieldName:e.data.timeFieldName||Object(st.inferTimeField)(this.deps.data.datatableUtilities,e)},embeddable:this}),Object(fg.e)(e)&&n&&this.deps.getTrigger(N.VIS_EVENT_TO_TRIGGER[e.name]).exec({data:e.data,embeddable:this},!0),Object(fg.b)(e)&&this.onEditAction){if(!this.savedVis)return;const t=JSON.parse(JSON.stringify(this.savedVis));t.state.visualization=this.onEditAction(t.state.visualization,e),this.savedVis=t;const{ast:a}=await Db(this.savedVis,this.deps.documentToExpression);this.expression=a,this.reload()}})),ta()(this,"inputIsRefType",(e=>this.deps.attributeService.inputIsRefType(e))),ta()(this,"getInputAsRefType",(async()=>this.deps.attributeService.getInputAsRefType(this.getExplicitInput(),{showSaveModal:!0,saveModalTitle:this.getTitle()}))),ta()(this,"getInputAsValueType",(async()=>this.deps.attributeService.getInputAsValueType(this.getExplicitInput()))),this.deps=e,this.lensInspector=Sb(e.inspector),this.expressionRenderer=e.expressionRenderer,this.initializeSavedVis(t).then((()=>{this.reload()})).catch((e=>this.onFatalError(e)));const n=this.getInput$();this.inputReloadSubscriptions=[],this.inputReloadSubscriptions.push(n.pipe(Object(Nl.map)((e=>{var t;return null===(t=e.enhancements)||void 0===t?void 0:t.dynamicActions})),Object(Nl.distinctUntilChanged)(((e,t)=>_a()(e,t))),Object(Nl.skip)(1)).subscribe((e=>{this.reload()}))),this.inputReloadSubscriptions.push(n.pipe(Object(Nl.map)((e=>e.viewMode)),Object(Nl.distinctUntilChanged)(),Object(Nl.skip)(1)).subscribe((e=>{var t;null!==(t=this.getInput().enhancements)&&void 0!==t&&t.dynamicActions&&this.reload()})));const i=e=>Object(Nl.map)((t=>({trigger:e,input:t}))),s=n.pipe(Object(Nl.distinctUntilChanged)(((e,t)=>_a()(["attributes"in e&&e.attributes,"savedObjectId"in e&&e.savedObjectId,"overrides"in e&&e.overrides,"disableTriggers"in e&&e.disableTriggers],["attributes"in t&&t.attributes,"savedObjectId"in t&&t.savedObjectId,"overrides"in t&&t.overrides,"disableTriggers"in t&&t.disableTriggers]))),Object(Nl.skip)(1),i("attributesOrSavedObjectId")),l=Object(wb.shouldFetch$)(n,(()=>this.getInput())).pipe(i("searchContext"));this.inputReloadSubscriptions.push(Object(zl.merge)(l,s).pipe(Object(Nl.debounceTime)(0),Object(zl.switchMap)((async({trigger:e,input:t})=>{"attributesOrSavedObjectId"===e&&await this.initializeSavedVis(t),this.additionalUserMessages={},this.reload()}))).subscribe())}get activeDatasourceId(){return Object(st.getActiveDatasourceIdFromDoc)(this.savedVis)}get activeDatasource(){if(this.activeDatasourceId)return this.deps.datasourceMap[this.activeDatasourceId]}get activeVisualizationId(){return Object(st.getActiveVisualizationIdFromDoc)(this.savedVis)}get activeVisualization(){if(this.activeVisualizationId)return this.deps.visualizationMap[this.activeVisualizationId]}get activeDatasourceState(){var e,t,a;if(!this.activeDatasourceId||!this.activeDatasource)return;const n=null===(e=this.savedVis)||void 0===e?void 0:e.state.datasourceStates[this.activeDatasourceId];return this.activeDatasource.initialize(n,[...(null===(t=this.savedVis)||void 0===t?void 0:t.references)||[],...(null===(a=this.savedVis)||void 0===a?void 0:a.state.internalReferences)||[]],void 0,void 0,this.indexPatterns)}reportsEmbeddableLoad(){return!0}supportedTriggers(){var e;return this.savedVis&&this.savedVis.visualizationType&&(null===(e=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===e?void 0:e.triggers)||[]}getInspectorAdapters(){return this.lensInspector.adapters}getFullAttributes(){return this.fullAttributes}isTextBasedLanguage(){if(!this.savedVis)return;const e=this.savedVis.state.query;return!Object(El.isOfQueryType)(e)}getTextBasedLanguage(){var e,t;if(!this.isTextBasedLanguage()||null===(e=this.savedVis)||void 0===e||!e.state.query)return;const a=null===(t=this.savedVis)||void 0===t?void 0:t.state.query,n=Object(El.getAggregateQueryMode)(a);return String(n).toUpperCase()}async updateVisualization(e,t,a){var n;const i=this.savedVis,s=null!==(n=this.activeDatasourceId)&&void 0!==n?n:"formBased";if(null!=i&&i.state){const n={...i.state.datasourceStates,[s]:e},l=Object(st.extractReferencesFromState)({activeDatasources:Object.keys(n).reduce(((e,t)=>({...e,[t]:this.deps.datasourceMap[t]})),{}),datasourceStates:Object.fromEntries(Object.entries(n).map((([e,t])=>[e,{isLoading:!1,state:t}]))),visualizationState:t,activeVisualization:this.activeVisualizationId?this.deps.visualizationMap[null!=a?a:this.activeVisualizationId]:void 0}),r={...i,state:{...i.state,visualization:t,datasourceStates:n},references:l,visualizationType:null!=a?a:i.visualizationType};this.updateInput({attributes:r,savedObjectId:void 0}),this.renderUserMessages()}}async updateSuggestion(e){const t={...this.savedVis,...e};this.updateInput({attributes:t})}async navigateToLensEditor(){var e,t;const a=this.getAppContext(),n={originatingApp:null!==(e=null==a?void 0:a.currentAppId)&&void 0!==e?e:"dashboards",originatingPath:null==a||null===(t=a.getCurrentPath)||void 0===t?void 0:t.call(a),valueInput:this.getExplicitInput(),embeddableId:this.id,searchSessionId:this.getInput().searchSessionId},i=new wb.EmbeddableStateTransfer(this.deps.coreStart.application.navigateToApp,this.deps.coreStart.application.currentAppId$);i&&await i.navigateToEditor(It.APP_ID,{path:this.output.editPath,state:n,skipAppLeave:!0})}updateByRefInput(e){const t=this.savedVis;this.updateInput({attributes:t,savedObjectId:e})}async openConfingPanel(e){var t;const{getEditLensConfiguration:n}=await Promise.resolve().then(a.bind(null,558)),i=await n(this.deps.coreStart,e,this.deps.visualizationMap,this.deps.datasourceMap),s=null!==(t=this.activeDatasourceId)&&void 0!==t?t:"formBased",l=this.savedVis;var r;return l?Object(x.jsx)(i,{attributes:l,updatePanelState:this.updateVisualization.bind(this),updateSuggestion:this.updateSuggestion.bind(this),datasourceId:s,lensAdapters:this.lensInspector.adapters,output$:this.getOutput$(),panelId:this.id,savedObjectId:null===(r=this.savedVis)||void 0===r?void 0:r.savedObjectId,updateByRefInput:this.updateByRefInput.bind(this),navigateToLensEditor:this.isTextBasedLanguage()?void 0:this.navigateToLensEditor.bind(this),displayFlyoutHeader:!0,canEditTextBasedQuery:this.isTextBasedLanguage()}):null}async initializeSavedVis(e){var t;const a=await this.deps.attributeService.unwrapAttributes(e).catch((e=>(this.onFatalError(e),!1)));if(!a||this.isDestroyed)return;const{metaInfo:n,attributes:i}=a;this.fullAttributes=i,this.savedVis={...i,type:this.type,savedObjectId:null==e?void 0:e.savedObjectId};try{const{ast:e,indexPatterns:t,indexPatternRefs:a,activeVisualizationState:n}=await Db(this.savedVis,this.deps.documentToExpression);this.expression=e,this.indexPatterns=t,this.indexPatternRefs=a,this.activeVisualizationState=n}catch{}var s;"conflict"===(null==n||null===(t=n.sharingSavedObjectProps)||void 0===t?void 0:t.outcome)&&this.deps.spaces&&this.addUserMessages([{uniqueId:"url-conflict",severity:"error",displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.embeddable.legacyURLConflict.shortMessage",{defaultMessage:"You've encountered a URL conflict"}),longMessage:Object(x.jsx)(this.deps.spaces.ui.components.getEmbeddableLegacyUrlConflict,{targetType:It.DOC_TYPE,sourceId:null==n||null===(s=n.sharingSavedObjectProps)||void 0===s?void 0:s.sourceId}),fixableInEditor:!1}]),await this.initializeOutput(),this.setInitializationFinished(),this.isInitialized=!0}getSearchWarningMessages(e){var t;if(!this.activeDatasource||!this.activeDatasourceId||null==e||!e.requests)return[];const a=null===(t=this.savedVis)||void 0===t?void 0:t.state.datasourceStates[this.activeDatasourceId];return Object(st.getSearchWarningMessages)(e.requests,this.activeDatasource,a,{searchService:this.deps.data.search})}getExecutionContext(){if(this.savedVis){var e,t;const a=(null===(e=this.parent)||void 0===e?void 0:e.getInput().executionContext)||this.input.executionContext,n={type:"lens",name:null!==(t=this.savedVis.visualizationType)&&void 0!==t?t:"",id:this.id,description:this.savedVis.title||this.input.title||"",url:this.output.editUrl};return a?{...a,child:n}:n}}render(e){if(this.domNode=e,!this.savedVis||!this.isInitialized||this.isDestroyed)return;super.render(e),this.input.onLoad&&this.input.onLoad(!0),this.domNode.setAttribute("data-shared-item","");const t=this.getUserMessages(Bb,{severity:"error"});this.updateOutput({loading:!0,error:t.length?new Error("string"==typeof t[0].longMessage?t[0].longMessage:t[0].shortMessage):void 0}),t.length?this.renderComplete.dispatchError():this.renderComplete.dispatchInProgress();const a=this.getInput();this.expression&&!t.length&&Object(r.render)(Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(x.jsx)(Eb,{ExpressionRenderer:this.expressionRenderer,expression:this.expression||null,lensInspector:this.lensInspector,searchContext:this.getMergedSearchContext(),variables:{embeddableTitle:this.getTitle(),...a.palette?{theme:{palette:a.palette}}:{},..."overrides"in a?{overrides:a.overrides}:{}},searchSessionId:this.getInput().searchSessionId,handleEvent:this.handleEvent,onData$:this.updateActiveData,onRender$:this.onRender,interactive:!a.disableTriggers&&!this.isTextBasedLanguage(),renderMode:a.renderMode,syncColors:a.syncColors,syncTooltips:a.syncTooltips,syncCursor:a.syncCursor,hasCompatibleActions:this.hasCompatibleActions,getCompatibleCellValueActions:this.getCompatibleCellValueActions,className:a.className,style:a.style,executionContext:this.getExecutionContext(),addUserMessages:e=>this.addUserMessages(e),onRuntimeError:e=>{this.updateOutput({error:new Error(e)}),this.logError("runtime")},noPadding:this.visDisplayOptions.noPadding,docLinks:this.deps.coreStart.docLinks})),Object(x.jsx)(zb,{onMount:e=>{this.badgeDomNode=e,this.renderBadgeMessages()}})),e),this.renderUserMessages()}renderUserMessages(){const e=this.getUserMessages(["visualization","visualizationOnEmbeddable"],{severity:"error"});e.length&&this.domNode&&Object(r.render)(Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(d.KibanaThemeProvider,{theme$:this.deps.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Lb,{errors:e,canEdit:this.getIsEditable()&&"edit"===this.input.viewMode}))),Object(x.jsx)(zb,{onMount:e=>{this.badgeDomNode=e,this.renderBadgeMessages()}})),this.domNode),this.renderBadgeMessages()}getMergedSearchContext(){var e;if(!this.savedVis)throw new Error("savedVis is required for getMergedSearchContext");const t=this.getInput(),a={now:this.deps.data.nowProvider.get().getTime(),timeRange:void 0!==t.timeslice?{from:new Date(t.timeslice[0]).toISOString(),to:new Date(t.timeslice[1]).toISOString(),mode:"absolute"}:t.timeRange,query:[this.savedVis.state.query],filters:this.deps.injectFilterReferences(this.savedVis.state.filters,this.savedVis.references),disableWarningToasts:!0};return t.query&&(a.query=[t.query,...a.query]),null!==(e=t.filters)&&void 0!==e&&e.length&&(a.filters=[...t.filters.filter((e=>!e.meta.disabled)),...a.filters]),a}get onEditAction(){var e;const t=null===(e=this.savedVis)||void 0===e?void 0:e.visualizationType;if(t)return this.deps.visualizationMap[t].onEditAction}reload(){this.savedVis&&this.isInitialized&&!this.isDestroyed&&this.domNode&&this.render(this.domNode)}async loadViewUnderlyingDataArgs(){if(!(this.savedVis&&this.activeData&&this.activeDatasource&&this.activeDatasourceState&&this.activeVisualization&&this.activeVisualizationState))return!1;const e=this.getMergedSearchContext();if(!e.timeRange)return!1;const t=function({activeDatasource:e,activeDatasourceState:t,activeVisualization:a,activeVisualizationState:n,activeData:i,dataViews:s,capabilities:l,query:r,filters:o,timeRange:u,esQueryConfig:c,indexPatternsCache:d}){const{error:p,meta:m}=vf(e,t,a,n,i,d,u,l);if(p||!m)return;const g=[],f=[];Array.isArray(r)&&r.forEach((e=>{Object(El.isOfQueryType)(e)?g.push(e):f.push(e)}));const{filters:b,query:v}=hf(g.length>0?g:r,o,m,s,c);return{dataViewSpec:d[m.id].spec,timeRange:u,filters:b,query:f.length>0?f[0]:v,columns:m.columns}}({activeDatasource:this.activeDatasource,activeDatasourceState:this.activeDatasourceState,activeVisualization:this.activeVisualization,activeVisualizationState:this.activeVisualizationState,activeData:this.activeData,dataViews:this.dataViews,capabilities:this.deps.capabilities,query:e.query,filters:e.filters||[],timeRange:e.timeRange,esQueryConfig:Object(is.getEsQueryConfig)(this.deps.uiSettings),indexPatternsCache:this.indexPatterns}),a=void 0!==t;return a&&(this.viewUnderlyingDataArgs=t),a}getViewUnderlyingDataArgs(){return this.viewUnderlyingDataArgs}canViewUnderlyingData(){return this.loadViewUnderlyingDataArgs()}async initializeOutput(){var e,t,a,n;if(!this.savedVis)return;const{indexPatterns:i}=await Object(st.getIndexPatternsObjects)((null===(e=this.savedVis)||void 0===e?void 0:e.references.map((({id:e})=>e)))||[],this.deps.dataViews);(await Promise.all(Object.values((null===(t=this.savedVis)||void 0===t?void 0:t.state.adHocDataViews)||{}).map((e=>this.deps.dataViews.create(e))))).forEach((e=>i.push(e))),this.dataViews=Object(qt.uniqBy)(i,"id");const s=this.getInput();null==s.timeRange&&i.some((e=>e.isTimeBased()))&&this.addUserMessages([{uniqueId:"missing-time-range-on-embeddable",severity:"error",fixableInEditor:!1,displayLocations:[{id:"visualization"}],shortMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.shortMessage",{defaultMessage:"Missing timeRange property"}),longMessage:u.i18n.translate("xpack.lens.embeddable.missingTimeRangeParam.longMessage",{defaultMessage:"The timeRange property is required for the given configuration"})}]),this.getUserMessages(Bb,{severity:"error"}).length&&this.logError("validation");const l=s.hidePanelTitles?"":null!==(a=s.title)&&void 0!==a?a:this.savedVis.title,r=s.hidePanelTitles?"":null!==(n=s.description)&&void 0!==n?n:this.savedVis.description,o=s.savedObjectId;this.updateOutput({defaultTitle:this.savedVis.title,defaultDescription:this.savedVis.description,editable:this.getIsEditable(),inlineEditable:!0,title:l,description:r,editPath:Object(It.getEditPath)(o),editUrl:this.deps.basePath.prepend(`/app/lens${Object(It.getEditPath)(o)}`),indexPatterns:this.dataViews})}getIsEditable(){return this.deps.capabilities.canSaveVisualizations||!this.inputIsRefType(this.getInput())&&this.deps.capabilities.canSaveDashboards&&this.deps.capabilities.canOpenVisualizations}async getFilters(){var e,t,a,n;return Object(is.mapAndFlattenFilters)(this.deps.injectFilterReferences(null!==(e=null===(t=this.savedVis)||void 0===t?void 0:t.state.filters)&&void 0!==e?e:[],null!==(a=null===(n=this.savedVis)||void 0===n?void 0:n.references)&&void 0!==a?a:[]))}async getQuery(){var e;return null===(e=this.savedVis)||void 0===e?void 0:e.state.query}getSavedVis(){return this.savedVis}destroy(){this.isDestroyed=!0,super.destroy(),this.inputReloadSubscriptions.length>0&&this.inputReloadSubscriptions.forEach((e=>{e.unsubscribe()})),this.domNode&&Object(r.unmountComponentAtNode)(this.domNode)}getSelfStyledOptions(){return{hideTitle:this.visDisplayOptions.noPanelTitle}}get visDisplayOptions(){var e,t,a,n;if(null===(e=this.savedVis)||void 0===e||!e.visualizationType)return{};let i=null!==(t=null===(a=this.deps.visualizationMap[this.savedVis.visualizationType])||void 0===a||null===(n=a.getDisplayOptions)||void 0===n?void 0:n.call(a))&&void 0!==t?t:{};return void 0!==this.input.noPadding&&(i={...i,noPadding:this.input.noPadding}),i}}var Vb=a(49);const Gb={services:{}},qb=Object(s.createContext)(Gb),Hb=({children:e,component:t,render:a,...n})=>{const r=Object(s.useMemo)((()=>{if(t)return e=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Ub,null),Object(x.jsx)(t,e))}),[t]);if(r)return Object(x.jsx)(Vb.Route,i()({},n,{component:r}));if(a||"function"==typeof e){const t="function"==typeof e?e:a;return Object(x.jsx)(Vb.Route,i()({},n,{render:e=>Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Ub,null),t(e))}))}return Object(x.jsx)(Vb.Route,n,Object(x.jsx)(Ub,null),e)},Ub=()=>{const{executionContext:e}=Object(s.useContext)(qb).services,t=Object(Vb.useRouteMatch)();return function(e,t){f()((()=>(null==e||e.set(t),()=>{null==e||e.clear()})),[t])}(e,{type:"application",page:t.path,id:Object.keys(t.params).length>0?JSON.stringify(t.params):void 0}),null};var $b=a(58);const Wb=({children:e,...t})=>Object(x.jsx)(Vb.HashRouter,t,Object(x.jsx)($b.CompatRouter,null,e)),Xb=({legacySwitch:e=!0,children:t})=>{const a=Object(Vb.useRouteMatch)();return e?Object(x.jsx)(Vb.Switch,null,t):Object(x.jsx)($b.Routes,null,s.Children.map(t,(e=>{if(l.a.isValidElement(e)&&e.type===Hb){var n;const i=Object(qt.replace)(null==e?void 0:e.props.path,a.url+"/",""),s="function"==typeof(null==e?void 0:e.props.children)?null==e?void 0:e.props.children:null==e?void 0:e.props.render;return Object(x.jsx)($b.Route,{path:i,element:Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)(Ub,null),(null==e||null===(n=e.props)||void 0===n?void 0:n.component)&&Object(x.jsx)(e.props.component,null)||s&&s()||t)})}return e})))};a(466),a(471);const Yb=e=>{const{className:t,size:a,...n}=e,s={};return(e=>void 0===e.iconType)(e)&&(s.iconType=`logo${e.name.replace(/\s+/g,"")}`),Object(x.jsx)(b.EuiAvatar,i()({className:O()("kbnSolutionAvatar",{[`kbnSolutionAvatar--${a}`]:a},t),size:"xxl"===a?"xl":a,iconSize:a,color:"plain"},n,s))};a(476);u.i18n.translate("sharedUXPackages.solutionNav.collapsibleLabel",{defaultMessage:"Collapse side navigation"}),u.i18n.translate("sharedUXPackages.solutionNav.openLabel",{defaultMessage:"Open side navigation"}),Object(b.htmlIdGenerator)("SolutionNav");a(121);var Qb=a(141),Kb=a(481),Zb=a.n(Kb);const Jb=u.i18n.translate("sharedUXPackages.card.noData.noPermission.title",{defaultMessage:"Contact your administrator"}),ev=u.i18n.translate("sharedUXPackages.card.noData.noPermission.description",{defaultMessage:"This integration is not yet enabled. Your administrator has the required permissions to turn it on."}),tv=u.i18n.translate("sharedUXPackages.card.noData.title",{defaultMessage:"Add Elastic Agent"}),av=u.i18n.translate("sharedUXPackages.card.noData.description",{defaultMessage:"Use Elastic Agent for a simple, unified way to collect data from your machines."}),nv=()=>Object(x.jsx)(b.EuiImage,{size:"fullWidth",style:{width:"max(100%, 360px)",height:240,objectFit:"cover",background:"aliceblue"},url:Zb.a,alt:""}),iv=({title:e,description:t,canAccessFleet:a,button:n,...s})=>Object(x.jsx)(b.EuiCard,i()({css:{maxWidth:400,marginInline:"auto"},paddingSize:"l",title:a?Object(x.jsx)(b.EuiScreenReaderOnly,null,Object(x.jsx)("span",null,e||tv)):Object(x.jsx)(b.EuiTextColor,{color:"default"},Jb),description:a?t||av:Object(x.jsx)(b.EuiTextColor,{color:"default"},ev),footer:(()=>{if(a)return n&&"string"!=typeof n?n:Object(x.jsx)(b.EuiButton,{fill:!0},n||e||tv)})(),isDisabled:!a,image:Object(x.jsx)(nv,null)},s)),sv=l.a.createContext(null),lv=({children:e,...t})=>{const a={addBasePath:t.coreStart.http.basePath.prepend,canAccessFleet:t.coreStart.application.capabilities.navLinks.integrations};return Object(x.jsx)(sv.Provider,{value:a},Object(x.jsx)(Qb.c,t,e))},rv=({href:e,category:t,description:a,...n})=>{var l;const{canAccessFleet:r,addBasePath:o}=function(){const e=Object(s.useContext)(sv);if(!e)throw new Error("NoDataCard Context is missing.  Ensure your component or React root is wrapped with NoDataCardContext.");return e}(),u=Object(s.useMemo)((()=>{if(e)return e;const a="/app/integrations/browse";return o(t?`${a}/${t}`:a)}),[o,e,t]);return Object(x.jsx)(Qb.b,null,Object(x.jsx)(iv,i()({},n,{href:u,canAccessFleet:null!==(l=n.canAccessFleet)&&void 0!==l?l:r,description:a})))},ov=({action:e})=>{const t=Object.keys(e);if(1!==t.length)return null;const a=t[0],n="elasticAgent"===a?"empty-page-agent-action":`empty-page-${a}-action`;return Object(x.jsx)(rv,i()({key:n},e[a]))},uv=({solution:e,logo:t,action:a,docsLink:n,pageTitle:i,pageDescription:s,className:l})=>{const r=i||u.i18n.translate("sharedUXPackages.noDataPage.welcomeTitle",{defaultMessage:"Welcome to Elastic {solution}!",values:{solution:e}}),o=n?Object(x.jsx)(b.EuiLink,{href:n,target:"_blank"},Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataPage.intro.link",defaultMessage:"learn more"})):null,d=null!=s?s:o?Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataPage.intro",defaultMessage:"Add your data to get started, or {link} about {solution}.",values:{solution:e,link:o}}):Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataPage.introNoDocLink",defaultMessage:"Add your data to get started."});return Object(x.jsx)(b.EuiPageTemplate.Section,{alignment:"center",grow:!0,className:O()("kbnNoDataPageContents",l),"data-test-subj":"kbnNoDataPage"},Object(x.jsx)(b.EuiText,{textAlign:"center"},Object(x.jsx)(Yb,{name:e,iconType:t||`logo${e}`,size:"xxl"}),Object(x.jsx)(b.EuiSpacer,{size:"l"}),Object(x.jsx)("h1",null,r),Object(x.jsx)(b.EuiTextColor,{color:"subdued"},Object(x.jsx)("p",null,d))),Object(x.jsx)(b.EuiSpacer,{size:"xxl"}),Object(x.jsx)(ov,{action:a}))},cv=e=>{const{className:t,noDataConfig:a,pageSideBar:n,pageSideBarProps:s,...l}=e;if(!a)return null;let r;n&&(r=Object(x.jsx)(b.EuiPageTemplate.Sidebar,s,n));const o=((e,t)=>O()("kbnPageTemplate","",t||""))(0,t);return Object(x.jsx)(b.EuiPageTemplate,i()({className:o,restrictWidth:950,panelled:!1,offset:0,minHeight:0},l),r,Object(x.jsx)(uv,a))};function dv({href:e}){return Object(x.jsx)("dl",null,Object(x.jsx)(b.EuiTitle,{size:"xxs"},Object(x.jsx)("dt",{className:"eui-displayInline"},Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.learnMore",defaultMessage:"Want to learn more?"})))," ",Object(x.jsx)("dd",{className:"eui-displayInline"},Object(x.jsx)(b.EuiLink,{href:e,target:"_blank",external:!0},Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.readDocumentation",defaultMessage:"Read the docs"}))))}const pv=u.i18n.translate("sharedUXPackages.noDataViewsPrompt.addDataViewText",{defaultMessage:"Create data view"}),mv=({onClickCreate:e,canCreateNewDataView:t,dataViewsDocLink:n,emptyPromptColor:i="plain"})=>{const s=t&&Object(x.jsx)(b.EuiButton,{onClick:e,iconType:"plusInCircle",fill:!0,"data-test-subj":"createDataViewButton"},pv),r=t?Object(x.jsx)("h2",null,Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.youHaveData",defaultMessage:"You have data in Elasticsearch."}),Object(x.jsx)("br",null),Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.nowCreate",defaultMessage:"Now, create a data view."})):Object(x.jsx)("h2",null,Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.noPermission.title",defaultMessage:"You need permission to create data views"})),o=t?Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.dataViewExplanation",defaultMessage:"Data views identify the Elasticsearch data you want to explore. You can point data views to one or more data streams, indices, and index aliases, such as your log data from yesterday, or all indices that contain your log data."})):Object(x.jsx)("p",null,Object(x.jsx)(c.FormattedMessage,{id:"sharedUXPackages.noDataViewsPrompt.noPermission.dataViewExplanation",defaultMessage:"Data views identify the Elasticsearch data that you want to explore. To create data views, ask your administrator for the required permissions."})),u=n?Object(x.jsx)(dv,{href:n}):void 0,d=Object(G.c)(l.a.lazy((()=>a.e(14).then(a.bind(null,557)).then((({DataViewIllustration:e})=>({default:e}))))),Object(x.jsx)(b.EuiPanel,{color:"subdued",style:{width:226,height:206}})),p=Object(x.jsx)(d,null);return Object(x.jsx)(b.EuiEmptyPrompt,{"data-test-subj":"noDataViewsPrompt",layout:"horizontal",css:Object(x.css)("max-width:",830,"px!important;flex-grow:0;",""),color:i,actions:s,icon:p,title:r,body:o,footer:u})},gv=l.a.createContext(null),fv=({children:e,...t})=>{var a;return Object(x.jsx)(gv.Provider,{value:{dataViewsDocLink:null===(a=t.coreStart.docLinks.links.indexPatterns)||void 0===a?void 0:a.introduction,canCreateNewDataView:t.dataViewEditor.userPermissions.editDataView(),openDataViewEditor:t.dataViewEditor.openEditor}},e)},bv=({onDataViewCreated:e,allowAdHocDataView:t=!1})=>{const{canCreateNewDataView:a,openDataViewEditor:n,dataViewsDocLink:i}=function(){const e=Object(s.useContext)(gv);if(!e)throw new Error("NoDataViewsPromptContext is missing.  Ensure your component or React root is wrapped with NoDataViewsPromptProvider.");return e}(),l=Object(s.useRef)();Object(s.useEffect)((()=>()=>{null!=l&&l.current&&(null==l||l.current())}),[]);const r=Object(s.useCallback)((e=>{l.current=e}),[]),o=Object(s.useCallback)((()=>{if(!a)return;const i=n({onSave:t=>{e(t)},allowAdHocDataView:t});r&&r(i)}),[a,n,t,r,e]);return Object(x.jsx)(mv,{onClickCreate:o,canCreateNewDataView:a,dataViewsDocLink:i})},vv=l.a.createContext(null),hv=({children:e,...t})=>{const{dataViews:a}=t,n={hasESData:a.hasData.hasESData,hasUserDataView:a.hasData.hasUserDataView};return Object(x.jsx)(vv.Provider,{value:n},Object(x.jsx)(fv,t,Object(x.jsx)(lv,t,e)))};var xv={name:"y1f223",styles:"margin:auto"},yv={name:"y1f223",styles:"margin:auto"};const jv=({onDataViewCreated:e,noDataConfig:t,allowAdHocDataView:a,showPlainSpinner:n})=>{const i=function(){const e=Object(s.useContext)(vv);if(!e)throw new Error("KibanaNoDataPageContext is missing.  Ensure your component or React root is wrapped with KibanaNoDataPageContext.");return e}(),{hasESData:l,hasUserDataView:r}=i,[o,u]=Object(s.useState)(!0),[c,d]=Object(s.useState)(!1),[p,m]=Object(s.useState)(!1);return Object(s.useEffect)((()=>{(async()=>{d(await l()),m(await r()),u(!1)})().catch((()=>{u(!1)}))}),[l,r]),o?n?Object(x.jsx)(b.EuiLoadingSpinner,{css:xv,size:"xxl"}):Object(x.jsx)(b.EuiLoadingElastic,{css:yv,size:"xxl"}):!p&&c?Object(x.jsx)(bv,{onDataViewCreated:e,allowAdHocDataView:a}):c?null:Object(x.jsx)(cv,{noDataConfig:t})},Ov=l.a.createContext(null),Iv=({children:e,...t})=>{var a,n;const i={kibanaGuideDocLink:t.coreStart.docLinks.links.kibana.guide,customBranding:{hasCustomBranding$:t.coreStart.customBranding.hasCustomBranding$},prependBasePath:t.coreStart.http.basePath.prepend,pageFlavor:null!==(a=null===(n=t.noDataPage)||void 0===n?void 0:n.getAnalyticsNoDataPageFlavor())&&void 0!==a?a:"kibana"};return Object(x.jsx)(Ov.Provider,{value:i},Object(x.jsx)(hv,t,e))},kv={kibana:({kibanaGuideDocLink:e})=>({solution:u.i18n.translate("sharedUXPackages.noDataConfig.analytics",{defaultMessage:"Analytics"}),pageTitle:u.i18n.translate("sharedUXPackages.noDataConfig.analyticsPageTitle",{defaultMessage:"Welcome to Analytics!"}),logo:"logoKibana",action:{elasticAgent:{title:u.i18n.translate("sharedUXPackages.noDataConfig.addIntegrationsTitle",{defaultMessage:"Add integrations"}),description:u.i18n.translate("sharedUXPackages.noDataConfig.addIntegrationsDescription",{defaultMessage:"Use Elastic Agent to collect data and build out Analytics solutions."}),"data-test-subj":"kbnOverviewAddIntegrations"}},docsLink:e}),serverless_search:({prependBasePath:e})=>({solution:u.i18n.translate("sharedUXPackages.noDataConfig.elasticsearch",{defaultMessage:"Elasticsearch"}),pageTitle:u.i18n.translate("sharedUXPackages.noDataConfig.elasticsearchPageTitle",{defaultMessage:"Welcome to Elasticsearch!"}),logo:"logoElasticsearch",action:{elasticsearch:{title:u.i18n.translate("sharedUXPackages.noDataConfig.elasticsearchTitle",{defaultMessage:"Get started"}),description:u.i18n.translate("sharedUXPackages.noDataConfig.elasticsearchDescription",{defaultMessage:"Set up your programming language client, ingest some data, and start searching."}),"data-test-subj":"kbnOverviewElasticsearchGettingStarted",href:e("/app/elasticsearch/"),canAccessFleet:!0}}}),serverless_observability:({prependBasePath:e})=>({solution:u.i18n.translate("sharedUXPackages.noDataConfig.observability",{defaultMessage:"Observability"}),pageTitle:u.i18n.translate("sharedUXPackages.noDataConfig.observabilityPageTitle",{defaultMessage:"Welcome to Elastic Observability!"}),pageDescription:u.i18n.translate("sharedUXPackages.noDataConfig.observabilityPageDescription",{defaultMessage:"Converge metrics, logs, and traces to monitor the health of your applications."}),logo:"logoObservability",action:{observability:{title:u.i18n.translate("sharedUXPackages.noDataConfig.observabilityTitle",{defaultMessage:"Add data"}),description:u.i18n.translate("sharedUXPackages.noDataConfig.observabilityDescription",{defaultMessage:"Get started by collecting data using one of our many integrations."}),"data-test-subj":"kbnObservabilityNoData",href:e("/app/observabilityOnboarding/")}}})},Tv=({kibanaGuideDocLink:e,onDataViewCreated:t,allowAdHocDataView:a,showPlainSpinner:n,prependBasePath:i,pageFlavor:s="kibana"})=>{const l=kv[s]({kibanaGuideDocLink:e,prependBasePath:i});return Object(x.jsx)(jv,{noDataConfig:l,onDataViewCreated:t,allowAdHocDataView:a,showPlainSpinner:n})},Mv=({onDataViewCreated:e,allowAdHocDataView:t})=>{var a;const n=function(){const e=Object(s.useContext)(Ov);if(!e)throw new Error("AnalyticsNoDataPage Context is missing.  Ensure your component or React root is wrapped with AnalyticsNoDataPageContext.");return e}(),{kibanaGuideDocLink:i,customBranding:l,prependBasePath:r,pageFlavor:o}=n,{hasCustomBranding$:u}=l,c=null!==(a=w()(u))&&void 0!==a&&a;return Object(x.jsx)(Tv,{onDataViewCreated:e,allowAdHocDataView:t,kibanaGuideDocLink:i,showPlainSpinner:c,prependBasePath:r,pageFlavor:o})};a(482);var wv=a(19),Cv=a(105);const Ev=document.createElement("div");let Sv=!1;function Fv({anchorElement:e,isOpen:t,onClose:a}){const n=Object(Cl.W)(Cl.t),i=Object(Cl.V)(),l=Object(s.useCallback)((()=>{a(),Object(Ap.c)(new ks.Storage(localStorage),Cv.a,String(n)),i(n?Object(Cl.d)():Object(Cl.f)())}),[i,n,a]);return Object(x.jsx)(b.EuiWrappingPopover,{"data-test-subj":"lnsApp__settingsMenu",ownFocus:!0,button:e,closePopover:a,isOpen:!0},Object(x.jsx)(b.EuiPopoverTitle,null,Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.settings.title",defaultMessage:"Lens settings"})),Object(x.jsx)(b.EuiSwitch,{label:u.i18n.translate("xpack.lens.settings.autoApply",{defaultMessage:"Auto-apply visualization changes"}),checked:n,onChange:()=>l(),"data-test-subj":"lnsToggleAutoApply"}))}function Pv(){o.a.unmountComponentAtNode(Ev),document.body.removeChild(Ev),Sv=!1}const _v={width:1793,height:1086};function Av({application:e,data:t},a){return new URL(`${e.getUrlForApp("lens",{absolute:!0})}${null!=a&&a.savedObjectId?Object(It.getEditPath)(null==a?void 0:a.savedObjectId,t.query.timefilter.timefilter.getTime(),t.query.filterManager.getGlobalFilters(),t.query.timefilter.timefilter.getRefreshInterval()):""}`)}const Lv=({setHeaderActionMenu:e,initialInput:t,indicateNoData:a,lensInspector:n,setIsSaveModalVisible:r,getIsByValueMode:p,runSave:m,onAppLeave:g,redirectToOrigin:f,datasourceMap:b,visualizationMap:v,title:h,goBackToOriginatingApp:y,contextOriginatingApp:j,initialContextIsEmbedded:O,topNavMenuEntryGenerators:I,initialContext:k,theme$:T,indexPatternService:M,currentDoc:w,onTextBasedSavedAndExit:C,getUserMessages:E,shortUrlService:S,isCurrentStateDirty:F})=>{var P,_;const{data:A,navigation:L,uiSettings:D,application:R,attributeService:B,share:N,dashboardFeatureFlag:z,dataViewFieldEditor:V,dataViewEditor:G,dataViews:q}=Object(d.useKibana)().services,{isSaveable:H,isLinkedToOriginatingApp:U,query:$,activeData:W,savedQuery:X,activeDatasourceId:Y,datasourceStates:Q,visualization:K,filters:Z,dataViews:J}=Object(Cl.W)((e=>e.lens)),ee=Object(Cl.V)(),te=l.a.useCallback((e=>ee(Object(Cl.N)(e))),[ee]),[ae,ne]=Object(s.useState)([]),[ie,se]=Object(s.useState)(),[le,re]=Object(s.useState)(!1),[oe,ue]=Object(s.useState)([]),ce=l.a.useCallback((async e=>{const t="string"==typeof e?e:e.id,a=await M.ensureIndexPattern({id:t,cache:J.indexPatterns});ee(Object(Dl.a)({dataViews:{indexPatterns:a},datasourceIds:Object.keys(Q),visualizationIds:K.activeId?[K.activeId]:[],indexPatternId:t}))}),[J.indexPatterns,Q,ee,M,K.activeId]),de=Boolean(null==G?void 0:G.userPermissions.editDataView())||!(null!=ie&&ie.isPersisted()),pe=Object(s.useRef)(),me=Object(s.useRef)(),ge=Object.values(Q).every((({isLoading:e})=>!1===e));Object(s.useEffect)((()=>{if(!(b&&Y&&!Q[Y].isLoading?b[Y]:void 0))return;const e=new Set(Object(st.getIndexPatternsIds)({activeDatasources:Object.keys(Q).reduce(((e,t)=>({...e,[t]:b[t]})),{}),datasourceStates:Q,visualizationState:K.state,activeVisualization:K.activeId?v[K.activeId]:void 0}));Object.values(J.indexPatterns).filter((e=>!e.isPersisted)).forEach((t=>{e.add(t.id)})),(ae.length+oe.length!==e.size||[...e].some((e=>![...ae.map((e=>e.id)),...oe].find((t=>t===e)))))&&Object(st.getIndexPatternsObjects)([...e],q).then((({indexPatterns:e,rejectedIds:t})=>{ne(e),ue(t)}))}),[Q,Y,oe,b,v,K,ae,q,J]),Object(s.useEffect)((()=>{(async()=>{if(Y&&Q[Y].state){const e=b[Y].getUsedDataView(Q[Y].state),t=e?await A.dataViews.get(e):void 0;se(null!=t?t:ae[0])}})()}),[Y,b,Q,ae,A.dataViews,le]),Object(s.useEffect)((()=>{"object"==typeof $&&null!==$&&Object(El.isOfAggregateQueryType)($)&&re(!0)}),[$]),Object(s.useEffect)((()=>()=>{var e,t;null===(e=pe.current)||void 0===e||e.call(pe),null===(t=me.current)||void 0===t||t.call(me)}),[]);const{AggregateQueryTopNavMenu:fe}=L.ui,{from:be,to:ve}=A.query.timefilter.timefilter.getTime(),he=Boolean(H&&R.capabilities.visualize.save),xe=Boolean(H&&(null===(P=R.capabilities.dashboard)||void 0===P?void 0:P.showWriteControls)),ye=u.i18n.translate("xpack.lens.app.share.defaultDashboardTitle",{defaultMessage:"Lens Visualization [{date}]",values:{date:Un()().toISOString(!0)}}),je=Object(s.useMemo)((()=>{if(!K.activeId)return;const e=K.activeId,t=I.flatMap((t=>{const a=t({datasourceStates:Q,visualizationId:e,visualizationState:K.state,query:$,filters:Z,initialContext:k,currentDoc:w});return a?[a]:[]}));return t.length>0?t:void 0}),[Q,I,K.activeId,K.state,$,Z,k,w]),Oe=null==N?void 0:N.url.locators.get("DISCOVER_APP_LOCATOR"),Ie=Object(s.useMemo)((()=>{if(Y&&Oe&&null!=K.activeId)return vf(b[Y],Q[Y].state,v[K.activeId],K.state,W,J.indexPatterns,A.query.timefilter.timefilter.getTime(),R.capabilities)}),[Y,Oe,K,b,Q,v,W,J.indexPatterns,A.query.timefilter.timefilter,R.capabilities]),ke=Object(aa.useStore)(),Te=ae.filter((e=>!e.isPersisted())),Me=Object(s.useMemo)((()=>{const e="dashboards"===(null==k?void 0:k.originatingApp)&&!(null!=t&&t.savedObjectId),a="canvas"===(null==k?void 0:k.originatingApp)&&!(null!=t&&t.savedObjectId),s=k&&"isEmbeddable"in k&&k.isEmbeddable,l=!(e||a)&&(Boolean(U&&(z.allowByValueEmbeddables||Boolean(t)))||Boolean(O)),I=Boolean(W&&Object.keys(W).length),M=Boolean(H&&I),C=Boolean(R.capabilities.visualize.createShortUrl&&I),E=M||C,P=function(e){const{actions:t,allowByValue:a,savingToLibraryPermitted:n,savingToDashboardPermitted:i,contextOriginatingApp:s,showReplaceInDashboard:l,showReplaceInCanvas:r,contextFromEmbeddable:o,isByValueMode:c}=e,d=[],p=t.saveAndReturn.visible,m=n||a&&i&&!c&&!p,g=c?u.i18n.translate("xpack.lens.app.addToLibrary",{defaultMessage:"Save to library"}):t.saveAndReturn.visible?u.i18n.translate("xpack.lens.app.saveAs",{defaultMessage:"Save as"}):u.i18n.translate("xpack.lens.app.save",{defaultMessage:"Save"});if(s&&!t.cancel.visible&&d.push({label:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:s}}),run:t.goBack.execute,className:"lnsNavItem__withDivider",testId:"lnsApp_goBackToAppButton",description:u.i18n.translate("xpack.lens.app.goBackLabel",{defaultMessage:"Go back to {contextOriginatingApp}",values:{contextOriginatingApp:s}}),disableButton:!t.goBack.enabled}),t.getUnderlyingDataUrl.visible){var f,b;const e=u.i18n.translate("xpack.lens.app.exploreDataInDiscover",{defaultMessage:"Explore data in Discover"});d.push({label:e,run:t.getUnderlyingDataUrl.execute,testId:"lnsApp_openInDiscover",className:"lnsNavItem__withDivider",description:e,disableButton:!t.getUnderlyingDataUrl.enabled,tooltip:t.getUnderlyingDataUrl.tooltip,target:"_blank",href:null===(f=(b=t.getUnderlyingDataUrl).getLink)||void 0===f?void 0:f.call(b)})}d.push({label:u.i18n.translate("xpack.lens.app.inspect",{defaultMessage:"Inspect"}),run:t.inspect.execute,testId:"lnsApp_inspectButton",description:u.i18n.translate("xpack.lens.app.inspectAriaLabel",{defaultMessage:"inspect"}),disableButton:!1}),t.share.visible&&d.push({label:u.i18n.translate("xpack.lens.app.shareTitle",{defaultMessage:"Share"}),run:t.share.execute,testId:"lnsApp_shareButton",description:u.i18n.translate("xpack.lens.app.shareTitleAria",{defaultMessage:"Share visualization"}),disableButton:!t.share.enabled,tooltip:t.share.tooltip}),d.push({label:u.i18n.translate("xpack.lens.app.settings",{defaultMessage:"Settings"}),run:t.openSettings.execute,className:"lnsNavItem__withDivider",testId:"lnsApp_settingsButton",description:u.i18n.translate("xpack.lens.app.settingsAriaLabel",{defaultMessage:"Open the Lens settings menu"})}),t.cancel.visible&&d.push({label:u.i18n.translate("xpack.lens.app.cancel",{defaultMessage:"Cancel"}),run:t.cancel.execute,testId:"lnsApp_cancelButton",description:u.i18n.translate("xpack.lens.app.cancelButtonAriaLabel",{defaultMessage:"Return to the last app without saving changes"})}),d.push({label:g,iconType:l||r||p?void 0:"save",emphasize:!l&&!r&&!p,run:t.showSaveModal.execute,testId:"lnsApp_saveButton",description:u.i18n.translate("xpack.lens.app.saveButtonAriaLabel",{defaultMessage:"Save the current lens visualization"}),disableButton:!m});const v=function({contextFromEmbeddable:e,showSaveAndReturn:t,showReplaceInDashboard:a,showReplaceInCanvas:n}){return t?{label:e?u.i18n.translate("xpack.lens.app.saveAndReplace",{defaultMessage:"Save and replace"}):u.i18n.translate("xpack.lens.app.saveAndReturn",{defaultMessage:"Save and return"}),emphasize:!0,iconType:e?"save":"checkInCircleFilled",testId:"lnsApp_saveAndReturnButton",description:u.i18n.translate("xpack.lens.app.saveAndReturnButtonAriaLabel",{defaultMessage:"Save the current lens visualization and return to the last app"})}:a?{label:u.i18n.translate("xpack.lens.app.replaceInDashboard",{defaultMessage:"Replace in dashboard"}),emphasize:!0,iconType:"merge",testId:"lnsApp_replaceInDashboardButton",description:u.i18n.translate("xpack.lens.app.replaceInDashboardButtonAriaLabel",{defaultMessage:"Replace legacy visualization with lens visualization and return to the dashboard"})}:n?{label:u.i18n.translate("xpack.lens.app.replaceInCanvas",{defaultMessage:"Replace in canvas"}),emphasize:!0,iconType:"merge",testId:"lnsApp_replaceInCanvasButton",description:u.i18n.translate("xpack.lens.app.replaceInCanvasButtonAriaLabel",{defaultMessage:"Replace legacy visualization with lens visualization and return to the canvas"})}:void 0}({showSaveAndReturn:p,showReplaceInDashboard:l,showReplaceInCanvas:r,contextFromEmbeddable:o});return v&&d.push({...v,run:t.saveAndReturn.execute,disableButton:!t.saveAndReturn.enabled}),d}({isByValueMode:p(),allowByValue:z.allowByValueEmbeddables,savingToLibraryPermitted:he,savingToDashboardPermitted:xe,isSaveable:H,contextOriginatingApp:j,showReplaceInDashboard:e,showReplaceInCanvas:a,contextFromEmbeddable:s,actions:{inspect:{visible:!0,execute:()=>n.inspect({title:h})},share:{visible:!0,enabled:E,tooltip:()=>{if(!E)return u.i18n.translate("xpack.lens.app.shareButtonDisabledWarning",{defaultMessage:"The visualization has no data to share."})},execute:async e=>{var t,a,n;if(!N)return;if(null==K.activeId||!v[K.activeId])return;const{shareableUrl:i,savedObjectURL:s,reportingLocatorParams:l}=await async function(e,t,a,n,i){const{shareURL:s,reporting:l}=function(e,{filters:t,query:a,activeDatasourceId:n,datasourceStates:i,datasourceMap:s,visualizationMap:l,visualization:r,adHocDataViews:o,currentDoc:u},c){const d=Object(st.extractReferencesFromState)({activeDatasources:Object.keys(i).reduce(((e,t)=>({...e,[t]:s[t]})),{}),datasourceStates:i,visualizationState:r.state,activeVisualization:r.activeId?l[r.activeId]:void 0}),p=r,m=i,g={filters:t,query:a,resolvedDateRange:Object(st.getResolvedDateRange)(e.query.timefilter.timefilter),visualization:p,datasourceStates:m,activeDatasourceId:n,searchSessionId:e.search.session.getSessionId(),references:d,dataViewSpecs:o};return{shareURL:g,reporting:null!=u&&u.savedObjectId&&!c?{filters:t,query:a,resolvedDateRange:Object(st.getResolvedDateRange)(e.query.timefilter.timefilter),savedObjectId:null==u?void 0:u.savedObjectId}:g}}(t.data,a,i);return{shareableUrl:await(n?e(s):void 0),savedObjectURL:Av(t,a.currentDoc),reportingLocatorParams:l}}(S,{application:R,data:A},{filters:Z,query:$,activeDatasourceId:Y,datasourceStates:Q,datasourceMap:b,visualizationMap:v,visualization:K,currentDoc:w,adHocDataViews:Te.map((e=>e.toSpec()))},C,F),r={activeData:W,csvEnabled:M,reportingDisabled:!M,title:h||ye,locatorParams:{id:wv.a,params:l},layout:{dimensions:null!==(t=null===(a=(n=v[K.activeId]).getReportingLayout)||void 0===a?void 0:a.call(n,K.state))&&void 0!==t?t:_v}};N.toggleShareContextMenu({anchorElement:e,allowEmbed:!1,allowShortUrl:!1,shareableUrl:i||"",shareableUrlForSavedObject:s.href,objectId:null==w?void 0:w.savedObjectId,objectType:"lens",objectTypeTitle:u.i18n.translate("xpack.lens.app.share.panelTitle",{defaultMessage:"visualization"}),sharingData:r,isDirty:F,disabledShareUrl:Boolean(!(C||null!=w&&w.savedObjectId)),showPublicUrlSwitch:()=>!1,onClose:()=>{null==e||e.focus()}})}},saveAndReturn:{visible:l,enabled:H,execute:()=>{var e;H&&(g((e=>e.default())),m({newTitle:h||(s?u.i18n.translate("xpack.lens.app.convertedLabel",{defaultMessage:"{title} (converted)",values:{title:k.title||`${k.visTypeTitle} visualization`}}):""),newCopyOnSave:!1,isTitleDuplicateConfirmed:!1,returnToOrigin:!0,...s&&{newDescription:k.description},panelTimeRange:s?k.panelTimeRange:void 0},{saveToLibrary:null!==(e=t&&B.inputIsRefType(t))&&void 0!==e&&e}))}},showSaveModal:{visible:Boolean(xe||he),execute:()=>{(xe||he)&&r(!0)}},goBack:{visible:Boolean(j),enabled:Boolean(j),execute:()=>{j&&(null==y||y())}},cancel:{visible:Boolean(U),execute:()=>{f&&f()}},getUnderlyingDataUrl:{visible:Boolean(null==Ie?void 0:Ie.isVisible),enabled:!(null!=Ie&&Ie.error),tooltip:()=>null==Ie?void 0:Ie.error,execute:()=>{},getLink:()=>{var e;if(!Ie)return;const{error:t,meta:a}=Ie;if(t||!Oe||!a)return;const{filters:n,query:i}=hf($,Z,a,ae,Object(is.getEsQueryConfig)(D));return Oe.getRedirectUrl({dataViewSpec:null===(e=J.indexPatterns[a.id])||void 0===e?void 0:e.spec,timeRange:A.query.timefilter.timefilter.getTime(),filters:n,query:le?$:i,columns:a.columns})}},openSettings:{visible:!0,execute:e=>function(e){if(Sv)return void Pv();Sv=!0,document.body.appendChild(Ev);const t=Object(x.jsx)(aa.Provider,{store:e.lensStore},Object(x.jsx)(d.KibanaThemeProvider,{theme$:e.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(Fv,i()({},e,{isOpen:Sv,onClose:Pv})))));o.a.render(t,Ev)}({lensStore:ke,anchorElement:e,theme$:T})}}});return[...je||[],...P]}),[k,t,U,z.allowByValueEmbeddables,O,W,H,R,p,he,xe,j,Ie,je,n,h,N,S,A,Z,$,Y,Q,b,v,K,w,Te,ye,F,g,m,B,r,y,f,Oe,ae,D,J.indexPatterns,le,ke,T]),we=Object(s.useCallback)((e=>{const{dateRange:t,query:a}=e,n=A.query.timefilter.timefilter.getTime();t.from!==n.from||t.to!==n.to?A.query.timefilter.timefilter.setTime(t):te({searchSessionId:A.search.session.start(),resolvedDateRange:Object(st.getResolvedDateRange)(A.query.timefilter.timefilter)}),a&&(Object(qt.isEqual)(a,$)||(te({query:a}),Object(El.isOfAggregateQueryType)(a)&&!le&&(re(!0),ee(Object(Cl.Q)({newDatasourceId:"textBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:null==ie?void 0:ie.id})))))}),[null==ie?void 0:ie.id,A.query.timefilter.timefilter,A.search.session,ee,te,le,$,null==K?void 0:K.activeId]),Ce=Object(s.useCallback)((e=>{te({savedQuery:e})}),[te]),Ee=Object(s.useCallback)((e=>{const t=e.attributes.filters||[],a=A.query.filterManager.getGlobalFilters();A.query.filterManager.setFilters([...a,...t]),te({query:e.attributes.query,savedQuery:{...e}})}),[A.query.filterManager,te]),Se=Object(s.useCallback)((()=>{A.query.filterManager.setFilters(A.query.filterManager.getGlobalFilters()),te({filters:A.query.filterManager.getGlobalFilters(),query:A.query.queryString.getDefaultQuery(),savedQuery:void 0})}),[A.query.filterManager,A.query.queryString,te]),Fe=Object(s.useCallback)((async()=>{null!=ie&&ie.id&&Object(st.refreshIndexPatternsList)({activeDatasources:Object.keys(Q).reduce(((e,t)=>({...e,[t]:b[t]})),{}),indexPatternId:ie.id,indexPatternService:M,indexPatternsCache:J.indexPatterns}),A.search.session.start()}),[ie,A.search.session,b,Q,M,J.indexPatterns]),Pe=Object(s.useMemo)((()=>de?async(e,t="edit")=>{if(null!=ie&&ie.id){const t=await A.dataViews.get(null==ie?void 0:ie.id);pe.current=V.openEditor({ctx:{dataView:t},fieldName:e,onSave:()=>{t.isPersisted()?Fe():M.replaceDataViewId(t)}})}}:void 0),[de,null==ie?void 0:ie.id,A.dataViews,V,M,Fe]),_e=Object(s.useMemo)((()=>de&&Pe?()=>Pe(void 0,"add"):void 0),[Pe,de]),Ae=Object(s.useCallback)((()=>{me.current=G.openEditor({onSave:async e=>{e.id&&(le&&ee(Object(Cl.Q)({newDatasourceId:"formBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:null==e?void 0:e.id})),ce(e),se(e))},allowAdHocDataView:!0})}),[G,ee,ce,le,null==K?void 0:K.activeId]),Le=Object(s.useCallback)((async e=>{var t;const a=await q.create(e);"date"===(null===(t=a.fields.getByName("@timestamp"))||void 0===t?void 0:t.type)&&(a.timeFieldName="@timestamp"),le&&ee(Object(Cl.Q)({newDatasourceId:"formBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:null==a?void 0:a.id})),ce(a),se(a)}),[q,ee,ce,le,null==K?void 0:K.activeId]),De={trigger:{label:(null==ie||null===(_=ie.getName)||void 0===_?void 0:_.call(ie))||"","data-test-subj":"lns-dataView-switch-link",title:(null==ie?void 0:ie.title)||""},currentDataViewId:null==ie?void 0:ie.id,onAddField:_e,onDataViewCreated:Ae,onCreateDefaultAdHocDataView:Le,adHocDataViews:Te,onChangeDataView:async e=>{const t=await A.dataViews.get(e);se(t),ce(e),le&&(ee(Object(Cl.Q)({newDatasourceId:"formBased",visualizationId:null==K?void 0:K.activeId,currentIndexPatternId:e})),re(!1))},onEditDataView:async e=>{if(ie)if(ie.isPersisted()){q.clearInstanceCache(ie.id);const e=await q.get(ie.id),t={...J.indexPatterns};delete t[ie.id];const a=await M.ensureIndexPattern({id:e.id,cache:t});ee(Object(Dl.a)({dataViews:{indexPatterns:a},indexPatternId:e.id})),te({searchSessionId:A.search.session.start(),resolvedDateRange:Object(st.getResolvedDateRange)(A.query.timefilter.timefilter)}),se(e)}else M.replaceDataViewId(e)}},Re=E("textBasedLanguagesQueryInput",{severity:"error"}).map((({shortMessage:e})=>new Error(e)));return Object(x.jsx)(fe,{setMenuMountPoint:e,config:Me,saveQueryMenuVisibility:R.capabilities.visualize.saveQuery?"allowed_by_app_privilege":"globally_managed",savedQuery:X,onQuerySubmit:we,onSaved:Ce,onSavedQueryUpdated:Ee,onClearSavedQuery:Se,indexPatterns:ae,query:$,dateRangeFrom:be,dateRangeTo:ve,indicateNoData:a,showSearchBar:!0,dataViewPickerComponentProps:De,showDatePicker:ae.some((e=>e.isTimeBased()))||le||Boolean(ge&&Y&&b[Y].isTimeBased(Q[Y].state,J.indexPatterns)),textBasedLanguageModeErrors:Re,onTextBasedSavedAndExit:C,showFilterBar:!0,"data-test-subj":"lnsApp_topNav",screenTitle:"lens",appName:It.LENS_APP_NAME,displayStyle:"detached",className:"hide-for-sharing"})};var Dv=a(113);const Rv=e=>JSON.parse(JSON.stringify(e)),Bv=(e,t,a,n,i,s)=>{var l;if(void 0===e||void 0===t)return e===t;const r=Rv(e),o=Rv(t);if((null==r?void 0:r.visualizationType)!==(null==o?void 0:o.visualizationType))return!1;if(!Object(qt.isEqual)(r.state.query,o.state.query))return!1;const u=null===(l=i[r.visualizationType])||void 0===l?void 0:l.isEqual;if(!(u?(()=>{try{return u(r.state.visualization,r.references,o.state.visualization,o.references,s)}catch(e){return!1}})():Object(qt.isEqual)(r.state.visualization,o.state.visualization)))return!1;const c=Object.keys(r.state.datasourceStates),d=Object.keys(o.state.datasourceStates);let p=Object(qt.intersection)(c,d).length===Object(qt.union)(c,d).length;if(p&&(p=c.map((e=>n[e].isEqual(r.state.datasourceStates[e],[...r.references,...r.state.internalReferences||[]],o.state.datasourceStates[e],[...o.references,...o.state.internalReferences||[]]))).every((e=>e))),!p)return!1;const[m,g]=[r,o].map((e=>Object(Dv.removePinnedFilters)(function(e,t){var a;return t?{...t,state:{...t.state,filters:e((null===(a=t.state)||void 0===a?void 0:a.filters)||[],t.references)}}:void 0}(a,e))));return!!Object(qt.isEqual)(null==m?void 0:m.state.filters,null==g?void 0:g.state.filters)};function Nv({history:e,onAppLeave:t,redirectTo:a,editorFrame:n,initialInput:i,incomingState:r,redirectToOrigin:o,setHeaderActionMenu:c,datasourceMap:p,visualizationMap:m,contextOriginatingApp:g,topNavMenuEntryGenerators:f,initialContext:v,theme$:h,coreStart:y,savedObjectStore:j}){var O;const I=Object(d.useKibana)().services,{data:k,dataViews:T,uiActions:M,uiSettings:w,chrome:C,inspector:E,application:S,savedObjectsTagging:F,getOriginatingAppName:P,spaces:_,http:A,notifications:L,executionContext:D,dashboardFeatureFlag:R,locator:B,share:N,serverless:z}=I,V=Object(s.useRef)(),G=Object(Cl.V)(),q=Object(s.useCallback)((e=>G(Object(Cl.N)(e))),[G]),{persistedDoc:H,sharingSavedObjectProps:U,isLinkedToOriginatingApp:$,searchSessionId:W,datasourceStates:X,isLoading:Y,isSaveable:Q,visualization:K,annotationGroups:Z}=Object(Cl.W)((e=>e.lens)),J=Object(s.useMemo)((()=>({datasourceMap:p,visualizationMap:m,extractFilterReferences:k.query.filterManager.extract.bind(k.query.filterManager)})),[p,m,k.query.filterManager]),ee=Object(Cl.W)((e=>Object(Cl.E)(e,J))),te=Object(s.useMemo)((()=>null==N?void 0:N.url.shortUrls.get(null)),[N]),[ae,ne]=Object(s.useState)(!1),[ie,se]=Object(s.useState)(!1),[le,re]=Object(s.useState)(void 0),[oe,ue]=Object(s.useState)(void 0),[ce,de]=Object(s.useState)(!1),[pe,me]=Object(s.useState)(!1),ge=null==i?void 0:i.savedObjectId;Object(s.useEffect)((()=>{ee&&re(ee)}),[ee]);const fe=Object(s.useCallback)((()=>{ne(!0)}),[ne]);Object(d.useExecutionContext)(D,{type:"application",id:ge||"new",page:"editor"}),Object(s.useEffect)((()=>{ae&&ne(!1)}),[ne,ae,W]);const be=Object(s.useCallback)((()=>Boolean(R.allowByValueEmbeddables&&$&&!ge)),[R.allowByValueEmbeddables,$,ge]);Object(s.useEffect)((()=>{t((e=>S.capabilities.visualize.save&&!Bv(H,le,k.query.filterManager.inject.bind(k.query.filterManager),p,m,Z)&&(Q||H)?e.confirm(u.i18n.translate("xpack.lens.app.unsavedWorkMessage",{defaultMessage:"Leave with unsaved changes?"}),u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),void 0,u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),"danger"):e.default()))}),[t,le,Q,H,S.capabilities.visualize.save,k.query.filterManager,p,m,Z]);const ve=Object(s.useCallback)((()=>{if(_&&"conflict"===(null==U?void 0:U.outcome)&&null!=H&&H.savedObjectId){const t=H.savedObjectId,a=null==U?void 0:U.aliasTargetId,n=A.basePath.prepend(`${Object(It.getEditPath)(a)}${e.location.search}`);return _.ui.components.getLegacyUrlConflict({objectNoun:u.i18n.translate("xpack.lens.appName",{defaultMessage:"Lens visualization"}),currentObjectId:t,otherObjectId:a,otherObjectPath:n})}return null}),[H,U,_,A,e]);Object(s.useEffect)((()=>{const e=be(),t=v&&"originatingApp"in v&&v.originatingApp,a=[];($||t)&&P()&&o&&a.push({onClick:()=>{o()},text:P()}),e||a.push({href:S.getUrlForApp("visualize"),onClick:e=>{S.navigateToApp("visualize",{path:"/"}),e.preventDefault()},text:u.i18n.translate("xpack.lens.breadcrumbsTitle",{defaultMessage:"Visualize Library"})});let n=u.i18n.translate("xpack.lens.breadcrumbsCreate",{defaultMessage:"Create"});H&&(n=e?u.i18n.translate("xpack.lens.breadcrumbsByValue",{defaultMessage:"Edit visualization"}):H.title),(null==H||!H.title)&&v&&"isEmbeddable"in v&&v.isEmbeddable&&(n=u.i18n.translate("xpack.lens.breadcrumbsEditInLensFromDashboard",{defaultMessage:"Converting {title} visualization",values:{title:v.title?`"${v.title}"`:v.visTypeTitle}}));const i={text:n};a.push(i),null!=z&&z.setBreadcrumbs?z.setBreadcrumbs(i):C.setBreadcrumbs(a)}),[R.allowByValueEmbeddables,P,o,be,S,C,$,H,v,z]);const he=Object(s.useCallback)((()=>{V&&V.current&&V.current()}),[]),xe=Object(s.useCallback)(((e,n)=>(G(Object(Cl.b)()),Object(Dv.runSaveLensVisualization)({lastKnownDoc:le,getIsByValueMode:be,savedObjectsTagging:F,initialInput:i,redirectToOrigin:o,persistedDoc:H,onAppLeave:t,redirectTo:a,switchDatasource:he,originatingApp:null==r?void 0:r.originatingApp,textBasedLanguageSave:pe,...I},e,n).then((e=>{e&&(q(e),se(!1),me(!1))}),(()=>{})))),[G,le,be,F,i,o,H,t,a,he,null==r?void 0:r.originatingApp,pe,I,q]);Object(s.useEffect)((()=>{le&&!oe&&ue(le)}),[le,oe]);const ye=Object(s.useCallback)((()=>{if(v&&"vizEditorOriginatingAppUrl"in v&&v.vizEditorOriginatingAppUrl){const[e,a]=[oe,H].map((e=>Bv(e,le,k.query.filterManager.inject,p,m,Z)));e||a?(t((e=>e.default())),S.navigateToApp("visualize",{path:v.vizEditorOriginatingAppUrl})):de(!0)}}),[Z,S,k.query.filterManager.inject,p,v,oe,le,t,H,m]),je=Object(s.useCallback)((()=>{de(!1),v&&"vizEditorOriginatingAppUrl"in v&&v.vizEditorOriginatingAppUrl&&(t((e=>e.default())),S.navigateToApp("visualize",{path:v.vizEditorOriginatingAppUrl}))}),[S,v,t]),Oe=Object(s.useMemo)((()=>Boolean(v&&"originatingApp"in v&&v.originatingApp)),[v]),Ie=Object(s.useMemo)((()=>Ll({dataViews:T,uiActions:M,core:{http:A,notifications:L,uiSettings:w},contextDataViewSpec:null==v?void 0:v.dataViewSpec,updateIndexPatterns:(e,t)=>{G(Object(Cl.T)(e)),null!=t&&t.applyImmediately&&G(Object(Cl.b)())},replaceIndexPattern:(e,t,a)=>{G(Object(Dl.i)({newIndexPattern:e,oldId:t})),null!=a&&a.applyImmediately&&G(Object(Cl.b)())}})),[T,M,A,L,w,v,G]),ke=Object(s.useCallback)((async({onSave:e,onCancel:t})=>{se(!0),me(!0),V.current=()=>{e()}}),[]),Te=Object(s.useRef)({params:"",url:""}),Me=Object(s.useCallback)((async e=>{const t=JSON.stringify(e);if(Te.current.params===t)return Te.current.url;if(B&&te){const a=await te.createWithLocator({locator:B,params:e}),n=await a.locator.getUrl(a.params,{absolute:!0});return Te.current={params:t,url:n},n}return""}),[B,te]),we=v&&"isEmbeddable"in v&&v.isEmbeddable&&!H?u.i18n.translate("xpack.lens.app.replacePanel",{defaultMessage:"Replace panel on {originatingApp}",values:{originatingApp:null==v?void 0:v.originatingApp}}):void 0,Ce=Object(Cl.W)(Cl.r),Ee=Object(Cl.W)((e=>Object(Cl.B)(e,p))),{getUserMessages:Se,addUserMessages:Fe}=Object(Wl.c)({coreStart:y,framePublicAPI:Ee,activeDatasourceId:Ce,datasourceState:Ce&&X[Ce]?X[Ce]:null,datasource:Ce&&p[Ce]?p[Ce]:null,dispatch:G,visualization:K.activeId?m[K.activeId]:void 0,visualizationType:K.activeId,visualizationState:K});return Object(x.jsx)(l.a.Fragment,null,Object(x.jsx)("div",{className:"lnsApp","data-test-subj":"lnsApp",role:"main"},Object(x.jsx)(Lv,{initialInput:i,redirectToOrigin:o,getIsByValueMode:be,onAppLeave:t,runSave:xe,setIsSaveModalVisible:se,setHeaderActionMenu:c,indicateNoData:ae,datasourceMap:p,visualizationMap:m,title:null==H?void 0:H.title,lensInspector:E,currentDoc:ee,isCurrentStateDirty:!Bv(H,le,k.query.filterManager.inject.bind(k.query.filterManager),p,m,Z),goBackToOriginatingApp:ye,contextOriginatingApp:g,initialContextIsEmbedded:Oe,topNavMenuEntryGenerators:f,initialContext:v,theme$:h,indexPatternService:Ie,onTextBasedSavedAndExit:ke,getUserMessages:Se,shortUrlService:Me}),ve(),(!Y||H)&&Object(x.jsx)(zv,{editorFrame:n,showNoDataPopover:fe,lensInspector:E,indexPatternService:Ie,getUserMessages:Se,addUserMessages:Fe})),ie&&Object(x.jsx)(Dv.SaveModalContainer,{lensServices:I,originatingApp:$?null!==(O=null==r?void 0:r.originatingApp)&&void 0!==O?O:null==v?void 0:v.originatingApp:void 0,isSaveable:Q,runSave:xe,onClose:()=>{se(!1)},getAppNameFromId:()=>P(),lastKnownDoc:le,onAppLeave:t,persistedDoc:H,initialInput:i,redirectTo:a,redirectToOrigin:o,initialContext:v,returnToOriginSwitchLabel:null!=we?we:be()&&i?u.i18n.translate("xpack.lens.app.updatePanel",{defaultMessage:"Update panel on {originatingAppName}",values:{originatingAppName:P()}}):void 0}),ce&&Object(x.jsx)(b.EuiConfirmModal,{maxWidth:600,title:u.i18n.translate("xpack.lens.app.unsavedWorkTitle",{defaultMessage:"Unsaved changes"}),onCancel:()=>de(!1),onConfirm:je,cancelButtonText:u.i18n.translate("xpack.lens.app.goBackModalCancelBtn",{defaultMessage:"Cancel"}),confirmButtonText:u.i18n.translate("xpack.lens.app.unsavedWorkConfirmBtn",{defaultMessage:"Discard changes"}),buttonColor:"danger",defaultFocusedButton:"confirm","data-test-subj":"lnsApp_discardChangesModalOrigin"},u.i18n.translate("xpack.lens.app.goBackModalMessage",{defaultMessage:"Your changes here won’t work with your original {contextOriginatingApp} visualization. Leave with unsaved changes and return to {contextOriginatingApp}?",values:{contextOriginatingApp:g}})))}const zv=l.a.memo((function({editorFrame:e,showNoDataPopover:t,getUserMessages:a,addUserMessages:n,lensInspector:i,indexPatternService:s}){const{EditorFrameContainer:l}=e;return Object(x.jsx)(l,{showNoDataPopover:t,getUserMessages:a,addUserMessages:n,lensInspector:i,indexPatternService:s})}));async function Vv(e,t,a,n,i){const{data:s,inspector:l,navigation:r,embeddable:o,eventAnnotation:u,savedObjectsTagging:c,usageCollection:d,fieldFormats:p,spaces:m,share:g,unifiedSearch:f,serverless:b,contentManagement:v}=t,h=new ks.Storage(localStorage),x=null==o?void 0:o.getStateTransfer(),y=null==x?void 0:x.getIncomingEditorState(It.APP_ID),j=await u.getService();return{data:s,storage:h,inspector:Sb(l),navigation:r,contentManagement:v,fieldFormats:p,stateTransfer:x,usageCollection:d,savedObjectsTagging:c,attributeService:a,eventAnnotationService:j,executionContext:e.executionContext,http:e.http,uiActions:t.uiActions,chrome:e.chrome,overlays:e.overlays,uiSettings:e.uiSettings,settings:e.settings,application:e.application,notifications:e.notifications,savedObjectStore:new Ql.a(t.contentManagement),presentationUtil:t.presentationUtil,dataViewEditor:t.dataViewEditor,dataViewFieldEditor:t.dataViewFieldEditor,dashboard:t.dashboard,charts:t.charts,getOriginatingAppName:()=>{var e;const t=null!==(e=null==y?void 0:y.originatingApp)&&void 0!==e?e:null==n?void 0:n.originatingApp;return t?null==x?void 0:x.getAppNameFromId(t):void 0},dataViews:t.dataViews,dashboardFeatureFlag:t.dashboard.dashboardFeatureFlagConfig,spaces:m,share:g,unifiedSearch:f,docLinks:e.docLinks,locator:i,serverless:b}}async function Gv(e,t,a){const{createEditorFrame:n,attributeService:o,getPresentationUtilContext:p,topNavMenuEntryGenerators:m,locator:g}=a,[[f,v],h]=await Promise.all([e.getStartServices(),n()]),{contextType:y,initialContext:j,initialStateFromLocator:O,originatingApp:I}=function(e){const t=e.location.state;if(t){if(t.type===wv.b)return{contextType:t.type,initialStateFromLocator:t.payload};if([Ig.ACTION_VISUALIZE_LENS_FIELD,N.ACTION_CONVERT_TO_LENS].includes(t.type))return{contextType:t.type,initialContext:t.payload,originatingApp:t.originatingApp}}}(t.history)||{},k=await Vv(f,v,o,j,g),{stateTransfer:T,data:M,savedObjectStore:w}=k,C=null==T?void 0:T.getIncomingEditorState(It.APP_ID);var E,S;E=f.chrome,S=f.docLinks,E.setHelpExtension({appName:"Lens",links:[{linkType:"documentation",href:S.links.visualize.lensPanels},{linkType:"github",title:"[Lens]",labels:["Feature:Lens"]}]}),k.application.capabilities.visualize.save||f.chrome.setBadge({text:u.i18n.translate("xpack.lens.badge.readOnly.text",{defaultMessage:"Read only"}),tooltip:u.i18n.translate("xpack.lens.badge.readOnly.tooltip",{defaultMessage:"Unable to save visualizations to the library"}),iconType:"glasses"}),f.chrome.docTitle.change(u.i18n.translate("xpack.lens.pageTitle",{defaultMessage:"Lens"}));const F=e=>{var t;const a=j&&"originatingApp"in j?j.originatingApp:null,n=null!==(t=null==C?void 0:C.originatingApp)&&void 0!==t?t:a;if(!n)throw new Error("redirectToOrigin called without an originating app");let i=null==C?void 0:C.embeddableId;if(j&&"embeddableId"in j&&(i=j.embeddableId),T&&null!=e&&e.input){const{input:t,isCopied:a}=e;T.navigateToWithEmbeddablePackage(n,{path:null==C?void 0:C.originatingPath,state:{embeddableId:a?void 0:i,type:It.LENS_EMBEDDABLE_TYPE,input:t,searchSessionId:M.search.session.getSessionId()}})}else f.application.navigateToApp(n,{path:null==C?void 0:C.originatingPath})};y===Ig.ACTION_VISUALIZE_LENS_FIELD&&null!=j&&j.originatingApp&&delete j.originatingApp,null!=C&&C.searchSessionId&&M.search.session.continue(C.searchSessionId);const{datasourceMap:P,visualizationMap:_}=h,A={lensServices:k,datasourceMap:P,visualizationMap:_,embeddableEditorIncomingState:C,initialContext:j,initialStateFromLocator:O},L=Object(Cl.k)(A),D=l.a.memo((a=>{const[n,i]=Object(s.useState)("loading");Object(s.useEffect)((()=>{const e=Object(ks.createKbnUrlStateStorage)({history:a.history,useHash:k.uiSettings.get("state:storeInSessionStorage"),...Object(ks.withNotifyOnErrors)(k.notifications.toasts)}),{stop:t}=Object(is.syncGlobalQueryStateWithUrl)(M.query,e);return()=>{t()}}),[a.history]);const l=Object(s.useCallback)((e=>{var t,n;t=a.history,(n=e)?t.push({pathname:`/edit/${n}`,search:t.location.search}):t.push({pathname:"/",search:t.location.search})}),[a.history]),r=Object(s.useMemo)((()=>{return e=a.id,a.editByValue?null==C?void 0:C.valueInput:e?{savedObjectId:e}:void 0;var e}),[a.editByValue,a.id]),o=Object(s.useCallback)((()=>{j||M.query.filterManager.setAppFilters([]),j&&"isEmbeddable"in j&&j.isEmbeddable&&(M.query.filterManager.setAppFilters([]),M.query.queryString.clearQuery()),L.dispatch(Object(Cl.N)(Object(Dl.c)(A))),L.dispatch(Object(Cl.j)({redirectCallback:l,initialInput:r,history:a.history}))}),[r,a.history,l]);if(Object(s.useEffect)((()=>{(async()=>{await M.dataViews.hasData.hasUserDataView().catch((()=>!1))?(i("data"),o()):i("no_data")})()}),[o,r,a.history,l]),"loading"===n)return Object(x.jsx)(b.EuiLoadingSpinner,null);if("no_data"===n){const e={coreStart:f,dataViews:M.dataViews,dataViewEditor:v.dataViewEditor};return Object(x.jsx)(Iv,e,Object(x.jsx)(Mv,{onDataViewCreated:()=>{i("data"),o()}}))}return Object(x.jsx)(aa.Provider,{store:L},Object(x.jsx)(Nv,{incomingState:C,editorFrame:h,initialInput:r,redirectTo:l,redirectToOrigin:F,onAppLeave:t.onAppLeave,setHeaderActionMenu:t.setHeaderActionMenu,history:a.history,datasourceMap:P,visualizationMap:_,initialContext:j,contextOriginatingApp:I,topNavMenuEntryGenerators:m,theme$:e.theme.theme$,coreStart:f,savedObjectStore:w}))})),R=e=>Object(x.jsx)(D,{id:e.match.params.id,history:e.history,editByValue:e.editByValue}),B=t.history.listen((()=>{window.dispatchEvent(new HashChangeEvent("hashchange"))}));t.element.classList.add("lnsAppWrapper");const z=p();return Object(r.render)(Object(x.jsx)(d.KibanaThemeProvider,{theme$:f.theme.theme$},Object(x.jsx)(c.I18nProvider,null,Object(x.jsx)(d.KibanaContextProvider,{services:k},Object(x.jsx)(z,null,Object(x.jsx)(Wb,null,Object(x.jsx)(Xb,null,Object(x.jsx)(Hb,{exact:!0,path:"/edit/:id",component:R}),Object(x.jsx)(Hb,{exact:!0,path:`/${It.LENS_EDIT_BY_VALUE}`,render:e=>Object(x.jsx)(R,i()({},e,{editByValue:!0}))}),Object(x.jsx)(Hb,{exact:!0,path:"/",component:R}),Object(x.jsx)(Hb,{path:"/",component:function(){return Object(x.jsx)(c.FormattedMessage,{id:"xpack.lens.app404",defaultMessage:"404 Not Found"})}}))))))),t.element),()=>{var e;M.search.session.clear(),Object(r.unmountComponentAtNode)(t.element),k.inspector.close(),B(),L.dispatch(Object(Cl.l)()),null===(e=T.clearEditorState)||void 0===e||e.call(T,It.APP_ID)}}function qv(e,t){const a=new Ql.a(t.contentManagement);return t.embeddable.getAttributeService(It.DOC_TYPE,{saveMethod:async(e,t)=>({id:(await a.save({...e,savedObjectId:t,type:It.DOC_TYPE})).savedObjectId}),unwrapMethod:async e=>{const{item:t,meta:{outcome:n,aliasTargetId:i,aliasPurpose:s}}=await a.load(e),{attributes:l,references:r,id:o}=t,u={...l,references:r},c={aliasTargetId:i,outcome:n,aliasPurpose:s,sourceId:o};return{attributes:{...u,state:u.state},metaInfo:{sharingSavedObjectProps:c}}},checkForDuplicateTitle:t=>{const n=e.overlays;return Object(Ql.b)({title:t.newTitle,displayName:It.DOC_TYPE,isTitleDuplicateConfirmed:t.isTitleDuplicateConfirmed,lastSavedTitle:"",copyOnSave:!1},t.onTitleDuplicate,{client:a,overlays:n})}})}const Hv=async(e,t)=>{const[a,n]=await Promise.all([t.loadVisualizations(),t.loadDatasources()]);return{async getChartInfo(t){var i,s;const l=t,r=Object(st.getActiveDatasourceIdFromDoc)(l);if(!r||null==l||!l.visualizationType)return;const o=null==l?void 0:l.state.datasourceStates[r],u=await n[r].getDatasourceInfo(o,null==l?void 0:l.references,e),c=null===(i=(s=a[l.visualizationType]).getVisualizationInfo)||void 0===i?void 0:i.call(s,null==l?void 0:l.state.visualization),d=null==c?void 0:c.layers.map((e=>{const t=u.find((t=>t.layerId===e.layerId)),a=e.dimensions.map((e=>({...e,...null==t?void 0:t.columns.find((t=>t.id===e.id))})));return{...e,dataView:null==t?void 0:t.dataView,dimensions:a}}));return d?{layers:d,visualizationType:l.visualizationType,filters:l.state.filters,query:l.state.query}:void 0}}};var Uv=a(18);async function $v({hasDiscoverAccess:e,embeddable:t}){if(!e)return!1;try{return Object(Uv.a)(t)&&await t.canViewUnderlyingData()}catch(e){return console.error(e),!1}}async function Wv({embeddable:e,filters:t,dataViews:n,timeFieldName:i}){if(!Object(Uv.a)(e))throw new Error("Can only be executed in the context of Lens visualization");const s=e.getViewUnderlyingDataArgs();if(!s)throw new Error("Underlying data is not ready");const l=await n.get(s.dataViewSpec.id);let r=[...t||[],...s.filters],o=s.timeRange;if(l.isTimeBased()&&l.timeFieldName===i){const{extractTimeRange:e}=await Promise.resolve().then(a.t.bind(null,23,7)),{restOfFilters:n,timeRange:s}=e(t||[],i);r=n,s&&(o=s)}return{...s,timeRange:o,filters:r}}async function Xv({embeddable:e,locator:t,filters:a,dataViews:n,timeFieldName:i}){const s=await Wv({embeddable:e,filters:a,dataViews:n,timeFieldName:i});return null==t?void 0:t.getRedirectUrl(s)}async function Yv({embeddable:e,locator:t,filters:a,dataViews:n,timeFieldName:i}){const s=await Wv({embeddable:e,filters:a,dataViews:n,timeFieldName:i}),l=null==t?void 0:t.getLocation(s);if(!l)throw new Error("Discover location not found");return l}async function Qv({embeddable:e,locator:t,filters:a,openInSameTab:n,dataViews:i,timeFieldName:s,hasDiscoverAccess:l}){const r=await Xv({embeddable:e,locator:t,filters:a,dataViews:i,timeFieldName:s,hasDiscoverAccess:l});window.open(r,n?"_self":"_blank")}async function Kv(e){const t="edit"===e.getInput().viewMode;return Boolean(Object(Uv.a)(e)&&e.getIsEditable()&&t)}async function Zv({embeddable:e,startDependencies:t,overlays:a,theme:n}){if(!await Kv(e)||!Object(Uv.a)(e))throw new Ig.IncompatibleActionError;const i=e.getRoot(),s=Object(wb.tracksOverlays)(i)?i:void 0,r=await e.openConfingPanel(t);if(r){const t=a.openFlyout(Object(d.toMountPoint)(l.a.cloneElement(r,{closeFlyout:()=>{s&&s.clearOverlays(),t.close()}}),{theme$:n.theme$}),{className:"lnsConfigPanel__overlay",size:"s","data-test-subj":"customizeLens",type:"push",paddingSize:"m",hideCloseButton:!0,onClose:e=>{s&&s.clearOverlays(),e.close()},outsideClickCloses:!0});null==s||s.openOverlay(t,{focusedPanelId:e.id})}}a(487)},,,,,,,function(e,t,a){"use strict";a.d(t,"b",(function(){return d})),a.d(t,"a",(function(){return p}));var n=a(16),i=a.n(n),s=a(7),l=a(4),r=a(0),o=a(122),u=a(2);const c=({idx:e,isInvalid:t,invalidMessage:a,onRemoveClick:n,removeTitle:s,children:c,draggableProvided:d,isNotRemovable:p,isNotDraggable:m,"data-test-subj":g="lns-customBucketContainer"})=>{var f;const{euiTheme:b}=Object(l.useEuiTheme)();return Object(u.jsx)(l.EuiPanel,{paddingSize:"none",hasShadow:!1,hasBorder:!0,"data-test-subj":g,style:{padding:"0 "+b.size.xs}},Object(u.jsx)(l.EuiFlexGroup,{gutterSize:"s",alignItems:"center",responsive:!1},Object(u.jsx)(l.EuiFlexItem,i()({grow:!1},null!==(f=null==d?void 0:d.dragHandleProps)&&void 0!==f?f:{}),Object(u.jsx)(o.a,{tooltipContent:r.i18n.translate("visualizationUiComponents.fieldsBucketContainer.dragHandleDisabled",{defaultMessage:"Reordering requires more than one item."}),condition:null==m||m},Object(u.jsx)(l.EuiIcon,{size:"s",color:b.colors[t?"danger":m?"disabled":"subduedText"],type:t?"warning":"grab","aria-label":t?a:r.i18n.translate("visualizationUiComponents.customBucketContainer.dragToReorder",{defaultMessage:"Drag to reorder"}),"data-test-subj":`${g}-dragToReorder-${e}`}))),Object(u.jsx)(l.EuiFlexItem,{grow:!0},c),Object(u.jsx)(l.EuiFlexItem,{grow:!1},Object(u.jsx)(o.a,{tooltipContent:r.i18n.translate("visualizationUiComponents.fieldsBucketContainer.deleteButtonDisabled",{defaultMessage:"A minimum of one item is required."}),condition:null!=p&&p},Object(u.jsx)(l.EuiButtonIcon,{iconSize:"s",iconType:"trash",color:"danger",onClick:n,"aria-label":s,disabled:p,"data-test-subj":`${g}-remove-${e}`})))))},d=({id:e,children:t,isInsidePanel:a,Container:n=c,...s})=>{const{euiTheme:r}=Object(l.useEuiTheme)();return Object(u.jsx)(l.EuiDraggable,{draggableId:e,customDragHandle:!0,index:s.idx,isDragDisabled:s.isNotDraggable,style:a?{}:{marginBottom:r.size.xs},spacing:"none",hasInteractiveChildren:!0,disableInteractiveElementBlocking:!0},((e,a)=>{var l;return Object(u.jsx)(n,i()({draggableProvided:e,isDragging:null!==(l=null==a?void 0:a.isDragging)&&void 0!==l&&l},s),t)}))};function p({items:e,onDragStart:t,onDragEnd:a,droppableId:n,children:i,bgColor:r}){const[o,c]=Object(s.useState)(!1),d=Object(s.useCallback)((({source:t,destination:n})=>{c(!1),t&&n&&(null==a||a(Object(l.euiDragDropReorder)(e,t.index,n.index)))}),[e,a]),p=Object(s.useCallback)((()=>{c(!0),null==t||t()}),[t]);return Object(u.jsx)(l.EuiDragDropContext,{onDragEnd:d,onDragStart:p},Object(u.jsx)(l.EuiPanel,{paddingSize:"none",color:o?"success":r,hasShadow:!1,hasBorder:!1},Object(u.jsx)(l.EuiDroppable,{droppableId:n,spacing:r?"m":"none",style:{backgroundColor:"transparent"}},i)))}}])]);