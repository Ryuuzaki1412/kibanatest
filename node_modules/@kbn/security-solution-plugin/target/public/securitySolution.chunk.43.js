/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.securitySolution_bundle_jsonpfunction=window.securitySolution_bundle_jsonpfunction||[]).push([[43],{1404:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var r=i(9);const a=(e,t)=>{var i,a;const c={...e,fields:null==e||null===(i=e.searchSource)||void 0===i?void 0:i.getFields()},n={...t,fields:null==t||null===(a=t.searchSource)||void 0===a?void 0:a.getFields()},s=["columns","grid","hideChart","sort","timeRange","fields.filter","fields.query","title","description"],o=Object(r.pick)(c,s),l=Object(r.pick)(n,s);return Object(r.isEqual)(o,l)}},1726:function(e,t,i){"use strict";i.r(t),i.d(t,"DiscoverTabContent",(function(){return w}));var r=i(2),a=i.n(r),c=i(49),n=i(44),s=i(50),o=i(9),l=i(48),u=i(460),d=i(121),v=i(110),S=i(903),b=i(116),f=i(79),m=i(321);const p=()=>{const{services:{customDataService:e,uiActions:t}}=Object(v.i)(),i=Object(r.useCallback)((async i=>{let r;if(i.preventDefault&&i.preventDefault(),c=i,Array.isArray(c.data)&&"column"in c.data[0]){var a;r=await e.actions.createFiltersFromValueClickAction({data:i.data,negate:null!==(a=i.negate)&&void 0!==a&&a})}else{if(!(e=>Array.isArray(e.data)&&"cells"in e.data[0])(i))return;r=await e.actions.createFiltersFromMultiValueClickAction({data:i.data,negate:i.negate})}var c;if(r&&!Array.isArray(r)&&(r=[r]),r&&r.length>0){const e=t.getTrigger(m.c.HISTOGRAM_TRIGGER);await e.exec({filters:r,timeFieldName:i.timeFieldName})}}),[t,e.actions]),a=Object(r.useCallback)((t=>{e.query.timefilter.timefilter.setTime({from:new Date(t.range[0]).toISOString(),to:new Date(t.range[1]).toISOString(),mode:"absolute"}),t.preventDefault&&t.preventDefault()}),[e.query.timefilter.timefilter]);return Object(r.useCallback)((({customizations:e})=>{e.set({id:"unified_histogram",onFilter:i,onBrushEnd:a,withDefaultActions:!1,disabledActions:[f.ACTION_GLOBAL_APPLY_FILTER]})}),[i,a])},O=()=>{const{CustomStatefulTopNavKqlQueryBar:e}=(()=>{const{services:{navigation:{ui:{createTopNavWithCustomContext:e}},unifiedSearch:t,customDataService:i}}=Object(v.i)(),{ui:{getCustomSearchBar:a}}=t,c=Object(r.useMemo)((()=>a(i)),[i,a]);return{CustomStatefulTopNavKqlQueryBar:Object(r.useMemo)((()=>{const i={...t,ui:{...t.ui,SearchBar:c,AggregateQuerySearchBar:c}};return e(i)}),[c,e,t])}})();return({customizations:t})=>{t.set({id:"search_bar",CustomSearchBar:e,hideDataViewPicker:!0})}};var g=i(517);const y=i.n(g).a.div`
  width: 100%;
  height: 100%;
  overflow: scroll;
  display: grid,
  place-items: center
`;var h=i(118),j=i(112),T=i(134),A=i(1404),I=i(14),C=i(5);const D=e=>C.i18n.translate("xpack.securitySolution.timelines.discoverInTimeline.savedSearchTitle",{defaultMessage:"Saved search for timeline - {title}",values:{title:e}}),E=Object(n.createGlobalStyle)(["[data-test-subj='searchSessionIndicator']{display:none;}"]),w=({timelineId:e})=>{const t=Object(c.useHistory)(),{services:{customDataService:i,discover:n,dataViews:f,savedSearch:m}}=Object(v.i)(),g=Object(l.useDispatch)(),{dataViewId:C}=Object(d.d)(b.SourcererScopeName.detections),[w,F]=Object(r.useState)(),[_,L]=Object(r.useState)(),q=Object(r.useRef)(),R=Object(r.useRef)(),k=Object(r.useRef)(),N=Object(r.useRef)(),{discoverStateContainer:M,setDiscoverStateContainer:B,getAppStateFromSavedSearch:G,updateSavedSearch:P,initializeLocalSavedSearch:x,restoreDiscoverAppStateFromSavedSearch:U,resetDiscoverAppState:V,getDefaultDiscoverAppState:H}=Object(u.a)(),{discoverAppState:z,discoverSavedSearchState:Q,setDiscoverSavedSearchState:W,setDiscoverInternalState:Y,setDiscoverAppState:$}=(()=>{const e=Object(l.useSelector)((e=>e.discover.app)),t=Object(l.useSelector)((e=>e.discover.internal)),i=Object(l.useSelector)((e=>e.discover.savedSearch)),a=Object(l.useDispatch)();return{discoverAppState:e,setDiscoverAppState:Object(r.useCallback)((e=>{a(Object(S.a)({newState:e}))}),[a]),discoverInternalState:t,setDiscoverInternalState:Object(r.useCallback)((e=>{a(Object(S.b)({newState:e}))}),[a]),discoverSavedSearchState:i,setDiscoverSavedSearchState:Object(r.useCallback)((e=>{a(Object(S.c)({newState:e}))}),[a])}})(),K=[O(),p()],J=Object(r.useMemo)((()=>h.b.getTimelineByIdSelector()),[]),X=Object(j.b)((t=>{var i;return null!==(i=J(t,e))&&void 0!==i?i:T.b})),{status:Z,savedSearchId:ee,activeTab:te,savedObjectId:ie,title:re,description:ae,isDiscoverSavedSearchLoaded:ce=!1}=X,ne=Object(r.useCallback)((t=>{g(Object(I.setIsDiscoverSavedSearchLoaded)({id:e,isDiscoverSavedSearchLoaded:t}))}),[g,e]),{data:se,isFetching:oe}=Object(s.useQuery)({queryKey:["savedSearchById",null!=ee?ee:""],queryFn:()=>ee?m.get(ee):Promise.resolve(null)});Object(r.useEffect)((()=>{ie&&ne(!1)}),[ie,ne]),Object(r.useEffect)((()=>{oe||ce||(se?(U(se),ne(!0)):"draft"===Z?V().then((()=>{ne(!0)})):(g(Object(I.endTimelineSaving)({id:e})),ne(!0)))}),[M,ee,ce,Z,te,V,se,G,U,oe,ne,g,e]);const le=Object(r.useCallback)((()=>{var e,t,r,a,c,n;if(Q)return{...null!==(e=null===(t=M.current)||void 0===t?void 0:t.savedSearchState.getState())&&void 0!==e?e:Q,timeRange:i.query.timefilter.timefilter.getTime(),refreshInterval:null===(r=M.current)||void 0===r||null===(a=r.globalState.get())||void 0===a?void 0:a.refreshInterval,breakdownField:null===(c=M.current)||void 0===c?void 0:c.appState.getState().breakdownField,rowsPerPage:null===(n=M.current)||void 0===n?void 0:n.appState.getState().rowsPerPage,title:D(re),description:ae}}),[Q,M,i.query.timefilter.timefilter,re,ae]),ue=Object(r.useRef)();Object(r.useEffect)((()=>{if(oe)return;if(!ce)return;if(!ie)return;if(!Z||"draft"===Z)return;const t=le();(null==t?void 0:t.searchSource.getField("index"))&&t&&ue.current!==t&&(Object(o.isEqualWith)(t,se,A.a)||(P(t,e),ue.current=t))}),[le,se,P,ce,te,Z,_,ie,oe,e,g]),Object(r.useEffect)((()=>{C&&f.get(C).then(F)}),[C,f]),Object(r.useEffect)((()=>()=>{[q.current,R.current,k.current,N.current].forEach((e=>{e&&e.unsubscribe()}))}),[M]);const de=Object(r.useCallback)((async({stateContainer:t})=>{var r,a,c,n;let s;if(B(t),ee){const t=await m.get(ee);x(t,e),s=G(t)}const o=await H(),l=null!==(r=null!==(a=null===(c=s)||void 0===c?void 0:c.appState)&&void 0!==a?a:z)&&void 0!==r?r:o,u=t.appState.isEmptyURL()?void 0:t.appState.getState(),d=(null==u?void 0:u.query)&&"esql"in u.query;(null===(n=s)||void 0===n||!n.appState)&&d||(t.appState.set(l),await t.appState.replaceUrlState(l));const v=t.appState.state$.subscribe({next:$}),S=t.internalState.state$.subscribe({next:Y}),b=t.savedSearchState.getHasChanged$().subscribe({next:e=>{if(e){const e=t.savedSearchState.getState();W(e)}}}),f=i.query.timefilter.timefilter.getTimeUpdate$().subscribe({next:()=>{L(i.query.timefilter.timefilter.getTime())}});q.current=v,R.current=S,k.current=b,N.current=f}),[z,W,Y,$,B,G,i.query.timefilter.timefilter,ee,m,H,e,x]),ve=Object(r.useMemo)((()=>[de,...K]),[de,K]),Se=Object(r.useMemo)((()=>({data:i,filterManager:i.query.filterManager,timefilter:i.query.timefilter.timefilter})),[i]),be=n.DiscoverContainer,fe=Boolean(!w)||!ce;return a.a.createElement(y,{"data-test-subj":"timeline-embedded-discover"},a.a.createElement(E,null),a.a.createElement(be,{overrideServices:Se,scopedHistory:t,customizationCallbacks:ve,isLoading:fe}))};t.default=w},321:function(e,t,i){"use strict";i.d(t,"e",(function(){return a})),i.d(t,"c",(function(){return c})),i.d(t,"b",(function(){return n})),i.d(t,"d",(function(){return s})),i.d(t,"a",(function(){return o}));var r=i(239);let a,c,n,s;!function(e){e.DEFAULT="security-default-cellActions",e.DETAILS_FLYOUT="security-detailsFlyout-cellActions",e.ALERTS_COUNT="security-alertsCount-cellActions"}(a||(a={})),function(e){e.HISTOGRAM_TRIGGER="security-discoverInTimeline-histogramTrigger"}(c||(c={})),function(e){e.VIS_FILTER_ACTION="security-discoverInTimeline-visFilterAction"}(n||(n={})),function(e){e.FILTER="security-cellAction-type-filter",e.COPY="security-cellAction-type-copyToClipboard",e.ADD_TO_TIMELINE="security-cellAction-type-addToTimeline",e.INVESTIGATE_IN_NEW_TIMELINE="security-cellAction-type-investigateInNewTimeline",e.SHOW_TOP_N="security-cellAction-type-showTopN",e.TOGGLE_COLUMN="security-cellAction-type-toggleColumn"}(s||(s={}));const o={FILTER:r.c,COPY:r.a}}}]);