(window.embeddable_bundle_jsonpfunction=window.embeddable_bundle_jsonpfunction||[]).push([[2],{78:function(e,t,n){"use strict";n.r(t),n.d(t,"EmbeddablePanel",(function(){return w}));var a=n(19),i=n.n(a),l=n(7),o=n(72),s=n.n(o),r=n(8),d=n(2),c=n.n(d),b=n(4),u=n(73),p=n(41),m=n(10);const g=(e,t)=>{const[n,a]=Object(d.useState)(null==t?void 0:t.getInput()[e]);return Object(d.useEffect)((()=>{const n=null==t?void 0:t.getInput$().pipe(Object(r.distinctUntilKeyChanged)(e)).subscribe((()=>a(t.getInput()[e])));return()=>null==n?void 0:n.unsubscribe()}),[t,e]),n},j=(e,t)=>{const[n,a]=Object(d.useState)(t.getOutput()[e]);return Object(d.useEffect)((()=>{const n=t.getOutput$().pipe(Object(r.distinctUntilKeyChanged)(e)).subscribe((()=>a(t.getOutput()[e])));return()=>n.unsubscribe()}),[t,e]),n};var O=n(40),f=n(12),P=n(3),T=n(5);const x=T.i18n.translate("embeddableApi.panel.placeholderTitle",{defaultMessage:"[No Title]"}),v=e=>T.i18n.translate("embeddableApi.panel.editTitleAriaLabel",{defaultMessage:"Click to edit title: {title}",values:{title:e||x}}),E=(e,t)=>e?T.i18n.translate("embeddableApi.panel.optionsMenu.panelOptionsButtonEnhancedAriaLabel",{defaultMessage:"Panel options for {title}",values:{title:e}}):t?T.i18n.translate("embeddableApi.panel.optionsMenu.panelOptionsButtonAriaLabelWithIndex",{defaultMessage:"Options for panel {index}",values:{index:t}}):T.i18n.translate("embeddableApi.panel.optionsMenu.panelOptionsButtonAriaLabel",{defaultMessage:"Panel options"});var h=n(0);const M=({viewMode:e,hideTitle:t,embeddable:n,description:a,customizePanelAction:i})=>{const l=n.getTitle(),o=Object(d.useMemo)((()=>{if(t)return null;const a=s()("embPanel__titleText",{embPanel__placeholderTitleText:!l});return e===P.r.VIEW?Object(h.jsx)("span",{className:a},l):i?Object(h.jsx)(b.EuiLink,{color:"text",className:a,"aria-label":v(l),"data-test-subj":"embeddablePanelTitleLink",onClick:()=>i.execute({embeddable:n})},l||x):null}),[i,n,l,e,t]);return Object(d.useMemo)((()=>a?Object(h.jsx)(b.EuiToolTip,{content:a,delay:"regular",position:"top",anchorClassName:"embPanel__titleTooltipAnchor"},Object(h.jsx)("span",{className:"embPanel__titleInner"},o," ",Object(h.jsx)(b.EuiIcon,{type:"iInCircle",color:"subdued","data-test-subj":"embeddablePanelTitleDescriptionIcon"}))):Object(h.jsx)("span",{className:"embPanel__titleInner"},o)),[a,o])};var _=n(74),I=n(49),N=n(28);const A=({order:e},{order:t})=>(t||0)-(e||0),S=({index:e,embeddable:t,getActions:n,actionPredicate:a,universalActions:i})=>{const[l,o]=Object(d.useState)(!1),[r,c]=Object(d.useState)([]),[u,p]=Object(d.useState)(void 0),[m,j]=Object(d.useState)([]),O=g("title",t);Object(d.useEffect)((()=>{if(!1===u)return;o(!0);let e=!1;return(async()=>{const l=await(async e=>n?await n(I.CONTEXT_MENU_TRIGGER,{embeddable:t}):null!==(e=await f.g.getTriggerCompatibleActions(I.CONTEXT_MENU_TRIGGER,{embeddable:t}))&&void 0!==e?e:[])();if(e)return;let s=l.concat(Object.values(null!=i?i:{}));const{disabledActions:r}=t.getInput();if(r){const e=(e=>({id:t})=>-1===e.indexOf(t))(r);s=s.filter(e)}s.sort(A),a&&(s=s.filter((({id:e})=>a(e))));const d=await Object(N.buildContextMenuForActions)({actions:s.map((e=>({action:e,context:{embeddable:t},trigger:I.contextMenuTrigger}))),closeMenu:()=>p(!1)});e||(o(!1),c(s),j(d))})(),()=>{e=!0}}),[a,t,n,u,i]);const P=Object(d.useMemo)((()=>r.some((e=>e.showNotification))),[r]),x=s()({embPanel__optionsMenuPopover:!0,"embPanel__optionsMenuPopover-notification":P}),v=Object(h.jsx)(b.EuiButtonIcon,{color:"text",className:"embPanel__optionsMenuButton","data-test-subj":"embeddablePanelToggleMenuIcon","aria-label":E(O,e),onClick:()=>p((e=>!e)),iconType:"boxesHorizontal"});return Object(h.jsx)(b.EuiPopover,{repositionOnScroll:!0,panelPaddingSize:"none",anchorPosition:"downRight",button:v,isOpen:u,className:x,closePopover:()=>p(!1),"data-test-subj":u?"embeddablePanelContextMenuOpen":"embeddablePanelContextMenuClosed"},l?Object(h.jsx)(b.EuiContextMenuPanel,{className:"embPanel__optionsMenuPopover-loading",title:T.i18n.translate("embeddableApi.panel.contextMenu.loadingTitle",{defaultMessage:"Options"})},Object(h.jsx)(b.EuiContextMenuItem,null,Object(h.jsx)(b.EuiSkeletonText,null))):Object(h.jsx)(b.EuiContextMenu,{initialPanelId:"mainMenu",panels:m}))},y=({index:e,headerId:t,getActions:n,embeddable:a,actionPredicate:i,universalActions:l,showBadges:o=!0,showNotifications:r=!0})=>{var u,p;const m=Object(d.useMemo)((()=>Object(P.G)(a)?a.getSelfStyledOptions():void 0),[a]),{notificationComponents:j,badgeComponents:O}=((e,t,n,a)=>{const i=null!=a?a:f.g.getTriggerCompatibleActions,[l,o]=Object(d.useState)(),[s,r]=Object(d.useState)(),u=Object(d.useCallback)((async()=>{var e;if(!t)return;let a=null!==(e=await i(I.PANEL_BADGE_TRIGGER,{embeddable:n}))&&void 0!==e?e:[];const{disabledActions:l}=n.getInput();return l&&(a=a.filter((e=>-1===l.indexOf(e.id)))),a}),[n,i,t]),p=Object(d.useCallback)((async()=>{var t;if(!e)return;let a=null!==(t=await i(I.PANEL_NOTIFICATION_TRIGGER,{embeddable:n}))&&void 0!==t?t:[];const{disabledActions:l}=n.getInput();return l&&(a=a.filter((e=>-1===l.indexOf(e.id)))),a}),[n,i,e]);return Object(d.useEffect)((()=>{let e,t=!1;const a=async()=>{const[e,n]=await Promise.all([u(),p()]);t||(o(e),r(n))};return a().then((()=>{t||(e=n.getInput$().subscribe((()=>a())),n.parent&&e.add(n.parent.getInput$().subscribe((()=>a()))))})),()=>{var n;null===(n=e)||void 0===n||n.unsubscribe(),t=!0}}),[n,u,p]),{badgeComponents:Object(d.useMemo)((()=>null==l?void 0:l.map((e=>Object(h.jsx)(b.EuiBadge,{key:e.id,className:"embPanel__headerBadge",iconType:e.getIconType({embeddable:n,trigger:I.panelBadgeTrigger}),onClick:()=>e.execute({embeddable:n,trigger:I.panelBadgeTrigger}),onClickAriaLabel:e.getDisplayName({embeddable:n,trigger:I.panelBadgeTrigger}),"data-test-subj":`embeddablePanelBadge-${e.id}`},e.getDisplayName({embeddable:n,trigger:I.panelBadgeTrigger}))))),[l,n]),notificationComponents:Object(d.useMemo)((()=>null==s?void 0:s.map((e=>{const t={embeddable:n};let a=e.MenuItem?c.a.createElement(e.MenuItem,{key:e.id,context:{embeddable:n,trigger:I.panelNotificationTrigger}}):Object(h.jsx)(b.EuiNotificationBadge,{"data-test-subj":`embeddablePanelNotification-${e.id}`,key:e.id,style:{marginTop:_.euiThemeVars.euiSizeXS,marginRight:_.euiThemeVars.euiSizeXS},onClick:()=>e.execute({...t,trigger:I.panelNotificationTrigger})},e.getDisplayName({...t,trigger:I.panelNotificationTrigger}));if(e.getDisplayNameTooltip){const n=e.getDisplayNameTooltip({...t,trigger:I.panelNotificationTrigger});n&&(a=Object(h.jsx)(b.EuiToolTip,{position:"top",delay:"regular",content:n,key:e.id},a))}return a}))),[n,s])}})(r,o,a,n),v=a.getTitle(),E=a.getDescription(),N=g("viewMode",a),A=g("hidePanelTitles",a),y=g("hidePanelTitles",a.parent),C=Boolean(A)||Boolean(y)||Boolean(null==m?void 0:m.hideTitle)||N===P.r.VIEW&&!Boolean(v),w=!C||E||N!==P.r.VIEW||(null!==(u=null==O?void 0:O.length)&&void 0!==u?u:0)>0||(null!==(p=null==j?void 0:j.length)&&void 0!==p?p:0)>0,B=(e=>e?T.i18n.translate("embeddableApi.panel.enhancedDashboardPanelAriaLabel",{defaultMessage:"Dashboard panel: {title}",values:{title:e||x}}):T.i18n.translate("embeddableApi.panel.dashboardPanelAriaLabel",{defaultMessage:"Dashboard panel"}))(w?v:void 0),k=Object(h.jsx)(b.EuiScreenReaderOnly,null,Object(h.jsx)("span",{id:t},B)),G=s()("embPanel__header",{"embPanel__header--floater":!w}),R=s()("embPanel__title",{"embPanel--dragHandle":N===P.r.EDIT}),D=Object(h.jsx)(S,{index:e,embeddable:a,getActions:n,actionPredicate:i,universalActions:l});return w?Object(h.jsx)("figcaption",{className:G,"data-test-subj":`embeddablePanelHeading-${(v||"").replace(/\s/g,"")}`},Object(h.jsx)("h2",{"data-test-subj":"dashboardPanelTitle",className:R},k,Object(h.jsx)(M,{viewMode:N,hideTitle:C,embeddable:a,description:E,customizePanelAction:l.customizePanel}),o&&O),r&&j,D):Object(h.jsx)("div",{className:G},D,k)},C=e=>Object(l.isNil)(e.error)?!0===e.rendered?"rendered":!1===e.loading?"loaded":"loading":"error",w=e=>{const{hideHeader:t,showShadow:n,embeddable:a,hideInspector:l,onPanelStatusChange:o}=e,[T,x]=Object(d.useState)(),[v,E]=Object(d.useState)(!1),M=Object(d.useMemo)((()=>c.a.createRef()),[]),_=Object(d.useMemo)((()=>Object(b.htmlIdGenerator)()()),[]),[I,N]=Object(d.useState)(),A=Object(d.useMemo)((()=>{const e=f.b.uiSettings.get(u.UI_SETTINGS.TIMEPICKER_QUICK_RANGES),t=f.b.uiSettings.get(u.UI_SETTINGS.DATE_FORMAT),n=f.c.getStateTransfer(),a=new m.f(f.c.getEmbeddableFactory,f.b.application,n),i={customizePanel:new m.e(f.b.overlays,f.b.theme,a,e,t),removePanel:new m.i,editPanel:a};return l||(i.inspectPanel=new m.g(f.d)),i}),[l]);Object(d.useEffect)((()=>{if(!o)return;let e=0;const t=a.getOutput$().pipe(Object(r.map)((t=>(!0===t.loading&&(e=performance.now()),{id:a.id,status:C(t),error:t.error}))),Object(r.distinct)((t=>e+t.id+t.status+!!t.error)),Object(r.map)((t=>({...t,timeToEvent:performance.now()-e})))).subscribe((e=>{o(e)}));return()=>null==t?void 0:t.unsubscribe()}),[]);const S=j("loading",a),w=j("rendered",a);!1!==S&&!0!==w&&!I||v||E(!0);const B=g("viewMode",a);Object(d.useEffect)((()=>{if(!M.current)return;let e=!1;(async t=>{var n;const i=null!==(n=await a.render(t))&&void 0!==n?n:void 0;e||x(i)})(M.current);const t=a.getOutput$().subscribe({next:e=>{N(e.error)},error:e=>N(e)});return()=>{null==a||a.destroy(),null==t||t.unsubscribe(),e=!0}}),[a,M]);const k=Object(d.useMemo)((()=>s()("embPanel",{"embPanel--editing":B!==P.r.VIEW,"embPanel--loading":S})),[B,S]),G=Object(d.useMemo)((()=>{const e={};return S&&(e["data-loading"]=!0),I&&(e["data-error"]=!0),e}),[S,I]);return Object(h.jsx)(b.EuiPanel,{role:"figure",paddingSize:"none",className:k,hasShadow:n,"aria-labelledby":_,"data-test-subj":"embeddablePanel","data-test-embeddable-id":a.id},!t&&Object(h.jsx)(y,i()({},e,{headerId:_,universalActions:A})),I&&Object(h.jsx)(b.EuiFlexGroup,{alignItems:"center",className:"eui-fullHeight embPanel__error","data-test-subj":"embeddableError",justifyContent:"center"},Object(h.jsx)(b.EuiFlexItem,null,Object(h.jsx)(P.e,{embeddable:a,error:I},(e=>Object(h.jsx)(O.a,{editPanelAction:A.editPanel,embeddable:a,error:e}))))),!v&&Object(h.jsx)(p.a,null),Object(h.jsx)("div",i()({css:v?void 0:{display:"none !important"},className:"embPanel__content",ref:M},G),T))}}}]);