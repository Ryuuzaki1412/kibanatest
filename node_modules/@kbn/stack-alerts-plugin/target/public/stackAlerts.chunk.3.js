/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window.stackAlerts_bundle_jsonpfunction=window.stackAlerts_bundle_jsonpfunction||[]).push([[3],{32:function(e,t,i){"use strict";var s,a=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),n=[];function r(e){for(var t=-1,i=0;i<n.length;i++)if(n[i].identifier===e){t=i;break}return t}function o(e,t){for(var i={},s=[],a=0;a<e.length;a++){var o=e[a],l=t.base?o[0]+t.base:o[0],c=i[l]||0,d="".concat(l," ").concat(c);i[l]=c+1;var u=r(d),p={css:o[1],media:o[2],sourceMap:o[3]};-1!==u?(n[u].references++,n[u].updater(p)):n.push({identifier:d,updater:m(p,t),references:1}),s.push(d)}return s}function l(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var n=i.nc;n&&(s.nonce=n)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var r=a(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,i,s){var a=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=d(t,a);else{var n=document.createTextNode(a),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(n,r[t]):e.appendChild(n)}}function p(e,t,i){var s=i.css,a=i.media,n=i.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),n&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var h=null,g=0;function m(e,t){var i,s,a;if(t.singleton){var n=g++;i=h||(h=l(t)),s=u.bind(null,i,n,!1),a=u.bind(null,i,n,!0)}else i=l(t),s=p.bind(null,i,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var i=o(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<i.length;s++){var a=r(i[s]);n[a].references--}for(var l=o(e,t),c=0;c<i.length;c++){var d=r(i[c]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}i=l}}}},33:function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=function(e,t){var i,s,a,n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(i=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(a," */")),l=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(l).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,s){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(s)for(var n=0;n<this.length;n++){var r=this[n][0];null!=r&&(a[r]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);s&&a[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},35:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var s=i(2),a=i(0),n=i(7),r=i(10),o=i(4),l=i(19),c=i(1),d=i(3);const u=({index:e,esFields:t,timeField:i,errors:u,onIndexChange:p,onTimeFieldChange:h})=>{const{http:g}=Object(l.useKibana)().services,[m,j]=Object(s.useState)(!1),[f,b]=Object(s.useState)([]),[x,O]=Object(s.useState)(!1),[v,y]=Object(s.useState)([c.firstFieldOption]),T=Object(n.debounce)((async e=>{O(!0),b(await Object(c.getIndexOptions)(g,e)),O(!1)}),250);Object(s.useEffect)((()=>{const e=Object(c.getTimeFieldOptions)(t);y([c.firstFieldOption,...e])}),[t]);const S=()=>{j(!1),void 0===i&&h("")};return Object(d.jsx)(o.EuiPopover,{id:"indexPopover",button:Object(d.jsx)(o.EuiExpression,{display:"columns","data-test-subj":"selectIndexExpression",description:a.i18n.translate("xpack.stackAlerts.components.ui.alertParams.indexLabel",{defaultMessage:"index"}),value:e&&e.length>0?(e=>{const t=e.map(((t,i)=>Object(d.jsx)("p",{key:i},t,i<e.length-1?",":null)));return Object(d.jsx)("div",null,t)})(e):a.i18n.translate("xpack.stackAlerts.components.ui.alertParams.indexPlaceholder",{defaultMessage:"Select indices and a time field"}),isActive:m,onClick:()=>{j(!0)},isInvalid:!(e&&e.length>0&&""!==i)}),isOpen:m,closePopover:S,ownFocus:!0,anchorPosition:"downLeft",zIndex:8e3,display:"block"},Object(d.jsx)("div",{style:{width:"450px"}},Object(d.jsx)(o.EuiPopoverTitle,null,Object(d.jsx)(o.EuiFlexGroup,{alignItems:"center",gutterSize:"s"},Object(d.jsx)(o.EuiFlexItem,null,a.i18n.translate("xpack.stackAlerts.components.ui.alertParams.indexButtonLabel",{defaultMessage:"index"})),Object(d.jsx)(o.EuiFlexItem,{grow:!1},Object(d.jsx)(o.EuiButtonIcon,{"data-test-subj":"closePopover",iconType:"cross",color:"danger","aria-label":a.i18n.translate("xpack.stackAlerts.components.ui.alertParams.closeIndexPopoverLabel",{defaultMessage:"Close"}),onClick:S})))),Object(d.jsx)(o.EuiFormRow,{id:"indexSelectSearchBox",fullWidth:!0,label:Object(d.jsx)(r.FormattedMessage,{id:"xpack.stackAlerts.components.ui.alertParams.indicesToQueryLabel",defaultMessage:"Indices to query"}),isInvalid:u.index.length>0&&null!=e&&e.length>0,error:u.index,helpText:Object(d.jsx)(r.FormattedMessage,{id:"xpack.stackAlerts.components.ui.alertParams.howToBroadenSearchQueryDescription",defaultMessage:"Use * to broaden your query."})},Object(d.jsx)(o.EuiComboBox,{fullWidth:!0,async:!0,isLoading:x,isInvalid:u.index.length>0&&null!=e&&e.length>0,noSuggestions:!f.length,options:f,"data-test-subj":"thresholdIndexesComboBox",selectedOptions:(e||[]).map((e=>({label:e,value:e}))),onChange:async e=>{const t=e.map((e=>e.value)).filter(n.isString);if(p(t),0===t.length)y([c.firstFieldOption]);else{const e=await Object(c.getFields)(g,t),i=Object(c.getTimeFieldOptions)(e);y([c.firstFieldOption,...i])}},onSearchChange:T,onBlur:()=>{e||p([])}})),Object(d.jsx)(o.EuiFormRow,{id:"thresholdTimeField",fullWidth:!0,label:Object(d.jsx)(r.FormattedMessage,{id:"xpack.stackAlerts.components.ui.alertParams.timeFieldLabel",defaultMessage:"Time field"}),isInvalid:u.timeField.length>0&&void 0!==i,error:u.timeField},Object(d.jsx)(o.EuiSelect,{options:v,isInvalid:u.timeField.length>0&&void 0!==i,fullWidth:!0,name:"thresholdTimeField","data-test-subj":"thresholdAlertTimeFieldSelect",value:i||"",onChange:e=>{h(e.target.value)},onBlur:()=>{void 0===i&&h("")}}))))}},43:function(e,t,i){switch(window.__kbnThemeTag__){case"v8dark":return i(44);case"v8light":return i(46)}},44:function(e,t,i){var s=i(32),a=i(45);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},45:function(e,t,i){(t=i(33)(!1)).push([e.i,".actAlertVisualization__chart{height:224px}",""]),e.exports=t},46:function(e,t,i){var s=i(32),a=i(47);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);s(a,{insert:"head",singleton:!1}),e.exports=a.locals||{}},47:function(e,t,i){(t=i(33)(!1)).push([e.i,".actAlertVisualization__chart{height:224px}",""]),e.exports=t},58:function(e,t,i){"use strict";i.r(t),i.d(t,"DEFAULT_VALUES",(function(){return b})),i.d(t,"IndexThresholdRuleTypeExpression",(function(){return O})),i.d(t,"default",(function(){return O}));var s=i(2),a=i(0),n=i(10),r=i(4),o=i(19),l=i(1),c=i(20),d=i(24),u=i(25),p=i.n(u),h=i(26);var g,m=i(3);!function(e){e[e.FirstLoad=0]="FirstLoad",e[e.Refresh=1]="Refresh",e[e.Idle=2]="Idle"}(g||(g={}));const j=({ruleParams:e,alertInterval:t,aggregationTypes:i,comparators:l,refreshRateInMilliseconds:u=5e3,charts:j,dataFieldsFormats:f})=>{const{index:b,timeField:x,aggType:O,aggField:v,termSize:y,termField:T,thresholdComparator:S,timeWindowSize:E,timeWindowUnit:F,groupBy:I,threshold:w}=e,{http:A,uiSettings:C}=Object(o.useKibana)().services,[M,k]=Object(s.useState)(null),[_,z]=Object(s.useState)(!1),[R,W]=Object(s.useState)(void 0),[P,L]=Object(s.useState)(),[D,B]=Object(s.useState)(new Date);if(Object(s.useEffect)((()=>{const e=Object(c.interval)(u).subscribe((e=>{B(new Date)}));return()=>{e.unsubscribe()}}),[u]),Object(s.useEffect)((()=>{(async()=>{try{k(M?g.Refresh:g.FirstLoad),L(await async function(e,t,i){const s=await async function({model:e,visualizeOptions:t,http:i}){const s={index:e.index,timeField:e.timeField,aggType:e.aggType,aggField:e.aggField,groupBy:e.groupBy,termField:e.termField,termSize:e.termSize,timeWindowSize:e.timeWindowSize,timeWindowUnit:e.timeWindowUnit,filterKuery:e.filterKuery,dateStart:new Date(t.rangeFrom).toISOString(),dateEnd:new Date(t.rangeTo).toISOString(),interval:t.interval};return await i.post("/internal/triggers_actions_ui/data/_time_series_query",{body:JSON.stringify(s)})}({model:e,visualizeOptions:t,http:i}),a={};for(const e of s.results)a[e.group]=e.metrics.map((e=>[Date.parse(e[0]),e[1]]));return a}(V,H,A)),z(!1),W(void 0)}catch(t){var e;z(!0),W((null==t||null===(e=t.body)||void 0===e?void 0:e.message)||(null==t?void 0:t.message))}finally{k(g.Idle)}})()}),[b,x,O,v,y,T,S,E,F,I,w,D]),!j||!C||!f)return null;const N=j.theme.useChartsTheme(),U=j.theme.useChartsBaseTheme(),G=((e,t)=>{let i;try{i=Object(h.parseDuration)(e)}catch(e){i=6e4}return{min:t.getTime()-30*i,max:t.getTime()}})(t,D),H={rangeFrom:new Date(G.min).toISOString(),rangeTo:new Date(G.max).toISOString(),interval:t},V={...e,actions:[],type:"threshold"};if(M===g.FirstLoad)return Object(m.jsx)(r.EuiEmptyPrompt,{"data-test-subj":"firstLoad",title:Object(m.jsx)(r.EuiLoadingChart,{size:"xl"}),body:Object(m.jsx)(r.EuiText,{color:"subdued"},Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.visualization.loadingAlertVisualizationDescription",defaultMessage:"Loading alert visualization…"}))});if(_)return Object(m.jsx)(s.Fragment,null,Object(m.jsx)(r.EuiSpacer,{size:"l"}),Object(m.jsx)(r.EuiCallOut,{"data-test-subj":"errorCallout",title:Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.visualization.errorLoadingAlertVisualizationTitle",defaultMessage:"Cannot load alert visualization",values:{}}),color:"danger",iconType:"warning"},R));if(P){const e=Object.keys(P),t=(e=>{const t=e,i="dateFormat:tz";if(!t.isDefault(i))return t.get(i);return p.a.tz.guess()||p()().format("Z")})(C),o=S?w.slice(0,l[S].requiredValues):[];let c=o[o.length-1];Object.values(P).forEach((e=>{e.forEach((([,e])=>{e>c&&(c=e)}))}));const u=Object(d.niceTimeFormatter)([G.min,G.max]),h=i[O].text;return Object(m.jsx)("div",{"data-test-subj":"alertVisualizationChart",style:{position:"relative"}},M===g.Refresh?Object(m.jsx)(r.EuiLoadingSpinner,{size:"l",style:{position:"absolute",top:"8%",right:"5%"}}):Object(m.jsx)(s.Fragment,null),e.length?Object(m.jsx)(d.Chart,{size:["100%",200],renderer:"canvas"},Object(m.jsx)(d.Settings,{theme:[{lineSeriesStyle:{line:{strokeWidth:3},point:{visible:!1}}},N],baseTheme:U,xDomain:G,showLegend:!!T,showLegendExtra:!0,legendPosition:d.Position.Bottom,locale:a.i18n.getLocale()}),Object(m.jsx)(d.Axis,{id:"bottom",position:d.Position.Bottom,showOverlappingTicks:!0,tickFormat:u}),Object(m.jsx)(d.Axis,{domain:{max:c,min:NaN},id:"left",title:h,position:d.Position.Left}),e.map((e=>Object(m.jsx)(d.LineSeries,{key:e,id:e,xScaleType:d.ScaleType.Time,yScaleType:d.ScaleType.Linear,data:P[e],xAccessor:0,yAccessors:[1],timeZone:t}))),o.map(((e,t)=>{const i=0===t?"threshold":`threshold${t}`;return Object(m.jsx)(d.LineAnnotation,{key:i,id:i,domainType:d.AnnotationDomainType.YDomain,dataValues:[{dataValue:w[t],details:i}]})}))):Object(m.jsx)(r.EuiCallOut,{"data-test-subj":"noDataCallout",size:"s",title:Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.visualization.thresholdPreviewChart.noDataTitle",defaultMessage:"No data matches this query"}),color:"warning"},Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.visualization.thresholdPreviewChart.dataDoesNotExistTextMessage",defaultMessage:"Check that your time range and filters are correct."})))}return null};i(43);var f=i(35);const b={AGGREGATION_TYPE:"count",TERM_SIZE:5,THRESHOLD_COMPARATOR:l.COMPARATORS.GREATER_THAN,TIME_WINDOW_SIZE:5,TIME_WINDOW_UNIT:"m",THRESHOLD:[1e3],GROUP_BY:"all"},x=["index","timeField","aggField","termSize","termField","threshold0","threshold1","timeWindowSize"],O=({ruleParams:e,ruleInterval:t,setRuleParams:i,setRuleProperty:c,errors:d,charts:u,data:p})=>{const{index:h,timeField:g,aggType:O,aggField:v,groupBy:y,termSize:T,termField:S,thresholdComparator:E,threshold:F,timeWindowSize:I,timeWindowUnit:w,filterKuery:A}=e,C=function(e){return e?"string"==typeof e?[e]:e:[]}(h),{http:M}=Object(o.useKibana)().services,[k,_]=Object(s.useState)([]),z=!!Object.keys(d).find((t=>x.includes(t)&&d[t].length>=1&&void 0!==e[t])),R=!!Object.keys(d).find((e=>x.includes(e)&&d[e].length>=1)),W=a.i18n.translate("xpack.stackAlerts.threshold.ui.alertParams.fixErrorInExpressionBelowValidationMessage",{defaultMessage:"Expression contains errors."}),P=async e=>{const t=await Object(l.getFields)(M,e);_(t)},L=Object(s.useCallback)((e=>{i("filterKuery",e.target.value||void 0)}),[i]);return Object(s.useEffect)((()=>{(async()=>{c("params",{...e,aggType:null!=O?O:b.AGGREGATION_TYPE,termSize:null!=T?T:b.TERM_SIZE,thresholdComparator:null!=E?E:b.THRESHOLD_COMPARATOR,timeWindowSize:null!=I?I:b.TIME_WINDOW_SIZE,timeWindowUnit:null!=w?w:b.TIME_WINDOW_UNIT,groupBy:null!=y?y:b.GROUP_BY,threshold:null!=F?F:b.THRESHOLD}),C.length>0&&await P(C)})()}),[]),Object(m.jsx)(s.Fragment,null,z?Object(m.jsx)(s.Fragment,null,Object(m.jsx)(r.EuiSpacer,null),Object(m.jsx)(r.EuiCallOut,{color:"danger",size:"s",title:W}),Object(m.jsx)(r.EuiSpacer,null)):null,Object(m.jsx)(r.EuiTitle,{size:"xs"},Object(m.jsx)("h5",null,Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.selectIndex",defaultMessage:"Select indices"}))),Object(m.jsx)(r.EuiSpacer,{size:"s"}),Object(m.jsx)(f.a,{index:C,"data-test-subj":"indexSelectPopover",esFields:k,timeField:g,errors:d,onIndexChange:async t=>{i("index",t),0===t.length?c("params",{...e,index:t,aggType:b.AGGREGATION_TYPE,termSize:b.TERM_SIZE,thresholdComparator:b.THRESHOLD_COMPARATOR,timeWindowSize:b.TIME_WINDOW_SIZE,timeWindowUnit:b.TIME_WINDOW_UNIT,groupBy:b.GROUP_BY,threshold:b.THRESHOLD,timeField:""}):await P(t)},onTimeFieldChange:e=>i("timeField",e)}),Object(m.jsx)(r.EuiSpacer,null),Object(m.jsx)(r.EuiTitle,{size:"xs"},Object(m.jsx)("h5",null,Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.conditionPrompt",defaultMessage:"Define the condition"}))),Object(m.jsx)(r.EuiSpacer,{size:"s"}),Object(m.jsx)(l.WhenExpression,{display:"fullWidth","data-test-subj":"whenExpression",aggType:null!=O?O:b.AGGREGATION_TYPE,onChangeSelectedAggType:e=>i("aggType",e)}),O&&l.builtInAggregationTypes[O].fieldRequired?Object(m.jsx)(l.OfExpression,{aggField:v,"data-test-subj":"aggTypeExpression",fields:k,aggType:O,errors:d,display:"fullWidth",onChangeSelectedAggField:e=>i("aggField",e)}):null,Object(m.jsx)(l.GroupByExpression,{groupBy:y||b.GROUP_BY,"data-test-subj":"groupByExpression",termField:S,termSize:T,errors:d,fields:k,display:"fullWidth",onChangeSelectedGroupBy:e=>i("groupBy",e),onChangeSelectedTermField:e=>i("termField",e),onChangeSelectedTermSize:e=>i("termSize",e)}),Object(m.jsx)(l.ThresholdExpression,{thresholdComparator:null!=E?E:b.THRESHOLD_COMPARATOR,threshold:F,"data-test-subj":"thresholdExpression",errors:d,display:"fullWidth",popupPosition:"upLeft",onChangeSelectedThreshold:e=>i("threshold",e),onChangeSelectedThresholdComparator:e=>i("thresholdComparator",e)}),Object(m.jsx)(l.ForLastExpression,{"data-test-subj":"forLastExpression",popupPosition:"upLeft",timeWindowSize:null!=I?I:b.TIME_WINDOW_SIZE,timeWindowUnit:null!=w?w:b.TIME_WINDOW_UNIT,display:"fullWidth",errors:d,onChangeWindowSize:e=>i("timeWindowSize",e),onChangeWindowUnit:e=>i("timeWindowUnit",e)}),Object(m.jsx)(r.EuiSpacer,{size:"s"}),Object(m.jsx)(r.EuiFormRow,{label:a.i18n.translate("xpack.stackAlerts.threshold.ui.filterTitle",{defaultMessage:"Filter"}),labelAppend:Object(m.jsx)(r.EuiText,{color:"subdued",size:"xs"},Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.filter.optional",defaultMessage:"Optional"})),helpText:a.i18n.translate("xpack.stackAlerts.threshold.ui.filterKQLHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alerts."}),fullWidth:!0,display:"rowCompressed",isInvalid:d.filterKuery.length>0,error:d.filterKuery},Object(m.jsx)(r.EuiFieldSearch,{"data-test-subj":"filterKuery",onChange:L,value:A,fullWidth:!0,isInvalid:d.filterKuery.length>0})),Object(m.jsx)(r.EuiSpacer,null),Object(m.jsx)("div",{className:"actAlertVisualization__chart"},R?Object(m.jsx)(s.Fragment,null,Object(m.jsx)(r.EuiEmptyPrompt,{"data-test-subj":"visualizationPlaceholder",iconType:"visBarVertical",body:Object(m.jsx)(r.EuiText,{color:"subdued"},Object(m.jsx)(n.FormattedMessage,{id:"xpack.stackAlerts.threshold.ui.previewAlertVisualizationDescription",defaultMessage:"Complete the expression to generate a preview."}))})):Object(m.jsx)(s.Fragment,null,Object(m.jsx)(j,{"data-test-subj":"thresholdVisualization",ruleParams:e,alertInterval:t,aggregationTypes:l.builtInAggregationTypes,comparators:l.builtInComparators,charts:u,dataFieldsFormats:p.fieldFormats}))))}}}]);